// ==UserScript==
// @name         Magic Garden ModMenu 
// @namespace    Quinoa
// @version      1.1.4
// @match        https://*.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @run-at       document-start
// @all-frames   true
// @inject-into  page
// @grant        none
// @downloadURL  https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// @updateURL    https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// ==/UserScript==
(()=>{var Tr=Object.defineProperty;var Ir=(t,e,n)=>e in t?Tr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var W=(t,e,n)=>Ir(t,typeof e!="symbol"?e+"":e,n);var ve=window.WebSocket,Ga=window.Worker,we=[],Fe=null;function qe(t,e){if(!Fe){Fe=t;try{console.log("[QuinoaWS] selected ->",e)}catch{}}}var St=!1;var vt=typeof Set<"u"?new Set:{_a:[],add(t){this._a.push(t)},delete(t){let e=this._a.indexOf(t);e>=0&&this._a.splice(e,1)},forEach(t){for(let e=0;e<this._a.length;e++)t(this._a[e])}};function wt(t){return["CONNECTING","OPEN","CLOSING","CLOSED"][t??-1]||"none"}async function wn(t){try{if(typeof t=="string")return JSON.parse(t);if(t instanceof Blob)return JSON.parse(await t.text());if(t instanceof ArrayBuffer)return JSON.parse(new TextDecoder().decode(t))}catch{}return null}function xn(){function t(e,n){let r=n!==void 0?new ve(e,n):new ve(e);we.push(r),r.addEventListener("open",()=>{setTimeout(()=>{r.readyState===ve.OPEN&&qe(r,"open-fallback")},800)}),r.addEventListener("message",async s=>{let i=await wn(s.data);i&&!window.quinoaWS&&(i.type==="Welcome"||i.type==="Config"||i.fullState||i.config)&&qe(r,"message:"+(i.type||"state"))});let a=r.send.bind(r);return r.send=function(s){try{let i=null;typeof s=="string"?i=JSON.parse(s):s instanceof ArrayBuffer&&(i=JSON.parse(new TextDecoder().decode(s))),!window.quinoaWS&&i&&Array.isArray(i.scopePath)&&i.scopePath.join("/")==="Room/Quinoa"&&qe(r,"send:"+i.type)}catch{}return a(s)},r}t.prototype=ve.prototype;try{t.OPEN=ve.OPEN}catch{}try{t.CLOSED=ve.CLOSED}catch{}try{t.CLOSING=ve.CLOSING}catch{}try{t.CONNECTING=ve.CONNECTING}catch{}window.WebSocket=t}var Re=null,Gt=!1,Pn=null,xt=null,Tn=()=>globalThis.jotaiAtomCache?.cache;function Cr(){let t=globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;for(let[e]of t.renderers){let n=t.getFiberRoots(e);for(let r of n){let a=new Set,s=[r.current];for(;s.length;){let i=s.pop();if(!i||a.has(i))continue;a.add(i);let o=i?.pendingProps?.value;if(o&&typeof o.get=="function"&&typeof o.set=="function"&&typeof o.sub=="function")return xt="fiber",o;i.child&&s.push(i.child),i.sibling&&s.push(i.sibling),i.alternate&&s.push(i.alternate)}}}return null}async function Mr(t=5e3){let e=Tn();if(!e)throw new Error("jotaiAtomCache.cache introuvable");let n=null,r=null,a=[];for(let o of e.values()){if(!o||typeof o.write!="function")continue;let u=o.write;o.__origWrite=u,o.write=function(l,p,...T){if(!r){n=l,r=p;for(let C of a)C.write=C.__origWrite,delete C.__origWrite}return u.call(this,l,p,...T)},a.push(o)}let s=o=>new Promise(u=>setTimeout(u,o)),i=Date.now();try{globalThis.dispatchEvent?.(new Event("visibilitychange"))}catch{}for(;!r&&Date.now()-i<t;)await s(50);return r?(xt="write",{get:o=>n(o),set:(o,u)=>r(o,u),sub:(o,u)=>{let l;try{l=n(o)}catch{}let p=setInterval(()=>{let T;try{T=n(o)}catch{return}if(T!==l){l=T;try{u()}catch{}}},100);return()=>clearInterval(p)}}):(xt="polyfill",{get:()=>{throw new Error("Store non captur\xE9: get indisponible")},set:()=>{throw new Error("Store non captur\xE9: set indisponible")},sub:()=>()=>{},__polyfill:!0})}async function Ee(){if(Re)return Re;if(Gt){let t=Date.now();for(;!Re&&Date.now()-t<3e3;)await new Promise(e=>setTimeout(e,25));if(Re)return Re}Gt=!0;try{return Re=Cr()||await Mr(),Re}catch(t){throw Pn=t,t}finally{Gt=!1}}function Ye(){return!!Re&&!Re.__polyfill}function In(){return{via:xt,polyfill:!!Re?.__polyfill,error:Pn}}async function Pe(t){return(await Ee()).get(t)}async function Te(t,e){await(await Ee()).set(t,e)}async function Je(t,e){return(await Ee()).sub(t,e)}function tt(t){let e=Tn();if(!e)return[];let n=[];for(let r of e.values()){let a=r?.debugLabel||r?.label||"";t.test(String(a))&&n.push(r)}return n}function de(t){return tt(new RegExp("^"+t+"$"))[0]||null}function Er(t){if(vt.forEach)vt.forEach(e=>{try{e.postMessage(t)}catch{}});else for(let e of vt._a)try{e.postMessage(t)}catch{}}function Ar(){if(Fe&&Fe.readyState===ve.OPEN)return Fe;let t=null;if(we.find&&(t=we.find(e=>e.readyState===ve.OPEN)||null),!t){for(let e=0;e<we.length;e++)if(we[e].readyState===ve.OPEN){t=we[e];break}}if(t)return qe(t,"getPageWS"),t;throw new Error("No page WebSocket open")}function me(t){let e={scopePath:["Room","Quinoa"],...t};try{return Ar().send(JSON.stringify(e)),!0}catch{return Er({__QWS_CMD:"send",payload:JSON.stringify(e)}),!0}}async function Pt(){try{await Ee()}catch{}}async function Cn(t,e){await Pt();let n=de(t);if(!n)return e;try{return await Pe(n)}catch{return e}}async function Mn(t,e){await Pt();let n=de(t);return n?await Je(n,async()=>{try{e(await Pe(n))}catch{}}):()=>{}}async function kr(t,e){let n=await Cn(t);return n!==void 0&&e(n),Mn(t,e)}async function Rr(t,e){await Pt();let n=de(t);n&&await Te(n,e)}var nt={ensure:Pt,select:Cn,subscribe:Mn,subscribeImmediate:kr,set:Rr};function Tt(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;let n=new Set(t);for(let r of e)if(!n.has(r))return!1;return!0}async function Lr(t,e){await nt.set(t,e)}function xe(t,e,n){let r=()=>nt.select(t),a=()=>r().then(l=>e?e(l):l),s=async l=>{let p=await r().catch(()=>{}),T=n?n(l,p):l;return Lr(t,T)};return{label:t,get:a,set:s,update:async l=>{let p=await a(),T=l(p);return await s(T),T},sub:l=>nt.subscribe(t,p=>l(e?e(p):p)),subNow:l=>nt.subscribeImmediate(t,p=>l(e?e(p):p))}}var It=(()=>{let t=xe("myInventoryAtom",e=>Array.isArray(e?.favoritedItemIds)?e.favoritedItemIds.slice():[]);return{label:t.label+":favoriteIds",get:t.get,sub(e){let n=null;return t.sub(r=>{(!n||!Tt(n,r))&&(n=r,e(r))})},subNow(e){let n=null;return t.subNow(r=>{(!n||!Tt(n,r))&&(n=r,e(r))})}}})(),je=(()=>{let t=xe("myInventoryAtom",e=>Array.isArray(e?.favoritedItemIds)?e.favoritedItemIds:[]);return{label:t.label+":favoriteIdSet",async get(){return new Set(await t.get())},sub(e){let n=null;return t.sub(r=>{(!n||!Tt(n,r))&&(n=r,e(new Set(r)))})},subNow(e){let n=null;return t.subNow(r=>{(!n||!Tt(n,r))&&(n=r,e(new Set(r)))})}}})(),rt=(()=>{let t=xe("myDataAtom",e=>e?.garden??null);return{label:t.label+":garden",get:t.get,sub:t.sub,subNow:t.subNow}})(),at=xe("positionAtom"),st=xe("stateAtom"),Ke=xe("myInventoryAtom"),Kt=xe("shopsAtom"),$t=xe("myShopPurchasesAtom"),Ct=xe("myDataAtom"),Be=xe("myCropInventoryAtom"),Mt=xe("numPlayersAtom"),Vt=xe("totalCropSellPriceAtom"),Ne=xe("myPetInfosAtom"),es=xe("myPetSlotInfosAtom"),ts=xe("myValidatedSelectedItemIndexAtom"),ns=xe("setSelectedIndexToEndAtom");function Hr(t){if(!t)return"null";let e=typeof t?.abilityId=="string"?t.abilityId:"",n=Number.isFinite(t?.performedAt)?String(t.performedAt):"",r="";try{r=JSON.stringify(t?.data??null)}catch{r=""}return`${e}|${n}|${r}`}function jt(t){let e={},n=new Map;if(t&&typeof t=="object")for(let r of Object.keys(t)){let a=t[r]??{},s=a.lastAbilityTrigger??null,i=a.position??null;e[r]={petId:r,abilityId:s?.abilityId??null,performedAt:Number.isFinite(s?.performedAt)?s.performedAt:null,data:s?.data??null,position:i??null},n.set(r,Hr(s))}return{value:e,sig:n}}function En(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}var An=(()=>{let t=xe("myPetSlotInfosAtom");return{label:t.label+":abilitiesTrigger",async get(){let n=await t.get();return jt(n).value},sub(n){let r=null;return t.sub(a=>{let{value:s,sig:i}=jt(a);En(r,i)||(r=i,n(s))})},subNow(n){let r=null;return t.subNow(a=>{let{value:s,sig:i}=jt(a);En(r,i)||(r=i,n(s))})}}})();function kn(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}function zt(t,e){let n=t?.tileObjects??{},r=e?.tileObjects??{},a=[],s=[],i=[],o=[],u=new Set;for(let l of Object.keys(r))u.add(l),l in n?kn(n[l])!==kn(r[l])&&(s.push(+l),o.push({kind:"updated",slot:+l,prev:n[l],next:r[l]})):(a.push(+l),o.push({kind:"added",slot:+l,next:r[l]}));for(let l of Object.keys(n))u.has(l)||(i.push(+l),o.push({kind:"removed",slot:+l,prev:n[l]}));return{added:a,updated:s,removed:i,changes:o}}function _r(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",a=e.name??"",s=e.petSpecies??"",i=Number.isFinite(e.xp)?Math.round(e.xp):0,o=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,u=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,l=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,p=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${a}|xp:${i}|hg:${o}|sc:${u}|m:${n}|a:${r}|pos:${l},${p}`}function it(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=String(r?.slot?.id??"");a&&e.set(a,_r(r))}return e}function Ut(t,e){let n=[],r=[],a=[],s=[];for(let[i,o]of e)t.has(i)?t.get(i)!==o&&(r.push(i),s.push({kind:"updated",id:i})):(n.push(i),s.push({kind:"added",id:i}));for(let i of t.keys())e.has(i)||(a.push(i),s.push({kind:"removed",id:i}));return{added:n,updated:r,removed:a,changes:s}}function Nr(t){let e=Array.isArray(t.mutations)?t.mutations.slice().sort().join(","):"",n=Number.isFinite(t.scale)?Math.round(t.scale*1e3):0;return`${t.species??""}|${t.itemType??""}|${n}|${e}`}function ot(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=String(r?.id??"");a&&e.set(a,Nr(r))}return e}function Yt(t,e){let n=[],r=[],a=[],s=[];for(let[i,o]of e)t.has(i)?t.get(i)!==o&&(r.push(i),s.push({kind:"updated",key:i})):(n.push(i),s.push({kind:"added",key:i}));for(let i of t.keys())e.has(i)||(a.push(i),s.push({kind:"removed",key:i}));return{added:n,updated:r,removed:a,changes:s}}var j={getPosition(){return at.get()},onPosition(t){return at.sub(t)},onPositionNow(t){return at.subNow(t)},async setPosition(t,e){let n=de(at.label||"positionAtom");if(!n)throw new Error("positionAtom introuvable");await Te(n,{x:t,y:e})},async teleport(t,e){try{await this.setPosition(t,e)}catch{}try{me({type:"Teleport",position:{x:t,y:e}})}catch{}},async move(t,e){try{await this.setPosition(t,e)}catch{}try{me({type:"PlayerPosition",position:{x:t,y:e}})}catch{}},async plantSeed(t,e){try{me({type:"PlantSeed",slot:t,species:e})}catch{}},async sellAllCrops(){try{me({type:"SellAllCrops"})}catch{}},async sellPet(t){try{me({type:"SellPet",itemId:t})}catch{}},async waterPlant(t){try{me({type:"WaterPlant",slot:t})}catch{}},async setSelectedItem(t){try{me({type:"SetSelectedItem",itemIndex:t})}catch{}},async pickupObject(){try{me({type:"PickupObject"})}catch{}},async dropObject(){try{me({type:"DropObject"})}catch{}},async harvestCrop(t,e){try{me({type:"HarvestCrop",slot:t,slotsIndex:e})}catch{}},async feedPet(t,e){try{me({type:"FeedPet",petItemId:t,cropItemId:e})}catch{}},async hatchEgg(t){try{me({type:"HatchEgg",slot:t})}catch{}},async placeDecor(t,e,n){try{me({type:"PlaceDecor",tileType:t,localTileIndex:e,decorId:n})}catch{}},async swapPet(t,e){try{me({type:"SwapPet",petSlotId:t,petInventoryId:e})}catch{}},async placePet(t,e,n,r){try{me({type:"PlacePet",itemId:t,position:e,tileType:n,localTileIndex:r})}catch{}},async storePet(t){try{me({type:"StorePet",itemId:t})}catch{}},async toggleFavoriteItem(t){try{me({type:"ToggleFavoriteItem",itemId:t})}catch{}},async getFavoriteIds(){let t=await It.get();return Array.isArray(t)?t.slice():[]},async getFavoriteIdSet(){return await je.get()},async isFavoriteItem(t){return(await je.get()).has(t)},async ensureFavoriteItem(t,e){let n=await this.isFavoriteItem(t);return n!==e?(await this.toggleFavoriteItem(t),e):n},async ensureFavorites(t,e){let n=await je.get(),r=0;for(let a of t)if(n.has(a)!==e)try{await this.toggleFavoriteItem(a),r++}catch{}},onFavoriteIdsChange(t){return It.sub(e=>{let n=Array.isArray(e)?e:[];t(n)})},async onFavoriteIdsChangeNow(t){let e=await this.getFavoriteIds();return t(e),It.sub(n=>{let r=Array.isArray(n)?n:[];t(r)})},onFavoriteSetChange(t){return je.sub(e=>{t(e)})},async onFavoriteSetChangeNow(t){let e=await je.get();return t(e),je.sub(n=>{t(n)})},async getGardenState(){return(await Ct.get())?.garden??null},onGardenChange(t){let e=null;return rt.sub(n=>{n!==e&&(e=n,t(n))})},async onGardenChangeNow(t){let e=await rt.get();return t(e),rt.sub(n=>{n!==e&&(e=n,t(n))})},onGardenDiff(t){let e=null;return rt.sub(n=>{let r=zt(e,n);(r.added.length||r.updated.length||r.removed.length||n!==e)&&(e=n,t(n,r))})},async onGardenDiffNow(t){let e=(await Ct.get())?.garden??null;return t(e,zt(null,e)),Ct.sub(n=>{let r=n?.garden??null,a=zt(e,r);(a.added.length||a.updated.length||a.removed.length)&&(e=r,t(r,a))})},async getPets(){let t=await Ne.get();return Array.isArray(t)?t:null},onPetsChange(t){let e=null;return Ne.sub(n=>{n!==e&&(e=n,t(e))})},async onPetsChangeNow(t){let e=await this.getPets();return t(e),Ne.sub(n=>{n!==e&&(e=n,t(e))})},onPetsDiff(t){let e=it(null);return Ne.sub(n=>{let r=it(n),a=Ut(e,r);(a.added.length||a.updated.length||a.removed.length)&&(t(n,a),e=r)})},async onPetsDiffNow(t){let e=await this.getPets(),n=it(null),r=it(e),a=Ut(n,r);return t(e,a),n=r,Ne.sub(s=>{r=it(s);let i=Ut(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getCropInventoryState(){return await Be.get()},onCropInventoryChange(t){let e=null;return Be.sub(n=>{n!==e&&(e=n,t(n))})},async onCropInventoryChangeNow(t){let e=await Be.get();return t(e),Be.sub(n=>{n!==e&&(e=n,t(n))})},onCropInventoryDiff(t){let e=ot(null);return Be.sub(n=>{let r=ot(n),a=Yt(e,r);(a.added.length||a.updated.length||a.removed.length)&&(t(n,a),e=r)})},async onCropInventoryDiffNow(t){let e=await Be.get(),n=ot(null),r=ot(e),a=Yt(n,r);return t(e,a),n=r,Be.sub(s=>{r=ot(s);let i=Yt(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getNumPlayers(){let t=await Mt.get();return typeof t=="number"?t:0},onNumPlayersChange(t){let e;return Mt.sub(n=>{n!==e&&(e=n,t(n))})},async onNumPlayersChangeNow(t){let e=await this.getNumPlayers();return t(e),Mt.sub(n=>{n!==e&&(e=n,t(n))})}};var k={Common:"Common",Uncommon:"Uncommon",Rare:"Rare",Legendary:"Legendary",Mythic:"Mythical",Divine:"Divine",Celestial:"Celestial"},ae={Single:"Single",Multiple:"Multiple"};var V={Empty:0,DirtPatch:1,SproutFlower:2,SproutVegetable:3,SproutFruit:4,SproutVine:5,StemFlower:6,Trellis:7,Daffodil:11,Tulip:12,Sunflower:13,Lily:14,Starweaver:15,StarweaverPlant:16,AloePlant:17,Aloe:18,Blueberry:21,Banana:22,Strawberry:23,Mango:24,Grape:25,Watermelon:26,Lemon:27,Apple:28,Pepper:31,Tomato:32,BabyCarrot:33,Carrot:34,Pumpkin:35,Corn:36,PalmTreeTop:39,BushyTree:40,Coconut:41,MushroomPlant:42,PassionFruit:43,DragonFruit:44,Lychee:45,Mushroom:46,BurrosTail:47,Cacao:48,Echeveria:49},Oe={Empty:0,Bamboo:1,PalmTree:2,Cactus:3,Tree:4},ie={Empty:0,Daffodil:1,Tulip:2,Sunflower:3,Starweaver:6,Blueberry:11,Banana:12,Strawberry:13,Mango:14,Grape:15,Watermelon:16,Lemon:17,Apple:18,Lily:20,Pepper:21,Tomato:22,Carrot:23,Pumpkin:25,Corn:26,Bamboo:41,Coconut:31,Mushroom:32,PassionFruit:33,DragonFruit:34,Lychee:35,BurrosTail:37,Aloe:39,Echeveria:40,Cactus:42},Et={Empty:0,Coin:1,Shovel:2,Seeds:3,PlanterPot:5,InventoryBag:6,WateringCan:14,Fertilizer:15,RainbowPotion:16,ArrowKeys:41,Touchpad:42};var he={Bee:1,Chicken:2,Bunny:3,Turtle:4,Capybara:5,Cow:6,Pig:7,Butterfly:8,Snail:9,Worm:10,CommonEgg:11,UncommonEgg:12,RareEgg:13,LegendaryEgg:14,MythicalEgg:15,DivineEgg:16,CelestialEgg:17,Squirrel:18,Goat:19,Dragonfly:20,Peacock:30},lt={Wet:1,Chilled:2,Frozen:3,Dawnlit:11,Amberglow:12},ue={SmallRock:11,MediumRock:21,LargeRock:31,WoodPedestal:4,WoodBench:13,WoodBucketPedestal:14,WoodLampPost:23,WoodStool:24,WoodArch:33,WoodBridge:34,WoodOwl:43,WoodGardenBox:44,StonePedestal:6,StoneBench:15,StoneBucketPedestal:16,StoneLampPost:25,StoneColumn:26,StoneArch:35,StoneBridge:36,StoneGnome:45,StoneGardenBox:46,MarblePedestal:8,MarbleBench:17,MarbleBucketPedestal:18,MarbleLampPost:27,MarbleColumn:28,MarbleArch:37,MarbleBridge:38,MarbleBlobling:47,MarbleGardenBox:48,StrawScarecrow:49,MiniFairyCottage:50,MiniFairyForge:40,MiniFairyKeep:60,Birdhouse:63,WoodenWindmill:64,StoneBirdbath:65},$e={Carrot:{seed:{tileRef:ie.Carrot,name:"Carrot Seed",coinPrice:10,creditPrice:7,rarity:k.Common},plant:{tileRef:V.BabyCarrot,name:"Carrot Plant",harvestType:ae.Single,baseTileScale:.7},crop:{tileRef:V.Carrot,name:"Carrot",baseSellPrice:20,baseWeight:.1,baseTileScale:.6,maxScale:3}},Strawberry:{seed:{tileRef:ie.Strawberry,name:"Strawberry Seed",coinPrice:50,creditPrice:21,rarity:k.Common},plant:{tileRef:V.SproutFruit,name:"Strawberry Plant",harvestType:ae.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:70,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:V.Strawberry,name:"Strawberry",baseSellPrice:14,baseWeight:.05,baseTileScale:.25,maxScale:2}},Aloe:{seed:{tileRef:ie.Aloe,name:"Aloe Seed",coinPrice:135,creditPrice:18,rarity:k.Common},plant:{tileRef:V.AloePlant,name:"Aloe Plant",harvestType:ae.Single,baseTileScale:.9},crop:{tileRef:V.Aloe,name:"Aloe",baseSellPrice:310,baseWeight:1.5,baseTileScale:.7,maxScale:2.5}},Blueberry:{seed:{tileRef:ie.Blueberry,name:"Blueberry Seed",coinPrice:400,creditPrice:49,rarity:k.Uncommon},plant:{tileRef:V.SproutFruit,name:"Blueberry Plant",harvestType:ae.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:105,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:V.Blueberry,name:"Blueberry",baseSellPrice:23,baseWeight:.01,baseTileScale:.25,maxScale:2}},Apple:{seed:{tileRef:ie.Apple,name:"Apple Seed",coinPrice:500,creditPrice:67,rarity:k.Uncommon,unavailableSurfaces:["discord"]},plant:{tileRef:Oe.Tree,name:"Apple Tree",harvestType:ae.Multiple,slotOffsets:[{x:.15,y:-1.9,rotation:-90},{x:0,y:-1.5,rotation:-75},{x:.6,y:-1.7,rotation:-60},{x:.3,y:-1.15,rotation:-55},{x:1.05,y:-1.4,rotation:-45},{x:.8,y:-1.2,rotation:-35},{x:.9,y:.6,rotation:-30}],secondsToMature:360*60,baseTileScale:3,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:V.Apple,name:"Apple",baseSellPrice:73,baseWeight:.18,baseTileScale:.5,maxScale:2}},OrangeTulip:{seed:{tileRef:ie.Tulip,name:"Tulip Seed",coinPrice:600,creditPrice:14,rarity:k.Uncommon},plant:{tileRef:V.Tulip,name:"Tulip Plant",harvestType:ae.Single,baseTileScale:.5},crop:{tileRef:V.Tulip,name:"Tulip",baseSellPrice:767,baseWeight:.01,baseTileScale:.5,maxScale:3}},Tomato:{seed:{tileRef:ie.Tomato,name:"Tomato Seed",coinPrice:800,creditPrice:79,rarity:k.Uncommon},plant:{tileRef:V.SproutVine,name:"Tomato Plant",harvestType:ae.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1100,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:V.Tomato,name:"Tomato",baseSellPrice:27,baseWeight:.3,baseTileScale:.33,maxScale:2}},Daffodil:{seed:{tileRef:ie.Daffodil,name:"Daffodil Seed",coinPrice:1e3,creditPrice:19,rarity:k.Rare},plant:{tileRef:V.Daffodil,name:"Daffodil Plant",harvestType:ae.Single,baseTileScale:.5},crop:{tileRef:V.Daffodil,name:"Daffodil",baseSellPrice:1090,baseWeight:.01,baseTileScale:.5,maxScale:3}},Corn:{seed:{tileRef:ie.Corn,name:"Corn Kernel",coinPrice:1300,creditPrice:135,rarity:k.Rare},plant:{tileRef:V.SproutVegetable,name:"Corn Plant",harvestType:ae.Multiple,slotOffsets:[{x:.5,y:.4,rotation:0}],secondsToMature:130,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:V.Corn,name:"Corn",baseSellPrice:36,baseWeight:1.2,baseTileScale:.7,maxScale:2}},Watermelon:{seed:{tileRef:ie.Watermelon,name:"Watermelon Seed",coinPrice:2500,creditPrice:195,rarity:k.Rare},plant:{tileRef:V.Watermelon,name:"Watermelon Plant",harvestType:ae.Single,baseTileScale:.8},crop:{tileRef:V.Watermelon,name:"Watermelon",baseSellPrice:2708,baseWeight:4.5,baseTileScale:.8,maxScale:3}},Pumpkin:{seed:{tileRef:ie.Pumpkin,name:"Pumpkin Seed",coinPrice:3e3,creditPrice:210,rarity:k.Rare},plant:{tileRef:V.Pumpkin,name:"Pumpkin Plant",harvestType:ae.Single,baseTileScale:.8},crop:{tileRef:V.Pumpkin,name:"Pumpkin",baseSellPrice:3700,baseWeight:6,baseTileScale:.8,maxScale:3}},Echeveria:{seed:{tileRef:ie.Echeveria,name:"Echeveria Cutting",coinPrice:4200,creditPrice:113,rarity:k.Legendary},plant:{tileRef:V.Echeveria,name:"Echeveria Plant",harvestType:ae.Single,baseTileScale:.8},crop:{tileRef:V.Echeveria,name:"Echeveria",baseSellPrice:4600,baseWeight:.8,baseTileScale:.8,maxScale:2.75}},Coconut:{seed:{tileRef:ie.Coconut,name:"Coconut Seed",coinPrice:6e3,creditPrice:235,rarity:k.Legendary},plant:{tileRef:Oe.PalmTree,name:"Coconut Tree",harvestType:ae.Multiple,slotOffsets:[{x:.3,y:-2.1,rotation:0},{x:.2,y:-1.9,rotation:51.4},{x:.7,y:-2,rotation:102.9},{x:.25,y:-1.6,rotation:154.3},{x:.5,y:-1.8,rotation:205.7},{x:.8,y:-1.7,rotation:257.1},{x:.55,y:-1.5,rotation:308.6}],secondsToMature:720*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:V.Coconut,name:"Coconut",baseSellPrice:302,baseWeight:5,baseTileScale:.25,maxScale:3}},Banana:{seed:{tileRef:ie.Banana,name:"Banana Seed",coinPrice:7500,creditPrice:199,rarity:k.Legendary,getCanSpawnInGuild:t=>{let e=t.slice(-1),n=parseInt(e,10);return!isNaN(n)&&n%2===0}},plant:{tileRef:Oe.PalmTree,name:"Banana Plant",harvestType:ae.Multiple,slotOffsets:[{x:.2,y:-1.2,rotation:10},{x:.3,y:-1.2,rotation:-10},{x:.4,y:-1.2,rotation:-30},{x:.5,y:-1.2,rotation:-50},{x:.6,y:-1.2,rotation:-70}],secondsToMature:14400,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:V.Banana,name:"Banana",baseSellPrice:1750,baseWeight:.12,baseTileScale:.5,maxScale:1.7}},Lily:{seed:{tileRef:ie.Lily,name:"Lily Seed",coinPrice:2e4,creditPrice:34,rarity:k.Legendary},plant:{tileRef:V.Lily,name:"Lily Plant",harvestType:ae.Single,baseTileScale:.75,nudgeY:.4},crop:{tileRef:V.Lily,name:"Lily",baseSellPrice:20123,baseWeight:.02,baseTileScale:.5,maxScale:2.75}},BurrosTail:{seed:{tileRef:ie.BurrosTail,name:"Burro's Tail Cutting",coinPrice:93e3,creditPrice:338,rarity:k.Legendary},plant:{tileRef:V.Trellis,name:"Burro's Tail Plant",harvestType:ae.Multiple,slotOffsets:[{x:.37,y:.4,rotation:0},{x:.67,y:.63,rotation:0}],secondsToMature:1800,baseTileScale:.8,rotateSlotOffsetsRandomly:!1},crop:{tileRef:V.BurrosTail,name:"Burro's Tail",baseSellPrice:6e3,baseWeight:.4,baseTileScale:.4,maxScale:2.5}},Mushroom:{seed:{tileRef:ie.Mushroom,name:"Mushroom Spore",coinPrice:15e4,creditPrice:249,rarity:k.Mythic},plant:{tileRef:V.MushroomPlant,name:"Mushroom Plant",harvestType:ae.Single,baseTileScale:.8},crop:{tileRef:V.Mushroom,name:"Mushroom",baseSellPrice:16e4,baseWeight:25,baseTileScale:.8,maxScale:3.5}},Cactus:{seed:{tileRef:ie.Cactus,name:"Cactus Seed",coinPrice:25e4,creditPrice:250,rarity:k.Mythic},plant:{tileRef:Oe.Cactus,name:"Cactus Plant",harvestType:ae.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:Oe.Cactus,name:"Cactus",baseSellPrice:261e3,baseWeight:1500,baseTileScale:2.5,maxScale:1.8}},Bamboo:{seed:{tileRef:ie.Bamboo,name:"Bamboo Seed",coinPrice:4e5,creditPrice:300,rarity:k.Mythic},plant:{tileRef:Oe.Bamboo,name:"Bamboo Plant",harvestType:ae.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:Oe.Bamboo,name:"Bamboo Shoot",baseSellPrice:5e5,baseWeight:1,baseTileScale:2.5,maxScale:2}},Grape:{seed:{tileRef:ie.Grape,name:"Grape Seed",coinPrice:85e4,creditPrice:599,rarity:k.Mythic,getCanSpawnInGuild:t=>t.endsWith("1")},plant:{tileRef:V.SproutVine,name:"Grape Plant",harvestType:ae.Multiple,slotOffsets:[{x:.5,y:.5,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:V.Grape,name:"Grape",baseSellPrice:7085,baseWeight:3,baseTileScale:.5,maxScale:2}},Pepper:{seed:{tileRef:ie.Pepper,name:"Pepper Seed",coinPrice:1e6,creditPrice:629,rarity:k.Divine},plant:{tileRef:V.SproutVine,name:"Pepper Plant",harvestType:ae.Multiple,slotOffsets:[{x:.1,y:.1,rotation:0},{x:.9,y:.1,rotation:0},{x:.3,y:.3,rotation:0},{x:.7,y:.3,rotation:0},{x:.5,y:.5,rotation:0},{x:.3,y:.7,rotation:0},{x:.7,y:.7,rotation:0},{x:.1,y:.9,rotation:0},{x:.9,y:.9,rotation:0}],secondsToMature:560,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:V.Pepper,name:"Pepper",baseSellPrice:7220,baseWeight:.5,baseTileScale:.3,maxScale:2}},Lemon:{seed:{tileRef:ie.Lemon,name:"Lemon Seed",coinPrice:2e6,creditPrice:500,rarity:k.Divine,getCanSpawnInGuild:t=>t.endsWith("2")},plant:{tileRef:Oe.Tree,name:"Lemon Tree",harvestType:ae.Multiple,slotOffsets:[{x:0,y:-1,rotation:85},{x:.9,y:-1.1,rotation:195},{x:.2,y:-.68,rotation:340},{x:.7,y:-.7,rotation:280},{x:.51,y:-1,rotation:0},{x:.45,y:-1.3,rotation:280}],secondsToMature:720*60,baseTileScale:2.3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:V.Lemon,name:"Lemon",baseSellPrice:1e4,baseWeight:.5,baseTileScale:.25,maxScale:3}},PassionFruit:{seed:{tileRef:ie.PassionFruit,name:"Passion Fruit Seed",coinPrice:275e4,creditPrice:679,rarity:k.Divine},plant:{tileRef:V.SproutVine,name:"Passion Fruit Plant",harvestType:ae.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1440*60,baseTileScale:1.1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:V.PassionFruit,name:"Passion Fruit",baseSellPrice:24500,baseWeight:9.5,baseTileScale:.35,maxScale:2}},DragonFruit:{seed:{tileRef:ie.DragonFruit,name:"Dragon Fruit Seed",coinPrice:5e6,creditPrice:715,rarity:k.Divine},plant:{tileRef:V.PalmTreeTop,name:"Dragon Fruit Plant",harvestType:ae.Multiple,slotOffsets:[{x:.2,y:.1,rotation:0},{x:.1,y:.45,rotation:51.4},{x:.86,y:.2,rotation:102.9},{x:.25,y:.8,rotation:154.3},{x:.5,y:.4,rotation:205.7},{x:.9,y:.6,rotation:257.1},{x:.6,y:.7,rotation:308.6}],secondsToMature:600,baseTileScale:1.6,rotateSlotOffsetsRandomly:!0},crop:{tileRef:V.DragonFruit,name:"Dragon Fruit",baseSellPrice:24500,baseWeight:8.4,baseTileScale:.4,maxScale:2}},Lychee:{seed:{tileRef:ie.Lychee,name:"Lychee Pit",coinPrice:25e6,creditPrice:819,rarity:k.Divine,getCanSpawnInGuild:t=>t.endsWith("2")},plant:{tileRef:V.BushyTree,name:"Lychee Plant",harvestType:ae.Multiple,slotOffsets:[{x:.1,y:.4,rotation:85},{x:.8,y:.3,rotation:195},{x:.2,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.4,rotation:0},{x:.3,y:.2,rotation:280}],secondsToMature:1440*60,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:V.Lychee,name:"Lychee Fruit",baseSellPrice:5e4,baseWeight:9,baseTileScale:.2,maxScale:2}},Sunflower:{seed:{tileRef:ie.Sunflower,name:"Sunflower Seed",coinPrice:1e8,creditPrice:900,rarity:k.Divine},plant:{tileRef:V.StemFlower,name:"Sunflower Plant",harvestType:ae.Multiple,slotOffsets:[{x:.51,y:-.1,rotation:0}],secondsToMature:1440*60,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",baseTileScale:.8,nudgeY:.15},crop:{tileRef:V.Sunflower,name:"Sunflower",baseSellPrice:75e4,baseWeight:10,baseTileScale:.5,maxScale:2.5}},Starweaver:{seed:{tileRef:ie.Starweaver,name:"Starweaver Pod",coinPrice:1e9,creditPrice:1e3,rarity:k.Celestial},plant:{tileRef:V.StarweaverPlant,name:"Starweaver Plant",harvestType:ae.Multiple,slotOffsets:[{x:.5,y:-.158,rotation:0}],secondsToMature:1440*60,baseTileScale:1.5,rotateSlotOffsetsRandomly:!1,nudgeY:.25},crop:{tileRef:V.Starweaver,name:"Starweaver Fruit",baseSellPrice:1e7,baseWeight:10,baseTileScale:.6,maxScale:2}}},cs={Gold:{name:"Gold",baseChance:.01,coinMultiplier:25},Rainbow:{name:"Rainbow",baseChance:.001,coinMultiplier:50},Wet:{name:"Wet",baseChance:0,coinMultiplier:2,tileRef:lt.Wet},Chilled:{name:"Chilled",baseChance:0,coinMultiplier:2,tileRef:lt.Chilled},Frozen:{name:"Frozen",baseChance:0,coinMultiplier:10,tileRef:lt.Frozen},Dawnlit:{name:"Dawnlit",baseChance:0,coinMultiplier:2,tileRef:lt.Dawnlit},Ambershine:{name:"Ambershine",baseChance:0,coinMultiplier:5,tileRef:lt.Ambershine}},Jt={CommonEgg:{tileRef:he.CommonEgg,name:"Common Egg",coinPrice:1e5,creditPrice:19,rarity:k.Common,initialTileScale:.3,baseTileScale:.8,secondsToHatch:600,faunaSpawnWeights:{Worm:60,Snail:35,Bee:5}},UncommonEgg:{tileRef:he.UncommonEgg,name:"Uncommon Egg",coinPrice:1e6,creditPrice:48,rarity:k.Uncommon,initialTileScale:.3,baseTileScale:.8,secondsToHatch:3600,faunaSpawnWeights:{Chicken:65,Bunny:25,Dragonfly:10}},RareEgg:{tileRef:he.RareEgg,name:"Rare Egg",coinPrice:1e7,creditPrice:99,rarity:k.Rare,initialTileScale:.3,baseTileScale:.8,secondsToHatch:21600,faunaSpawnWeights:{Pig:90,Cow:10}},LegendaryEgg:{tileRef:he.LegendaryEgg,name:"Legendary Egg",coinPrice:1e8,creditPrice:249,rarity:k.Legendary,initialTileScale:.3,baseTileScale:.8,secondsToHatch:43200,faunaSpawnWeights:{Squirrel:60,Turtle:30,Goat:10}},MythicalEgg:{tileRef:he.MythicalEgg,name:"Mythical Egg",coinPrice:1e9,creditPrice:599,rarity:k.Mythic,initialTileScale:.3,baseTileScale:.8,secondsToHatch:86400,faunaSpawnWeights:{Butterfly:75,Capybara:5,Peacock:20}}},ct={Worm:{tileRef:he.Worm,name:"Worm",description:"",coinsToFullyReplenishHunger:500,innateAbilityWeights:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.1,moveProbability:.1,hoursToMature:12,rarity:k.Common,tileTransformOrigin:"bottom",nudgeY:.25,diet:["Carrot","Strawberry","Aloe","Tomato","Apple"]},Snail:{tileRef:he.Snail,name:"Snail",description:"",coinsToFullyReplenishHunger:1e3,innateAbilityWeights:{CoinFinderI:100},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.15,moveProbability:.01,hoursToMature:12,rarity:k.Common,tileTransformOrigin:"bottom",nudgeY:-.25,diet:["Blueberry","Tomato","Corn","Daffodil"]},Bee:{tileRef:he.Bee,name:"Bee",coinsToFullyReplenishHunger:1500,innateAbilityWeights:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,maturitySellPrice:3e4,matureWeight:.2,moveProbability:.5,hoursToMature:12,rarity:k.Common,diet:["Strawberry","Blueberry","OrangeTulip","Daffodil","Lily"]},Chicken:{tileRef:he.Chicken,name:"Chicken",coinsToFullyReplenishHunger:3e3,innateAbilityWeights:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,maturitySellPrice:5e4,matureWeight:3,moveProbability:.2,hoursToMature:24,rarity:k.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Aloe","Corn","Watermelon","Pumpkin"]},Bunny:{tileRef:he.Bunny,name:"Bunny",coinsToFullyReplenishHunger:750,innateAbilityWeights:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,maturitySellPrice:75e3,matureWeight:2,moveProbability:.3,hoursToMature:24,rarity:k.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Carrot","Strawberry","Blueberry","Echeveria"]},Dragonfly:{tileRef:he.Dragonfly,name:"Dragonfly",coinsToFullyReplenishHunger:250,innateAbilityWeights:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,maturitySellPrice:15e4,matureWeight:.2,moveProbability:.7,hoursToMature:24,rarity:k.Uncommon,tileTransformOrigin:"center",diet:["Apple","OrangeTulip","Echeveria"]},Pig:{tileRef:he.Pig,name:"Pig",coinsToFullyReplenishHunger:5e4,innateAbilityWeights:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,maturitySellPrice:5e5,matureWeight:200,moveProbability:.2,hoursToMature:72,rarity:k.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","Pumpkin","Mushroom","Bamboo"]},Cow:{tileRef:he.Cow,name:"Cow",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,maturitySellPrice:1e6,matureWeight:600,moveProbability:.1,hoursToMature:72,rarity:k.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Coconut","Banana","BurrosTail","Mushroom"]},Squirrel:{tileRef:he.Squirrel,name:"Squirrel",coinsToFullyReplenishHunger:15e3,innateAbilityWeights:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,maturitySellPrice:5e6,matureWeight:.5,moveProbability:.4,hoursToMature:100,rarity:k.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Banana","Grape"]},Turtle:{tileRef:he.Turtle,name:"Turtle",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,maturitySellPrice:1e7,matureWeight:150,moveProbability:.05,hoursToMature:100,rarity:k.Legendary,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","BurrosTail","Bamboo","Pepper"]},Goat:{tileRef:he.Goat,name:"Goat",coinsToFullyReplenishHunger:2e4,innateAbilityWeights:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,maturitySellPrice:2e7,matureWeight:100,moveProbability:.2,hoursToMature:100,rarity:k.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Coconut","Cactus","Pepper"]},Butterfly:{tileRef:he.Butterfly,name:"Butterfly",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,maturitySellPrice:5e7,matureWeight:.2,moveProbability:.6,hoursToMature:144,rarity:k.Mythic,tileTransformOrigin:"center",diet:["Daffodil","Lily","Grape","Lemon","Sunflower"]},Capybara:{tileRef:he.Capybara,name:"Capybara",coinsToFullyReplenishHunger:15e4,innateAbilityWeights:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,maturitySellPrice:2e8,matureWeight:50,moveProbability:.2,hoursToMature:144,rarity:k.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Lemon","PassionFruit","DragonFruit","Lychee"]},Peacock:{tileRef:he.Peacock,name:"Peacock",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,maturitySellPrice:1e8,matureWeight:5,moveProbability:.2,hoursToMature:144,rarity:k.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Cactus","Sunflower","Lychee"]}},Rn={ProduceScaleBoost:{name:"Crop Size Boost I",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.3,baseParameters:{cropScaleIncreasePercentage:6}},ProduceScaleBoostII:{name:"Crop Size Boost II",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.4,baseParameters:{cropScaleIncreasePercentage:10}},DoubleHarvest:{name:"Double Harvest",description:"Chance to duplicate harvested crops",trigger:"harvest",baseProbability:5,baseParameters:{}},ProduceEater:{name:"Crop Eater",description:"Harvests non-mutated crops and sells them",trigger:"continuous",baseProbability:60,baseParameters:{cropSellPriceIncreasePercentage:150}},SellBoostI:{name:"Sell Boost I",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:10,baseParameters:{cropSellPriceIncreasePercentage:20}},SellBoostII:{name:"Sell Boost II",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:12,baseParameters:{cropSellPriceIncreasePercentage:30}},SellBoostIII:{name:"Sell Boost III",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:14,baseParameters:{cropSellPriceIncreasePercentage:40}},SellBoostIV:{name:"Sell Boost IV",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:16,baseParameters:{cropSellPriceIncreasePercentage:50}},ProduceRefund:{name:"Crop Refund",description:"Chance to get crops back when selling",trigger:"sellAllCrops",baseProbability:20,baseParameters:{}},PlantGrowthBoost:{name:"Plant Growth Boost I",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:24,baseParameters:{plantGrowthReductionMinutes:3}},PlantGrowthBoostII:{name:"Plant Growth Boost II",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:27,baseParameters:{plantGrowthReductionMinutes:5}},ProduceMutationBoost:{name:"Crop Mutation Boost I",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:10}},ProduceMutationBoostII:{name:"Crop Mutation Boost II",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:15}},PetMutationBoost:{name:"Pet Mutation Boost I",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:7}},PetMutationBoostII:{name:"Pet Mutation Boost II",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:10}},GoldGranter:{name:"Gold Granter",description:"Grants the Gold mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Gold"]}},RainbowGranter:{name:"Rainbow Granter",description:"Grants the Rainbow mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Rainbow"]}},EggGrowthBoost:{name:"Egg Growth Boost I",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:21,baseParameters:{eggGrowthTimeReductionMinutes:7}},EggGrowthBoostII:{name:"Egg Growth Boost II",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:24,baseParameters:{eggGrowthTimeReductionMinutes:10}},EggGrowthBoostIII:{name:"Egg Growth Boost III",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:27,baseParameters:{eggGrowthTimeReductionMinutes:13}},PetAgeBoost:{name:"Hatch XP Boost I",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:50,baseParameters:{bonusXp:8e3}},PetAgeBoostII:{name:"Hatch XP Boost II",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:60,baseParameters:{bonusXp:12e3}},PetHatchSizeBoost:{name:"Max Strength Boost I",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:12,baseParameters:{maxStrengthIncreasePercentage:2.4}},PetHatchSizeBoostII:{name:"Max Strength Boost II",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:14,baseParameters:{maxStrengthIncreasePercentage:3.5}},PetXpBoost:{name:"XP Boost I",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:30,baseParameters:{bonusXp:300}},PetXpBoostII:{name:"XP Boost II",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:35,baseParameters:{bonusXp:400}},HungerRestore:{name:"Hunger Restore I",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:12,baseParameters:{hungerRestorePercentage:30}},HungerRestoreII:{name:"Hunger Restore II",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:14,baseParameters:{hungerRestorePercentage:35}},HungerBoost:{name:"Hunger Boost I",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:12}},HungerBoostII:{name:"Hunger Boost II",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:16}},PetRefund:{name:"Pet Refund I",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:5,baseParameters:{}},PetRefundII:{name:"Pet Refund II",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:7,baseParameters:{}},Copycat:{name:"Copycat",description:"Chance to copy the ability of another active pet",trigger:"continuous",baseProbability:1,baseParameters:{}},CoinFinderI:{name:"Coin Finder I",description:"Finds coins in your garden",trigger:"continuous",baseProbability:35,baseParameters:{baseMaxCoinsFindable:12e4}},CoinFinderII:{name:"Coin Finder II",description:"Finds coins in your garden",trigger:"continuous",baseProbability:13,baseParameters:{baseMaxCoinsFindable:12e5}},CoinFinderIII:{name:"Coin Finder III",description:"Finds coins in your garden",trigger:"continuous",baseProbability:6,baseParameters:{baseMaxCoinsFindable:1e7}},SeedFinderI:{name:"Seed Finder I",description:"Finds common and uncommon seeds in your garden",trigger:"continuous",baseProbability:40,baseParameters:{}},SeedFinderII:{name:"Seed Finder II",description:"Finds rare and legendary seeds in your garden",trigger:"continuous",baseProbability:16,baseParameters:{}},SeedFinderIII:{name:"Seed Finder III",description:"Finds mythical seeds in your garden",trigger:"continuous",baseProbability:9,baseParameters:{}},SeedFinderIV:{name:"Seed Finder IV",description:"Finds divine and celestial seeds in your garden",trigger:"continuous",baseProbability:.01,baseParameters:{}}},Xt={WateringCan:{tileRef:Et.WateringCan,name:"Watering Can",coinPrice:5e3,creditPrice:2,rarity:k.Common,description:"Speeds up growth of plant by 5 minutes. SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.6,maxInventoryQuantity:99},PlanterPot:{tileRef:Et.PlanterPot,name:"Planter Pot",coinPrice:25e3,creditPrice:5,rarity:k.Common,description:"Extract a plant to your inventory (can be replanted). SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.8},Shovel:{tileRef:Et.Shovel,name:"Shovel",coinPrice:1e6,creditPrice:100,rarity:k.Uncommon,description:"Remove plants from your garden. UNLIMITED USES.",isOneTimePurchase:!0,baseTileScale:.7},RainbowPotion:{tileRef:Et.RainbowPotion,name:"Rainbow Potion",coinPrice:1/0,creditPrice:1/0,rarity:k.Celestial,description:"Adds the Rainbow mutation to a crop in your garden. SINGLE USE.",isOneTimePurchase:!0,baseTileScale:1}},Qt={SmallRock:{tileRef:ue.SmallRock,name:"Small Garden Rock",coinPrice:1e3,creditPrice:2,rarity:k.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MediumRock:{tileRef:ue.MediumRock,name:"Medium Garden Rock",coinPrice:2500,creditPrice:5,rarity:k.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.21},LargeRock:{tileRef:ue.LargeRock,name:"Large Garden Rock",coinPrice:5e3,creditPrice:10,rarity:k.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.1},WoodBench:{tileRef:ue.WoodBench,name:"Wood Bench",coinPrice:1e4,creditPrice:15,rarity:k.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},WoodArch:{tileRef:ue.WoodArch,name:"Wood Arch",coinPrice:2e4,creditPrice:25,rarity:k.Common,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},WoodBridge:{tileRef:ue.WoodBridge,name:"Wood Bridge",coinPrice:4e4,creditPrice:35,rarity:k.Common,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},WoodLampPost:{tileRef:ue.WoodLampPost,name:"Wood Lamp Post",coinPrice:8e4,creditPrice:49,rarity:k.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodOwl:{tileRef:ue.WoodOwl,name:"Wood Owl",coinPrice:9e4,creditPrice:59,rarity:k.Common,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},WoodBirdhouse:{tileRef:ue.Birdhouse,name:"Wood Birdhouse",coinPrice:1e5,creditPrice:69,rarity:k.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneBench:{tileRef:ue.StoneBench,name:"Stone Bench",coinPrice:1e6,creditPrice:75,rarity:k.Uncommon,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},StoneArch:{tileRef:ue.StoneArch,name:"Stone Arch",coinPrice:4e6,creditPrice:124,rarity:k.Uncommon,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},StoneBridge:{tileRef:ue.StoneBridge,name:"Stone Bridge",coinPrice:5e6,creditPrice:179,rarity:k.Uncommon,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},StoneLampPost:{tileRef:ue.StoneLampPost,name:"Stone Lamp Post",coinPrice:8e6,creditPrice:199,rarity:k.Uncommon,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneGnome:{tileRef:ue.StoneGnome,name:"Stone Gnome",coinPrice:9e6,creditPrice:219,rarity:k.Uncommon,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},StoneBirdbath:{tileRef:ue.StoneBirdbath,name:"Stone Birdbath",coinPrice:1e7,creditPrice:249,rarity:k.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.46},MarbleBench:{tileRef:ue.MarbleBench,name:"Marble Bench",coinPrice:75e6,creditPrice:349,rarity:k.Rare,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},MarbleArch:{tileRef:ue.MarbleArch,name:"Marble Arch",coinPrice:1e8,creditPrice:399,rarity:k.Rare,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},MarbleBridge:{tileRef:ue.MarbleBridge,name:"Marble Bridge",coinPrice:15e7,creditPrice:429,rarity:k.Rare,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},MarbleLampPost:{tileRef:ue.MarbleLampPost,name:"Marble Lamp Post",coinPrice:2e8,creditPrice:449,rarity:k.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},MarbleBlobling:{tileRef:ue.MarbleBlobling,name:"Marble Blobling",coinPrice:3e8,creditPrice:499,rarity:k.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.56},MiniFairyCottage:{tileRef:ue.MiniFairyCottage,name:"Mini Fairy Cottage",coinPrice:5e8,creditPrice:549,rarity:k.Rare,baseTileScale:1.1,isOneTimePurchase:!1,nudgeY:-.37},StrawScarecrow:{tileRef:ue.StrawScarecrow,name:"Straw Scarecrow",coinPrice:1e9,creditPrice:599,rarity:k.Legendary,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.65},MiniFairyForge:{tileRef:ue.MiniFairyForge,name:"Mini Fairy Forge",coinPrice:5e9,creditPrice:979,rarity:k.Legendary,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyKeep:{tileRef:ue.MiniFairyKeep,name:"Mini Fairy Keep",coinPrice:25e9,creditPrice:1249,rarity:k.Mythic,baseTileScale:1.05,isOneTimePurchase:!1,nudgeY:-.33}};var Zt=new Map;function Wr(t){try{return tt(new RegExp("^"+t+"$"))}catch{return[]}}function Fr(t){if(t&&typeof t.read=="function")return"read";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="write"&&e!=="onMount"&&e!=="toString"){let r=n.length;if(r===1||r===2)return e}}throw new Error("Impossible de localiser la fonction read() de l'atom")}function qr(t){return Zt.get(t)||null}async function Br(t){!t?.closeAction||!t?.openAction||(await t.closeAction(),await new Promise(e=>setTimeout(e,0)),await t.openAction())}async function Or(t){let e=t.label,n=Zt.get(e);if(n?.installed)return n;let r=Wr(t.label);if(!r.length)throw new Error(`${t.label} introuvable`);let a=n??{config:t,enabled:!1,payload:null,patched:new Map,installed:!1},s=null;t.gate?.label&&(s=de(t.gate.label));for(let i of r){let o=Fr(i),u=i[o];i[o]=l=>{try{s&&l(s)}catch{}for(let T of t.extraDeps||[])try{let C=de(T);C&&l(C)}catch{}let p=u(l);return!a.enabled||a.payload==null?p:t.merge?t.merge(p,a.payload):a.payload},a.patched.set(i,{readKey:o,orig:u})}return s&&t.gate?.autoDisableOnClose&&(a.unsubGate=await Je(s,async()=>{let i;try{i=await Pe(s)}catch{i=null}!(t.gate?.isOpen?t.gate.isOpen(i):!!i)&&a.enabled&&(a.enabled=!1)})),a.installed=!0,Zt.set(e,a),a}async function en(t,e,n){await Ee();let r=await Or(t);r.payload=e,r.enabled=!0,n?.merge&&!t.merge&&(t.merge=(a,s)=>s),n?.openGate&&t.gate?.openAction&&await t.gate.openAction(),r.autoTimer&&(clearTimeout(r.autoTimer),r.autoTimer=null),n?.autoRestoreMs&&n.autoRestoreMs>0&&(r.autoTimer=setTimeout(()=>{Ln(t.label)},n.autoRestoreMs))}async function Ln(t){let e=qr(t);e&&(e.enabled=!1,e.payload=null,e.autoTimer&&(clearTimeout(e.autoTimer),e.autoTimer=null),await Br(e.config.gate))}var Ve={activeModal:"activeModalAtom",inventory:"myInventoryAtom",myData:"myDataAtom"};async function tn(){let t=de(Ve.activeModal);t&&await Te(t,"inventory")}async function dt(){let t=de(Ve.activeModal);t&&await Te(t,null)}function Hn(t){return t==="inventory"}var Dr={label:Ve.inventory,merge:(t,e)=>e,gate:{label:Ve.activeModal,isOpen:Hn,openAction:tn,closeAction:dt,autoDisableOnClose:!0}},Gr={label:Ve.myData,merge:(t,e)=>({...t&&typeof t=="object"?t:{},inventory:e}),gate:{label:Ve.activeModal,isOpen:Hn,openAction:tn,closeAction:dt,autoDisableOnClose:!0}};async function ut(t,e){let n=e?.open!==!1,r;try{let s=de(Ve.inventory);s&&(r=await Pe(s).catch(()=>{}))}catch{}try{console.log("[fakeInventory] \u25B6 re\xE7u \u2192",t)}catch{}try{console.log("[fakeInventory] \u25B6 moi   \u2192",r)}catch{}let a=t;try{await en(Gr,a,{openGate:!1,autoRestoreMs:e?.autoRestoreMs})}catch{}await en(Dr,a,{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await tn()}var zn="myValidatedSelectedItemIndexAtom",Un="qws:pets:overrides:v1",Yn="qws:pets:ui:v1",Jn="qws:pets:teams:v1",Xn="qws:pets:teamSearch:v1",_n={enabled:!1,thresholdPct:10,crops:{}},nn={selectedPetId:null},Ue=Rn??{};function Qn(t){let e=String(t??""),n=typeof Ue?.[e]?.name=="string"&&Ue[e].name.trim()?Ue[e].name:e;return String(n)}function Zn(t){let e=String(t??""),n=typeof Ue?.[e]?.name=="string"&&Ue[e].name.trim()?Ue[e].name:e;return String(n).replace(/(?:\s+|-)?(?:I|II|III|IV|V|VI|VII|VIII|IX|X)\s*$/,"").trim()}function Nn(t){let e=String(t||"").trim(),n=e.match(/^(ab|sp):\s*(.*)$/i);return n?{mode:n[1].toLowerCase()==="ab"?"ability":"species",value:(n[2]||"").trim()}:{mode:"text",value:e}}async function Wn(t){await De();let e=String(t||"").toLowerCase().trim().replace(/(?:\s+|-)?(?:i|ii|iii|iv|v|vi|vii|viii|ix|x)\s*$/i,""),n=new Set;if(!e)return n;for(let r of We){let a=Array.isArray(r.abilities)?r.abilities:[];for(let s of a)Zn(s).toLowerCase()===e&&n.add(s)}return n}function rn(t,e){return e?Le(t.id).includes(e)||Le(t.petSpecies).includes(e)||Le(t.name).includes(e)||Array.isArray(t.abilities)&&t.abilities.some(n=>Le(n).includes(e)||Le(Qn(n)).includes(e))||Array.isArray(t.mutations)&&t.mutations.some(n=>Le(n).includes(e)):!0}async function Fn(){try{let t=await Ke.get();return(Array.isArray(t?.favoritedItemIds)?t.favoritedItemIds:[]).slice()}catch{return[]}}function jr(t){if(!t||ct[t])return t;let e=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return ct[e]?e:t}function qn(t){return{id:t.id,itemType:"Pet",petSpecies:jr(t.petSpecies),name:t.name??null,xp:t.xp,hunger:t.hunger,mutations:Array.isArray(t.mutations)?t.mutations.slice():[],targetScale:t.targetScale,abilities:Array.isArray(t.abilities)?t.abilities.slice():[]}}async function cn(){let t=de("setSelectedIndexToEndAtom");await Te(t,"null");try{await j.setSelectedItem(null)}catch{}try{await j.dropObject()}catch{}}async function Bn(t=2e4){let e=de(zn);if(!e)return null;await cn();let n=performance.now();for(;performance.now()-n<t;){try{let r=await Pe(e);if(typeof r=="number"&&Number.isInteger(r)&&r>=0)return r}catch{}await new Promise(r=>setTimeout(r,100))}return null}function mt(){try{let t=localStorage.getItem(Un);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch{return{}}}function At(t){try{localStorage.setItem(Un,JSON.stringify(t))}catch{}}function an(){try{let t=localStorage.getItem(Yn);if(!t)return{...nn};let e=JSON.parse(t);return{...nn,...e||{}}}catch{return{...nn}}}function Kr(t){try{localStorage.setItem(Yn,JSON.stringify(t))}catch{}}function er(){try{let t=localStorage.getItem(Jn);if(!t)return[];let e=JSON.parse(t);return Array.isArray(e)?e.map(n=>({id:String(n?.id||""),name:String(n?.name||"Team"),slots:Array.isArray(n?.slots)?n.slots.slice(0,3).map(r=>r?String(r):null):[null,null,null]})).filter(n=>n.id):[]}catch{return[]}}function Xe(t){try{localStorage.setItem(Jn,JSON.stringify(t))}catch{}}function On(){try{return crypto.randomUUID()}catch{return`t_${Date.now().toString(36)}_${Math.random().toString(16).slice(2)}`}}var yt=er(),$r=new Set;function Vr(){let t=yt.slice();$r.forEach(e=>{try{e(t)}catch{}})}function zr(){try{let t=localStorage.getItem(Xn),e=t?JSON.parse(t):{};return e&&typeof e=="object"?e:{}}catch{return{}}}function Ur(t){try{localStorage.setItem(Xn,JSON.stringify(t))}catch{}}var kt=zr(),dn=new Set;function Yr(t){let e=kt[t]||"";dn.forEach(n=>{try{n(t,e)}catch{}})}function Jr(t){let r=ct?.[t]?.coinsToFullyReplenishHunger;return typeof r=="number"&&Number.isFinite(r)&&r>0?r:3e3}function Xr(t){return Math.max(0,Math.min(100,t))}function Qr(t){let n=ct?.[t],r=n?.diet??n?.compatibleCrops??n?.crops??[];return(Array.isArray(r)?r:[]).filter(s=>typeof s=="string"&&s.length>0)}function ze(t){let e=t??_n;return{enabled:!!e.enabled,thresholdPct:Math.min(100,Math.max(1,Number(e.thresholdPct)||_n.thresholdPct)),crops:{...e.crops||{}}}}async function Zr(t){try{let e=await j.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===String(t))??null}catch{return null}}var gt=[],Rt=new Map,un=null;function ea(t){try{un?.(t)}catch{}}function ta(t,e){let n=Array.isArray(e)?e:[];for(let r of n){let a=String(r?.species||"");if(a&&t.has(a))return r}return null}async function na(t){let e=String(t?.slot?.id||"");if(!e)return;let n=Y.getOverride(e);if(!n.enabled){Rt.set(e,!1);return}let r=Y.getHungerPctFor(t),a=Math.max(1,Math.min(100,n.thresholdPct|0||10)),s=Rt.get(e)===!0,i=r<a;if(i&&!s){let o;try{o=await Y.getPetAllowedCrops(e)}catch{let T=String(t?.slot?.petSpecies||"");o=new Set(Y.getCompatibleCropsForSpecies(T))}let u=Array.from(o),l=null,p=!1;try{let[T,C]=await Promise.all([j.getCropInventoryState(),j.getFavoriteIds?.()??[]]),M=Array.isArray(T)?T:[],b=new Set(Array.isArray(C)?C:[]),w=M.filter(f=>!b.has(String(f?.id)));if(l=ta(o,w),l?.id)try{j.feedPet&&await j.feedPet(e,l.id)}catch{}}catch{}ea({pet:t,petId:e,species:String(t?.slot?.petSpecies||""),hungerPct:r,thresholdPct:a,allowedCrops:u,chosenItem:l,didUnfavorite:p})}Rt.set(e,i)}async function pt(){let t=Array.isArray(gt)?gt:[];for(let e of t)try{await na(e)}catch{}}var Qe=null,Lt=[],We=[],mn=new Set,Dn=null,Gn=null,sn=null,on=null,Le=t=>(t??"").toLowerCase(),tr=t=>typeof t=="string"?t:null,Ht=t=>Number.isFinite(t)?t:0,_t=t=>Array.isArray(t)?t.filter(e=>typeof e=="string"):[];function Nt(t){if(!t||t.itemType!=="Pet")return null;let e=Le(t.id);return e?{id:e,itemType:"Pet",petSpecies:Le(t.petSpecies??t.data?.petSpecies),name:tr(t.name??t.data?.name??null),xp:Ht(t.xp??t.data?.xp),hunger:Ht(t.hunger??t.data?.hunger),mutations:_t(t.mutations??t.data?.mutations),targetScale:Number.isFinite(t.targetScale??t.data?.targetScale)?Number(t.targetScale??t.data?.targetScale):void 0,abilities:_t(t.abilities??t.data?.abilities)}:null}function nr(t){let e=t?.slot;if(!e||typeof e!="object")return null;let n=Le(e.id);return n?{id:n,itemType:"Pet",petSpecies:Le(e.petSpecies),name:tr(e.name??null),xp:Ht(e.xp),hunger:Ht(e.hunger),mutations:_t(e.mutations),targetScale:Number.isFinite(e.targetScale)?Number(e.targetScale):void 0,abilities:_t(e.abilities)}:null}function rr(t){return JSON.stringify({id:t.id,itemType:"Pet",petSpecies:t.petSpecies,name:t.name??null,mutations:Array.isArray(t.mutations)?t.mutations:[],targetScale:Number.isFinite(t.targetScale)?t.targetScale:null,abilities:Array.isArray(t.abilities)?t.abilities:[]})}function jn(t){let e=new Map,n=Array.isArray(t?.items)?t.items:Array.isArray(t)?t:[];for(let r of n){let a=Nt(r);a&&e.set(a.id,rr(a))}return e}function Kn(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=nr(r);a&&e.set(a.id,rr(a))}return e}function $n(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}function ln(){let t=new Map,e=Array.isArray(Qe?.items)?Qe.items:Array.isArray(Qe)?Qe:[];for(let a of e){let s=Nt(a);s&&s.id&&t.set(s.id,s)}let n=Array.isArray(Lt)?Lt:[];for(let a of n){let s=nr(a);s&&s.id&&t.set(s.id,s)}We=Array.from(t.values());let r=We.slice();mn.forEach(a=>{try{a(r)}catch{}})}async function De(){if(!Dn){let t=await Ke.subNow(e=>{let n=jn(e);$n(sn,n)||(sn=n,Qe=e,ln())});Dn=()=>{try{t()}catch{}}}if(!Gn){let t=await Ne.subNow(e=>{let n=Kn(e);$n(on,n)||(on=n,Lt=Array.isArray(e)?e:[],ln())});Gn=()=>{try{t()}catch{}}}if(!We.length)try{let[t,e]=await Promise.all([Ke.get(),Ne.get()]);sn=jn(t),on=Kn(e),Qe=t,Lt=Array.isArray(e)?e:[],ln()}catch{}}var Y={getPets(){return j.getPets()},onPetsChange(t){return j.onPetsChange(t)},onPetsChangeNow(t){return j.onPetsChangeNow(t)},async getPetById(t){await De();let e=String(t||"");return e?We.find(n=>n.id===e)??null:null},getAbilityName(t){return Qn(t)},getAbilityNameWithoutLevel(t){return Zn(t)},getAbilityInfo(t){let e=String(t??""),n=Ue?.[e];return n?{id:e,...n}:null},getCompatibleCropsFor(t){return Qr(t)},getCompatibleCropsForSpecies(t){return this.getCompatibleCropsFor(t)},getMaxHungerForSpecies(t){return Jr(t)},getHungerPctFor(t){let e=Number(t?.slot?.hunger)||0,n=String(t?.slot?.petSpecies||""),r=this.getMaxHungerForSpecies(n),a=e/r*100;return+Xr(a).toFixed(1)},getOverride(t){let e=mt();return ze(e[t])},setOverride(t,e){let n=mt(),r=ze(n[t]),a={enabled:e.enabled??r.enabled,thresholdPct:Number.isFinite(e.thresholdPct)?Math.min(100,Math.max(1,Number(e.thresholdPct))):r.thresholdPct,crops:{...r.crops,...e.crops||{}}};return n[t]=a,At(n),pt(),a},updateOverride(t,e){let n=mt(),r=ze(n[t]),a=ze(e(r));return n[t]=a,At(n),pt(),a},resetOverride(t){let e=mt();return e[t]=ze(void 0),At(e),pt(),e[t]},ensureCropEntry(t,e){let n=mt(),r=ze(n[t]);return r.crops[e]||(r.crops[e]={allowed:!0},n[t]=r,At(n),pt()),r.crops[e]},setCropRule(t,e,n){return this.updateOverride(t,r=>{let a=ze(r),s=a.crops[e]??{allowed:!0};return a.crops[e]={allowed:n.allowed??s.allowed},a})},async chooseSlotPet(t,e,n){let r=Math.max(0,Math.min(2,Math.floor(e||0))),a=this.getTeamById(t);if(!a)return null;let s=new Set;a.slots.forEach((T,C)=>{C!==r&&T&&s.add(String(T))});let i=n&&n.trim().length?await this.buildFilteredInventoryByQuery(n,{excludeIds:s}):await this.buildFilteredInventoryForTeam(t,{excludeIds:s});console.log("payload: ",i);let o=Array.isArray(i?.items)?i.items:[];if(!o.length){try{console.warn("[Pets] chooseSlotPet: no items match current filter.")}catch{}return null}await ut(i,{open:!0});let u=await Bn(2e4);if(await dt(),u==null||u<0||u>=o.length){try{console.log("[Pets] chooseSlotPet: selection canceled or timed out.")}catch{}return null}let l=Nt(o[u]);if(!l)return null;let p=a.slots.slice(0,3);p[r]=String(l.id),this.saveTeam({id:a.id,slots:p});try{await cn()}catch{}return l},async pickPetViaFakeInventory(t){let e=await this.buildFilteredInventoryByQuery(t||""),n=Array.isArray(e?.items)?e.items:[];if(!n.length)return null;await ut(e,{open:!0});let r=await Bn(2e4);await dt();let a=de(zn);return r==null||r<0||r>=n.length?null:(await cn(),Nt(n[r]))},getPetAutofeedEnabled(t){return this.getOverride(t).enabled},async setPetAutofeedEnabled(t,e){return this.setOverride(t,{enabled:!!e})},getPetAutofeedThresholdPct(t){return this.getOverride(t).thresholdPct},async setPetAutofeedThresholdPct(t,e){let n=Math.min(100,Math.max(1,Math.floor(Number(e)||10)));return this.setOverride(t,{thresholdPct:n})},async getPetAllowedCrops(t){let e=this.getOverride(t),r=(await Zr(t))?.slot?.petSpecies||"",a=this.getCompatibleCropsFor(r),s=new Set;for(let i of a){let o=e.crops[i];(!o||o.allowed)&&s.add(i)}return s},async setPetAllowedCrop(t,e,n){return this.setCropRule(t,e,{allowed:!!n})},buildCompatibleCropRows(t){let e=t?.slot?.petSpecies??"",n=String(t?.slot?.id??""),r=this.getCompatibleCropsFor(e),a=this.getOverride(n);return r.map(s=>{let i=a.crops[s]??{allowed:!0};return{crop:s,allowed:!!i.allowed}})},setTeamsOrder(t){let e=new Map(this._teams.map(r=>[r.id,r])),n=[];for(let r of t){let a=e.get(r);a&&(n.push(a),e.delete(r))}for(let r of e.values())n.push(r);this._teams=n,Xe(this._teams),this._notifyTeamSubs()},async buildFilteredInventoryForTeam(t,e){await De();let{mode:n,value:r}=Nn(this.getTeamSearch(t)||""),a=await this.getInventoryPets();if(n==="ability"&&r){let l=await Wn(r);a=l.size?a.filter(p=>Array.isArray(p.abilities)&&p.abilities.some(T=>l.has(T))):[]}else if(n==="species"&&r){let l=r.toLowerCase();a=a.filter(p=>(p.petSpecies||"").toLowerCase()===l)}else r&&(a=a.filter(l=>rn(l,r)));if(e?.excludeIds?.size){let l=e.excludeIds;a=a.filter(p=>!l.has(p.id))}let s=a.map(qn),i=await Fn(),o=new Set(a.map(l=>l.id)),u=i.filter(l=>o.has(l));return{items:s,favoritedItemIds:u}},async buildFilteredInventoryByQuery(t,e){await De();let n=(t||"").toLowerCase().trim();console.log(n);let r=await this.getInventoryPets();if(console.log("before filter (query)",r),r=r.filter(u=>rn(u,n)),e?.excludeIds?.size){let u=e.excludeIds;r=r.filter(l=>!u.has(l.id))}console.log("after filter (query)",r);let a=r.map(qn),s=await Fn(),i=new Set(r.map(u=>u.id)),o=s.filter(u=>i.has(u));return{items:a,favoritedItemIds:o}},async startAutofeedWatcher(t){un=t??null;let e=await j.onPetsChangeNow(n=>{gt=Array.isArray(n)?n.slice():[],pt()});return()=>{try{e()}catch{}gt=[],Rt.clear(),un=null}},getUIState(){return an()},setUIState(t){let n={...an(),...t||{}};return Kr(n),n},setSelectedPet(t){return this.setUIState({selectedPetId:t})},getSelectedPetId(){return an().selectedPetId??null},_teams:er(),_teamSubs:new Set,_notifyTeamSubs(){let t=this.getTeams();this._teamSubs.forEach(e=>{try{e(t)}catch{}})},getTeams(){return Array.isArray(this._teams)?this._teams.map(t=>({...t,slots:t.slots.slice(0,3)})):[]},onTeamsChange(t){this._teamSubs.add(t);try{t(this.getTeams())}catch{}return()=>{this._teamSubs.delete(t)}},async onTeamsChangeNow(t){let e=this.onTeamsChange(t);try{t(this.getTeams())}catch{}return e},createTeam(t){let e={id:On(),name:t?.trim()||`Team ${this._teams.length+1}`,slots:[null,null,null]};return this._teams.push(e),Xe(this._teams),this._notifyTeamSubs(),e},duplicateTeam(t){let e=this._teams.find(r=>r.id===t);if(!e)return null;let n={id:On(),name:`${e.name} (copy)`,slots:e.slots.slice(0,3)};return this._teams.push(n),Xe(this._teams),this._notifyTeamSubs(),n},deleteTeam(t){let e=this._teams.findIndex(n=>n.id===t);return e<0?!1:(this._teams.splice(e,1),Xe(this._teams),this._notifyTeamSubs(),!0)},saveTeam(t){let e=this._teams.findIndex(a=>a.id===t.id);if(e<0)return null;let n=this._teams[e],r={id:n.id,name:typeof t.name=="string"?t.name:n.name,slots:Array.isArray(t.slots)?t.slots.slice(0,3):n.slots};return this._teams[e]=r,Xe(this._teams),this._notifyTeamSubs(),r},updateTeam(t,e){let n=yt.findIndex(s=>s.id===t);if(n<0)return null;let r=yt[n],a={...r,...e,slots:e.slots?[...e.slots]:r.slots};return yt[n]=a,Xe(yt),Vr(),a},getTeamSearch(t){return kt[t]||""},setTeamSearch(t,e){kt[t]=(e||"").trim(),Ur(kt),Yr(t)},onTeamSearchChange(t){return dn.add(t),()=>{dn.delete(t)}},getTeamById(t){let e=this._teams.find(n=>n.id===t)||null;return e?{...e,slots:e.slots.slice(0,3)}:null},async getTeamFilteredInventoryPets(t){await De();let{mode:e,value:n}=Nn(this.getTeamSearch(t)||""),r=We.slice();if(e==="ability"&&n){let a=await Wn(n);return a.size?r.filter(s=>s.abilities?.some(i=>a.has(i))):[]}if(e==="species"&&n){let a=n.toLowerCase();return r.filter(s=>(s.petSpecies||"").toLowerCase()===a)}return n?r.filter(a=>rn(a,n)):r},async getTeamSlotOptions(t,e){await De();let n=this.getTeamById(t),r=await this.getTeamFilteredInventoryPets(t);if(!n)return r;let a=Math.max(0,Math.min(2,Math.floor(e))),s=n.slots[a]||null,i=new Set;n.slots.forEach((u,l)=>{l!==a&&u&&i.add(u)});let o=r.filter(u=>!i.has(u.id));if(s&&!o.some(u=>u.id===s)){let u=We.find(l=>l.id===s);u&&(o=[u,...o])}return o},_logs:[],_logsMax:500,_seenPerfByPet:new Map,_logSubs:new Set,async startAbilityLogsWatcher(){let t=await An.subNow(e=>{this._ingestAbilityMap(e)});return()=>{try{t()}catch{}}},getAbilityLogs(t){let e=t?.abilityIds&&t.abilityIds.length?new Set(t.abilityIds):null,n=Number.isFinite(t?.since)?t.since:0,r=Math.max(0,Math.floor(t?.limit??0)),a=this._logs.filter(s=>(n?s.performedAt>=n:!0)&&(e?e.has(s.abilityId):!0));return a=a.sort((s,i)=>i.performedAt-s.performedAt),r?a.slice(0,r):a},onAbilityLogs(t){this._logSubs.add(t);try{t(this.getAbilityLogs())}catch{}return()=>{this._logSubs.delete(t)}},getSeenAbilityIds(){let t=new Set;for(let e of this._logs)t.add(e.abilityId);return Array.from(t).sort()},clearAbilityLogs(){this._logs.length=0,this._seenPerfByPet.clear(),this._notifyLogSubs()},_notifyLogSubs(){let t=this.getAbilityLogs();this._logSubs.forEach(e=>{try{e(t)}catch{}})},_pushLog(t){this._logs.push(t),this._logs.length>this._logsMax&&this._logs.splice(0,this._logs.length-this._logsMax),this._notifyLogSubs()},_ingestAbilityMap(t){if(!(!t||typeof t!="object"))for(let e of Object.keys(t)){let n=t[e];if(!n||typeof n!="object")continue;let r=n.abilityId??null,a=Number(n.performedAt)||0;if(!r||!a)continue;let s=this._seenPerfByPet.get(e)||0;if(a<=s)continue;let i=gt.find(u=>String(u?.slot?.id||"")===e)||null,o={petId:e,species:i?.slot?.petSpecies||void 0,name:i?.slot?.name??void 0,abilityId:String(r),data:n.data,performedAt:a};this._seenPerfByPet.set(e,a),this._pushLog(o)}},async getInventoryPets(){return await De(),We.slice()},async searchInventoryPets(t){let e=await this.getInventoryPets(),n=a=>(a??"").toLowerCase(),r=(t||"").toLowerCase().trim();return r?e.filter(a=>n(a.id).includes(r)||n(a.petSpecies).includes(r)||n(a.name).includes(r)||a.abilities.some(s=>n(s).includes(r))||a.mutations.some(s=>n(s).includes(r))):e},onInventoryPetsChange(t){De(),mn.add(t);try{t(We.slice())}catch{}return()=>{mn.delete(t)}},async useTeam(t){let e=this.getTeams().find(r=>r.id===t)||null;if(!e)throw new Error("Team not found");let n=(e.slots||[]).filter(r=>typeof r=="string"&&r.length>0).slice(0,3);return n.length?Vn(n):{swapped:0,placed:0,skipped:0}},async useTeamSlots(t){let e=(Array.isArray(t)?t:[]).filter(n=>typeof n=="string"&&n.length>0).slice(0,3);return e.length?Vn(e):{swapped:0,placed:0,skipped:0}}};async function ra(){try{let t=await j.getPets();return(Array.isArray(t)?t:[]).map(n=>String(n?.slot?.id||"")).filter(n=>!!n).slice(0,3)}catch{return[]}}async function Vn(t){let e=await ra(),n=new Set(t),r=e.filter(p=>!n.has(p)),a=Math.max(0,e.length-t.length);if(a>0){let p=r.slice(0,a);for(let T of p)try{await j.storePet(T),e=e.filter(C=>C!==T)}catch(C){console.warn("[Pets] storePet failed:",T,C)}}let s=new Set;for(let p of t)e.includes(p)&&s.add(p);let i=0,o=0,u=0;s.size&&(e=e.filter(p=>!s.has(p)),u=s.size);let l=t.filter(p=>!s.has(p));for(let p of l){let T=e.shift();try{T?(await j.swapPet(T,p),i++):(await j.placePet(p,{x:0,y:0},"Boardwalk",64),o++)}catch(C){console.warn("[Pets] useTeam op failed for",{invId:p,slotId:T,err:C})}}return{swapped:i,placed:o,skipped:u}}function aa(t){return t&&typeof t=="object"&&"species"in t}function sa(t){return t&&typeof t=="object"&&"toolId"in t}function ia(t){return t&&typeof t=="object"&&"eggId"in t}function oa(t){return t&&typeof t=="object"&&"decorId"in t}function la(t){if(!t||typeof t!="object")return null;if(typeof t.secondsUntilRestock=="number")return t.secondsUntilRestock;for(let e of Object.keys(t)){let n=t[e];if(typeof n=="number"&&e.toLowerCase().includes("secondsuntilrestock"))return n}return null}function ca(t,e){let n=new Set,r=[t];for(;r.length;){let a=r.pop();if(!(!a||typeof a!="object")&&!n.has(a)){n.add(a);for(let s of Object.keys(a)){let i=a[s];if(Array.isArray(i)&&i.length&&i.every(o=>typeof o=="object")&&i.some(e)){let o=la(a);return{items:i,sec:o}}}for(let s of Object.keys(a)){let i=a[s];i&&typeof i=="object"&&r.push(i)}}}return{items:[],sec:null}}function da(t){return t==="seeds"?aa:t==="tools"?sa:t==="eggs"?ia:oa}var He={async readRawData(){return Kt.get().catch(()=>({}))},async read(t){let e=await this.readRawData();return ca(e,da(t))},identityFor(t,e){if(typeof e?.name=="string"&&e.name.trim())return e.name.trim();let n={seeds:$e,tools:Xt,eggs:Jt,decor:Qt},r={seeds:[String(e.species??e.id??"")],tools:[String(e.toolId??e.id??"")],eggs:[String(e.eggId??e.id??"")],decor:[String(e.decorId??e.id??"")]},a=n[t];for(let s of r[t]){if(!s)continue;let i=a[s];if(i){if(t==="seeds"&&i.seed?.name)return i.seed.name;if(i.name)return i.name}}return String(e.species??e.toolId??e.eggId??e.decorId??e.id??"?")},getQty(t){let e=t.initialStock??0,n=Number(e);return Number.isFinite(n)?n:0},priceFromCatalog(t,e){let n=t==="seeds"?$e:t==="tools"?Xt:t==="eggs"?Jt:Qt,r=[e.species,e.toolId,e.eggId,e.decorId].filter(Boolean).map(String);for(let a of r){let s=n[a];if(s)if(t==="seeds"){let i=Number(s?.seed?.coinPrice);if(Number.isFinite(i))return i}else{let i=Number(s?.coinPrice);if(Number.isFinite(i))return i}}},keyForAuto(t,e){return`${t}:${this.identityFor(t,e)}`},keyForOffer(t,e){let n=this.priceFromCatalog(t,e)??0;return`${this.keyForAuto(t,e)}@${n}`},invKeyFromAutoKey(t,e){let n=e.indexOf(":");return n>=0?e.slice(n+1):e},buyOne(t,e){if(t==="seeds"){let n=e.species??e.name;n&&me({type:"PurchaseSeed",species:n});return}if(t==="tools"){let n=e.toolId??e.id;n&&me({type:"PurchaseTool",toolId:n});return}if(t==="eggs"){let n=e.eggId??e.id;n&&me({type:"PurchaseEgg",eggId:n});return}if(t==="decor"){let n=e.decorId??e.id;n&&me({type:"PurchaseDecor",decorId:n});return}},sleep(t){return new Promise(e=>setTimeout(e,t))},async buyAllInStock(t,e,n){let r=Math.max(0,this.getQty(e));if(r===0)return;let a=typeof n?.limitPerTick=="number"&&isFinite(n.limitPerTick)?Math.max(0,n.limitPerTick):r,s=typeof n?.delayMs=="number"&&isFinite(n.delayMs)?Math.max(0,n.delayMs):0,i=Math.min(r,a),o=0;for(let u=0;u<i;u++){try{await this.buyOne(t,e),o++}catch(l){console.warn("[buyAllInStock] failed",t,this.identityFor(t,e),l);break}s>0&&await this.sleep(s)}},async readMyInventory(){return Ke.get().catch(()=>null)},async readInventoryMaps(){let t=await this.readMyInventory(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};for(let n of t?.items||[]){if(!n||typeof n!="object")continue;let r=Number.isFinite(+n.quantity)?+n.quantity:1;n.itemType==="Seed"&&n.species&&e.seeds.set(String(n.species),(e.seeds.get(String(n.species))??0)+r),n.itemType==="Tool"&&n.toolId&&e.tools.set(String(n.toolId),(e.tools.get(String(n.toolId))??0)+r),n.itemType==="Egg"&&n.eggId&&e.eggs.set(String(n.eggId),(e.eggs.get(String(n.eggId))??0)+r),n.itemType==="Decor"&&n.decorId&&e.decor.set(String(n.decorId),(e.decor.get(String(n.decorId))??0)+r)}return e},async onInventoryChange(t){let e=await Ke.sub(async()=>{try{t(await this.readInventoryMaps())}catch{}});try{t(await this.readInventoryMaps())}catch{}return e},async onQuantityChange(t,e){let n="",r=async()=>{try{let s=await this.read(t),i=this.signatureFor(t,s);i!==n&&(n=i,e())}catch{}},a=await Kt.sub(r);return await r(),a},signatureFor(t,e){let n=e.items.map(r=>{let a=this.keyForOffer(t,r),s=this.getQty(r);return`${a}#${s}`});return n.sort(),`${t}:${n.join("|")}`},async readMyPurchases(){return $t.get().catch(()=>null)},async readPurchasesMaps(){let t=await this.readMyPurchases(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};if(!t)return e;let n=t.seed?.purchases??{};for(let[i,o]of Object.entries(n))e.seeds.set(i,Number(o)||0);let r=t.tool?.purchases??{};for(let[i,o]of Object.entries(r))e.tools.set(i,Number(o)||0);let a=t.egg?.purchases??{};for(let[i,o]of Object.entries(a))e.eggs.set(i,Number(o)||0);let s=t.decor?.purchases??{};for(let[i,o]of Object.entries(s))e.decor.set(i,Number(o)||0);return e},async onPurchasesChange(t){let e=await $t.sub(async()=>{try{t(await this.readPurchasesMaps())}catch{}});try{t(await this.readPurchasesMaps())}catch{}return e}};var Ce=class{constructor(e={}){this.opts=e;W(this,"root");W(this,"tabBar");W(this,"views");W(this,"tabs",new Map);W(this,"events",new Map);W(this,"currentId",null);W(this,"lsKeyActive");this.lsKeyActive=`menu:${e.id||"default"}:activeTab`}mount(e){if(this.ensureStyles(),e.innerHTML="",this.root=ne("div",`qmm ${this.opts.classes||""} ${this.opts.compact?"qmm-compact":""}`),this.opts.startHidden&&(this.root.style.display="none"),this.tabBar=ne("div","qmm-tabs"),this.views=ne("div","qmm-views"),this.root.appendChild(this.tabBar),this.root.appendChild(this.views),e.appendChild(this.root),this.tabs.size){for(let[n,r]of this.tabs)this.createTabView(n,r);this.restoreActive()}this.updateTabsBarVisibility(),this.emit("mounted")}unmount(){this.root?.parentElement&&this.root.parentElement.removeChild(this.root),this.emit("unmounted")}setVisible(e){this.root&&(this.root.style.display=e?"":"none",this.emit(e?"show":"hide"))}toggle(){if(!this.root)return!1;let e=this.root.style.display==="none";return this.setVisible(e),e}addTab(e,n,r){return this.tabs.set(e,{title:n,render:r,badge:null}),this.root&&(this.createTabView(e,this.tabs.get(e)),this.updateTabsBarVisibility()),this}addTabs(e){return e.forEach(n=>this.addTab(n.id,n.title,n.render)),this}setTabTitle(e,n){let r=this.tabs.get(e);if(r&&(r.title=n,r.btn)){let a=r.btn.querySelector(".label");a&&(a.textContent=n)}}setTabBadge(e,n){let r=this.tabs.get(e);!r||!r.btn||(r.badge||(r.badge=document.createElement("span"),r.badge.className="badge",r.btn.appendChild(r.badge)),n==null||n===""?r.badge.style.display="none":(r.badge.textContent=n,r.badge.style.display=""))}refreshTab(e){let n=this.tabs.get(e);if(!n?.view)return;let r=this.findScrollableAncestor(n.view),a=r?r.scrollTop:null,s=r?r.scrollLeft:null,i=document.activeElement?.id||null;n.view.innerHTML="";try{n.render(n.view,this)}catch(o){n.view.textContent=String(o)}this.currentId===e&&this.switchTo(e),this.emit("tab:render",e),r&&a!=null&&requestAnimationFrame(()=>{try{r.scrollTop=a,r.scrollLeft=s??0}catch{}if(i){let o=document.getElementById(i);if(o&&o.focus)try{o.focus()}catch{}}})}findScrollableAncestor(e){function n(a){let s=getComputedStyle(a),i=s.overflowY||s.overflow;return/(auto|scroll)/.test(i)&&a.scrollHeight>a.clientHeight}let r=e;for(;r;){if(n(r))return r;r=r.parentElement}return document.querySelector(".qws-win")}firstTabId(){let e=this.tabs.keys().next();return e.done?null:e.value??null}getTabView(e){return this.tabs.get(e)?.view??null}removeTab(e){let n=this.tabs.get(e);if(!n)return;this.tabs.delete(e);let r=this.tabBar?.querySelector(`button[data-id="${ar(e)}"]`);if(r&&r.parentElement&&r.parentElement.removeChild(r),n.view&&n.view.parentElement&&n.view.parentElement.removeChild(n.view),this.currentId===e){let a=this.tabs.keys().next().value||null;this.switchTo(a)}this.updateTabsBarVisibility()}switchTo(e){this.currentId=e,[...this.tabBar.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),[...this.views.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),this.persistActive(),this.emit("tab:change",e)}on(e,n){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(n),()=>this.off(e,n)}off(e,n){this.events.get(e)?.delete(n)}emit(e,...n){this.events.get(e)?.forEach(r=>{try{r(...n)}catch{}})}btn(e,n){let r=ne("button","qmm-btn",`<span class="label">${Wt(e)}</span>`);return r.onclick=n,r}label(e){let n=ne("label","qmm-label");return n.textContent=e,n}row(...e){let n=ne("div","qmm-row");return e.forEach(r=>n.appendChild(r)),n}section(e){let n=ne("div","qmm-section");return n.appendChild(ne("div","qmm-section-title",Wt(e))),n}inputNumber(e=0,n=9999,r=1,a=0){let s=ne("div","qmm-input-number"),i=ne("input","qmm-input qmm-input-number-input");i.type="number",i.min=String(e),i.max=String(n),i.step=String(r),i.value=String(a),i.inputMode="numeric";let o=ne("div","qmm-spin"),u=ne("button","qmm-step qmm-step--up","\u25B2"),l=ne("button","qmm-step qmm-step--down","\u25BC");u.type=l.type="button";let p=()=>{let M=Number(i.value);if(Number.isFinite(M)){let b=Number(i.min),w=Number(i.max),f=Math.max(b,Math.min(w,M));f!==M&&(i.value=String(f))}},T=M=>{M<0?i.stepDown():i.stepUp(),p(),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))},C=(M,b)=>{let w=null,f=null,g=!1,S=D=>{g=!1,w=window.setTimeout(()=>{g=!0,T(b),f=window.setInterval(()=>T(b),60)},300),M.setPointerCapture?.(D.pointerId)},R=()=>{w!=null&&(clearTimeout(w),w=null),f!=null&&(clearInterval(f),f=null)};M.addEventListener("pointerdown",S),["pointerup","pointercancel","pointerleave","blur"].forEach(D=>M.addEventListener(D,R)),M.addEventListener("click",D=>{if(g){D.preventDefault(),D.stopPropagation(),g=!1;return}T(b)})};return C(u,1),C(l,-1),i.addEventListener("change",p),o.append(u,l),s.append(i,o),i.wrap=s,i}inputText(e="",n=""){let r=ne("input","qmm-input");return r.type="text",r.placeholder=e,r.value=n,r}checkbox(e=!1){let n=ne("input","qmm-check");return n.type="checkbox",n.checked=e,n}radio(e,n,r=!1){let a=ne("input","qmm-radio");return a.type="radio",a.name=e,a.value=n,a.checked=r,a}slider(e=0,n=100,r=1,a=0){let s=ne("input","qmm-range");return s.type="range",s.min=String(e),s.max=String(n),s.step=String(r),s.value=String(a),s}switch(e=!1){let n=this.checkbox(e);return n.classList.add("qmm-switch"),n}table(e,n){let r=document.createElement("div");r.className="qmm-table-wrap",n?.minimal&&r.classList.add("qmm-table-wrap--minimal");let a=document.createElement("div");a.className="qmm-table-scroll",n?.maxHeight&&(a.style.maxHeight=n.maxHeight),r.appendChild(a);let s=document.createElement("table");s.className="qmm-table",n?.minimal&&s.classList.add("qmm-table--minimal"),n?.compact&&s.classList.add("qmm-table--compact"),n?.fixed&&(s.style.tableLayout="fixed");let i=document.createElement("thead"),o=document.createElement("tr");e.forEach(l=>{let p=document.createElement("th");typeof l=="string"?p.textContent=l:(p.textContent=l.label??"",l.align&&p.classList.add(`is-${l.align}`),l.width&&(p.style.width=l.width)),o.appendChild(p)}),i.appendChild(o);let u=document.createElement("tbody");return s.append(i,u),a.appendChild(s),{root:r,tbody:u}}radioGroup(e,n,r,a){let s=ne("div","qmm-radio-group");for(let{value:i,label:o}of n){let u=this.radio(e,i,r===i),l=document.createElement("label");l.className="qmm-radio-label",l.appendChild(u),l.appendChild(document.createTextNode(o)),u.onchange=()=>{u.checked&&a(i)},s.appendChild(l)}return s}bindLS(e,n,r,a,s){try{let i=localStorage.getItem(e);i!=null&&r(a(i))}catch{}return{save:()=>{try{localStorage.setItem(e,s(n()))}catch{}}}}split2(e="260px"){let n=ne("div","qmm-split");n.style.gridTemplateColumns="minmax(160px, max-content) 1fr";let r=ne("div","qmm-split-left"),a=ne("div","qmm-split-right");return n.appendChild(r),n.appendChild(a),{root:n,left:r,right:a}}vtabs(e={}){return new pn(this,e)}createTabView(e,n){let r=document.createElement("button");r.className="qmm-tab",r.dataset.id=e,r.innerHTML=`<span class="label">${Wt(n.title)}</span><span class="badge" style="display:none"></span>`;let a=r.querySelector(".badge");n.btn=r,n.badge=a,r.onclick=()=>this.switchTo(e),this.tabBar.appendChild(r);let s=ne("div","qmm-view");s.dataset.id=e,n.view=s,this.views.appendChild(s);try{n.render(s,this)}catch(i){s.textContent=String(i)}this.currentId||this.switchTo(e)}persistActive(){if(this.currentId)try{localStorage.setItem(this.lsKeyActive,this.currentId)}catch{}}restoreActive(){let e=null;try{e=localStorage.getItem(this.lsKeyActive)}catch{}e&&this.tabs.has(e)?this.switchTo(e):this.tabs.size&&this.switchTo(this.firstTabId())}updateTabsBarVisibility(){if(!this.tabBar||!this.root)return;this.tabs.size>0?(this.tabBar.parentElement||this.root.insertBefore(this.tabBar,this.views),this.tabBar.style.display="flex",this.root.classList.remove("qmm-no-tabs")):(this.tabBar.parentElement&&this.tabBar.parentElement.removeChild(this.tabBar),this.root.classList.add("qmm-no-tabs"))}ensureStyles(){if(document.getElementById("__qmm_css__"))return;let e=`
    /* ================= Modern UI for qmm ================= */
.qmm{
  --qmm-bg:        #0f1318;
  --qmm-bg-soft:   #0b0f13;
  --qmm-panel:     #111823cc;
  --qmm-border:    #ffffff22;
  --qmm-border-2:  #ffffff14;
  --qmm-accent:    #7aa2ff;
  --qmm-accent-2:  #92b2ff;
  --qmm-text:      #e7eef7;
  --qmm-text-dim:  #b9c3cf;
  --qmm-shadow:    0 6px 20px rgba(0,0,0,.35);
  --qmm-blur:      8px;

  display:flex; flex-direction:column; gap:10px; color:var(--qmm-text);
}
.qmm-compact{ gap:6px }

/* ---------- Tabs (pill + underline) ---------- */
.qmm-tabs{
  display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end;
  padding:0 6px 2px 6px; position:relative; isolation:isolate;
  border-bottom:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  border-top-left-radius:10px; border-top-right-radius:10px;
}
.qmm-no-tabs .qmm-views{ margin-top:0 }

.qmm-tab{
  flex:1 1 0; min-width:0; cursor:pointer;
  display:inline-flex; justify-content:center; align-items:center; gap:8px;
  padding:8px 12px; color:var(--qmm-text);
  background:transparent; border:1px solid transparent; border-bottom:none;
  border-top-left-radius:10px; border-top-right-radius:10px;
  position:relative; margin:0; margin-bottom:-1px;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;
}
.qmm-compact .qmm-tab{ padding:6px 10px }
.qmm-tab:hover{ background:rgba(255,255,255,.06) }
.qmm-tab:active{ transform:translateY(1px) }
.qmm-tab:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; border-radius:10px }

.qmm-tab .badge{
  font-size:11px; line-height:1; padding:2px 6px; border-radius:999px;
  background:#ffffff1a; border:1px solid #ffffff22;
}

.qmm-tab.active{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff; box-shadow:inset 0 -1px 0 #0007;
}
.qmm-tab.active::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-1px; height:2px;
  background:linear-gradient(90deg, transparent, var(--qmm-accent), transparent);
  border-radius:2px; box-shadow:0 0 12px var(--qmm-accent-2);
}

/* ---------- Views panel ---------- */
.qmm-views{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  display:flex; flex-direction:column;
  min-width:0; min-height:0; overflow:auto; box-shadow:var(--qmm-shadow);
}
.qmm-compact .qmm-views{ padding:8px }
.qmm-tabs + .qmm-views{ margin-top:-1px }

.qmm-view{ display:none; min-width:0; min-height:0; }
.qmm-view.active{ display:block; }

/* ---------- Basic controls ---------- */
.qmm-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.qmm-section{ margin-top:8px }
.qmm-section-title{ font-weight:650; margin:2px 0 8px 0; color:var(--qmm-text) }

.qmm-label{ opacity:.9 }
.qmm-val{ min-width:24px; text-align:center }

/* Buttons */
.qmm-btn{
  cursor:pointer; border-radius:10px; border:1px solid var(--qmm-border);
  padding:8px 12px; background:linear-gradient(180deg, #ffffff10, #ffffff06);
  color:#fff; box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.2);
  transition:transform .1s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
}
.qmm-compact .qmm-btn{ padding:6px 10px }
.qmm-btn:hover{ background:linear-gradient(180deg, #ffffff16, #ffffff08); border-color:#ffffff40 }
.qmm-btn:active{ transform:translateY(1px) }
.qmm-btn:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; }

/* Button variants (optional utility) */
.qmm-btn.qmm-primary{ background:linear-gradient(180deg, rgba(122,162,255,.35), rgba(122,162,255,.15)); border-color:#9db7ff55 }
.qmm-btn.qmm-danger{  background:linear-gradient(180deg, rgba(255,86,86,.28), rgba(255,86,86,.12));  border-color:#ff6a6a55 }
.qmm-btn.active{
  background:#79a6ff22;
  border-color:#79a6ff66;
  box-shadow: inset 0 0 0 1px #79a6ff33;
}

/* Inputs */
.qmm-input{
  min-width:90px; background:rgba(0,0,0,.42); color:#fff;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.qmm-input::placeholder{ color:#cbd6e780 }
.qmm-input:focus{ outline:none; border-color:var(--qmm-accent); background:#0f1521; box-shadow:0 0 0 2px #7aa2ff33 }

/* Number input + spinner (unchanged API) */
.qmm-input-number{ display:inline-flex; align-items:center; gap:6px }
.qmm-input-number-input{ width:70px; text-align:center; padding-right:8px }
.qmm-spin{ display:inline-flex; flex-direction:column; gap:2px }
.qmm-step{
  width:22px; height:16px; font-size:11px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:6px; border:1px solid var(--qmm-border);
  background:rgba(255,255,255,.08); color:#fff; cursor:pointer; user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-step:hover{ background:#ffffff18; border-color:#ffffff40 }
.qmm-step:active{ transform:translateY(1px) }

/* Switch (checkbox) */
.qmm-switch{
  appearance:none; width:42px; height:24px; background:#6c7488aa; border-radius:999px;
  position:relative; outline:none; cursor:pointer; transition:background .18s ease, box-shadow .18s ease;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12);
}
.qmm-switch::before{
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px;
  background:#fff; border-radius:50%; transition:transform .2s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
}
.qmm-switch:checked{ background:linear-gradient(180deg, rgba(122,162,255,.9), rgba(122,162,255,.6)) }
.qmm-switch:checked::before{ transform:translateX(18px) }
.qmm-switch:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px }

/* Checkbox & radio (native inputs skinned lightly) */
.qmm-check, .qmm-radio{ transform:scale(1.1); accent-color: var(--qmm-accent) }

/* Slider */
.qmm-range{
  width:180px; appearance:none; background:transparent; height:22px;
}
.qmm-range:focus{ outline:none }
.qmm-range::-webkit-slider-runnable-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-moz-range-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-webkit-slider-thumb{
  appearance:none; width:16px; height:16px; border-radius:50%; margin-top:-5px;
  background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
  transition:transform .1s ease;
}
.qmm-range:active::-webkit-slider-thumb{ transform:scale(1.04) }
.qmm-range::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:#fff; border:none;
  box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
}

/* ---------- Minimal table ---------- */
/* container */
.qmm-table-wrap--minimal{
  border:1px solid #263040; border-radius:8px; background:#0b0f14; box-shadow:none;
}
/* scroller (height cap) */
.qmm-table-scroll{
  overflow:auto; max-height:44vh; /* override via opts.maxHeight */
}

/* base */
.qmm-table--minimal{
  width:100%;
  border-collapse:collapse;
  background:transparent;
  font-size:13px; line-height:1.35; color:var(--qmm-text, #cdd6e3);
}

/* header */
.qmm-table--minimal thead th{
  position:sticky; top:0; z-index:1;
  text-align:left; font-weight:600;
  padding:8px 10px;
  color:#cbd5e1; background:#0f1318;
  border-bottom:1px solid #263040;
  text-transform:none; letter-spacing:0;
}
.qmm-table--minimal thead th.is-center { text-align: center; }
.qmm-table--minimal thead th.is-left   { text-align: left; }   /* d\xE9j\xE0 pr\xE9sent, ok */
.qmm-table--minimal thead th.is-right  { text-align: right; }
.qmm-table--minimal thead th,
.qmm-table--minimal td { vertical-align: middle; }

/* cells */
.qmm-table--minimal td{
  padding:8px 10px; border-bottom:1px solid #1f2937; vertical-align:middle;
}
.qmm-table--minimal tbody tr:hover{ background:#0f1824; }

/* compact variant */
.qmm-table--compact thead th,
.qmm-table--compact td{ padding:6px 8px; font-size:12px }

/* utils */
.qmm-table--minimal td.is-num{ text-align:right; font-variant-numeric:tabular-nums }
.qmm-table--minimal td.is-center{ text-align:center }
.qmm-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.qmm-prewrap{ white-space:pre-wrap; word-break:break-word }


/* ---------- Split panels ---------- */
.qmm-split{
  display:grid; gap:12px;
  grid-template-columns:minmax(180px,260px) minmax(0,1fr);
  align-items:start;
}
.qmm-split-left{ display:flex; flex-direction:column; gap:10px }
.qmm-split-right{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
}

/* ---------- VTabs (vertical list + filter) ---------- */
.qmm-vtabs{ display:flex; flex-direction:column; gap:8px; min-width:0 }
.qmm-vtabs .filter{ display:block }
.qmm-vtabs .filter input{ width:100% }

.qmm-vlist{
  flex:0 0 auto; overflow:visible;
  border:1px solid var(--qmm-border); border-radius:12px; padding:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
}

.qmm-vtab{
  width:100%; text-align:left; cursor:pointer;
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:8px 10px; border-radius:10px; border:1px solid #ffffff18;
  background:rgba(255,255,255,.03); color:inherit;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-vtab:hover{ background:rgba(255,255,255,.07); border-color:#ffffff34 }
.qmm-vtab:active{ transform:translateY(1px) }
.qmm-vtab.active{
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.08));
  border-color:#9db7ff55;
  box-shadow:0 1px 14px rgba(122,162,255,.18) inset;
}

.qmm-dot{ width:10px; height:10px; border-radius:50%; justify-self:center; box-shadow:0 0 0 1px #0006 inset }
.qmm-chip{ display:flex; align-items:center; gap:8px; min-width:0 }
.qmm-chip img{
  width:20px; height:20px; border-radius:50%; object-fit:cover; border:1px solid #4446;
  box-shadow:0 1px 0 rgba(255,255,255,.08) inset;
}
.qmm-chip .t{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.qmm-tag{
  font-size:11px; line-height:1; padding:3px 7px; border-radius:999px;
  background:#ffffff14; border:1px solid #ffffff26;
}

/* ---------- Small helpers (optional) ---------- */
.qmm .qmm-card{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur)); box-shadow:var(--qmm-shadow);
}
  .qmm .qmm-help{ font-size:12px; color:var(--qmm-text-dim) }
  .qmm .qmm-sep{ height:1px; background:var(--qmm-border); width:100%; opacity:.6; }

/* ta poign\xE9e, inchang\xE9 */
.qmm-grab { margin-left:auto; opacity:.8; cursor:grab; user-select:none; }
.qmm-grab:active { cursor:grabbing; }
.qmm-dragging { opacity:.6; }

/* items animables */
.qmm-team-item {
  will-change: transform;
  transition: transform 160ms ease;
}
.qmm-team-item.drag-ghost {
  opacity: .4;
}



    `,n=document.createElement("style");n.id="__qmm_css__",n.textContent=e,(document.documentElement||document.body).appendChild(n)}},pn=class{constructor(e,n={}){this.api=e;this.opts=n;W(this,"root");W(this,"filterWrap",null);W(this,"filterInput",null);W(this,"list");W(this,"items",[]);W(this,"selectedId",null);W(this,"onSelectCb");W(this,"renderItemCustom");W(this,"emptyText");this.root=ne("div","qmm-vtabs"),this.root.style.minWidth="0",this.emptyText=n.emptyText||"Aucun \xE9l\xE9ment.",this.renderItemCustom=n.renderItem,n.filterPlaceholder&&(this.filterWrap=ne("div","filter"),this.filterInput=document.createElement("input"),this.filterInput.type="search",this.filterInput.placeholder=n.filterPlaceholder,this.filterInput.className="qmm-input",this.filterInput.oninput=()=>this.renderList(),this.filterWrap.appendChild(this.filterInput),this.root.appendChild(this.filterWrap)),this.list=ne("div","qmm-vlist"),this.list.style.minWidth="0",n.maxHeightPx&&(this.list.style.maxHeight=`${n.maxHeightPx}px`,this.list.style.overflow="auto",this.list.style.flex="1 1 auto"),this.root.appendChild(this.list),this.selectedId=n.initialId??null,this.onSelectCb=n.onSelect}setItems(e){this.items=Array.isArray(e)?e.slice():[],this.selectedId&&!this.items.some(n=>n.id===this.selectedId)&&(this.selectedId=this.items[0]?.id??null),this.renderList()}getSelected(){return this.items.find(e=>e.id===this.selectedId)??null}select(e){this.selectedId=e,this.renderList(),this.onSelectCb?.(this.selectedId,this.getSelected())}onSelect(e){this.onSelectCb=e}setBadge(e,n){let r=this.list.querySelector(`button[data-id="${ar(e)}"]`);if(!r)return;let a=r.querySelector(".qmm-tag");!a&&n!=null&&(a=ne("span","qmm-tag"),r.appendChild(a)),a&&(n==null||n===""?a.style.display="none":(a.textContent=n,a.style.display=""))}getFilter(){return(this.filterInput?.value||"").trim().toLowerCase()}renderList(){let e=this.list.scrollTop;this.list.innerHTML="";let n=this.getFilter(),r=n?this.items.filter(s=>(s.title||"").toLowerCase().includes(n)||(s.subtitle||"").toLowerCase().includes(n)):this.items;if(!r.length){let s=document.createElement("div");s.style.opacity="0.75",s.textContent=this.emptyText,this.list.appendChild(s);return}let a=document.createElement("ul");a.style.listStyle="none",a.style.margin="0",a.style.padding="0",a.style.display="flex",a.style.flexDirection="column",a.style.gap="4px";for(let s of r){let i=document.createElement("li"),o=document.createElement("button");if(o.className="qmm-vtab",o.dataset.id=s.id,o.disabled=!!s.disabled,this.renderItemCustom)this.renderItemCustom(s,o);else{let u=ne("div","qmm-dot");u.style.background=s.statusColor||"#999a";let l=ne("div","qmm-chip"),p=document.createElement("img");p.src=s.avatarUrl||"",p.alt=s.title;let T=document.createElement("div");T.style.display="flex",T.style.flexDirection="column",T.style.gap="2px";let C=ne("div","t");C.textContent=s.title;let M=document.createElement("div");if(M.textContent=s.subtitle||"",M.style.opacity="0.7",M.style.fontSize="12px",s.subtitle||(M.style.display="none"),T.appendChild(C),T.appendChild(M),l.appendChild(p),l.appendChild(T),o.appendChild(u),o.appendChild(l),s.badge!=null){let b=ne("span","qmm-tag",Wt(String(s.badge)));o.appendChild(b)}else{let b=document.createElement("div");b.style.width="0",o.appendChild(b)}}o.classList.toggle("active",s.id===this.selectedId),o.onclick=()=>this.select(s.id),i.appendChild(o),a.appendChild(i)}this.list.appendChild(a),this.list.scrollTop=e}};function ne(t,e,n){let r=document.createElement(t);return e&&(r.className=e),n!=null&&(r.innerHTML=n),r}function ar(t){return t.replace(/"/g,'\\"')}function Wt(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}async function ua(t){let e=de("sendQuinoaToastAtom");if(e){await Te(e,t);return}let n=de("quinoaToastsAtom");if(!n)throw new Error("Aucun atom de toast trouv\xE9");let r=await Pe(n).catch(()=>[]),a={isClosable:!0,duration:1e4,...t};"toastType"in a&&a.toastType==="board"?a.id=a.id??(a.isStackable?`quinoa-stackable-${Date.now()}-${Math.random()}`:"quinoa-game-toast"):a.id=a.id??"quinoa-game-toast",await Te(n,[...r,a])}async function pe(t,e,n="info",r=3500){await ua({title:t,description:e,variant:n,duration:r})}var ma="menu:shops:auto";function ft(t){return async()=>{let e=await He.read(t),n=pa(),r=[];for(let a of e.items??[]){if(!n.has(ya(t,a)))continue;He.getQty(a)>0&&r.push(He.buyAllInStock(t,a,{delayMs:10}))}r.length!==0&&(await Promise.allSettled(r),pe("Auto-Buy","Activation success!","success"))}}function pa(){let t=(localStorage.getItem(ma)||"").split(",").filter(Boolean);return new Set(t)}function ya(t,e){let n=He.identityFor(t,e);return`${t}:${n}`}function Ie(t){return t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function yn(t){if(!t)return null;let e=String(t),n=e.split(".").pop()||e;return Ie(n)}function or(t){let e=t?.crop?.name;return e?Ie(e):null}function ga(t){return t?t.charAt(0).toUpperCase()+t.slice(1):null}var sr=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728"];function fa(){let t=[];for(let[e,n]of Object.entries($e)){let r=n?.seed?.name,a=n?.crop?.name,s=n?.plant?.name;t.push({key:e,seedName:r,cropName:a,plantName:s})}return t}function ha(t){let e=new Map;return t.forEach((n,r)=>e.set(n.key,sr[r%sr.length])),e}function ba(){let t=new Map,e=new Map,n=new Map;for(let r of Object.values($e)){let a=or(r);if(!a)continue;t.has(a)||t.set(a,r);let s=[yn(r?.seed?.tileRef),yn(r?.plant?.tileRef),yn(r?.crop?.tileRef),r?.seed?.species?Ie(r.seed.species):null,r?.crop?.name?Ie(r.crop.name):null,r?.plant?.name?Ie(r.plant.name):null],i=!1,o=r?.plant?.harvestType??r?.seed?.harvestType??r?.grow?.harvestType??r?.harvestType;if(o&&typeof o=="string"){let u=ae[o]??o;i=String(u).toLowerCase()!=="single"}if(!i&&r?.crop?.name){let u=String(r.crop.name).toLowerCase();/(fruit|berry|bush|tree)/.test(u)&&(i=!0)}for(let u of s)u&&e.set(u,ga(a));n.set(a,!!i)}return{byBase:t,speciesToBaseCap:e,baseIsMulti:n}}var lr=ba();function ht(t){if(!t)return null;let e=Ie(t);return lr.speciesToBaseCap.get(e)??null}function Sa(t){if(!t)return!1;let e=ht(t);if(!e)return!1;let n=Ie(e);return lr.baseIsMulti.get(n)??!1}var Ae={selected:"garden.selectedSeed",assignments:"garden.assignments",autoPlant:"garden.autoPlantEnabled",harvestRules:"garden.harvest.rules.v1",autoSellRules:"garden.autosell.rules.v1"};function Ft(t,e){let n;return function(...r){n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>t.apply(this,r),e)}}function va(){try{let t=localStorage.getItem(Ae.harvestRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var ir=Ft(t=>{try{localStorage.setItem(Ae.harvestRules,JSON.stringify(t))}catch{}},150);function wa(){try{let t=localStorage.getItem(Ae.autoSellRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var xa=Ft(t=>{try{localStorage.setItem(Ae.autoSellRules,JSON.stringify(t))}catch{}},150),Z=class Z{constructor(){W(this,"seedOptions",fa());W(this,"_emojiByKey",ha(this.seedOptions));W(this,"_speciesToKey",new Map);W(this,"_baseToKeys",new Map);W(this,"_basePrimary",new Map);W(this,"_maxScaleByBase",new Map);W(this,"_selectedSeed",this.seedOptions[0]?.key??"");W(this,"listeners",new Set);W(this,"_assign",new Map);W(this,"_slotState",new Map);W(this,"_autoTimer",null);W(this,"_autoRunning",!1);W(this,"_tickCount",0);W(this,"_lastResyncErrorAt",0);W(this,"_autoHarvestTimer",null);W(this,"_isHarvestTicking",!1);W(this,"_harvestRules",{});W(this,"_compiledRules",new Map);W(this,"_enabledBases",new Set);W(this,"_autoSellRules",{});W(this,"_invCountBySeedKey",new Map);W(this,"_scratchMature",[]);W(this,"_scratchPairs",[]);W(this,"_boundTickPlant",()=>{this.tickAutoPlant().catch(()=>{})});W(this,"_boundTickHarvest",()=>{this._tickAutoHarvest().catch(()=>{})});W(this,"saveSelectedSeed",Ft(()=>{try{localStorage.setItem(Ae.selected,this._selectedSeed)}catch{}},150));W(this,"saveAssignments",Ft(()=>{try{localStorage.setItem(Ae.assignments,JSON.stringify(Array.from(this._assign.entries())))}catch{}},200));W(this,"_autoSellTimer",null);W(this,"_autoSellPendingReason",null);W(this,"_lastKnownPlayers",0);W(this,"assignments",{get:e=>this._assign.get(e),set:(e,n)=>{this._assign.get(e)!==n&&(this._assign.set(e,n),this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},delete:e=>{this._assign.delete(e)&&(this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},clear:()=>{this._assign.size!==0&&(this._assign.clear(),this.saveAssignments(),this.emit({type:"assignments-changed"}))},invert:e=>{let n=new Map;for(let r=0;r<200;r++)this._assign.has(r)||n.set(r,e);this._assign=n,this.saveAssignments(),this.emit({type:"assignments-changed"})},entries:()=>this._assign.entries(),size:()=>this._assign.size});W(this,"runtime",{getSlotState:e=>this._slotState.get(e)??"empty",setSlotState:(e,n)=>{this._slotState.get(e)!==n&&(this._slotState.set(e,n),this.emit({type:"runtime-changed",slots:[e]}))}});for(let e of this.seedOptions){let n=[e.cropName,e.plantName,e.seedName].filter(Boolean);for(let r of n)this._speciesToKey.set(Ie(r),e.key)}for(let[e,n]of Object.entries($e)){let r=or(n);if(!r)continue;let a=Ie(r),s=this._baseToKeys.get(a)??[];s.length===0&&this._basePrimary.set(a,e),s.push(e),this._baseToKeys.set(a,s);let i=Number(n?.crop?.maxScale)||1;this._maxScaleByBase.has(a)||this._maxScaleByBase.set(a,i)}this.loadSelectedSeed(),this.loadAssignments(),this.restoreAutoPlantState(),this._harvestRules=va(),this._rebuildCompiledRulesAndEnabledBases(),Object.keys(this._harvestRules).length&&this.emit({type:"harvest-rules-replaced",rules:this.getAllHarvestRules()}),this._autoSellRules=wa(),Object.keys(this._autoSellRules).length&&this.emit({type:"auto-sell-rules-replaced",rules:this.getAllAutoSellRules()}),this._recomputeAutoHarvestLoop();try{j.getCropInventoryState&&j.getCropInventoryState().then(e=>this._rebuildInvCountsFromArray(e||[])).catch(()=>{}),j.onCropInventoryDiffNow&&j.onCropInventoryDiffNow((e,n)=>{Array.isArray(e)&&this._rebuildInvCountsFromArray(e),(n?.added?.length||n?.removed?.length||n?.updated?.length)&&(console.debug("[AutoSell] Trigger inventaire:",n),this._scheduleAutoSell("inventory"))})}catch{}try{j.onNumPlayersChangeNow(e=>{this._lastKnownPlayers=e,console.debug("[AutoSell] Trigger joueurs:",e),this._scheduleAutoSell("players")}),j.onFavoriteIdsChangeNow&&j.onFavoriteIdsChangeNow(e=>{console.debug("[AutoSell] Changement favoris (debug):",e?.length??0)})}catch{}}_scheduleAutoSell(e){this._autoSellPendingReason=e,this._autoSellTimer===null&&(this._autoSellTimer=window.setTimeout(()=>{this._autoSellTimer=null;let n=this._autoSellPendingReason||"unknown";this._autoSellPendingReason=null,this._runAutoSell(n).catch(()=>{})},120))}loadSelectedSeed(){try{let e=localStorage.getItem(Ae.selected);if(!e)return;this.seedOptions.some(r=>r.key===e)&&(this._selectedSeed=e)}catch{}}loadAssignments(){try{let e=localStorage.getItem(Ae.assignments);if(!e)return;let n=JSON.parse(e),r=new Map;for(let[a,s]of n)r.set(a,s);this._assign=r}catch{}}restoreAutoPlantState(){try{localStorage.getItem(Ae.autoPlant)==="1"&&this.startAutoPlant(!0)}catch{}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(e){for(let n of this.listeners)try{n(e)}catch{}}getEmojiFor(e){let n=this.seedOptions.find(r=>r.seedName===e);return n?this._emojiByKey.get(n.key)??"\u2022":"\u2022"}getEmojiForKey(e){return this._emojiByKey.get(e)??"\u2022"}getSelectedSeed(){return this._selectedSeed}setSelectedSeed(e){this._selectedSeed!==e&&(this._selectedSeed=e,this.saveSelectedSeed(),this.emit({type:"selected-seed-changed"}))}getVisualState(e){if(!this._assign.has(e))return"unassigned";let n=this._slotState.get(e)??"empty";return n==="empty"?"ok":n==="single"?"waiting":"blocked"}getAutoPlantEnabled(){return this._autoRunning}async syncNow(){await this.refreshFromPlayerGarden()}async refreshFromPlayerGarden(){try{let e=await j.getGardenState();if(!e||!e.tileObjects)return;let n=e.tileObjects,r=[];for(let[a,s]of Object.entries(n)){let i=Number(a),o=this.classifyTileObject(s??null);this._slotState.get(i)!==o&&(this._slotState.set(i,o),r.push(i))}for(let a of this._slotState.keys())String(a)in n||this._slotState.get(a)!=="empty"&&(this._slotState.set(a,"empty"),r.push(a));r.length&&this.emit({type:"runtime-changed",slots:r})}catch{this._lastResyncErrorAt=Date.now()}}classifyTileObject(e){if(!e)return"empty";let n=e?.species||e?.name||e?.title;if(n&&Sa(n))return"multi";let r=(e.objectType||e.type||"").toString().toLowerCase();return r.includes("plant")||r.includes("crop")||r.includes("egg")||r.includes("decor")||r.includes("item")||r.includes("pet"),"single"}startAutoPlant(e){if(!this._autoRunning){this._autoRunning=!0,this.refreshFromPlayerGarden().catch(()=>{}),e||pe("Garden","Auto plant enabled!","success");try{localStorage.setItem(Ae.autoPlant,"1")}catch{}this._autoTimer=window.setInterval(this._boundTickPlant,Z.TICK_MS)}}stopAutoPlant(){if(this._autoRunning){this._autoRunning=!1,this._autoTimer!==null&&(window.clearInterval(this._autoTimer),this._autoTimer=null);try{localStorage.setItem(Ae.autoPlant,"0")}catch{}pe("Garden","Auto plant disabled.","info")}}async tickAutoPlant(){if(!this._autoRunning||(this._tickCount=(this._tickCount+1)%Z.RESYNC_EVERY_TICKS,this._tickCount===0&&await this.refreshFromPlayerGarden(),Date.now()-this._lastResyncErrorAt<1500))return;let e=!1;for(let[n,r]of this._assign){if(this.getVisualState(n)!=="ok"||this.runtime.getSlotState(n)!=="empty")continue;let a=ht(r);if(a)try{await j.plantSeed(n,a),e=!0}catch{}}e&&await this.refreshFromPlayerGarden()}static defaultHarvestRule(){return{enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[],minInventory:91}}static defaultAutoSellRule(){return{enabled:!1,keepMin:0,minSizePct:50,keepVisual:["Normal"],keepWeather:[],minPlayers:0}}getHarvestRule(e){let n=this._harvestRules[e];return n?JSON.parse(JSON.stringify(n)):null}setHarvestRule(e,n){let r=(s,i,o)=>Math.max(i,Math.min(o,Math.floor(Number(s)||0))),a={enabled:!!n.enabled,minScalePct:r(n.minScalePct??50,50,100),visualIncludeNormal:!!n.visualIncludeNormal,visualMutations:Array.isArray(n.visualMutations)?[...n.visualMutations]:[],weatherMode:["ANY","ALL","RECIPES"].includes(n.weatherMode)?n.weatherMode:"ANY",weatherSelected:Array.isArray(n.weatherSelected)?[...n.weatherSelected]:[],weatherRecipes:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(s=>Array.isArray(s)?[...s]:[]):[],minInventory:r(n.minInventory??0,0,91)};this._harvestRules[e]=a,this._compileRule(e,a),this._rebuildEnabledBases(),ir(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(a))}),this._recomputeAutoHarvestLoop()}getAutoHarvestEnabledForSeed(e){return!!this._harvestRules[e]?.enabled}setAutoHarvestEnabledForSeed(e,n){let a={...this._harvestRules[e]??Z.defaultHarvestRule(),enabled:!!n};this._harvestRules[e]=a,this._compileRule(e,a),this._rebuildEnabledBases(),ir(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(a))}),this._recomputeAutoHarvestLoop()}getAllHarvestRules(){return JSON.parse(JSON.stringify(this._harvestRules))}_anyAutoHarvestEnabled(){return this._enabledBases.size>0}_recomputeAutoHarvestLoop(){let e=this._anyAutoHarvestEnabled();e&&this._autoHarvestTimer===null?this._autoHarvestTimer=window.setInterval(this._boundTickHarvest,Z.HARVEST_TICK_MS):!e&&this._autoHarvestTimer!==null&&(window.clearInterval(this._autoHarvestTimer),this._autoHarvestTimer=null)}_isPlantObject(e){return(e?.objectType||e?.type||"").toString().toLowerCase().includes("plant")}getSizeCrop(e,n){let r=ht(e)??e,a=Ie(r),s=this._maxScaleByBase.get(a)??1;if(!s||s<=1)return 100;let o=50+(Math.max(1,Math.min(s,Number(n)||1))-1)/(s-1)*50;return Math.max(50,Math.min(100,Math.round(o)))}_seedKeyEnabledForBase(e){return this._enabledBases.has(e)}getAutoSellRule(e){let n=this._autoSellRules[e];return n?JSON.parse(JSON.stringify(n)):null}getAllAutoSellRules(){return JSON.parse(JSON.stringify(this._autoSellRules))}getAutoSellEnabledForSeed(e){return!!this._autoSellRules[e]?.enabled}setAutoSellRule(e,n){let r=(o,u,l)=>Math.max(u,Math.min(l,Math.floor(Number(o)||0))),a=["Normal","Gold","Rainbow"],s=["Wet","Chilled","Frozen","Dawnlit","Amberglow"],i={enabled:!!n.enabled,keepMin:r(n.keepMin??0,0,91),minSizePct:r(n.minSizePct??50,50,100),keepVisual:Array.isArray(n.keepVisual)?[...new Set(n.keepVisual.filter(o=>a.includes(o)))]:["Normal"],keepWeather:Array.isArray(n.keepWeather)?[...new Set(n.keepWeather.filter(o=>s.includes(o)))]:[],minPlayers:r(n.minPlayers??0,0,6)};this._autoSellRules[e]=i,xa(this._autoSellRules),this.emit({type:"auto-sell-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(i))}),this._scheduleAutoSell("rules")}static toVisualMask(e){let n=0;for(let r of e)r==="Gold"?n|=Z.V_GOLD:r==="Rainbow"&&(n|=Z.V_RAINBOW);return n}static toWeatherMask(e){let n=0;for(let r of e)r==="Wet"?n|=Z.W_WET:r==="Chilled"?n|=Z.W_CHILLED:r==="Frozen"?n|=Z.W_FROZEN:r==="Dawnlit"?n|=Z.W_DAWNLIT:r==="Amberglow"&&(n|=Z.W_AMBER);return n}static mutsToMasks(e){let n=0,r=0;if(!Array.isArray(e))return[0,0];for(let a=0;a<e.length;a++)switch(e[a]){case"Gold":n|=Z.V_GOLD;break;case"Rainbow":n|=Z.V_RAINBOW;break;case"Wet":r|=Z.W_WET;break;case"Chilled":r|=Z.W_CHILLED;break;case"Frozen":r|=Z.W_FROZEN;break;case"Dawnlit":r|=Z.W_DAWNLIT;break;case"Amberglow":r|=Z.W_AMBER;break;default:break}return[n,r]}_compileRule(e,n){let r={enabled:!!n.enabled,minScalePct:Math.min(100,Math.max(50,Math.floor(n.minScalePct??50))),allowNormal:!!n.visualIncludeNormal,visualMaskWanted:Z.toVisualMask(n.visualMutations||[]),weatherMode:n.weatherMode,weatherMask:Z.toWeatherMask(n.weatherSelected||[]),recipeMasks:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(Z.toWeatherMask):[],minInventory:Math.max(0,Math.floor(n.minInventory??0))};this._compiledRules.set(e,r)}_rebuildCompiledRulesAndEnabledBases(){this._compiledRules.clear();for(let[e,n]of Object.entries(this._harvestRules))this._compileRule(e,n);this._rebuildEnabledBases()}_rebuildEnabledBases(){this._enabledBases.clear();for(let[e,n]of this._baseToKeys)n.some(r=>this._harvestRules[r]?.enabled)&&this._enabledBases.add(e)}_getPrimarySeedKeyForBase(e){return this._basePrimary.get(e)??null}_passesMutationRulesCompiled(e,n,r){if(!e.enabled)return!1;if(n===0){if(!e.allowNormal)return!1}else if(e.visualMaskWanted!==0&&!(n&e.visualMaskWanted))return!1;if(e.weatherMode==="ANY")return e.weatherMask===0?!0:(r&e.weatherMask)!==0;if(e.weatherMode==="ALL")return e.weatherMask===0?!0:(r&e.weatherMask)===e.weatherMask;if(!e.recipeMasks.length)return!0;for(let s=0;s<e.recipeMasks.length;s++){let i=e.recipeMasks[s];if((r&i)===i)return!0}return!1}_rebuildInvCountsFromArray(e){let n=new Map;for(let r of Array.isArray(e)?e:[]){let a=this.seedKeyFromSpecies(r?.species||"")||null;a&&n.set(a,(n.get(a)||0)+1)}this._invCountBySeedKey=n}_getStockForBase(e){let n=this._baseToKeys.get(e);if(!n||!n.length)return 0;let r=0;for(let a of n)r+=this._invCountBySeedKey.get(a)||0;return r}async _tickAutoHarvest(){if(!this._isHarvestTicking&&this._anyAutoHarvestEnabled()){if(this._isHarvestTicking=!0,this._invCountBySeedKey.size===0&&j.getCropInventoryState)try{let e=await j.getCropInventoryState();Array.isArray(e)&&this._rebuildInvCountsFromArray(e)}catch{}try{let e=await j.getGardenState(),n=Date.now(),r=e?.tileObjects??{};this._scratchPairs.length=0;let a=new Map,s=10;e:for(let[o,u]of Object.entries(r)){let l=Number(o);if(!Number.isInteger(l)||!this._isPlantObject(u))continue;let p=u?.species||u?.name||u?.title;if(!p)continue;let T=ht(p)??p,C=Ie(T);if(!this._seedKeyEnabledForBase(C))continue;let M=this._getPrimarySeedKeyForBase(C);if(!M)continue;let b=this._compiledRules.get(M);if(!b||!b.enabled)continue;let w=a.get(C);if(w===void 0){let g=Math.max(0,b.minInventory||0);if(g>0){let S=this._getStockForBase(C),R=g-S;if(R<=0)continue;w=R}else w=1/0;a.set(C,w)}else if(w<=0)continue;this._scratchMature.length=0;let f=Array.isArray(u?.slots)?u.slots:[];for(let g=0;g<f.length;g++){let S=f[g]?.endTime;typeof S=="number"&&S<=n&&this._scratchMature.push(g)}if(this._scratchMature.length!==0)for(let g=0;g<this._scratchMature.length;g++){let S=this._scratchMature[g],R=u?.slots?.[S],D=R?.targetScale??1;if(this.getSizeCrop(p,D)<(b.minScalePct||50))continue;let[G,O]=Z.mutsToMasks(R?.mutations);if(this._passesMutationRulesCompiled(b,G,O)){if(w!==1/0&&w<=0||(this._scratchPairs.push({slot:l,sub:S}),w!==1/0&&(w-=1,a.set(C,w),w<=0)))break;if(this._scratchPairs.length>=s)break e}}}let i=!1;for(let o=0;o<this._scratchPairs.length;o++){let{slot:u,sub:l}=this._scratchPairs[o];try{await j.harvestCrop(u,l),i=!0}catch{}}i&&await this.refreshFromPlayerGarden()}finally{this._isHarvestTicking=!1}}}seedKeyFromSpecies(e){if(!e)return null;let n=Ie(e),r=this._speciesToKey.get(n);if(r)return r;let a=ht(e);if(!a)return null;let s=Ie(a);return this._basePrimary.get(s)??this._baseToKeys.get(s)?.[0]??null}sizePercent(e,n){return this.getSizeCrop(e,n)}_hasVisual(e,n){let r=Array.isArray(e?.mutations)?e.mutations:[];return n==="Normal"?!(r.includes("Gold")||r.includes("Rainbow")):r.includes(n)}_hasWeather(e,n){return(Array.isArray(e?.mutations)?e.mutations:[]).includes(n)}async _runAutoSell(e){let n=(()=>{try{return localStorage.getItem("qws:autoSell:dbg")==="1"}catch{return!1}})(),r=(...s)=>{if(n)try{console.debug("[AutoSell]",...s)}catch{}},a=s=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:0}).format(s);try{let[s,i]=await Promise.all([j.getCropInventoryState?.()??null,j.getFavoriteIds?.()??[]]),o=Array.isArray(s)?s:[],u=new Set(Array.isArray(i)?i:[]),l=this._lastKnownPlayers;if(!o.length){r("skip: inventory empty");return}let p=new Map;for(let f of o){let g=this.seedKeyFromSpecies(f?.species||"")||"__unknown__";(p.get(g)??p.set(g,[]).get(g)).push(f)}let T=[];for(let[f,g]of p){let S=this._autoSellRules[f];if(!S?.enabled){r("seed skip: disabled",f);continue}if(l<(S.minPlayers||0)){r("seed skip: minPlayers",{seedKey:f,numPlayers:l,need:S.minPlayers||0});continue}let R=g.map(q=>({it:q,size:this.sizePercent(q?.species||"",Number(q?.scale)||1)})).sort((q,oe)=>oe.size-q.size),D=[];for(let{it:q,size:oe}of R)[...S.keepVisual||[]].some(J=>this._hasVisual(q,J))||[...S.keepWeather||[]].some(J=>this._hasWeather(q,J))||oe<(S.minSizePct||50)||D.push({it:q,size:oe});let G=D.filter(q=>!u.has(q.it.id)),O=Math.max(0,S.keepMin|0);if(G.length<=O){r("seed keep all (pool <= keepMin)",{seedKey:f,pool:G.length,keepMin:O});continue}for(let q=O;q<G.length;q++)T.push(G[q].it.id);r("seed sell add",{seedKey:f,count:G.length-O})}if(T.length===0){r("no sell candidates");return}let C=new Set(T),M=[];for(let f of o){let g=String(f.id);C.has(g)||u.has(g)||M.push(g)}r("tempFavAdds",M.length);let b=0;try{b=Number(await Vt?.get?.())||0}catch{}for(let f of M)try{await j.toggleFavoriteItem(f)}catch(g){r("tempFav add err",f,g)}try{let f=Number(await Vt?.get?.());Number.isFinite(f)&&f>=0&&(b=f)}catch{}let w=!1;try{j.sellNow?await j.sellNow("autosell"):await j.sellAllCrops(),w=!0,r("sell done",{sold:T.length})}catch(f){r("sell error",f)}try{let f="Auto-Sell";if(w){let g=a(Math.max(0,b));typeof pe=="function"&&pe(f,b>0?`Sold (~${g}\u{1F4B0})`:"Sold successfully","success")}else typeof pe=="function"&&pe(f,"Sell failed","error")}catch{}for(let f of M)try{await j.toggleFavoriteItem(f)}catch(g){r("restore err",f,g)}}catch(s){console.debug("[AutoSell] ERROR:",s)}}};W(Z,"TICK_MS",350),W(Z,"RESYNC_EVERY_TICKS",10),W(Z,"HARVEST_TICK_MS",1e3),W(Z,"V_GOLD",1),W(Z,"V_RAINBOW",2),W(Z,"W_WET",1),W(Z,"W_CHILLED",2),W(Z,"W_FROZEN",4),W(Z,"W_DAWNLIT",8),W(Z,"W_AMBER",16);var gn=Z,qt=new gn;function cr(t){for(let e of t){let n=document.querySelector(`div[data-slot="${e}"]`);if(!n)continue;let r=n.style.background;n.style.outline="2px solid #88f",setTimeout(()=>{n.style.outline="",n.style.background=r},350)}}function fn(t){let e="qws:pos",n="qws:collapsed",r="qws:hidden";if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>fn(t),{once:!0});return}let s=`
  :root{
    --qws-bg:        #0f1318;
    --qws-panel:     #111823cc;
    --qws-border:    #ffffff22;
    --qws-border-2:  #ffffff14;
    --qws-accent:    #7aa2ff;
    --qws-text:      #e7eef7;
    --qws-text-dim:  #b9c3cf;
    --qws-blur:      8px;
    --qws-shadow:    0 10px 36px rgba(0,0,0,.45);
  }

  /* ---------- HUD floating box ---------- */
  .qws2{
    position:fixed; right:16px; bottom:16px; z-index:999998;
    font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color:var(--qws-text);
    background:var(--qws-panel);
    border:1px solid var(--qws-border);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:var(--qws-shadow);
    backdrop-filter:blur(var(--qws-blur));
    min-width:160px;
    display:flex; flex-direction:column; gap:8px;
  }
  .qws2.hidden{ display:none }
  .qws2 .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .qws2 .col{ display:flex; flex-direction:column; gap:4px }
  .qws2 .title{ font-weight:700; letter-spacing:.2px }
  .qws2 .sp{ flex:1 }

  .qws2 .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 8px; border-radius:999px;
    border:1px solid #ffffff26;
    background:rgba(255,255,255,.06);
    color:var(--qws-text);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  }
  .qws2 .ok{   background:rgba(36, 161, 72, .20);  border-color:#48d17066 }
  .qws2 .warn{ background:rgba(241, 194, 27, .18); border-color:#ffd65c66 }
  .qws2 .bad{  background:rgba(218, 30, 40, .20);  border-color:#ff7c8666 }

  .qws2 .btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:6px 10px;
    background:linear-gradient(180deg, #ffffff12, #ffffff06);
    color:#fff;
    transition:transform .1s ease, background .18s ease, border-color .18s ease;
  }
  .qws2 .btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws2 .btn:active{ transform:translateY(1px) }
  .qws2 .drag{ cursor:move; opacity:.9 }

  .qws2 .mini{ display:none }
  .qws2.min .mini{ display:inline-flex }
  .qws2.min .body{ display:none }

  /* Launcher always shown */
  .qws-launch{ margin-top:4px; border-top:1px solid var(--qws-border); padding-top:6px; display:block }
  .qws-launch .launch-item{ display:flex; align-items:center; gap:8px; margin:4px 0 }
  .qws-launch .launch-item .name{ flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .qws-launch .launch-item .btn.active{
    background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.12));
    border-color:#9db7ff66;
  }

  /* ---------- Windows ---------- */
  .qws-win{
    position:fixed; z-index:999999; min-width:260px; max-width:900px; max-height:90vh; overflow:auto;
    background:var(--qws-panel); color:var(--qws-text);
    border:1px solid var(--qws-border); border-radius:12px;
    box-shadow:var(--qws-shadow); backdrop-filter:blur(var(--qws-blur));
  }
  .qws-win .w-head{
    display:flex; align-items:center; gap:8px; padding:10px 12px;
    border-bottom:1px solid var(--qws-border); cursor:move;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .qws-win .w-title{ font-weight:700 }
  .qws-win .sp{ flex:1 }
  .qws-win .w-btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:4px 8px; background:linear-gradient(180deg, #ffffff12, #ffffff06); color:#fff;
  }
  .qws-win .w-btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws-win .w-body{ padding:12px }

  /* Inputs inside windows */
  .qws-win input[type="text"], .qws-win input[type="number"]{
    width:120px; padding:8px 10px; border-radius:10px;
    border:1px solid var(--qws-border); background:rgba(0,0,0,.42); color:#fff;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  }
  .qws-win .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
  `,i=document.createElement("style");i.textContent=s,(document.documentElement||document.body).appendChild(i);let o=document.createElement("div");o.className="qws2",o.innerHTML=`
    <div class="row drag">
      <div class="title">Arie's Mod</div>
      <div class="sp"></div>
      <span id="qws2-status-mini" class="pill warn mini">\u2026</span>
      <button id="qws2-min" class="btn" title="Minimize/Expand">\u2013</button>
      <button id="qws2-hide" class="btn" title="Hide (Alt+X)">\u2715</button>
    </div>

    <!-- Status & store side-by-side (no mode label) -->
    <div class="row" style="margin:2px 0 2px 0;">
      <span id="qws2-status2" class="pill warn">WS: \u2026</span>
      <span id="qws2-store" class="pill warn">store: \u2026</span>
    </div>

    <div class="body">
      <div id="qws-launch" class="qws-launch"></div>
    </div>
  `,(document.documentElement||document.body).appendChild(o);function u(m){let L=m.getBoundingClientRect(),d=window.innerWidth,c=window.innerHeight,x=parseFloat(getComputedStyle(m).right)||d-L.right,y=parseFloat(getComputedStyle(m).bottom)||c-L.bottom,A=Math.max(8,d-L.width-8),h=Math.max(8,c-L.height-8);x=Math.min(Math.max(x,8),A),y=Math.min(Math.max(y,8),h),m.style.right=x+"px",m.style.bottom=y+"px"}function l(m){u(m);let L=m.getBoundingClientRect(),c=m.querySelector(".w-head")?.getBoundingClientRect()||L,x=window.innerWidth,y=window.innerHeight,A=8,h=parseFloat(getComputedStyle(m).right);Number.isNaN(h)&&(h=x-L.right);let H=parseFloat(getComputedStyle(m).bottom);Number.isNaN(H)&&(H=y-L.bottom);let U=Math.max(A,x-L.width-A),_=Math.max(A,y-L.height-A);if(c.top<A){let F=A-c.top;H=Math.max(A,Math.min(_,H-F))}if(L.left<A){let F=A-L.left;h=Math.max(A,Math.min(U,h-F))}m.style.right=h+"px",m.style.bottom=H+"px"}function p(m){m.style.right="16px",m.style.bottom="16px",l(m)}function T(m,L){let d=m.getBoundingClientRect(),c=window.innerHeight,x=parseFloat(getComputedStyle(m).bottom);Number.isNaN(x)&&(x=c-d.bottom),L(),requestAnimationFrame(()=>{let y=m.getBoundingClientRect(),A=y.top-d.top,h=x+A,H=Math.max(8,c-y.height-8);h=Math.min(Math.max(8,h),H),m.style.bottom=h+"px",l(m)})}function C(){try{let m=parseFloat(o.style.right)||16,L=parseFloat(o.style.bottom)||16;localStorage.setItem(e,JSON.stringify({r:m,b:L}))}catch{}}try{let m=JSON.parse(localStorage.getItem(e)||"null");if(m&&typeof m.r=="number"&&typeof m.b=="number"&&(o.style.right=m.r+"px",o.style.bottom=m.b+"px"),localStorage.getItem(n)==="1"){o.classList.add("min");let L=o.querySelector("#qws2-min");L&&(L.textContent="+")}localStorage.getItem(r)==="1"&&o.classList.add("hidden"),requestAnimationFrame(()=>u(o)),window.addEventListener("resize",()=>u(o))}catch{}let M=o.querySelector(".drag"),b=o.querySelector("#qws2-min"),w=o.querySelector("#qws2-hide"),f=o.querySelector("#qws2-status-mini"),g=o.querySelector("#qws2-status2"),S=o.querySelector("#qws2-store"),R=o.querySelector("#qws-launch");if(!M||!b||!w||!f||!g||!S||!R){console.warn("[QuinoaWS] HUD elements missing, abort init");return}let D=R;(function(){let L=0,d=0,c=0,x=0,y=!1;M.addEventListener("mousedown",A=>{y=!0,L=A.clientX,d=A.clientY;let h=o.getBoundingClientRect();c=parseFloat(getComputedStyle(o).right)||window.innerWidth-h.right,x=parseFloat(getComputedStyle(o).bottom)||window.innerHeight-h.bottom,document.body.style.userSelect="none"}),window.addEventListener("mousemove",A=>{if(!y)return;let h=A.clientX-L,H=A.clientY-d,U=c-h,_=x-H,F=o.getBoundingClientRect(),re=window.innerWidth,ee=window.innerHeight,X=Math.max(8,re-F.width-8),v=Math.max(8,ee-F.height-8);U=Math.min(Math.max(U,8),X),_=Math.min(Math.max(_,8),v),o.style.right=U+"px",o.style.bottom=_+"px"}),window.addEventListener("mouseup",()=>{y&&(y=!1,document.body.style.userSelect="",C())})})(),b.onclick=()=>{T(o,()=>{o.classList.toggle("min"),b.textContent=o.classList.contains("min")?"+":"\u2013";try{localStorage.setItem(n,o.classList.contains("min")?"1":"0")}catch{}})},w.onclick=()=>{o.classList.add("hidden");try{localStorage.setItem(r,"1")}catch{}},window.addEventListener("keydown",m=>{let L=(m.target&&m.target.tagName||"").toLowerCase();if(!(L==="input"||L==="textarea"||m.target?.isContentEditable)&&m.altKey&&!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&(m.key==="x"||m.key==="X")){let c=o.classList.toggle("hidden");try{localStorage.setItem(r,c?"1":"0")}catch{}}},!0);let G=new Map,O=0;function q(m,L,d){if(G.has(m)){let _=G.get(m);_.el.style.display="",ye(_.el),$(m,!0);return}let c=document.createElement("div");c.className="qws-win",c.innerHTML=`
      <div class="w-head">
        <div class="w-title"></div>
        <div class="sp"></div>
        <button class="w-btn" data-act="min" title="Minimize/Expand">\u2013</button>
        <button class="w-btn" data-act="close" title="Close">\u2715</button>
      </div>
      <div class="w-body"></div>
    `,(document.documentElement||document.body).appendChild(c);let x=c.querySelector(".w-head"),y=c.querySelector(".w-title"),A=c.querySelector('[data-act="min"]'),h=c.querySelector('[data-act="close"]'),H=c.querySelector(".w-body");y.textContent=L;let U=O++%5*24;c.style.right=16+U+"px",c.style.bottom=16+U+"px",u(c),ye(c),function(){let F=0,re=0,ee=0,X=0,v=!1;x.addEventListener("mousedown",P=>{if(P.target.closest(".w-btn"))return;v=!0,F=P.clientX,re=P.clientY;let B=c.getBoundingClientRect();ee=parseFloat(getComputedStyle(c).right)||window.innerWidth-B.right,X=parseFloat(getComputedStyle(c).bottom)||window.innerHeight-B.bottom,document.body.style.userSelect="none",ye(c)}),window.addEventListener("mousemove",P=>{if(!v)return;let K=P.clientX-F,B=P.clientY-re,z=ee-K,te=X-B,le=c.getBoundingClientRect(),_e=window.innerWidth,bt=window.innerHeight,Ot=Math.max(8,_e-le.width-8),et=Math.max(8,bt-le.height-8);z=Math.min(Math.max(z,8),Ot),te=Math.min(Math.max(te,8),et),c.style.right=z+"px",c.style.bottom=te+"px"}),window.addEventListener("mouseup",()=>{v=!1,document.body.style.userSelect="",be(m,c)})}(),A.onclick=()=>{T(c,()=>{let _=H.style.display==="none";H.style.display=_?"":"none",A.textContent=_?"\u2013":"+"})},h.onclick=()=>{c.style.display="none",$(m,!1)},I(c);try{d(H)}catch(_){H.textContent=String(_)}be(m,c),G.set(m,{id:m,el:c,head:x,body:H}),$(m,!0)}function oe(m){return m.style.display!=="none"}function J(m,L,d){let c=G.get(m);return c?oe(c.el)?(c.el.style.display="none",$(m,!1),!1):(c.el.style.display="",ye(c.el),l(c.el),$(m,!0),!0):(q(m,L,x=>{let y=x.closest(".qws-win");y&&Se(m,y),d(x)}),!0)}function ye(m){let L=999999;G.forEach(d=>{let c=parseInt(getComputedStyle(d.el).zIndex||"999999",10);c>L&&(L=c)}),m.style.zIndex=String(L+1)}function be(m,L){try{let d=parseFloat(L.style.right)||16,c=parseFloat(L.style.bottom)||16;localStorage.setItem(`qws:win:${m}:pos`,JSON.stringify({r:d,b:c}))}catch{}}function Se(m,L){try{let d=localStorage.getItem(`qws:win:${m}:pos`);if(!d)return;let c=JSON.parse(d);typeof c.r=="number"&&(L.style.right=c.r+"px"),typeof c.b=="number"&&(L.style.bottom=c.b+"px"),l(L)}catch{}}window.addEventListener("resize",()=>{G.forEach(m=>l(m.el))});function Me(){let m=null,L=h=>{let H=h;return H&&H.closest?.(".qws-win, .qws2")||null},d=h=>{if(!h.altKey||h.button!==0)return;let H=L(h.target);if(!H||H.style.display==="none")return;let U=H.getBoundingClientRect(),_=window.innerWidth,F=window.innerHeight,re=parseFloat(getComputedStyle(H).right),ee=parseFloat(getComputedStyle(H).bottom);Number.isNaN(re)&&(re=_-U.right),Number.isNaN(ee)&&(ee=F-U.bottom),m={el:H,sx:h.clientX,sy:h.clientY,or:re,ob:ee},document.body.style.userSelect="none",ye(H),h.preventDefault(),h.stopPropagation()},c=h=>{if(!m)return;let H=h.clientX-m.sx,U=h.clientY-m.sy,_=m.or-H,F=m.ob-U,re=m.el.getBoundingClientRect(),ee=window.innerWidth,X=window.innerHeight,v=Math.max(8,ee-re.width-8),P=Math.max(8,X-re.height-8);_=Math.min(Math.max(_,8),v),F=Math.min(Math.max(F,8),P),m.el.style.right=`${_}px`,m.el.style.bottom=`${F}px`},x=()=>{if(!m)return;document.body.style.userSelect="",u(m.el);let h=m.el,H=!1;G.forEach(U=>{U.el===h&&!H&&(be(U.id,h),H=!0)}),!H&&h===o&&C(),m=null},y=()=>x(),A=h=>{(h.key==="Alt"||h.key==="AltGraph")&&x()};window.addEventListener("mousedown",d,!0),window.addEventListener("mousemove",c,!0),window.addEventListener("mouseup",y,!0),window.addEventListener("keyup",A,!0)}function I(m){let L=x=>{if(!x||!(x instanceof HTMLElement))return!1;if(x instanceof HTMLTextAreaElement)return!0;if(x instanceof HTMLInputElement){let y=(x.type||"").toLowerCase();return y==="text"||y==="number"||y==="search"}return x.isContentEditable===!0},d=x=>{let y=x.target,A=document.activeElement,h=H=>!!(H&&(m.contains(H)||H.closest?.(".qws-win")||H.closest?.(".qws2")));(h(y)&&L(y)||h(A)&&L(A))&&(x.stopPropagation(),x.stopImmediatePropagation?.())},c=["keydown","keypress","keyup"];return c.forEach(x=>{window.addEventListener(x,d,{capture:!0}),document.addEventListener(x,d,{capture:!0}),m.addEventListener(x,d,{capture:!0})}),()=>{c.forEach(x=>{window.removeEventListener(x,d,{capture:!0}),document.removeEventListener(x,d,{capture:!0}),m.removeEventListener(x,d,{capture:!0})})}}let N=[],E=new Map;function $(m,L){let d=E.get(m);d&&(d.textContent=L?"Close":"Open",d.dataset.open=L?"1":"0",L?d.classList.add("active"):d.classList.remove("active"))}function ce(m,L,d){N.push({id:m,title:L,render:d}),ge(m,L,d)}function ge(m,L,d){let c=document.createElement("div");c.className="launch-item",c.innerHTML=`<div class="name">${Ge(L)}</div>`;let x=document.createElement("button");x.className="btn",x.textContent="Open",x.dataset.open="0",E.set(m,x),x.onclick=()=>{let y=G.get(m);y&&y.el.style.display!=="none"?(y.el.style.display="none",$(m,!1)):(q(m,L,A=>{let h=A.closest(".qws-win");h&&Se(m,h),d(A)}),$(m,!0))},c.appendChild(x),R.appendChild(c)}try{t?.onRegister?.(ce)}catch{}I(o),Me(),(async()=>{try{await Ee()}catch{}})(),setInterval(()=>{try{let m=Q();f.textContent="OPEN",g.textContent="WS: OPEN",fe(f,"ok"),fe(g,"ok")}catch{let m=!!window.__QWS_workerFound||St;f.textContent=m?"Worker":"none",g.textContent="WS: "+(m?"via Worker":"none"),fe(f,m?"ok":"warn"),fe(g,m?"ok":"warn")}try{let m=Ye(),L=In();m?(S.textContent=`store: ${L.via||"ready"}`,fe(S,"ok")):L.via==="polyfill"||L.polyfill?(S.textContent="store: polyfill",fe(S,"warn")):(S.textContent="store: none",fe(S,"bad"))}catch{S.textContent="store: error",fe(S,"bad")}},800);function Q(){for(let m=0;m<we.length;m++)if(we[m].readyState===ve.OPEN)return we[m];throw new Error("no page ws")}function fe(m,L){m.classList.remove("ok","warn","bad"),L&&m.classList.add(L)}function Ge(m){return m.replace(/[&<>"']/g,L=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[L])}}function dr(t){(async()=>(t||(await Y.startAutofeedWatcher(({petId:e,species:n,hungerPct:r,allowedCrops:a})=>{}),await He.onQuantityChange("seeds",ft("seeds")),await He.onQuantityChange("tools",ft("tools")),await He.onQuantityChange("eggs",ft("eggs")),await He.onQuantityChange("decor",ft("decor")),await qt.syncNow().catch(()=>{})),await j.onGardenDiffNow(async(e,n)=>{await qt.syncNow().catch(()=>{}),cr([...n.added,...n.updated,...n.removed])}),await Y.startAbilityLogsWatcher()))()}var bn=t=>{let e=new Date(t),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`},Pa=t=>t.replace(/[<>&]/g,e=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[e]),Sn=class{constructor(e=2e3){this.max=e;W(this,"arr",[])}push(e){this.arr.push(e),this.arr.length>this.max&&this.arr.splice(0,this.arr.length-this.max)}toArray(){return this.arr.slice()}clear(){this.arr.length=0}},Ze=new Map,ur=!1;function Ta(t){ur?we.forEach(e=>{Ze.has(e)||hn(e,"late",t)}):(window.WebSocket===ve&&(window.WebSocket=new Proxy(ve,{construct(e,n,r){let a=Reflect.construct(e,n,r);return hn(a,"new",t),a}})),we.forEach(e=>hn(e,"existing",t)),ur=!0)}function hn(t,e,n){if(Ze.has(t))return;let r=`WS#${1+Ze.size} (${wt(t.readyState)})`,a={ws:t,id:r,listeners:[]};we.includes(t)||we.push(t),qe?.(t,e);let s=u=>{let l="";try{l=typeof u.data=="string"?u.data:JSON.stringify(u.data)}catch{l=String(u.data)}n({t:Date.now(),dir:"in",text:l,ws:t})};t.addEventListener("message",s),a.listeners.push(()=>t.removeEventListener("message",s));let i=()=>{a.id=a.id.replace(/\(.*\)/,`(${wt(t.readyState)})`)},o=()=>{a.id=a.id.replace(/\(.*\)/,`(${wt(t.readyState)})`)};if(t.addEventListener("open",i),t.addEventListener("close",o),a.listeners.push(()=>t.removeEventListener("open",i)),a.listeners.push(()=>t.removeEventListener("close",o)),!a.sendOrig){let u=t.send.bind(t);a.sendOrig=u,t.send=l=>{try{let p=typeof l=="string"?l:JSON.stringify(l);n({t:Date.now(),dir:"out",text:p,ws:t})}catch{n({t:Date.now(),dir:"out",text:String(l),ws:t})}return u(l)}}Ze.set(t,a)}async function mr(t){let e=new Ce({id:"debug-tools",compact:!0});e.mount(t),e.addTab("jotai","Jotai",n=>Ia(n,e)),e.addTab("websocket","WebSocket",n=>Ca(n,e))}function Ia(t,e){t.innerHTML="";let n=e.section("Store"),r=e.btn("Capture store",async()=>{try{await Ee()}catch{}a.textContent=`captured: ${String(Ye())}`,l({capture:Ye()})}),a=e.label(`captured: ${String(Ye())}`);n.appendChild(e.row(r,a)),t.appendChild(n);let s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",s.style.gap="12px",t.appendChild(s);{let w=e.section("Find / List atoms"),f=e.inputText("regex label (eg: position|health)",""),g=e.btn("List",()=>D()),S=e.btn("Copy",()=>C(R.textContent||"")),R=document.createElement("pre");b(R);async function D(){let G=f.value.trim(),O=M(G||".*"),J=tt(/.*/).filter(ye=>O.test(String(ye?.debugLabel||ye?.label||""))).map(ye=>String(ye?.debugLabel||ye?.label||"<?>"));R.textContent=J.join(`
`),l({list:{query:G||".*",count:J.length}})}w.appendChild(e.row(f,g,S)),w.appendChild(R),s.appendChild(w)}{let w=e.section("Get / Subscribe"),f=e.inputText("atom label (eg: positionAtom)",""),g=e.btn("Get",async()=>{let O=de(f.value.trim());if(!O){D.textContent=`Atom "${f.value}" not found`;return}try{p(D,await Pe(O)),l({get:{label:f.value,ok:!0}})}catch(q){p(D,q?.message||String(q)),l({get:{label:f.value,ok:!1,error:q?.message}})}}),S=e.btn("Subscribe",async()=>{let O=f.value.trim();if(!O)return;let q=de(O);if(!q)return l(`Atom "${O}" not found`);if(G){G(),G=null,S.textContent="Subscribe",l({sub:{label:O,status:"unsubscribed"}});return}G=await Je(q,async()=>{try{p(D,await Pe(q))}catch{}}),S.textContent="Unsubscribe",l({sub:{label:O,status:"subscribed"}})}),R=e.btn("Copy",()=>C(D.textContent||"")),D=document.createElement("pre");b(D);let G=null;w.appendChild(e.row(f,g,S,R)),w.appendChild(D),s.appendChild(w)}{let w=e.section("Set atom"),f=e.inputText("atom label (eg: activeModalAtom)",""),g=e.btn("Set",async()=>{let D=f.value.trim(),G=de(D);if(!G)return l(`Atom "${D}" not found`);let O;try{O=JSON.parse(R.value)}catch{return T("Invalid JSON")}try{await Te(G,O),l({set:{label:D,ok:!0}})}catch(q){l({set:{label:D,ok:!1,error:q?.message}})}}),S=e.btn("Copy json",()=>C(R.value)),R=document.createElement("textarea");R.className="qmm-input",R.style.minHeight="120px",R.style.width="100%",R.placeholder='JSON value, eg: "inventory" or { "x": 1, "y": 2 }',w.appendChild(e.row(f,g,S)),w.appendChild(R),s.appendChild(w)}let i=e.section("Output"),o=e.row(e.label("\u2014"),(()=>{let w=document.createElement("div");return w.style.flex="1",w})(),e.btn("Copy",()=>C(u.textContent||"")),e.btn("Clear",()=>u.textContent="")),u=document.createElement("pre");b(u),i.appendChild(o),i.appendChild(u),t.appendChild(i);function l(w){let f=bn(Date.now());try{u.textContent+=`[${f}] ${JSON.stringify(w)}
`}catch{u.textContent+=`[${f}] ${String(w)}
`}u.scrollTop=u.scrollHeight}function p(w,f){w.textContent=typeof f=="string"?f:JSON.stringify(f,null,2)}function T(w){try{window.toastSimple?.(w,"","warn")}catch{}}function C(w){let f=String(w??"");if(!f.length)return;let g=()=>{let S=document.createElement("textarea");S.value=f,S.setAttribute("readonly","true"),S.style.position="fixed",S.style.left="-9999px",S.style.opacity="0",document.body.appendChild(S),S.focus(),S.select();let R=!1;try{R=document.execCommand("copy")}catch{}document.body.removeChild(S);try{window.toastSimple?.(R?"Copied":"Copy failed","",R?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(f).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(g):g()}function M(w){try{return new RegExp(w,"i")}catch{return/.*/i}}function b(w){w.style.maxHeight="260px",w.style.overflow="auto",w.style.background="#0f1318",w.style.border="1px solid #ffffff14",w.style.borderRadius="8px",w.style.padding="8px",w.style.margin="6px 0",w.style.fontSize="12px",w.style.color="#e7eef7"}}function Ca(t,e){t.innerHTML="";let n=new Sn(2e3),r=new Map,a=0,s=!1,i=!0,o=!0,u=!0,l="",p=!1,T=!1,C=null,M=[],b=()=>{let v=document.createElement("div");return v.style.flex="1",v},w=v=>{if(C=v,[...Q.querySelectorAll("[data-fid]")].forEach(P=>{P.classList.toggle("selected",String(v||"")===P.dataset.fid)}),v!=null){let P=r.get(v);P&&(m.value=P.text)}},f=v=>M.some(P=>P.test(v));function g(v){let P=String(v??"");if(!P.length)return;let K=()=>{let B=document.createElement("textarea");B.value=P,B.setAttribute("readonly","true"),B.style.position="fixed",B.style.left="-9999px",B.style.opacity="0",document.body.appendChild(B),B.focus(),B.select();let z=!1;try{z=document.execCommand("copy")}catch{}document.body.removeChild(B);try{window.toastSimple?.(z?"Copied":"Copy failed","",z?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(P).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(K):K()}let S=e.section("Live log"),R=e.label("\u2014"),D=e.checkbox(!0);D.addEventListener("change",()=>{o=D.checked,F(!0)});let G=e.checkbox(!0);G.addEventListener("change",()=>{u=G.checked,F(!0)});let O=e.inputText("filter text (case-insensitive)","");O.addEventListener("input",()=>{l=O.value.trim().toLowerCase(),F(!0)});let q=e.checkbox(!1);q.addEventListener("change",()=>{p=q.checked,F(!0)});let oe=e.btn("Pause",()=>{s=!s,oe.textContent=s?"Resume":"Pause"}),J=e.btn("Clear",()=>{n.clear(),r.clear(),w(null),F(!0)}),ye=e.btn("Copy visible",()=>re());S.appendChild(e.row(R,b(),D,e.label("IN"),G,e.label("OUT"),O,q,e.label("Current socket only"),oe,J,ye)),t.appendChild(S);let be=e.section("Mutes (exclude by regex)"),Se=e.inputText("add regex (e.g. ping|keepalive)",""),Me=e.btn("Add",()=>{let v=Se.value.trim();if(v)try{M.push(new RegExp(v,"i")),Se.value="",N(),F(!0)}catch{}}),I=document.createElement("div");I.style.display="flex",I.style.flexWrap="wrap",I.style.gap="6px";function N(){I.innerHTML="",M.forEach((v,P)=>{let K=document.createElement("button");K.className="qmm-btn",K.textContent=`/${v.source}/i \xD7`,K.title="Remove",K.onclick=()=>{M.splice(P,1),N(),F(!0)},I.appendChild(K)})}be.appendChild(e.row(Se,Me)),be.appendChild(I),t.appendChild(be);let E=e.section("Sockets"),$=document.createElement("select");$.className="qmm-input",$.style.minWidth="260px",E.appendChild($),t.appendChild(E);function ce(){let v=Array.from(Ze.values());$.innerHTML="",v.forEach((P,K)=>{let B=document.createElement("option");B.value=String(K),B.textContent=P.id+(P.ws===Fe?" \u2022 page":""),$.appendChild(B)}),!$.value&&$.options.length&&($.value="0"),R.textContent=A()}function ge(){let v=Number($.value),P=Array.from(Ze.values());return Number.isFinite(v)?P[v]?.ws??null:null}let Q=document.createElement("div");Q.style.border="1px solid #ffffff14",Q.style.borderRadius="10px",Q.style.background="#0f1318",Q.style.padding="6px",Q.style.maxHeight="46vh",Q.style.overflow="auto",Q.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",Q.style.fontSize="12px",Q.style.lineHeight="1.3",Q.style.userSelect="text";let fe=document.createElement("style");fe.textContent=`
    .ws-row{display:grid;grid-template-columns:92px 18px 1fr auto;gap:8px;padding:3px 4px;border-bottom:1px dashed #ffffff12;align-items:start}
    .ws-row .ts{opacity:.8}
    .ws-row .arrow{font-weight:600}
    .ws-row .body{white-space:pre-wrap;word-break:break-word}
    .ws-row .acts{display:none;gap:6px}
    .ws-row:hover .acts{display:flex}
    .ws-row.selected{background:rgba(120,160,255,.12)}
    .ws-row .chip{border:1px solid #ffffff26;background:#ffffff14;border-radius:6px;padding:2px 6px;cursor:pointer}
  `,Q.appendChild(fe),t.appendChild(Q);let Ge=e.section("Send"),m=document.createElement("textarea");m.className="qmm-input",m.style.width="100%",m.style.minHeight="120px",m.placeholder="Select a frame or paste a payload here. Choose Text or JSON below.";let L=e.radioGroup("ws-send-mode",[{value:"text",label:"Text"},{value:"json",label:"JSON"}],"text",()=>{}),d=e.checkbox(!1);d.addEventListener("change",()=>{T=d.checked});let c=e.btn("Send",()=>X()),x=e.btn("Copy payload",()=>g(m.value));Ge.appendChild(m),Ge.appendChild(e.row(L,d,e.label("Use source WS"),c,x)),t.appendChild(Ge),Ta(v=>{if(s)return;let P={...v,id:++a};n.push(P),r.set(P.id,P),R.textContent=A(),_(P)}),ce(),F(!0);let y=window.setInterval(()=>{ce()},1e3);t.__ws_cleanup__=()=>{window.clearInterval(y)};function A(){return`status: ${we.some(K=>K.readyState===WebSocket.OPEN)?"OPEN":"none"} \u2022 mode: ${St?"worker":"page/auto"}`}function h(v){return!(v.dir==="in"&&!o||v.dir==="out"&&!u||l&&!v.text.toLowerCase().includes(l)||p&&v.ws&&ge()&&v.ws!==ge()||f(v.text))}function H(v,P){let K=document.createElement("div");K.className="acts";let B=document.createElement("button");B.className="qmm-btn",B.textContent="Copy",B.onclick=le=>{le.stopPropagation(),g(P.text)};let z=document.createElement("button");z.className="qmm-btn",z.textContent="\u2192 Editor",z.onclick=le=>{le.stopPropagation(),m.value=P.text,w(v)};let te=document.createElement("button");return te.className="qmm-btn",te.textContent="Replay",te.title="Send right away (to current WS or source WS if enabled)",te.onclick=le=>{le.stopPropagation(),ee(P)},K.append(B,z,te),K}function U(v){let P=document.createElement("div");P.className="ws-row",P.dataset.fid=String(v.id);let K=document.createElement("div");K.className="ts",K.textContent=bn(v.t);let B=document.createElement("div");B.className="arrow",B.textContent=v.dir==="in"?"\u2190":"\u2192",B.style.color=v.dir==="in"?"#4bd17a":"#8ab4ff";let z=document.createElement("div");z.className="body",z.innerHTML=`<code>${Pa(v.text)}</code>`;let te=H(v.id,v);return P.append(K,B,z,te),P.onclick=()=>w(v.id),P.ondblclick=()=>{m.value=v.text,w(v.id)},P}function _(v){if(!h(v))return;let P=U(v);Q.appendChild(P),i&&(Q.scrollTop=Q.scrollHeight)}function F(v=!1){Q.querySelectorAll(".ws-row").forEach(P=>P.remove()),n.toArray().forEach(P=>{h(P)&&Q.appendChild(U(P))}),C!=null&&w(C),i&&(Q.scrollTop=Q.scrollHeight)}function re(){let v=n.toArray().filter(P=>h(P)).map(P=>`[${bn(P.t)}] ${P.dir==="in"?"<-":"->"} ${P.text}`).join(`
`);g(v)}function ee(v){let P=T&&v.ws?v.ws:ge();if(!P||P.readyState!==WebSocket.OPEN)return;if((L.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{P.send(JSON.parse(v.text))}catch{P.send(v.text)}else P.send(v.text)}function X(){let v=ge(),P=C!=null&&T?r.get(C)?.ws??null:null,K=(T?P:v)||v;if(!K||K.readyState!==WebSocket.OPEN)return;if((L.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{K.send(JSON.parse(m.value))}catch{K.send(m.value)}else K.send(m.value)}}function Ma(t){if(!t||typeof t!="object")return[];let e=[],n=new Set,r=[t];for(;r.length;){let s=r.pop();if(!(!s||typeof s!="object"||n.has(s))){n.add(s);for(let i of Object.keys(s)){let o=s[i];Array.isArray(o)&&o.length&&o.every(u=>u&&typeof u=="object")&&o.some(l=>"id"in l&&"name"in l)&&/player/i.test(i)&&e.push(...o),o&&typeof o=="object"&&r.push(o)}}}let a=new Map;for(let s of e)s?.id&&a.set(String(s.id),s);return[...a.values()]}function Ea(t){let e=t?.fullState?.data?.players??t?.data?.players??t?.players;return Array.isArray(e)?e:Ma(t)}function yr(t){let e=t?.child?.data?.userSlots??t?.fullState?.child?.data?.userSlots??t?.data?.userSlots;return Array.isArray(e)?e:e&&typeof e=="object"?Object.values(e):[]}function gr(t){let e=t?.data?.position??t?.position??t?.data?.coords??t?.coords,n=Number(e?.x),r=Number(e?.y);return Number.isFinite(n)&&Number.isFinite(r)?{x:n,y:r}:null}function fr(t){let e=t?.data?.inventory;if(!e||typeof e!="object")return null;let n=Array.isArray(e.items)?e.items:[],r=Array.isArray(e.favoritedItemIds)?e.favoritedItemIds:[];return{items:n,favoritedItemIds:r}}function pr(t,e){for(let n of yr(t))if(String(n?.playerId??"")===String(e))return n;return null}function Aa(t,e){let n=new Map;for(let r of yr(e)){if(!r||typeof r!="object")continue;let a=r.playerId!=null?String(r.playerId):"";if(!a)continue;let s=gr(r),i=fr(r);n.set(a,{x:s?.x,y:s?.y,inventory:i??null})}return t.map(r=>{let a=n.get(String(r.id));return a?{...r,...a}:{...r,inventory:null}})}var se={currentTargetId:null,unsub:null,lastPos:null,prevPos:null,steps:0},ke={async list(){let t=await st.get();return t?Aa(Ea(t),t):[]},async onChange(t){return st.sub(async()=>{try{t(await this.list())}catch{}})},async getPosition(t){let e=await st.get();if(!e)return null;let n=pr(e,t);return gr(n)},async getInventory(t){let e=await st.get();if(!e)return null;let n=pr(e,t);return fr(n)},async teleportTo(t){let e=await this.getPosition(t);if(!e)throw new Error("Unknown position for this player");j.teleport(e.x,e.y),pe("Teleport",`Teleported to ${e.x}, ${e.y}`,"success")},async openInventoryPreview(t,e){try{let n=await ke.getInventory(t);if(!n||!Array.isArray(n.items)||n.items.length===0){await pe("Inventory","No usable inventory for this player.","warn");return}await ut(n,{open:!0}),e&&await pe("Inventory",`${e}'s inventory displayed.`,"info")}catch(n){await pe("Inventory",n?.message||"Failed to open inventory.","error")}},async stopFollowing(){if(se.unsub)try{se.unsub()}catch{}se.unsub=null,se.currentTargetId=null,se.lastPos=null,se.prevPos=null,se.steps=0},isFollowing(t){return se.currentTargetId===t},async startFollowing(t){if(se.unsub){try{se.unsub()}catch{}se.unsub=null}se.currentTargetId=t,se.lastPos=null,se.prevPos=null,se.steps=0;let e=await ke.getPosition(t);if(!e){await pe("Follow","Unable to retrieve player position.","error"),se.currentTargetId=null;return}await j.teleport(e.x,e.y),se.lastPos={x:e.x,y:e.y},se.prevPos=null,se.steps=0,se.unsub=await ke.onChange(async n=>{if(se.currentTargetId!==t)return;let r=n.find(i=>i.id===t);if(!r||typeof r.x!="number"||typeof r.y!="number"){this.stopFollowing(),await pe("Follow","The target is no longer trackable (disconnected?).","error");return}let a={x:r.x,y:r.y},s=se.lastPos;if(!s){se.lastPos=a;return}(a.x!==s.x||a.y!==s.y)&&(se.steps+=1,se.steps>=2&&s&&j.move(s.x,s.y),se.prevPos=se.lastPos,se.lastPos=a)}),await pe("Follow","Follow enabled","success")}};async function ka(){return ke.list()}function Ra(t,e=22){return t?t.length<=e?t:t.slice(0,e-1)+"\u2026":""}var La=t=>({id:t.id,title:Ra(t.name||t.id,9),subtitle:t.isConnected?"Online":"Offline",avatarUrl:t.discordAvatarUrl||"",statusColor:t.isConnected?"#48d170":"#999a"});async function hr(t){let e=new Ce({id:"players",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views"),{root:r,left:a,right:s}=e.split2("260px");n.appendChild(r);let i=e.vtabs({filterPlaceholder:"Find player\u2026",onSelect:(M,b)=>u(b?.id||null)});a.appendChild(i.root);let o=i.root.querySelector(".filter");if(o){o.style.display="flex",o.style.alignItems="center",o.style.gap="8px";let M=o.querySelector("input");M&&(M.style.flex="1 1 auto",M.style.minWidth="0");let b=document.createElement("button");b.className="qmm-btn",b.title="Refresh",b.setAttribute("aria-label","Refresh"),b.style.width="34px",b.style.height="34px",b.style.padding="0",b.style.display="inline-flex",b.style.alignItems="center",b.style.justifyContent="center",b.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M12 6a6 6 0 0 1 5.66 4H20l-3.5 3.5L13 10h2.34A4 4 0 1 0 16 12h2a6 6 0 1 1-6-6z"/>
      </svg>
    `,b.onclick=async()=>{await C(!0)},o.appendChild(b)}function u(M){s.innerHTML="";let b=M&&l.find(J=>J.id===M)||null;if(!b){let J=document.createElement("div");J.style.opacity="0.75",J.textContent="Select a player on the left.",s.appendChild(J);return}let w=document.createElement("div");w.style.display="flex",w.style.alignItems="center",w.style.gap="12px";let f=document.createElement("img");f.src=b.discordAvatarUrl||"",f.alt=b.name,f.width=48,f.height=48,f.style.borderRadius="50%",f.style.objectFit="cover",f.style.border="1px solid #4446";let g=document.createElement("div"),S=document.createElement("div");S.textContent=b.name||b.id,S.style.fontWeight="600",S.style.fontSize="16px";let R=document.createElement("div");R.style.opacity="0.8",R.style.fontSize="12px";let D=b.isConnected?"Online":"Offline";R.textContent=D,g.appendChild(S),g.appendChild(R),w.appendChild(f),w.appendChild(g),s.appendChild(w);let G=document.createElement("div");G.style.display="flex",G.style.gap="8px",G.style.marginTop="8px",G.appendChild(e.btn("Teleport",async()=>{try{await ke.teleportTo(b.id)}catch(J){pe("Teleport",J?.message||"Error during teleport.","error")}})),G.appendChild(e.btn("Inventory",async()=>{await ke.openInventoryPreview(b.id,b.name)}));let O=document.createElement("div");O.style.display="flex",O.style.alignItems="center",O.style.marginTop="6px",O.style.gap="8px";let q=document.createElement("div");q.textContent="Follow",q.style.fontSize="14px",q.style.opacity="0.85";let oe=e.switch(ke.isFollowing(b.id));oe.addEventListener("change",async()=>{try{oe.checked?(await ke.startFollowing(b.id),await pe("Follow","Follow activ\xE9.","success")):(ke.stopFollowing(),await pe("Follow","Follow d\xE9sactiv\xE9.","info"))}catch(J){await pe("Follow",J?.message||"Erreur sur le follow.","error"),oe.checked=!oe.checked}}),O.appendChild(q),O.appendChild(oe),s.appendChild(G),s.appendChild(O)}let l=[],p="";function T(M){return M.map(b=>`${b.id}|${b.name??""}|${b.isConnected?1:0}|${b.inventory?.items?.length??0}`).join(";")}async function C(M=!0){let b=i.getSelected()?.id??null,w=await ka(),f=T(w);if(f===p)return;p=f,l=w,i.setItems(l.map(La));let g=M&&b&&l.some(S=>S.id===b)?b:l[0]?.id??null;g!==null?i.select(g):u(null)}await ke.onChange(()=>{C(!0).catch(()=>{})}),await C(!0)}function br(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function Ha(t,e){let n=document.createElement("div");n.style.display="grid",n.style.justifyItems="center",n.style.gap="8px",n.style.textAlign="center",n.style.border="1px solid #4446",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#1f2328",n.style.boxShadow="0 0 0 1px #0002 inset",n.style.width="min(720px, 100%)";let r=document.createElement("div");return r.textContent=t,r.style.fontWeight="600",r.style.opacity="0.95",n.append(r,e),n}var Sr=t=>{let e=new Date(t),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`};var Bt=null,vn=new Set;function _a(t){let e=String(t||""),n=(Y.getAbilityNameWithoutLevel?.(e)||"").replace(/[\s\-_]+/g,"").toLowerCase(),r=a=>e.startsWith(a)||n===a.toLowerCase();if(r("ProduceScaleBoost"))return{bg:"rgba(34,139,34,0.9)",hover:"rgba(34,139,34,1)"};if(r("PlantGrowthBoost"))return{bg:"rgba(0,128,128,0.9)",hover:"rgba(0,128,128,1)"};if(r("EggGrowthBoost"))return{bg:"rgba(180,90,240,0.9)",hover:"rgba(180,90,240,1)"};if(r("PetAgeBoost"))return{bg:"rgba(147,112,219,0.9)",hover:"rgba(147,112,219,1)"};if(r("PetHatchSizeBoost"))return{bg:"rgba(128,0,128,0.9)",hover:"rgba(128,0,128,1)"};if(r("PetXpBoost"))return{bg:"rgba(30,144,255,0.9)",hover:"rgba(30,144,255,1)"};if(r("HungerBoost"))return{bg:"rgba(255,20,147,0.9)",hover:"rgba(255,20,147,1)"};if(r("SellBoost"))return{bg:"rgba(220,20,60,0.9)",hover:"rgba(220,20,60,1)"};if(r("CoinFinder"))return{bg:"rgba(180,150,0,0.9)",hover:"rgba(180,150,0,1)"};if(r("ProduceMutationBoost"))return{bg:"rgba(138,43,226,0.9)",hover:"rgba(138,43,226,1)"};if(r("DoubleHarvest"))return{bg:"rgba(0,120,180,0.9)",hover:"rgba(0,120,180,1)"};if(r("ProduceEater"))return{bg:"rgba(255,69,0,0.9)",hover:"rgba(255,69,0,1)"};if(r("ProduceRefund"))return{bg:"rgba(255,99,71,0.9)",hover:"rgba(255,99,71,1)"};if(r("PetMutationBoost"))return{bg:"rgba(156,65,181,0.9)",hover:"rgba(156,65,181,1)"};if(r("HungerRestore"))return{bg:"rgba(255,105,180,0.9)",hover:"rgba(255,105,180,1)"};if(r("PetRefund"))return{bg:"rgba(0,80,120,0.9)",hover:"rgba(0,80,120,1)"};if(r("Copycat"))return{bg:"rgba(255,140,0,0.9)",hover:"rgba(255,140,0,1)"};if(r("GoldGranter"))return{bg:"linear-gradient(135deg, rgba(225,200,55,0.9) 0%, rgba(225,180,10,0.9) 40%, rgba(215,185,45,0.9) 70%, rgba(210,185,45,0.9) 100%)",hover:"linear-gradient(135deg, rgba(220,200,70,1) 0%, rgba(210,175,5,1) 40%, rgba(210,185,55,1) 70%, rgba(200,175,30,1) 100%)"};if(r("RainbowGranter"))return{bg:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))",hover:"linear-gradient(45deg, rgba(200,0,0,1), rgba(200,120,0,1), rgba(160,170,30,1), rgba(60,170,60,1), rgba(50,170,170,1), rgba(40,150,180,1), rgba(20,90,180,1), rgba(70,30,150,1))"};if(r("SeedFinderIV"))return{bg:"linear-gradient(130deg, rgba(0,180,216,0.9) 0%, rgba(124,42,232,0.9) 40%, rgba(160,0,126,0.9) 60%, rgba(255,215,0,0.9) 100%)",hover:"linear-gradient(130deg, rgba(0,180,216,1) 0%, rgba(124,42,232,1) 40%, rgba(160,0,126,1) 60%, rgba(255,215,0,1) 100%)"};if(r("SeedFinder")){let a=e.replace(/.*?([IVX]+)$/,"$1");return a==="II"?{bg:"rgba(183,121,31,0.9)",hover:"rgba(183,121,31,1)"}:a==="III"?{bg:"rgba(139,62,152,0.9)",hover:"rgba(139,62,152,1)"}:{bg:"rgba(94,172,70,0.9)",hover:"rgba(94,172,70,1)"}}return{bg:"rgba(100,100,100,0.9)",hover:"rgba(150,150,150,1)"}}function Na(t,e){let n=d=>{let c=e?.root??t;c.style.display=d?"none":""};t.innerHTML="";let r=(d,c)=>{d.textContent=c,d.style.width="100%",d.style.margin="0",d.style.padding="10px",d.style.borderRadius="8px",d.style.border="1px solid #4445",d.style.background="#1f2328",d.style.color="#e7eef7",d.style.justifyContent="center",d.onmouseenter=()=>d.style.borderColor="#6aa1",d.onmouseleave=()=>d.style.borderColor="#4445"},a=(d,c)=>Ha(d,c),s=()=>{let d=document.createElement("div");return d.style.display="flex",d.style.alignItems="center",d.style.flexWrap="wrap",d.style.gap="8px",d},i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",i.style.gap="10px",i.style.alignItems="stretch",i.style.height="54vh",i.style.overflow="hidden",t.appendChild(i);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateRows="1fr auto",o.style.gap="8px",o.style.minHeight="0",i.appendChild(o);let u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.gap="6px",u.style.overflow="auto",u.style.padding="6px",u.style.border="1px solid #4445",u.style.borderRadius="10px",u.style.scrollBehavior="smooth",u.style.minHeight="0",o.appendChild(u);let l=document.createElement("div");l.style.display="flex",l.style.gap="6px",o.appendChild(l);let p=document.createElement("button");p.id="pets.teams.new";let T=document.createElement("button");T.id="pets.teams.duplicate";let C=document.createElement("button");C.id="pets.teams.delete",r(p,"New"),r(T,"Duplicate"),r(C,"Delete"),l.append(p,T,C);let M=[],b=null,w=!1,f=null,g=null,S=0;function R(){return M.find(d=>d.id===b)||null}function D(d){let c=Array.from(u.children);if(!c.length)return 0;let x=c[0].getBoundingClientRect();if(d<x.top+x.height/2)return 0;for(let y=0;y<c.length;y++){let A=c[y].getBoundingClientRect(),h=A.top+A.height/2;if(d<h)return y}return c.length}function G(d){let c=document.createElement("span");c.style.display="inline-flex",c.style.alignItems="center",c.style.lineHeight="1";let x=8,y=12,A=3,h=Array.isArray(d)?d.filter(Boolean):[];if(!h.length){let H=document.createElement("span");return H.textContent="No ability",H.style.opacity="0.75",H.style.fontSize="12px",c.appendChild(H),c}return h.forEach((H,U)=>{let _=document.createElement("span"),{bg:F,hover:re}=_a(H);_.title=Y.getAbilityName(H)||H,_.setAttribute("aria-label",_.title),Object.assign(_.style,{display:"inline-block",width:`${y}px`,height:`${y}px`,borderRadius:`${A}px`,marginRight:U===h.length-1?"0":`${x}px`,background:F,transition:"transform 80ms ease, box-shadow 120ms ease, background 120ms ease",cursor:"default"}),_.onmouseenter=()=>{_.style.background=re,_.style.transform="scale(1.08)",_.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff33"},_.onmouseleave=()=>{_.style.background=F,_.style.transform="none",_.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"},c.appendChild(_)}),c}function O(){let d=Array.from(u.children);if(d.forEach(y=>y.style.transform=""),f===null||g===null)return;let c=f,x=g;d.forEach((y,A)=>{y.style.transition="transform 120ms ease",A!==c&&(x>c&&A>c&&A<x&&(y.style.transform=`translateY(${-S}px)`),x<c&&A>=x&&A<c&&(y.style.transform=`translateY(${S}px)`))})}function q(){Array.from(u.children).forEach(d=>{d.style.transform="",d.style.transition=""})}async function oe(){Bt=null,vn=new Set;try{let d=await Y.getPets(),c=Array.isArray(d)?d.map(x=>String(x?.slot?.id||"")).filter(Boolean):[];vn=new Set(c);for(let x of M){let y=(x.slots||[]).filter(Boolean);if(y.length!==c.length)continue;let A=!0;for(let h of y)if(!vn.has(h)){A=!1;break}if(A){Bt=x.id;break}}}catch{}}async function J(d=!1){if(d||await oe(),q(),f=null,g=null,S=0,u.innerHTML="",!M.length){let c=document.createElement("div");c.textContent="No teams yet. Create one!",c.style.opacity="0.75",c.style.textAlign="center",c.style.padding="8px",u.appendChild(c),fe(null);return}M.forEach((c,x)=>{let y=document.createElement("div"),A=c.id===Bt;y.dataset.index=String(x),y.textContent="",y.style.height="36px",y.style.lineHeight="36px",y.style.padding="0 10px",y.style.border="1px solid #ffffff15",y.style.borderRadius="6px",y.style.cursor="pointer",y.style.fontSize="13px",y.style.overflow="hidden",y.style.whiteSpace="nowrap",y.style.textOverflow="ellipsis",y.style.display="flex",y.style.flex="0 0 auto",y.style.gap="8px",y.style.alignItems="center",y.style.background=c.id===b?"#2a313a":"#1f2328";let h=document.createElement("span");h.style.width="10px",h.style.height="10px",h.style.borderRadius="50%",h.style.boxShadow="0 0 0 1px #0006 inset",h.style.background=A?"#48d170":"#64748b",h.title=A?"This team is currently active":"Inactive team";let H=document.createElement("span");H.textContent=c.name||"(unnamed)",H.style.overflow="hidden",H.style.textOverflow="ellipsis",H.style.whiteSpace="nowrap",y.append(h,H);let U=document.createElement("span");U.className="qmm-grab",U.title="Drag to reorder",U.innerHTML="&#8942;",U.draggable=!0,y.onmouseenter=()=>y.style.borderColor="#6aa1",y.onmouseleave=()=>y.style.borderColor="#ffffff15",y.onclick=_=>{if(_.__byDrag)return;b!==c.id&&(b=c.id,J()),fe(R())},U.addEventListener("dragstart",_=>{f=x,S=y.getBoundingClientRect().height,y.classList.add("qmm-dragging"),_.dataTransfer?.setData("text/plain",String(x)),_.dataTransfer&&(_.dataTransfer.effectAllowed="move");try{let F=y.cloneNode(!0);F.style.width=`${y.getBoundingClientRect().width}px`,F.style.position="absolute",F.style.top="-9999px",document.body.appendChild(F),_.dataTransfer.setDragImage(F,F.offsetWidth/2,F.offsetHeight/2),setTimeout(()=>document.body.removeChild(F),0)}catch{}}),U.addEventListener("dragend",()=>{y.classList.remove("qmm-dragging"),q(),f=null,g=null}),y.addEventListener("dragover",_=>{if(_.preventDefault(),_.dataTransfer&&(_.dataTransfer.dropEffect="move"),f===null)return;let F=Number(_.currentTarget.dataset.index||-1);if(F<0)return;let re=y.getBoundingClientRect(),ee=re.top+re.height/2,X=_.clientY<ee?F:F+1,v=Math.max(0,Math.min(M.length,X));g!==v&&(g=v,O());let P=28,K=u.getBoundingClientRect();_.clientY<K.top+P?u.scrollTop-=18:_.clientY>K.bottom-P&&(u.scrollTop+=18)}),y.addEventListener("drop",_=>{if(_.preventDefault(),_.__byDrag=!0,f===null)return;let F=g??D(_.clientY);if(F>f&&(F-=1),F=Math.max(0,Math.min(M.length-1,F)),F!==f){let re=M.slice(),[ee]=re.splice(f,1);re.splice(F,0,ee),M=re;try{Y.setTeamsOrder(M.map(X=>X.id))}catch{}}q(),f=null,g=null,S=0,J()}),y.onclick=_=>{if(_.__byDrag)return;b!==c.id&&(b=c.id,J()),fe(R())},y.appendChild(U),u.appendChild(y)})}u.addEventListener("dragover",d=>{if(d.preventDefault(),d.dataTransfer&&(d.dataTransfer.dropEffect="move"),f===null)return;let c=D(d.clientY);g!==c&&(g=c,O());let x=28,y=u.getBoundingClientRect();d.clientY<y.top+x?u.scrollTop-=18:d.clientY>y.bottom-x&&(u.scrollTop+=18)}),u.addEventListener("drop",d=>{if(d.preventDefault(),f===null)return;let c=g??D(d.clientY);if(c>f&&(c-=1),c=Math.max(0,Math.min(M.length-1,c)),c!==f){let x=M.slice(),[y]=x.splice(f,1);x.splice(c,0,y),M=x;try{Y.setTeamsOrder(M.map(A=>A.id))}catch{}}q(),f=null,g=null,S=0,J()}),p.onclick=()=>{b=Y.createTeam("New Team").id,J(),fe(R())},T.onclick=()=>{if(!b)return;let d=Y.duplicateTeam(b);d&&(b=d.id,J(),fe(R()))},C.onclick=()=>{!b||Y.deleteTeam(b)};let ye=null;(async()=>{try{ye=await Y.onTeamsChangeNow(async d=>{M=Array.isArray(d)?d.slice():[],b&&!M.some(c=>c.id===b)&&(b=M[0]?.id??null),!b&&M.length&&(b=M[0].id),J(),await Y.getInventoryPets(),await fe(R())})}catch{}})();let be=document.createElement("div");be.style.display="grid",be.style.gridTemplateRows="auto 1fr",be.style.gap="10px",be.style.minHeight="0",i.appendChild(be);let Se=document.createElement("div");Se.style.display="flex",Se.style.alignItems="center",Se.style.gap="8px";let Me=document.createElement("div");Me.textContent="Team editor \u2014 ",Me.style.fontWeight="700",Me.style.fontSize="14px";let I=document.createElement("button");I.id="pets.teams.useThisTeam",I.textContent="Use this team",I.style.padding="6px 10px",I.style.borderRadius="8px",I.style.border="1px solid #4445",I.style.background="#1f2328",I.style.color="#e7eef7",I.style.cursor="pointer",I.onmouseenter=()=>I.style.borderColor="#6aa1",I.onmouseleave=()=>I.style.borderColor="#4445",I.disabled=!0;let N=document.createElement("button");N.id="pets.teams.save",N.textContent="Save",N.style.padding="6px 10px",N.style.borderRadius="8px",N.style.border="1px solid #4445",N.style.background="#1f2328",N.style.color="#e7eef7",N.style.cursor="pointer",N.onmouseenter=()=>N.style.borderColor="#6aa1",N.onmouseleave=()=>N.style.borderColor="#4445",N.disabled=!0,Se.append(Me,I,N),be.appendChild(Se);let E=document.createElement("div");E.style.border="1px solid #4445",E.style.borderRadius="10px",E.style.padding="10px",E.style.display="flex",E.style.flexDirection="column",E.style.gap="12px",E.style.overflow="auto",E.style.minHeight="0",E.style.background="#0f1318",be.appendChild(E);let $=(()=>{let d=s(),c=e.inputText("Team name","");return c.id="pets.teams.editor.name",c.style.minWidth="260px",d.append(c),E.appendChild(a("Team name",d)),{nameInput:c}})(),ce=(()=>{let d=document.createElement("div");d.style.display="grid",d.style.gap="10px",d.style.justifyItems="center";let c=document.createElement("div");c.style.display="flex",c.style.flexWrap="wrap",c.style.alignItems="center",c.style.justifyContent="center",c.style.gap="10px";let x=(X,v,P,K=!1)=>{let B=document.createElement("label");B.style.display="inline-flex",B.style.alignItems="center",B.style.gap="6px";let z=e.radio(X,v,K),te=document.createElement("span");return te.textContent=P,B.append(z,te),{wrap:B,input:z}},y=x("pets-search-mode","ability","Ability",!0),A=x("pets-search-mode","species","Species",!1);c.append(y.wrap,A.wrap);let h=document.createElement("select");h.className="qmm-input",h.id="pets.teams.filter.select",h.style.minWidth="260px";let H="ability",U=()=>H,_=X=>{H=X,y.input.checked=X==="ability",A.input.checked=X==="species",y.input.type="radio",A.input.type="radio",y.input.name="pets-search-mode",A.input.name="pets-search-mode"},F=X=>{h.innerHTML="";let v=document.createElement("option");v.value="",v.textContent="\u2014 No filter \u2014",h.appendChild(v),X.forEach(P=>{let K=document.createElement("option");K.value=P,K.textContent=P,h.appendChild(K)})},re=async()=>{let X=await Y.getInventoryPets().catch(()=>[]),v=U();if(U()==="ability"){let P=new Set;for(let z of X){let te=Array.isArray(z?.abilities)?z.abilities.filter(Boolean):[];for(let le of te){let _e=Y.getAbilityNameWithoutLevel(le);_e&&P.add(_e)}}let K=Array.from(P).sort((z,te)=>z.localeCompare(te));h.innerHTML="";let B=document.createElement("option");B.value="",B.textContent="\u2014 No filter \u2014",h.appendChild(B),K.forEach(z=>{let te=document.createElement("option");te.value=z,te.textContent=z,h.appendChild(te)})}else{let P=new Set;for(let z of X){let te=String(z?.petSpecies||"").trim();te&&P.add(te)}let K=Array.from(P).sort((z,te)=>z.localeCompare(te));h.innerHTML="";let B=document.createElement("option");B.value="",B.textContent="\u2014 No filter \u2014",h.appendChild(B),K.forEach(z=>{let te=document.createElement("option");te.value=z,te.textContent=z.charAt(0).toUpperCase()+z.slice(1),h.appendChild(te)})}},ee=()=>{let X=R();if(!X)return;let v=(h.value||"").trim(),P=U()==="ability"?v?`ab:${v}`:"":v?`sp:${v}`:"";Y.setTeamSearch(X.id,P)};return y.input.addEventListener("change",async()=>{y.input.checked&&(_("ability"),await re(),h.value="",ee())}),A.input.addEventListener("change",async()=>{A.input.checked&&(_("species"),await re(),h.value="",ee())}),h.addEventListener("change",ee),d.append(c,h),E.appendChild(a("Search",d)),{getMode:U,setMode:_,select:h,rebuild:re,apply:ee,setFromSearchString(X){let v=(X||"").match(/^(ab|sp):\s*(.*)$/i);if(!v){_("ability"),h.value="";return}let P=v[1].toLowerCase()==="ab"?"ability":"species";_(P),h.value=v[2]||""}}})(),ge=(()=>{let d=document.createElement("div");d.style.display="grid",d.style.gridTemplateColumns="1fr",d.style.rowGap="10px",d.style.justifyItems="center";let c=re=>{let ee=document.createElement("div"),X=28;ee.style.display="grid",ee.style.gridTemplateColumns=`minmax(0,1fr) ${X}px ${X}px`,ee.style.alignItems="center",ee.style.gap="8px",ee.style.width="min(560px, 100%)",ee.style.border="1px solid #4445",ee.style.borderRadius="10px",ee.style.padding="8px 10px",ee.style.background="#0f1318";let v=document.createElement("div");v.style.display="flex",v.style.flexDirection="column",v.style.gap="6px",v.style.minWidth="0";let P=document.createElement("div");P.style.fontWeight="700",P.textContent="None",P.style.overflow="hidden",P.style.textOverflow="ellipsis",P.style.whiteSpace="nowrap";let K=G([]);K.style.display="inline-block",v.append(P,K);let B=document.createElement("button");B.textContent="+",Object.assign(B.style,{width:`${X}px`,minWidth:`${X}px`,height:`${X}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),B.title="Choose a pet",B.setAttribute("aria-label","Choose a pet");let z=document.createElement("button");z.textContent="\u2212",Object.assign(z.style,{width:`${X}px`,minWidth:`${X}px`,height:`${X}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),z.title="Remove this pet",z.setAttribute("aria-label","Remove this pet"),ee.append(v,B,z);function te(le){if(!le){P.textContent="None";let Dt=G([]);Dt.style.display="inline-block",v.replaceChild(Dt,v.children[1]),K=Dt;return}let _e=le.petSpecies?le.petSpecies.charAt(0).toUpperCase()+le.petSpecies.slice(1):"",bt=le.name?.trim()||_e||"Pet";P.textContent=bt,P.textContent=bt;let Ot=Array.isArray(le.abilities)?le.abilities.filter(Boolean):[],et=G(Ot);et.style.display="inline-block",v.replaceChild(et,v.children[1]),K=et}return B.onclick=async()=>{let le=R();if(le){B.disabled=!0,z.disabled=!0,n(!0);try{await Y.chooseSlotPet(le.id,re),await Q(R())}finally{n(!1),B.disabled=!1,z.disabled=!1}}},z.onclick=async()=>{let le=R();if(!le)return;let _e=le.slots.slice(0,3);_e[re]=null,Y.saveTeam({id:le.id,slots:_e}),await Q(le)},{root:ee,nameEl:P,abilitiesEl:K,btnChoose:B,btnClear:z,update:te}},x=c(0),y=c(1),A=c(2);d.append(x.root,y.root,A.root);let h=document.createElement("div");h.style.display="flex",h.style.gap="6px",h.style.justifyContent="center";let H=document.createElement("button");r(H,"Current active"),H.id="pets.teams.useCurrent";let U=document.createElement("button");r(U,"Clear slots"),U.id="pets.teams.clearSlots";let _="#0f1318";h.append(H,U),Object.assign(H.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:_,boxShadow:"none"}),Object.assign(U.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:_,boxShadow:"none"});let F=document.createElement("div");return F.style.display="flex",F.style.flexDirection="column",F.style.gap="8px",F.append(d,h),E.appendChild(a("Active pets (3 slots)",F)),{rows:[x,y,A],btnUseCurrent:H,btnClear:U}})();async function Q(d){let c=d??R();if(!c)return;let x=await Y.getInventoryPets().catch(()=>[]),y=new Map;for(let A of x)A?.id!=null&&y.set(String(A.id),A);[0,1,2].forEach(A=>{let h=c.slots[A]||"",H=h&&y.get(h)||null;ge.rows[A].update(H)})}async function fe(d){let c=!!d;if($.nameInput.disabled=!c,ge.btnClear.disabled=!c,ge.btnUseCurrent.disabled=!c,I.disabled=!c,N.disabled=!c,ce.setMode("ability"),await ce.rebuild(),c){let x=Y.getTeamSearch(d.id)||"";ce.setFromSearchString(x),ce.apply()}if(!c){ge.rows.forEach(x=>x.update(null)),$.nameInput.value="";return}$.nameInput.value=String(d.name||""),await Q(d)}$.nameInput.addEventListener("keydown",d=>{d.key==="Enter"&&d.currentTarget.blur()}),$.nameInput.addEventListener("blur",()=>{let d=R();if(!d)return;let c=$.nameInput.value.trim();c!==d.name&&Y.saveTeam({id:d.id,name:c})}),ge.btnUseCurrent.onclick=async()=>{let d=R();if(d)try{let c=await Y.getPets(),y=(Array.isArray(c)?c:[]).map(h=>String(h?.slot?.id||"")).filter(h=>!!h).slice(0,3),A=[y[0]||null,y[1]||null,y[2]||null];Y.saveTeam({id:d.id,slots:A}),await Q(d)}catch{}},ge.btnClear.onclick=async()=>{let d=R();d&&(Y.saveTeam({id:d.id,slots:[null,null,null]}),await Q(d))},N.onclick=()=>{let d=R();if(!d)return;let c=$.nameInput.value.trim(),x=d.slots.slice(0,3);Y.saveTeam({id:d.id,name:c,slots:x}),Q(d)};function Ge(d,c){if(d.length!==c.length)return!1;let x=new Set(d);for(let y of c)if(!x.has(y))return!1;return!0}async function m(d,c=2e3){let x=(d.slots||[]).filter(Boolean),y=performance.now();for(;performance.now()-y<c;){let A=await Y.getPets().catch(()=>null),h=Array.isArray(A)?A.map(H=>String(H?.slot?.id||"")).filter(Boolean):[];if(Ge(h,x))return!0;await new Promise(H=>setTimeout(H,80))}return!1}I.onclick=async()=>{let d=R();if(d)try{w=!0,Bt=d.id,await J(!0),await Y.useTeam(d.id),await m(d),await fe(R()),await J()}catch(c){console.warn("[Pets] Use this team failed:",c),await J()}finally{w=!1}};let L=null;(async()=>{try{Q(),L=await Y.onInventoryPetsChange(async()=>{w||await Q(R())})}catch{}})(),t.__cleanup__=(()=>{let d=t.__cleanup__;return()=>{try{ye?.()}catch{}try{L?.()}catch{}try{d?.()}catch{}}})()}function Wa(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.height="54vh",t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="8px",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="8px 10px",r.style.background="#0f1318",n.appendChild(r);let a=document.createElement("select");a.className="qmm-input",a.style.minWidth="200px",a.id="pets.logs.filter.ability";let s=document.createElement("select");s.className="qmm-input",s.style.minWidth="140px",s.id="pets.logs.sort",[["desc","Newest first"],["asc","Oldest first"]].forEach(([I,N])=>{let E=document.createElement("option");E.value=I,E.textContent=N,s.appendChild(E)}),s.value="desc";let i=e.inputText("search (pet / ability / details)","");i.id="pets.logs.search",i.style.minWidth="220px";let o=document.createElement("button");br(o,"Copy"),o.id="pets.logs.copy";let u=document.createElement("button");br(u,"Clear"),u.id="pets.logs.clear",r.append(e.label("Ability"),a,e.label("Sort"),s,i,o,u);let l=document.createElement("div");l.style.border="1px solid #4445",l.style.borderRadius="10px",l.style.padding="10px",l.style.background="#0f1318",l.style.overflow="hidden",l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.minHeight="0",n.appendChild(l);let p=document.createElement("div");p.style.display="grid",p.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",p.style.columnGap="0",p.style.borderBottom="1px solid #ffffff1a",p.style.padding="0 0 6px 0";function T(I,N="center"){let E=document.createElement("div");return E.textContent=I,E.style.fontWeight="600",E.style.opacity="0.9",E.style.padding="6px 8px",E.style.textAlign=N,E}p.append(T("Time"),T("Pet"),T("Ability"),T("Details","left")),l.appendChild(p);let C=document.createElement("div");C.style.display="grid",C.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",C.style.gridAutoRows="auto",C.style.alignContent="start",C.style.overflow="auto",C.style.width="100%",C.style.minHeight="0",l.appendChild(C);let M=[],b=new Set,w="",f="desc",g="",S=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function R(I){return Math.round(I)}function D(I){if(typeof I=="number")return R(I);if(I==null)return I;if(Array.isArray(I))return I.map(D);if(typeof I=="object"){let N={};for(let E of Object.keys(I))N[E]=D(I[E]);return N}return I}function G(I,N=0){if(I==null)return"";if(typeof I=="number")return S.format(I);if(typeof I=="string")return I;if(typeof I=="boolean")return String(I);if(Array.isArray(I))return I.map(E=>G(E,N+1)).join(", ");if(typeof I=="object"){let E=Object.entries(I);return E.length?E.map(([$,ce])=>{if(ce!==null&&typeof ce=="object")try{let ge=D(ce);return`${$}: ${JSON.stringify(ge)}`}catch{return`${$}: ${String(ce)}`}return`${$}: ${G(ce,N+1)}`}).join(", "):""}return String(I)}function O(I){try{let N=D(I);return G(N)}catch{try{return JSON.stringify(I)}catch{return String(I??"")}}}function q(I){try{return O(I).toLowerCase()}catch{try{return JSON.stringify(I).toLowerCase()}catch{return""}}}function oe(){let I=a.value;a.innerHTML="";let N=[["","All abilities"],...Array.from(b).sort().map(E=>[E,E])];for(let[E,$]of N){let ce=document.createElement("option");ce.value=E,ce.textContent=$,a.appendChild(ce)}a.value=N.some(([E])=>E===I)?I:""}function J(I,N="center"){let E=document.createElement("div");return E.textContent=I,E.style.padding="6px 8px",E.style.textAlign=N,E.style.whiteSpace=N==="left"?"pre-wrap":"normal",E.style.wordBreak=N==="left"?"break-word":"normal",E.style.borderBottom="1px solid #ffffff12",E}function ye(I){let N=J(Sr(I.performedAt),"center"),E=I.petName||I.species||"Pet",$=J(E,"center"),ce=J(I.abilityId,"center"),ge=O(I.data),Q=J(ge,"left");C.append(N,$,ce,Q)}function be(){let I=E=>String(E??"").toLowerCase().replace(/\s+/g,"").replace(/([ivx]+)$/i,""),N=M.slice();if(w&&w.trim()){let E=I(w);N=N.filter($=>{let ce=I($.abilityId),ge=I(Y.getAbilityNameWithoutLevel($.abilityId));return ce===E||ge===E})}if(g&&g.trim()){let E=g.toLowerCase();N=N.filter($=>{let ce=($.petName||$.species||"").toLowerCase(),ge=(Y.getAbilityNameWithoutLevel($.abilityId)||"").toLowerCase(),Q=($.abilityId||"").toLowerCase(),fe=q($.data);return ce.includes(E)||ge.includes(E)||Q.includes(E)||fe.includes(E)||($.petId||"").toLowerCase().includes(E)})}return N.sort((E,$)=>f==="asc"?E.performedAt-$.performedAt:$.performedAt-E.performedAt),N}function Se(){C.innerHTML="";let I=be();if(!I.length){let N=document.createElement("div");N.textContent="No logs yet.",N.style.opacity="0.75",N.style.gridColumn="1 / -1",N.style.padding="8px",C.appendChild(N);return}I.forEach(ye),C.scrollTop=C.scrollHeight+32}a.onchange=()=>{w=a.value,Se()},s.onchange=()=>{f=s.value||"desc",Se()},i.addEventListener("input",()=>{g=i.value.trim(),Se()}),u.onclick=()=>{try{Y.clearAbilityLogs()}catch{}},o.onclick=async()=>{let I=be().map(E=>({time:Sr(E.performedAt),pet:E.petName||E.species||E.petId,petId:E.petId,ability:E.abilityId,data:D(E.data)})),N=JSON.stringify(I,null,2);try{await navigator.clipboard.writeText(N)}catch{}};let Me=null;(async()=>{try{b=new Set(Y.getSeenAbilityIds()),oe(),Me=Y.onAbilityLogs(I=>{M=I.map(N=>({petId:N.petId,petName:N.name??null,species:N.species??null,abilityId:N.abilityId,data:N.data,performedAt:N.performedAt})),b=new Set(Y.getSeenAbilityIds()),oe(),Se()})}catch{}})(),t.__cleanup__=()=>{try{Me?.()}catch{}},Se()}function vr(t){let e=new Ce({id:"pets",compact:!0});e.mount(t),e.addTab("manager","Manager",n=>Na(n,e)),e.addTab("logs","Logs",n=>Wa(n,e))}function Fa(){let t=document.createElement("div");return t.style.display="flex",t.style.flexWrap="wrap",t.style.justifyContent="center",t.style.alignItems="center",t.style.gap="8px",t}var wr="qws:player:ghostMode",qa=(t,e=!1)=>{try{return localStorage.getItem(t)==="1"}catch{return e}},Ba=(t,e)=>{try{localStorage.setItem(t,e?"1":"0")}catch{}};function Oa(){let t="qws:ghost:delayMs",n=()=>{try{return Math.max(5,Math.floor(Number(localStorage.getItem(t))||50))}catch{return 50}},r=n();function a(g){r=Math.max(5,Math.floor(g||50));try{localStorage.setItem(t,String(r))}catch{}}let s=new Set,i=g=>{let S=g.key.toLowerCase();(S==="z"||S==="q"||S==="s"||S==="d"||S==="w"||S==="a"||g.key==="ArrowUp"||g.key==="ArrowDown"||g.key==="ArrowLeft"||g.key==="ArrowRight")&&(g.preventDefault(),g.stopImmediatePropagation(),!g.repeat&&s.add(S))},o=g=>{let S=g.key.toLowerCase();(S==="z"||S==="q"||S==="s"||S==="d"||S==="w"||S==="a"||g.key==="ArrowUp"||g.key==="ArrowDown"||g.key==="ArrowLeft"||g.key==="ArrowRight")&&(g.preventDefault(),g.stopImmediatePropagation(),s.delete(S))},u=()=>{s.clear()},l=()=>{document.hidden&&s.clear()};function p(){let g=0,S=0;return(s.has("z")||s.has("w")||s.has("arrowup"))&&(S-=1),(s.has("s")||s.has("arrowdown"))&&(S+=1),(s.has("q")||s.has("a")||s.has("arrowleft"))&&(g-=1),(s.has("d")||s.has("arrowright"))&&(g+=1),g&&(g=g>0?1:-1),S&&(S=S>0?1:-1),{dx:g,dy:S}}let T=null,C=0,M=0,b=!1;async function w(g,S){let R;try{R=await j.getPosition()}catch{}let D=Math.round(R?.x??0),G=Math.round(R?.y??0);try{await j.move(D+g,G+S)}catch{}}function f(g){C||(C=g);let S=g-C;C=g;let{dx:R,dy:D}=p();if(M+=S,R===0&&D===0){M=Math.min(M,r*4),T=requestAnimationFrame(f);return}M>=r&&!b&&(M-=r,b=!0,(async()=>{try{await w(R,D)}finally{b=!1}})()),M=Math.min(M,r*4),T=requestAnimationFrame(f)}return{start(){T===null&&(C=0,M=0,b=!1,window.addEventListener("keydown",i,{capture:!0}),window.addEventListener("keyup",o,{capture:!0}),window.addEventListener("blur",u),document.addEventListener("visibilitychange",l),T=requestAnimationFrame(f))},stop(){T!==null&&(cancelAnimationFrame(T),T=null),s.clear(),window.removeEventListener("keydown",i,{capture:!0}),window.removeEventListener("keyup",o,{capture:!0}),window.removeEventListener("blur",u),document.removeEventListener("visibilitychange",l)},setSpeed:a,getSpeed:n}}async function xr(t){let e=new Ce({id:"misc",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.minHeight="0";let r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="10px";let a=e.label("Player controls");a.style.fontWeight="700",a.style.fontSize="14px",r.append(a),n.appendChild(r);let s=document.createElement("div");s.className="qmm-card",s.style.display="flex",s.style.flexDirection="column",s.style.gap="12px",s.style.alignItems="center",s.style.overflow="auto",s.style.minHeight="0",n.appendChild(s);let i=Fa(),o=e.switch(qa(wr));o.id="player.ghostMode";let u=e.label("Ghost mode"),l=e.label("Move delay (ms)"),p=e.inputNumber(10,1e3,5,50);p.id="player.moveDelay",i.append(o,u,l,p.wrap??p),s.appendChild(i);let T=Oa();p.value=String(T.getSpeed?.()??50),p.addEventListener("change",()=>{let C=Math.max(10,Math.min(1e3,Math.floor(Number(p.value)||50)));p.value=String(C),T.setSpeed?.(C)}),o.checked&&T.start(),o.onchange=()=>{let C=!!o.checked;Ba(wr,C),C?T.start():T.stop()},s.__cleanup__=()=>{try{T.stop()}catch{}}}function Pr(t){let e=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume","mouseleave","mouseenter"],n=[];function r(){let O=(q,oe)=>{let J=ye=>{ye.stopImmediatePropagation(),ye.preventDefault?.()};q.addEventListener(oe,J,{capture:!0}),n.push({t:oe,h:J,target:q})};e.forEach(q=>{O(document,q),O(window,q)})}function a(){for(let{t:O,h:q,target:oe}of n)try{oe.removeEventListener(O,q,{capture:!0})}catch{}n.length=0}let s=Object.getPrototypeOf(document),i={hidden:Object.getOwnPropertyDescriptor(s,"hidden"),visibilityState:Object.getOwnPropertyDescriptor(s,"visibilityState"),hasFocus:document.hasFocus?document.hasFocus.bind(document):null};function o(){try{Object.defineProperty(s,"hidden",{configurable:!0,get(){return!1}})}catch{}try{Object.defineProperty(s,"visibilityState",{configurable:!0,get(){return"visible"}})}catch{}try{document.hasFocus=()=>!0}catch{}}function u(){try{i.hidden&&Object.defineProperty(s,"hidden",i.hidden)}catch{}try{i.visibilityState&&Object.defineProperty(s,"visibilityState",i.visibilityState)}catch{}try{i.hasFocus&&(document.hasFocus=i.hasFocus)}catch{}}let l=null,p=null,T=null,C=()=>{l&&l.state!=="running"&&l.resume?.().catch(()=>{})};function M(){try{l=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),T=l.createGain(),T.gain.value=1e-5,p=l.createOscillator(),p.frequency.value=1,p.connect(T).connect(l.destination),p.start(),document.addEventListener("visibilitychange",C,{capture:!0}),window.addEventListener("focus",C,{capture:!0})}catch{b()}}function b(){try{p?.stop()}catch{}try{p?.disconnect(),T?.disconnect()}catch{}try{l?.close?.()}catch{}document.removeEventListener("visibilitychange",C,{capture:!0}),window.removeEventListener("focus",C,{capture:!0}),p=null,T=null,l=null}let w=null;function f(){let O=document.querySelector("canvas")||document.body||document.documentElement;w=window.setInterval(()=>{try{O.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}))}catch{}},25e3)}function g(){w!==null&&(clearInterval(w),w=null)}let S=null;async function R(){try{let O=await t.getPosition();if(!O)return;await t.move(Math.round(O.x),Math.round(O.y))}catch{}}function D(){S=window.setInterval(R,6e4),R()}function G(){S!==null&&(clearInterval(S),S=null)}return{start(){o(),r(),M(),f(),D()},stop(){G(),g(),b(),a(),u()}}}(async function(){"use strict";xn(),fn({onRegister(e){e("players","Players",hr),e("pets","Pets",vr),e("misc","Misc",xr),e("debug-data","Debug Data",mr)}}),dr(!0),Pr({getPosition:()=>j.getPosition(),move:(e,n)=>j.move(e,n)}).start()})();})();
