// ==UserScript==
// @name         Arie's Mod (Full)
// @namespace    Quinoa
// @version      0.0.0
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @run-at       document-start
// @inject-into  page
// @grant        GM_xmlhttpRequest
// @grant        GM_info
// @grant        GM_openInTab 
// @grant        GM_getValue
// @grant        GM_setValue
// @grant        GM_registerMenuCommand
// @grant        GM_download
// @connect      *.supabase.co
// @connect      *.supabase.in
// @connect      raw.githubusercontent.com
// @connect      api.github.com
// @downloadURL  https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// @updateURL    https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// ==/UserScript==
(()=>{var o1=Object.create;var pd=Object.defineProperty;var s1=Object.getOwnPropertyDescriptor;var a1=Object.getOwnPropertyNames;var i1=Object.getPrototypeOf,l1=Object.prototype.hasOwnProperty;var c1=(t,e,n)=>e in t?pd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var us=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var d1=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var u1=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of a1(e))!l1.call(t,o)&&o!==n&&pd(t,o,{get:()=>e[o],enumerable:!(r=s1(e,o))||r.enumerable});return t};var p1=(t,e,n)=>(n=t!=null?o1(i1(t)):{},u1(e||!t||!t.__esModule?pd(n,"default",{value:t,enumerable:!0}):n,t));var pe=(t,e,n)=>c1(t,typeof e!="symbol"?e+"":e,n);var Jy=d1((Qy,ou)=>{(function(t){typeof Qy=="object"&&typeof ou<"u"?ou.exports=t():typeof define=="function"&&define.amd?define([],t):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=t()})(function(){return function t(e,n,r){function o(i,l){if(!n[i]){if(!e[i]){var c=typeof us=="function"&&us;if(!l&&c)return c(i,!0);if(s)return s(i,!0);var d=new Error("Cannot find module '"+i+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[i]={exports:{}};e[i][0].call(u.exports,function(y){var h=e[i][1][y];return o(h||y)},u,u.exports,t,e,n,r)}return n[i].exports}for(var s=typeof us=="function"&&us,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(a){for(var i,l,c,d,u,y,h,f=[],p=0,m=a.length,g=m,S=r.getTypeOf(a)!=="string";p<a.length;)g=m-p,c=S?(i=a[p++],l=p<m?a[p++]:0,p<m?a[p++]:0):(i=a.charCodeAt(p++),l=p<m?a.charCodeAt(p++):0,p<m?a.charCodeAt(p++):0),d=i>>2,u=(3&i)<<4|l>>4,y=1<g?(15&l)<<2|c>>6:64,h=2<g?63&c:64,f.push(s.charAt(d)+s.charAt(u)+s.charAt(y)+s.charAt(h));return f.join("")},n.decode=function(a){var i,l,c,d,u,y,h=0,f=0,p="data:";if(a.substr(0,p.length)===p)throw new Error("Invalid base64 input, it looks like a data url.");var m,g=3*(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(a.charAt(a.length-1)===s.charAt(64)&&g--,a.charAt(a.length-2)===s.charAt(64)&&g--,g%1!=0)throw new Error("Invalid base64 input, bad content length.");for(m=o.uint8array?new Uint8Array(0|g):new Array(0|g);h<a.length;)i=s.indexOf(a.charAt(h++))<<2|(d=s.indexOf(a.charAt(h++)))>>4,l=(15&d)<<4|(u=s.indexOf(a.charAt(h++)))>>2,c=(3&u)<<6|(y=s.indexOf(a.charAt(h++))),m[f++]=i,u!==64&&(m[f++]=l),y!==64&&(m[f++]=c);return m}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var r=t("./external"),o=t("./stream/DataWorker"),s=t("./stream/Crc32Probe"),a=t("./stream/DataLengthProbe");function i(l,c,d,u,y){this.compressedSize=l,this.uncompressedSize=c,this.crc32=d,this.compression=u,this.compressedContent=y}i.prototype={getContentWorker:function(){var l=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),c=this;return l.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},i.createWorkerFrom=function(l,c,d){return l.pipe(new s).pipe(new a("uncompressedSize")).pipe(c.compressWorker(d)).pipe(new a("compressedSize")).withStreamInfo("compression",c)},e.exports=i},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(o){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var r=t("./utils"),o=function(){for(var s,a=[],i=0;i<256;i++){s=i;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;a[i]=s}return a}();e.exports=function(s,a){return s!==void 0&&s.length?r.getTypeOf(s)!=="string"?function(i,l,c,d){var u=o,y=d+c;i^=-1;for(var h=d;h<y;h++)i=i>>>8^u[255&(i^l[h])];return-1^i}(0|a,s,s.length,0):function(i,l,c,d){var u=o,y=d+c;i^=-1;for(var h=d;h<y;h++)i=i>>>8^u[255&(i^l.charCodeAt(h))];return-1^i}(0|a,s,s.length,0):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var r=null;r=typeof Promise<"u"?Promise:t("lie"),e.exports={Promise:r}},{lie:37}],7:[function(t,e,n){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),s=t("./utils"),a=t("./stream/GenericWorker"),i=r?"uint8array":"array";function l(c,d){a.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=d,this.meta={}}n.magic="\b\0",s.inherits(l,a),l.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(i,c.data),!1)},l.prototype.flush=function(){a.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(d){c.push({data:d,meta:c.meta})}},n.compressWorker=function(c){return new l("Deflate",c)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function r(u,y){var h,f="";for(h=0;h<y;h++)f+=String.fromCharCode(255&u),u>>>=8;return f}function o(u,y,h,f,p,m){var g,S,w=u.file,x=u.compression,E=m!==i.utf8encode,T=s.transformTo("string",m(w.name)),A=s.transformTo("string",i.utf8encode(w.name)),N=w.comment,H=s.transformTo("string",m(N)),C=s.transformTo("string",i.utf8encode(N)),L=A.length!==w.name.length,v=C.length!==N.length,B="",le="",X="",de=w.dir,_=w.date,re={crc32:0,compressedSize:0,uncompressedSize:0};y&&!h||(re.crc32=u.crc32,re.compressedSize=u.compressedSize,re.uncompressedSize=u.uncompressedSize);var R=0;y&&(R|=8),E||!L&&!v||(R|=2048);var k=0,V=0;de&&(k|=16),p==="UNIX"?(V=798,k|=function(ie,fe){var G=ie;return ie||(G=fe?16893:33204),(65535&G)<<16}(w.unixPermissions,de)):(V=20,k|=function(ie){return 63&(ie||0)}(w.dosPermissions)),g=_.getUTCHours(),g<<=6,g|=_.getUTCMinutes(),g<<=5,g|=_.getUTCSeconds()/2,S=_.getUTCFullYear()-1980,S<<=4,S|=_.getUTCMonth()+1,S<<=5,S|=_.getUTCDate(),L&&(le=r(1,1)+r(l(T),4)+A,B+="up"+r(le.length,2)+le),v&&(X=r(1,1)+r(l(H),4)+C,B+="uc"+r(X.length,2)+X);var ee="";return ee+=`
\0`,ee+=r(R,2),ee+=x.magic,ee+=r(g,2),ee+=r(S,2),ee+=r(re.crc32,4),ee+=r(re.compressedSize,4),ee+=r(re.uncompressedSize,4),ee+=r(T.length,2),ee+=r(B.length,2),{fileRecord:c.LOCAL_FILE_HEADER+ee+T+B,dirRecord:c.CENTRAL_FILE_HEADER+r(V,2)+ee+r(H.length,2)+"\0\0\0\0"+r(k,4)+r(f,4)+T+B+H}}var s=t("../utils"),a=t("../stream/GenericWorker"),i=t("../utf8"),l=t("../crc32"),c=t("../signature");function d(u,y,h,f){a.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=y,this.zipPlatform=h,this.encodeFileName=f,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(d,a),d.prototype.push=function(u){var y=u.meta.percent||0,h=this.entriesCount,f=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,a.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:h?(y+100*(h-f-1))/h:100}}))},d.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var y=this.streamFiles&&!u.file.dir;if(y){var h=o(u,y,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:h.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(u){this.accumulate=!1;var y=this.streamFiles&&!u.file.dir,h=o(u,y,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(h.dirRecord),y)this.push({data:function(f){return c.DATA_DESCRIPTOR+r(f.crc32,4)+r(f.compressedSize,4)+r(f.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:h.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var u=this.bytesWritten,y=0;y<this.dirRecords.length;y++)this.push({data:this.dirRecords[y],meta:{percent:100}});var h=this.bytesWritten-u,f=function(p,m,g,S,w){var x=s.transformTo("string",w(S));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(p,2)+r(p,2)+r(m,4)+r(g,4)+r(x.length,2)+x}(this.dirRecords.length,h,u,this.zipComment,this.encodeFileName);this.push({data:f,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(u){this._sources.push(u);var y=this;return u.on("data",function(h){y.processChunk(h)}),u.on("end",function(){y.closedSource(y.previous.streamInfo),y._sources.length?y.prepareNextSource():y.end()}),u.on("error",function(h){y.error(h)}),this},d.prototype.resume=function(){return!!a.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(u){var y=this._sources;if(!a.prototype.error.call(this,u))return!1;for(var h=0;h<y.length;h++)try{y[h].error(u)}catch{}return!0},d.prototype.lock=function(){a.prototype.lock.call(this);for(var u=this._sources,y=0;y<u.length;y++)u[y].lock()},e.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(s,a,i){var l=new o(a.streamFiles,i,a.platform,a.encodeFileName),c=0;try{s.forEach(function(d,u){c++;var y=function(m,g){var S=m||g,w=r[S];if(!w)throw new Error(S+" is not a valid compression method !");return w}(u.options.compression,a.compression),h=u.options.compressionOptions||a.compressionOptions||{},f=u.dir,p=u.date;u._compressWorker(y,h).withStreamInfo("file",{name:d,dir:f,date:p,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(l)}),l.entriesCount=c}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var s in this)typeof this[s]!="function"&&(o[s]=this[s]);return o}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.9.1",r.loadAsync=function(o,s){return new r().loadAsync(o,s)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./external"),s=t("./utf8"),a=t("./zipEntries"),i=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(d){return new o.Promise(function(u,y){var h=d.decompressed.getContentWorker().pipe(new i);h.on("error",function(f){y(f)}).on("end",function(){h.streamInfo.crc32!==d.decompressed.crc32?y(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}e.exports=function(d,u){var y=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,u.optimizedBinaryString,u.base64).then(function(h){var f=new a(u);return f.load(h),f}).then(function(h){var f=[o.Promise.resolve(h)],p=h.files;if(u.checkCRC32)for(var m=0;m<p.length;m++)f.push(c(p[m]));return o.Promise.all(f)}).then(function(h){for(var f=h.shift(),p=f.files,m=0;m<p.length;m++){var g=p[m],S=g.fileNameStr,w=r.resolve(g.fileNameStr);y.file(w,g.decompressed,{binary:!0,optimizedBinaryString:!0,date:g.date,dir:g.dir,comment:g.fileCommentStr.length?g.fileCommentStr:null,unixPermissions:g.unixPermissions,dosPermissions:g.dosPermissions,createFolders:u.createFolders}),g.dir||(y.file(w).unsafeOriginalName=S)}return f.zipComment.length&&(y.comment=f.zipComment),y})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../stream/GenericWorker");function s(a,i){o.call(this,"Nodejs stream input adapter for "+a),this._upstreamEnded=!1,this._bindStream(i)}r.inherits(s,o),s.prototype._bindStream=function(a){var i=this;(this._stream=a).pause(),a.on("data",function(l){i.push({data:l,meta:{percent:0}})}).on("error",function(l){i.isPaused?this.generatedError=l:i.error(l)}).on("end",function(){i.isPaused?i._upstreamEnded=!0:i.end()})},s.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var r=t("readable-stream").Readable;function o(s,a,i){r.call(this,a),this._helper=s;var l=this;s.on("data",function(c,d){l.push(c)||l._helper.pause(),i&&i(d)}).on("error",function(c){l.emit("error",c)}).on("end",function(){l.push(null)})}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},e.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,e,n){"use strict";function r(w,x,E){var T,A=s.getTypeOf(x),N=s.extend(E||{},l);N.date=N.date||new Date,N.compression!==null&&(N.compression=N.compression.toUpperCase()),typeof N.unixPermissions=="string"&&(N.unixPermissions=parseInt(N.unixPermissions,8)),N.unixPermissions&&16384&N.unixPermissions&&(N.dir=!0),N.dosPermissions&&16&N.dosPermissions&&(N.dir=!0),N.dir&&(w=p(w)),N.createFolders&&(T=f(w))&&m.call(this,T,!0);var H=A==="string"&&N.binary===!1&&N.base64===!1;E&&E.binary!==void 0||(N.binary=!H),(x instanceof c&&x.uncompressedSize===0||N.dir||!x||x.length===0)&&(N.base64=!1,N.binary=!0,x="",N.compression="STORE",A="string");var C=null;C=x instanceof c||x instanceof a?x:y.isNode&&y.isStream(x)?new h(w,x):s.prepareContent(w,x,N.binary,N.optimizedBinaryString,N.base64);var L=new d(w,C,N);this.files[w]=L}var o=t("./utf8"),s=t("./utils"),a=t("./stream/GenericWorker"),i=t("./stream/StreamHelper"),l=t("./defaults"),c=t("./compressedObject"),d=t("./zipObject"),u=t("./generate"),y=t("./nodejsUtils"),h=t("./nodejs/NodejsStreamInputAdapter"),f=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var x=w.lastIndexOf("/");return 0<x?w.substring(0,x):""},p=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},m=function(w,x){return x=x!==void 0?x:l.createFolders,w=p(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:x}),this.files[w]};function g(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var S={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var x,E,T;for(x in this.files)T=this.files[x],(E=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&w(E,T)},filter:function(w){var x=[];return this.forEach(function(E,T){w(E,T)&&x.push(T)}),x},file:function(w,x,E){if(arguments.length!==1)return w=this.root+w,r.call(this,w,x,E),this;if(g(w)){var T=w;return this.filter(function(N,H){return!H.dir&&T.test(N)})}var A=this.files[this.root+w];return A&&!A.dir?A:null},folder:function(w){if(!w)return this;if(g(w))return this.filter(function(A,N){return N.dir&&w.test(A)});var x=this.root+w,E=m.call(this,x),T=this.clone();return T.root=E.name,T},remove:function(w){w=this.root+w;var x=this.files[w];if(x||(w.slice(-1)!=="/"&&(w+="/"),x=this.files[w]),x&&!x.dir)delete this.files[w];else for(var E=this.filter(function(A,N){return N.name.slice(0,w.length)===w}),T=0;T<E.length;T++)delete this.files[E[T].name];return this},generate:function(w){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var x,E={};try{if((E=s.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=E.type.toLowerCase(),E.compression=E.compression.toUpperCase(),E.type==="binarystring"&&(E.type="string"),!E.type)throw new Error("No output type specified.");s.checkSupport(E.type),E.platform!=="darwin"&&E.platform!=="freebsd"&&E.platform!=="linux"&&E.platform!=="sunos"||(E.platform="UNIX"),E.platform==="win32"&&(E.platform="DOS");var T=E.comment||this.comment||"";x=u.generateWorker(this,E,T)}catch(A){(x=new a("error")).error(A)}return new i(x,E.type||"string",E.mimeType)},generateAsync:function(w,x){return this.generateInternalStream(w).accumulate(x)},generateNodeStream:function(w,x){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(x)}};e.exports=S},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var r=t("./DataReader");function o(s){r.call(this,s);for(var a=0;a<this.data.length;a++)s[a]=255&s[a]}t("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data[this.zero+s]},o.prototype.lastIndexOfSignature=function(s){for(var a=s.charCodeAt(0),i=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===a&&this.data[d+1]===i&&this.data[d+2]===l&&this.data[d+3]===c)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(s){var a=s.charCodeAt(0),i=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),d=this.readData(4);return a===d[0]&&i===d[1]&&l===d[2]&&c===d[3]},o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var a=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,a},e.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var r=t("../utils");function o(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(s){},readInt:function(s){var a,i=0;for(this.checkOffset(s),a=this.index+s-1;a>=this.index;a--)i=(i<<8)+this.byteAt(a);return this.index+=s,i},readString:function(s){return r.transformTo("string",this.readData(s))},readData:function(s){},lastIndexOfSignature:function(s){},readAndCheckSignature:function(s){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},e.exports=o},{"../utils":32}],19:[function(t,e,n){"use strict";var r=t("./Uint8ArrayReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.readData=function(s){this.checkOffset(s);var a=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,a},e.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var r=t("./DataReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},o.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},o.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},o.prototype.readData=function(s){this.checkOffset(s);var a=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,a},e.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var r=t("./ArrayReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var a=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,a},e.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../support"),s=t("./ArrayReader"),a=t("./StringReader"),i=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(c){var d=r.getTypeOf(c);return r.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new i(c):o.uint8array?new l(r.transformTo("uint8array",c)):new s(r.transformTo("array",c)):new a(c)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../utils");function s(a){r.call(this,"ConvertWorker to "+a),this.destType=a}o.inherits(s,r),s.prototype.processChunk=function(a){this.push({data:o.transformTo(this.destType,a.data),meta:a.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../crc32");function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,r),s.prototype.processChunk=function(a){this.streamInfo.crc32=o(a.data,this.streamInfo.crc32||0),this.push(a)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function s(a){o.call(this,"DataLengthProbe for "+a),this.propName=a,this.withStreamInfo(a,0)}r.inherits(s,o),s.prototype.processChunk=function(a){if(a){var i=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=i+a.data.length}o.prototype.processChunk.call(this,a)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function s(a){o.call(this,"DataWorker");var i=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,a.then(function(l){i.dataIsReady=!0,i.data=l,i.max=l&&l.length||0,i.type=r.getTypeOf(l),i.isPaused||i._tickAndRepeat()},function(l){i.error(l)})}r.inherits(s,o),s.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var a=null,i=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":a=this.data.substring(this.index,i);break;case"uint8array":a=this.data.subarray(this.index,i);break;case"array":case"nodebuffer":a=this.data.slice(this.index,i)}return this.index=i,this.push({data:a,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,s){return this._listeners[o].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,s){if(this._listeners[o])for(var a=0;a<this._listeners[o].length;a++)this._listeners[o][a].call(this,s)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var s=this;return o.on("data",function(a){s.processChunk(a)}),o.on("end",function(){s.end()}),o.on("error",function(a){s.error(a)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,s){return this.extraStreamInfo[o]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},e.exports=r},{}],29:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./ConvertWorker"),s=t("./GenericWorker"),a=t("../base64"),i=t("../support"),l=t("../external"),c=null;if(i.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(y,h){return new l.Promise(function(f,p){var m=[],g=y._internalType,S=y._outputType,w=y._mimeType;y.on("data",function(x,E){m.push(x),h&&h(E)}).on("error",function(x){m=[],p(x)}).on("end",function(){try{var x=function(E,T,A){switch(E){case"blob":return r.newBlob(r.transformTo("arraybuffer",T),A);case"base64":return a.encode(T);default:return r.transformTo(E,T)}}(S,function(E,T){var A,N=0,H=null,C=0;for(A=0;A<T.length;A++)C+=T[A].length;switch(E){case"string":return T.join("");case"array":return Array.prototype.concat.apply([],T);case"uint8array":for(H=new Uint8Array(C),A=0;A<T.length;A++)H.set(T[A],N),N+=T[A].length;return H;case"nodebuffer":return Buffer.concat(T);default:throw new Error("concat : unsupported type '"+E+"'")}}(g,m),w);f(x)}catch(E){p(E)}m=[]}).resume()})}function u(y,h,f){var p=h;switch(h){case"blob":case"arraybuffer":p="uint8array";break;case"base64":p="string"}try{this._internalType=p,this._outputType=h,this._mimeType=f,r.checkSupport(p),this._worker=y.pipe(new o(p)),y.lock()}catch(m){this._worker=new s("error"),this._worker.error(m)}}u.prototype={accumulate:function(y){return d(this,y)},on:function(y,h){var f=this;return y==="data"?this._worker.on(y,function(p){h.call(f,p.data,p.meta)}):this._worker.on(y,function(){r.delay(h,arguments,f)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(y){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},y)}},e.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var r=t("./utils"),o=t("./support"),s=t("./nodejsUtils"),a=t("./stream/GenericWorker"),i=new Array(256),l=0;l<256;l++)i[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;i[254]=i[254]=1;function c(){a.call(this,"utf-8 decode"),this.leftOver=null}function d(){a.call(this,"utf-8 encode")}n.utf8encode=function(u){return o.nodebuffer?s.newBufferFrom(u,"utf-8"):function(y){var h,f,p,m,g,S=y.length,w=0;for(m=0;m<S;m++)(64512&(f=y.charCodeAt(m)))==55296&&m+1<S&&(64512&(p=y.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),w+=f<128?1:f<2048?2:f<65536?3:4;for(h=o.uint8array?new Uint8Array(w):new Array(w),m=g=0;g<w;m++)(64512&(f=y.charCodeAt(m)))==55296&&m+1<S&&(64512&(p=y.charCodeAt(m+1)))==56320&&(f=65536+(f-55296<<10)+(p-56320),m++),f<128?h[g++]=f:(f<2048?h[g++]=192|f>>>6:(f<65536?h[g++]=224|f>>>12:(h[g++]=240|f>>>18,h[g++]=128|f>>>12&63),h[g++]=128|f>>>6&63),h[g++]=128|63&f);return h}(u)},n.utf8decode=function(u){return o.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(y){var h,f,p,m,g=y.length,S=new Array(2*g);for(h=f=0;h<g;)if((p=y[h++])<128)S[f++]=p;else if(4<(m=i[p]))S[f++]=65533,h+=m-1;else{for(p&=m===2?31:m===3?15:7;1<m&&h<g;)p=p<<6|63&y[h++],m--;1<m?S[f++]=65533:p<65536?S[f++]=p:(p-=65536,S[f++]=55296|p>>10&1023,S[f++]=56320|1023&p)}return S.length!==f&&(S.subarray?S=S.subarray(0,f):S.length=f),r.applyFromCharCode(S)}(u=r.transformTo(o.uint8array?"uint8array":"array",u))},r.inherits(c,a),c.prototype.processChunk=function(u){var y=r.transformTo(o.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var h=y;(y=new Uint8Array(h.length+this.leftOver.length)).set(this.leftOver,0),y.set(h,this.leftOver.length)}else y=this.leftOver.concat(y);this.leftOver=null}var f=function(m,g){var S;for((g=g||m.length)>m.length&&(g=m.length),S=g-1;0<=S&&(192&m[S])==128;)S--;return S<0||S===0?g:S+i[m[S]]>g?S:g}(y),p=y;f!==y.length&&(o.uint8array?(p=y.subarray(0,f),this.leftOver=y.subarray(f,y.length)):(p=y.slice(0,f),this.leftOver=y.slice(f,y.length))),this.push({data:n.utf8decode(p),meta:u.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,r.inherits(d,a),d.prototype.processChunk=function(u){this.push({data:n.utf8encode(u.data),meta:u.meta})},n.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var r=t("./support"),o=t("./base64"),s=t("./nodejsUtils"),a=t("set-immediate-shim"),i=t("./external");function l(f){return f}function c(f,p){for(var m=0;m<f.length;++m)p[m]=255&f.charCodeAt(m);return p}n.newBlob=function(f,p){n.checkSupport("blob");try{return new Blob([f],{type:p})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(f),m.getBlob(p)}catch{throw new Error("Bug : can't construct the Blob.")}}};var d={stringifyByChunk:function(f,p,m){var g=[],S=0,w=f.length;if(w<=m)return String.fromCharCode.apply(null,f);for(;S<w;)p==="array"||p==="nodebuffer"?g.push(String.fromCharCode.apply(null,f.slice(S,Math.min(S+m,w)))):g.push(String.fromCharCode.apply(null,f.subarray(S,Math.min(S+m,w)))),S+=m;return g.join("")},stringifyByChar:function(f){for(var p="",m=0;m<f.length;m++)p+=String.fromCharCode(f[m]);return p},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function u(f){var p=65536,m=n.getTypeOf(f),g=!0;if(m==="uint8array"?g=d.applyCanBeUsed.uint8array:m==="nodebuffer"&&(g=d.applyCanBeUsed.nodebuffer),g)for(;1<p;)try{return d.stringifyByChunk(f,m,p)}catch{p=Math.floor(p/2)}return d.stringifyByChar(f)}function y(f,p){for(var m=0;m<f.length;m++)p[m]=f[m];return p}n.applyFromCharCode=u;var h={};h.string={string:l,array:function(f){return c(f,new Array(f.length))},arraybuffer:function(f){return h.string.uint8array(f).buffer},uint8array:function(f){return c(f,new Uint8Array(f.length))},nodebuffer:function(f){return c(f,s.allocBuffer(f.length))}},h.array={string:u,array:l,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return s.newBufferFrom(f)}},h.arraybuffer={string:function(f){return u(new Uint8Array(f))},array:function(f){return y(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:l,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return s.newBufferFrom(new Uint8Array(f))}},h.uint8array={string:u,array:function(f){return y(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:l,nodebuffer:function(f){return s.newBufferFrom(f)}},h.nodebuffer={string:u,array:function(f){return y(f,new Array(f.length))},arraybuffer:function(f){return h.nodebuffer.uint8array(f).buffer},uint8array:function(f){return y(f,new Uint8Array(f.length))},nodebuffer:l},n.transformTo=function(f,p){if(p=p||"",!f)return p;n.checkSupport(f);var m=n.getTypeOf(p);return h[m][f](p)},n.resolve=function(f){for(var p=f.split("/"),m=[],g=0;g<p.length;g++){var S=p[g];S==="."||S===""&&g!==0&&g!==p.length-1||(S===".."?m.pop():m.push(S))}return m.join("/")},n.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":r.nodebuffer&&s.isBuffer(f)?"nodebuffer":r.uint8array&&f instanceof Uint8Array?"uint8array":r.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(f){if(!r[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(f){var p,m,g="";for(m=0;m<(f||"").length;m++)g+="\\x"+((p=f.charCodeAt(m))<16?"0":"")+p.toString(16).toUpperCase();return g},n.delay=function(f,p,m){a(function(){f.apply(m||null,p||[])})},n.inherits=function(f,p){function m(){}m.prototype=p.prototype,f.prototype=new m},n.extend=function(){var f,p,m={};for(f=0;f<arguments.length;f++)for(p in arguments[f])arguments[f].hasOwnProperty(p)&&m[p]===void 0&&(m[p]=arguments[f][p]);return m},n.prepareContent=function(f,p,m,g,S){return i.Promise.resolve(p).then(function(w){return r.blob&&(w instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(w))!==-1)&&typeof FileReader<"u"?new i.Promise(function(x,E){var T=new FileReader;T.onload=function(A){x(A.target.result)},T.onerror=function(A){E(A.target.error)},T.readAsArrayBuffer(w)}):w}).then(function(w){var x=n.getTypeOf(w);return x?(x==="arraybuffer"?w=n.transformTo("uint8array",w):x==="string"&&(S?w=o.decode(w):m&&g!==!0&&(w=function(E){return c(E,r.uint8array?new Uint8Array(E.length):new Array(E.length))}(w))),w):i.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,"set-immediate-shim":54}],33:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),s=t("./signature"),a=t("./zipEntry"),i=(t("./utf8"),t("./support"));function l(c){this.files=[],this.loadOptions=c}l.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(c)+")")}},isSignature:function(c,d){var u=this.reader.index;this.reader.setIndex(c);var y=this.reader.readString(4)===d;return this.reader.setIndex(u),y},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),d=i.uint8array?"uint8array":"array",u=o.transformTo(d,c);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c,d,u,y=this.zip64EndOfCentralSize-44;0<y;)c=this.reader.readInt(2),d=this.reader.readInt(4),u=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,d;for(c=0;c<this.files.length;c++)d=this.files[c],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(c=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(c<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(c);var d=c;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(c=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var y=d-u;if(0<y)this.isSignature(d,s.CENTRAL_FILE_HEADER)||(this.reader.zero=y);else if(y<0)throw new Error("Corrupted zip: missing "+Math.abs(y)+" bytes.")},prepareReader:function(c){this.reader=r(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utf8":31,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),s=t("./compressedObject"),a=t("./crc32"),i=t("./utf8"),l=t("./compressions"),c=t("./support");function d(u,y){this.options=u,this.loadOptions=y}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var y,h;if(u.skip(22),this.fileNameLength=u.readInt(2),h=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(h),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((y=function(f){for(var p in l)if(l.hasOwnProperty(p)&&l[p].magic===f)return l[p];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,y,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var y=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(y),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(u){if(this.extraFields[1]){var y=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=y.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=y.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=y.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=y.readInt(4))}},readExtraFields:function(u){var y,h,f,p=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<p;)y=u.readInt(2),h=u.readInt(2),f=u.readData(h),this.extraFields[y]={id:y,length:h,value:f};u.setIndex(p)},handleUTF8:function(){var u=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=i.utf8decode(this.fileName),this.fileCommentStr=i.utf8decode(this.fileComment);else{var y=this.findExtraFieldUnicodePath();if(y!==null)this.fileNameStr=y;else{var h=o.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(h)}var f=this.findExtraFieldUnicodeComment();if(f!==null)this.fileCommentStr=f;else{var p=o.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(p)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var y=r(u.value);return y.readInt(1)!==1||a(this.fileName)!==y.readInt(4)?null:i.utf8decode(y.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var y=r(u.value);return y.readInt(1)!==1||a(this.fileComment)!==y.readInt(4)?null:i.utf8decode(y.readData(u.length-5))}return null}},e.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function r(y,h,f){this.name=y,this.dir=f.dir,this.date=f.date,this.comment=f.comment,this.unixPermissions=f.unixPermissions,this.dosPermissions=f.dosPermissions,this._data=h,this._dataBinary=f.binary,this.options={compression:f.compression,compressionOptions:f.compressionOptions}}var o=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),a=t("./utf8"),i=t("./compressedObject"),l=t("./stream/GenericWorker");r.prototype={internalStream:function(y){var h=null,f="string";try{if(!y)throw new Error("No output type specified.");var p=(f=y.toLowerCase())==="string"||f==="text";f!=="binarystring"&&f!=="text"||(f="string"),h=this._decompressWorker();var m=!this._dataBinary;m&&!p&&(h=h.pipe(new a.Utf8EncodeWorker)),!m&&p&&(h=h.pipe(new a.Utf8DecodeWorker))}catch(g){(h=new l("error")).error(g)}return new o(h,f,"")},async:function(y,h){return this.internalStream(y).accumulate(h)},nodeStream:function(y,h){return this.internalStream(y||"nodebuffer").toNodejsStream(h)},_compressWorker:function(y,h){if(this._data instanceof i&&this._data.compression.magic===y.magic)return this._data.getCompressedWorker();var f=this._decompressWorker();return this._dataBinary||(f=f.pipe(new a.Utf8EncodeWorker)),i.createWorkerFrom(f,y,h)},_decompressWorker:function(){return this._data instanceof i?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)r.prototype[c[u]]=d;e.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(r){"use strict";var o,s,a=r.MutationObserver||r.WebKitMutationObserver;if(a){var i=0,l=new a(y),c=r.document.createTextNode("");l.observe(c,{characterData:!0}),o=function(){c.data=i=++i%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var h=r.document.createElement("script");h.onreadystatechange=function(){y(),h.onreadystatechange=null,h.parentNode.removeChild(h),h=null},r.document.documentElement.appendChild(h)}:function(){setTimeout(y,0)};else{var d=new r.MessageChannel;d.port1.onmessage=y,o=function(){d.port2.postMessage(0)}}var u=[];function y(){var h,f;s=!0;for(var p=u.length;p;){for(f=u,u=[],h=-1;++h<p;)f[h]();p=u.length}s=!1}e.exports=function(h){u.push(h)!==1||s||o()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,e,n){"use strict";var r=t("immediate");function o(){}var s={},a=["REJECTED"],i=["FULFILLED"],l=["PENDING"];function c(p){if(typeof p!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,p!==o&&h(this,p)}function d(p,m,g){this.promise=p,typeof m=="function"&&(this.onFulfilled=m,this.callFulfilled=this.otherCallFulfilled),typeof g=="function"&&(this.onRejected=g,this.callRejected=this.otherCallRejected)}function u(p,m,g){r(function(){var S;try{S=m(g)}catch(w){return s.reject(p,w)}S===p?s.reject(p,new TypeError("Cannot resolve promise with itself")):s.resolve(p,S)})}function y(p){var m=p&&p.then;if(p&&(typeof p=="object"||typeof p=="function")&&typeof m=="function")return function(){m.apply(p,arguments)}}function h(p,m){var g=!1;function S(E){g||(g=!0,s.reject(p,E))}function w(E){g||(g=!0,s.resolve(p,E))}var x=f(function(){m(w,S)});x.status==="error"&&S(x.value)}function f(p,m){var g={};try{g.value=p(m),g.status="success"}catch(S){g.status="error",g.value=S}return g}(e.exports=c).prototype.finally=function(p){if(typeof p!="function")return this;var m=this.constructor;return this.then(function(g){return m.resolve(p()).then(function(){return g})},function(g){return m.resolve(p()).then(function(){throw g})})},c.prototype.catch=function(p){return this.then(null,p)},c.prototype.then=function(p,m){if(typeof p!="function"&&this.state===i||typeof m!="function"&&this.state===a)return this;var g=new this.constructor(o);return this.state!==l?u(g,this.state===i?p:m,this.outcome):this.queue.push(new d(g,p,m)),g},d.prototype.callFulfilled=function(p){s.resolve(this.promise,p)},d.prototype.otherCallFulfilled=function(p){u(this.promise,this.onFulfilled,p)},d.prototype.callRejected=function(p){s.reject(this.promise,p)},d.prototype.otherCallRejected=function(p){u(this.promise,this.onRejected,p)},s.resolve=function(p,m){var g=f(y,m);if(g.status==="error")return s.reject(p,g.value);var S=g.value;if(S)h(p,S);else{p.state=i,p.outcome=m;for(var w=-1,x=p.queue.length;++w<x;)p.queue[w].callFulfilled(m)}return p},s.reject=function(p,m){p.state=a,p.outcome=m;for(var g=-1,S=p.queue.length;++g<S;)p.queue[g].callRejected(m);return p},c.resolve=function(p){return p instanceof this?p:s.resolve(new this(o),p)},c.reject=function(p){var m=new this(o);return s.reject(m,p)},c.all=function(p){var m=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var g=p.length,S=!1;if(!g)return this.resolve([]);for(var w=new Array(g),x=0,E=-1,T=new this(o);++E<g;)A(p[E],E);return T;function A(N,H){m.resolve(N).then(function(C){w[H]=C,++x!==g||S||(S=!0,s.resolve(T,w))},function(C){S||(S=!0,s.reject(T,C))})}},c.race=function(p){var m=this;if(Object.prototype.toString.call(p)!=="[object Array]")return this.reject(new TypeError("must be an array"));var g=p.length,S=!1;if(!g)return this.resolve([]);for(var w=-1,x=new this(o);++w<g;)E=p[w],m.resolve(E).then(function(T){S||(S=!0,s.resolve(x,T))},function(T){S||(S=!0,s.reject(x,T))});var E;return x}},{immediate:36}],38:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),o=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/messages"),i=t("./zlib/zstream"),l=Object.prototype.toString,c=0,d=-1,u=0,y=8;function h(p){if(!(this instanceof h))return new h(p);this.options=o.assign({level:d,method:y,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},p||{});var m=this.options;m.raw&&0<m.windowBits?m.windowBits=-m.windowBits:m.gzip&&0<m.windowBits&&m.windowBits<16&&(m.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new i,this.strm.avail_out=0;var g=r.deflateInit2(this.strm,m.level,m.method,m.windowBits,m.memLevel,m.strategy);if(g!==c)throw new Error(a[g]);if(m.header&&r.deflateSetHeader(this.strm,m.header),m.dictionary){var S;if(S=typeof m.dictionary=="string"?s.string2buf(m.dictionary):l.call(m.dictionary)==="[object ArrayBuffer]"?new Uint8Array(m.dictionary):m.dictionary,(g=r.deflateSetDictionary(this.strm,S))!==c)throw new Error(a[g]);this._dict_set=!0}}function f(p,m){var g=new h(m);if(g.push(p,!0),g.err)throw g.msg||a[g.err];return g.result}h.prototype.push=function(p,m){var g,S,w=this.strm,x=this.options.chunkSize;if(this.ended)return!1;S=m===~~m?m:m===!0?4:0,typeof p=="string"?w.input=s.string2buf(p):l.call(p)==="[object ArrayBuffer]"?w.input=new Uint8Array(p):w.input=p,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(x),w.next_out=0,w.avail_out=x),(g=r.deflate(w,S))!==1&&g!==c)return this.onEnd(g),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||S!==4&&S!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&g!==1);return S===4?(g=r.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===c):S!==2||(this.onEnd(c),!(w.avail_out=0))},h.prototype.onData=function(p){this.chunks.push(p)},h.prototype.onEnd=function(p){p===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=p,this.msg=this.strm.msg},n.Deflate=h,n.deflate=f,n.deflateRaw=function(p,m){return(m=m||{}).raw=!0,f(p,m)},n.gzip=function(p,m){return(m=m||{}).gzip=!0,f(p,m)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),o=t("./utils/common"),s=t("./utils/strings"),a=t("./zlib/constants"),i=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),d=Object.prototype.toString;function u(h){if(!(this instanceof u))return new u(h);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},h||{});var f=this.options;f.raw&&0<=f.windowBits&&f.windowBits<16&&(f.windowBits=-f.windowBits,f.windowBits===0&&(f.windowBits=-15)),!(0<=f.windowBits&&f.windowBits<16)||h&&h.windowBits||(f.windowBits+=32),15<f.windowBits&&f.windowBits<48&&!(15&f.windowBits)&&(f.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var p=r.inflateInit2(this.strm,f.windowBits);if(p!==a.Z_OK)throw new Error(i[p]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function y(h,f){var p=new u(f);if(p.push(h,!0),p.err)throw p.msg||i[p.err];return p.result}u.prototype.push=function(h,f){var p,m,g,S,w,x,E=this.strm,T=this.options.chunkSize,A=this.options.dictionary,N=!1;if(this.ended)return!1;m=f===~~f?f:f===!0?a.Z_FINISH:a.Z_NO_FLUSH,typeof h=="string"?E.input=s.binstring2buf(h):d.call(h)==="[object ArrayBuffer]"?E.input=new Uint8Array(h):E.input=h,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(T),E.next_out=0,E.avail_out=T),(p=r.inflate(E,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&A&&(x=typeof A=="string"?s.string2buf(A):d.call(A)==="[object ArrayBuffer]"?new Uint8Array(A):A,p=r.inflateSetDictionary(this.strm,x)),p===a.Z_BUF_ERROR&&N===!0&&(p=a.Z_OK,N=!1),p!==a.Z_STREAM_END&&p!==a.Z_OK)return this.onEnd(p),!(this.ended=!0);E.next_out&&(E.avail_out!==0&&p!==a.Z_STREAM_END&&(E.avail_in!==0||m!==a.Z_FINISH&&m!==a.Z_SYNC_FLUSH)||(this.options.to==="string"?(g=s.utf8border(E.output,E.next_out),S=E.next_out-g,w=s.buf2string(E.output,g),E.next_out=S,E.avail_out=T-S,S&&o.arraySet(E.output,E.output,g,S,0),this.onData(w)):this.onData(o.shrinkBuf(E.output,E.next_out)))),E.avail_in===0&&E.avail_out===0&&(N=!0)}while((0<E.avail_in||E.avail_out===0)&&p!==a.Z_STREAM_END);return p===a.Z_STREAM_END&&(m=a.Z_FINISH),m===a.Z_FINISH?(p=r.inflateEnd(this.strm),this.onEnd(p),this.ended=!0,p===a.Z_OK):m!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),!(E.avail_out=0))},u.prototype.onData=function(h){this.chunks.push(h)},u.prototype.onEnd=function(h){h===a.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=h,this.msg=this.strm.msg},n.Inflate=u,n.inflate=y,n.inflateRaw=function(h,f){return(f=f||{}).raw=!0,y(h,f)},n.ungzip=y},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(a){for(var i=Array.prototype.slice.call(arguments,1);i.length;){var l=i.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(a[c]=l[c])}}return a},n.shrinkBuf=function(a,i){return a.length===i?a:a.subarray?a.subarray(0,i):(a.length=i,a)};var o={arraySet:function(a,i,l,c,d){if(i.subarray&&a.subarray)a.set(i.subarray(l,l+c),d);else for(var u=0;u<c;u++)a[d+u]=i[l+u]},flattenChunks:function(a){var i,l,c,d,u,y;for(i=c=0,l=a.length;i<l;i++)c+=a[i].length;for(y=new Uint8Array(c),i=d=0,l=a.length;i<l;i++)u=a[i],y.set(u,d),d+=u.length;return y}},s={arraySet:function(a,i,l,c,d){for(var u=0;u<c;u++)a[d+u]=i[l+u]},flattenChunks:function(a){return[].concat.apply([],a)}};n.setTyped=function(a){a?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],42:[function(t,e,n){"use strict";var r=t("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var a=new r.Buf8(256),i=0;i<256;i++)a[i]=252<=i?6:248<=i?5:240<=i?4:224<=i?3:192<=i?2:1;function l(c,d){if(d<65537&&(c.subarray&&s||!c.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(c,d));for(var u="",y=0;y<d;y++)u+=String.fromCharCode(c[y]);return u}a[254]=a[254]=1,n.string2buf=function(c){var d,u,y,h,f,p=c.length,m=0;for(h=0;h<p;h++)(64512&(u=c.charCodeAt(h)))==55296&&h+1<p&&(64512&(y=c.charCodeAt(h+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),h++),m+=u<128?1:u<2048?2:u<65536?3:4;for(d=new r.Buf8(m),h=f=0;f<m;h++)(64512&(u=c.charCodeAt(h)))==55296&&h+1<p&&(64512&(y=c.charCodeAt(h+1)))==56320&&(u=65536+(u-55296<<10)+(y-56320),h++),u<128?d[f++]=u:(u<2048?d[f++]=192|u>>>6:(u<65536?d[f++]=224|u>>>12:(d[f++]=240|u>>>18,d[f++]=128|u>>>12&63),d[f++]=128|u>>>6&63),d[f++]=128|63&u);return d},n.buf2binstring=function(c){return l(c,c.length)},n.binstring2buf=function(c){for(var d=new r.Buf8(c.length),u=0,y=d.length;u<y;u++)d[u]=c.charCodeAt(u);return d},n.buf2string=function(c,d){var u,y,h,f,p=d||c.length,m=new Array(2*p);for(u=y=0;u<p;)if((h=c[u++])<128)m[y++]=h;else if(4<(f=a[h]))m[y++]=65533,u+=f-1;else{for(h&=f===2?31:f===3?15:7;1<f&&u<p;)h=h<<6|63&c[u++],f--;1<f?m[y++]=65533:h<65536?m[y++]=h:(h-=65536,m[y++]=55296|h>>10&1023,m[y++]=56320|1023&h)}return l(m,y)},n.utf8border=function(c,d){var u;for((d=d||c.length)>c.length&&(d=c.length),u=d-1;0<=u&&(192&c[u])==128;)u--;return u<0||u===0?d:u+a[c[u]]>d?u:d}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(r,o,s,a){for(var i=65535&r|0,l=r>>>16&65535|0,c=0;s!==0;){for(s-=c=2e3<s?2e3:s;l=l+(i=i+o[a++]|0)|0,--c;);i%=65521,l%=65521}return i|l<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var r=function(){for(var o,s=[],a=0;a<256;a++){o=a;for(var i=0;i<8;i++)o=1&o?3988292384^o>>>1:o>>>1;s[a]=o}return s}();e.exports=function(o,s,a,i){var l=r,c=i+a;o^=-1;for(var d=i;d<c;d++)o=o>>>8^l[255&(o^s[d])];return-1^o}},{}],46:[function(t,e,n){"use strict";var r,o=t("../utils/common"),s=t("./trees"),a=t("./adler32"),i=t("./crc32"),l=t("./messages"),c=0,d=4,u=0,y=-2,h=-1,f=4,p=2,m=8,g=9,S=286,w=30,x=19,E=2*S+1,T=15,A=3,N=258,H=N+A+1,C=42,L=113,v=1,B=2,le=3,X=4;function de(b,D){return b.msg=l[D],D}function _(b){return(b<<1)-(4<b?9:0)}function re(b){for(var D=b.length;0<=--D;)b[D]=0}function R(b){var D=b.state,F=D.pending;F>b.avail_out&&(F=b.avail_out),F!==0&&(o.arraySet(b.output,D.pending_buf,D.pending_out,F,b.next_out),b.next_out+=F,D.pending_out+=F,b.total_out+=F,b.avail_out-=F,D.pending-=F,D.pending===0&&(D.pending_out=0))}function k(b,D){s._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,D),b.block_start=b.strstart,R(b.strm)}function V(b,D){b.pending_buf[b.pending++]=D}function ee(b,D){b.pending_buf[b.pending++]=D>>>8&255,b.pending_buf[b.pending++]=255&D}function ie(b,D){var F,P,I=b.max_chain_length,J=b.strstart,te=b.prev_length,z=b.nice_match,M=b.strstart>b.w_size-H?b.strstart-(b.w_size-H):0,K=b.window,$=b.w_mask,Q=b.prev,se=b.strstart+N,O=K[J+te-1],U=K[J+te];b.prev_length>=b.good_match&&(I>>=2),z>b.lookahead&&(z=b.lookahead);do if(K[(F=D)+te]===U&&K[F+te-1]===O&&K[F]===K[J]&&K[++F]===K[J+1]){J+=2,F++;do;while(K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&K[++J]===K[++F]&&J<se);if(P=N-(se-J),J=se-N,te<P){if(b.match_start=D,z<=(te=P))break;O=K[J+te-1],U=K[J+te]}}while((D=Q[D&$])>M&&--I!=0);return te<=b.lookahead?te:b.lookahead}function fe(b){var D,F,P,I,J,te,z,M,K,$,Q=b.w_size;do{if(I=b.window_size-b.lookahead-b.strstart,b.strstart>=Q+(Q-H)){for(o.arraySet(b.window,b.window,Q,Q,0),b.match_start-=Q,b.strstart-=Q,b.block_start-=Q,D=F=b.hash_size;P=b.head[--D],b.head[D]=Q<=P?P-Q:0,--F;);for(D=F=Q;P=b.prev[--D],b.prev[D]=Q<=P?P-Q:0,--F;);I+=Q}if(b.strm.avail_in===0)break;if(te=b.strm,z=b.window,M=b.strstart+b.lookahead,K=I,$=void 0,$=te.avail_in,K<$&&($=K),F=$===0?0:(te.avail_in-=$,o.arraySet(z,te.input,te.next_in,$,M),te.state.wrap===1?te.adler=a(te.adler,z,$,M):te.state.wrap===2&&(te.adler=i(te.adler,z,$,M)),te.next_in+=$,te.total_in+=$,$),b.lookahead+=F,b.lookahead+b.insert>=A)for(J=b.strstart-b.insert,b.ins_h=b.window[J],b.ins_h=(b.ins_h<<b.hash_shift^b.window[J+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[J+A-1])&b.hash_mask,b.prev[J&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=J,J++,b.insert--,!(b.lookahead+b.insert<A)););}while(b.lookahead<H&&b.strm.avail_in!==0)}function G(b,D){for(var F,P;;){if(b.lookahead<H){if(fe(b),b.lookahead<H&&D===c)return v;if(b.lookahead===0)break}if(F=0,b.lookahead>=A&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+A-1])&b.hash_mask,F=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),F!==0&&b.strstart-F<=b.w_size-H&&(b.match_length=ie(b,F)),b.match_length>=A)if(P=s._tr_tally(b,b.strstart-b.match_start,b.match_length-A),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=A){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+A-1])&b.hash_mask,F=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else P=s._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(P&&(k(b,!1),b.strm.avail_out===0))return v}return b.insert=b.strstart<A-1?b.strstart:A-1,D===d?(k(b,!0),b.strm.avail_out===0?le:X):b.last_lit&&(k(b,!1),b.strm.avail_out===0)?v:B}function Z(b,D){for(var F,P,I;;){if(b.lookahead<H){if(fe(b),b.lookahead<H&&D===c)return v;if(b.lookahead===0)break}if(F=0,b.lookahead>=A&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+A-1])&b.hash_mask,F=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=A-1,F!==0&&b.prev_length<b.max_lazy_match&&b.strstart-F<=b.w_size-H&&(b.match_length=ie(b,F),b.match_length<=5&&(b.strategy===1||b.match_length===A&&4096<b.strstart-b.match_start)&&(b.match_length=A-1)),b.prev_length>=A&&b.match_length<=b.prev_length){for(I=b.strstart+b.lookahead-A,P=s._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-A),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=I&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+A-1])&b.hash_mask,F=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=A-1,b.strstart++,P&&(k(b,!1),b.strm.avail_out===0))return v}else if(b.match_available){if((P=s._tr_tally(b,0,b.window[b.strstart-1]))&&k(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return v}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(P=s._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<A-1?b.strstart:A-1,D===d?(k(b,!0),b.strm.avail_out===0?le:X):b.last_lit&&(k(b,!1),b.strm.avail_out===0)?v:B}function j(b,D,F,P,I){this.good_length=b,this.max_lazy=D,this.nice_length=F,this.max_chain=P,this.func=I}function Y(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=m,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*E),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*x+1)),re(this.dyn_ltree),re(this.dyn_dtree),re(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(T+1),this.heap=new o.Buf16(2*S+1),re(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*S+1),re(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function ne(b){var D;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=p,(D=b.state).pending=0,D.pending_out=0,D.wrap<0&&(D.wrap=-D.wrap),D.status=D.wrap?C:L,b.adler=D.wrap===2?0:1,D.last_flush=c,s._tr_init(D),u):de(b,y)}function q(b){var D=ne(b);return D===u&&function(F){F.window_size=2*F.w_size,re(F.head),F.max_lazy_match=r[F.level].max_lazy,F.good_match=r[F.level].good_length,F.nice_match=r[F.level].nice_length,F.max_chain_length=r[F.level].max_chain,F.strstart=0,F.block_start=0,F.lookahead=0,F.insert=0,F.match_length=F.prev_length=A-1,F.match_available=0,F.ins_h=0}(b.state),D}function W(b,D,F,P,I,J){if(!b)return y;var te=1;if(D===h&&(D=6),P<0?(te=0,P=-P):15<P&&(te=2,P-=16),I<1||g<I||F!==m||P<8||15<P||D<0||9<D||J<0||f<J)return de(b,y);P===8&&(P=9);var z=new Y;return(b.state=z).strm=b,z.wrap=te,z.gzhead=null,z.w_bits=P,z.w_size=1<<z.w_bits,z.w_mask=z.w_size-1,z.hash_bits=I+7,z.hash_size=1<<z.hash_bits,z.hash_mask=z.hash_size-1,z.hash_shift=~~((z.hash_bits+A-1)/A),z.window=new o.Buf8(2*z.w_size),z.head=new o.Buf16(z.hash_size),z.prev=new o.Buf16(z.w_size),z.lit_bufsize=1<<I+6,z.pending_buf_size=4*z.lit_bufsize,z.pending_buf=new o.Buf8(z.pending_buf_size),z.d_buf=1*z.lit_bufsize,z.l_buf=3*z.lit_bufsize,z.level=D,z.strategy=J,z.method=F,q(b)}r=[new j(0,0,0,0,function(b,D){var F=65535;for(F>b.pending_buf_size-5&&(F=b.pending_buf_size-5);;){if(b.lookahead<=1){if(fe(b),b.lookahead===0&&D===c)return v;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var P=b.block_start+F;if((b.strstart===0||b.strstart>=P)&&(b.lookahead=b.strstart-P,b.strstart=P,k(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-H&&(k(b,!1),b.strm.avail_out===0))return v}return b.insert=0,D===d?(k(b,!0),b.strm.avail_out===0?le:X):(b.strstart>b.block_start&&(k(b,!1),b.strm.avail_out),v)}),new j(4,4,8,4,G),new j(4,5,16,8,G),new j(4,6,32,32,G),new j(4,4,16,16,Z),new j(8,16,32,32,Z),new j(8,16,128,128,Z),new j(8,32,128,256,Z),new j(32,128,258,1024,Z),new j(32,258,258,4096,Z)],n.deflateInit=function(b,D){return W(b,D,m,15,8,0)},n.deflateInit2=W,n.deflateReset=q,n.deflateResetKeep=ne,n.deflateSetHeader=function(b,D){return b&&b.state?b.state.wrap!==2?y:(b.state.gzhead=D,u):y},n.deflate=function(b,D){var F,P,I,J;if(!b||!b.state||5<D||D<0)return b?de(b,y):y;if(P=b.state,!b.output||!b.input&&b.avail_in!==0||P.status===666&&D!==d)return de(b,b.avail_out===0?-5:y);if(P.strm=b,F=P.last_flush,P.last_flush=D,P.status===C)if(P.wrap===2)b.adler=0,V(P,31),V(P,139),V(P,8),P.gzhead?(V(P,(P.gzhead.text?1:0)+(P.gzhead.hcrc?2:0)+(P.gzhead.extra?4:0)+(P.gzhead.name?8:0)+(P.gzhead.comment?16:0)),V(P,255&P.gzhead.time),V(P,P.gzhead.time>>8&255),V(P,P.gzhead.time>>16&255),V(P,P.gzhead.time>>24&255),V(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),V(P,255&P.gzhead.os),P.gzhead.extra&&P.gzhead.extra.length&&(V(P,255&P.gzhead.extra.length),V(P,P.gzhead.extra.length>>8&255)),P.gzhead.hcrc&&(b.adler=i(b.adler,P.pending_buf,P.pending,0)),P.gzindex=0,P.status=69):(V(P,0),V(P,0),V(P,0),V(P,0),V(P,0),V(P,P.level===9?2:2<=P.strategy||P.level<2?4:0),V(P,3),P.status=L);else{var te=m+(P.w_bits-8<<4)<<8;te|=(2<=P.strategy||P.level<2?0:P.level<6?1:P.level===6?2:3)<<6,P.strstart!==0&&(te|=32),te+=31-te%31,P.status=L,ee(P,te),P.strstart!==0&&(ee(P,b.adler>>>16),ee(P,65535&b.adler)),b.adler=1}if(P.status===69)if(P.gzhead.extra){for(I=P.pending;P.gzindex<(65535&P.gzhead.extra.length)&&(P.pending!==P.pending_buf_size||(P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),R(b),I=P.pending,P.pending!==P.pending_buf_size));)V(P,255&P.gzhead.extra[P.gzindex]),P.gzindex++;P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),P.gzindex===P.gzhead.extra.length&&(P.gzindex=0,P.status=73)}else P.status=73;if(P.status===73)if(P.gzhead.name){I=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),R(b),I=P.pending,P.pending===P.pending_buf_size)){J=1;break}J=P.gzindex<P.gzhead.name.length?255&P.gzhead.name.charCodeAt(P.gzindex++):0,V(P,J)}while(J!==0);P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),J===0&&(P.gzindex=0,P.status=91)}else P.status=91;if(P.status===91)if(P.gzhead.comment){I=P.pending;do{if(P.pending===P.pending_buf_size&&(P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),R(b),I=P.pending,P.pending===P.pending_buf_size)){J=1;break}J=P.gzindex<P.gzhead.comment.length?255&P.gzhead.comment.charCodeAt(P.gzindex++):0,V(P,J)}while(J!==0);P.gzhead.hcrc&&P.pending>I&&(b.adler=i(b.adler,P.pending_buf,P.pending-I,I)),J===0&&(P.status=103)}else P.status=103;if(P.status===103&&(P.gzhead.hcrc?(P.pending+2>P.pending_buf_size&&R(b),P.pending+2<=P.pending_buf_size&&(V(P,255&b.adler),V(P,b.adler>>8&255),b.adler=0,P.status=L)):P.status=L),P.pending!==0){if(R(b),b.avail_out===0)return P.last_flush=-1,u}else if(b.avail_in===0&&_(D)<=_(F)&&D!==d)return de(b,-5);if(P.status===666&&b.avail_in!==0)return de(b,-5);if(b.avail_in!==0||P.lookahead!==0||D!==c&&P.status!==666){var z=P.strategy===2?function(M,K){for(var $;;){if(M.lookahead===0&&(fe(M),M.lookahead===0)){if(K===c)return v;break}if(M.match_length=0,$=s._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++,$&&(k(M,!1),M.strm.avail_out===0))return v}return M.insert=0,K===d?(k(M,!0),M.strm.avail_out===0?le:X):M.last_lit&&(k(M,!1),M.strm.avail_out===0)?v:B}(P,D):P.strategy===3?function(M,K){for(var $,Q,se,O,U=M.window;;){if(M.lookahead<=N){if(fe(M),M.lookahead<=N&&K===c)return v;if(M.lookahead===0)break}if(M.match_length=0,M.lookahead>=A&&0<M.strstart&&(Q=U[se=M.strstart-1])===U[++se]&&Q===U[++se]&&Q===U[++se]){O=M.strstart+N;do;while(Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&Q===U[++se]&&se<O);M.match_length=N-(O-se),M.match_length>M.lookahead&&(M.match_length=M.lookahead)}if(M.match_length>=A?($=s._tr_tally(M,1,M.match_length-A),M.lookahead-=M.match_length,M.strstart+=M.match_length,M.match_length=0):($=s._tr_tally(M,0,M.window[M.strstart]),M.lookahead--,M.strstart++),$&&(k(M,!1),M.strm.avail_out===0))return v}return M.insert=0,K===d?(k(M,!0),M.strm.avail_out===0?le:X):M.last_lit&&(k(M,!1),M.strm.avail_out===0)?v:B}(P,D):r[P.level].func(P,D);if(z!==le&&z!==X||(P.status=666),z===v||z===le)return b.avail_out===0&&(P.last_flush=-1),u;if(z===B&&(D===1?s._tr_align(P):D!==5&&(s._tr_stored_block(P,0,0,!1),D===3&&(re(P.head),P.lookahead===0&&(P.strstart=0,P.block_start=0,P.insert=0))),R(b),b.avail_out===0))return P.last_flush=-1,u}return D!==d?u:P.wrap<=0?1:(P.wrap===2?(V(P,255&b.adler),V(P,b.adler>>8&255),V(P,b.adler>>16&255),V(P,b.adler>>24&255),V(P,255&b.total_in),V(P,b.total_in>>8&255),V(P,b.total_in>>16&255),V(P,b.total_in>>24&255)):(ee(P,b.adler>>>16),ee(P,65535&b.adler)),R(b),0<P.wrap&&(P.wrap=-P.wrap),P.pending!==0?u:1)},n.deflateEnd=function(b){var D;return b&&b.state?(D=b.state.status)!==C&&D!==69&&D!==73&&D!==91&&D!==103&&D!==L&&D!==666?de(b,y):(b.state=null,D===L?de(b,-3):u):y},n.deflateSetDictionary=function(b,D){var F,P,I,J,te,z,M,K,$=D.length;if(!b||!b.state||(J=(F=b.state).wrap)===2||J===1&&F.status!==C||F.lookahead)return y;for(J===1&&(b.adler=a(b.adler,D,$,0)),F.wrap=0,$>=F.w_size&&(J===0&&(re(F.head),F.strstart=0,F.block_start=0,F.insert=0),K=new o.Buf8(F.w_size),o.arraySet(K,D,$-F.w_size,F.w_size,0),D=K,$=F.w_size),te=b.avail_in,z=b.next_in,M=b.input,b.avail_in=$,b.next_in=0,b.input=D,fe(F);F.lookahead>=A;){for(P=F.strstart,I=F.lookahead-(A-1);F.ins_h=(F.ins_h<<F.hash_shift^F.window[P+A-1])&F.hash_mask,F.prev[P&F.w_mask]=F.head[F.ins_h],F.head[F.ins_h]=P,P++,--I;);F.strstart=P,F.lookahead=A-1,fe(F)}return F.strstart+=F.lookahead,F.block_start=F.strstart,F.insert=F.lookahead,F.lookahead=0,F.match_length=F.prev_length=A-1,F.match_available=0,b.next_in=z,b.input=M,b.avail_in=te,F.wrap=J,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(r,o){var s,a,i,l,c,d,u,y,h,f,p,m,g,S,w,x,E,T,A,N,H,C,L,v,B;s=r.state,a=r.next_in,v=r.input,i=a+(r.avail_in-5),l=r.next_out,B=r.output,c=l-(o-r.avail_out),d=l+(r.avail_out-257),u=s.dmax,y=s.wsize,h=s.whave,f=s.wnext,p=s.window,m=s.hold,g=s.bits,S=s.lencode,w=s.distcode,x=(1<<s.lenbits)-1,E=(1<<s.distbits)-1;e:do{g<15&&(m+=v[a++]<<g,g+=8,m+=v[a++]<<g,g+=8),T=S[m&x];t:for(;;){if(m>>>=A=T>>>24,g-=A,(A=T>>>16&255)===0)B[l++]=65535&T;else{if(!(16&A)){if(!(64&A)){T=S[(65535&T)+(m&(1<<A)-1)];continue t}if(32&A){s.mode=12;break e}r.msg="invalid literal/length code",s.mode=30;break e}N=65535&T,(A&=15)&&(g<A&&(m+=v[a++]<<g,g+=8),N+=m&(1<<A)-1,m>>>=A,g-=A),g<15&&(m+=v[a++]<<g,g+=8,m+=v[a++]<<g,g+=8),T=w[m&E];n:for(;;){if(m>>>=A=T>>>24,g-=A,!(16&(A=T>>>16&255))){if(!(64&A)){T=w[(65535&T)+(m&(1<<A)-1)];continue n}r.msg="invalid distance code",s.mode=30;break e}if(H=65535&T,g<(A&=15)&&(m+=v[a++]<<g,(g+=8)<A&&(m+=v[a++]<<g,g+=8)),u<(H+=m&(1<<A)-1)){r.msg="invalid distance too far back",s.mode=30;break e}if(m>>>=A,g-=A,(A=l-c)<H){if(h<(A=H-A)&&s.sane){r.msg="invalid distance too far back",s.mode=30;break e}if(L=p,(C=0)===f){if(C+=y-A,A<N){for(N-=A;B[l++]=p[C++],--A;);C=l-H,L=B}}else if(f<A){if(C+=y+f-A,(A-=f)<N){for(N-=A;B[l++]=p[C++],--A;);if(C=0,f<N){for(N-=A=f;B[l++]=p[C++],--A;);C=l-H,L=B}}}else if(C+=f-A,A<N){for(N-=A;B[l++]=p[C++],--A;);C=l-H,L=B}for(;2<N;)B[l++]=L[C++],B[l++]=L[C++],B[l++]=L[C++],N-=3;N&&(B[l++]=L[C++],1<N&&(B[l++]=L[C++]))}else{for(C=l-H;B[l++]=B[C++],B[l++]=B[C++],B[l++]=B[C++],2<(N-=3););N&&(B[l++]=B[C++],1<N&&(B[l++]=B[C++]))}break}}break}}while(a<i&&l<d);a-=N=g>>3,m&=(1<<(g-=N<<3))-1,r.next_in=a,r.next_out=l,r.avail_in=a<i?i-a+5:5-(a-i),r.avail_out=l<d?d-l+257:257-(l-d),s.hold=m,s.bits=g}},{}],49:[function(t,e,n){"use strict";var r=t("../utils/common"),o=t("./adler32"),s=t("./crc32"),a=t("./inffast"),i=t("./inftrees"),l=1,c=2,d=0,u=-2,y=1,h=852,f=592;function p(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function m(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function g(C){var L;return C&&C.state?(L=C.state,C.total_in=C.total_out=L.total=0,C.msg="",L.wrap&&(C.adler=1&L.wrap),L.mode=y,L.last=0,L.havedict=0,L.dmax=32768,L.head=null,L.hold=0,L.bits=0,L.lencode=L.lendyn=new r.Buf32(h),L.distcode=L.distdyn=new r.Buf32(f),L.sane=1,L.back=-1,d):u}function S(C){var L;return C&&C.state?((L=C.state).wsize=0,L.whave=0,L.wnext=0,g(C)):u}function w(C,L){var v,B;return C&&C.state?(B=C.state,L<0?(v=0,L=-L):(v=1+(L>>4),L<48&&(L&=15)),L&&(L<8||15<L)?u:(B.window!==null&&B.wbits!==L&&(B.window=null),B.wrap=v,B.wbits=L,S(C))):u}function x(C,L){var v,B;return C?(B=new m,(C.state=B).window=null,(v=w(C,L))!==d&&(C.state=null),v):u}var E,T,A=!0;function N(C){if(A){var L;for(E=new r.Buf32(512),T=new r.Buf32(32),L=0;L<144;)C.lens[L++]=8;for(;L<256;)C.lens[L++]=9;for(;L<280;)C.lens[L++]=7;for(;L<288;)C.lens[L++]=8;for(i(l,C.lens,0,288,E,0,C.work,{bits:9}),L=0;L<32;)C.lens[L++]=5;i(c,C.lens,0,32,T,0,C.work,{bits:5}),A=!1}C.lencode=E,C.lenbits=9,C.distcode=T,C.distbits=5}function H(C,L,v,B){var le,X=C.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new r.Buf8(X.wsize)),B>=X.wsize?(r.arraySet(X.window,L,v-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(B<(le=X.wsize-X.wnext)&&(le=B),r.arraySet(X.window,L,v-B,le,X.wnext),(B-=le)?(r.arraySet(X.window,L,v-B,B,0),X.wnext=B,X.whave=X.wsize):(X.wnext+=le,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=le))),0}n.inflateReset=S,n.inflateReset2=w,n.inflateResetKeep=g,n.inflateInit=function(C){return x(C,15)},n.inflateInit2=x,n.inflate=function(C,L){var v,B,le,X,de,_,re,R,k,V,ee,ie,fe,G,Z,j,Y,ne,q,W,b,D,F,P,I=0,J=new r.Buf8(4),te=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return u;(v=C.state).mode===12&&(v.mode=13),de=C.next_out,le=C.output,re=C.avail_out,X=C.next_in,B=C.input,_=C.avail_in,R=v.hold,k=v.bits,V=_,ee=re,D=d;e:for(;;)switch(v.mode){case y:if(v.wrap===0){v.mode=13;break}for(;k<16;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(2&v.wrap&&R===35615){J[v.check=0]=255&R,J[1]=R>>>8&255,v.check=s(v.check,J,2,0),k=R=0,v.mode=2;break}if(v.flags=0,v.head&&(v.head.done=!1),!(1&v.wrap)||(((255&R)<<8)+(R>>8))%31){C.msg="incorrect header check",v.mode=30;break}if((15&R)!=8){C.msg="unknown compression method",v.mode=30;break}if(k-=4,b=8+(15&(R>>>=4)),v.wbits===0)v.wbits=b;else if(b>v.wbits){C.msg="invalid window size",v.mode=30;break}v.dmax=1<<b,C.adler=v.check=1,v.mode=512&R?10:12,k=R=0;break;case 2:for(;k<16;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(v.flags=R,(255&v.flags)!=8){C.msg="unknown compression method",v.mode=30;break}if(57344&v.flags){C.msg="unknown header flags set",v.mode=30;break}v.head&&(v.head.text=R>>8&1),512&v.flags&&(J[0]=255&R,J[1]=R>>>8&255,v.check=s(v.check,J,2,0)),k=R=0,v.mode=3;case 3:for(;k<32;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.head&&(v.head.time=R),512&v.flags&&(J[0]=255&R,J[1]=R>>>8&255,J[2]=R>>>16&255,J[3]=R>>>24&255,v.check=s(v.check,J,4,0)),k=R=0,v.mode=4;case 4:for(;k<16;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.head&&(v.head.xflags=255&R,v.head.os=R>>8),512&v.flags&&(J[0]=255&R,J[1]=R>>>8&255,v.check=s(v.check,J,2,0)),k=R=0,v.mode=5;case 5:if(1024&v.flags){for(;k<16;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.length=R,v.head&&(v.head.extra_len=R),512&v.flags&&(J[0]=255&R,J[1]=R>>>8&255,v.check=s(v.check,J,2,0)),k=R=0}else v.head&&(v.head.extra=null);v.mode=6;case 6:if(1024&v.flags&&(_<(ie=v.length)&&(ie=_),ie&&(v.head&&(b=v.head.extra_len-v.length,v.head.extra||(v.head.extra=new Array(v.head.extra_len)),r.arraySet(v.head.extra,B,X,ie,b)),512&v.flags&&(v.check=s(v.check,B,ie,X)),_-=ie,X+=ie,v.length-=ie),v.length))break e;v.length=0,v.mode=7;case 7:if(2048&v.flags){if(_===0)break e;for(ie=0;b=B[X+ie++],v.head&&b&&v.length<65536&&(v.head.name+=String.fromCharCode(b)),b&&ie<_;);if(512&v.flags&&(v.check=s(v.check,B,ie,X)),_-=ie,X+=ie,b)break e}else v.head&&(v.head.name=null);v.length=0,v.mode=8;case 8:if(4096&v.flags){if(_===0)break e;for(ie=0;b=B[X+ie++],v.head&&b&&v.length<65536&&(v.head.comment+=String.fromCharCode(b)),b&&ie<_;);if(512&v.flags&&(v.check=s(v.check,B,ie,X)),_-=ie,X+=ie,b)break e}else v.head&&(v.head.comment=null);v.mode=9;case 9:if(512&v.flags){for(;k<16;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(R!==(65535&v.check)){C.msg="header crc mismatch",v.mode=30;break}k=R=0}v.head&&(v.head.hcrc=v.flags>>9&1,v.head.done=!0),C.adler=v.check=0,v.mode=12;break;case 10:for(;k<32;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}C.adler=v.check=p(R),k=R=0,v.mode=11;case 11:if(v.havedict===0)return C.next_out=de,C.avail_out=re,C.next_in=X,C.avail_in=_,v.hold=R,v.bits=k,2;C.adler=v.check=1,v.mode=12;case 12:if(L===5||L===6)break e;case 13:if(v.last){R>>>=7&k,k-=7&k,v.mode=27;break}for(;k<3;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}switch(v.last=1&R,k-=1,3&(R>>>=1)){case 0:v.mode=14;break;case 1:if(N(v),v.mode=20,L!==6)break;R>>>=2,k-=2;break e;case 2:v.mode=17;break;case 3:C.msg="invalid block type",v.mode=30}R>>>=2,k-=2;break;case 14:for(R>>>=7&k,k-=7&k;k<32;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if((65535&R)!=(R>>>16^65535)){C.msg="invalid stored block lengths",v.mode=30;break}if(v.length=65535&R,k=R=0,v.mode=15,L===6)break e;case 15:v.mode=16;case 16:if(ie=v.length){if(_<ie&&(ie=_),re<ie&&(ie=re),ie===0)break e;r.arraySet(le,B,X,ie,de),_-=ie,X+=ie,re-=ie,de+=ie,v.length-=ie;break}v.mode=12;break;case 17:for(;k<14;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(v.nlen=257+(31&R),R>>>=5,k-=5,v.ndist=1+(31&R),R>>>=5,k-=5,v.ncode=4+(15&R),R>>>=4,k-=4,286<v.nlen||30<v.ndist){C.msg="too many length or distance symbols",v.mode=30;break}v.have=0,v.mode=18;case 18:for(;v.have<v.ncode;){for(;k<3;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.lens[te[v.have++]]=7&R,R>>>=3,k-=3}for(;v.have<19;)v.lens[te[v.have++]]=0;if(v.lencode=v.lendyn,v.lenbits=7,F={bits:v.lenbits},D=i(0,v.lens,0,19,v.lencode,0,v.work,F),v.lenbits=F.bits,D){C.msg="invalid code lengths set",v.mode=30;break}v.have=0,v.mode=19;case 19:for(;v.have<v.nlen+v.ndist;){for(;j=(I=v.lencode[R&(1<<v.lenbits)-1])>>>16&255,Y=65535&I,!((Z=I>>>24)<=k);){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(Y<16)R>>>=Z,k-=Z,v.lens[v.have++]=Y;else{if(Y===16){for(P=Z+2;k<P;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(R>>>=Z,k-=Z,v.have===0){C.msg="invalid bit length repeat",v.mode=30;break}b=v.lens[v.have-1],ie=3+(3&R),R>>>=2,k-=2}else if(Y===17){for(P=Z+3;k<P;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}k-=Z,b=0,ie=3+(7&(R>>>=Z)),R>>>=3,k-=3}else{for(P=Z+7;k<P;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}k-=Z,b=0,ie=11+(127&(R>>>=Z)),R>>>=7,k-=7}if(v.have+ie>v.nlen+v.ndist){C.msg="invalid bit length repeat",v.mode=30;break}for(;ie--;)v.lens[v.have++]=b}}if(v.mode===30)break;if(v.lens[256]===0){C.msg="invalid code -- missing end-of-block",v.mode=30;break}if(v.lenbits=9,F={bits:v.lenbits},D=i(l,v.lens,0,v.nlen,v.lencode,0,v.work,F),v.lenbits=F.bits,D){C.msg="invalid literal/lengths set",v.mode=30;break}if(v.distbits=6,v.distcode=v.distdyn,F={bits:v.distbits},D=i(c,v.lens,v.nlen,v.ndist,v.distcode,0,v.work,F),v.distbits=F.bits,D){C.msg="invalid distances set",v.mode=30;break}if(v.mode=20,L===6)break e;case 20:v.mode=21;case 21:if(6<=_&&258<=re){C.next_out=de,C.avail_out=re,C.next_in=X,C.avail_in=_,v.hold=R,v.bits=k,a(C,ee),de=C.next_out,le=C.output,re=C.avail_out,X=C.next_in,B=C.input,_=C.avail_in,R=v.hold,k=v.bits,v.mode===12&&(v.back=-1);break}for(v.back=0;j=(I=v.lencode[R&(1<<v.lenbits)-1])>>>16&255,Y=65535&I,!((Z=I>>>24)<=k);){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(j&&!(240&j)){for(ne=Z,q=j,W=Y;j=(I=v.lencode[W+((R&(1<<ne+q)-1)>>ne)])>>>16&255,Y=65535&I,!(ne+(Z=I>>>24)<=k);){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}R>>>=ne,k-=ne,v.back+=ne}if(R>>>=Z,k-=Z,v.back+=Z,v.length=Y,j===0){v.mode=26;break}if(32&j){v.back=-1,v.mode=12;break}if(64&j){C.msg="invalid literal/length code",v.mode=30;break}v.extra=15&j,v.mode=22;case 22:if(v.extra){for(P=v.extra;k<P;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.length+=R&(1<<v.extra)-1,R>>>=v.extra,k-=v.extra,v.back+=v.extra}v.was=v.length,v.mode=23;case 23:for(;j=(I=v.distcode[R&(1<<v.distbits)-1])>>>16&255,Y=65535&I,!((Z=I>>>24)<=k);){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(!(240&j)){for(ne=Z,q=j,W=Y;j=(I=v.distcode[W+((R&(1<<ne+q)-1)>>ne)])>>>16&255,Y=65535&I,!(ne+(Z=I>>>24)<=k);){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}R>>>=ne,k-=ne,v.back+=ne}if(R>>>=Z,k-=Z,v.back+=Z,64&j){C.msg="invalid distance code",v.mode=30;break}v.offset=Y,v.extra=15&j,v.mode=24;case 24:if(v.extra){for(P=v.extra;k<P;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}v.offset+=R&(1<<v.extra)-1,R>>>=v.extra,k-=v.extra,v.back+=v.extra}if(v.offset>v.dmax){C.msg="invalid distance too far back",v.mode=30;break}v.mode=25;case 25:if(re===0)break e;if(ie=ee-re,v.offset>ie){if((ie=v.offset-ie)>v.whave&&v.sane){C.msg="invalid distance too far back",v.mode=30;break}fe=ie>v.wnext?(ie-=v.wnext,v.wsize-ie):v.wnext-ie,ie>v.length&&(ie=v.length),G=v.window}else G=le,fe=de-v.offset,ie=v.length;for(re<ie&&(ie=re),re-=ie,v.length-=ie;le[de++]=G[fe++],--ie;);v.length===0&&(v.mode=21);break;case 26:if(re===0)break e;le[de++]=v.length,re--,v.mode=21;break;case 27:if(v.wrap){for(;k<32;){if(_===0)break e;_--,R|=B[X++]<<k,k+=8}if(ee-=re,C.total_out+=ee,v.total+=ee,ee&&(C.adler=v.check=v.flags?s(v.check,le,ee,de-ee):o(v.check,le,ee,de-ee)),ee=re,(v.flags?R:p(R))!==v.check){C.msg="incorrect data check",v.mode=30;break}k=R=0}v.mode=28;case 28:if(v.wrap&&v.flags){for(;k<32;){if(_===0)break e;_--,R+=B[X++]<<k,k+=8}if(R!==(4294967295&v.total)){C.msg="incorrect length check",v.mode=30;break}k=R=0}v.mode=29;case 29:D=1;break e;case 30:D=-3;break e;case 31:return-4;case 32:default:return u}return C.next_out=de,C.avail_out=re,C.next_in=X,C.avail_in=_,v.hold=R,v.bits=k,(v.wsize||ee!==C.avail_out&&v.mode<30&&(v.mode<27||L!==4))&&H(C,C.output,C.next_out,ee-C.avail_out)?(v.mode=31,-4):(V-=C.avail_in,ee-=C.avail_out,C.total_in+=V,C.total_out+=ee,v.total+=ee,v.wrap&&ee&&(C.adler=v.check=v.flags?s(v.check,le,ee,C.next_out-ee):o(v.check,le,ee,C.next_out-ee)),C.data_type=v.bits+(v.last?64:0)+(v.mode===12?128:0)+(v.mode===20||v.mode===15?256:0),(V==0&&ee===0||L===4)&&D===d&&(D=-5),D)},n.inflateEnd=function(C){if(!C||!C.state)return u;var L=C.state;return L.window&&(L.window=null),C.state=null,d},n.inflateGetHeader=function(C,L){var v;return C&&C.state&&2&(v=C.state).wrap?((v.head=L).done=!1,d):u},n.inflateSetDictionary=function(C,L){var v,B=L.length;return C&&C.state?(v=C.state).wrap!==0&&v.mode!==11?u:v.mode===11&&o(1,L,B,0)!==v.check?-3:H(C,L,B,B)?(v.mode=31,-4):(v.havedict=1,d):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],i=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(l,c,d,u,y,h,f,p){var m,g,S,w,x,E,T,A,N,H=p.bits,C=0,L=0,v=0,B=0,le=0,X=0,de=0,_=0,re=0,R=0,k=null,V=0,ee=new r.Buf16(16),ie=new r.Buf16(16),fe=null,G=0;for(C=0;C<=15;C++)ee[C]=0;for(L=0;L<u;L++)ee[c[d+L]]++;for(le=H,B=15;1<=B&&ee[B]===0;B--);if(B<le&&(le=B),B===0)return y[h++]=20971520,y[h++]=20971520,p.bits=1,0;for(v=1;v<B&&ee[v]===0;v++);for(le<v&&(le=v),C=_=1;C<=15;C++)if(_<<=1,(_-=ee[C])<0)return-1;if(0<_&&(l===0||B!==1))return-1;for(ie[1]=0,C=1;C<15;C++)ie[C+1]=ie[C]+ee[C];for(L=0;L<u;L++)c[d+L]!==0&&(f[ie[c[d+L]]++]=L);if(E=l===0?(k=fe=f,19):l===1?(k=o,V-=257,fe=s,G-=257,256):(k=a,fe=i,-1),C=v,x=h,de=L=R=0,S=-1,w=(re=1<<(X=le))-1,l===1&&852<re||l===2&&592<re)return 1;for(;;){for(T=C-de,N=f[L]<E?(A=0,f[L]):f[L]>E?(A=fe[G+f[L]],k[V+f[L]]):(A=96,0),m=1<<C-de,v=g=1<<X;y[x+(R>>de)+(g-=m)]=T<<24|A<<16|N|0,g!==0;);for(m=1<<C-1;R&m;)m>>=1;if(m!==0?(R&=m-1,R+=m):R=0,L++,--ee[C]==0){if(C===B)break;C=c[d+f[L]]}if(le<C&&(R&w)!==S){for(de===0&&(de=le),x+=v,_=1<<(X=C-de);X+de<B&&!((_-=ee[X+de])<=0);)X++,_<<=1;if(re+=1<<X,l===1&&852<re||l===2&&592<re)return 1;y[S=R&w]=le<<24|X<<16|x-h|0}}return R!==0&&(y[x+R]=C-de<<24|64<<16|0),p.bits=le,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var r=t("../utils/common"),o=0,s=1;function a(I){for(var J=I.length;0<=--J;)I[J]=0}var i=0,l=29,c=256,d=c+1+l,u=30,y=19,h=2*d+1,f=15,p=16,m=7,g=256,S=16,w=17,x=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],H=new Array(2*(d+2));a(H);var C=new Array(2*u);a(C);var L=new Array(512);a(L);var v=new Array(256);a(v);var B=new Array(l);a(B);var le,X,de,_=new Array(u);function re(I,J,te,z,M){this.static_tree=I,this.extra_bits=J,this.extra_base=te,this.elems=z,this.max_length=M,this.has_stree=I&&I.length}function R(I,J){this.dyn_tree=I,this.max_code=0,this.stat_desc=J}function k(I){return I<256?L[I]:L[256+(I>>>7)]}function V(I,J){I.pending_buf[I.pending++]=255&J,I.pending_buf[I.pending++]=J>>>8&255}function ee(I,J,te){I.bi_valid>p-te?(I.bi_buf|=J<<I.bi_valid&65535,V(I,I.bi_buf),I.bi_buf=J>>p-I.bi_valid,I.bi_valid+=te-p):(I.bi_buf|=J<<I.bi_valid&65535,I.bi_valid+=te)}function ie(I,J,te){ee(I,te[2*J],te[2*J+1])}function fe(I,J){for(var te=0;te|=1&I,I>>>=1,te<<=1,0<--J;);return te>>>1}function G(I,J,te){var z,M,K=new Array(f+1),$=0;for(z=1;z<=f;z++)K[z]=$=$+te[z-1]<<1;for(M=0;M<=J;M++){var Q=I[2*M+1];Q!==0&&(I[2*M]=fe(K[Q]++,Q))}}function Z(I){var J;for(J=0;J<d;J++)I.dyn_ltree[2*J]=0;for(J=0;J<u;J++)I.dyn_dtree[2*J]=0;for(J=0;J<y;J++)I.bl_tree[2*J]=0;I.dyn_ltree[2*g]=1,I.opt_len=I.static_len=0,I.last_lit=I.matches=0}function j(I){8<I.bi_valid?V(I,I.bi_buf):0<I.bi_valid&&(I.pending_buf[I.pending++]=I.bi_buf),I.bi_buf=0,I.bi_valid=0}function Y(I,J,te,z){var M=2*J,K=2*te;return I[M]<I[K]||I[M]===I[K]&&z[J]<=z[te]}function ne(I,J,te){for(var z=I.heap[te],M=te<<1;M<=I.heap_len&&(M<I.heap_len&&Y(J,I.heap[M+1],I.heap[M],I.depth)&&M++,!Y(J,z,I.heap[M],I.depth));)I.heap[te]=I.heap[M],te=M,M<<=1;I.heap[te]=z}function q(I,J,te){var z,M,K,$,Q=0;if(I.last_lit!==0)for(;z=I.pending_buf[I.d_buf+2*Q]<<8|I.pending_buf[I.d_buf+2*Q+1],M=I.pending_buf[I.l_buf+Q],Q++,z===0?ie(I,M,J):(ie(I,(K=v[M])+c+1,J),($=E[K])!==0&&ee(I,M-=B[K],$),ie(I,K=k(--z),te),($=T[K])!==0&&ee(I,z-=_[K],$)),Q<I.last_lit;);ie(I,g,J)}function W(I,J){var te,z,M,K=J.dyn_tree,$=J.stat_desc.static_tree,Q=J.stat_desc.has_stree,se=J.stat_desc.elems,O=-1;for(I.heap_len=0,I.heap_max=h,te=0;te<se;te++)K[2*te]!==0?(I.heap[++I.heap_len]=O=te,I.depth[te]=0):K[2*te+1]=0;for(;I.heap_len<2;)K[2*(M=I.heap[++I.heap_len]=O<2?++O:0)]=1,I.depth[M]=0,I.opt_len--,Q&&(I.static_len-=$[2*M+1]);for(J.max_code=O,te=I.heap_len>>1;1<=te;te--)ne(I,K,te);for(M=se;te=I.heap[1],I.heap[1]=I.heap[I.heap_len--],ne(I,K,1),z=I.heap[1],I.heap[--I.heap_max]=te,I.heap[--I.heap_max]=z,K[2*M]=K[2*te]+K[2*z],I.depth[M]=(I.depth[te]>=I.depth[z]?I.depth[te]:I.depth[z])+1,K[2*te+1]=K[2*z+1]=M,I.heap[1]=M++,ne(I,K,1),2<=I.heap_len;);I.heap[--I.heap_max]=I.heap[1],function(U,ue){var oe,ae,ye,he,ve,Ee,Ne=ue.dyn_tree,He=ue.max_code,ze=ue.stat_desc.static_tree,Ve=ue.stat_desc.has_stree,ot=ue.stat_desc.extra_bits,vt=ue.stat_desc.extra_base,dt=ue.stat_desc.max_length,Ct=0;for(he=0;he<=f;he++)U.bl_count[he]=0;for(Ne[2*U.heap[U.heap_max]+1]=0,oe=U.heap_max+1;oe<h;oe++)dt<(he=Ne[2*Ne[2*(ae=U.heap[oe])+1]+1]+1)&&(he=dt,Ct++),Ne[2*ae+1]=he,He<ae||(U.bl_count[he]++,ve=0,vt<=ae&&(ve=ot[ae-vt]),Ee=Ne[2*ae],U.opt_len+=Ee*(he+ve),Ve&&(U.static_len+=Ee*(ze[2*ae+1]+ve)));if(Ct!==0){do{for(he=dt-1;U.bl_count[he]===0;)he--;U.bl_count[he]--,U.bl_count[he+1]+=2,U.bl_count[dt]--,Ct-=2}while(0<Ct);for(he=dt;he!==0;he--)for(ae=U.bl_count[he];ae!==0;)He<(ye=U.heap[--oe])||(Ne[2*ye+1]!==he&&(U.opt_len+=(he-Ne[2*ye+1])*Ne[2*ye],Ne[2*ye+1]=he),ae--)}}(I,J),G(K,O,I.bl_count)}function b(I,J,te){var z,M,K=-1,$=J[1],Q=0,se=7,O=4;for($===0&&(se=138,O=3),J[2*(te+1)+1]=65535,z=0;z<=te;z++)M=$,$=J[2*(z+1)+1],++Q<se&&M===$||(Q<O?I.bl_tree[2*M]+=Q:M!==0?(M!==K&&I.bl_tree[2*M]++,I.bl_tree[2*S]++):Q<=10?I.bl_tree[2*w]++:I.bl_tree[2*x]++,K=M,O=(Q=0)===$?(se=138,3):M===$?(se=6,3):(se=7,4))}function D(I,J,te){var z,M,K=-1,$=J[1],Q=0,se=7,O=4;for($===0&&(se=138,O=3),z=0;z<=te;z++)if(M=$,$=J[2*(z+1)+1],!(++Q<se&&M===$)){if(Q<O)for(;ie(I,M,I.bl_tree),--Q!=0;);else M!==0?(M!==K&&(ie(I,M,I.bl_tree),Q--),ie(I,S,I.bl_tree),ee(I,Q-3,2)):Q<=10?(ie(I,w,I.bl_tree),ee(I,Q-3,3)):(ie(I,x,I.bl_tree),ee(I,Q-11,7));K=M,O=(Q=0)===$?(se=138,3):M===$?(se=6,3):(se=7,4)}}a(_);var F=!1;function P(I,J,te,z){ee(I,(i<<1)+(z?1:0),3),function(M,K,$,Q){j(M),Q&&(V(M,$),V(M,~$)),r.arraySet(M.pending_buf,M.window,K,$,M.pending),M.pending+=$}(I,J,te,!0)}n._tr_init=function(I){F||(function(){var J,te,z,M,K,$=new Array(f+1);for(M=z=0;M<l-1;M++)for(B[M]=z,J=0;J<1<<E[M];J++)v[z++]=M;for(v[z-1]=M,M=K=0;M<16;M++)for(_[M]=K,J=0;J<1<<T[M];J++)L[K++]=M;for(K>>=7;M<u;M++)for(_[M]=K<<7,J=0;J<1<<T[M]-7;J++)L[256+K++]=M;for(te=0;te<=f;te++)$[te]=0;for(J=0;J<=143;)H[2*J+1]=8,J++,$[8]++;for(;J<=255;)H[2*J+1]=9,J++,$[9]++;for(;J<=279;)H[2*J+1]=7,J++,$[7]++;for(;J<=287;)H[2*J+1]=8,J++,$[8]++;for(G(H,d+1,$),J=0;J<u;J++)C[2*J+1]=5,C[2*J]=fe(J,5);le=new re(H,E,c+1,d,f),X=new re(C,T,0,u,f),de=new re(new Array(0),A,0,y,m)}(),F=!0),I.l_desc=new R(I.dyn_ltree,le),I.d_desc=new R(I.dyn_dtree,X),I.bl_desc=new R(I.bl_tree,de),I.bi_buf=0,I.bi_valid=0,Z(I)},n._tr_stored_block=P,n._tr_flush_block=function(I,J,te,z){var M,K,$=0;0<I.level?(I.strm.data_type===2&&(I.strm.data_type=function(Q){var se,O=4093624447;for(se=0;se<=31;se++,O>>>=1)if(1&O&&Q.dyn_ltree[2*se]!==0)return o;if(Q.dyn_ltree[18]!==0||Q.dyn_ltree[20]!==0||Q.dyn_ltree[26]!==0)return s;for(se=32;se<c;se++)if(Q.dyn_ltree[2*se]!==0)return s;return o}(I)),W(I,I.l_desc),W(I,I.d_desc),$=function(Q){var se;for(b(Q,Q.dyn_ltree,Q.l_desc.max_code),b(Q,Q.dyn_dtree,Q.d_desc.max_code),W(Q,Q.bl_desc),se=y-1;3<=se&&Q.bl_tree[2*N[se]+1]===0;se--);return Q.opt_len+=3*(se+1)+5+5+4,se}(I),M=I.opt_len+3+7>>>3,(K=I.static_len+3+7>>>3)<=M&&(M=K)):M=K=te+5,te+4<=M&&J!==-1?P(I,J,te,z):I.strategy===4||K===M?(ee(I,2+(z?1:0),3),q(I,H,C)):(ee(I,4+(z?1:0),3),function(Q,se,O,U){var ue;for(ee(Q,se-257,5),ee(Q,O-1,5),ee(Q,U-4,4),ue=0;ue<U;ue++)ee(Q,Q.bl_tree[2*N[ue]+1],3);D(Q,Q.dyn_ltree,se-1),D(Q,Q.dyn_dtree,O-1)}(I,I.l_desc.max_code+1,I.d_desc.max_code+1,$+1),q(I,I.dyn_ltree,I.dyn_dtree)),Z(I),z&&j(I)},n._tr_tally=function(I,J,te){return I.pending_buf[I.d_buf+2*I.last_lit]=J>>>8&255,I.pending_buf[I.d_buf+2*I.last_lit+1]=255&J,I.pending_buf[I.l_buf+I.last_lit]=255&te,I.last_lit++,J===0?I.dyn_ltree[2*te]++:(I.matches++,J--,I.dyn_ltree[2*(v[te]+c+1)]++,I.dyn_dtree[2*k(J)]++),I.last_lit===I.lit_bufsize-1},n._tr_align=function(I){ee(I,2,3),ie(I,g,H),function(J){J.bi_valid===16?(V(J,J.bi_buf),J.bi_buf=0,J.bi_valid=0):8<=J.bi_valid&&(J.pending_buf[J.pending++]=255&J.bi_buf,J.bi_buf>>=8,J.bi_valid-=8)}(I)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){"use strict";e.exports=typeof setImmediate=="function"?setImmediate:function(){var r=[].slice.apply(arguments);r.splice(1,0,0),setTimeout.apply(null,r)}},{}]},{},[10])(10)})});var ei=window,ti=typeof unsafeWindow<"u"&&unsafeWindow?unsafeWindow:ei,Re=ti,lf=ti!==ei;function et(t,e){try{ti[t]=e}catch{}if(lf)try{ei[t]=e}catch{}}function Xn(t){if(lf){let e=ei[t];if(e!==void 0)return e}return ti[t]}var Yt=null,md=!1,cf=null,ni=null,df=()=>Re.jotaiAtomCache?.cache;function m1(){let t=Re.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;for(let[e]of t.renderers){let n=t.getFiberRoots?.(e);if(n)for(let r of n){let o=new Set,s=[r.current];for(;s.length;){let a=s.pop();if(!a||o.has(a))continue;o.add(a);let i=a?.pendingProps?.value;if(i&&typeof i.get=="function"&&typeof i.set=="function"&&typeof i.sub=="function")return ni="fiber",i;a.child&&s.push(a.child),a.sibling&&s.push(a.sibling),a.alternate&&s.push(a.alternate)}}}return null}async function f1(t=5e3){let e=df();if(!e)throw console.warn("[jotai-bridge] jotaiAtomCache.cache introuvable"),new Error("jotaiAtomCache.cache introuvable");let n=null,r=null,o=[],s=()=>{for(let l of o)try{l.__origWrite&&(l.write=l.__origWrite,delete l.__origWrite)}catch{}};for(let l of e.values()){if(!l||typeof l.write!="function"||l.__origWrite)continue;let c=l.write;l.__origWrite=c,l.write=function(d,u,...y){return r||(n=d,r=u,s()),c.call(this,d,u,...y)},o.push(l)}let a=l=>new Promise(c=>setTimeout(c,l)),i=Date.now();try{Re.dispatchEvent?.(new Re.Event("visibilitychange"))}catch{}for(;!r&&Date.now()-i<t;)await a(50);return r?(ni="write",{get:l=>n(l),set:(l,c)=>r(l,c),sub:(l,c)=>{let d;try{d=n(l)}catch{}let u=setInterval(()=>{let y;try{y=n(l)}catch{return}if(y!==d){d=y;try{c()}catch{}}},100);return()=>clearInterval(u)}}):(s(),ni="polyfill",console.warn("[jotai-bridge] write-once: timeout \u2192 polyfill"),{get:()=>{throw new Error("Store non captur\xE9: get indisponible")},set:()=>{throw new Error("Store non captur\xE9: set indisponible")},sub:()=>()=>{},__polyfill:!0})}async function at(){if(Yt&&!Yt.__polyfill)return Yt;if(md){let t=Date.now(),e=5500;for(;!Yt&&Date.now()-t<e;)await new Promise(n=>setTimeout(n,25));if(Yt&&!Yt.__polyfill)return Yt}md=!0;try{let t=m1();return t?(Yt=t,Yt):(Yt=await f1(),Yt)}catch(t){throw cf=t,t}finally{md=!1}}function ps(){return!!Yt&&!Yt.__polyfill}function uf(){return{via:ni,polyfill:!!Yt?.__polyfill,error:cf}}async function Rt(t){return(await at()).get(t)}async function En(t,e){await(await at()).set(t,e)}async function er(t,e){return(await at()).sub(t,e)}function Pr(t){let e=df();if(!e)return[];let n=[];for(let r of e.values()){let o=r?.debugLabel||r?.label||"";t.test(String(o))&&n.push(r)}return n}function st(t){let e=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return Pr(new RegExp("^"+e(t)+"$"))[0]||null}async function ri(){try{await at()}catch{}}async function pf(t,e){await ri();let n=st(t);if(!n)return e;try{return await Rt(n)}catch{return e}}async function mf(t,e){await ri();let n=st(t);return n?await er(n,async()=>{try{e(await Rt(n))}catch{}}):()=>{}}async function y1(t,e){let n=await pf(t);return n!==void 0&&e(n),mf(t,e)}async function g1(t,e){await ri();let n=st(t);n&&await En(n,e)}var Cn={ensure:ri,select:pf,subscribe:mf,subscribeImmediate:y1,set:g1};function fd(t){return t?Array.isArray(t)?t.slice():t.split(".").map(e=>e.match(/^\d+$/)?Number(e):e):[]}function ao(t,e){let n=fd(e),r=t;for(let o of n){if(r==null)return;r=r[o]}return r}function h1(t,e,n){let r=fd(e);if(!r.length)return n;let o=Array.isArray(t)?t.slice():{...t??{}},s=o;for(let a=0;a<r.length-1;a++){let i=r[a],l=s[i],c=typeof l=="object"&&l!==null?Array.isArray(l)?l.slice():{...l}:{};s[i]=c,s=c}return s[r[r.length-1]]=n,o}var b1={shallow(t,e){if(Object.is(t,e))return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return!1;let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let o of n)if(!Object.is(t[o],e[o]))return!1;return!0},idSet(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;let n=new Set(t);for(let r of e)if(!n.has(r))return!1;return!0}};function At(t,e={}){let{path:n,write:r="replace"}=e;async function o(){let d=await Cn.select(t);return n?ao(d,n):d}async function s(d){if(typeof r=="function"){let h=await Cn.select(t),f=r(d,h);return Cn.set(t,f)}let u=await Cn.select(t),y=n?h1(u,n,d):d;return r==="merge-shallow"&&!n&&u&&typeof u=="object"&&typeof d=="object"?Cn.set(t,{...u,...d}):Cn.set(t,y)}async function a(d){let u=await o(),y=d(u);return await s(y),y}async function i(d,u=Object.is){let y;return Cn.subscribe(t,h=>{let f=n?ao(h,n):h;if(typeof y>"u"||!u(y,f)){let p=y;y=f,d(f,p)}})}async function l(d,u=Object.is){let y;return Cn.subscribeImmediate(t,h=>{let f=n?ao(h,n):h;if(typeof y>"u"||!u(y,f)){let p=y;y=f,d(f,p)}})}function c(d){return S1(t,n,d)}return{label:t+(n?":"+fd(n).join("."):""),get:o,set:s,update:a,onChange:i,onChangeNow:l,asSignature:c}}function ff(t,e){let n={};for(let r of e){let o=ao(t,r.includes(".")?r:[r]);n[r]=o}try{return JSON.stringify(n)}catch{return String(n)}}function S1(t,e,n){let r=n.mode??"auto";function o(c){let d=c,u=e?ao(d,e):d,y=new Map;if(u==null)return{sig:y,keys:[]};if((r==="array"||r==="auto"&&Array.isArray(u))&&Array.isArray(u))for(let h=0;h<u.length;h++){let f=u[h],p=n.key?n.key(f,h,c):h,m=n.sig?n.sig(f,h,c):n.fields?ff(f,n.fields):(()=>{try{return JSON.stringify(f)}catch{return String(f)}})();y.set(p,m)}else for(let[h,f]of Object.entries(u)){let p=n.key?n.key(f,h,c):h,m=n.sig?n.sig(f,h,c):n.fields?ff(f,n.fields):(()=>{try{return JSON.stringify(f)}catch{return String(f)}})();y.set(p,m)}return{sig:y,keys:Array.from(y.keys())}}function s(c,d){if(c===d)return!0;if(!c||!d||c.size!==d.size)return!1;for(let[u,y]of c)if(d.get(u)!==y)return!1;return!0}async function a(c){let d=null;return Cn.subscribeImmediate(t,u=>{let y=e?ao(u,e):u,{sig:h}=o(y);if(!s(d,h)){let f=new Set([...d?Array.from(d.keys()):[],...Array.from(h.keys())]),p=[];for(let m of f)(d?.get(m)??"__NONE__")!==(h.get(m)??"__NONE__")&&p.push(m);d=h,c({value:y,changedKeys:p})}})}async function i(c,d){let u="__INIT__";return a(({value:y,changedKeys:h})=>{h.includes(c)&&d({value:y})})}async function l(c,d){let u=new Set(c);return a(({value:y,changedKeys:h})=>{let f=h.filter(p=>u.has(p));f.length&&d({value:y,changedKeys:f})})}return{sub:a,subKey:i,subKeys:l}}var yf=b1;function Be(t){return At(t)}var v1=Be("positionAtom"),w1=Be("stateAtom"),x1=Be("mapAtom"),yd=Be("playerAtom"),E1=Be("actionAtom"),C1=Be("myDataAtom"),gd=Be("myInventoryAtom"),M1=Be("gardensWithBackfillsAtom"),A1=Be("myCropInventoryAtom"),hd=Be("mySeedInventoryAtom"),bd=Be("myToolInventoryAtom"),Sd=Be("myEggInventoryAtom"),vd=Be("myDecorInventoryAtom"),Lr=Be("myPetInfosAtom"),T1=Be("myPetSlotInfosAtom"),I1=Be("totalPetSellPriceAtom"),k1=Be("expandedPetSlotIdAtom"),P1=Be("myCropItemsToSellAtom"),lo=Be("myPetHutchPetItemsAtom"),wd=Be("isMyInventoryAtMaxLengthAtom"),oi=Be("myNumPetHutchItemsAtom"),L1=Be("shopsAtom"),R1=Be("myShopPurchasesAtom"),si=Be("numPlayersAtom"),_1=Be("totalCropSellPriceAtom"),N1=Be("myValidatedSelectedItemIndexAtom"),D1=Be("setSelectedIndexToEndAtom"),q1=Be("mySelectedItemNameAtom"),O1=Be("myPossiblyNoLongerValidSelectedItemIndexAtom"),nr=Be("myCurrentGardenObjectAtom"),rr=Be("myCurrentSortedGrowSlotIndicesAtom"),tr=Be("myCurrentGrowSlotIndexAtom"),F1=Be("myOwnCurrentGardenObjectAtom"),B1=Be("isCurrentGrowSlotMatureAtom"),H1=Be("myOwnCurrentDirtTileIndexAtom"),W1=Be("mySelectedItemRotationAtom"),z1=Be("weatherAtom"),G1=Be("activeModalAtom"),j1=Be("avatarTriggerAnimationAtom"),K1=Be("friendBonusMultiplierAtom"),ai=At("myDataAtom",{path:"garden"}),gf=At("myDataAtom",{path:"garden.tileObjects"}),io=At("myInventoryAtom",{path:"favoritedItemIds"}),U1=At("playerAtom",{path:"id"}),Fn=At("playerAtom",{path:"databaseUserId"}),V1=At("myOwnCurrentGardenObjectAtom",{path:"objectType"}),OD=At("stateAtom",{path:"child"}),FD=At("stateAtom",{path:"child.data"}),BD=At("stateAtom",{path:"child.data.shops"}),HD=At("stateAtom",{path:"child.data.userSlots"}),WD=At("stateAtom",{path:"data.players"}),xd=At("myDataAtom",{path:"activityLogs"}),Y1=At("shopsAtom",{path:"seed"}),Q1=At("shopsAtom",{path:"tool"}),J1=At("shopsAtom",{path:"egg"}),$1=At("shopsAtom",{path:"decor"});function Z1(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}var zD=gf.asSignature({mode:"record",key:(t,e)=>Number(e),sig:t=>Z1(t)});function X1(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",a=Number.isFinite(e.xp)?Math.round(e.xp):0,i=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,l=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,c=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,d=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${o}|xp:${a}|hg:${i}|sc:${l}|m:${n}|a:${r}|pos:${c},${d}`}function hf(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",a=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0;return`${s}|${o}|sc:${a}|m:${n}|a:${r}`}var GD=Lr.asSignature({mode:"array",key:t=>String(t?.slot?.id??""),sig:t=>X1(t)}),jD=Lr.asSignature({mode:"array",key:t=>String(t?.slot?.id??""),sig:t=>hf(t)}),KD=io.asSignature({mode:"array",key:t=>String(t),sig:()=>"1"});var ce={ui:{activeModal:G1},server:{numPlayers:si,friendBonusMultiplier:K1},player:{position:v1,avatarTriggerAnimationAtom:j1,player:yd,action:E1,playerId:U1},garden:{myOwnCurrentGardenObject:F1,isCurrentGrowSlotMature:B1,myOwnCurrentGardenObjectType:V1,myOwnCurrentDirtTileIndex:H1,myCurrentGrowSlotIndex:tr},root:{state:w1,map:x1},data:{myData:C1,garden:ai,gardensWithBackfills:M1,gardenTileObjects:gf,myCurrentGardenObject:nr,myCurrentSortedGrowSlotIndices:rr,myCurrentGrowSlotIndex:tr,weather:z1},inventory:{myInventory:gd,myCropInventory:A1,mySeedInventory:hd,myToolInventory:bd,myEggInventory:Sd,myDecorInventory:vd,favoriteIds:io,mySelectedItemName:q1,mySelectedItemRotation:W1,myPossiblyNoLongerValidSelectedItemIndex:O1,myValidatedSelectedItemIndex:N1,setSelectedIndexToEnd:D1,myCropItemsToSell:P1},pets:{myPetInfos:Lr,myPetSlotInfos:T1,totalPetSellPrice:I1,expandedPetSlotId:k1},shop:{shops:L1,myShopPurchases:R1,totalCropSellPrice:_1,seedShop:Y1,toolShop:Q1,eggShop:J1,decorShop:$1}};function ms(t){return io.onChange(e=>t(Array.isArray(e)?e:[]),yf.idSet)}async function bf(t){return t(Array.isArray(await io.get())?await io.get():[]),ms(t)}function eE(t,e){let n=s=>{let a=new Map,i=Array.isArray(s)?s:[];for(let l of i){let c=String(l?.slot?.id??"");c&&a.set(c,hf(l))}return a},r=n(t),o=n(e);if(r.size!==o.size)return!1;for(let[s,a]of r)if(o.get(s)!==a)return!1;return!0}async function Sf(t){return t(await Lr.get()),Lr.onChange(t,eE)}async function fs(){let t=await io.get();return new Set(Array.isArray(t)?t:[])}async function tE(t){let e=st("sendQuinoaToastAtom");if(e){await En(e,t);return}let n=st("quinoaToastsAtom");if(!n)throw new Error("Aucun atom de toast trouv\xE9");let r=await Rt(n).catch(()=>[]),o={isClosable:!0,duration:1e4,...t};"toastType"in o&&o.toastType==="board"?o.id=o.id??(o.isStackable?`quinoa-stackable-${Date.now()}-${Math.random()}`:"quinoa-game-toast"):o.id=o.id??"quinoa-game-toast",await En(n,[...r,o])}async function be(t,e,n="info",r=3500){await tE({title:t,description:e,variant:n,duration:r})}var nE="https://pquktqrngyxkvrgtfygp.supabase.co/functions/v1/",ii="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxdWt0cXJuZ3l4a3ZyZ3RmeWdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MTQzMDMsImV4cCI6MjA3NTE5MDMwM30.-d45t6qyEO54iz2SrjaoTUQjeNb6tngDx6pOQL7-Ubg",li=null,ci=null;function vf(){return li?[...li]:[]}function wf(){return ci?[...ci]:[]}function xf(t,e){let n=new URL(t,nE);if(e)for(let[r,o]of Object.entries(e))o!==void 0&&n.searchParams.set(r,String(o));return n.toString()}function Ed(t,e){return new Promise(n=>{let r=xf(t,e);GM_xmlhttpRequest({method:"GET",url:r,headers:{apikey:ii,Authorization:`Bearer ${ii}`},onload:o=>{if(o.status>=200&&o.status<300)try{let s=o.responseText?JSON.parse(o.responseText):null;n({status:o.status,data:s})}catch(s){console.error("[supabase] GET parse error:",s,o.responseText),n({status:o.status,data:null})}else console.error("[supabase] GET error:",o.status,o.responseText),n({status:o.status,data:null})},onerror:o=>{console.error("[supabase] GET request failed:",o),n({status:0,data:null})}})})}function ys(t,e){return new Promise(n=>{let r=xf(t);GM_xmlhttpRequest({method:"POST",url:r,headers:{"Content-Type":"application/json",apikey:ii,Authorization:`Bearer ${ii}`},data:JSON.stringify(e),onload:o=>{if(o.status>=200&&o.status<300)try{let s=o.responseText?JSON.parse(o.responseText):null;n({status:o.status,data:s})}catch(s){console.error("[supabase] POST parse error:",s,o.responseText),n({status:o.status,data:null})}else console.error("[supabase] POST error:",o.status,o.responseText),n({status:o.status,data:null})},onerror:o=>{console.error("[supabase] POST request failed:",o),n({status:0,data:null})}})})}async function Ef(t){let{status:e}=await ys("collect-state",t);return e===204?!0:(e===429&&console.warn("[supabase] sendPlayerState rate-limited"),!1)}async function Cd(t=50){let{data:e}=await Ed("list-rooms",{limit:t});return!e||!Array.isArray(e)?[]:e.map(n=>({id:n.id,isPrivate:n.is_private,playersCount:n.players_count,lastUpdatedAt:n.last_updated_at,lastUpdatedByPlayerId:n.last_updated_by_player_id,userSlots:Array.isArray(n.user_slots)?n.user_slots.map(r=>({name:r.name,avatarUrl:r.avatar_url??null})):void 0}))}async function gs(t,e){let n=Array.from(new Set((t??[]).map(a=>String(a).trim()).filter(a=>a.length>=3)));if(n.length===0)return[];let r={playerIds:n};e?.sections&&(r.sections=Array.isArray(e.sections)?e.sections:[e.sections]);let{status:o,data:s}=await ys("get-players-view",r);return o!==200||!Array.isArray(s)?[]:s}async function Cf(t,e){if(!t||!e||t===e)return!1;let{status:n}=await ys("friend-request",{fromPlayerId:t,toPlayerId:e});return n===204?!0:(n===409&&console.warn("[supabase] friend-request conflict (already exists)"),!1)}async function di(t){let{playerId:e,otherPlayerId:n,action:r}=t;if(!e||!n||e===n)return!1;let{status:o}=await ys("friend-respond",{playerId:e,otherPlayerId:n,action:r});return o===204}async function rE(t){if(!t)return[];let{status:e,data:n}=await Ed("list-friends",{playerId:t});return e!==200||!n||!Array.isArray(n.friends)?[]:n.friends}async function ui(t){let e=await rE(t);if(e.length===0)return li=[],[];let n=await gs(e,{sections:["profile","room"]});return li=n,[...n]}async function oE(t){if(!t)return{playerId:"",incoming:[],outgoing:[]};let{status:e,data:n}=await Ed("list-friend-requests",{playerId:t});return e!==200||!n?{playerId:t,incoming:[],outgoing:[]}:{playerId:n.playerId,incoming:Array.isArray(n.incoming)?n.incoming:[],outgoing:Array.isArray(n.outgoing)?n.outgoing:[]}}async function co(t){let{incoming:e}=await oE(t),n=e.map(o=>o.fromPlayerId);if(n.length===0)return ci=[],[];let r=await gs(n,{sections:["profile"]});return ci=r,[...r]}async function Mf(t,e){if(!t||!e||t===e)return!1;let{status:n}=await ys("friend-remove",{playerId:t,otherPlayerId:e});return n===204}async function Af(t,e){let n=t.trim(),r=e?.minQueryLength??2;if(n.length<r)return[];let o=e?.limitRooms??200,s=n.toLowerCase(),a=await Cd(o),i=[];for(let l of a){if(!l.userSlots||l.userSlots.length===0)continue;let c=l.userSlots.filter(d=>d.name?d.name.toLowerCase().includes(s):!1);c.length>0&&i.push({room:l,matchedSlots:c})}return console.log(i),i}var Md="friends.settings",pi={showOnlineFriendsOnly:!1,autoAcceptIncomingRequests:!1,hideRoomFromPublicList:!1,showGarden:!0,showInventory:!0,showCoins:!0,showActivityLog:!0,showJournal:!0,showStats:!0};var Tf="aries_mod",If=1,Ad={version:If,friends:{settings:pi}};function kf(){if(typeof window>"u")return null;try{return typeof window.localStorage>"u"?null:window.localStorage}catch{return null}}function sE(t){try{return JSON.parse(t)}catch{return t}}function Ye(t,e){let n={...t??{}};for(let[r,o]of Object.entries(e))n[r]===void 0&&(n[r]=o);return n}function aE(t){let e=t,n=0;for(;n++<10&&e&&typeof e=="object"&&"snapshot"in e&&typeof e.snapshot=="object";)e=e.snapshot;return e??t}function iE(t){let e={...Ad};if(!t||typeof t!="object")return e;let n=t;return typeof n.version=="number"&&(e.version=n.version),typeof n.migratedAt=="number"&&(e.migratedAt=n.migratedAt),"stats"in n&&(e.stats=aE(n.stats)),"customRooms"in n&&(e.room=Ye(e.room,{customRooms:n.customRooms})),"pets"in n&&typeof n.pets=="object"&&(e.pets=Ye(e.pets,n.pets)),"petsOverrides"in n&&(e.pets=Ye(e.pets,{overrides:n.petsOverrides})),"petsUI"in n&&(e.pets=Ye(e.pets,{ui:n.petsUI})),"petTeams"in n&&(e.pets=Ye(e.pets,{teams:n.petTeams})),"petTeamSearch"in n&&(e.pets=Ye(e.pets,{teamSearch:n.petTeamSearch})),"petTeamHotkeys"in n&&(e.pets=Ye(e.pets,{hotkeys:n.petTeamHotkeys})),"petAlerts"in n&&(e.pets=Ye(e.pets,{alerts:n.petAlerts})),"notifier"in n&&typeof n.notifier=="object"&&(e.notifier=Ye(e.notifier,n.notifier)),"notifierPrefs"in n&&(e.notifier=Ye(e.notifier,{prefs:n.notifierPrefs})),"notifierRules"in n&&(e.notifier=Ye(e.notifier,{rules:n.notifierRules})),"weatherNotifierPrefs"in n&&(e.notifier=Ye(e.notifier,{weatherPrefs:n.weatherNotifierPrefs})),"notifierLoopDefaults"in n&&(e.notifier=Ye(e.notifier,{loopDefaults:n.notifierLoopDefaults})),"misc"in n&&typeof n.misc=="object"&&(e.misc=Ye(e.misc,n.misc)),"ghostMode"in n&&(e.misc=Ye(e.misc,{ghostMode:n.ghostMode})),"ghostDelayMs"in n&&(e.misc=Ye(e.misc,{ghostDelayMs:n.ghostDelayMs})),"autoRecoEnabled"in n&&(e.misc=Ye(e.misc,{autoRecoEnabled:n.autoRecoEnabled})),"autoRecoDelayMs"in n&&(e.misc=Ye(e.misc,{autoRecoDelayMs:n.autoRecoDelayMs})),"locker"in n&&typeof n.locker=="object"&&(e.locker=Ye(e.locker,n.locker)),"lockerRestrictions"in n&&(e.locker=Ye(e.locker,{restrictions:n.lockerRestrictions})),"lockerState"in n&&(e.locker=Ye(e.locker,{state:n.lockerState})),"keybinds"in n&&typeof n.keybinds=="object"&&(e.keybinds=Ye(e.keybinds,n.keybinds)),"editorSavedGardens"in n&&(e.editor=Ye(e.editor,{savedGardens:n.editorSavedGardens})),"editor"in n&&typeof n.editor=="object"&&(e.editor=Ye(e.editor,n.editor)),"activityLog"in n&&typeof n.activityLog=="object"&&(e.activityLog=Ye(e.activityLog,n.activityLog)),"activityLogHistory"in n&&(e.activityLog=Ye(e.activityLog,{history:n.activityLogHistory})),"activityLogFilter"in n&&(e.activityLog=Ye(e.activityLog,{filter:n.activityLogFilter})),"hud"in n&&typeof n.hud=="object"&&(e.hud=Ye(e.hud,n.hud)),"menu"in n&&typeof n.menu=="object"&&(e.menu=Ye(e.menu,n.menu)),"inventory"in n&&typeof n.inventory=="object"&&(e.inventory=Ye(e.inventory,n.inventory)),"audio"in n&&typeof n.audio=="object"&&(e.audio=Ye(e.audio,n.audio)),"audioSettings"in n&&(e.audio=Ye(e.audio,{settings:n.audioSettings})),"audioLibrary"in n&&(e.audio=Ye(e.audio,{library:n.audioLibrary})),"soundEffectsVolumeAtom"in n&&(e.audio=Ye(e.audio,{sfxVolumeAtom:n.soundEffectsVolumeAtom})),"friends"in n&&typeof n.friends=="object"&&(e.friends={...e.friends??{},...n.friends}),e}function Td(){let t=kf();if(!t)return{...Ad};let e=t.getItem(Tf);if(e){let n=sE(e);if(n&&typeof n=="object")return iE(n)}return{...Ad}}function Pf(t){let e=kf();if(e)try{e.setItem(Tf,JSON.stringify(t))}catch{}}function Lf(t,e){let n=t;for(let r of e){if(!n||typeof n!="object")return;n=n[r]}return n}function Rf(t,e,n){if(!e.length)return;let r=t;for(let s=0;s<e.length-1;s++){let a=e[s];(!r[a]||typeof r[a]!="object")&&(r[a]={}),r=r[a]}let o=e[e.length-1];n===void 0?r&&typeof r=="object"&&delete r[o]:r[o]=n}function Id(){return Td()}function kd(t){Pf(t)}function _f(t){let e=Td();return t(e),e.version=If,Pf(e),e}function _e(t,e){let n=t.split(".").filter(Boolean),r=Lf(Td(),n);return r===void 0?e:r}function Oe(t,e){return _f(n=>{Rf(n,t.split(".").filter(Boolean),e)})}function mi(t,e){return _f(n=>{let r=t.split(".").filter(Boolean),o=Lf(n,r),s=e(o);Rf(n,r,s)})}var Pd=new Set,fi=null,Nf=!1;function Df(t){try{Oe(Md,t)}catch{}}function Ld(){if(Nf&&fi)return fi;Nf=!0;let t=_e(Md),e=qf(t);return fi=e,t||Df(e),e}function lE(t){for(let e of Pd)try{e(t)}catch(n){console.error("[FriendSettings] subscriber error",n)}}function qf(t){return{...pi,...t??{}}}function Rr(){return Ld()}function cE(t){Ld();let e=qf(t);return fi=e,lE(e),Df(e),e}function Of(t){let e=Ld();return cE({...e,...t})}function yi(t){return Pd.add(t),()=>Pd.delete(t)}var dE={showProfile:!0,showGarden:!0,showInventory:!0,showCoins:!0,showActivityLog:!0,showJournal:!0,hideRoomFromPublicList:!1,showStats:!0};function uE(t){let e=Math.floor(Number(t));return Number.isFinite(e)?Math.max(1,Math.min(6,e)):1}function pE(t){if(!t||typeof t!="object")return[];let e=[],n=new Set,r=[t];for(;r.length;){let s=r.pop();if(!(!s||typeof s!="object"||n.has(s))){n.add(s);for(let a of Object.keys(s)){let i=s[a];Array.isArray(i)&&i.length>0&&i.every(l=>l&&typeof l=="object")&&i.some(c=>"id"in c&&"name"in c)&&/player/i.test(a)&&e.push(...i),i&&typeof i=="object"&&r.push(i)}}}let o=new Map;for(let s of e)s?.id&&o.set(String(s.id),s);return[...o.values()]}function mE(t){let e=t?.fullState?.data?.players??t?.data?.players??t?.players;return Array.isArray(e)?e:pE(t)}function fE(t){let e=t?.child?.data?.userSlots??t?.fullState?.child?.data?.userSlots??t?.data?.userSlots;if(Array.isArray(e))return e;if(e&&typeof e=="object"){let n=Object.entries(e);return n.sort((r,o)=>{let s=Number(r[0]),a=Number(o[0]);return Number.isFinite(s)&&Number.isFinite(a)?s-a:r[0].localeCompare(o[0])}),n.map(([,r])=>r)}return[]}function yE(t,e){if(!Array.isArray(t)||t.length===0)return null;let{slotIndex:n,playerId:r}=e;if(typeof n=="number"&&Number.isInteger(n)){let s=t[n];if(s&&typeof s=="object")return s}let o=r!=null?String(r):null;if(o){for(let s of t)if(!(!s||typeof s!="object")&&String(s.databaseUserId??s.playerId??s.data?.databaseUserId??s.data?.playerId??"")===o)return s}for(let s of t)if(!(!s||typeof s!="object")&&(s.playerId||s.databaseUserId||s.data))return s;return null}function gE(t,e,n){let r=n.playerId??e?.playerId??e?.databaseUserId??e?.data?.playerId??e?.data?.databaseUserId??null,o=r!=null?String(r):null;if(o){for(let s of t)if(!(!s||typeof s!="object")&&(String(s.id??"")===o||String(s.databaseUserId??"")===o))return s}return t[0]??null}function hE(t){let e=t?.activityLog??t?.activityLogs??t?.activitylog;return Array.isArray(e)?e:null}async function _d(t={}){try{let e=await ce.root.state.get();if(!e||typeof e!="object")return null;let n=Rr(),r={showProfile:dE.showProfile,showGarden:n.showGarden,showInventory:n.showInventory,showCoins:n.showCoins,showActivityLog:n.showActivityLog,showJournal:n.showJournal,showStats:n.showStats,hideRoomFromPublicList:n.hideRoomFromPublicList},o=mE(e),s=Array.isArray(o)?o:[],a=fE(e).filter(A=>!!A),i=a.map((A,N)=>{let H=A?.data??A,C=H?.coinsCount??H?.data?.coinsCount??A?.coinsCount??A?.data?.coinsCount??null,L=Number(C),v=Number.isFinite(L)?L:null,B=s[N]??null;return{name:typeof B?.name=="string"?B.name:typeof H?.name=="string"?H.name:null,discordAvatarUrl:typeof B?.discordAvatarUrl=="string"?B.discordAvatarUrl:typeof H?.discordAvatarUrl=="string"?H.discordAvatarUrl:null,playerId:H?.databaseUserId??A?.databaseUserId??H?.playerId??null,coins:v}}),l=await Fn.get();if(a.length===0)return null;let c=yE(a,{...t,playerId:t.playerId??l??void 0});if(!c||typeof c!="object")return null;let d=c.data??c;if(!d||typeof d!="object")return null;let u=gE(s,c,t),y=c.databaseUserId??u?.databaseUserId??c.playerId??u?.id??null,h=u?.name??d?.name??c?.name??null,f=u?.discordAvatarUrl??d?.discordAvatarUrl??c?.discordAvatarUrl??null,p=d?.coinsCount??c?.coinsCount??d?.coins??c?.coins??null,m=Number(p),g=Number.isFinite(m)?m:null,S=e?.data?.roomId??e?.fullState?.data?.roomId??e?.roomId??null,w=s.length>0?s.length:a.length;try{let A=await ce.server.numPlayers.get();w=uE(A)}catch{}let x=_e("activityLog.history"),E=Array.isArray(x)?x:hE(d),T=d?.journal??d?.data?.journal??c?.journal??c?.data?.journal??null;return{playerId:y!=null?String(y):null,playerName:r.showProfile?h:null,avatarUrl:r.showProfile?f:null,coins:r.showCoins?g:null,room:{id:S,isPrivate:r.hideRoomFromPublicList??null,playersCount:w,userSlots:i},privacy:r,state:{garden:r.showGarden?d?.garden??null:null,inventory:r.showInventory?d?.inventory??c?.inventory??null:null,stats:r.showStats&&typeof d?.stats=="object"&&d?.stats?d.stats:null,activityLog:r.showActivityLog?E:null,journal:r.showJournal?T:null}}}catch{return null}}function bE(t){return Array.isArray(t)?t.filter(e=>e?.action!=="feedPet"):null}function SE(t){let e=bE(t.activityLog??null);return e===t.activityLog?t:{...t,activityLog:e}}function vE(t){try{let e=SE(t);return JSON.stringify(e)}catch(e){return console.error("[PlayerPayload] Failed to snapshot player state",e),null}}async function wE(t){return _d(t)}et("buildPlayerStatePayload",_d);et("logPlayerStatePayload",wE);var Ff=!1,Bf=!1,Jf,Hf=!1,Wf=new Set,hs=null,zf=!1,xE=null;async function EE(){try{let t=await Fn.get();if(!t)return;let e=await co(t);await $f(t,e)>0&&await co(t),await ui(t)}catch(t){console.error("[PlayerPayload] Failed to prefetch friends data",t)}}async function $f(t,e){if(!e||!e.length)return 0;let{autoAcceptIncomingRequests:n}=Rr();if(!n)return 0;let r=0;for(let o of e){let s=o?.playerId;if(s&&!Wf.has(s))try{await di({playerId:t,otherPlayerId:s,action:"accept"})&&(Wf.add(s),r+=1,be("Friends",`Auto-accepted incoming request from ${o.playerName??s}.`,"success"))}catch(a){console.error("[PlayerPayload] auto-accept request failed",a)}}return r}function CE(){Hf||(Hf=!0,EE())}async function Gf(){try{let t=await Fn.get();if(!t)return;let e=await co(t);await $f(t,e)}catch(t){console.error("[PlayerPayload] auto-accept poll failed",t)}}function ME(){hs!==null&&(clearInterval(hs),hs=null)}function jf(){let{autoAcceptIncomingRequests:t}=Rr();if(!t){ME();return}hs===null&&(Gf(),hs=setInterval(()=>{Gf()},6e4))}function AE(){zf||(zf=!0,jf(),xE=yi(()=>{jf()}))}async function Kf(t){if(Bf)return;let e=t??await ce.root.state.get();(Array.isArray(e?.data?.players)?e.data.players:[]).length!==0&&(Bf=!0,TE(Jf),CE())}function Zf(t){Ff||(Ff=!0,Jf=t,Kf(),ce.root.state.onChange(e=>{Kf(e)}),AE())}var Uf=null,Rd=!1,Vf=null,Yf=null;async function Qf(){if(!Rd){Rd=!0;try{let t=await _d();if(!t)return;let e=vE(t.state);if(e!==null&&!Vf&&(Vf=e),e!==null&&Yf===e)return;await Ef(t),e!==null&&(Yf=e)}catch(t){console.error("[PlayerPayload] Failed to send payload:",t)}finally{Rd=!1}}}function TE(t=15e4){if(console.log("start reporting"),Uf!==null)return;let e=Number.isFinite(t)&&t>0?t:15e4;Qf(),Uf=setInterval(()=>{Qf()},e)}var _t=Re.WebSocket,dq=Re.Worker,It=[],Bn=null;function _r(t,e){if(!Bn){Bn=t,et("quinoaWS",t);try{console.log("[QuinoaWS] selected ->",e)}catch{}}}var gi=!1;var hi=typeof Set<"u"?new Set:{_a:[],add(t){this._a.push(t)},delete(t){let e=this._a.indexOf(t);e>=0&&this._a.splice(e,1)},forEach(t){for(let e=0;e<this._a.length;e++)t(this._a[e])}};function bi(t){return["CONNECTING","OPEN","CLOSING","CLOSED"][t??-1]||"none"}async function Xf(t){try{if(typeof t=="string")return JSON.parse(t);if(t instanceof Blob)return JSON.parse(await t.text());if(t instanceof ArrayBuffer)return JSON.parse(new TextDecoder().decode(t))}catch{}return null}var me={Common:"Common",Uncommon:"Uncommon",Rare:"Rare",Legendary:"Legendary",Mythic:"Mythical",Divine:"Divine",Celestial:"Celestial"},Ge={Single:"Single",Multiple:"Multiple"},ey={Dirt1:6,Dirt2:7,Dirt3:8,Bush1:28,Bush2:38,BushHomer:48,Sky0:24,Sky1:25,Sky2:26,Sky3:27,Sky4:35,Sky5:36,Sky6:37,Sky7:45,Sky8:46,Sky9:47},Te={DirtPatch:1,SproutFlower:2,SproutVegetable:3,SproutFruit:4,SproutVine:5,StemFlower:6,Trellis:7,Daffodil:11,Tulip:12,Sunflower:13,Lily:14,Starweaver:15,Chrysanthemum:16,AloePlant:17,Aloe:18,Blueberry:21,Banana:22,Strawberry:23,Mango:24,Grape:25,Watermelon:26,Lemon:27,Apple:28,Pear:29,Pineapple:30,Pepper:31,Tomato:32,BabyCarrot:33,Carrot:34,Pumpkin:35,Corn:36,FavaBean:37,Cacao:38,PalmTreeTop:39,BushyTree:40,Coconut:41,MushroomPlant:42,PassionFruit:43,DragonFruit:44,Lychee:45,Mushroom:46,BurrosTail:47,Echeveria:49,Delphinium:50,DawnCelestialCrop:51,MoonCelestialCrop:52,Camellia:57,Hedge:58,FlowerBush:59,Squash:60},wt={Bamboo:1,PalmTree:2,DawnCelestialPlatform:3,DawnCelestialPlant:4,DawnCelestialPlantActive:5,DawnCelestialPlatformTopmostLayer:6,Cactus:7,Tree:8,MoonCelestialPlatform:9,MoonCelestialPlant:10,MoonCelestialPlantActive:11,StarweaverPlatform:13,StarweaverPlant:14,CacaoTree:15},je={Daffodil:1,Tulip:2,Sunflower:3,Starweaver:6,DawnCelestial:7,MoonCelestial:8,Blueberry:11,Banana:12,Strawberry:13,Mango:14,Grape:15,Watermelon:16,Lemon:17,Apple:18,Pear:19,Lily:20,Pepper:21,Tomato:22,Carrot:23,Pumpkin:25,Corn:26,Peach:27,FavaBean:28,Cacao:29,Delphinium:30,Coconut:31,Mushroom:32,PassionFruit:33,DragonFruit:34,Lychee:35,BurrosTail:37,Aloe:39,Echeveria:40,Bamboo:41,Cactus:42,Camellia:48,Chrysanthemum:49,Squash:50},uo={Coin:1,Shovel:2,PlanterPot:6,InventoryBag:7,WateringCan:9,MoneyBag:11,RainbowPotion:14,GoldPotion:15,WetPotion:16,ChilledPotion:17,FrozenPotion:18,DawnlitPotion:19,AmberlitPotion:20,JournalStamp:22,Donut:23,ToolsRestocked:24,SeedsRestocked:25,EggsRestocked:26,DecorRestocked:27,Leaderboard:28,Stats:29,ActivityLog:30,ChatBubble:39,ArrowKeys:41,Touchpad:42},Si={Rain:10,Frost:20,Sunny:30,AmberMoon:40,Dawn:50,MoonCelestialActivationTile:91,DawnCelestialActivationTile:92},pt={Bee:1,Chicken:2,Bunny:3,Turtle:4,Capybara:5,Cow:6,Pig:7,Butterfly:8,Snail:9,Worm:10,CommonEgg:11,UncommonEgg:12,RareEgg:13,LegendaryEgg:14,MythicalEgg:15,DivineEgg:16,CelestialEgg:17,Squirrel:18,Goat:19,Dragonfly:20,Turkey:29,Peacock:30},tn={Wet:1,Chilled:2,Frozen:3,Puddle:5,Dawnlit:11,Amberlit:12,Dawncharged:13,Ambercharged:14},Nr={Wet:"Wet",Chilled:"Chilled",Frozen:"Frozen",Puddle:"Puddle",Dawnlit:"Dawnlit",Amberlit:"Amberlit",Dawncharged:"Dawnbound",Ambercharged:"Amberbound"},xe={WoodPedestal:4,StonePedestal:6,MarblePedestal:8,SmallRock:11,WoodBench:13,WoodBenchBackwards:14,StoneBench:15,StoneBucketPedestal:16,MarbleBench:17,MarbleBenchBackwards:18,MediumRock:21,WoodLampPost:23,WoodBenchSideways:24,StoneLampPost:25,StoneBenchSideways:26,StoneColumn:26,MarbleLampPost:27,MarbleBenchSideways:28,HayBale:29,PetHutch:30,LargeRock:31,WoodArch:33,WoodBucketPedestal:34,WoodBridge:34,StoneArch:35,StoneBridge:36,MarbleArch:37,MarbleBridge:38,HayBaleSideways:39,MiniFairyForge:40,WoodArchSide:43,WoodBridgeSideways:44,StoneArchSideways:45,StoneBridgeSideways:46,MarbleArchSideways:47,MarbleBridgeSideways:48,StrawScarecrow:49,MiniFairyCottage:50,WoodOwl:53,Birdhouse:54,StoneGnome:55,StoneBirdBath:56,MarbleBlobling:57,MarbleBucketPedestal:58,MarbleFountain:58,Cauldron:59,MiniFairyKeep:60,WoodStool:63,WoodWindmill:64,StoneGardenBox:66,MarbleColumn:68,MiniWizardTower:68,SmallGravestone:69,SmallGravestoneSideways:70,WoodenWindmill:73,WoodGardenBox:74,MarbleGardenBox:78,MediumGravestone:79,MediumGravestoneSideways:80,LargeGravestone:89,LargeGravestoneSideways:90},De={Carrot:{seed:{tileRef:je.Carrot,name:"Carrot Seed",coinPrice:10,creditPrice:7,rarity:me.Common},plant:{tileRef:Te.BabyCarrot,name:"Carrot Plant",harvestType:Ge.Single,baseTileScale:.7},crop:{tileRef:Te.Carrot,name:"Carrot",baseSellPrice:20,baseWeight:.1,baseTileScale:.6,maxScale:3}},Strawberry:{seed:{tileRef:je.Strawberry,name:"Strawberry Seed",coinPrice:50,creditPrice:21,rarity:me.Common},plant:{tileRef:Te.SproutFruit,name:"Strawberry Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.2,y:-.1,rotation:0},{x:.175,y:-.2,rotation:0},{x:-.18,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:.01,rotation:0}],secondsToMature:70,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Strawberry,name:"Strawberry",baseSellPrice:14,baseWeight:.05,baseTileScale:.25,maxScale:2}},Aloe:{seed:{tileRef:je.Aloe,name:"Aloe Seed",coinPrice:135,creditPrice:18,rarity:me.Common},plant:{tileRef:Te.AloePlant,name:"Aloe Plant",harvestType:Ge.Single,baseTileScale:.9},crop:{tileRef:Te.Aloe,name:"Aloe",baseSellPrice:310,baseWeight:1.5,baseTileScale:.7,maxScale:2.5}},FavaBean:{seed:{tileRef:je.FavaBean,name:"Fava Bean",coinPrice:250,creditPrice:30,rarity:me.Uncommon},plant:{tileRef:Te.SproutFlower,name:"Fava Bean Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.1,y:.15,rotation:35},{x:-.23,y:.22,rotation:35},{x:.05,y:.3,rotation:35},{x:.18,y:.25,rotation:35},{x:.22,y:-.02,rotation:35},{x:.1,y:-.15,rotation:35},{x:-.1,y:-.17,rotation:35},{x:-.25,y:-.11,rotation:35}],secondsToMature:900,baseTileScale:1.1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.FavaBean,name:"Fava Bean Pod",baseSellPrice:30,baseWeight:.03,baseTileScale:.3,maxScale:3}},Delphinium:{seed:{tileRef:je.Delphinium,name:"Delphinium Seed",coinPrice:300,creditPrice:12,rarity:me.Uncommon},plant:{tileRef:Te.Delphinium,name:"Delphinium Plant",harvestType:Ge.Single,baseTileScale:.8,tileTransformOrigin:"bottom",nudgeY:-.43,nudgeYMultiplier:.05},crop:{tileRef:Te.Delphinium,name:"Delphinium",baseSellPrice:530,baseWeight:.02,baseTileScale:.8,maxScale:3}},Blueberry:{seed:{tileRef:je.Blueberry,name:"Blueberry Seed",coinPrice:400,creditPrice:49,rarity:me.Uncommon},plant:{tileRef:Te.SproutFruit,name:"Blueberry Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.2,y:-.1,rotation:0},{x:.175,y:-.2,rotation:0},{x:-.18,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:.01,rotation:0}],secondsToMature:105,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Blueberry,name:"Blueberry",baseSellPrice:23,baseWeight:.01,baseTileScale:.25,maxScale:2}},Apple:{seed:{tileRef:je.Apple,name:"Apple Seed",coinPrice:500,creditPrice:67,rarity:me.Uncommon,unavailableSurfaces:["discord"]},plant:{tileRef:wt.Tree,name:"Apple Tree",harvestType:Ge.Multiple,slotOffsets:[{x:-.35,y:-2.4,rotation:0},{x:-.5,y:-2,rotation:0},{x:.1,y:-2.2,rotation:0},{x:-.2,y:-1.65,rotation:0},{x:.55,y:-1.9,rotation:0},{x:.3,y:-1.7,rotation:0},{x:.4,y:.1,rotation:0}],secondsToMature:360*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.25},crop:{tileRef:Te.Apple,name:"Apple",baseSellPrice:73,baseWeight:.18,baseTileScale:.5,maxScale:2}},OrangeTulip:{seed:{tileRef:je.Tulip,name:"Tulip Seed",coinPrice:600,creditPrice:14,rarity:me.Uncommon},plant:{tileRef:Te.Tulip,name:"Tulip Plant",harvestType:Ge.Single,baseTileScale:.5},crop:{tileRef:Te.Tulip,name:"Tulip",baseSellPrice:767,baseWeight:.01,baseTileScale:.5,maxScale:3}},Tomato:{seed:{tileRef:je.Tomato,name:"Tomato Seed",coinPrice:800,creditPrice:79,rarity:me.Uncommon},plant:{tileRef:Te.SproutVine,name:"Tomato Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.3,y:-.3,rotation:0},{x:.3,y:.3,rotation:0}],secondsToMature:1100,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Te.Tomato,name:"Tomato",baseSellPrice:27,baseWeight:.3,baseTileScale:.33,maxScale:2}},Daffodil:{seed:{tileRef:je.Daffodil,name:"Daffodil Seed",coinPrice:1e3,creditPrice:19,rarity:me.Rare},plant:{tileRef:Te.Daffodil,name:"Daffodil Plant",harvestType:Ge.Single,baseTileScale:.5},crop:{tileRef:Te.Daffodil,name:"Daffodil",baseSellPrice:1090,baseWeight:.01,baseTileScale:.5,maxScale:3}},Corn:{seed:{tileRef:je.Corn,name:"Corn Kernel",coinPrice:1300,creditPrice:135,rarity:me.Rare},plant:{tileRef:Te.SproutVegetable,name:"Corn Plant",harvestType:Ge.Multiple,slotOffsets:[{x:0,y:-.1,rotation:0}],secondsToMature:130,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Te.Corn,name:"Corn",baseSellPrice:36,baseWeight:1.2,baseTileScale:.7,maxScale:2}},Watermelon:{seed:{tileRef:je.Watermelon,name:"Watermelon Seed",coinPrice:2500,creditPrice:195,rarity:me.Rare},plant:{tileRef:Te.Watermelon,name:"Watermelon Plant",harvestType:Ge.Single,baseTileScale:.8},crop:{tileRef:Te.Watermelon,name:"Watermelon",baseSellPrice:2708,baseWeight:4.5,baseTileScale:.8,maxScale:3}},Pumpkin:{seed:{tileRef:je.Pumpkin,name:"Pumpkin Seed",coinPrice:3e3,creditPrice:210,rarity:me.Rare},plant:{tileRef:Te.Pumpkin,name:"Pumpkin Plant",harvestType:Ge.Single,baseTileScale:.8},crop:{tileRef:Te.Pumpkin,name:"Pumpkin",baseSellPrice:3700,baseWeight:6,baseTileScale:.8,maxScale:3}},Echeveria:{seed:{tileRef:je.Echeveria,name:"Echeveria Cutting",coinPrice:4200,creditPrice:113,rarity:me.Rare},plant:{tileRef:Te.Echeveria,name:"Echeveria Plant",harvestType:Ge.Single,baseTileScale:.8},crop:{tileRef:Te.Echeveria,name:"Echeveria",baseSellPrice:4600,baseWeight:.8,baseTileScale:.8,maxScale:2.75}},Coconut:{seed:{tileRef:je.Coconut,name:"Coconut Seed",coinPrice:6e3,creditPrice:235,rarity:me.Legendary},plant:{tileRef:wt.PalmTree,name:"Coconut Tree",harvestType:Ge.Multiple,slotOffsets:[{x:-.2,y:-2.6,rotation:0},{x:-.3,y:-2.4,rotation:0},{x:.2,y:-2.5,rotation:0},{x:-.25,y:-2.1,rotation:0},{x:0,y:-2.3,rotation:0},{x:.3,y:-2.2,rotation:0},{x:.05,y:-2,rotation:0}],secondsToMature:720*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.35},crop:{tileRef:Te.Coconut,name:"Coconut",baseSellPrice:302,baseWeight:5,baseTileScale:.25,maxScale:3}},Banana:{seed:{tileRef:je.Banana,name:"Banana Seed",coinPrice:7500,creditPrice:199,rarity:me.Legendary,getCanSpawnInGuild:t=>{let e=t.slice(-1),n=parseInt(e,10);return!isNaN(n)&&n%2===0},unavailableSurfaces:["web"]},plant:{tileRef:wt.PalmTree,name:"Banana Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.3,y:-1.7,rotation:10},{x:-.2,y:-1.7,rotation:-10},{x:-.1,y:-1.7,rotation:-30},{x:0,y:-1.7,rotation:-50},{x:.1,y:-1.7,rotation:-70}],secondsToMature:14400,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.4},crop:{tileRef:Te.Banana,name:"Banana",baseSellPrice:1750,baseWeight:.12,baseTileScale:.5,maxScale:1.7}},Lily:{seed:{tileRef:je.Lily,name:"Lily Seed",coinPrice:2e4,creditPrice:34,rarity:me.Legendary},plant:{tileRef:Te.Lily,name:"Lily Plant",harvestType:Ge.Single,baseTileScale:.75,nudgeY:-.1},crop:{tileRef:Te.Lily,name:"Lily",baseSellPrice:20123,baseWeight:.02,baseTileScale:.5,maxScale:2.75}},Camellia:{seed:{tileRef:je.Camellia,name:"Camellia Seed",coinPrice:55e3,creditPrice:289,rarity:me.Legendary},plant:{tileRef:Te.Hedge,name:"Camellia Hedge",harvestType:Ge.Multiple,slotOffsets:[{x:0,y:-.9,rotation:0},{x:-.28,y:-.6,rotation:0},{x:.28,y:-.6,rotation:0},{x:-.35,y:-.2,rotation:0},{x:.32,y:-.2,rotation:0},{x:-.3,y:.25,rotation:0},{x:.28,y:.25,rotation:0},{x:0,y:0,rotation:0}],secondsToMature:1440*60,baseTileScale:2,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.4,nudgeYMultiplier:.5},crop:{tileRef:Te.Camellia,name:"Camellia",baseSellPrice:4875,baseWeight:.3,baseTileScale:.4,maxScale:2.5}},Squash:{seed:{tileRef:je.Squash,name:"Squash Seed",coinPrice:55e3,creditPrice:199,rarity:me.Legendary},plant:{tileRef:Te.SproutFlower,name:"Squash Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.08,y:.2,rotation:35},{x:.2,y:0,rotation:35},{x:-.2,y:-.1,rotation:35}],secondsToMature:1500,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Squash,name:"Squash",baseSellPrice:3500,baseWeight:.3,baseTileScale:.4,maxScale:2.5}},BurrosTail:{seed:{tileRef:je.BurrosTail,name:"Burro's Tail Cutting",coinPrice:93e3,creditPrice:338,rarity:me.Legendary},plant:{tileRef:Te.Trellis,name:"Burro's Tail Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.13,y:-.1,rotation:0},{x:.17,y:.13,rotation:0}],secondsToMature:1800,baseTileScale:.8,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Te.BurrosTail,name:"Burro's Tail",baseSellPrice:6e3,baseWeight:.4,baseTileScale:.4,maxScale:2.5}},Mushroom:{seed:{tileRef:je.Mushroom,name:"Mushroom Spore",coinPrice:15e4,creditPrice:249,rarity:me.Mythic},plant:{tileRef:Te.MushroomPlant,name:"Mushroom Plant",harvestType:Ge.Single,baseTileScale:.8},crop:{tileRef:Te.Mushroom,name:"Mushroom",baseSellPrice:16e4,baseWeight:25,baseTileScale:.65,maxScale:3.5}},Cactus:{seed:{tileRef:je.Cactus,name:"Cactus Seed",coinPrice:25e4,creditPrice:250,rarity:me.Mythic},plant:{tileRef:wt.Cactus,name:"Cactus Plant",harvestType:Ge.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:-.4,nudgeYMultiplier:.3},crop:{tileRef:wt.Cactus,name:"Cactus",baseSellPrice:261e3,baseWeight:1500,baseTileScale:2.5,maxScale:1.8}},Bamboo:{seed:{tileRef:je.Bamboo,name:"Bamboo Seed",coinPrice:4e5,creditPrice:300,rarity:me.Mythic},plant:{tileRef:wt.Bamboo,name:"Bamboo Plant",harvestType:Ge.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:-.45,nudgeYMultiplier:.3},crop:{tileRef:wt.Bamboo,name:"Bamboo Shoot",baseSellPrice:5e5,baseWeight:1,baseTileScale:2.5,maxScale:2}},Chrysanthemum:{seed:{tileRef:je.Chrysanthemum,name:"Chrysanthemum Seed",coinPrice:67e4,creditPrice:567,rarity:me.Mythic},plant:{tileRef:Te.FlowerBush,name:"Chrysanthemum Bush",harvestType:Ge.Multiple,slotOffsets:[{x:0,y:0,rotation:0},{x:-.28,y:.22,rotation:0},{x:.28,y:.22,rotation:0},{x:0,y:.33,rotation:0},{x:-.25,y:-.2,rotation:0},{x:.25,y:-.2,rotation:0},{x:0,y:-.28,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom"},crop:{tileRef:Te.Chrysanthemum,name:"Chrysanthemum",baseSellPrice:18e3,baseWeight:.01,baseTileScale:.3,maxScale:2.75}},Grape:{seed:{tileRef:je.Grape,name:"Grape Seed",coinPrice:85e4,creditPrice:599,rarity:me.Mythic,getCanSpawnInGuild:t=>t.endsWith("1"),unavailableSurfaces:["web"]},plant:{tileRef:Te.SproutVine,name:"Grape Plant",harvestType:Ge.Multiple,slotOffsets:[{x:0,y:0,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Grape,name:"Grape",baseSellPrice:12500,baseWeight:3,baseTileScale:.5,maxScale:2}},Pepper:{seed:{tileRef:je.Pepper,name:"Pepper Seed",coinPrice:1e6,creditPrice:629,rarity:me.Divine},plant:{tileRef:Te.SproutVine,name:"Pepper Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.02,y:.219,rotation:0},{x:.172,y:.172,rotation:0},{x:-.172,y:.137,rotation:0},{x:.168,y:-.035,rotation:0},{x:-.082,y:-.047,rotation:0},{x:-.207,y:-.074,rotation:0},{x:.18,y:-.176,rotation:0},{x:-.273,y:-.195,rotation:0},{x:-.074,y:-.25,rotation:0}],secondsToMature:560,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Pepper,name:"Pepper",baseSellPrice:7220,baseWeight:.5,baseTileScale:.3,maxScale:2}},Lemon:{seed:{tileRef:je.Lemon,name:"Lemon Seed",coinPrice:2e6,creditPrice:500,rarity:me.Divine,getCanSpawnInGuild:t=>t.endsWith("2"),unavailableSurfaces:["web"]},plant:{tileRef:wt.Tree,name:"Lemon Tree",harvestType:Ge.Multiple,slotOffsets:[{x:-.5,y:-1.5,rotation:0},{x:.4,y:-1.6,rotation:0},{x:-.3,y:-1.18,rotation:0},{x:.2,y:-1.2,rotation:0},{x:.01,y:-1.5,rotation:0},{x:-.05,y:-1.8,rotation:0}],secondsToMature:720*60,baseTileScale:2.3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.25},crop:{tileRef:Te.Lemon,name:"Lemon",baseSellPrice:1e4,baseWeight:.5,baseTileScale:.25,maxScale:3}},PassionFruit:{seed:{tileRef:je.PassionFruit,name:"Passion Fruit Seed",coinPrice:275e4,creditPrice:679,rarity:me.Divine},plant:{tileRef:Te.SproutVine,name:"Passion Fruit Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.3,y:-.3,rotation:0},{x:.3,y:.3,rotation:0}],secondsToMature:1440*60,baseTileScale:1.1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Te.PassionFruit,name:"Passion Fruit",baseSellPrice:24500,baseWeight:9.5,baseTileScale:.35,maxScale:2}},DragonFruit:{seed:{tileRef:je.DragonFruit,name:"Dragon Fruit Seed",coinPrice:5e6,creditPrice:715,rarity:me.Divine},plant:{tileRef:Te.PalmTreeTop,name:"Dragon Fruit Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.3,y:-.4,rotation:0},{x:-.4,y:-.05,rotation:0},{x:.36,y:-.3,rotation:0},{x:-.25,y:.3,rotation:0},{x:0,y:-.1,rotation:0},{x:.4,y:.1,rotation:0},{x:.1,y:.2,rotation:0}],secondsToMature:600,baseTileScale:1.6,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.DragonFruit,name:"Dragon Fruit",baseSellPrice:24500,baseWeight:8.4,baseTileScale:.4,maxScale:2}},Cacao:{seed:{tileRef:je.Cacao,name:"Cacao Bean",coinPrice:1e7,creditPrice:750,rarity:me.Divine},plant:{tileRef:wt.CacaoTree,name:"Cacao Plant",harvestType:Ge.Multiple,slotOffsets:[{x:.28,y:-1.17,rotation:20},{x:-.3,y:-1.07,rotation:20},{x:-.05,y:-1.42,rotation:20},{x:.45,y:-1.67,rotation:20},{x:-.5,y:-1.57,rotation:20},{x:-.05,y:-1.87,rotation:20}],secondsToMature:1440*60,baseTileScale:2.8,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.32},crop:{tileRef:Te.Cacao,name:"Cacao Fruit",baseSellPrice:7e4,baseWeight:.5,baseTileScale:.4,maxScale:2.5}},Lychee:{seed:{tileRef:je.Lychee,name:"Lychee Pit",coinPrice:25e6,creditPrice:819,rarity:me.Divine,getCanSpawnInGuild:t=>t.endsWith("2"),unavailableSurfaces:["web"]},plant:{tileRef:Te.BushyTree,name:"Lychee Plant",harvestType:Ge.Multiple,slotOffsets:[{x:-.4,y:-.1,rotation:0},{x:.3,y:-.2,rotation:0},{x:-.3,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:-.1,rotation:0},{x:-.2,y:-.3,rotation:0}],secondsToMature:1440*60,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Te.Lychee,name:"Lychee Fruit",baseSellPrice:5e4,baseWeight:9,baseTileScale:.2,maxScale:2}},Sunflower:{seed:{tileRef:je.Sunflower,name:"Sunflower Seed",coinPrice:1e8,creditPrice:900,rarity:me.Divine},plant:{tileRef:Te.StemFlower,name:"Sunflower Plant",harvestType:Ge.Multiple,slotOffsets:[{x:.01,y:-.6,rotation:0}],secondsToMature:1440*60,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",baseTileScale:.8,nudgeY:-.35},crop:{tileRef:Te.Sunflower,name:"Sunflower",baseSellPrice:75e4,baseWeight:10,baseTileScale:.5,maxScale:2.5}},Starweaver:{seed:{tileRef:je.Starweaver,name:"Starweaver Pod",coinPrice:1e9,creditPrice:1e3,rarity:me.Celestial},plant:{tileRef:wt.StarweaverPlant,name:"Starweaver Plant",harvestType:Ge.Multiple,slotOffsets:[{x:0,y:-.918,rotation:0}],secondsToMature:1440*60,baseTileScale:1.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.27,immatureTileRef:wt.StarweaverPlatform,isFixedScale:!0,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2}},crop:{tileRef:Te.Starweaver,name:"Starweaver Fruit",baseSellPrice:1e7,baseWeight:10,baseTileScale:.6,maxScale:2}},DawnCelestial:{seed:{tileRef:je.DawnCelestial,name:"Dawnbinder Pod",coinPrice:1e10,creditPrice:1129,rarity:me.Celestial},plant:{tileRef:wt.DawnCelestialPlant,name:"Dawnbinder",harvestType:Ge.Multiple,secondsToMature:1440*60,slotOffsets:[{x:-.015,y:-.95,rotation:0}],baseTileScale:2.3,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.2,abilities:["DawnKisser"],activeState:{tileRef:wt.DawnCelestialPlantActive,activeAnimationTiles:{frames:10,row:6,fps:20,nudgeY:-.1}},topmostLayerTileRef:wt.DawnCelestialPlatformTopmostLayer,immatureTileRef:wt.DawnCelestialPlatform,isFixedScale:!0,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2}},crop:{tileRef:Te.DawnCelestialCrop,name:"Dawnbinder Bulb",baseSellPrice:11e6,baseWeight:6,baseTileScale:.4,maxScale:2.5,transformOrigin:"top"}},MoonCelestial:{seed:{tileRef:je.MoonCelestial,name:"Moonbinder Pod",coinPrice:5e10,creditPrice:1249,rarity:me.Celestial},plant:{tileRef:wt.MoonCelestialPlant,name:"Moonbinder",harvestType:Ge.Multiple,slotOffsets:[{x:.01,y:-1.81,rotation:0},{x:-.26,y:-.82,rotation:-20},{x:.23,y:-1,rotation:20}],secondsToMature:1440*60,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.2,abilities:["MoonKisser"],activeState:{tileRef:wt.MoonCelestialPlantActive,activeAnimationTiles:{frames:10,row:6,fps:20,nudgeY:-.1}},immatureTileRef:wt.MoonCelestialPlatform,isFixedScale:!0,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2}},crop:{tileRef:Te.MoonCelestialCrop,name:"Moonbinder Bulb",baseSellPrice:11e6,baseWeight:2,baseTileScale:.4,maxScale:2,transformOrigin:"bottom"}}},an={Gold:{name:"Gold",baseChance:.01,coinMultiplier:25},Rainbow:{name:"Rainbow",baseChance:.001,coinMultiplier:50},Wet:{name:"Wet",baseChance:0,coinMultiplier:2,tileRef:tn.Wet},Chilled:{name:"Chilled",baseChance:0,coinMultiplier:2,tileRef:tn.Chilled},Frozen:{name:"Frozen",baseChance:0,coinMultiplier:10,tileRef:tn.Frozen},Dawnlit:{name:"Dawnlit",baseChance:0,coinMultiplier:2,tileRef:tn.Dawnlit},Amberlit:{name:"Amberlit",baseChance:0,coinMultiplier:5,tileRef:tn.Amberlit},Dawncharged:{name:"Dawnbound",baseChance:0,coinMultiplier:3,tileRef:tn.Dawncharged},Ambercharged:{name:"Amberbound",baseChance:0,coinMultiplier:6,tileRef:tn.Ambercharged}},Qt={CommonEgg:{tileRef:pt.CommonEgg,name:"Common Egg",coinPrice:1e5,creditPrice:19,rarity:me.Common,initialTileScale:.3,baseTileScale:.8,secondsToHatch:600,faunaSpawnWeights:{Worm:60,Snail:35,Bee:5}},UncommonEgg:{tileRef:pt.UncommonEgg,name:"Uncommon Egg",coinPrice:1e6,creditPrice:48,rarity:me.Uncommon,initialTileScale:.3,baseTileScale:.8,secondsToHatch:3600,faunaSpawnWeights:{Chicken:65,Bunny:25,Dragonfly:10}},RareEgg:{tileRef:pt.RareEgg,name:"Rare Egg",coinPrice:1e7,creditPrice:99,rarity:me.Rare,initialTileScale:.3,baseTileScale:.8,secondsToHatch:21600,faunaSpawnWeights:{Pig:90,Cow:10}},LegendaryEgg:{tileRef:pt.LegendaryEgg,name:"Legendary Egg",coinPrice:1e8,creditPrice:249,rarity:me.Legendary,initialTileScale:.3,baseTileScale:.8,secondsToHatch:43200,faunaSpawnWeights:{Squirrel:60,Turtle:30,Goat:10}},MythicalEgg:{tileRef:pt.MythicalEgg,name:"Mythical Egg",coinPrice:1e9,creditPrice:599,rarity:me.Mythic,initialTileScale:.3,baseTileScale:.8,secondsToHatch:86400,faunaSpawnWeights:{Butterfly:75,Capybara:5,Peacock:20}}},gt={Worm:{tileRef:pt.Worm,name:"Worm",description:"",coinsToFullyReplenishHunger:500,innateAbilityWeights:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.1,moveProbability:.1,hoursToMature:12,rarity:me.Common,tileTransformOrigin:"bottom",nudgeY:-.25,diet:["Carrot","Strawberry","Aloe","Tomato","Apple"]},Snail:{tileRef:pt.Snail,name:"Snail",description:"",coinsToFullyReplenishHunger:1e3,innateAbilityWeights:{CoinFinderI:100},baseTileScale:.6,maxScale:2,maturitySellPrice:1e4,matureWeight:.15,moveProbability:.01,hoursToMature:12,rarity:me.Common,tileTransformOrigin:"bottom",nudgeY:-.25,diet:["Blueberry","Tomato","Corn","Daffodil","Chrysanthemum"]},Bee:{tileRef:pt.Bee,name:"Bee",coinsToFullyReplenishHunger:1500,innateAbilityWeights:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,maturitySellPrice:3e4,matureWeight:.2,moveProbability:.5,hoursToMature:12,rarity:me.Common,diet:["Strawberry","Blueberry","Daffodil","Lily","Chrysanthemum"]},Chicken:{tileRef:pt.Chicken,name:"Chicken",coinsToFullyReplenishHunger:3e3,innateAbilityWeights:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,maturitySellPrice:5e4,matureWeight:3,moveProbability:.2,hoursToMature:24,rarity:me.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Aloe","Corn","Watermelon","Pumpkin"]},Bunny:{tileRef:pt.Bunny,name:"Bunny",coinsToFullyReplenishHunger:750,innateAbilityWeights:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,maturitySellPrice:75e3,matureWeight:2,moveProbability:.3,hoursToMature:24,rarity:me.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Carrot","Strawberry","Blueberry","OrangeTulip","Apple"]},Dragonfly:{tileRef:pt.Dragonfly,name:"Dragonfly",coinsToFullyReplenishHunger:250,innateAbilityWeights:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,maturitySellPrice:15e4,matureWeight:.2,moveProbability:.7,hoursToMature:24,rarity:me.Uncommon,tileTransformOrigin:"center",diet:["Apple","OrangeTulip","Echeveria"]},Pig:{tileRef:pt.Pig,name:"Pig",coinsToFullyReplenishHunger:5e4,innateAbilityWeights:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,maturitySellPrice:5e5,matureWeight:200,moveProbability:.2,hoursToMature:72,rarity:me.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","Pumpkin","Mushroom","Bamboo"]},Cow:{tileRef:pt.Cow,name:"Cow",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,maturitySellPrice:1e6,matureWeight:600,moveProbability:.1,hoursToMature:72,rarity:me.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Coconut","Banana","BurrosTail","Mushroom"]},Turkey:{tileRef:pt.Turkey,name:"Turkey",coinsToFullyReplenishHunger:500,innateAbilityWeights:{RainDance:60,EggGrowthBoostII_NEW:35,DoubleHatch:5},baseTileScale:1,maxScale:2.5,maturitySellPrice:3e6,matureWeight:10,moveProbability:.25,hoursToMature:72,rarity:me.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["FavaBean","Corn","Squash"]},Squirrel:{tileRef:pt.Squirrel,name:"Squirrel",coinsToFullyReplenishHunger:15e3,innateAbilityWeights:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,maturitySellPrice:5e6,matureWeight:.5,moveProbability:.4,hoursToMature:100,rarity:me.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Banana","Grape"]},Turtle:{tileRef:pt.Turtle,name:"Turtle",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,maturitySellPrice:1e7,matureWeight:150,moveProbability:.05,hoursToMature:100,rarity:me.Legendary,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","BurrosTail","Bamboo","Pepper"]},Goat:{tileRef:pt.Goat,name:"Goat",coinsToFullyReplenishHunger:2e4,innateAbilityWeights:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,maturitySellPrice:2e7,matureWeight:100,moveProbability:.2,hoursToMature:100,rarity:me.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Coconut","Pepper","Camellia","PassionFruit"]},Butterfly:{tileRef:pt.Butterfly,name:"Butterfly",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,maturitySellPrice:5e7,matureWeight:.2,moveProbability:.6,hoursToMature:144,rarity:me.Mythic,tileTransformOrigin:"center",diet:["Daffodil","Lily","Grape","Lemon","Sunflower"]},Capybara:{tileRef:pt.Capybara,name:"Capybara",coinsToFullyReplenishHunger:15e4,innateAbilityWeights:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,maturitySellPrice:2e8,matureWeight:50,moveProbability:.2,hoursToMature:144,rarity:me.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Lemon","PassionFruit","DragonFruit","Lychee"]},Peacock:{tileRef:pt.Peacock,name:"Peacock",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,maturitySellPrice:1e8,matureWeight:5,moveProbability:.2,hoursToMature:144,rarity:me.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Cactus","Sunflower","Lychee"]}},Bt={ProduceScaleBoost:{name:"Crop Size Boost I",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.3,baseParameters:{scaleIncreasePercentage:6}},ProduceScaleBoostII:{name:"Crop Size Boost II",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.4,baseParameters:{scaleIncreasePercentage:10}},DoubleHarvest:{name:"Double Harvest",description:"Chance to duplicate harvested crops",trigger:"harvest",baseProbability:5,baseParameters:{}},DoubleHatch:{name:"Double Hatch",description:"Chance to hatch an extra pet from eggs",trigger:"hatchEgg",baseProbability:3,baseParameters:{}},ProduceEater:{name:"Crop Eater",description:"Harvests non-mutated crops and sells them",trigger:"continuous",baseProbability:60,baseParameters:{cropSellPriceIncreasePercentage:150}},SellBoostI:{name:"Sell Boost I",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:10,baseParameters:{cropSellPriceIncreasePercentage:20}},SellBoostII:{name:"Sell Boost II",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:12,baseParameters:{cropSellPriceIncreasePercentage:30}},SellBoostIII:{name:"Sell Boost III",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:14,baseParameters:{cropSellPriceIncreasePercentage:40}},SellBoostIV:{name:"Sell Boost IV",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:16,baseParameters:{cropSellPriceIncreasePercentage:50}},ProduceRefund:{name:"Crop Refund",description:"Chance to get crops back when selling",trigger:"sellAllCrops",baseProbability:20,baseParameters:{}},PlantGrowthBoost:{name:"Plant Growth Boost I",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:24,baseParameters:{plantGrowthReductionMinutes:3}},PlantGrowthBoostII:{name:"Plant Growth Boost II",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:27,baseParameters:{plantGrowthReductionMinutes:5}},ProduceMutationBoost:{name:"Crop Mutation Boost I",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:10}},ProduceMutationBoostII:{name:"Crop Mutation Boost II",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:15}},PetMutationBoost:{name:"Pet Mutation Boost I",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:7}},PetMutationBoostII:{name:"Pet Mutation Boost II",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:10}},GoldGranter:{name:"Gold Granter",description:"Grants the Gold mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Gold"]}},RainbowGranter:{name:"Rainbow Granter",description:"Grants the Rainbow mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Rainbow"]}},RainDance:{name:"Rain Dance",description:"Grants the Wet mutation to a garden crop",trigger:"continuous",baseProbability:10,baseParameters:{grantedMutations:["Wet"]}},EggGrowthBoost:{name:"Egg Growth Boost I",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:21,baseParameters:{eggGrowthTimeReductionMinutes:7}},EggGrowthBoostII_NEW:{name:"Egg Growth Boost II",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:24,baseParameters:{eggGrowthTimeReductionMinutes:9}},EggGrowthBoostII:{name:"Egg Growth Boost III",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:27,baseParameters:{eggGrowthTimeReductionMinutes:11}},PetAgeBoost:{name:"Hatch XP Boost I",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:50,baseParameters:{bonusXp:8e3}},PetAgeBoostII:{name:"Hatch XP Boost II",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:60,baseParameters:{bonusXp:12e3}},PetHatchSizeBoost:{name:"Max Strength Boost I",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:12,baseParameters:{maxStrengthIncreasePercentage:2.4}},PetHatchSizeBoostII:{name:"Max Strength Boost II",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:14,baseParameters:{maxStrengthIncreasePercentage:3.5}},PetXpBoost:{name:"XP Boost I",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:30,baseParameters:{bonusXp:300}},PetXpBoostII:{name:"XP Boost II",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:35,baseParameters:{bonusXp:400}},HungerRestore:{name:"Hunger Restore I",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:12,baseParameters:{hungerRestorePercentage:30}},HungerRestoreII:{name:"Hunger Restore II",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:14,baseParameters:{hungerRestorePercentage:35}},HungerBoost:{name:"Hunger Boost I",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:12}},HungerBoostII:{name:"Hunger Boost II",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:16}},PetRefund:{name:"Pet Refund I",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:5,baseParameters:{}},PetRefundII:{name:"Pet Refund II",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:7,baseParameters:{}},Copycat:{name:"Copycat",description:"Chance to copy the ability of another active pet",trigger:"continuous",baseProbability:1,baseParameters:{}},CoinFinderI:{name:"Coin Finder I",description:"Finds coins in your garden",trigger:"continuous",baseProbability:35,baseParameters:{baseMaxCoinsFindable:12e4}},CoinFinderII:{name:"Coin Finder II",description:"Finds coins in your garden",trigger:"continuous",baseProbability:13,baseParameters:{baseMaxCoinsFindable:12e5}},CoinFinderIII:{name:"Coin Finder III",description:"Finds coins in your garden",trigger:"continuous",baseProbability:6,baseParameters:{baseMaxCoinsFindable:1e7}},SeedFinderI:{name:"Seed Finder I",description:"Finds common and uncommon seeds in your garden",trigger:"continuous",baseProbability:40,baseParameters:{}},SeedFinderII:{name:"Seed Finder II",description:"Finds rare and legendary seeds in your garden",trigger:"continuous",baseProbability:20,baseParameters:{}},SeedFinderIII:{name:"Seed Finder III",description:"Finds mythical seeds in your garden",trigger:"continuous",baseProbability:10,baseParameters:{}},SeedFinderIV:{name:"Seed Finder IV",description:"Finds divine and celestial seeds in your garden",trigger:"continuous",baseProbability:.01,baseParameters:{}},MoonKisser:{name:"Moon Kisser",description:"Empowers amber moon crops with special mutations",trigger:"continuous",baseParameters:{}},DawnKisser:{name:"Dawn Kisser",description:"Empowers dawn crops with special mutations",trigger:"continuous",baseParameters:{}}},Jt={WateringCan:{tileRef:uo.WateringCan,name:"Watering Can",coinPrice:5e3,creditPrice:2,rarity:me.Common,description:"Speeds up growth of plant by 5 minutes. SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.6,maxInventoryQuantity:99},PlanterPot:{tileRef:uo.PlanterPot,name:"Planter Pot",coinPrice:25e3,creditPrice:5,rarity:me.Common,description:"Extract a plant to your inventory (can be replanted). SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.8},Shovel:{tileRef:uo.Shovel,name:"Garden Shovel",coinPrice:1e6,creditPrice:100,rarity:me.Uncommon,description:"Remove plants from your garden. UNLIMITED USES.",isOneTimePurchase:!0,baseTileScale:.7},RainbowPotion:{tileRef:uo.RainbowPotion,name:"Rainbow Potion",coinPrice:1/0,creditPrice:1/0,rarity:me.Celestial,description:"Adds the Rainbow mutation to a crop in your garden. SINGLE USE.",isOneTimePurchase:!0,baseTileScale:1}},ut={SmallRock:{tileRef:xe.SmallRock,name:"Small Garden Rock",coinPrice:1e3,creditPrice:2,rarity:me.Common,baseTileScale:1,isOneTimePurchase:!1},MediumRock:{tileRef:xe.MediumRock,name:"Medium Garden Rock",coinPrice:2500,creditPrice:5,rarity:me.Common,baseTileScale:1,isOneTimePurchase:!1},LargeRock:{tileRef:xe.LargeRock,name:"Large Garden Rock",coinPrice:5e3,creditPrice:10,rarity:me.Common,baseTileScale:1,isOneTimePurchase:!1},WoodBench:{tileRef:xe.WoodBench,rotationVariants:{90:{tileRef:xe.WoodBenchSideways,flipH:!0,baseTileScale:1.46,nudgeY:-.3},180:{tileRef:xe.WoodBenchBackwards},270:{tileRef:xe.WoodBenchSideways,baseTileScale:1.46,nudgeY:-.3}},name:"Wood Bench",coinPrice:1e4,creditPrice:15,rarity:me.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},WoodArch:{tileRef:xe.WoodArch,rotationVariants:{90:{tileRef:xe.WoodArchSide,flipH:!0,baseTileScale:2.1,nudgeY:-.48},180:{tileRef:xe.WoodArch,flipH:!0},270:{tileRef:xe.WoodArchSide,baseTileScale:2.1,nudgeY:-.48}},name:"Wood Arch",coinPrice:2e4,creditPrice:25,rarity:me.Common,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},WoodBridge:{tileRef:xe.WoodBridge,rotationVariants:{90:{tileRef:xe.WoodBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.WoodBridge,flipH:!0},270:{tileRef:xe.WoodBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Wood Bridge",coinPrice:4e4,creditPrice:35,rarity:me.Common,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},WoodLampPost:{tileRef:xe.WoodLampPost,name:"Wood Lamp Post",coinPrice:8e4,creditPrice:49,rarity:me.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodOwl:{tileRef:xe.WoodOwl,name:"Wood Owl",coinPrice:9e4,creditPrice:59,rarity:me.Common,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},WoodBirdhouse:{tileRef:xe.Birdhouse,name:"Wood Birdhouse",coinPrice:1e5,creditPrice:69,rarity:me.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodWindmill:{tileRef:xe.WoodWindmill,name:"Wood Windmill",coinPrice:5e5,creditPrice:74,rarity:me.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.47},StoneBench:{tileRef:xe.StoneBench,rotationVariants:{90:{tileRef:xe.StoneBenchSideways,flipH:!0,baseTileScale:1.47,nudgeY:-.3},180:{tileRef:xe.StoneBench,flipH:!0},270:{tileRef:xe.StoneBenchSideways,baseTileScale:1.47,nudgeY:-.3}},name:"Stone Bench",coinPrice:1e6,creditPrice:75,rarity:me.Uncommon,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},StoneArch:{tileRef:xe.StoneArch,rotationVariants:{90:{tileRef:xe.StoneArchSideways,flipH:!0,baseTileScale:2.1,nudgeY:-.44},180:{tileRef:xe.StoneArch,flipH:!0},270:{tileRef:xe.StoneArchSideways,baseTileScale:2.1,nudgeY:-.44}},name:"Stone Arch",coinPrice:4e6,creditPrice:124,rarity:me.Uncommon,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},StoneBridge:{tileRef:xe.StoneBridge,rotationVariants:{90:{tileRef:xe.StoneBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.StoneBridge,flipH:!0},270:{tileRef:xe.StoneBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Stone Bridge",coinPrice:5e6,creditPrice:179,rarity:me.Uncommon,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},StoneLampPost:{tileRef:xe.StoneLampPost,name:"Stone Lamp Post",coinPrice:8e6,creditPrice:199,rarity:me.Uncommon,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneGnome:{tileRef:xe.StoneGnome,name:"Stone Gnome",coinPrice:9e6,creditPrice:219,rarity:me.Uncommon,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},StoneBirdbath:{tileRef:xe.StoneBirdBath,name:"Stone Birdbath",coinPrice:1e7,creditPrice:249,rarity:me.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.46},MarbleBench:{tileRef:xe.MarbleBench,rotationVariants:{90:{tileRef:xe.MarbleBenchSideways,flipH:!0,baseTileScale:1.55,nudgeY:-.35},180:{tileRef:xe.MarbleBenchBackwards},270:{tileRef:xe.MarbleBenchSideways,baseTileScale:1.55,nudgeY:-.35}},name:"Marble Bench",coinPrice:75e6,creditPrice:349,rarity:me.Rare,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},MarbleArch:{tileRef:xe.MarbleArch,rotationVariants:{90:{tileRef:xe.MarbleArchSideways,flipH:!0,baseTileScale:2.38,nudgeY:-.57},180:{tileRef:xe.MarbleArch,flipH:!0},270:{tileRef:xe.MarbleArchSideways,baseTileScale:2.38,nudgeY:-.57}},name:"Marble Arch",coinPrice:1e8,creditPrice:399,rarity:me.Rare,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},MarbleBridge:{tileRef:xe.MarbleBridge,rotationVariants:{90:{tileRef:xe.MarbleBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.MarbleBridge,flipH:!0},270:{tileRef:xe.MarbleBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Marble Bridge",coinPrice:15e7,creditPrice:429,rarity:me.Rare,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},MarbleLampPost:{tileRef:xe.MarbleLampPost,name:"Marble Lamp Post",coinPrice:2e8,creditPrice:449,rarity:me.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},MarbleBlobling:{tileRef:xe.MarbleBlobling,name:"Marble Blobling",coinPrice:3e8,creditPrice:499,rarity:me.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.56},MarbleFountain:{tileRef:xe.MarbleFountain,name:"Marble Fountain",coinPrice:45e8,creditPrice:449,rarity:me.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyCottage:{tileRef:xe.MiniFairyCottage,name:"Mini Fairy Cottage",coinPrice:5e8,creditPrice:549,rarity:me.Rare,baseTileScale:1.1,isOneTimePurchase:!1,nudgeY:-.37},Cauldron:{tileRef:xe.Cauldron,name:"Cauldron",coinPrice:666e6,creditPrice:666,rarity:me.Legendary,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.25,expiryDate:new Date("2025-11-07T01:00:00.000Z")},StrawScarecrow:{tileRef:xe.StrawScarecrow,name:"Straw Scarecrow",coinPrice:1e9,creditPrice:599,rarity:me.Legendary,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.65},MiniFairyForge:{tileRef:xe.MiniFairyForge,name:"Mini Fairy Forge",coinPrice:5e9,creditPrice:979,rarity:me.Legendary,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyKeep:{tileRef:xe.MiniFairyKeep,name:"Mini Fairy Keep",coinPrice:25e9,creditPrice:1249,rarity:me.Mythic,baseTileScale:1.05,isOneTimePurchase:!1,nudgeY:-.33},PetHutch:{tileRef:xe.PetHutch,name:"Pet Hutch",coinPrice:8e10,creditPrice:499,rarity:me.Divine,baseTileScale:2.1,isOneTimePurchase:!0,nudgeY:-.45},MiniWizardTower:{tileRef:xe.MiniWizardTower,name:"Mini Wizard Tower",coinPrice:75e9,creditPrice:1379,rarity:me.Mythic,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.59},HayBale:{tileRef:xe.HayBale,rotationVariants:{90:{tileRef:xe.HayBaleSideways,flipH:!0},180:{tileRef:xe.HayBale,flipH:!0},270:{tileRef:xe.HayBaleSideways}},name:"Hay Bale",coinPrice:7e3,creditPrice:12,rarity:me.Common,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.42,expiryDate:new Date("2025-11-07T01:00:00.000Z")},SmallGravestone:{tileRef:xe.SmallGravestone,rotationVariants:{90:{tileRef:xe.SmallGravestoneSideways,flipH:!0,baseTileScale:1.12,nudgeY:-.32},180:{tileRef:xe.SmallGravestone,flipH:!0},270:{tileRef:xe.SmallGravestoneSideways,baseTileScale:1.12,nudgeY:-.32}},name:"Small Gravestone",coinPrice:8e3,creditPrice:12,rarity:me.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.38,expiryDate:new Date("2025-11-07T01:00:00.000Z")},MediumGravestone:{tileRef:xe.MediumGravestone,rotationVariants:{90:{tileRef:xe.MediumGravestoneSideways,flipH:!0,baseTileScale:1.32,nudgeY:-.33},180:{tileRef:xe.MediumGravestone,flipH:!0},270:{tileRef:xe.MediumGravestoneSideways,baseTileScale:1.32,nudgeY:-.33}},name:"Medium Gravestone",coinPrice:5e5,creditPrice:72,rarity:me.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.45,expiryDate:new Date("2025-11-07T01:00:00.000Z")},LargeGravestone:{tileRef:xe.LargeGravestone,rotationVariants:{90:{tileRef:xe.LargeGravestoneSideways,flipH:!0,baseTileScale:1.5,nudgeY:-.39},180:{tileRef:xe.LargeGravestone,flipH:!0},270:{tileRef:xe.LargeGravestoneSideways,baseTileScale:1.5,nudgeY:-.39}},name:"Large Gravestone",coinPrice:5e7,creditPrice:299,rarity:me.Rare,baseTileScale:1.4,isOneTimePurchase:!1,nudgeY:-.51,expiryDate:new Date("2025-11-07T01:00:00.000Z")}},Dr={Rain:{atomValue:"Rain",description:"Gives the Wet mutation to mature garden crops",type:"weather",cycle:{kind:"weather",startWindowMin:20,startWindowMax:35,durationMinutes:5},weightInCycle:.75,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Wet",multiplier:2},{name:"Frozen",multiplier:10,conditional:"applies if crop already has Chilled"}],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:["Wet","Chilled","Frozen"]},screenEffect:"Rain on screen",notes:["Primary vs Snow (75%)","Affecte une culture applicable au hasard"]},Frost:{atomValue:"Frost",description:"Gives the Frozen mutation to mature garden crops",type:"weather",displayName:"Snow",cycle:{kind:"weather",startWindowMin:20,startWindowMax:35,durationMinutes:5},weightInCycle:.25,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Chilled",multiplier:2},{name:"Frozen",multiplier:10,conditional:"applies if crop already has Wet"}],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:["Wet","Chilled","Frozen"]},screenEffect:"Snow on screen",notes:["Secondary vs Rain (25%)","Frozen recommand\xE9 pour champignon/cactus/bambou"]},Sunny:{atomValue:null,description:"No special effects",type:"base",cycle:{kind:"base"},appliesRandomCropPercent:0,conditions:{requiresMature:!1,requiresNoExistingModifier:!1},mutations:[],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:[]},screenEffect:"Blue skies",notes:["\xC9tat par d\xE9faut, aucun effet"]},AmberMoon:{atomValue:"Amber Moon",description:"Gives the Amberglow mutation to mature garden crops",type:"lunar",displayName:"Harvest Moon",cycle:{kind:"lunar",periodMinutes:240,durationMinutes:10},weightInCycle:.33,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Amberglow",multiplier:5}],stacking:{compatible:["Gold","Rainbow"],incompatible:["Dawnlit","Amberlit"]},screenEffect:"Nightfall glow (orange)",notes:["1 fois / 4h","Ne se cumule pas avec Dawnlit"]},Dawn:{atomValue:"Dawn",description:"Gives the Dawnlit mutation to mature garden crops",type:"lunar",cycle:{kind:"lunar",periodMinutes:240,durationMinutes:10},weightInCycle:.67,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Dawnlit",multiplier:2}],stacking:{compatible:["Gold","Rainbow"],incompatible:["Amberlit","Dawnlit"]},screenEffect:"Sunrise glow (purple)",notes:["1 fois / 4h","Ne se cumule pas avec Amberglow"]}},po={img64:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAAHdElNRQfpCR4CFRRuokQwAAAr0ElEQVR42u29eZRlV3Xm+dvn3HvfHENGRE5KSSkJISGExCAJlQFDmRmDmAzGVcY2dIMBYSiXMXZjTA1tL1tgMxZVBparbJahbKAAA2JqxCAJAZKQUGpINKZSyiEyY3zzu8M5u/8490WE2pRRpjIlcOdeK9bKjOHFu/s7Z4/f3gEn5ISckBNyQk7ICTkhJ+SEnJATckJOyAk5ISfkfyPySL+Bo5HXv/7l3H3Pfl78vF/iKRddyGPOOYeoWkF0hBePxFWWl7rccO2NfOfKa7jsvR/lwgvP47rrdj3Sb/1fhrz7fe/i37z6Em697Tsc3P9DDh28AdUFVJU/+N2/sCuHlpLhMK8Mu8uV/mChMvSDys037Y4BUXV0+zdy3/3f4sD+6/nIh/4cVeXfvuz5j/Rj/UT5mbwhl/3n13Ldrd/kta/8Pc7YeTZnnr0DqZ/Nj3ZdNd2q2s3VevWxszOt7Z3F+Vnj3emTE5NbTWwjKFTxaJRIVtDv9YZ76s3mvYV3C/Pzh3Y3qlv3/cE7Ll/85N9cXLTnlauvuoHDyx3mZqd40av+/SP92MDPGCDvf9/bSLOMFz3/+TzmjNP50Ef/Z/S8X/zFUydmaxfUpipPN9Y8oZrEp6DDmcgOK34wT9G+H1O0UT8E70BBo5hoZhYak6jEeK169a0VzarzWbf4UZFxlZfq96+9fvmO57+0Obxn1yG+9oUb2bJtkpf/n+96RHXwMwHI/J4r+dJXvs0zf+lCdp71PG784eUnnTQ79a/rVX1+HPELkc13SDWNJO7hWQaWMTrE9ZYZ3X831VEfozlePMYLXgxs24LZth0vCcZXgAgpHOnhDqQNNfHJi7nZdP3IVj5/eNF/7TGPn9q7fE+fd7/7f/Hc55/HL73k7f//A+SvP/zHDAYZL37xszj5zGdx561fOmtmeuIV1Ur1lRXJHyP5fOTSO8hGd2DrGZW5OdREiMlAPVLkjPbtx66uEnmHN4rxgBryiSbxztMgqiMIKinic4pDh9BDSwgViso0mpzi1W77cS5znx4Us5/YdtYP79xz41ZOe8Jv8/tvfC5/8Vdf/5cPyAff+05+49d/hR/ffhdPfurL+fFNXzx98+zMbzVr0atjWd3pR/dSdG7BD/ciro3RFK3WSE45HanVQTwqiqgnX1qiOLifiivwKKIgClkcE+84FTs1g2LxCCoe0+tQ3LuHOBuFz2FRU0OTk3DJ6Xeksum/zHebnzx7tr10xU1tpuo5Fzz7Tx423diHG4wD917D5OQUJ22Z4sDhzqa6WXrd3OzE+xrVwctltHsqX7wKXbkak95D5PtE3hGpQT1ovYJpVAGDigEMBoPvdLFFgaggIiCCqoCNMc0WWAE83gjGGHQwQEYjDB6MYrzD5Avg7p0R7T6nFfkL2/3o3nOf8Ud7i8PP4rK3v4Bd993H7bcv/csB5A2veglf++YnyLOCsx/3LA7cv/sZp5w898GJqrzR5rvn3NLX8MvXYNN9GBlg8RgsXhSkADyFjYiaE2AtECHE4WOYIsMMowZBEBWsGrwKMjkBcYSoARQjoN5R9HpY9SgSwBWDkGGLtomLxdMj235Be/5ZdIfbbnZuf/a63/tXPOMxp/G3n7nhuOopejjA+PZX/56nP/dXmd9zDYcWVlqV6vWv27q58fbYHdhSrNxI1rmBpDhE4hVUcAogoGAkKNMCvjfErw7wLibtZ2TdlLwzRJdXkE4XfAQWbOSpJAbT8Gi8THTSLFKJAo6imHqNPKnih4pRD7jy91lUADoY19vS0NGf2Vp27p5V3jHxw70HDjb+LfPX7mTrRe88bro67j5kee+P+NJnv8XLXv109ty5f+fO07b9SaXqX2VGt1m38E3M6G5QjxGPqBLMkQ+OgAhxFt/zpCuOfkfpDwyml5OPBqjLsfjyA0TAGUUFrAoeg6/XkU0TVE/aRP3UOarbGkRVT3HwXlhaxAYEEBQAL4ITwahDiCi0xSCf+kZ3OP22fHTnTTcvvYBTJ67iCS/9x58/QD76gXcyN7ONZ73gYlZWhhdNN2sfaMTDi133u7iVq4myZawWKBFeBDUFogWGBM2EUSejO58xmi+g5xHnkMgjFSWJPUlUYK1DbPAFiENFUQS8QdRQOHAF5EVEahvI9CYmzthMY7PFZ4tYV2A0uHfRAKYXg6hHsIiPQQ09P3XjwX719a24ff0737uL5zw54VV/tOfnB5D/+oF3ko4y/t3bL6M7f9MzkkT/W2wOnV0sXwGr1xG5UXkLXFAgwUmTWQYLjv59I7LFEUVeEBlLpeZI6gNsZYhGikGDU6ZUIoLo2CVqeeI9wXMoqAUXURQRI2fwSZXqzCSN7U2iGqg42HBLRT3eaHn3ALX0sqkf7Tucv2br1pkfzV38SX73khrv/+LomOrtuDj1A3u+x/z8Eq+79I/Ze8e3Xzg9HX8k0v2Pyhe+gmlfS+SDzXamCOErBusiskVlefeQ1Ts7+LYnMY7mxID6dJ+4NcRWMowpiNRhANSEkFYFRfDiAY8oqBicmHDaseH7bQFxRpx4Ii0ouj1Gq32MWOJaBWwAV8bgShFuLRaDI7J+a2Lt2bvu7HyndvDLq7/yrk+w7/KPceMBf8x0d8xvyPXfvZw779rHS178ZAbD/F83a/o3ke49JTv0DUznVmLN8RLjRRHJEI1gYGnvGdG+L0WHGdUoJ5nIsI2UyI4QcYhG5YfiUXIjuDhG4hiTRMRJeE0zHBF5JVeHcx4tPHiP8R7FYFTCrREfHHiWMDJKNNOkddIcWosQr1gffJngEQ05jOIppMFqr/qFu64r3nTqjsb+VsUy+fLP/WwC8s7f/23+5D0foXPoB3R6+UUz0/W/Tdh3dnb4cmz3NmJNUaAwQbHWK+mKsHR7m/SQwwhUmhmN1ggTD1FxiAogeAEwEFuo1zBb54i3b8U2W1CpYeIYshF67z7MaICaHHWgmafIMnyek2cO1+4RpTkGRU0wbR6L94JpNameshVTjzE+nHoVDe5JFRXFG493LZb3T3z2+u/Nv6Fel4VsVPC8y67/2QNkYf/3KFJlablz+s4dm/++Hh2+MFu8HOneRKIjVKs441BJsUXM4IBn8ccDXGdEtZJRn8qJajmIw/pwIr0RfGSQeo1kokncqEO1ip+ZId5xMhonIWJVj/EF+f37kaUljLj1qE0NWqki27aQ9YeM9u6H/Qcw/S6G0mdgQjLZqFM5dQumlgCKlxAvGAXw+NIMar/C/bv1b793XfutExNROy2EV37o2oesw2PmQ+687ZuoKsur3Ykzdm55Xy0aPDdf/jKmey2xL0AUZwTEY/OI3n0Zi7f1kL7SbGS0pofE1RQxOUiBE8VFlmiiSW3LHNW5TUStOiQxIlCoYJqTSJygCEYVNcGBF90u1juEEMYKinpFJyZJtm2nctJ24rkZClXy/gDjHK68MTbNcWlGXK8hsQ1HVkL8IYQqgMERxSMiy/lulEzffSC+sh677FfOn+MzN8w/8oD894+8myi2fPQfrjS//PTzfr9Vc5cW3W+La3+H2BUIcQDDZJg8on33iNUf94lSpTHVpTaVIUkWnCiKNwbfrFPdupna5hlso4pGBm8EUER8SB6TJJRSBChvgzEG3+tisxwRRUUQ8agUeCJsYyqUVFotku1bMa06WacHoxQjIXpzeU6e5yT1GiaKUNZwAZEQNJgC27Bih+6Jtp8Vb/jAwpUXn5PoS5+wjX+86dAjC8jnv/h5Tt1e48JzT3vOpsnoPWZ4a71Y+hqx64ZISELiZV1E996UlR/3iHKlMTWiMtlDI1eWMDwuNsSzc9S3bSFu1dHI4oXwGmUSNzYhDo+daCI2ZPOCRSxoPoJ+HxlHTIRipPOCaTaQShJKJWKJpieJWy3c8ipmGEJxb4Qiy/GFI6nVMNYEzAGV0qdh8FZoRCJ+OT//WedP3Pmyxzd3v++K+9m1v/fIAfK5v/8g9VrEcnu0dWaq9uHYHzgrP/xl4vQgkQ9mQI0n8obefsfS7h5RCo2pEfFUHyOCojhxSFKltnUb8dw0xDacxPL3hFB0rOCgIK8OaTaQSg0hBoLZEhTX7YIW4fu9IGJQr5DE2EYNlfDKaiJMPUbU4bp9XJZjFCIVijRDBZJGPZQBkJB4GkU0xqgSJRF+qNW0456w64C76sLTpuZ/82mn87ffve+o9GkeChivveQSilw45YyLadX0txIZPsWtXIukd5VZsysz4ITREiz9uI8ZQW2qQzLVxuAxqjg8vlmldso2kplJxIS3FW7W+CPU1UPCpzijiHNopwveoRpyEFSQSgtfbwQYNZhAEKwWuG4bzV3ISUUR7yGKMDObsNtPwsdNIm8xCtY7sqVlsnYv5DlGEUKwYDS8Lx/lTJyUMFlLz5ypuv+8p51NLrTb/PmLtz38gLzmLS/hqU87l3tv//r5rUb0RhneStG+Ees9qKWwBi8W34elH7fxvYxaY0R1wqFGcMaTWY9p1Zncvo2oVceVd8L8MwFgabmwHly/j+bBX1Bae4kibLNVluj/Pw+bpvjBsLx9Y5AtptkimqhTn5smJUI11F2Nc2QLi2iaw9rhCOV8RfHiiCci6pti6pF7wemT5v945e+9iAMrw4cfkHQofOYzt9iZyYk3VmT5FL/8PSK/gBEQDB4BZ+ncPSRbcNSSnMbEALEZiuDE45oVGtu3YOtV/PiJ1wzV/x4Mo2BQZJTh+wOUMtGTkC9EjSY+rqCUURYg3mALj+92QAu8hMwcjTC1BlKLSDY18M0JchehWIwq0huSL6+GW6XlURFAQulGIkdza42GyeyUHb3lE3/5+fOedu7JfPhXzz5inR61D/ncp97HBU98DGedNXfBVKvyp9q7ua6rP0DIoKwziViy+YLV3UMMSmvTAFsdhWhKFFOt0jhpG7bZWHPcyD+fHAWoQpgrKKrgjcFONEHKxxEQY/DDFB0Ny1xDygQvBAOm1YQ4KfGPQhPLjfDDAZGpMVjqYo1iRYm8J3OOqNnExBEipeEsTaggWBMxms+xuZvCRLz768tfO3nS+CeebLnmnsGD1utR3xBVZcvOZ0ijZv+N8UuzxcouREeEwoQNZYeB0L1riKQZtYkUU8vwodEKsaW6eTNRo4GqrgFh9J//veUlAMBLiHfoDWA0WgNSRcFaTGsCby1aNmtVyoQiG+L7fUKReFwlBmlO4pIq8USCaTXIUwPehpA9zShWe2uRXjB1Uv5fsQ3BbqoSqTBjePmlT51+4nnb65yzKTsivR4VIF/5woc57/zHs/uWb5xZrdZfooN7sOk9iOQYD6IelYTeoZzhUkZSLag2+kjZ5/DGEm2aI9rULE2QIB5M+bAq/5zRYu17XOlZbZbhugPwsgaKF4NtNKAaMm7YELGVHUPyEAR44xD1mKSBqTXQKKM+O0WRR6hacitYD361hy+Ktd8vKhi1wadEnsoMYBxNI5unav517/razXZ//8h6gEcFSJYOOOOsC5idajw3YnSq79wKdFEpCKVviw6F3n0DxCvRZIbEKUZ98CvNOpW5aZwtHeuawkqV6U+p6ZRXRMYtWzzSWYUiBxTjS7JDkmAarUALCj8RSiEo2u+jWYaKQTQQJjAGmZzEGaE6EeErVfI8RjREWEWW4gY9dPwWNOQlHvDiiSfBRmDEMB3nL3zzBdOPO2NCef2TjjMgp57+aHbd9INaox5dQnafMNobohyxZahqGS4OyZZHJBVPVM+D08WjcURtbhqJTSAlBD09AIEHV2CTtRuFKDIaoKMB40gLFVQE22rhbRzCYV37KjbPKXrdAL6atTdhG3Wo1DGxEE81GaWGyJeKV4fv9kB1w00MH6gS1yOohHyoGcVbJ1rTL3/VRWdwxxEk7kcHyPZtTNbix1mTPbEY3Ir6dnjYMnHQ3NM+mKLqqTZHRBQYFQojRFNNomYDLSk7x0rUeVynhyrB5pf2Xao1qNcDUOLXIiPrPb7XgaIogwkbfiaKsY0W3ljqrQTnLHiD8SGQyIcpOL92cjaeJWsN0oxQHLFJmEzcL/3fX71x+qUXNI8fILfv/hZTm1vUYvvMyHc2af9ORFJELRI622S9gmzJE8dCXBthNFB0fBKRTE+iNpxI8yDvwoMRQaHbhTwtS/Xl56ME25oszVboIq5FXMMBftgvs4r1H5LWBEUcETcsXiNcEZX1AfBpjktzynAC0fVAxFpBaqX5QpmI/fmzE5subFZrXPa8ieMDyC233sH7/+vllXqjcoGm85hsqTQdpnxzMcMlhwwLKjWPRHkoBhqwzTpRrbqWS+gxvCEAJh2i/QG2LJUjHjUm+JGkslYuGT+2KTJ8ZxW8Xw/fBKRWR+sVpCKYuEKRJes3wXk0zdGy/77RnyCKrQESqgL1KGlMxebi33jyyXQGDy7aOmJALrrgbH752Y/fHCV6vg7vx7q0pGo6hAJfCKNFR6wFca3ASXCkag3VyRZEprTbsgbMMRPNKLptTBHCXG9CNm0qNbTZwCMYNbDmMxR6XchKZZXhN0mEbdUhNpg4Jits2TEsfVMWIq01kzWORUSJY4Mpk9TEJrSs+YVL/+GOSiVOjj0gr/+tl5MN2uTDztn47hYd7QvRiQZAMOBGjqxThL51nEOoWCGVCrZew5WFh+PCrhDF9wf40WiNfSIKGIttTeCNKRUoZU4CZCP8oIdRR4jzgnZts4lUYiQCX1jK/iGioTxf/royQRz//mC2DMEwWmMx1p413ayePLLVYw/IFVdcxc6TT+HUHaeeEWu/6fPDZTIXTpzD4no5OsqRqsNIHpwnEbZehzjecCuUY+rVAS+WOM3QbjucXh+tJXK23kKrNVTLUkrp3I1XXKcLrgggqS1D5gbabGCsg6I8VOKC3r1DBKwPeXoIIsrSvFEUGwqQRokqsu2k6er2k2dqxx6QP3zHWzDN8+n1Bqdq0UHdiEDDCcwRVCkGOXhHlIRStYiCEaJaNfBuN2BwjF1IWQbxuF4XimKtMoyAxBGm0cCVlWQpzaYAbjDAp+kaWS4gGG6VSrQhSAihuqp/oAMc/1PDPfIlPVWAuvGRjvo7tlTyYw/Is575VL7x7S/F1Wr8WM2XEJeWX/GggdExGhSIeGxcJnuqEFlsrbJmqsbX/FibrbGCdTQKhGr8mJEKxmBbE7goKksu65Vbk+ehf+JLsyXhtEutiZrqGqueMhFV1fBcbHydMtJz4zqXRYAq3rYSzp31bR7XOsaAXHf9DyHvxbVatIliFaN5mYOVVDcPfgTGgJScK/BIbJEkClCMMzOOucVae22T5/hOF7xfP7yA1BtorR4I3GVREMA6j3a7ZaZfOm80MCqdZexutGxQiTGoeeBxEg3P5gtZP3QIiQj1xMw8bVsf544xIHv33s89d91dK9JBTYt+SVQuM1UUHGghWKOIKRgXQ0wcIdaslUQ2RInHXBSw6qHXQ4v1HgaA2ISo2QpRH77kPXqs+pCTjEalckMw4DJP0S8wAqbs1Kh6xIwR2vgAAmpwWRhvWAfWMizyCbmsEk3O/nR1HxEg1biGxdaLPK8bl2744TGzQ/BFuCEYt3Y6JbKoHZOaj5/o2m1VSFPcYFD6FV0bO4jqDSSO1g6FBiIJ4hxFr/uAQ1L0RvhBRmxC/Wucp9g4Ck8i8k/egMu05AU7VARnDKlS275FokrlpxcajwgQg8NoYdSn1vuipG7KevcNAqXfeDB5qX6DMVKSmMvXGd+UY47Ohg68K9DOKupcGe6WiqrV0PpkiITEhVoUBusd2uvgc8/Y6KSHh/i8T5RkBD6KosZAHGF0XPGl/Hc4kG5oylKMR9Tiy76NFGW7+FgCIlraJJysRTDA2MhK2W8YH5xAcjbh8z9JfccYkHGzKFB/FN/vo1n+AKw0irATE2FWUSnbBeGGSzrC9wYhWnIwPLAK6jBxgRLY9CKCSZK19y/jFxdwuScfFqiasp0A3uWIel+oPKio8ogAKYoC770TEbfOMA8fHsAIJtbStNp187SBFLBBN8fNh2j5Dy1yXL+LKUlzWlYNTL0OlQpSRoahfxPMFu1V8AVFN2ewb5XYCBIHb2y8xcYGkyTr/HrRMkgAN3S4tMBgELUYdXifYY0fHlqWInsQXv2IAHHqsXG1H0VxXzf86DiiUANSCc4yhIhlvOL9+gmVB9eAOloZeyoRxXqH67TX+iRrtf4khmYDH7ryqBmzKoFBG9Kc0b4ubqlLJfGIDaZNVJBaBYnHvkDXngc15N0CMi0rxyFfz3xBFEV9/cCwGOU//amPqJ310pddQqW1c1CpHeq51Wjtzq5FTgbimpArqLdlpCVo4cB5JDJstKKix9Zsbcxx8IoF3KCPH44wEwkgwUQZi5lo4VbaiMsCMaJ8EC1S3FKf3u2L2Dyj0spDkRLwxhM3GsGPEG69L8EQZ0lXCqQwa0A5lzMqHKm3q1++9p/GAD9JjuiGdLp9vvzV7xft7mBJbaW0qxsOH0qlHuPH6JRqKooiJFI/rRP4UEVDJLpW0/WKLQpcv7f2dVEJfN96Fa1VymDEY8ueh4iS7TnM8K5FksiTVDIoWZUkim02Az9r3GUMWScuh9FKgfUh3/KiFOpIHX44crvzeBM/3HeMAfnmN7/La1/764Xzsou4ihKVii+zcoGoGSOxRYsyGBbweYEWRbj2PjjSjVHXMcNjLQPXUomCRdFeF81TfHnSxQtEFUxrgnFvJESLMVLE9O5ZxHT7VGseseNxN2BqAuq1EEZL6eQBEU+26nG98ZwjiDhGRUHqoyKpTexdco0H9QxHBMjTnnIW3UNXkiTNu72tezW2VISusy/qFqlHuCJMIamA5A43TNeIAevMjWMLyJjCZspet5Y2QoZDfD/0/MNMSDlV1ZwIVKByIMcbKBYLhvtH2KSgUvc4E4Z2vI2JzjgDaTZDxZcQLoeBHs9wIUdTE0jdZaI8ylKyXNpLqV060H1wXvOIAPnIx6+lvTpg4fDqbjFTK74cL1g3WIpJoDpVJSsSVAN1X7yn6A3CzTBjJ3h8oqyfKN7huj2sC2ZmnDOZagXqzbKSWyCpo39XG4Ye01KiJMyqqBd0ZhPJKTswzUlQwYgrY2aPH0QMFoch9wBiB16F4agH4u7sDPO7O+32sQfkox/9KMY0qda37lXZtE/jMY1nvYKqpqA2VyMjQdWUIa/iBgNI8xAmmhCjPVyAGBTt9WCYhpqTKY2sFcxkC2cDS7F334jevMdWCmqNESojRB3exlROPw3bbCHNCTSulJVdxahhuOgoOg4kzE5aFfLcMchzUu+vf/dX7+rNNB4cJ/GIO4ZfuvxbnHzmqxc8je8Rby2nX9fLIiqOymSEbVTICln7FTpMwy0Zf69uSCyPswiKyTJ8r896kB6+IvU6WqmTHoblu4c4IqqTKUncw5siPN/sDNWTd4RoqlZBm40Q0AA+i+nuHyJZWPMxLt8M0wEDhxuZxnV//Wun8YdfWj0+gMSRRVc/QFpEV0q0o1BixrUsU0YcUnG0NlfJsjDqHJy5Uqx2oXDrFBqjDw8kJZNduz3Uu7KCUBY+K1XIWqze2qcY5FQn+lRrgQ7rEdJKleScMzHNBnjFx4q0JlCpIBgGy0q6mIetK86iCKl19IYdMrUH2pm5tptb3vLU49DCBXjt7/wRBw52yYrou0Qzd2vZmtRyFEDV4MXRmKtiajVyFyqeAhS9AXmnt8bSeCCf8AH6e+gIbPiQsuDoRgNcOlpvIosh7zqWb1oiW1Aa1ZzG5ApYB76CqqWyYzvRqdtD08mETqNpNiCp4TOhfX8fRqY0weGV+3lKLx3ivHzvQLd2b7fv+eDVx4nkAHDw0DLbznjmfXk08XVNNpfkABP6H1KOBNSVxo4muY+wPilbqp7R4iqaFuWsnoRcWcsMUc0aifmo7k5ZNhdVhALBbfiSoi7FdbuIEyDGrzqWvnEngzsXiZOCxnSKJiM8DtQTVRMqs5MYK6jxqAHjYiSqYJoNeocLigMZVmPA422BeBj2enRVXQf7pQu3L2Wbph9cyHvUgDzp6a9hOP9ZUlf7jEvOWIUKxpfUGh3nH0p9dgI70aRwimhYn+EHfdJDi5AHWqkXWa+OEjYpGH90EbGUHY7gNWI8wVkX4fxSyRU6bdSNyBaHHPrqbvq7DhBFXWpzbUwywvgEoxafWKpbZ4Of6A2w42fzgLWobdHd00MLyCOPl+Avh5rT7nfJNL695+0VC3249JMPfgXHUY0jbJ7qsXX2VFaGj5qfqnfOs9n+xxrfRoxsoMQIYgxJtcqw10OcxxgNu01GKRInmHp9fahGQjgajElolR4pKuvNL1u+bqDAhUFNU4bgSrqsHLrybordS9SMozE7JG50sN5jfQVnDfHWKezsVCBFRHEwU5hQr3OGxR8dIrt5OexTMR6rwV8uDZdZ6nfpFrW/vvRXVz//2as3cc2eBz9zeFQ35NLf/UtqNctpMzelGk99zFd3dJ2RtT7zuNzqxWGbMfWT5shig/FK7EG9o7ewQL64isnHIzWhLerL3snR1biCUrTcoSJSYCTHUIAB72MG9zgOf/le3J3LVGopjbkhcTXHeov1MU4Uu7lFZW4KZ8NWIHpdfJHiLCARg70dutfdhxTBMiQl0S4tMla6q6Rq9q3m0d99+B9meNb500f8BEcl286+hKVexL7+6VeOkpO+kEdb1zNjxq5EUXFUpxvUt81SWEuBDbcnzxkemKe3/xA6cBiXrG3e8XK00dfYWZeO3IPxMaaIKFYci7t6LN7Ug46n0chpznYx9Q4qjkITBlGEzE1Q3RLorlLygTUd4kdDjBrckmPhqjtIlnPCqJgQ+VA+Wumt0s0cQ2c//farq7tvOez4wBduO6IneEgLzGan6mT5zVkv3fLeSXvK07RYPkUlH3c6Sx15MEJtdhIjMJpfJM5zrHd4yXGLq6y2U6qzc9RmJjGJx0tGoJod2XnRtfTfB7Pnq+R96B7o0r9vSNER4jijOtel2shD9dWHpTVpxVDdeTLJRAN8XnYCAyDioGj3sdEsy9fcjr+7jcXgpcAJxF4YpgOW+ytkGt+7VLQ+9hdPd35/R/jKXUem04c0Fv3Lz7kALSbYefJlB7udX7CRdp4p2jchuolKYDYUHmtVTBKRDsL2BAsY8dhcyVaGjFZT1EfYqIbEZo3FvMZ01AdSbkJhj3JGJISxqEVyQ7astO8dsHRnl/7+ISbz1Bue5qY+SaMNpkA1CTeyElN97Jk0zjs3rAUcDh7QUMMYJBN6t7fpXXsQyS3eKpF6IKIg59DqIZazXAda+8s3vWjxs5/8TsL7v71yxDp9yOW9A7d8HNTRGTUmtkRX/4+a2/2ySLshBAUoN/mMaZpGIV1dZXhwAZMWhBzFYxQKJwyyGLUtqpNNqtMVkkYFm4AkYd79ARTRsbMpwOXg+hmjlYLBUkG2UqBpTiyepO5JGg5bzVA7BCkwPjDbi6kpGuc9muiMUyCqwEobv/duoiIHMcGnaET/fsfCLR3MwJStJ1nb2Xiw3+Pw8v2sUP3WPb3Wq+q2ONzpFvzJFasPPyAA2YEv0lu5hYXl/rlz9T3/s8nd50ZOy4qrR/yGqjBgvCfv9ukfWkT6KeujnMGxaiakI0tWGFxksNUKUk0wlQQTWYyWddZc8alSDB3ZMMcPQQuPkYIkcSS1nKRaYBKHmrBIU8XjBFRiktnNJE96AmbrJlQM1gvkI7K9d2P73RCd+YjsgGdxV5uiH4qplXJCNbeGbtph78ICvVyWFlP51WYkV1Bt8Ft/d3Q7T47Jao2TpjPe/bGYS5695/BAW3cmZM+saDZRTlCUlNINPRABW0lIGjXE5bgsB2cCR1hyiFJs1RNXIDIeshztpriVEflSn2ypR7rYJ1/p4zojSDNir8TVgkoroz45ojoxwNaGaJLibI6Kx5ZLlk2tRrJ1lsqpW7E7diAmLvdjaVgXmGWhy6iG9IBn8ZYu9Mp6g67PivRdxsHleYZ5rsuu8Z43ffa0v3nUXI8v37zAvUd+OY7dDQG455r/yFU/+jG/8caXsvfbl79ma3X5Q7FdbHgpG0Ciaw2ptWUuClJA0WmTLi4E+qcatBykHDeazIYmvPcG9UnZMi5NmPGI8RgZhTDAx6EXQyh2hvl3iyQxyWSLZNMk1COKyBLtOA0zOR3WQIkLowSdIe7efaT39Fi5rYP2xhNZBqsWZ5RMPfNLB1jut+mY5v+az+uvq+BXVlZG/IdvHCUaHMP1TB/462/zoudsRZcGRI3n3WL8gdRTPDWWNJaSwPRAHmxwy2oFU6uQNBtIpYL34J1HfKinSlk9deIDoNZjTIGJHGIcxriwmU5yDDbMnKuUiwQUrMHUayQzm6hunSHa1MRXbDBHTvGxRSabgC1buBbJY/q7Fli+aQE/NGWaWvJ6jcPhmV89zEK/S0+aN8yntTdtqkf7t05GvOFTR78JCI5Dz27fd9/BameZ79w2jJ5z1vzvb50a/XGtOgxcfB+H0Wjc2gkes+dVJICQe4r+CNftUQwGuKKAPDS5xlHVWo6ipty9WNJwjMEZQSJBKpaoXiepNzCNGpLEZW1rTPGMUDW4WoXotJ2YpA5E5L2C1avvZnTt/ZA5nA1jDbacgcmBpfYiS6sLrEpjz6Kf/PVWlF7zm3/3HF746E9w+Z0PTX/HhXPwg8+8gqw/4AffX4ie/fTWG0/dXryrWS1mA0U/DfE9Zi2RHFef1t+ShPJ44fBphg5T/ChHsxx1DjcerlFFxIRhS2vROMFWK9hqgqnESBQWkHlYW9VnSvC8hL2mhTHYHduJpjYzvG/A4lV3kN+1jHVhOYj1ptwi53F4FlfbHOos0CfZt5xW3nD29ujyz9+sbJuO+b8+f+Ah6+64kUC++VfPZHGhyyv/+Fpu+PCzX7Hz1OT9k7Pt7UYyFIu34aRaJ2sktkDVVBRX5hTjZlb5or4EQXXtVihgTGAUrk1FbXxADX7EGV8O49iSHFfuWxRDUd1EZzli9bp9xIeHiAncTOMjYh8c3cA4DrcP02mv0qG+72AxcelbXz77hde+dw+TCbz/6u4x0dtxZeW877dPww0ifu/jX+Wbf/bqF55xevTBLVvdaZVGQWEUVUusRWnz7QaytAs7rsotJWwk1+lP3hS0XrZfF0Noe4+NnDfjGdwQJUkhDBc8q/f2SA8pJq2EZJUwluCJcEZI3YjDq4dZHPQZkdy9nCdvftOv7/zqb//5HYg6PvL9o9v887ADAvCel+1kuZ3ytrdexPdvWHza9un8o6eexNmTm6tINUNNXo4kl6PSKv+0176RhirrDdh/+jBjc7RenJTyE1rW1QwGyWPSFUdnX598f4FLATVlxTZwqsJfWnB08h7zK0v0hhkdJq7tSvOt2xuD73/h5pSKZPy37/8cLFLeKP/P7lVe8OQpfrRrxKO2Ve47tL92fbrsz3Gd/skWJY4bWFMpVzqNz2/Yv+7NWt9qnYIqY4oPa9uD1rYIPaC0sgEQU3Yts4j0sKNzZ5/27X3cYYvNKoAJ61/Hq8qN4PAcHvQ5uHKYflr4Hq1Pz49al05VRrt+cKBCwxR88OqjX+X3iAECcMUtHX7nknP40g2bedrZvf33Ha59xWWulS5m52SLw9hlijWWyErYmVjybNcVrOv+Qca7ssZ1LF37QChBFIyEeUAKKNqO4f05q3cM6N6TUSwKprAgShY5BF8u5bd4I2RpysLqIZY6y/RcvLjqGn96KK+/a6YRHXzN3z2OXZ9f5j995eBx0dVxN1kb5T0v+Ve87XOP5x/ffCt3HDaVJ+zIXzFb6f5BNeLceqTUJoR4LiLeFBM3E2wMxhblVtH1ARkJzOdydpyydWtQ1fB3wVIl73qyZUe6kpN1cnToUR8R/u4IgAfjyr9bFdjqhfcs91dY7C7Tc84PqXy7l9k/e8Nn2t/40Cu2sXUq4ePf3MuX7jl+OnpYARnLR37tPGwc8eInncb39hx41GxifnfaDF+ZaDprxGMiIa4oUUOgFWPrCVHFYGNFIh8iMEz4sx+FwaeefOTJh0o+zCkGOZoqkgnGRWVCF3Yy6lqdIHT0DTDSnPZoldXeKqtpQarRXSMXfeS+YeV/nNFMl+5ZrTBTVd78uYXjrptHBBCAP3/BHFdeu8C/f83F/NW1K/YNF80+ecLkb2xI8fyG5jOiWs5eFIhYDLaMuXwZIpd/1ghKRXvwWs7M25BZi5azhCEkNj5EV4jiREldRn8wYKXfoZcNSVXuHzr7qWXf+tjFO/zt373XUU+ESz91/P/U0SMOCMB/+uVH8aiTJ2gPPOdsa3LF/VHy1M3pkxpV+c2mFM+tUeyMyIi8X1tOoJTb38o9vWFoxq8tzh+bL9ZIa2EYJySFDucKhvmI1XTA6mhENy+K3MW7cxd/uuMrn33rzRfd9qEnXqt33HWIR+9o8Tuf7zysOnlEAdkon7r0KfRSx5mbLE/77GPl68+75Ywojl5YldELWjZ7YhWdsSaYHkGx43E0wjrxMKdRJn2E8oyX8q8kFEqeZfSzNu1sQDfXfOTi/ZmPrumrubyb8a1Xbl06+NWlLewbVWjE8M7PHd3e3X8xgAC84wVn86eXvYgPvvcqzm0Jj56r8OkfHWpsaZpzJmv2KVX6T6nFeoZI5fSKoR6TxRaPiGHMh/SuwLmMzOcMc8/ISTHKtMjzYj4Xs7ejXDc01euGQ66/5R53/3Of4PNDqwVLgxabJzxv++z+R1QHP1OAbJRXzMGnvvjv+O8f/DpTNcMvnLWdX/svX49+8eyZqa3TU6dFpDMu7509UbOn1WJJvHeoqqiqepTM4zv9fB7i26i3Dh/sFweV+v4//dSe4Ydfs4VRKiwsjZieqvKH//jQFugfS/mZBWSjvOWiiMFIufDMKQ71LTMTLTbVPJvjLpP0iHxOPVEadc9qFw63oRDI4ohRNMPhPGFfJyXKCtRYXnPx6fyHy3fx8WuPXcnjWMnPBSA/Td4MfAvYAiTAWcAB4NOP9Bs7ISfkhJyQE3JCTsgJOSEn5ISckJ8D+X8B7L1HlK7Vi1oAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjUtMDktMzBUMDI6MjE6MDgrMDA6MDAu0X64AAAAJXRFWHRkYXRlOm1vZGlmeQAyMDI1LTA5LTMwVDAyOjIxOjA4KzAwOjAwX4zGBAAAACh0RVh0ZGF0ZTp0aW1lc3RhbXAAMjAyNS0wOS0zMFQwMjoyMToyMCswMDowMHlTrsEAAAAASUVORK5CYII="};var IE=new Set(["Gold","Rainbow"]),bs="NoWeatherEffect",sy=t=>{let n=(typeof t=="string"?t:t==null?"":String(t)).trim();if(!n)return"";switch(n.toLowerCase().replace(/[\s_-]+/g,"")){case"gold":return"Gold";case"rainbow":return"Rainbow";case"wet":return"Wet";case"chilled":return"Chilled";case"frozen":return"Frozen";case"dawn":case"dawnlit":case"dawnlight":return"Dawnlit";case"dawnbound":case"dawncharged":case"dawnradiant":return"Dawnbound";case"amberlit":case"amberlight":case"amberglow":case"ambershine":return"Amberlit";case"amberbound":case"ambercharged":case"amberradiant":return"Amberbound";default:return n}},Nd=t=>t===bs?bs:sy(t)||null,Fd=t=>{if(!Array.isArray(t))return[];let e=[];for(let n=0;n<t.length;n++){let r=sy(t[n]);r&&e.push(r)}return e},ay=t=>t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),kE=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=ay(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(De)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})(),or=()=>({isPlant:!1,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:null,sizePercent:null,mutations:[]}),PE=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),LE=(t,e)=>{if(t===e)return!0;if(!t||!e)return(t?.length??0)===(e?.length??0);if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},RE=(t,e)=>t.isPlant===e.isPlant&&t.originalIndex===e.originalIndex&&t.orderedIndex===e.orderedIndex&&t.totalSlots===e.totalSlots&&t.availableSlotCount===e.availableSlotCount&&t.slot===e.slot&&t.seedKey===e.seedKey&&t.sizePercent===e.sizePercent&&LE(t.mutations,e.mutations),iy=t=>!!t&&t.objectType==="plant",_E=t=>{if(!t)return"\u2205";let e=t.species??"",n=Number.isFinite(t.startTime)?t.startTime:0,r=Number.isFinite(t.endTime)?t.endTime:0,o=Number.isFinite(t.targetScale)?t.targetScale:0,s=Array.isArray(t.mutations)?t.mutations.join(","):"";return`${e}|${n}|${r}|${o}|${s}`},Dd=t=>{if(!t)return"\u2205";if(!iy(t))return!t||typeof t!="object"?String(t):`other|${Object.keys(t).sort().map(o=>`${o}:${JSON.stringify(t[o])}`).join(";")}`;let e=`${t.objectType}|${t.species??""}|${t.plantedAt??0}|${t.maturedAt??0}`,n=Array.isArray(t.slots)?t.slots.map(r=>_E(r)).join("||"):"";return`${e}|slots:${n}`},qd=t=>Array.isArray(t)?t.join(","):"\u2205",NE=t=>Array.from({length:t},(e,n)=>n),ty=(t,e,n)=>Math.max(e,Math.min(n,t)),ly=t=>{if(!t||typeof t!="object")return null;if(typeof t.seedKey=="string")return t.seedKey;if(typeof t.species=="string"&&t.species)return t.species;let e=t,n=["seedSpecies","plantSpecies","cropSpecies","speciesId"];for(let r of n){let o=e[r];if(typeof o=="string"&&o)return o}return null},vi=(t,e,n)=>Math.max(e,Math.min(n,t)),DE=t=>{if(typeof t!="string")return null;let e=ay(t.trim());if(!e)return null;let n=kE.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null},qE=t=>{if(!t||typeof t!="object")return null;let e=new Set,n=ly(t);n&&e.add(n);let r=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"];for(let o of r){let s=t[o];typeof s=="string"&&s&&e.add(s)}for(let o of e){let s=DE(o);if(typeof s=="number"&&Number.isFinite(s)&&s>0)return s}return null},cy=t=>{if(!t||typeof t!="object")return 100;let e=Number(t.sizePercent??t.sizePct??t.size??t.percent??t.progressPercent);if(Number.isFinite(e))return vi(Math.round(e),0,100);let n=Number(t.targetScale??t.scale);if(Number.isFinite(n)){let r=qE(t);if(typeof r=="number"&&Number.isFinite(r)&&r>1){let a=50+(Math.max(1,Math.min(r,n))-1)/(r-1)*50;return vi(Math.round(a),50,100)}if(n>1&&n<=2){let s=50+(n-1)/1*50;return vi(Math.round(s),50,100)}let o=Math.round(n*100);return vi(o,0,100)}return 100};function OE(){if(typeof window>"u")return{get:()=>or(),onChange:()=>()=>{},stop(){},recompute(){}};let t=null,e=null,n=qd(e),r=null,o=or(),s=Dd(t),a=new Set,i=()=>{for(let g of a)try{g(o)}catch{}},l=!1,c=()=>{if(m(),l)return;l=!0;let g=()=>{l=!1,m()};typeof globalThis<"u"&&typeof globalThis.queueMicrotask=="function"?globalThis.queueMicrotask(g):typeof Promise<"u"?Promise.resolve().then(g):typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout(g,0):g()};function d(g){return g?Array.isArray(e)&&e.length===g?e.slice():NE(g):[]}function u(g,S){if(!S||!g.length)return 0;let w=Number.isFinite(r)?r:0,x=ty(w,0,S-1),E=g.indexOf(x);return E>=0?E:0}function y(g){return Fd(g)}function h(){let g=ly(t);if(!iy(t))return{isPlant:!1,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:g,sizePercent:null,mutations:[]};let S=Array.isArray(t.slots)?t.slots:[],w=S.length;if(!w)return{isPlant:!0,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:g,sizePercent:null,mutations:[]};let x=d(w),E=[];for(let B of x)Number.isInteger(B)&&B>=0&&B<w&&S[B]!=null&&E.push(B);let T=E.length;if(!T)return{isPlant:!0,originalIndex:null,orderedIndex:null,totalSlots:w,availableSlotCount:0,slot:null,seedKey:g,sizePercent:null,mutations:[]};let A=u(x,w),N=ty(A,0,T-1),H=E[N]??null,C=typeof H=="number"?S[H]??null:null,L=C?cy(C):null,v=C?y(C.mutations):[];return{isPlant:!0,originalIndex:typeof H=="number"?H:null,orderedIndex:N,totalSlots:w,availableSlotCount:T,slot:C??null,seedKey:g,sizePercent:L,mutations:v}}function f(g,S){if(g.length!==S.length)return!1;for(let w=0;w<g.length;w++)if(g[w]!==S[w])return!1;return!0}function p(g,S){return g.isPlant===S.isPlant&&g.originalIndex===S.originalIndex&&g.orderedIndex===S.orderedIndex&&g.totalSlots===S.totalSlots&&g.availableSlotCount===S.availableSlotCount&&g.slot===S.slot&&g.seedKey===S.seedKey&&g.sizePercent===S.sizePercent&&f(g.mutations,S.mutations)}function m(){let g=h();p(g,o)||(o=g,i())}return(async()=>{try{r=await tr.get()}catch{}try{let A=await rr.get();e=Array.isArray(A)?A.slice():null,n=qd(e)}catch{}try{t=await nr.get(),s=Dd(t)}catch{}let g=A=>{let N=Array.isArray(A)?A.slice():null,H=qd(N);return H===n?!1:(e=N,n=H,!0)},S=A=>{let N=Dd(A??null);return N===s?!1:(t=A,s=N,!0)},w=!1,x=null,E=()=>{if(x!=null){if(typeof globalThis<"u"){let A=globalThis.clearTimeout;typeof A=="function"&&A.call(globalThis,x)}x=null}},T=()=>{if(w=!0,x!=null)return;let A=()=>{x=null,w&&(w=!1,c())};if(typeof globalThis<"u"){let N=globalThis.setTimeout;if(typeof N=="function"){x=N.call(globalThis,A,0);return}}A()};rr.onChange(A=>{g(A)&&T()}),nr.onChange(A=>{S(A)&&T()}),tr.onChange(A=>{r=Number.isFinite(A)?A:0,(async()=>{try{g(await rr.get())}catch{}try{S(await nr.get())}catch{}w&&(w=!1,E()),c()})()}),m()})(),{get(){return o},onChange(g){return a.add(g),()=>a.delete(g)},stop(){a.clear()},recompute(){m()}}}function dy(){return{minScalePct:50,maxScalePct:100,scaleLockMode:"RANGE",lockMode:"LOCK",minInventory:91,avoidNormal:!1,includeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[]}}function wi(){return{enabled:!1,settings:dy(),overrides:{}}}var ny="locker.state",un=(t,e,n)=>Math.max(e,Math.min(n,t));function xi(t){let e=dy();e.lockMode=t?.lockMode==="ALLOW"?"ALLOW":"LOCK";let n=t?.scaleLockMode,r=n==="MINIMUM"?"MINIMUM":n==="MAXIMUM"?"MAXIMUM":n==="NONE"?"NONE":"RANGE";e.scaleLockMode=r;let o=Number(t?.minScalePct),s=Number.isFinite(o)?un(Math.round(o),50,100):50,a=Number(t?.maxScalePct),i=Number.isFinite(a)?un(Math.round(a),50,100):100;r==="RANGE"?(i=un(i,51,100),i<=s&&(s>=99?(s=99,i=100):i=un(s+1,51,100))):r==="MAXIMUM"?i=un(i,50,100):r==="MINIMUM"&&(s=un(s,50,100)),e.minScalePct=s,e.maxScalePct=i;let l=Number(t?.minInventory);e.minInventory=Number.isFinite(l)?un(Math.round(l),0,999):91,typeof t?.avoidNormal=="boolean"?e.avoidNormal=t.avoidNormal:e.avoidNormal=t?.includeNormal===!1,e.includeNormal=!e.avoidNormal,e.visualMutations=Array.isArray(t?.visualMutations)?Array.from(new Set(t.visualMutations.filter(d=>IE.has(d)))):[];let c=t?.weatherMode;return e.weatherMode=c==="ALL"||c==="RECIPES"?c:"ANY",e.weatherSelected=Array.isArray(t?.weatherSelected)?Array.from(new Set(t.weatherSelected.map(d=>String(d||"")).filter(Boolean))):[],e.weatherRecipes=Array.isArray(t?.weatherRecipes)?t.weatherRecipes.map(d=>Array.isArray(d)?Array.from(new Set(d.map(u=>String(u||"")).filter(Boolean))):[]).filter(d=>d.length>0):[],e}function FE(t){let e=wi();if(!t||typeof t!="object")return e;if(e.enabled=t.enabled===!0,e.settings=xi(t.settings),e.overrides={},t.overrides&&typeof t.overrides=="object")for(let[n,r]of Object.entries(t.overrides))n&&(e.overrides[n]={enabled:r?.enabled===!0,settings:xi(r?.settings)});return e}function ry(t){return{minScalePct:t.minScalePct,maxScalePct:t.maxScalePct,scaleLockMode:t.scaleLockMode,lockMode:t.lockMode==="ALLOW"?"ALLOW":"LOCK",minInventory:t.minInventory,avoidNormal:t.avoidNormal,includeNormal:t.includeNormal,visualMutations:t.visualMutations.slice(),weatherMode:t.weatherMode,weatherSelected:t.weatherSelected.slice(),weatherRecipes:t.weatherRecipes.map(e=>e.slice())}}function BE(t){let e={};for(let[n,r]of Object.entries(t.overrides))e[n]={enabled:r.enabled,settings:ry(r.settings)};return{enabled:t.enabled,settings:ry(t.settings),overrides:e}}function oy(t){return{isPlant:t.isPlant,originalIndex:t.originalIndex,orderedIndex:t.orderedIndex,totalSlots:t.totalSlots,availableSlotCount:t.availableSlotCount,slot:t.slot,seedKey:t.seedKey,sizePercent:t.sizePercent,mutations:t.mutations.slice()}}function HE(t){let e=Fd(t),n=!1,r=!1,o=[];for(let s=0;s<e.length;s++){let a=String(e[s]||"");a&&(a==="Gold"?n=!0:a==="Rainbow"?r=!0:o.push(a))}return{hasGold:n,hasRainbow:r,weather:o}}var Od=class{constructor(){pe(this,"state",wi());pe(this,"listeners",new Set);pe(this,"slotInfoListeners",new Set);pe(this,"slotWatcher",null);pe(this,"slotWatcherUnsub",null);pe(this,"currentSlotInfo",or());pe(this,"currentSlotHarvestAllowed",null);pe(this,"lastSlotChangeDetectedAt",null);this.load(),this.updateSlotWatcher()}load(){if(typeof window>"u"){this.state=wi();return}try{let e=_e(ny);this.state=FE(e)}catch{this.state=wi()}}save(){if(!(typeof window>"u"))try{Oe(ny,this.state)}catch{}}emit(){if(!this.listeners.size)return;let n={type:"locker-state-changed",state:this.getState()};for(let r of this.listeners)try{r(n)}catch{}}setState(e){this.state=e,this.updateSlotWatcher(),this.save(),this.emit(),this.requestSlotWatcherRecompute(),this.reapplyCurrentSlotInfo()}updateSlotWatcher(){if(this.state.enabled){if(this.slotWatcher||(this.slotWatcher=OE()),this.slotWatcher&&!this.slotWatcherUnsub)try{this.slotWatcherUnsub=this.slotWatcher.onChange(n=>this.handleSlotInfo(n))}catch{this.slotWatcherUnsub=null}try{let n=this.slotWatcher?this.slotWatcher.get():or();this.handleSlotInfo(n,{silent:!0})}catch{this.handleSlotInfo(or(),{silent:!0})}return}this.detachSlotWatcher()}getState(){return BE(this.state)}setGlobalState(e){let n=this.state,r=xi(e.settings),o={enabled:!!e.enabled,settings:r,overrides:{...n.overrides}};this.setState(o)}setOverride(e,n){if(!e)return;let r={enabled:!!n?.enabled,settings:xi(n?.settings)},o={...this.state.overrides,[e]:r};this.setState({...this.state,overrides:o})}removeOverride(e){if(!e||!(e in this.state.overrides))return;let n={...this.state.overrides};delete n[e],this.setState({...this.state,overrides:n})}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}onSlotInfoChange(e){return this.slotInfoListeners.add(e),()=>this.slotInfoListeners.delete(e)}getCurrentSlotSnapshot(){return{info:oy(this.currentSlotInfo),harvestAllowed:this.currentSlotHarvestAllowed,detectedAt:this.lastSlotChangeDetectedAt}}requestSlotWatcherRecompute(){if(this.slotWatcher)try{this.slotWatcher.recompute()}catch{}}detachSlotWatcher(){if(this.slotWatcherUnsub){try{this.slotWatcherUnsub()}catch{}this.slotWatcherUnsub=null}if(this.slotWatcher){try{this.slotWatcher.stop()}catch{}this.slotWatcher=null}this.handleSlotInfo(or(),{silent:!0})}handleSlotInfo(e,n={}){let{silent:r=!1}=n,o=this.currentSlotInfo,s=this.currentSlotHarvestAllowed,a=Fd(e.mutations),i={...e,mutations:a},l=null,c=null,d=null;if(i.isPlant&&i.slot){typeof i.sizePercent=="number"&&Number.isFinite(i.sizePercent)?l=i.sizePercent:l=cy(i.slot);try{c=this.assessHarvest({seedKey:i.seedKey??null,sizePercent:l??0,mutations:a}).allowed}catch{c=null}}else l=typeof i.sizePercent=="number"&&Number.isFinite(i.sizePercent)?i.sizePercent:null,c=null;typeof l=="number"&&(d=Math.max(50,Math.min(100,l))),this.currentSlotInfo=i,this.currentSlotHarvestAllowed=c,r||(i.isPlant?i.slot?console.log("[Locker] Slot selection",{seedKey:i.seedKey??null,slotIndex:i.originalIndex,orderedIndex:i.orderedIndex,sizePercent:l,displaySizePercent:d,harvestAllowed:c,mutations:a,slot:i.slot}):console.log("[Locker] Slot selection",{isPlant:!0,slotIndex:i.originalIndex,orderedIndex:i.orderedIndex,totalSlots:i.totalSlots,availableSlotCount:i.availableSlotCount,seedKey:i.seedKey??null,displaySizePercent:d,slot:i.slot}):console.log("[Locker] Slot selection",{isPlant:!1,slot:i.slot}),(!RE(o,i)||(s??null)!==(c??null))&&(this.lastSlotChangeDetectedAt=PE())),this.emitSlotInfoChange()}reapplyCurrentSlotInfo(){try{let e=this.slotWatcher?this.slotWatcher.get():or();this.handleSlotInfo(e,{silent:!0})}catch{this.handleSlotInfo(or(),{silent:!0})}}recomputeCurrentSlot(){this.requestSlotWatcherRecompute(),this.reapplyCurrentSlotInfo()}effectiveSettings(e){if(!this.state.enabled)return{enabled:!1,settings:this.state.settings};if(e){let n=this.state.overrides[e];if(n?.enabled)return{enabled:!0,settings:n.settings}}return{enabled:!0,settings:this.state.settings}}assessHarvest(e){let n=this.effectiveSettings(e.seedKey),r=this.evaluateLockFilters(n.settings,e),o=n.settings.lockMode==="ALLOW"?"ALLOW":"LOCK";if(!n.enabled)return{effective:n,filters:r,lockMode:o,allowed:!0};let s=o==="ALLOW"?r.size.hasCriteria&&!r.size.matched||r.color.hasCriteria&&!r.color.matched||r.weather.hasCriteria&&!r.weather.matched:r.matchAny;return{effective:n,filters:r,lockMode:o,allowed:!s}}evaluateLockFilters(e,n){let r={hasCriteria:!1,matched:!1},o={hasCriteria:!1,matched:!1},s={hasCriteria:!1,matched:!1},a=e.scaleLockMode==="MAXIMUM"?"MAXIMUM":e.scaleLockMode==="MINIMUM"?"MINIMUM":e.scaleLockMode==="NONE"?"NONE":"RANGE",i=un(Math.round(e.minScalePct??50),50,100),l=un(Math.round(e.maxScalePct??100),50,100),c=1e-4,d=null,u=null;if(a==="RANGE"){r.hasCriteria=!0;let T=un(l,51,100),A=T<=i?Math.min(100,Math.max(51,i+1)):T;d=i,u=A;let N=n.sizePercent+c>=i&&n.sizePercent-c<=A;r.matched=N}else if(a==="MINIMUM")r.hasCriteria=!0,d=i,r.matched=n.sizePercent+c>=i;else if(a==="MAXIMUM"){r.hasCriteria=!0;let T=un(l,50,100);u=T,r.matched=n.sizePercent-c<=T}let{hasGold:y,hasRainbow:h,weather:f}=HE(n.mutations),p=!y&&!h,m=e.visualMutations.includes("Gold"),g=e.visualMutations.includes("Rainbow");if([e.avoidNormal?"normal":null,m?"gold":null,g?"rainbow":null].filter(Boolean).length){o.hasCriteria=!0;let T=e.avoidNormal&&p||m&&y||g&&h;o.matched=T}let w=e.weatherSelected??[],x=e.weatherMode??"ANY";if(x==="RECIPES"){let T=e.weatherRecipes??[];if(T.length){s.hasCriteria=!0;let N=!1;for(let H of T){if(!Array.isArray(H)||H.length===0)continue;let C=!0;for(let L=0;L<H.length;L++){let v=H[L],B=Nd(v);if(!B){C=!1;break}if(B===bs){if(f.length!==0){C=!1;break}continue}if(!f.includes(B)){C=!1;break}}if(C){N=!0;break}}s.matched=N}let A=r.matched||o.matched||s.matched;return{size:r,color:o,weather:s,matchAny:A,sizeMin:d,sizeMax:u,scaleMode:a}}if(w.length)if(s.hasCriteria=!0,x==="ALL"){let T=!0;for(let A=0;A<w.length;A++){let N=w[A],H=Nd(N);if(!H){T=!1;break}if(H===bs){if(f.length!==0){T=!1;break}continue}if(!f.includes(H)){T=!1;break}}s.matched=T}else{let T=!1;for(let A=0;A<w.length;A++){let N=w[A],H=Nd(N);if(H){if(H===bs){if(f.length===0){T=!0;break}continue}if(f.includes(H)){T=!0;break}}}s.matched=T}let E=r.matched||o.matched||s.matched;return{size:r,color:o,weather:s,matchAny:E,sizeMin:d,sizeMax:u,scaleMode:a}}emitSlotInfoChange(){if(!this.slotInfoListeners.size)return;let e={type:"locker-slot-info-changed",info:oy(this.currentSlotInfo),harvestAllowed:this.currentSlotHarvestAllowed,detectedAt:this.lastSlotChangeDetectedAt};for(let n of this.slotInfoListeners)try{n(e)}catch{}}allowsHarvest(e){return this.assessHarvest(e).allowed}},xt=new Od;var WE={totalPlanted:!0,totalHarvested:!0,totalDestroyed:!0,watercanUsed:!0,waterTimeSavedMs:!0},zE={seedsBought:!0,decorBought:!0,eggsBought:!0,toolsBought:!0,cropsSoldCount:!0,cropsSoldValue:!1,petsSoldCount:!0,petsSoldValue:!1},GE={triggers:!0,totalValue:!1},jE={triggers:!0},qr=null,Bd=new Set,ln=t=>typeof t=="object"&&t!==null,KE=(t,e=0)=>{let n=Number(t);return Number.isFinite(n)?n:e},Ei=(t,e=0)=>{let n=KE(t,e);return Math.max(0,n)},Nt=(t,e=0)=>{let n=Ei(t,e);return Math.floor(n)},UE=(t,e)=>{let n=Number(t);return!Number.isFinite(n)||n<=0?e:Math.floor(n)},fo=t=>({createdAt:t.createdAt,garden:{...t.garden},shops:{...t.shops},pets:{hatchedByType:Object.fromEntries(Object.entries(t.pets.hatchedByType).map(([e,n])=>[e,{...n}]))},abilities:Object.fromEntries(Object.entries(t.abilities).map(([e,n])=>[e,{...n}])),weather:Object.fromEntries(Object.entries(t.weather).map(([e,n])=>[e,{...n}]))}),uy=t=>{let e=t,n=0;for(;n++<10&&ln(e)&&"snapshot"in e&&ln(e.snapshot);)e=e.snapshot;return e};function Ci(t=Date.now()){let e={};for(let o of Object.keys(gt))e[o.toLowerCase()]={normal:0,gold:0,rainbow:0};let n={};for(let o of Object.keys(Bt))n[o]={triggers:0,totalValue:0};let r={};for(let o of Object.keys(Dr))r[o.toLowerCase()]={triggers:0};return{createdAt:t,garden:{totalPlanted:0,totalHarvested:0,totalDestroyed:0,watercanUsed:0,waterTimeSavedMs:0},shops:{seedsBought:0,decorBought:0,eggsBought:0,toolsBought:0,cropsSoldCount:0,cropsSoldValue:0,petsSoldCount:0,petsSoldValue:0},pets:{hatchedByType:e},abilities:n,weather:r}}function VE(t,e){return ln(t)?{normal:Nt(t.normal,e.normal),gold:Nt(t.gold,e.gold),rainbow:Nt(t.rainbow,e.rainbow)}:{...e}}function py(t){let e=Date.now(),n=Ci(e);if(!ln(t))return n;if(Object.prototype.hasOwnProperty.call(t,"createdAt")&&(n.createdAt=UE(t.createdAt,e)),ln(t.garden)&&(n.garden={totalPlanted:Nt(t.garden.totalPlanted,n.garden.totalPlanted),totalHarvested:Nt(t.garden.totalHarvested,n.garden.totalHarvested),totalDestroyed:Nt(t.garden.totalDestroyed,n.garden.totalDestroyed),watercanUsed:Nt(t.garden.watercanUsed,n.garden.watercanUsed),waterTimeSavedMs:Nt(t.garden.waterTimeSavedMs,n.garden.waterTimeSavedMs)}),ln(t.shops)&&(n.shops={seedsBought:Nt(t.shops.seedsBought,n.shops.seedsBought),decorBought:Nt(t.shops.decorBought,n.shops.decorBought),eggsBought:Nt(t.shops.eggsBought,n.shops.eggsBought),toolsBought:Nt(t.shops.toolsBought,n.shops.toolsBought),cropsSoldCount:Nt(t.shops.cropsSoldCount,n.shops.cropsSoldCount),cropsSoldValue:Ei(t.shops.cropsSoldValue,n.shops.cropsSoldValue),petsSoldCount:Nt(t.shops.petsSoldCount,n.shops.petsSoldCount),petsSoldValue:Ei(t.shops.petsSoldValue,n.shops.petsSoldValue)}),ln(t.pets)&&ln(t.pets.hatchedByType))for(let[r,o]of Object.entries(t.pets.hatchedByType)){if(typeof r!="string")continue;let s=r.toLowerCase(),a=n.pets.hatchedByType[s]??{normal:0,gold:0,rainbow:0};n.pets.hatchedByType[s]=VE(o,a)}if(ln(t.abilities))for(let[r,o]of Object.entries(t.abilities))typeof r!="string"||!ln(o)||(n.abilities[r]={triggers:Nt(o.triggers,n.abilities[r]?.triggers??0),totalValue:Ei(o.totalValue,n.abilities[r]?.totalValue??0)});if(ln(t.weather))for(let[r,o]of Object.entries(t.weather)){if(typeof r!="string"||!ln(o))continue;let s=r.toLowerCase(),a=n.weather[s]??{triggers:0};n.weather[s]={triggers:Nt(o.triggers,a.triggers)}}return n}function my(){if(qr)return fo(qr);let t=_e("stats"),e=uy(t);if(!e){let r=Ci();return qr=fo(r),Oe("stats",qr),r}let n=py(e);return qr=fo(n),t!==e&&Oe("stats",qr),n}function Hd(t){let e=fo(t);for(let n of Bd)try{n(e)}catch(r){console.error("[StatsService] Listener error",r)}}function Wd(t){let e=fo(t);return qr=e,Oe("stats",e),e}function Ss(t,e,n){let r=Number(t),o=Number(e),a=(Number.isFinite(r)?r:0)+(Number.isFinite(o)?o:0),i=Math.max(0,a);return n?Math.floor(i):i}function mo(t){let e=my(),n=JSON.stringify(e),r=fo(e);t(r);let o=JSON.stringify(r);if(n===o)return e;let s=Wd(r);return Hd(s),s}function YE(t,e){return t.abilities[e]||(t.abilities[e]={triggers:0,totalValue:0}),t.abilities[e]}function QE(t,e){let n=e.toLowerCase();return t.weather[n]||(t.weather[n]={triggers:0}),t.weather[n]}function JE(t,e){let n=e.toLowerCase();return t.pets.hatchedByType[n]||(t.pets.hatchedByType[n]={normal:0,gold:0,rainbow:0}),t.pets.hatchedByType[n]}var Fe={storageKey:"stats",getSnapshot(){return my()},setSnapshot(t){let e=py(uy(t)),n=Wd(e);return Hd(n),n},reset(){let t=Ci(),e=Wd(t);return Hd(e),e},update(t){return mo(t)},incrementGardenStat(t,e=1){return mo(n=>{n.garden[t]=Ss(n.garden[t],e,WE[t])})},incrementShopStat(t,e=1){return mo(n=>{n.shops[t]=Ss(n.shops[t],e,zE[t])})},incrementPetHatched(t,e="normal",n=1){return mo(r=>{let o=JE(r,t);o[e]=Ss(o[e],n,!0)})},incrementAbilityStat(t,e,n=1){return mo(r=>{let o=YE(r,t);o[e]=Ss(o[e],n,GE[e])})},incrementWeatherStat(t,e="triggers",n=1){return mo(r=>{let o=QE(r,t);o[e]=Ss(o[e],n,jE[e])})},subscribe(t){return Bd.add(t),()=>{Bd.delete(t)}}},wq={rarityOrder:[me.Common,me.Uncommon,me.Rare,me.Legendary,me.Mythic,me.Divine,me.Celestial],createEmpty(){return Ci()}};var fy="locker.restrictions",vs=t=>Math.max(0,Math.min(50,Math.round(t))),$E=(t,e)=>Math.round(t/e)*e,zd={minRequiredPlayers:1,eggLocks:{},decorPickupLocked:!1},ws=10,Mi=50,gy=t=>{let e=vs(t);return Math.max(0,Math.min(Mi,$E(e,ws)))},Gd=t=>Number.isFinite(t)?Math.max(1,Math.min(6,Math.round(t))):1,ZE=t=>{let e={};if(!t||typeof t!="object")return e;for(let[n,r]of Object.entries(t))n&&(e[n]=r===!0);return e};function Hn(t){let e=Number(t);if(!Number.isFinite(e))return null;if(e<=0)return 0;if(e>0&&e<=2)return vs(Math.round((e-1)*100));let n=Math.max(1,Math.min(6,Math.round(e)));return vs((n-1)*10)}function $t(t){let e=Number(t);if(!Number.isFinite(e))return null;let n=Math.max(1,Math.min(6,Math.round(e)));return vs((n-1)*10)}function xs(t){let e=gy(t);return Math.max(1,Math.min(6,Math.round(e/10)+1))}var yy=t=>gy((Gd(t)-1)*10),jd=class{constructor(){pe(this,"state",{...zd});pe(this,"listeners",new Set);this.load()}load(){if(typeof window>"u"){this.state={...zd};return}try{let e=_e(fy)??{},n=Gd(Number(e?.minRequiredPlayers??e?.minFriendBonusPct)),r=ZE(e?.eggLocks),o=e?.decorPickupLocked===!0;this.state={minRequiredPlayers:n,eggLocks:r,decorPickupLocked:o}}catch{this.state={...zd}}}save(){if(!(typeof window>"u"))try{Oe(fy,this.state)}catch{}}emit(){for(let e of this.listeners)try{e(this.getState())}catch{}}getState(){return{...this.state}}setMinRequiredPlayers(e){let n=Gd(e);n!==this.state.minRequiredPlayers&&(this.state={...this.state,minRequiredPlayers:n},this.save(),this.emit())}setEggLock(e,n){if(!e)return;let r={...this.state.eggLocks,[e]:!!n};this.state={...this.state,eggLocks:r},this.save(),this.emit()}setDecorPickupLocked(e){!!e!==this.state.decorPickupLocked&&(this.state={...this.state,decorPickupLocked:!!e},this.save(),this.emit())}isEggLocked(e){return e?this.state.eggLocks?.[e]===!0:!1}allowsCropSale(e){let n=yy(this.state.minRequiredPlayers);return n<=0?!0:Number.isFinite(e)?vs(Number(e))+1e-4>=n:!1}getRequiredPercent(){return yy(this.state.minRequiredPlayers)}isDecorPickupLocked(){return this.state.decorPickupLocked===!0}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}},mt=new jd;function yo(){let t=(()=>{try{return window.top!==window.self}catch{return!0}})(),e=tC(document.referrer),n=t&&!!e&&/(^|\.)discord(app)?\.com$/i.test(e),r=location.hostname,o=n?"discord":"web",s=/Android|iPhone|iPad|Mobile/i.test(navigator.userAgent)?"mobile":"desktop";return{surface:o,host:r,origin:location.origin,isInIframe:t,platform:s}}function sr(){return yo().surface==="discord"}function XE(t,e="info"){return`${location.origin}/api/rooms/${encodeURIComponent(t)}/${e}`}async function eC(t,e,n=1e4){let r=new AbortController,o=setTimeout(()=>r.abort(),n);try{let s=await fetch(t,{method:"GET",credentials:"include",headers:e,signal:r.signal}),a=await s.text();return{status:s.status,ok:s.ok,body:a}}finally{clearTimeout(o)}}function hy(t,e,n=1e4){return new Promise((r,o)=>{if(typeof GM_xmlhttpRequest!="function"){o(new Error("GM_xmlhttpRequest is not available"));return}GM_xmlhttpRequest({method:"GET",url:t,headers:e,timeout:n,onload:s=>r({status:s.status,ok:s.status>=200&&s.status<300,body:s.responseText}),onerror:s=>o(s),ontimeout:()=>o(new Error("GM_xmlhttpRequest timed out"))})})}async function by(t,e={}){let n=e.endpoint??"info",r=XE(t,n),o={};e.jwt&&(o.Authorization=`Bearer ${e.jwt}`);let s;if(e.preferGM&&typeof GM_xmlhttpRequest=="function")s=await hy(r,o,e.timeoutMs);else try{s=await eC(r,o,e.timeoutMs)}catch(i){if(typeof GM_xmlhttpRequest=="function")s=await hy(r,o,e.timeoutMs);else throw i}let a;try{a=JSON.parse(s.body)}catch{}return{url:r,...s,parsed:a}}function tC(t){if(!t)return null;try{return new URL(t).hostname}catch{return null}}function Sy(t){let e=new URLSearchParams(location.search),n=new URL(location.href);return n.pathname=`/r/${encodeURIComponent(t)}`,n.search=e.toString(),n.toString()}function nC(t){return Sy(t)}function vy(t,e={}){let r=yo().surface==="discord",o=e.preferSoft??!r,s=e.hardIfSoftFails??!0;if(r){if(e.siteFallbackOnDiscord){let l=`https://magiccircle.gg/r/${encodeURIComponent(t)}`;return e.openInNewTab?window.open(l,"_blank","noopener,noreferrer"):location.assign(l),{ok:!0,mode:"site-fallback",url:l,message:"Discord activity does not support room switching by code, redirecting to the official site."}}return{ok:!1,mode:"discord-unsupported",message:"Discord activity does not support joining a room by code. Open the website or use an activity invite."}}let a=Sy(t);if(o){try{let l=new URL(a);if(l.origin===location.origin)return history.replaceState({},"",l.pathname+(l.search||"")+(l.hash||"")),window.dispatchEvent(new PopStateEvent("popstate",{state:{}})),console.log("[joinRoom] soft \u2192",l.toString()),{ok:!0,mode:"soft",url:l.toString()}}catch{}if(!s)return{ok:!1,mode:"noop",url:a,message:"Soft navigation failed because the origins differ."}}let i=nC(t);return console.log("[joinRoom] hard \u2192",i),location.assign(i),{ok:!0,mode:"hard",url:i}}function rC(t){if(hi.forEach)hi.forEach(e=>{try{e.postMessage(t)}catch{}});else for(let e of hi._a)try{e.postMessage(t)}catch{}}function oC(){if(Bn&&Bn.readyState===_t.OPEN)return Bn;let t=null;if(It.find&&(t=It.find(e=>e.readyState===_t.OPEN)||null),!t){for(let e=0;e<It.length;e++)if(It[e].readyState===_t.OPEN){t=It[e];break}}if(t)return _r(t,"getPageWS"),t;throw new Error("No page WebSocket open")}function Xe(t){let e={scopePath:["Room","Quinoa"],...t};try{return oC().send(JSON.stringify(e)),!0}catch{return rC({__QWS_CMD:"send",payload:JSON.stringify(e)}),!0}}function wy(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}function Kd(t,e){let n=t?.tileObjects??{},r=e?.tileObjects??{},o=[],s=[],a=[],i=[],l=new Set;for(let c of Object.keys(r))l.add(c),c in n?wy(n[c])!==wy(r[c])&&(s.push(+c),i.push({kind:"updated",slot:+c,prev:n[c],next:r[c]})):(o.push(+c),i.push({kind:"added",slot:+c,next:r[c]}));for(let c of Object.keys(n))l.has(c)||(a.push(+c),i.push({kind:"removed",slot:+c,prev:n[c]}));return{added:o,updated:s,removed:a,changes:i}}function sC(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",a=Number.isFinite(e.xp)?Math.round(e.xp):0,i=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,l=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,c=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,d=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${o}|xp:${a}|hg:${i}|sc:${l}|m:${n}|a:${r}|pos:${c},${d}`}function Es(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=String(r?.slot?.id??"");o&&e.set(o,sC(r))}return e}function Ud(t,e){let n=[],r=[],o=[],s=[];for(let[a,i]of e)t.has(a)?t.get(a)!==i&&(r.push(a),s.push({kind:"updated",id:a})):(n.push(a),s.push({kind:"added",id:a}));for(let a of t.keys())e.has(a)||(o.push(a),s.push({kind:"removed",id:a}));return{added:n,updated:r,removed:o,changes:s}}function aC(t){let e=Array.isArray(t.mutations)?t.mutations.slice().sort().join(","):"",n=Number.isFinite(t.scale)?Math.round(t.scale*1e3):0;return`${t.species??""}|${t.itemType??""}|${n}|${e}`}function Cs(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=String(r?.id??"");o&&e.set(o,aC(r))}return e}function Vd(t,e){let n=[],r=[],o=[],s=[];for(let[a,i]of e)t.has(a)?t.get(a)!==i&&(r.push(a),s.push({kind:"updated",key:a})):(n.push(a),s.push({kind:"added",key:a}));for(let a of t.keys())e.has(a)||(o.push(a),s.push({kind:"removed",key:a}));return{added:n,updated:r,removed:o,changes:s}}var we={getPosition(){return ce.player.position.get()},onPosition(t){return ce.player.position.onChange(t)},onPositionNow(t){return ce.player.position.onChangeNow(t)},async setPosition(t,e){await ce.player.position.set({x:t,y:e})},async teleport(t,e){try{await this.setPosition(t,e)}catch{}try{Xe({type:"Teleport",position:{x:t,y:e}})}catch{}},async move(t,e){try{await this.setPosition(t,e)}catch{}try{Xe({type:"PlayerPosition",position:{x:t,y:e}})}catch{}},async plantSeed(t,e){try{Xe({type:"PlantSeed",slot:t,species:e})}catch{}},async sellAllCrops(){try{Xe({type:"SellAllCrops"})}catch{}},async sellPet(t){try{Xe({type:"SellPet",itemId:t})}catch{}},async removeGardenObject(t,e){try{Xe({type:"RemoveGardenObject",slot:t,slotType:e})}catch{}},async waterPlant(t){try{Xe({type:"WaterPlant",slot:t})}catch{}},async setSelectedItem(t){try{Xe({type:"SetSelectedItem",itemIndex:t})}catch{}},async pickupObject(){try{Xe({type:"PickupObject"})}catch{}},async dropObject(){try{Xe({type:"DropObject"})}catch{}},async harvestCrop(t,e){try{Xe({type:"HarvestCrop",slot:t,slotsIndex:e})}catch{}},async feedPet(t,e){try{Xe({type:"FeedPet",petItemId:t,cropItemId:e})}catch{}},async hatchEgg(t){try{Xe({type:"HatchEgg",slot:t})}catch{}},async placeDecor(t,e,n,r){try{Xe({type:"PlaceDecor",tileType:t,localTileIndex:e,decorId:n,rotation:r})}catch{}},async swapPet(t,e){try{Xe({type:"SwapPet",petSlotId:t,petInventoryId:e})}catch{}},async placePet(t,e,n,r){try{Xe({type:"PlacePet",itemId:t,position:e,tileType:n,localTileIndex:r})}catch{}},async retrieveItemFromStorage(t,e){try{Xe({type:"RetrieveItemFromStorage",itemId:t,storageId:e})}catch{}},async putItemInStorage(t,e){try{Xe({type:"PutItemInStorage",itemId:t,storageId:e})}catch{}},async petPositions(t){let e=Object.entries(t??{});if(!e.length)return;let n={};for(let[o,s]of e){let a=Number(s?.x),i=Number(s?.y);!Number.isFinite(a)||!Number.isFinite(i)||(n[String(o)]={x:a,y:i})}if(Object.keys(n).length)try{Xe({type:"PetPositions",petPositions:n})}catch{}},async storePet(t){try{Xe({type:"StorePet",itemId:t})}catch{}},async wish(t){try{Xe({type:"Wish",itemId:t})}catch{}},async purchaseSeed(t){try{Xe({type:"PurchaseSeed",species:t})}catch{}},async purchaseDecor(t){try{Xe({type:"PurchaseDecor",decorId:t})}catch{}},async purchaseEgg(t){try{Xe({type:"PurchaseEgg",eggId:t})}catch{}},async purchaseTool(t){try{Xe({type:"PurchaseTool",toolId:t})}catch{}},async triggerAnimation(t,e){ce.player.avatarTriggerAnimationAtom.set({playerId:t,animation:e})},async toggleFavoriteItem(t){try{Xe({type:"ToggleFavoriteItem",itemId:t})}catch{}},async getFavoriteIds(){let t=await ce.inventory.favoriteIds.get();return Array.isArray(t)?t.slice():[]},async getFavoriteIdSet(){return fs()},async isFavoriteItem(t){return(await fs()).has(t)},async ensureFavoriteItem(t,e){let n=await this.isFavoriteItem(t);return n!==e?(await this.toggleFavoriteItem(t),e):n},async ensureFavorites(t,e){let n=await fs();for(let r of t)if(n.has(r)!==e)try{await this.toggleFavoriteItem(r)}catch{}},onFavoriteIdsChange(t){return ms(e=>t(Array.isArray(e)?e:[]))},async onFavoriteIdsChangeNow(t){return bf(e=>t(Array.isArray(e)?e:[]))},onFavoriteSetChange(t){return ms(e=>t(new Set(Array.isArray(e)?e:[])))},async onFavoriteSetChangeNow(t){let e=await fs();return t(e),ms(n=>t(new Set(Array.isArray(n)?n:[])))},async getGardenState(){return await ce.data.garden.get()??null},onGardenChange(t){return ce.data.garden.onChange(t)},onGardenChangeNow(t){return ce.data.garden.onChangeNow(t)},onGardenDiff(t){let e=null;return ce.data.garden.onChange(n=>{let r=Kd(e,n);(r.added.length||r.updated.length||r.removed.length||n!==e)&&(e=n,t(n,r))})},async onGardenDiffNow(t){let e=await ce.data.garden.get()??null;return t(e,Kd(null,e)),ce.data.garden.onChange(n=>{let r=Kd(e,n);(r.added.length||r.updated.length||r.removed.length)&&(e=n,t(n,r))})},async getPets(){let t=await ce.pets.myPetInfos.get();return Array.isArray(t)?t:null},onPetsChange(t){let e=null;return ce.pets.myPetInfos.onChange(n=>{n!==e&&(e=n,t(e))})},async onPetsChangeNow(t){let e=await this.getPets();return t(e),ce.pets.myPetInfos.onChange(n=>{n!==e&&(e=n,t(e))})},onPetsDiff(t){let e=Es(null);return ce.pets.myPetInfos.onChange(n=>{let r=Es(n),o=Ud(e,r);(o.added.length||o.updated.length||o.removed.length)&&(t(n,o),e=r)})},async onPetsDiffNow(t){let e=await this.getPets(),n=Es(null),r=Es(e),o=Ud(n,r);return t(e,o),n=r,ce.pets.myPetInfos.onChange(s=>{r=Es(s);let a=Ud(n,r);(a.added.length||a.updated.length||a.removed.length)&&(t(s,a),n=r)})},async getCropInventoryState(){return ce.inventory.myCropInventory.get()},onCropInventoryChange(t){let e=null;return ce.inventory.myCropInventory.onChange(n=>{n!==e&&(e=n,t(n))})},async onCropInventoryChangeNow(t){let e=await ce.inventory.myCropInventory.get();return t(e),ce.inventory.myCropInventory.onChange(n=>{n!==e&&(e=n,t(n))})},onCropInventoryDiff(t){let e=Cs(null);return ce.inventory.myCropInventory.onChange(n=>{let r=Cs(n),o=Vd(e,r);(o.added.length||o.updated.length||o.removed.length)&&(t(n,o),e=r)})},async onCropInventoryDiffNow(t){let e=await ce.inventory.myCropInventory.get(),n=Cs(null),r=Cs(e),o=Vd(n,r);return t(e,o),n=r,ce.inventory.myCropInventory.onChange(s=>{r=Cs(s);let a=Vd(n,r);(a.added.length||a.updated.length||a.removed.length)&&(t(s,a),n=r)})},async getNumPlayers(){let t=await ce.server.numPlayers.get();return typeof t=="number"?t:0},onNumPlayersChange(t){let e;return ce.server.numPlayers.onChange(n=>{n!==e&&(e=n,t(n))})},async onNumPlayersChangeNow(t){let e=await this.getNumPlayers();return t(e),ce.server.numPlayers.onChange(n=>{n!==e&&(e=n,t(n))})}};var Yd=new Map;function iC(t){try{return Pr(new RegExp("^"+t+"$"))}catch{return[]}}function lC(t){if(t&&typeof t.read=="function")return"read";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="write"&&e!=="onMount"&&e!=="toString"){let r=n.length;if(r===1||r===2)return e}}throw new Error("Impossible de localiser la fonction read() de l'atom")}function cC(t){return Yd.get(t)||null}async function dC(t){!t?.closeAction||!t?.openAction||(await t.closeAction(),await new Promise(e=>setTimeout(e,0)),await t.openAction())}async function uC(t){let e=t.label,n=Yd.get(e);if(n?.installed)return n;let r=iC(t.label);if(!r.length)throw new Error(`${t.label} introuvable`);let o=n??{config:t,enabled:!1,payload:null,patched:new Map,installed:!1},s=null;t.gate?.label&&(s=st(t.gate.label));for(let a of r){let i=lC(a),l=a[i];a[i]=c=>{try{s&&c(s)}catch{}for(let u of t.extraDeps||[])try{let y=st(u);y&&c(y)}catch{}let d=l(c);return!o.enabled||o.payload==null?d:t.merge?t.merge(d,o.payload):o.payload},o.patched.set(a,{readKey:i,orig:l})}return s&&t.gate?.autoDisableOnClose&&(o.unsubGate=await er(s,async()=>{let a;try{a=await Rt(s)}catch{a=null}!(t.gate?.isOpen?t.gate.isOpen(a):!!a)&&o.enabled&&(o.enabled=!1)})),o.installed=!0,Yd.set(e,o),o}async function go(t,e,n){await at();let r=await uC(t);r.payload=e,r.enabled=!0,n?.merge&&!t.merge&&(t.merge=(o,s)=>s),n?.openGate&&t.gate?.openAction&&await t.gate.openAction(),r.autoTimer&&(clearTimeout(r.autoTimer),r.autoTimer=null),n?.autoRestoreMs&&n.autoRestoreMs>0&&(r.autoTimer=setTimeout(()=>{Ms(t.label)},n.autoRestoreMs))}async function Ms(t){let e=cC(t);e&&(e.enabled=!1,e.payload=null,e.autoTimer&&(clearTimeout(e.autoTimer),e.autoTimer=null),await dC(e.config.gate))}async function Ai(t){try{await ce.ui.activeModal.set(t)}catch{}}async function pC(t){try{await ce.ui.activeModal.set(null)}catch{}}function Qd(t,e){return t===e}async function Ti(t){try{let e=await ce.ui.activeModal.get();return Qd(e,t)}catch{return!1}}async function Ii(t,e=12e4){let n=performance.now();for(;performance.now()-n<e;){try{let r=await ce.ui.activeModal.get();if(!Qd(r,t))return!0}catch{return!0}await new Promise(r=>setTimeout(r,80))}return!1}var mC=(t,e)=>({...t&&typeof t=="object"?t:{},...e&&typeof e=="object"?e:{}});var As={label:ce.data.myData.label,merge:mC,gate:{label:ce.ui.activeModal.label,isOpen:t=>t==="inventory"||t==="journal"||t==="stats"||t==="activityLog",autoDisableOnClose:!0}},Jd={label:ce.inventory.myInventory.label,merge:(t,e)=>e,gate:{label:ce.ui.activeModal.label,isOpen:t=>t==="inventory",autoDisableOnClose:!0}},Ts="inventory";async function fC(){return Ai(Ts)}async function ar(){return pC(Ts)}function ki(t){return Qd(t,Ts)}async function Is(){return Ti(Ts)}async function ks(t=12e4){return Ii(Ts,t)}async function Dt(t,e){let n=e?.open!==!1;await go(As,{inventory:t},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),await go(Jd,t,{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await fC()}async function xy(){await Ms(Jd.label),await Ms(As.label),await ar()}var $d="journal";async function yC(){return Ai($d)}async function Ey(){return Ti($d)}async function Cy(t=12e4){return Ii($d,t)}async function Or(t,e){let n=e?.open!==!1;await Ms(Jd.label),await go(As,{journal:t??{}},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await yC()}var Zd="stats";async function gC(){return Ai(Zd)}async function My(){return Ti(Zd)}async function Ay(t=12e4){return Ii(Zd,t)}async function Pi(t,e){let n=e?.open!==!1;await go(As,{stats:t??{}},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await gC()}var ho="activityLog";async function hC(){return Ai(ho)}async function Ty(){return Ti(ho)}async function Iy(t=12e4){return Ii(ho,t)}async function bo(t,e){let n=e?.open!==!1;await go(As,{activityLogs:t??[]},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await hC()}var ky="misc.ghostMode",Py="misc.ghostDelayMs",_i=50,Ly="misc.autoRecoEnabled",Ry="misc.autoRecoDelayMs",bC=3e4,SC=5*6e4,_y=6e4,vC=(t=!1)=>{try{let e=_e(ky);return typeof e=="boolean"?e:e==="1"||e===1?!0:e==="0"||e===0?!1:!!e}catch{return t}},wC=t=>{try{Oe(ky,!!t)}catch{}},Ny=()=>{try{let t=_e(Py),e=Math.floor(Number(t||_i));return Math.max(5,e)}catch{return _i}},Dy=t=>{let e=Math.max(5,Math.floor(t||_i));try{Oe(Py,e)}catch{}},qy=t=>Math.min(SC,Math.max(bC,Math.floor(t||_y))),xC=(t=!1)=>{try{let e=_e(Ly);return typeof e=="boolean"?e:e==="1"||e===1?!0:e==="0"||e===0?!1:!!e}catch{return t}},EC=t=>{try{Oe(Ly,!!t)}catch{}},CC=()=>{try{let t=Number(_e(Ry));if(Number.isFinite(t))return qy(t)}catch{}return _y},MC=t=>{let e=qy(t);try{Oe(Ry,e)}catch{}};function AC(){let t=Ny(),e=new Set,n=f=>{let p=f.key.toLowerCase();(p==="z"||p==="q"||p==="s"||p==="d"||p==="w"||p==="a"||f.key==="ArrowUp"||f.key==="ArrowDown"||f.key==="ArrowLeft"||f.key==="ArrowRight")&&(f.preventDefault(),f.stopImmediatePropagation(),!f.repeat&&e.add(p))},r=f=>{let p=f.key.toLowerCase();(p==="z"||p==="q"||p==="s"||p==="d"||p==="w"||p==="a"||f.key==="ArrowUp"||f.key==="ArrowDown"||f.key==="ArrowLeft"||f.key==="ArrowRight")&&(f.preventDefault(),f.stopImmediatePropagation(),e.delete(p))},o=()=>{e.clear()},s=()=>{document.hidden&&e.clear()};function a(){let f=0,p=0;return(e.has("z")||e.has("w")||e.has("arrowup"))&&(p-=1),(e.has("s")||e.has("arrowdown"))&&(p+=1),(e.has("q")||e.has("a")||e.has("arrowleft"))&&(f-=1),(e.has("d")||e.has("arrowright"))&&(f+=1),f&&(f=f>0?1:-1),p&&(p=p>0?1:-1),{dx:f,dy:p}}let i=null,l=0,c=0,d=!1;async function u(f,p){let m;try{m=await we.getPosition()}catch{}let g=Math.round(m?.x??0),S=Math.round(m?.y??0);try{await we.move(g+f,S+p)}catch{}}let y={capture:!0};function h(f){l||(l=f);let p=f-l;l=f;let{dx:m,dy:g}=a();if(c+=p,m===0&&g===0){c=Math.min(c,t*4),i=requestAnimationFrame(h);return}c>=t&&!d&&(c-=t,d=!0,(async()=>{try{await u(m,g)}finally{d=!1}})()),c=Math.min(c,t*4),i=requestAnimationFrame(h)}return{start(){i===null&&(l=0,c=0,d=!1,window.addEventListener("keydown",n,y),window.addEventListener("keyup",r,y),window.addEventListener("blur",o),document.addEventListener("visibilitychange",s),i=requestAnimationFrame(h))},stop(){i!==null&&(cancelAnimationFrame(i),i=null),e.clear(),window.removeEventListener("keydown",n,y),window.removeEventListener("keyup",r,y),window.removeEventListener("blur",o),document.removeEventListener("visibilitychange",s)},setSpeed(f){let p=Math.max(5,Math.floor(f||_i));t=p,Dy(p)},getSpeed(){return t}}}var Ht=new Map,Li=new Map,So=[],Wt=new Map,Ri=new Map,Fr=[],Xd=null,Ps=!1,lr=!1,cr=null,TC=new Intl.NumberFormat("en-US"),ir=t=>TC.format(Math.max(0,Math.floor(t||0)));async function Hi(){try{await ce.inventory.mySelectedItemName.set(null)}catch{}try{await ce.inventory.myValidatedSelectedItemIndex.set(null)}catch{}try{await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(null)}catch{}}var Ns="qws-seeddeleter-overlay",Oy="qws-seeddeleter-list",Fy="qws-seeddeleter-summary",wo="qws-decordeleter-overlay",By="qws-decordeleter-list",Hy="qws-decordeleter-summary";function eu(t){return new Promise(e=>setTimeout(e,t))}function IC(){let t=new Map;try{let e=De;for(let n of Object.keys(e||{})){let r=e?.[n]?.seed?.name&&String(e?.[n]?.seed?.name)||`${n} Seed`,o=t.get(r)??[];o.push(n),t.set(r,o)}}catch{}return t}async function kC(){let t=await zi(),e=new Map;for(let n of t){let r=Math.max(0,Math.floor(n.quantity||0));r>0&&e.set(n.species,(e.get(n.species)??0)+r)}return e}function PC(t,e,n){let r=Math.max(0,Math.floor(t.qty||0)),o=e.get(t.name)??[];if(!o.length&&/ seed$/i.test(t.name)){let i=t.name.replace(/\s+seed$/i,"");De?.[i]&&(o=[i])}if(!o.length||r<=0)return[];let s=o.map(i=>({sp:i,available:n.get(i)??0})).filter(i=>i.available>0).sort((i,l)=>l.available-i.available),a=[];for(let{sp:i,available:l}of s){if(r<=0)break;let c=Math.min(l,r);c>0&&(a.push({species:i,qty:c}),r-=c)}return a}var tu=null,Ls=!1,dr=!1,ur=null,Wi=35;async function LC(){for(;dr;)await new Promise(t=>{ur=t}),ur=null}async function Wy(t={}){if(Ls){await be("Seed deleter","Deletion already in progress.","info");return}let e=Math.max(0,Math.floor(t.delayMs??Wi)),n=(t.selection&&Array.isArray(t.selection)?t.selection:Array.from(Ht.values())).map(u=>({name:u.name,qty:Math.max(0,Math.floor(u.qty||0))})).filter(u=>u.qty>0);if(n.length===0){await be("Seed deleter","No seeds selected.","info");return}let r=IC(),o=await kC(),s=new Map,a=0,i=0;for(let u of n){a+=u.qty;let y=PC(u,r,o),h=y.reduce((f,p)=>f+p.qty,0);i+=h;for(let f of y)s.set(f.species,(s.get(f.species)??0)+f.qty)}if(i<=0){await be("Seed deleter","Nothing to delete (not in inventory).","info");return}i<a&&await be("Seed deleter",`Requested ${ir(a)} but only ${ir(i)} available. Proceeding.`,"info");let l=Array.from(s.entries()).map(([u,y])=>({species:u,qty:Math.max(0,Math.floor(y||0))})).filter(u=>u.qty>0),c=l.reduce((u,y)=>u+y.qty,0);if(c<=0){await be("Seed deleter","Nothing to delete.","info");return}Ls=!0;let d=new AbortController;tu=d;try{await be("Seed deleter",`Deleting ${ir(c)} seeds across ${l.length} species...`,"info");let u=0,y=0;for(let h of l){let f=h.qty;for(;f>0;){if(d.signal.aborted)throw new Error("Deletion cancelled.");await oM(),await LC();let p=!1;try{await we.wish(h.species),p=!0}catch{}p&&(y+=1),u+=1,f-=1;try{t.onProgress?.({done:u,total:c,species:h.species,remainingForSpecies:f}),window.dispatchEvent(new CustomEvent("qws:seeddeleter:progress",{detail:{done:u,total:c,species:h.species,remainingForSpecies:f}}))}catch{}e>0&&f>0&&await eu(e)}}t.keepSelection||Ht.clear();try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:done",{detail:{total:c,speciesCount:l.length}}))}catch{}y>0?await be("Seed deleter",`Deleted ${ir(y)} seeds (${l.length} species).`,"success"):await be("Seed deleter","No seeds were deleted (requests failed).","info")}catch(u){let y=u?.message||"Deletion failed.";try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:error",{detail:{message:y}}))}catch{}await be("Seed deleter",y,"error")}finally{Ls=!1,dr=!1,tu=null,ur?.(),ur=null}}function RC(){try{dr=!1,ur?.(),ur=null,tu?.abort()}catch{}}function _C(){return Ls}function NC(){if(!(!Ls||dr)){dr=!0;try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:paused"))}catch{}}}function DC(){if(dr){dr=!1,ur?.(),ur=null;try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:resumed"))}catch{}}}function qC(){return dr}try{window.addEventListener("qws:seeddeleter:apply",async t=>{try{let e=Array.isArray(t?.detail?.selection)?t.detail.selection:void 0;await Wy({selection:e,delayMs:35,keepSelection:!1})}catch{}})}catch{}function nu(t){try{let n=De?.[t]?.seed?.name;if(typeof n=="string"&&n)return n}catch{}return`${t} Seed`}function OC(t,e){if(!t||typeof t!="object")return null;let n=typeof t.species=="string"?t.species.trim():"",r=t.itemType==="Seed"?"Seed":null,o=Number.isFinite(t.quantity)?Math.max(0,Math.floor(t.quantity)):0;return!n||r!=="Seed"||o<=0?null:{species:n,itemType:"Seed",quantity:o,id:`seed:${n}`}}async function zi(){try{let t=await ce.inventory.mySeedInventory.get();if(!Array.isArray(t))return[];let e=[];return t.forEach((n,r)=>{let o=OC(n,r);o&&e.push(o)}),e}catch{return[]}}function zy(t){return{items:t,favoritedItemIds:[]}}function Ni(t){try{let n=ut?.[t]?.name;if(typeof n=="string"&&n)return n}catch{}return t||"Decor"}function FC(t){if(!t||typeof t!="object")return null;let e=typeof t.decorId=="string"?t.decorId.trim():"",n=t.itemType==="Decor"?"Decor":null,r=Number.isFinite(t.quantity)?Math.max(0,Math.floor(t.quantity)):0;return!e||n!=="Decor"||r<=0?null:{decorId:e,itemType:"Decor",quantity:r,id:`decor:${e}`}}async function ru(){try{let t=await ce.inventory.myDecorInventory.get();if(!Array.isArray(t))return[];let e=[];return t.forEach(n=>{let r=FC(n);r&&e.push(r)}),e}catch{return[]}}function BC(t){return{items:t,favoritedItemIds:[]}}function it(t,e){Object.assign(t.style,e)}function Gy(t,e){t.id=e,it(t,{position:"fixed",left:"12px",top:"12px",zIndex:"999999",display:"grid",gridTemplateRows:"auto auto 1px 1fr auto",gap:"6px",minWidth:"320px",maxWidth:"420px",maxHeight:"52vh",padding:"8px",border:"1px solid #39424c",borderRadius:"10px",background:"rgba(22,27,34,0.92)",boxShadow:"0 10px 30px rgba(0,0,0,0.35)",backdropFilter:"blur(2px)",userSelect:"none",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial",fontSize:"12px",lineHeight:"1.25"}),t.dataset.qwsSeedDeleter="1"}function jy(t,e){let n=!1,r=0,o=0,s=l=>{n=!0;let c=t.getBoundingClientRect();r=l.clientX-c.left,o=l.clientY-c.top,document.addEventListener("mousemove",a),document.addEventListener("mouseup",i,{once:!0})},a=l=>{if(!n)return;let c=Math.max(4,l.clientX-r),d=Math.max(4,l.clientY-o);t.style.left=`${c}px`,t.style.top=`${d}px`},i=()=>{n=!1,document.removeEventListener("mousemove",a)};e.addEventListener("mousedown",s)}function vo(t,e){let n=document.createElement("button");return n.textContent=t,it(n,{padding:"4px 8px",borderRadius:"8px",border:"1px solid #4446",background:"#161b22",color:"#E7EEF7",cursor:"pointer",fontWeight:"600",fontSize:"12px",...e}),n.onmouseenter=()=>n.style.borderColor="#6aa1",n.onmouseleave=()=>n.style.borderColor="#4446",n}var Di=!1;function HC(t){return!!(t&&(t.closest?.(`#${Ns}`)||t.closest?.(`#${wo}`)))}function Ky(t){let e=document.activeElement;if(!HC(e))return;let n=(e?.tagName||"").toLowerCase();(n==="input"||n==="textarea"||e&&e.isContentEditable)&&/^[0-9]$/.test(t.key)&&t.stopImmediatePropagation()}function Uy(){Di||(window.addEventListener("keydown",Ky,{capture:!0}),Di=!0)}function Vy(){Di&&(window.removeEventListener("keydown",Ky,{capture:!0}),Di=!1)}async function Yy(){try{await xy()}catch{try{document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))}catch{}}}function WC(){let t=document.createElement("div");Gy(t,Ns);let e=document.createElement("div");it(e,{display:"flex",alignItems:"center",gap:"4px",cursor:"move"});let n=document.createElement("div");n.textContent="\u{1F3AF} Selection mode",it(n,{fontWeight:"700",fontSize:"13px"});let r=document.createElement("div");r.textContent="Click seeds in inventory to toggle selection.",it(r,{opacity:"0.8",fontSize:"11px"});let o=document.createElement("div");it(o,{height:"1px",background:"#2d333b"});let s=document.createElement("div");s.id=Oy,it(s,{minHeight:"44px",maxHeight:"26vh",overflow:"auto",padding:"4px",border:"1px dashed #39424c",borderRadius:"8px",background:"rgba(15,19,24,0.84)",userSelect:"text"});let a=document.createElement("div");it(a,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"});let i=document.createElement("div");i.id=Fy,it(i,{fontWeight:"600"}),i.textContent="Selected: 0 species \xB7 0 seeds";let l=vo("Clear");return l.title="Clear selection",l.onclick=async()=>{Ht.clear(),Gi(),Rs(),await Hi(),await Fi()},Wn=vo("Confirm",{background:"#1F2328CC"}),Wn.disabled=!0,Wn.onclick=async()=>{await Yy()},e.append(n),a.append(i,l,Wn),t.append(e,r,o,s,a),jy(t,e),t}function zC(){if(document.getElementById(Ns))return;let t=WC();document.body.appendChild(t),Uy(),Gi(),Rs()}function GC(){let t=document.getElementById(Ns);t&&t.remove(),document.getElementById(wo)||Vy()}var Wn=null,qi=null,Oi=null;function jC(t){let e=document.createElement("div");it(e,{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"6px",padding:"4px 6px",borderBottom:"1px dashed #2d333b"});let n=document.createElement("div");n.textContent=t.name,it(n,{fontSize:"12px",fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"});let r=document.createElement("div");it(r,{display:"flex",alignItems:"center",gap:"6px"});let o=document.createElement("input");o.type="number",o.min="1",o.max=String(Math.max(1,t.maxQty)),o.step="1",o.value=String(t.qty),o.className="qmm-input",it(o,{width:"68px",height:"28px",border:"1px solid #4446",borderRadius:"8px",background:"rgba(15,19,24,0.90)",padding:"0 8px",fontSize:"12px"});let s=l=>{/^[0-9]$/.test(l.key)&&(l.stopPropagation(),l.stopImmediatePropagation())};o.addEventListener("keydown",s);let a=async()=>{let l=Math.min(t.maxQty,Math.max(1,Math.floor(Number(o.value)||1)));o.value=String(l);let c=Ht.get(t.name);c&&(c.qty=l,Ht.set(t.name,c),Rs(),await Fi())};o.onchange=()=>{a()},o.oninput=()=>{a()};let i=vo("Remove",{background:"transparent"});return i.onclick=async()=>{Ht.delete(t.name),Gi(),Rs(),await Fi()},r.append(o,i),e.append(n,r),e}function Gi(){let t=document.getElementById(Oy);if(!t)return;t.innerHTML="";let e=Array.from(Ht.values()).sort((n,r)=>n.name.localeCompare(r.name));if(e.length===0){let n=document.createElement("div");n.textContent="No seeds selected.",n.style.opacity="0.8",t.appendChild(n);return}for(let n of e)t.appendChild(jC(n))}function KC(){let t=0,e=0;for(let n of Ht.values())t+=1,e+=n.qty;return{species:t,qty:e}}function Rs(){let{species:t,qty:e}=KC(),n=document.getElementById(Fy);n&&(n.textContent=`Selected: ${t} species \xB7 ${ir(e)} seeds`),Wn&&(Wn.textContent="Confirm",Wn.disabled=e<=0,Wn.style.opacity=e<=0?"0.6":"1",Wn.style.cursor=e<=0?"not-allowed":"pointer")}async function Fi(){let t=Array.isArray(So)?So:[],e=new Map;for(let r of t){let o=nu(r.species),s=Math.max(0,Math.floor(r.quantity||0));e.set(o,(e.get(o)??0)+s)}for(let r of Ht.values()){let o=e.get(r.name)??0,s=Math.max(0,Math.floor(r.qty||0));e.set(r.name,Math.max(0,o-s))}let n=[];for(let r of t){let o=nu(r.species),s=e.get(o)??0;if(s<=0)continue;let a=Math.min(s,Math.max(0,Math.floor(r.quantity||0)));a<=0||(n.push({...r,quantity:a}),e.set(o,s-a))}try{await Dt({items:n,favoritedItemIds:[]},{open:!1})}catch{}}async function UC(){if(qi)return;let t=await ce.inventory.mySelectedItemName.onChange(async e=>{let n=(e||"").trim();if(!n)return;let r=Math.max(1,Li.get(n)??1),o=Ht.get(n);o?(o.qty=r,o.maxQty=r,Ht.set(n,o)):Ht.set(n,{name:n,qty:r,maxQty:r}),Gi(),Rs(),await Hi(),await Fi()});qi=typeof t=="function"?t:null}async function VC(){let t=qi;qi=null;try{await t?.()}catch{}}async function YC(){try{let t=await zi();if(!t.length){await be("Seed inventory","No seeds to display.","info");return}await Dt(zy(t),{open:!0})}catch(t){await be("Seed inventory",t?.message||"Failed to open seed inventory.","error")}}async function QC(t){try{t?.(!1),So=await zi(),Li=new Map;for(let e of So){let n=nu(e.species);Li.set(n,Math.max(1,Math.floor(e.quantity||0)))}Ht.clear(),zC(),await UC(),await Dt(zy(So),{open:!0}),await Is()&&await ks()}catch(e){await be("Seed inventory",e?.message||"Failed to open seed selector.","error")}finally{await VC(),GC(),So=[],Li.clear(),t?.(!0)}}function JC(){let t=document.createElement("div");Gy(t,wo);let e=document.createElement("div");it(e,{display:"flex",alignItems:"center",gap:"4px",cursor:"move"});let n=document.createElement("div");n.textContent="Decor selection",it(n,{fontWeight:"700",fontSize:"13px"});let r=document.createElement("div");r.textContent="Click decor in inventory to toggle selection.",it(r,{opacity:"0.8",fontSize:"11px"});let o=document.createElement("div");it(o,{height:"1px",background:"#2d333b"});let s=document.createElement("div");s.id=By,it(s,{minHeight:"44px",maxHeight:"26vh",overflow:"auto",padding:"4px",border:"1px dashed #39424c",borderRadius:"8px",background:"rgba(15,19,24,0.84)",userSelect:"text"});let a=document.createElement("div");it(a,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"});let i=document.createElement("div");i.id=Hy,it(i,{fontWeight:"600"}),i.textContent="Selected: 0 decor \xB7 0 items";let l=vo("Clear");l.title="Clear selection",l.onclick=async()=>{Wt.clear(),ji(),_s(),await Hi(),await Bi()};let c=vo("Confirm",{background:"#1F2328CC"});return c.disabled=!0,c.onclick=async()=>{await Yy()},e.append(n),a.append(i,l,c),t.append(e,r,o,s,a),jy(t,e),t.__btnConfirm=c,t}function $C(){if(document.getElementById(wo))return;let t=JC();document.body.appendChild(t),Uy(),ji(),_s()}function ZC(){let t=document.getElementById(wo);t&&t.remove(),document.getElementById(Ns)||Vy()}function XC(t){let e=document.createElement("div");it(e,{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"6px",padding:"4px 6px",borderBottom:"1px dashed #2d333b"});let n=document.createElement("div");n.textContent=t.name,it(n,{fontSize:"12px",fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"});let r=document.createElement("div");it(r,{display:"flex",alignItems:"center",gap:"6px"});let o=document.createElement("input");o.type="number",o.min="1",o.max=String(Math.max(1,t.maxQty)),o.step="1",o.value=String(t.qty),o.className="qmm-input",it(o,{width:"68px",height:"28px",border:"1px solid #4446",borderRadius:"8px",background:"rgba(15,19,24,0.90)",padding:"0 8px",fontSize:"12px"});let s=l=>{/^[0-9]$/.test(l.key)&&(l.stopPropagation(),l.stopImmediatePropagation())};o.addEventListener("keydown",s);let a=async()=>{let l=Math.min(t.maxQty,Math.max(1,Math.floor(Number(o.value)||1)));o.value=String(l);let c=Wt.get(t.name);c&&(c.qty=l,c.maxQty=Math.max(c.maxQty,l),Wt.set(t.name,c),_s(),await Bi())};o.onchange=()=>{a()},o.oninput=()=>{a()};let i=vo("Remove",{background:"transparent"});return i.onclick=async()=>{Wt.delete(t.name),ji(),_s(),await Bi()},r.append(o,i),e.append(n,r),e}function ji(){let t=document.getElementById(By);if(!t)return;t.innerHTML="";let e=Array.from(Wt.values()).sort((n,r)=>n.name.localeCompare(r.name));if(e.length===0){let n=document.createElement("div");n.textContent="No decor selected.",n.style.opacity="0.8",t.appendChild(n);return}for(let n of e)t.appendChild(XC(n))}function eM(){let t=0,e=0;for(let n of Wt.values())t+=1,e+=n.qty;return{kinds:t,qty:e}}function _s(){let{kinds:t,qty:e}=eM(),n=document.getElementById(Hy);n&&(n.textContent=`Selected: ${t} decor \xB7 ${ir(e)} items`);let o=document.getElementById(wo)?.__btnConfirm;o&&(o.textContent="Confirm",o.disabled=e<=0,o.style.opacity=e<=0?"0.6":"1",o.style.cursor=e<=0?"not-allowed":"pointer")}async function Bi(){let t=Array.isArray(Fr)?Fr:[],e=new Map;for(let r of t){let o=Ni(r.decorId),s=Math.max(0,Math.floor(r.quantity||0));e.set(o,(e.get(o)??0)+s)}for(let r of Wt.values()){let o=e.get(r.name)??0,s=Math.max(0,Math.floor(r.qty||0));e.set(r.name,Math.max(0,o-s))}let n=[];for(let r of t){let o=Ni(r.decorId),s=e.get(o)??0;if(s<=0)continue;let a=Math.min(s,Math.max(0,Math.floor(r.quantity||0)));a<=0||(n.push({...r,quantity:a}),e.set(o,s-a))}try{await Dt({items:n,favoritedItemIds:[]},{open:!1})}catch{}}async function tM(){if(Oi)return;let t=await ce.inventory.mySelectedItemName.onChange(async e=>{let n=(e||"").trim();if(!n)return;let r=Math.max(1,Ri.get(n)??1),o=Array.from(Fr||[]).find(a=>Ni(a.decorId)===n)?.decorId||n,s=Wt.get(n);s?(s.qty=r,s.maxQty=r,Wt.set(n,s)):Wt.set(n,{name:n,qty:r,maxQty:r,decorId:o}),ji(),_s(),await Hi(),await Bi()});Oi=typeof t=="function"?t:null}async function nM(){let t=Oi;Oi=null;try{await t?.()}catch{}}async function rM(){let t=await we.getGardenState(),e=t?.tileObjects||{},n=t?.boardwalkTileObjects||{};for(let r=0;r<200;r++){let o=String(r);if(!(Object.prototype.hasOwnProperty.call(e,o)&&e[o]!=null))return{tileType:"Dirt",index:r}}for(let r=0;r<76;r++){let o=String(r);if(!(Object.prototype.hasOwnProperty.call(n,o)&&n[o]!=null))return{tileType:"Boardwalk",index:r}}return null}var Ds=35;async function oM(){for(;lr;)await new Promise(t=>{cr=t}),cr=null}async function sM(t={}){if(Ps){await be("Decor deleter","Deletion already in progress.","info");return}let e=Math.max(0,Math.floor(t.delayMs??Ds)),n=(t.selection&&Array.isArray(t.selection)?t.selection:Array.from(Wt.values())).map(l=>({name:l.name,decorId:l.decorId,qty:Math.max(0,Math.floor(l.qty||0))})).filter(l=>l.qty>0);if(!n.length){await be("Decor deleter","No decor selected.","info");return}let r=new Map;(await ru()).forEach(l=>{r.set(l.decorId,(r.get(l.decorId)??0)+Math.max(0,Math.floor(l.quantity||0)))});let o=n.map(l=>{let c=r.get(l.decorId)??0,d=Math.min(l.qty,c);return{decorId:l.decorId,qty:d,name:l.name}}).filter(l=>l.qty>0),s=o.reduce((l,c)=>l+c.qty,0);if(s<=0){await be("Decor deleter","Nothing to delete (not in inventory).","info");return}let a=await rM();if(!a){await be("Decor deleter","No empty slot available to delete decor (dirt 0-199, boardwalk 0-75).","error");return}Ps=!0;let i=new AbortController;Xd=i;try{await be("Decor deleter",`Deleting ${ir(s)} decor items across ${o.length} types...`,"info");let l=0;for(let c of o){let d=c.qty;for(;d>0;){if(i.signal.aborted)throw new Error("Deletion cancelled.");try{await we.placeDecor(a.tileType,a.index,c.decorId,0)}catch{}e>0&&await eu(e);try{await we.removeGardenObject(a.index,a.tileType)}catch{}e>0&&await eu(e),l+=1,d-=1;try{t.onProgress?.({done:l,total:s,decorId:c.decorId,remainingForDecor:d}),window.dispatchEvent(new CustomEvent("qws:decordeleter:progress",{detail:{done:l,total:s,decorId:c.decorId,remainingForDecor:d}}))}catch{}}}t.keepSelection||Wt.clear();try{window.dispatchEvent(new CustomEvent("qws:decordeleter:done",{detail:{total:s,decorCount:o.length}}))}catch{}await be("Decor deleter",`Deleted ${ir(s)} decor items (${o.length} types).`,"success")}catch(l){let c=l?.message||"Deletion failed.";try{window.dispatchEvent(new CustomEvent("qws:decordeleter:error",{detail:{message:c}}))}catch{}await be("Decor deleter",c,"error")}finally{Ps=!1,lr=!1,Xd=null,cr?.(),cr=null}}function aM(){try{lr=!1,cr?.(),cr=null,Xd?.abort()}catch{}}function iM(){return Ps}function lM(){if(!(!Ps||lr)){lr=!0;try{window.dispatchEvent(new CustomEvent("qws:decordeleter:paused"))}catch{}}}function cM(){if(lr){lr=!1,cr?.(),cr=null;try{window.dispatchEvent(new CustomEvent("qws:decordeleter:resumed"))}catch{}}}function dM(){return lr}async function uM(t){try{t?.(!1),Fr=await ru(),Ri=new Map;for(let e of Fr){let n=Ni(e.decorId);Ri.set(n,Math.max(1,Math.floor(e.quantity||0)))}Wt.clear(),$C(),await tM(),await Dt(BC(Fr),{open:!0}),await Is()&&await ks()}catch(e){await be("Decor inventory",e?.message||"Failed to open decor selector.","error")}finally{await nM(),ZC(),Fr=[],Ri.clear(),t?.(!0)}}var Ke={readGhostEnabled:vC,writeGhostEnabled:wC,getGhostDelayMs:Ny,setGhostDelayMs:Dy,createGhostController:AC,readAutoRecoEnabled:xC,writeAutoRecoEnabled:EC,getAutoRecoDelayMs:CC,setAutoRecoDelayMs:MC,getMySeedInventory:zi,openSeedInventoryPreview:YC,openSeedSelectorFlow:QC,deleteSelectedSeeds:Wy,cancelSeedDeletion:RC,isSeedDeletionRunning:_C,pauseSeedDeletion:NC,resumeSeedDeletion:DC,isSeedDeletionPaused:qC,getCurrentSeedSelection(){return Array.from(Ht.values())},clearSeedSelection(){Ht.clear()},getMyDecorInventory:ru,openDecorSelectorFlow:uM,deleteSelectedDecor:sM,cancelDecorDeletion:aM,isDecorDeletionRunning:iM,pauseDecorDeletion:lM,resumeDecorDeletion:cM,isDecorDeletionPaused:dM,getCurrentDecorSelection(){return Array.from(Wt.values())},clearDecorSelection(){Wt.clear()}};var Eo=p1(Jy(),1);function pM(t){try{return!t||t.startsWith("blob:")?!1:/\.(png|jpe?g|gif|webp|svg|avif|bmp|ico|ktx2|basis)$/i.test(t)}catch{return!1}}function mM(t){try{return new URL(t,location.href).href}catch{return String(t)}}function xo(t){return decodeURIComponent(t.split("/").pop()||"").replace(/\.[a-z0-9]+$/i,"")}function fM(t){let e=[],n=t.replace(/^\/+/,"").toLowerCase();return/(^|\/)ui\//.test(n)&&e.push("ui"),(/(^|\/)tiles\//.test(n)||/(map|plants|allplants|items|seeds|pets|animations|mutations)\.(png|webp)$/i.test(n))&&e.push("tiles"),e}var yM={Gold:{blendMode:"source-atop",colors:["rgb(255, 215, 0)"],alpha:.7},Rainbow:{blendMode:"color",colors:["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],gradientAngle:130,masked:!0},Wet:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.2},Chilled:{blendMode:"source-atop",colors:["rgb(183, 183, 236)"],alpha:.5},Frozen:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.6},Dawnlit:{blendMode:"source-atop",colors:["rgb(120, 100, 180)"],alpha:.4},Ambershine:{blendMode:"source-atop",colors:["rgb(255, 140, 26)","rgb(230, 92, 26)","rgb(178, 58, 26)"],alpha:.5},Dawncharged:{blendMode:"source-atop",colors:["rgb(100, 80, 160)","rgb(110, 90, 170)","rgb(120, 100, 180)"],alpha:.5},Ambercharged:{blendMode:"source-atop",colors:["rgb(167, 50, 30)","rgb(177, 60, 40)","rgb(187, 70, 50)"],alpha:.5}},su=["Gold","Rainbow","Wet","Chilled","Frozen","Dawnlit","Ambershine","Dawncharged","Ambercharged","Dawnbound","Amberlit","Amberbound"],gM=new Set(["Dawnlit","Ambershine","Dawncharged","Ambercharged"]),au=class{constructor(e=!0){pe(this,"cfg",{skipAlphaBelow:1,blackBelow:8,tolerance:.005,ruleAllplants512:/allplants|mutation-overlays/i});pe(this,"initialized",!1);pe(this,"onAssetCb");pe(this,"onMessageListener");pe(this,"all",new Set);pe(this,"familyAssets",new Map);pe(this,"assetFamilies",new Map);pe(this,"tileCacheBitmap",new Map);pe(this,"tileCacheCanvas",new Map);pe(this,"tileCacheDataURL",new Map);pe(this,"uiCache",new Map);pe(this,"observers",[]);pe(this,"patched",{});pe(this,"blobText",new WeakMap);e&&this.init()}normalizeFamilies(e){let n=new Set;for(let r of e??[]){let o=r?.trim().toLowerCase();o&&n.add(o)}return Array.from(n)}familySet(e){return this.familyAssets.get(e)??new Set}init(e){return e?.config&&Object.assign(this.cfg,e.config),e?.onAsset&&(this.onAssetCb=e.onAsset),this.initialized?(console.debug("[Sprites] SpritesCore d\xE9j\xE0 initialis\xE9",{totals:{all:this.all.size,ui:this.familySet("ui").size,tiles:this.familySet("tiles").size}}),this):(console.debug("[Sprites] Initialisation des sniffers de sprites",{config:this.cfg}),this.onMessageListener=n=>{let r=n.data;r&&r.__awc&&r.url&&this.add(r.url,"worker")},Re.addEventListener("message",this.onMessageListener,!0),this.initialized=!0,console.debug("[Sprites] SpritesCore initialis\xE9",{globals:{hasWindowSprites:!!Re.Sprites}}),this)}destroy(){if(this.initialized){if(this.observers.forEach(e=>{try{e.disconnect()}catch{}}),this.observers=[],this.patched.imgDesc&&(Object.defineProperty(HTMLImageElement.prototype,"src",this.patched.imgDesc),this.patched.imgDesc=void 0),this.patched.setAttr&&(HTMLImageElement.prototype.setAttribute=this.patched.setAttr,this.patched.setAttr=void 0),this.patched.Worker&&(Re.Worker=this.patched.Worker,Re!==Re&&(Re.Worker=this.patched.Worker),this.patched.Worker=void 0),this.patched.Blob&&(Re.Blob=this.patched.Blob,Re!==Re&&(Re.Blob=this.patched.Blob),this.patched.Blob=void 0),this.patched.createObjectURL){let e=Re.URL??URL;e.createObjectURL=this.patched.createObjectURL,Re!==Re&&(URL.createObjectURL=this.patched.createObjectURL),this.patched.createObjectURL=void 0}this.onMessageListener&&(Re.removeEventListener("message",this.onMessageListener,!0),this.onMessageListener=void 0),this.initialized=!1}}lists(){let e={all:[...this.all]};for(let[r,o]of this.familyAssets)e[r]=[...o];let n=r=>{e[r]||(e[r]=[...this.familySet(r)])};return n("tiles"),n("ui"),e}listFamilies(){return[...this.familyAssets.keys()]}listAssetsForFamily(e){let n=e?.trim().toLowerCase();return n?[...this.familySet(n)]:[]}registerKnownAsset(e,n=["tiles"]){return this.addAsset(e,n)}listTilesByCategory(e){return[...this.familySet("tiles")].filter(n=>e.test(n))}listPlants(){let e=new Set(this.listTilesByCategory(/plants/i));for(let n of this.listAllPlants())e.add(n);return[...e]}listAllPlants(){return this.listTilesByCategory(this.cfg.ruleAllplants512)}listItems(){return this.listTilesByCategory(/items/i)}listSeeds(){return this.listTilesByCategory(/seeds/i)}listPets(){return this.listTilesByCategory(/pets/i)}listMap(){return this.listTilesByCategory(/map\.(png|webp)$/i)}async loadUI(){let e=new Map;for(let n of this.familySet("ui")){if(!this.uiCache.has(n)){let r=await this.loadImage(n);this.uiCache.set(n,r)}e.set(xo(n),this.uiCache.get(n))}return e}async loadTiles(e={}){let{mode:n="bitmap",includeBlanks:r=!1,forceSize:o,onlySheets:s}=e,a=new Map,i=[...this.familySet("tiles")],l=s?i.filter(c=>s.test(c)):i;for(let c of l){let d=await this.ensureTilesForUrl(c,{mode:n,includeBlanks:r,forceSize:o});a.set(xo(c),d)}return a}async preloadTilesGradually(e={}){let{mode:n="bitmap",includeBlanks:r=!1,forceSize:o,onlySheets:s,batchSize:a=1,delayMs:i=40,onProgress:l}=e,c=[...this.familySet("tiles")],d=s?c.filter(p=>s.test(p)):c,u=d.length;if(!u)return;let y=Math.max(1,a),h=Math.max(0,i),f=0;for(let p of d)await this.ensureTilesForUrl(p,{mode:n,includeBlanks:r,forceSize:o}),f+=1,l?.(f,u),h>0&&f<u&&f%y===0&&await this.delay(h)}async loadTilesAuto(){return this.loadTiles({mode:"bitmap"})}async loadTiles256(){return this.loadTiles({mode:"bitmap",forceSize:256})}async loadTiles512(){return this.loadTiles({mode:"bitmap",forceSize:512})}getCacheForMode(e){return e==="canvas"?this.tileCacheCanvas:e==="dataURL"?this.tileCacheDataURL:this.tileCacheBitmap}async ensureTilesForUrl(e,n){let r=this.getCacheForMode(n.mode),o=r.get(e);if(o)return o;let s=await this.sliceOne(e,n);return r.set(e,s),s}async delay(e){e<=0||await new Promise(n=>{Re.setTimeout(n,e)})}async getTile(e,n,r="bitmap"){return[...this.familySet("tiles")].find(l=>xo(l)===e)?((await this.loadTiles({mode:r,onlySheets:new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\.(png|webp)$","i")})).get(e)||[]).find(l=>l.index===n)??null:null}async flatTiles(e={}){let n=await this.loadTiles(e),r=[];return n.forEach(o=>r.push(...o)),r}async zipUI(e="ui_assets.zip"){let n=new Eo.default,r=[...this.familySet("ui")],o=0;for(let s of r){try{let a=await this.fetchBlob(s),i=decodeURIComponent(s.split("/").pop()||"").replace(/\?.*$/,"");n.file(i,a)}catch{}++o%10===0&&console.log(`[zipUI] ${o}/${r.length}`)}await this.saveZip(n,e)}async zipTilesAuto(e="tiles_auto.zip"){await this.zipTiles({name:e,mode:"bitmap"})}async zipTiles256(e="tiles_256.zip"){await this.zipTiles({name:e,mode:"bitmap",forceSize:256})}async zipTiles512(e="tiles_512.zip"){await this.zipTiles({name:e,mode:"bitmap",forceSize:512})}async zipAllSprites(e="sprites_all.zip"){let n=new Eo.default,r=n.folder("tiles"),o=n.folder("ui");if(r)for(let s of this.familySet("tiles"))try{let a=await this.sliceOne(s,{mode:"canvas",includeBlanks:!1});if(!a.length)continue;let i=xo(s),l=r.folder(i)??r,c=0;for(let d of a){let u=d.data,y=`tile_${String(++c).padStart(4,"0")}`;try{let h=await new Promise((f,p)=>{u.toBlob(m=>{if(!m){p(new Error("toBlob returned null"));return}f(m)},"image/png")});l.file(`${y}.png`,h)}catch(h){console.warn("[Sprites] Failed to export tile",{url:s,error:h})}}}catch(a){console.warn("[Sprites] Failed to export sheet",{url:s,error:a})}if(o){let s=0;for(let a of this.familySet("ui"))try{let i=await this.fetchBlob(a),c=decodeURIComponent(a.split("/").pop()||"").replace(/\?.*$/,"")||`asset_${String(++s).padStart(4,"0")}.png`;o.file(c,i)}catch(i){console.warn("[Sprites] Failed to export UI asset",{url:a,error:i})}}await this.saveZip(n,e)}async exportFilteredTileset(e){let{tiles:n,filters:r=[],baseName:o,filename:s=`${o}_tiles.zip`}=e,a=new Eo.default,i=0;for(let l of n){let d=this.tileToCanvas(l);for(let y of r){let h=this.applyCanvasFilter(d,y);h&&(d=h)}let u=await new Promise((y,h)=>{d.toBlob(f=>{if(!f){h(new Error("canvas.toBlob returned null"));return}y(f)},"image/png")});a.file(`${o}/tile_${String(++i).padStart(4,"0")}.png`,u),e.onProgress?.(i,n.length)}await this.saveZip(a,s)}async exportAssets(e){let{urls:n,baseName:r,filename:o=`${r}_assets.zip`}=e;if(!n.length)return;let s=new Eo.default,a=s.folder(r)??s,i=0;for(let l of n){i++;try{let c=await this.fetchBlob(l),d=decodeURIComponent(l.split("/").pop()??"");d=d.replace(/\?.*$/,""),d||(d=`asset_${String(i).padStart(4,"0")}.png`),a.file(d,c)}catch(c){console.warn("[Sprites] Failed to fetch asset",{url:l,error:c})}finally{e.onProgress?.(i,n.length)}}await this.saveZip(s,o)}clearCaches(){this.tileCacheBitmap.forEach(e=>e.forEach(n=>n.data.close?.())),this.tileCacheBitmap.clear(),this.tileCacheCanvas.clear(),this.tileCacheDataURL.clear(),this.uiCache.clear()}toCanvas(e){return this.tileToCanvas(e)}applyCanvasFilter(e,n){let r=yM[n];if(!r)return null;let o=e.width,s=e.height,a=document.createElement("canvas");a.width=o,a.height=s;let i=a.getContext("2d");if(i.imageSmoothingEnabled=!1,i.drawImage(e,0,0),i.save(),i.globalCompositeOperation=r.blendMode,r.alpha!=null&&(i.globalAlpha=r.alpha),r.masked){let l=document.createElement("canvas");l.width=o,l.height=s;let c=l.getContext("2d");this.drawGradient(c,o,s,r),c.globalCompositeOperation="destination-in",c.drawImage(e,0,0),c.globalCompositeOperation="source-over",i.drawImage(l,0,0)}else this.drawGradient(i,o,s,r);return i.restore(),a}applySpriteFilter(e,n){let r=this.tileToCanvas(e);return this.applyCanvasFilter(r,n)}renderPlantWithMutationsNonTall(e){let{baseTile:n,mutations:r,mutationIcons:o}=e,s=this.tileToCanvas(n),a=s.width,i=s.getContext("2d");i.imageSmoothingEnabled=!1;let l=this.sortMutations(r),c=l.filter(u=>u==="Gold"||u==="Rainbow"||u==="Wet"||u==="Chilled"||u==="Frozen"||u==="Dawnlit"||u==="Ambershine"||u==="Dawncharged"||u==="Ambercharged"),d=l.filter(u=>u!=="Gold"&&u!=="Rainbow");return c.length&&(s=this.applyColorMutations(s,c),i=s.getContext("2d")),d.length&&this.drawMutationIconsNonTall(i,d,a,o),s}sortMutations(e){let n=new Set;for(let r of e){let o=r;su.includes(o)&&!n.has(o)&&n.add(o)}return Array.from(n).sort((r,o)=>su.indexOf(r)-su.indexOf(o))}applyColorMutations(e,n){if(!n.length)return e;if(n.includes("Gold"))return this.applyFilterChain(e,["Gold"]);if(n.includes("Rainbow"))return this.applyFilterChain(e,["Rainbow"]);let r=n.filter(o=>o!=="Gold"&&o!=="Rainbow");return this.applyFilterChain(e,r)}applyFilterChain(e,n){let r=e;for(let o of n){let s=this.applyCanvasFilter(r,o);s&&(r=s)}return r}drawMutationIconsNonTall(e,n,r,o){e.save(),e.imageSmoothingEnabled=!1;for(let s of n){let a=o[s];if(!a)continue;let i=this.tileToCanvas(a.tile),l=i.width,c=i.height,d=a.scale??1,u=r*d,y=r*d,h=gM.has(s)?-r*.25:0,f=(a.offsetX??0)*r,p=(a.offsetY??0)*r+h;e.drawImage(i,0,0,l,c,f,p,u,y)}e.restore()}drawGradient(e,n,r,o){let s=o.colors.length?o.colors:["#ffffff"],a=o.reverse?[...s].reverse():s;if(o.gradientAngle!=null){let l=this.makeAngleGradient(e,n,r,o.gradientAngle);a.length===1?(l.addColorStop(0,a[0]),l.addColorStop(1,a[0])):a.forEach((c,d)=>{l.addColorStop(d/(a.length-1),c)}),e.fillStyle=l,e.fillRect(0,0,n,r);return}let i=e.createLinearGradient(0,0,0,r);a.length===1?(i.addColorStop(0,a[0]),i.addColorStop(1,a[0])):a.forEach((l,c)=>{i.addColorStop(c/(a.length-1),l)}),e.fillStyle=i,e.fillRect(0,0,n,r)}async loadImage(e){return await new Promise((n,r)=>{let o=new Image;o.crossOrigin="anonymous",o.onload=()=>n(o),o.onerror=r,o.src=e})}guessSize(e,n,r){return r||(this.cfg.ruleAllplants512.test(e)?512:n.width%256===0&&n.height%256===0?256:n.width%512===0&&n.height%512===0?512:256)}isBlankOrBlack(e){let n=this.cfg.skipAlphaBelow,r=this.cfg.blackBelow,o=this.cfg.tolerance,s=e.data,a=Math.ceil(s.length/4*o),i=0;for(let l=0;l<s.length;l+=4)if(s[l+3]>n){let d=s[l],u=s[l+1],y=s[l+2];if((d>r||u>r||y>r)&&++i>a)return!1}return!0}async sliceOne(e,n){let r=await this.loadImage(e),o=this.guessSize(e,r,n.forceSize),s=Math.floor(r.width/o),a=Math.floor(r.height/o),i=xo(e),l=document.createElement("canvas");l.width=o,l.height=o;let c=l.getContext("2d",{willReadFrequently:!0});c.imageSmoothingEnabled=!1;let d=[],u=0;for(let y=0;y<a;y++)for(let h=0;h<s;h++){c.clearRect(0,0,o,o),c.drawImage(r,h*o,y*o,o,o,0,0,o,o);let f=!1;try{let p=c.getImageData(0,0,o,o);f=this.isBlankOrBlack(p)}catch{f=!1}if(!n.includeBlanks&&f){u++;continue}if(n.mode==="bitmap"){let p=await createImageBitmap(l);d.push({sheet:i,url:e,index:u,col:h,row:y,size:o,data:p})}else if(n.mode==="canvas"){let p=document.createElement("canvas");p.width=o,p.height=o,p.getContext("2d").drawImage(l,0,0),d.push({sheet:i,url:e,index:u,col:h,row:y,size:o,data:p})}else{let p=await new Promise((m,g)=>{l.toBlob(S=>{if(!S){g(new Error("toBlob returned null"));return}let w=new FileReader;w.onerror=g,w.onload=()=>m(w.result),w.readAsDataURL(S)},"image/png")});d.push({sheet:i,url:e,index:u,col:h,row:y,size:o,data:p})}u++}return d}async zipTiles(e){let n=new Eo.default;for(let r of this.familySet("tiles")){let o=await this.sliceOne(r,{mode:"canvas",includeBlanks:!1,forceSize:e.forceSize}),s=xo(r),a=0;for(let i of o){let l=i.data,c=await new Promise(d=>l.toBlob(u=>d(u),"image/png"));n.file(`${s}/tile_${String(++a).padStart(4,"0")}.png`,c)}}await this.saveZip(n,e.name)}tileToCanvas(e){let n=e.data,r=e.size,o=e.size,s=document.createElement("canvas");s.width=r,s.height=o;let a=s.getContext("2d");if(a.imageSmoothingEnabled=!1,n instanceof HTMLCanvasElement)r=n.width,o=n.height,s.width=r,s.height=o,a.drawImage(n,0,0);else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)r=n.width,o=n.height,s.width=r,s.height=o,a.drawImage(n,0,0);else{if(typeof n=="string")throw new Error("Sprites: tile.data est un dataURL (string). Recharge la tuile en mode 'canvas' ou 'bitmap'.");a.drawImage(n,0,0)}return s}makeAngleGradient(e,n,r,o){let s=(o-90)*Math.PI/180,a=n/2,i=r/2,l=Math.min(n,r)/2,c=a-Math.cos(s)*l,d=i-Math.sin(s)*l,u=a+Math.cos(s)*l,y=i+Math.sin(s)*l;return e.createLinearGradient(c,d,u,y)}add(e,n=""){let r=fM(e);r.length&&this.addAsset(e,r)}addAsset(e,n=["tiles"]){let r=mM(e);if(!pM(r)||this.all.has(r))return!1;let o=this.normalizeFamilies(n);if(!o.length)return!1;this.all.add(r),this.assetFamilies.set(r,o);for(let a of o){let i=this.familyAssets.get(a);i||(i=new Set,this.familyAssets.set(a,i)),i.add(r)}let s=o[0]??"unknown";return this.onAssetCb?.(r,s),!0}async fetchBlob(e){let n=await fetch(e,{credentials:"include"});if(!n.ok)throw new Error(`HTTP ${n.status} for ${e}`);return n.blob()}async saveZip(e,n){let r=await e.generateAsync({type:"blob"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=n,document.body.appendChild(o),o.click(),o.remove(),setTimeout(()=>URL.revokeObjectURL(o.href),1e4)}},$y=new au(!1);et("Sprites",$y);var Ie=$y;function iu(t){let e=Ie.init(t);return et("Sprites",e),console.debug("[Sprites] Instance globale disponible sur pageWindow.Sprites",{hasWindowProperty:"Sprites"in Re,lists:e.lists()}),e}et("initSprites",iu);var Ki=new Map,hM=t=>t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");function lu(){Ki.clear()}function Co(t){let e=t.split(/[?#]/)[0]??t;return(e.split("/").pop()??e).replace(/\.[^.]+$/,"")}function Zy(t,e){let n=new Set;for(let r of t)typeof r=="string"&&r.length&&n.add(Co(r));if(n.size===0)for(let r of e)n.add(r);return[...n]}async function kt(t){let e=t.toLowerCase();if(Ki.has(e))return Ki.get(e);let n=new RegExp(`${hM(t)}\\.(png|webp)$`,"i"),r=Ie.loadTiles({mode:"canvas",onlySheets:n}).then(o=>{for(let[a,i]of o.entries())if(a.toLowerCase()===e)return i??[];return o.get(t)??[]}).catch(()=>[]);return Ki.set(e,r),r}var zn=null;function Xy(t){if(zn!==null)return;let e=t??(typeof document<"u"?document:null);if(!e)return;let n=e.scripts;for(let r=0;r<n.length;r++){let o=n.item(r);if(!o)continue;let s=o.src;if(!s)continue;let a=s.match(/\/(?:r\/\d+\/)?version\/([^/]+)/);if(a&&a[1]){zn=a[1];return}}}var ng="[AssetManifest]",bM=/(https?:\/\/[^/]+\/(?:version\/[^/]+\/)?assets\/)/i,SM=/\/version\/([^/]+)\//i,vM=/\/version\/([^/]+)\//i,cu=null,qs=null,wM=[],Ui=new Map,du=new Map,Zt=null,eg=null,uu=!1,pu=null;function xM(t){return!t||typeof t!="object"?null:Array.isArray(t.bundles)?{bundles:t.bundles.map(n=>({name:typeof n.name=="string"&&n.name?n.name:"default",assets:Array.isArray(n.assets)?n.assets:[]})).filter(n=>n.assets.length>0)}:{bundles:[]}}function rg(t){if(!t)return null;let e=t.trim().toLowerCase();return e||null}function EM(t){if(!t)return null;let e=t.replace(/^\/+/,"").replace(/\\/g,"/").replace(/[\?#].*$/,""),n=e.indexOf("/");return n<=0?null:rg(e.slice(0,n))}function CM(t,e,n){let r=new Set,o=s=>{let a=EM(s);a&&r.add(a)};o(t);for(let s of e)o(s);if(!r.size){let s=rg(n);s&&r.add(s)}return Array.from(r)}function MM(t,e){return/^https?:\/\//i.test(e)?e:`${t.endsWith("/")?t:`${t}/`}${e.replace(/^\/+/,"")}`}function og(t){try{let n=new URL(t,location.href).href.match(bM);if(n&&n[1])return n[1]}catch{}return null}function Os(t){if(!t)return;let e=og(t);if(!e||Zt&&Zt===e)return;Zt=e,eg=e.match(SM)?.[1]??eg}function AM(t){return t||(Zt?`${Zt}manifest.json`:null)}function TM(){try{let e=location.href.match(vM);if(e?.[1])return`${location.origin}/version/${e[1]}/assets/`}catch{}return null}function tg(){if(!zn)return null;try{return`${location.origin}/version/${zn}/assets/`}catch{return null}}function IM(t){return new Promise(e=>setTimeout(e,t))}function kM(t){wM=t,Ui=new Map,du=new Map;for(let e of t){Ui.set(e.src,e),Ui.set(e.url,e);for(let n of e.aliases)Ui.set(n,e);for(let n of e.families){let r=du.get(n);r?r.push(e):du.set(n,[e])}}}function PM(t,e){let n=[];for(let r of t.bundles??[]){let o=r.name??"default";for(let s of r.assets??[]){let a=Array.isArray(s.alias)?s.alias.filter(Boolean):[];for(let i of s.src??[]){let l=e?MM(e,i):i,c=CM(i,a,o),d=c[0]??null;n.push({bundle:o,aliases:a,src:i,url:l,tags:s.data?.tags??{},families:c,primaryFamily:d})}}}return n}function LM(t){let e=0;for(let n of t)Ie.registerKnownAsset(n.url,n.families)&&(n.families.includes("tiles")||n.families.includes("ui"))&&(e+=1);if(e>0)try{Re.dispatchEvent(new CustomEvent("mg:sprite-detected",{detail:{source:"manifest"}}))}catch{}return e}async function RM(t){try{let e=await fetch(t,{cache:"no-store",credentials:"include"});if(!e.ok)throw new Error(`HTTP ${e.status}`);let n=await e.json();return xM(n)}catch(e){return console.warn(ng,"unable to fetch remote manifest",{manifestUrl:t,error:e}),null}}function sg(t){let e=Zt;Os(t),Zt&&Zt!==e&&_M()}function _M(){uu||(uu=!0,setTimeout(()=>{uu=!1,Fs({registerSprites:!0}).catch(()=>{})},100))}async function Fs(t={}){let e=Zt??null;if(!t.force&&cu&&(!e||pu===e))return cu;if(!t.force&&qs)return qs;if(!Zt){let r=tg();if(r)Os(r);else{let o=TM();o&&Os(o)}}if(!Zt&&t.waitForVersionMs){let r=Date.now()+t.waitForVersionMs;for(;!Zt&&!zn&&Date.now()<r;)await IM(50);if(!Zt&&zn){let o=tg();o&&Os(o)}}let n=AM(t.url);if(!n)return console.warn(ng,"no manifest URL could be resolved"),null;qs=(async()=>{let r=n?await RM(n):null;if(!r)return null;n&&Os(n);let o=Zt??(n?og(n):null),s=PM(r,o);return kM(s),pu=o??pu,t.registerSprites!==!1&&o&&LM(s),cu=r,r})();try{return await qs}finally{qs=null}}var Vi=null;function Pt(){return Vi||(Vi=(async()=>{await Fs({registerSprites:!0,waitForVersionMs:4e3})})(),Vi)}var sl=new WeakMap,Gs=new Map,Zi=new Map,Yi=new Map,ag=()=>typeof performance<"u"?performance.now():Date.now(),Qi=De,mg={Seed:["seeds"],Egg:["pets"],Tool:["items"],Decor:["decor"],Crop:["plants"]},Ao={},Ji=null,hu=(t,e)=>{try{let n=t()??[];return Zy(n,e)}catch{return[...e]}},NM={Seed:()=>typeof Ie.listSeeds=="function"?Ie.listSeeds():[],Egg:()=>typeof Ie.listPets=="function"?Ie.listPets():[],Tool:()=>typeof Ie.listItems=="function"?Ie.listItems():[],Decor:()=>typeof Ie.listTilesByCategory=="function"?Ie.listTilesByCategory(/decor/i):[]},DM=new Set(["Cactus","Bamboo"]),qM={Seed:()=>Object.keys(Qi).filter(t=>!!Qi[t]?.seed?.tileRef),Crop:()=>Object.keys(Qi).filter(t=>!!Qi[t]?.crop?.tileRef),Egg:()=>Object.keys(Qt),Tool:()=>Object.keys(Jt),Decor:()=>Object.keys(ut)},ig={};function OM(t){let e=ig[t];if(e)return e;let n=qM[t];if(!n)return[];let r=n().filter(o=>typeof o=="string"&&o.length>0);return ig[t]=r,r}function bu(t,e){return`${t}::${e}`}function FM(t){switch(t){case"Seed":return"\u{1F331}";case"Egg":return"\u{1F95A}";case"Tool":return"\u{1F9F0}";case"Decor":return"\u{1F3E0}";case"Crop":return"\u{1F34E}"}}function BM(){if(Ao.Crop)return Ao.Crop;let e=hu(()=>{if(typeof Ie.listTilesByCategory!="function")return[];let n=Ie.listTilesByCategory(/plants|allplants/i),r=n.filter(o=>!/tallplants/i.test(o)&&!/tall/i.test(o));return r.length?r:n},mg.Crop);return Ao.Crop=e,e}function HM(){return Ji||(Ji=hu(()=>typeof Ie.listTilesByCategory!="function"?[]:Ie.listTilesByCategory(/tallplants/i),["tallplants","TallPlants"]),Ji)}function WM(t,e){if(t==="Crop"){let s=BM();return e&&DM.has(e)?[...HM(),...s]:s}if(Ao[t])return Ao[t];let n=NM[t],r=mg[t],o=n?hu(n,r):[...r];return Ao[t]=o,o}function zM(t){if(t==null)return null;let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}function jM(t,e){switch(t){case"Seed":return De?.[e]?.seed?.tileRef??null;case"Egg":return Qt?.[e]?.tileRef??null;case"Tool":return Jt?.[e]?.tileRef??null;case"Decor":return ut?.[e]?.tileRef??null;case"Crop":return De?.[e]?.crop?.tileRef??null}}function KM(t,e){let n=Gs.get(t);n||(n=new Set,Gs.set(t,n)),n.add(e)}function UM(t,e){let n=Gs.get(t);n&&(e.isConnected||(n.delete(e),sl.delete(e)),n.size===0&&Gs.delete(t))}function rl(t,e){let n=sl.get(t);if(!n)return;let{size:r,fallback:o,alt:s}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",t.setAttribute("role","img"),e){t.removeAttribute("aria-label"),t.style.fontSize="";let a=document.createElement("img");a.src=e,a.alt=s,a.decoding="async",a.loading="lazy",a.draggable=!1,a.style.width="100%",a.style.height="100%",a.style.objectFit="contain",t.appendChild(a)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.72))}px`,t.setAttribute("aria-label",s||o)}function lg(t,e){let n=Gs.get(t);n&&n.forEach(r=>{if(!r.isConnected){UM(t,r);return}rl(r,e)})}async function VM(t,e){if(await Pt(),typeof Re>"u"||typeof Ie?.getTile!="function")return null;let n=jM(t,e),r=zM(n);if(r==null)return null;let o=WM(t,e);for(let s of o)try{let l=(await kt(s)).find(d=>d.index===r)?.data;if(!l||l.width<=0||l.height<=0)continue;return l.toDataURL()}catch{}return null}function fg(t,e,n=bu(t,e)){if(typeof Re>"u")return Zi.set(n,{payload:null,createdAt:ag()}),lg(n,null),Promise.resolve(null);let r=Zi.get(n);if(r!==void 0)return lg(n,r.payload),Promise.resolve(r.payload);let o=Yi.get(n);if(o)return o;let s=VM(t,e).then(a=>(Zi.set(n,{payload:a,createdAt:ag()}),Yi.delete(n),a)).catch(()=>(Yi.delete(n),null));return Yi.set(n,s),s}function YM(t,e){let n=bu(t,e);return fg(t,e,n)}var QM=["Seed","Egg","Tool","Decor","Crop"],JM={Seed:18,Egg:6,Tool:6,Decor:24,Crop:10},ol=t=>new Promise(e=>setTimeout(e,t));function $M(t,e){let n=e.limit;return typeof n=="number"?n:n&&typeof n=="object"&&n[t]!=null?n[t]:JM[t]??1/0}async function ZM(t={}){if(typeof Re>"u")return;let e=Math.max(0,t.delayMs??0),n=Math.max(0,t.stepMs??0),r=t.types??QM;e>0&&await ol(e);for(let o of r){let s=OM(o);if(s.length===0)continue;let a=$M(o,t);if(a<=0)continue;let i=a<s.length?s.slice(0,a):s;for(let l of i){try{await YM(o,l)}catch{}n>0&&await ol(n)}}}var yg=12,gg=0,XM=10,$i={enabled:!0,batchSize:yg,delayMs:gg,threshold:XM},Mo=[],yu=!1,Xi=0,el=null;var mu=()=>{Xi=0,el=null},eA=()=>(Xi+=1,el!=null||(typeof requestAnimationFrame=="function"?el=requestAnimationFrame(mu):typeof window<"u"?el=window.setTimeout(mu,16):mu()),Xi),tA=t=>({enabled:t?.enabled??$i.enabled,batchSize:Math.max(1,Math.floor(t?.batchSize??$i.batchSize)),delayMs:Math.max(0,Math.floor(t?.delayMs??$i.delayMs)),threshold:Math.max(1,Math.floor(t?.threshold??$i.threshold))}),nA=(t,e)=>t.enabled?e?.force===!0?!0:e?.force===!1||typeof window>"u"?!1:eA()>=t.threshold:!1,rA=(t,e)=>{let n=Math.max(12,e.size??36),r=String(e.fallback??FM(t)),o=typeof e.alt=="string"?e.alt:"";return{size:n,fallback:r,alt:o}},hg=(t,e,n)=>{let{size:r,fallback:o,alt:s}=n,a=document.createElement("span");if(sl.set(a,{size:r,fallback:o,alt:s}),typeof Re>"u")return rl(a,null),a;let i=bu(t,e);KM(i,a),rl(a,Zi.get(i)?.payload??null);let l=fg(t,e,i);return a};function cg(){if(yu=!1,!Mo.length)return;let t=Math.max(1,Mo[0]?.batchSize??yg);Mo.splice(0,t).forEach(n=>{let{placeholder:r}=n;if(!r.isConnected)return;let o=hg(n.type,n.id,n.options);try{r.replaceWith(o)}catch{}}),Mo.length&&bg()}function bg(){if(yu)return;yu=!0;let t=Math.max(0,Mo[0]?.delayMs??gg),e=()=>{t>0?setTimeout(cg,t):cg()};typeof requestAnimationFrame=="function"?requestAnimationFrame(e):setTimeout(e,t)}var oA=(t,e,n,r)=>{let o=document.createElement("span");return sl.set(o,n),rl(o,null),Mo.push({type:t,id:e,options:n,placeholder:o,batchSize:r.batchSize,delayMs:r.delayMs}),bg(),o};function Tt(t,e,n={},r){let o=rA(t,n),s=tA(r);return nA(s,r)?oA(t,e,o,s):hg(t,e,o)}var al=new WeakMap,js=new Map,zs=new Map,Bs=new Map,dg=!1,Hs=null,Su=(()=>{let t=new Map;for(let[e,n]of Object.entries(Si??{})){let r=vu(e),o=sA(n);r&&o!=null&&t.set(r,o)}return t})();function vu(t){return(typeof t=="string"?t:String(t??"")).trim().replace(/^Weather:/i,"").replace(/[^a-z0-9]+/gi,"").toLowerCase()}function sA(t){let e=typeof t=="number"?t:Number(t);return Number.isFinite(e)?e>0?Math.trunc(e)-1:Math.trunc(e):null}function aA(){if(Hs)return Hs;let t=new Set;try{let e=Ie?.listTilesByCategory;if(typeof e=="function")for(let n of e(/anim/i)){if(typeof n!="string"||!n.length)continue;let r=n.split(/[?#]/)[0]??n,o=r.split("/").pop()??r;t.add(o.replace(/\.[^.]+$/,""))}}catch{}return t.size===0&&t.add("animations"),Hs=[...t],Hs}function iA(t,e,n){let r=js.get(t);r||(r=new Set,js.set(t,r)),r.add(e),al.set(e,n)}function fu(t,e){let n=js.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),al.delete(r);return}tl(r,e)}),n.size===0&&js.delete(t))}function lA(){dg||typeof window>"u"||(dg=!0,window.addEventListener("mg:sprite-detected",()=>{zs.clear(),Bs.clear(),Hs=null,lu(),Array.from(js.keys()).forEach(e=>{wu(e)})}))}function tl(t,e){let n=al.get(t);if(!n)return;let{size:r,fallback:o,alt:s}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",t.setAttribute("role","img"),e){t.removeAttribute("aria-label"),t.style.fontSize="";let a=document.createElement("img");a.src=e,a.alt=s,a.decoding="async",a.loading="lazy",a.draggable=!1,a.style.width="100%",a.style.height="100%",a.style.objectFit="contain",t.appendChild(a)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.72))}px`,s?t.setAttribute("aria-label",s):t.removeAttribute("aria-label")}async function cA(t){await Pt();let e=Su.get(t);if(e==null)return null;let n=aA();for(let r of n)try{let s=(await kt(r)).find(i=>i.index===e);if(!s)continue;let a=Ie.toCanvas(s);if(!a||a.width<=0||a.height<=0)continue;return a.toDataURL()}catch{}return null}function wu(t){if(typeof window>"u")return zs.set(t,null),fu(t,null),Promise.resolve(null);let e=zs.get(t);if(e!==void 0)return fu(t,e),Promise.resolve(e);let n=Bs.get(t);if(n)return n;let r=cA(t).then(o=>(zs.set(t,o),Bs.delete(t),fu(t,o),o)).catch(()=>(Bs.delete(t),null));return Bs.set(t,r),r}async function dA(t={}){let{keys:e,limit:n=20,delayMs:r=40}=t,o=(e??Array.from(Su.keys())).map(a=>vu(a)).map(a=>Gn(a)).filter(a=>!!a),s=n&&n>0?Math.min(n,o.length):o.length;for(let a=0;a<s;a+=1){let i=o[a];try{await wu(i)}catch{}r>0&&a<s-1&&await ol(r)}}function Gn(t){if(t==null)return null;let e=vu(t);return e&&Su.has(e)?e:null}function il(t,e={}){let n=Math.max(12,e.size??36),r=String(e.fallback??"\u011EYO\u0130"),o=typeof e.alt=="string"?e.alt:"",s=document.createElement("span");if(al.set(s,{size:n,fallback:r,alt:o}),typeof window>"u")return tl(s,null),s;lA();let a=Gn(t);if(!a)return tl(s,null),s;iA(a,s,{size:n,fallback:r,alt:o}),tl(s,zs.get(a)??null);let i=wu(a);return s}var uA={normal:null,gold:"Gold",rainbow:"Rainbow"},gu=new Map,Ws=new Map,nl=null,ug=!1;function Sg(t){if(!t||gt[t])return t;let e=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return gt[e]?e:t}function pA(t){let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}function mA(){if(nl)return nl;let t=new Set;try{let n=typeof Ie.listPets=="function"?Ie.listPets():[];for(let r of n)typeof r=="string"&&r.length&&t.add(r)}catch{}let e=Array.from(t,n=>Co(n));return nl=e,e}function fA(){gu.clear(),Ws.clear(),nl=null,lu()}function yA(){ug||typeof window>"u"||(ug=!0,window.addEventListener("mg:sprite-detected",()=>{fA()}))}function gA(t,e){return`${t.toLowerCase()}::${e}`}function pg(t,e){return e?(Array.isArray(e)?e:[e]).map(r=>String(r??"").toLowerCase()).some(r=>r.includes(t)):!1}function hA(t){return pg("rainbow",t)?"rainbow":pg("gold",t)?"gold":"normal"}async function bA(t,e){if(await Pt(),typeof window>"u"||typeof Ie.getTile!="function")return null;let r=gt[t]?.tileRef;if(r==null)return null;let o=pA(r);if(o==null)return null;let s=new Set(mA());s.size===0&&(s.add("pets"),s.add("Pets"));for(let a of s)try{let l=(await kt(a)).find(y=>y.index===o);if(!l)continue;let c=Ie.toCanvas(l);if(!c||c.width<=0||c.height<=0)continue;let d=c,u=uA[e];if(u){let y=Ie.applyCanvasFilter(d,u);y&&(d=y)}return d.toDataURL()}catch{}return null}function vg(t,e="normal"){if(typeof window>"u")return Promise.resolve(null);let n=Sg(String(t??"").trim());if(!n)return Promise.resolve(null);yA();let r=gA(n,e),o=gu.get(r);if(o!==void 0)return Promise.resolve(o);let s=Ws.get(r);if(s)return s;let a=bA(n,e).then(i=>(gu.set(r,i),Ws.delete(r),i)).catch(()=>(Ws.delete(r),null));return Ws.set(r,a),a}function ll(t,e){let n=hA(e);return vg(t,n)}async function SA(t={}){let{species:e,variants:n=["normal","gold","rainbow"],delayMs:r=10,limit:o}=t,s=(e??Object.keys(gt)).map(l=>Sg(l)).filter(l=>!!l),a=[];for(let l of s)for(let c of n)a.push({species:l,variant:c});let i=typeof o=="number"&&o>0?Math.min(o,a.length):a.length;for(let l=0;l<i;l+=1){let c=a[l];try{await vg(c.species,c.variant)}catch{}r>0&&l<i-1&&await ol(r)}}var vA={Seed:1/0,Egg:1/0,Tool:1/0,Decor:1/0,Crop:1/0};async function wg(t={}){let e={delayMs:t.shop?.delayMs,stepMs:t.shop?.stepMs,types:t.shop?.types,limit:t.shop?.limit??vA};await ZM(e),await dA(t.weather??{delayMs:5,limit:0}),await SA(t.pet??{delayMs:5})}var Tg=t=>{if(t)return t;let e=Re??window,n=e.document??document;return{window:e,document:n}},xg={KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,Space:32,Enter:13,Escape:27,Tab:9,Backspace:8,Delete:46,Insert:45,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40},xu=(t,e=!1)=>t?/^Key[A-Z]$/.test(t)?e?t.slice(3).toUpperCase():t.slice(3).toLowerCase():/^Digit[0-9]$/.test(t)?t.slice(5):t==="Space"?" ":t:"",Eg=t=>{let e=t;if(!e||!e.tagName)return!1;let n=e.tagName.toLowerCase();if(n==="input"||n==="textarea")return!0;let r=e.getAttribute&&e.getAttribute("contenteditable");return!!(r&&r!=="false")},zt=t=>{let e=String(t).split("+").map(o=>o.trim()).filter(Boolean),n=[],r="";for(let o of e){let s=o.toLowerCase();s==="ctrl"||s==="control"?n.push("ctrl"):s==="shift"?n.push("shift"):s==="alt"?n.push("alt"):s==="meta"||s==="cmd"||s==="command"||s==="win"?n.push("meta"):r=o}return n.sort((o,s)=>["ctrl","shift","alt","meta"].indexOf(o)-["ctrl","shift","alt","meta"].indexOf(s)),(n.length?n.join("+")+"+":"")+r},Ks=t=>{let e=String(t).split("+").map(r=>r.trim()).filter(Boolean),n={};for(let r of e){let o=r.toLowerCase();o==="ctrl"||o==="control"?n.ctrl=!0:o==="shift"?n.shift=!0:o==="alt"?n.alt=!0:o==="meta"||o==="cmd"||o==="command"||o==="win"?n.meta=!0:n.code=r}return n.code&&n.key===void 0&&(n.key=xu(n.code,!!n.shift)),n},wA=t=>{let e=[];return t.ctrlKey&&e.push("ctrl"),t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.metaKey&&e.push("meta"),e.sort((n,r)=>["ctrl","shift","alt","meta"].indexOf(n)-["ctrl","shift","alt","meta"].indexOf(r)),(e.length?e.join("+")+"+":"")+(t.code||"")},Cg="__inGameHotkeysRemapped__",Mg="__inGameHotkeysRapidSynthetic__",Eu=class{constructor(e=!0,n){pe(this,"win");pe(this,"doc");pe(this,"enabled",!0);pe(this,"map",new Map);pe(this,"blockedSet",new Set);pe(this,"eventBlockers",new Set);pe(this,"attachedDocs",new WeakSet);pe(this,"observers",[]);pe(this,"handlers",new Map);pe(this,"passthrough",new Set(["F5","F12"]));pe(this,"sessions",new Map);let r=Tg(n);if(this.win=r.window,this.doc=r.document,e&&(this.attachDoc(this.doc),this.attachAllFrames(),this.win.MutationObserver)){let o=new this.win.MutationObserver(()=>this.attachAllFrames());o.observe(this.doc.documentElement||this.doc,{childList:!0,subtree:!0}),this.observers.push(o)}}enable(e=!0){this.enabled=!!e}disable(){this.enabled=!1}isEnabled(){return this.enabled}setMap(e){this.map.clear();for(let[n,r]of Object.entries(e||{}))this.map.set(zt(n),Ks(r))}add(e,n){this.map.set(zt(e),Ks(n))}remove(e){this.map.delete(zt(e))}clear(){this.map.clear()}current(){let e={};for(let[n,r]of this.map.entries()){let o=[];r.ctrl&&o.push("Ctrl"),r.shift&&o.push("Shift"),r.alt&&o.push("Alt"),r.meta&&o.push("Meta"),e[n]=(o.length?o.join("+")+"+":"")+(r.code||"")}return e}block(e){this.blockedSet.add(zt(e))}unblock(e){this.blockedSet.delete(zt(e))}blocked(){return Array.from(this.blockedSet)}addEventBlocker(e){return typeof e!="function"?()=>{}:(this.eventBlockers.add(e),()=>{this.eventBlockers.delete(e)})}replace(e,n){let r=zt(e),o=zt(n);this.blockedSet.add(r),this.map.set(o,Ks(r))}swap(e,n){let r=zt(e),o=zt(n);this.map.set(r,Ks(o)),this.map.set(o,Ks(r))}attachAllFrames(){this.doc.querySelectorAll("iframe").forEach(e=>{try{let n=e.contentDocument,r=n?.location?.origin;n&&r&&r===this.win.location.origin&&this.attachDoc(n)}catch{}})}destroy(){for(let[e,n]of this.handlers.entries())try{let r=e.defaultView||this.win;r.removeEventListener("keydown",n,!0),r.removeEventListener("keypress",n,!0),r.removeEventListener("keyup",n,!0)}catch{}this.handlers.clear(),this.attachedDocs=new WeakSet;for(let e of this.observers)e.disconnect();this.observers=[],this.stopAllRapidFires(),this.eventBlockers.clear()}startRapidFire(e){let n=zt(e.trigger),r=zt(e.emit??e.trigger),o=1e3/Math.max(1,e.rateHz??12),s=e.mode??"tap",a=e.keyupDelayMs??20;this.sessions.set(n,{trigger:Ag(n),emit:Ag(r),rateMs:o,mode:s,keyupDelayMs:a,pressed:!1,lastTarget:null,tickTimer:null,upTimer:null})}stopRapidFire(e){if(!e){this.stopAllRapidFires();return}let n=zt(e),r=this.sessions.get(n);r&&(this.endSession(r),this.sessions.delete(n))}stopAllRapidFires(){for(let e of this.sessions.values())this.endSession(e);this.sessions.clear()}isRapidFireActive(e){let n=this.sessions.get(zt(e));return!!(n&&n.pressed)}setRapidFireRate(e,n){let r=this.sessions.get(zt(e));r&&(r.rateMs=1e3/Math.max(1,n),r.pressed&&this.restartLoop(r))}setRapidFireMode(e,n){let r=this.sessions.get(zt(e));r&&(r.mode=n)}listRapidFires(){let e=[];for(let[n,r]of this.sessions.entries())e.push({trigger:n,emit:xA(r.emit),rateHz:Math.round(1e3/r.rateMs),mode:r.mode});return e}attachDoc(e){if(!e||this.attachedDocs.has(e))return;let n=this.makeHandler(e),r=e.defaultView||this.win;r.addEventListener("keydown",n,!0),r.addEventListener("keypress",n,!0),r.addEventListener("keyup",n,!0),this.handlers.set(e,n),this.attachedDocs.add(e)}makeHandler(e){return n=>{let r=n;if(r[Cg])return;let o=!!r[Mg];if(o||this.handleRapidFireInput(e,r),!o&&this.eventBlockers.size)for(let g of Array.from(this.eventBlockers)){let S=!1;try{S=g(r)}catch{S=!1}if(S){r.stopImmediatePropagation(),r.preventDefault();return}}if(!this.enabled||Eg(r.target)||this.passthrough.has(r.code))return;let s=wA(r);if(this.blockedSet.has(s)){r.stopImmediatePropagation(),r.preventDefault();return}let a=this.map.get(s);if(!a)return;r.stopImmediatePropagation(),r.preventDefault();let i=a.code||"",l=a.key!==void 0?a.key:xu(i,r.shiftKey),c=a.ctrl??r.ctrlKey,d=a.shift??r.shiftKey,u=a.alt??r.altKey,y=a.meta??r.metaKey,h=xg[i]??(l&&l.length===1?l.toUpperCase().charCodeAt(0):0),f=e.defaultView||this.win,p=new f.KeyboardEvent(r.type,{bubbles:!0,cancelable:!0,composed:!0,key:l,code:i,ctrlKey:c,shiftKey:d,altKey:u,metaKey:y,repeat:r.repeat,location:r.location});Object.defineProperties(p,{keyCode:{get:()=>h},which:{get:()=>h},charCode:{get:()=>h},[Cg]:{value:!0}}),(r.target||e).dispatchEvent(p)}}handleRapidFireInput(e,n){if(!Eg(n.target)){if(n.type==="keydown"&&!n.repeat)for(let r of this.sessions.values())this.matches(n,r.trigger)&&(r.pressed=!0,r.lastTarget=n.target||e,this.startLoop(e,r));else if(n.type==="keyup")for(let r of this.sessions.values())this.matches(n,r.trigger)&&(r.pressed=!1,this.stopLoop(e,r))}}matches(e,n){return e.code===n.code&&!!e.ctrlKey==!!n.ctrl&&!!e.shiftKey==!!n.shift&&!!e.altKey==!!n.alt&&!!e.metaKey==!!n.meta}startLoop(e,n){this.stopLoop(e,n);let r=()=>{n.pressed&&(this.dispatchKey(e,n.lastTarget||e,"keydown",n.emit,!0),n.mode==="tap"&&(n.upTimer&&this.win.clearTimeout(n.upTimer),n.upTimer=this.win.setTimeout(()=>{this.dispatchKey(e,n.lastTarget||e,"keyup",n.emit,!1)},n.keyupDelayMs)))};r(),n.tickTimer=this.win.setInterval(r,n.rateMs)}stopLoop(e,n){n.tickTimer&&(this.win.clearInterval(n.tickTimer),n.tickTimer=null),n.upTimer&&(this.win.clearTimeout(n.upTimer),n.upTimer=null),n.mode==="hold"&&n.lastTarget&&this.dispatchKey(e,n.lastTarget,"keyup",n.emit,!1)}restartLoop(e){if(!e.pressed)return;let n=this.doc;this.startLoop(n,e)}endSession(e){this.stopLoop(this.doc,e),e.pressed=!1,e.lastTarget=null}dispatchKey(e,n,r,o,s){let a=o.code,i=xu(a,o.shift),l=xg[a]??(i&&i.length===1?i.toUpperCase().charCodeAt(0):0),c=e.defaultView||this.win,d=new c.KeyboardEvent(r,{bubbles:!0,cancelable:!0,composed:!0,key:i,code:a,ctrlKey:o.ctrl,shiftKey:o.shift,altKey:o.alt,metaKey:o.meta,repeat:s});Object.defineProperties(d,{keyCode:{get:()=>l},which:{get:()=>l},charCode:{get:()=>l},[Mg]:{value:!0}});try{n.dispatchEvent(d)}catch{e.dispatchEvent(d)}}};function Ag(t){let e=String(t).split("+").map(i=>i.trim()).filter(Boolean),n="",r=!1,o=!1,s=!1,a=!1;for(let i of e){let l=i.toLowerCase();l==="ctrl"||l==="control"?r=!0:l==="shift"?o=!0:l==="alt"?s=!0:l==="meta"||l==="cmd"||l==="command"||l==="win"?a=!0:n=i}return{code:n,ctrl:r,shift:o,alt:s,meta:a}}function xA(t){let e=[];return t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push("Meta"),e.push(t.code),e.join("+")}var EA=Tg(),pn=new Eu(!0,EA);et("inGameHotkeys",pn);try{window.inGameHotkeys=pn}catch{}var Qe=class{constructor(e={}){this.opts=e;pe(this,"root");pe(this,"tabBar");pe(this,"views");pe(this,"tabs",new Map);pe(this,"events",new Map);pe(this,"currentId",null);pe(this,"lsKeyActive");pe(this,"menuId");pe(this,"_altDown",!1);pe(this,"_insertDown",!1);pe(this,"_hovering",!1);pe(this,"_onKey",e=>{(e.code==="Insert"||e.key==="Insert")&&(this._insertDown=e.type==="keydown");let n=e.altKey||this._insertDown;n!==this._altDown&&(this._altDown=n,this._updateAltCursor())});pe(this,"_onBlur",()=>{this._altDown=!1,this._insertDown=!1,this._updateAltCursor()});pe(this,"_onEnter",()=>{this._hovering=!0,this._updateAltCursor()});pe(this,"_onLeave",()=>{this._hovering=!1,this._updateAltCursor()});this.menuId=this.opts.id||"default",this.lsKeyActive=`menu:${this.menuId}:activeTab`}mount(e){if(this.ensureStyles(),e.innerHTML="",this.root=$e("div",`qmm ${this.opts.classes||""} ${this.opts.compact?"qmm-compact":""}`),this.opts.startHidden&&(this.root.style.display="none"),this.tabBar=$e("div","qmm-tabs"),this.views=$e("div","qmm-views"),this.root.appendChild(this.tabBar),this.root.appendChild(this.views),e.appendChild(this.root),this.tabs.size){for(let[n,r]of this.tabs)this.createTabView(n,r);this.restoreActive()}this.updateTabsBarVisibility(),this.root.addEventListener("pointerenter",this._onEnter),this.root.addEventListener("pointerleave",this._onLeave),window.addEventListener("keydown",this._onKey,!0),window.addEventListener("keyup",this._onKey,!0),window.addEventListener("blur",this._onBlur),document.addEventListener("visibilitychange",this._onBlur),this.opts.startWindowHidden&&this.setWindowVisible(!1),this.emit("mounted")}unmount(){this.root?.removeEventListener("pointerenter",this._onEnter),this.root?.removeEventListener("pointerleave",this._onLeave),window.removeEventListener("keydown",this._onKey,!0),window.removeEventListener("keyup",this._onKey,!0),window.removeEventListener("blur",this._onBlur),document.removeEventListener("visibilitychange",this._onBlur),this.root?.parentElement&&this.root.parentElement.removeChild(this.root),this.emit("unmounted")}getWindowEl(){if(!this.root)return null;let e=this.opts.windowSelector||".qws-win";return this.root.closest(e)}setWindowVisible(e){let n=this.getWindowEl();n&&(n.classList.toggle("is-hidden",!e),this.emit(e?"window:show":"window:hide"))}toggleWindow(){let e=this.getWindowEl();if(!e)return!1;let n=e.classList.contains("is-hidden");return this.setWindowVisible(n),n}isWindowVisible(){let e=this.getWindowEl();return e?!e.classList.contains("is-hidden")&&getComputedStyle(e).display!=="none":!0}setVisible(e){this.root&&(this.root.style.display=e?"":"none",this.emit(e?"show":"hide"))}toggle(){if(!this.root)return!1;let e=this.root.style.display==="none";return this.setVisible(e),e}addTab(e,n,r){return this.tabs.set(e,{title:n,render:r,badge:null}),this.root&&(this.createTabView(e,this.tabs.get(e)),this.updateTabsBarVisibility()),this}addTabs(e){return e.forEach(n=>this.addTab(n.id,n.title,n.render)),this}setTabTitle(e,n){let r=this.tabs.get(e);if(r&&(r.title=n,r.btn)){let o=r.btn.querySelector(".label");o&&(o.textContent=n)}}setTabBadge(e,n){let r=this.tabs.get(e);!r||!r.btn||(r.badge||(r.badge=document.createElement("span"),r.badge.className="badge",r.btn.appendChild(r.badge)),n==null||n===""?r.badge.style.display="none":(r.badge.textContent=n,r.badge.style.display=""))}refreshTab(e){let n=this.tabs.get(e);if(!n?.view)return;let r=this.findScrollableAncestor(n.view),o=r?r.scrollTop:null,s=r?r.scrollLeft:null,a=document.activeElement?.id||null;n.view.innerHTML="";try{n.render(n.view,this)}catch(i){n.view.textContent=String(i)}this.currentId===e&&this.switchTo(e),this.emit("tab:render",e),r&&o!=null&&requestAnimationFrame(()=>{try{r.scrollTop=o,r.scrollLeft=s??0}catch{}if(a){let i=document.getElementById(a);if(i&&i.focus)try{i.focus()}catch{}}})}findScrollableAncestor(e){function n(o){let s=getComputedStyle(o),a=s.overflowY||s.overflow;return/(auto|scroll)/.test(a)&&o.scrollHeight>o.clientHeight}let r=e;for(;r;){if(n(r))return r;r=r.parentElement}return document.querySelector(".qws-win")}firstTabId(){let e=this.tabs.keys().next();return e.done?null:e.value??null}_updateAltCursor(){this.root&&this.root.classList.toggle("qmm-alt-drag",this._altDown&&this._hovering)}getTabView(e){return this.tabs.get(e)?.view??null}removeTab(e){let n=this.tabs.get(e);if(!n)return;this.tabs.delete(e);let r=this.tabBar?.querySelector(`button[data-id="${kg(e)}"]`);if(r&&r.parentElement&&r.parentElement.removeChild(r),n.view&&n.view.parentElement&&n.view.parentElement.removeChild(n.view),this.currentId===e){let o=this.tabs.keys().next().value||null;this.switchTo(o)}this.updateTabsBarVisibility()}switchTo(e){this.currentId=e,[...this.tabBar.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),[...this.views.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),this.persistActive(),this.emit("tab:change",e)}on(e,n){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(n),()=>this.off(e,n)}off(e,n){this.events.get(e)?.delete(n)}emit(e,...n){this.events.get(e)?.forEach(r=>{try{r(...n)}catch{}})}btn(e,n){let r=typeof n=="function"?{onClick:n}:{...n||{}},o=$e("button","qmm-btn");o.type="button";let s=null;r.icon&&(s=typeof r.icon=="string"?document.createElement("span"):r.icon,typeof r.icon=="string"&&s&&(s.textContent=r.icon),s&&s.classList.add("qmm-btn__icon"));let a=(e??"").trim(),l=!s||a.length>0?document.createElement("span"):null;l&&(l.className="label",l.textContent=e),s?(a.length===0&&o.classList.add("qmm-btn--icon"),r.iconPosition==="right"?(s.classList.add("is-right"),l&&o.append(l),o.append(s)):(s.classList.add("is-left"),o.append(s),l&&o.append(l))):l&&o.append(l);let c=r.variant&&r.variant!=="default"?r.variant:null;return c&&o.classList.add(`qmm-btn--${c}`),r.fullWidth&&o.classList.add("qmm-btn--full"),r.size==="sm"&&o.classList.add("qmm-btn--sm"),r.active&&o.classList.add("active"),(r.tooltip||r.title)&&(o.title=r.tooltip||r.title||""),r.ariaLabel&&o.setAttribute("aria-label",r.ariaLabel),r.onClick&&o.addEventListener("click",r.onClick),r.disabled&&this.setButtonEnabled(o,!1),o.setEnabled=d=>this.setButtonEnabled(o,d),o.setActive=d=>o.classList.toggle("active",!!d),o}setButtonEnabled(e,n){e.disabled=!n,e.classList.toggle("is-disabled",!n),e.setAttribute("aria-disabled",(!n).toString())}flexRow(e={}){let n=document.createElement("div");return n.className=["qmm-flex",e.className||""].filter(Boolean).join(" ").trim(),n.style.display="flex",n.style.alignItems=this.mapAlign(e.align??"center"),n.style.justifyContent=this.mapJustify(e.justify??"start"),n.style.gap=`${e.gap??8}px`,n.style.flexWrap=e.wrap===!1?"nowrap":"wrap",e.fullWidth&&(n.style.width="100%"),n}formGrid(e={}){let n=document.createElement("div");return n.className="qmm-form-grid",n.style.display="grid",n.style.gridTemplateColumns=e.columns||"max-content 1fr",n.style.columnGap=`${e.columnGap??8}px`,n.style.rowGap=`${e.rowGap??8}px`,n.style.alignItems=e.align?e.align:"center",n}formRow(e,n,r={}){let o=document.createElement("div");o.className="qmm-form-row",o.style.display="grid",o.style.gridTemplateColumns=`${r.labelWidth||"160px"} 1fr`,o.style.columnGap=`${r.gap??10}px`,o.style.alignItems=r.alignTop?"start":"center",r.wrap&&o.classList.add("is-wrap");let s=this.label(e);return s.classList.add("qmm-form-row__label"),s.style.margin="0",s.style.justifySelf="start",r.alignTop&&(s.style.alignSelf="start"),o.append(s,n),{root:o,label:s}}card(e,n={}){let r=document.createElement("div");if(r.className="qmm-card",r.dataset.tone=n.tone||"default",n.align==="center"&&r.classList.add("is-center"),n.align==="stretch"&&r.classList.add("is-stretch"),n.padding&&(r.style.padding=n.padding),n.gap!=null&&(r.style.gap=`${n.gap}px`),n.maxWidth){let i=typeof n.maxWidth=="number"?`${n.maxWidth}px`:n.maxWidth;r.style.width=`min(${i}, 100%)`}let o=document.createElement("div");o.className="qmm-card__header",n.compactHeader&&o.classList.add("is-compact");let s=document.createElement("div");if(s.className="qmm-card__title",s.textContent=e,n.icon){let i=typeof n.icon=="string"?document.createElement("span"):n.icon;typeof n.icon=="string"&&i&&(i.textContent=n.icon),i&&(i.classList.add("qmm-card__icon"),o.appendChild(i))}if(o.appendChild(s),n.subtitle||n.description){let i=document.createElement("div");i.className="qmm-card__subtitle",i.textContent=n.subtitle||n.description||"",o.appendChild(i)}if(n.actions?.length){let i=document.createElement("div");i.className="qmm-card__actions",n.actions.forEach(l=>i.appendChild(l)),o.appendChild(i)}let a=document.createElement("div");return a.className="qmm-card__body",r.append(o,a),{root:r,header:o,body:a,setTitle(i){s.textContent=i}}}toggleChip(e,n={}){let r=document.createElement("label");r.className="qmm-chip-toggle",n.tooltip&&(r.title=n.tooltip);let o=document.createElement("input");o.type=n.type||"checkbox",n.name&&(o.name=n.name),n.value&&(o.value=n.value),o.checked=!!n.checked;let s=document.createElement("div");if(s.className="qmm-chip-toggle__face",n.icon){let i=typeof n.icon=="string"?document.createElement("span"):n.icon;typeof n.icon=="string"&&i&&(i.textContent=n.icon),i&&(i.classList.add("qmm-chip-toggle__icon"),s.appendChild(i))}let a=document.createElement("span");if(a.className="qmm-chip-toggle__label",a.textContent=e,s.appendChild(a),n.description){let i=document.createElement("span");i.className="qmm-chip-toggle__desc",i.textContent=n.description,s.appendChild(i)}if(n.badge){let i=document.createElement("span");i.className="qmm-chip-toggle__badge",i.textContent=n.badge,s.appendChild(i)}return r.append(o,s),{root:r,input:o,label:a}}select(e={}){let n=document.createElement("select");if(n.className="qmm-input qmm-select",e.id&&(n.id=e.id),e.width&&(n.style.minWidth=e.width),e.placeholder){let r=document.createElement("option");r.value="",r.textContent=e.placeholder,r.disabled=!0,r.selected=!0,n.appendChild(r)}return n}errorBar(){let e=document.createElement("div");return e.className="qmm-error",e.style.display="none",{el:e,show(n){e.textContent=n,e.style.display="block"},clear(){e.textContent="",e.style.display="none"}}}mapAlign(e){return e==="start"?"flex-start":e==="end"?"flex-end":e==="stretch"?"stretch":"center"}mapJustify(e){return e==="center"?"center":e==="end"?"flex-end":e==="between"?"space-between":e==="around"?"space-around":"flex-start"}label(e){let n=$e("label","qmm-label");return n.textContent=e,n}row(...e){let n=$e("div","qmm-row");return e.forEach(r=>n.appendChild(r)),n}section(e){let n=$e("div","qmm-section");return n.appendChild($e("div","qmm-section-title",Mu(e))),n}inputNumber(e=0,n=9999,r=1,o=0){let s=$e("div","qmm-input-number"),a=$e("input","qmm-input qmm-input-number-input");a.type="number",a.min=String(e),a.max=String(n),a.step=String(r),a.value=String(o),a.inputMode="numeric";let i=$e("div","qmm-spin"),l=$e("button","qmm-step qmm-step--up","\u25B2"),c=$e("button","qmm-step qmm-step--down","\u25BC");l.type=c.type="button";let d=()=>{let h=Number(a.value);if(Number.isFinite(h)){let f=Number(a.min),p=Number(a.max),m=Math.max(f,Math.min(p,h));m!==h&&(a.value=String(m))}},u=h=>{h<0?a.stepDown():a.stepUp(),d(),a.dispatchEvent(new Event("input",{bubbles:!0})),a.dispatchEvent(new Event("change",{bubbles:!0}))},y=(h,f)=>{let p=null,m=null,g=!1,S=x=>{g=!1,p=window.setTimeout(()=>{g=!0,u(f),m=window.setInterval(()=>u(f),60)},300),h.setPointerCapture?.(x.pointerId)},w=()=>{p!=null&&(clearTimeout(p),p=null),m!=null&&(clearInterval(m),m=null)};h.addEventListener("pointerdown",S),["pointerup","pointercancel","pointerleave","blur"].forEach(x=>h.addEventListener(x,w)),h.addEventListener("click",x=>{if(g){x.preventDefault(),x.stopPropagation(),g=!1;return}u(f)})};return y(l,1),y(c,-1),a.addEventListener("change",d),i.append(l,c),s.append(a,i),a.wrap=s,a}inputText(e="",n=""){let r=$e("input","qmm-input");return r.type="text",r.placeholder=e,r.value=n,r}checkbox(e=!1){let n=$e("input","qmm-check");return n.type="checkbox",n.checked=e,n}radio(e,n,r=!1){let o=$e("input","qmm-radio");return o.type="radio",o.name=e,o.value=n,o.checked=r,o}slider(e=0,n=100,r=1,o=0){let s=$e("input","qmm-range");return s.type="range",s.min=String(e),s.max=String(n),s.step=String(r),s.value=String(o),s}rangeDual(e=0,n=100,r=1,o=e,s=n){let a=$e("div","qmm-range-dual"),i=$e("div","qmm-range-dual-track"),l=$e("div","qmm-range-dual-fill");i.appendChild(l),a.appendChild(i);let c=(f,p)=>{let m=this.slider(e,n,r,f);return m.classList.add("qmm-range-dual-input",p),a.appendChild(m),m},d=c(o,"qmm-range-dual-input--min"),u=c(s,"qmm-range-dual-input--max"),y=()=>{let f=Number(d.value),p=Number(u.value),m=n-e;if(!Number.isFinite(m)||m<=0){l.style.left="0%",l.style.right="100%";return}let g=x=>Math.max(0,Math.min(100,x)),S=(Math.min(f,p)-e)/m*100,w=(Math.max(f,p)-e)/m*100;l.style.left=`${g(S)}%`,l.style.right=`${g(100-w)}%`};d.addEventListener("input",y),u.addEventListener("input",y);let h={root:a,min:d,max:u,setValues(f,p){d.value=String(f),u.value=String(p),y()},refresh:y};return h.refresh(),h}switch(e=!1){let n=this.checkbox(e);return n.classList.add("qmm-switch"),n}table(e,n){let r=document.createElement("div");r.className="qmm-table-wrap",n?.minimal&&r.classList.add("qmm-table-wrap--minimal");let o=document.createElement("div");o.className="qmm-table-scroll",n?.maxHeight&&(o.style.maxHeight=n.maxHeight),r.appendChild(o);let s=document.createElement("table");s.className="qmm-table",n?.minimal&&s.classList.add("qmm-table--minimal"),n?.compact&&s.classList.add("qmm-table--compact"),n?.fixed&&(s.style.tableLayout="fixed");let a=document.createElement("thead"),i=document.createElement("tr");e.forEach(c=>{let d=document.createElement("th");typeof c=="string"?d.textContent=c:(d.textContent=c.label??"",c.align&&d.classList.add(`is-${c.align}`),c.width&&(d.style.width=c.width)),i.appendChild(d)}),a.appendChild(i);let l=document.createElement("tbody");return s.append(a,l),o.appendChild(s),{root:r,tbody:l}}segmented(e,n,r,o){let s=document.createElement("div");s.className="qmm-seg",o?.fullWidth&&s.classList.add("qmm-seg--full"),o?.id&&(s.id=o.id),s.setAttribute("role","radiogroup"),o?.ariaLabel&&s.setAttribute("aria-label",o.ariaLabel);let a=document.createElement("div");a.className="qmm-seg__indicator",s.appendChild(a);let i=typeof window<"u"&&"matchMedia"in window?window.matchMedia("(prefers-reduced-motion: reduce)"):null,l=typeof a.animate=="function";l&&(a.style.transition="none");let c=null,d=null,u=(S,w)=>{a.style.transform=`translate3d(${S}px,0,0)`,a.style.width=`${w}px`},y=()=>{d&&(d.cancel(),d=null)},h=n,f=[],p=(S,w=!1)=>{if(S===h){w&&f.find(E=>E.dataset.value===S)?.focus(),r?.(h);return}h=S;for(let x of f){let E=x.dataset.value===S;x.setAttribute("aria-checked",E?"true":"false"),x.tabIndex=E?0:-1,x.classList.toggle("active",E),E&&w&&x.focus()}m(!0),r?.(h)},m=(S=!1)=>{let w=f.find(ie=>ie.dataset.value===h);if(!w)return;let x=f.indexOf(w),E=f.length,T=getComputedStyle(s),A=parseFloat(T.gap||T.columnGap||"0")||0,N=parseFloat(T.borderLeftWidth||"0")||0,H=parseFloat(T.borderRightWidth||"0")||0,C=s.getBoundingClientRect(),L=w.getBoundingClientRect(),v=L.left-C.left-N,B=L.width,le=C.width-N-H;if(E===1)v=0,B=le;else if(x===0){let ie=v+B+A/2;v=0,B=ie-v}else x===E-1?(v=v-A/2,B=le-v):(v=v-A/2,B=B+A);let X=window.devicePixelRatio||1,de=ie=>Math.round(ie*X)/X,_=de(v),re=de(B),R=c;c={left:_,width:re};let k=()=>u(_,re);if(!(S&&l&&!i?.matches&&R!=null&&R.width>0&&Number.isFinite(R.width)&&re>0&&Number.isFinite(re))){y(),k();return}y(),u(R.left,R.width),d=a.animate([{transform:`translate3d(${R.left}px,0,0)`,width:`${R.width}px`,opacity:.92,offset:0},{transform:`translate3d(${_}px,0,0)`,width:`${re}px`,opacity:1,offset:1}],{duration:260,easing:"cubic-bezier(.22,.7,.28,1)",fill:"forwards"});let ee=()=>{k(),d=null};d.addEventListener("finish",ee,{once:!0}),d.addEventListener("cancel",ee,{once:!0})};e.forEach(({value:S,label:w,disabled:x})=>{let E=document.createElement("button");E.type="button",E.className="qmm-seg__btn",E.dataset.value=String(S),E.setAttribute("role","radio"),E.setAttribute("aria-checked",S===n?"true":"false"),E.tabIndex=S===n?0:-1,E.disabled=!!x;let T=document.createElement("span");T.className="qmm-seg__btn-label",T.textContent=w,E.appendChild(T),E.addEventListener("click",()=>{E.disabled||p(S,!1)}),E.addEventListener("keydown",A=>{if(!["ArrowRight","ArrowLeft","Home","End"].includes(A.key))return;A.preventDefault();let N=e.findIndex(L=>L.value===h);if(A.key==="Home"){p(e[0].value,!0);return}if(A.key==="End"){p(e[e.length-1].value,!0);return}let H=A.key==="ArrowRight"?1:-1,C=N;for(let L=0;L<e.length;L++)if(C=(C+H+e.length)%e.length,!e[C].disabled){p(e[C].value,!0);break}}),f.push(E),s.appendChild(E)});let g=window.ResizeObserver?new ResizeObserver(()=>m(!1)):null;return g&&g.observe(s),window.addEventListener("resize",()=>m(!1)),queueMicrotask(()=>m(!1)),s.get=()=>h,s.set=S=>p(S,!1),s}radioGroup(e,n,r,o){let s=$e("div","qmm-radio-group");for(let{value:a,label:i}of n){let l=this.radio(e,a,r===a),c=document.createElement("label");c.className="qmm-radio-label",c.appendChild(l),c.appendChild(document.createTextNode(i)),l.onchange=()=>{l.checked&&o(a)},s.appendChild(c)}return s}bindLS(e,n,r,o,s){try{let a=localStorage.getItem(e);a!=null&&r(o(a))}catch{}return{save:()=>{try{localStorage.setItem(e,s(n()))}catch{}}}}split2(e="260px"){let n=$e("div","qmm-split");n.style.gridTemplateColumns="minmax(160px, max-content) 1fr";let r=$e("div","qmm-split-left"),o=$e("div","qmm-split-right");return n.appendChild(r),n.appendChild(o),{root:n,left:r,right:o}}vtabs(e={}){return new Cu(this,e)}hotkeyButton(e,n,r){let o=r?.emptyLabel??"None",s=r?.listeningLabel??"Press a key\u2026",a=r?.clearable??!0,i=e??null,l=!1;if(r?.storageKey)try{i=Us(localStorage.getItem(r.storageKey)||"")??e??null}catch{}let c=document.createElement("button");c.type="button",c.className="qmm-hotkey",c.setAttribute("aria-live","polite");let d=()=>{c.classList.toggle("is-recording",l),c.classList.toggle("is-empty",!i),c.classList.toggle("is-assigned",!l&&!!i),l?(c.textContent=s,c.title="Listening\u2026 press a key (Esc to cancel, Backspace to clear)"):i?(c.textContent=kA(i),c.title="Click to rebind \u2022 Right-click to clear"):(c.textContent=o,c.title="No key assigned")},u=(p,m=!1)=>{i=p?{...p}:null,m||d()};c.refreshHotkey=p=>{u(p)};let y=p=>{if(l=!1,!p){d();return}d()},h=()=>{if(r?.storageKey){let p=nn(i);try{p?localStorage.setItem(r.storageKey,p):localStorage.removeItem(r.storageKey)}catch{}}n?.(i,r?.storageKey?nn(i):void 0)},f=p=>{if(!l)return;if(p.preventDefault(),p.stopPropagation(),p.key==="Escape"){y(!1),window.removeEventListener("keydown",f,!0);return}if((p.key==="Backspace"||p.key==="Delete")&&a){u(null,!0),h(),y(!0),window.removeEventListener("keydown",f,!0);return}let m=AA(p,r?.allowModifierOnly??!1);m&&(u(m,!0),h(),y(!0),window.removeEventListener("keydown",f,!0))};return c.addEventListener("click",p=>{p.preventDefault(),l||(l=!0,d(),window.addEventListener("keydown",f,!0),c.focus())}),a&&c.addEventListener("contextmenu",p=>{p.preventDefault(),i&&(u(null,!0),h(),d())}),d(),c}createTabView(e,n){let r=document.createElement("button");r.className="qmm-tab",r.dataset.id=e,r.innerHTML=`<span class="label">${Mu(n.title)}</span><span class="badge" style="display:none"></span>`;let o=r.querySelector(".badge");n.btn=r,n.badge=o,r.onclick=()=>this.switchTo(e),this.tabBar.appendChild(r);let s=$e("div","qmm-view");s.dataset.id=e,n.view=s,this.views.appendChild(s);try{n.render(s,this)}catch(a){s.textContent=String(a)}this.currentId||this.switchTo(e)}persistActive(){if(this.currentId)try{Oe(`menu.activeTabs.${this.menuId}`,this.currentId);try{localStorage.removeItem(this.lsKeyActive)}catch{}}catch{}}restoreActive(){let e=null;try{let n=_e(`menu.activeTabs.${this.menuId}`);typeof n=="string"&&n&&(e=n)}catch{}try{e=localStorage.getItem(this.lsKeyActive)}catch{}e&&this.tabs.has(e)?this.switchTo(e):this.tabs.size&&this.switchTo(this.firstTabId())}updateTabsBarVisibility(){if(!this.tabBar||!this.root)return;this.tabs.size>0?(this.tabBar.parentElement||this.root.insertBefore(this.tabBar,this.views),this.tabBar.style.display="flex",this.root.classList.remove("qmm-no-tabs")):(this.tabBar.parentElement&&this.tabBar.parentElement.removeChild(this.tabBar),this.root.classList.add("qmm-no-tabs"))}ensureStyles(){if(document.getElementById("__qmm_css__"))return;let e=`
    /* ================= Modern UI for qmm ================= */
.qmm{
  --qmm-bg:        #0f1318;
  --qmm-bg-soft:   #0b0f13;
  --qmm-panel:     #111823cc;
  --qmm-border:    #ffffff22;
  --qmm-border-2:  #ffffff14;
  --qmm-accent:    #7aa2ff;
  --qmm-accent-2:  #92b2ff;
  --qmm-text:      #e7eef7;
  --qmm-text-dim:  #b9c3cf;
  --qmm-shadow:    0 6px 20px rgba(0,0,0,.35);
  --qmm-blur:      8px;

  display:flex; flex-direction:column; gap:10px; color:var(--qmm-text);
}
.qmm-compact{ gap:6px }

/* ---------- Tabs (pill + underline) ---------- */
.qmm-tabs{
  display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end;
  padding:0 6px 2px 6px; position:relative; isolation:isolate;
  border-bottom:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  border-top-left-radius:10px; border-top-right-radius:10px;
}
.qmm-no-tabs .qmm-views{ margin-top:0 }

.qmm-tab{
  flex:1 1 0; min-width:0; cursor:pointer;
  display:inline-flex; justify-content:center; align-items:center; gap:8px;
  padding:8px 12px; color:var(--qmm-text);
  background:transparent; border:1px solid transparent; border-bottom:none;
  border-top-left-radius:10px; border-top-right-radius:10px;
  position:relative; margin:0; margin-bottom:-1px;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;
}
.qmm-compact .qmm-tab{ padding:6px 10px }
.qmm-tab:hover{ background:rgba(255,255,255,.06) }
.qmm-tab:active{ transform:translateY(1px) }
.qmm-tab:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; border-radius:10px }

.qmm-tab .badge{
  font-size:11px; line-height:1; padding:2px 6px; border-radius:999px;
  background:#ffffff1a; border:1px solid #ffffff22;
}

.qmm-tab.active{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff; box-shadow:inset 0 -1px 0 #0007;
}
.qmm-tab.active::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-1px; height:2px;
  background:linear-gradient(90deg, transparent, var(--qmm-accent), transparent);
  border-radius:2px; box-shadow:0 0 12px var(--qmm-accent-2);
}

/* ---------- Views panel ---------- */
.qmm-views{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  display:flex; flex-direction:column;
  min-width:0; min-height:0; overflow:auto; box-shadow:var(--qmm-shadow);
}
.qmm-compact .qmm-views{ padding:8px }
.qmm-tabs + .qmm-views{ margin-top:-1px }

.qmm-view{ display:none; min-width:0; min-height:0; }
.qmm-view.active{ display:block; }

/* ---------- Basic controls ---------- */
.qmm-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.qmm-section{ margin-top:8px }
.qmm-section-title{ font-weight:650; margin:2px 0 8px 0; color:var(--qmm-text) }

.qmm-label{ opacity:.9 }
.qmm-val{ min-width:24px; text-align:center }

/* Buttons */
.qmm-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:8px 14px;
  border-radius:10px;
  border:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  color:var(--qmm-text);
  font-weight:600;
  font-size:13px;
  line-height:1.2;
  cursor:pointer;
  user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .1s ease, box-shadow .18s ease, color .18s ease;
}
.qmm-compact .qmm-btn{ padding:6px 10px }
.qmm-btn:hover{ background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); border-color:#ffffff3d }
.qmm-btn:active{ transform:translateY(1px) }
.qmm-btn:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; }
.qmm-btn:disabled,
.qmm-btn.is-disabled{
  opacity:.55;
  cursor:not-allowed;
  filter:saturate(.6);
  box-shadow:none;
}
.qmm-btn--full{ width:100%; justify-content:center; }
.qmm-btn--sm{ padding:6px 10px; font-size:12px; border-radius:8px; }
.qmm-btn--icon{ padding:6px; width:34px; height:34px; border-radius:50%; gap:0; }
.qmm-btn__icon{ display:inline-flex; align-items:center; justify-content:center; font-size:1.1em; }
.qmm-btn__icon.is-right{ order:2; }
.qmm-btn__icon.is-left{ order:0; }

/* Button variants */
.qmm-btn--primary,
.qmm-btn.qmm-primary{
  background:linear-gradient(180deg, rgba(122,162,255,.38), rgba(122,162,255,.16));
  border-color:#9db7ff55;
  box-shadow:0 4px 14px rgba(122,162,255,.26);
}
.qmm-btn--primary:hover,
.qmm-btn.qmm-primary:hover{ border-color:#afc5ff77; }
.qmm-btn--secondary{
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.01));
}
.qmm-btn--danger,
.qmm-btn.qmm-danger{
  background:linear-gradient(180deg, rgba(255,86,86,.32), rgba(255,86,86,.14));
  border-color:#ff6a6a55;
  box-shadow:0 4px 14px rgba(255,86,86,.25);
}
.qmm-btn--ghost{ background:transparent; border-color:transparent; }
.qmm-btn--ghost:hover{ background:rgba(255,255,255,.06); border-color:#ffffff2a; }
.qmm-btn.active{
  background:#79a6ff22;
  border-color:#79a6ff66;
  box-shadow: inset 0 0 0 1px #79a6ff33;
}

.qmm-flex{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

.qmm-form-grid{ width:100%; }

.qmm-form-row{ width:100%; }
.qmm-form-row.is-wrap{ grid-template-columns:1fr; }
.qmm-form-row__label{ font-weight:600; opacity:.9; }

.qmm-card{
  display:grid;
  gap:12px;
  border:1px solid var(--qmm-border);
  border-radius:12px;
  padding:14px;
  background:var(--qmm-panel);
  backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
  width:100%;
}
.qmm-card.is-center{ text-align:center; align-items:center; }
.qmm-card.is-stretch{ align-items:stretch; }
.qmm-card__header{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-between;
}
.qmm-card__header.is-compact{ gap:6px; }
.qmm-card__icon{ font-size:18px; }
.qmm-card__title{ font-weight:700; font-size:14px; letter-spacing:.01em; }
.qmm-card__subtitle{ font-size:12px; opacity:.75; flex-basis:100%; }
.qmm-card__actions{ display:flex; gap:6px; margin-left:auto; }
.qmm-card__body{ display:grid; gap:10px; }
.qmm-card[data-tone="muted"]{
  background:rgba(15,17,22,.88);
  border-color:#ffffff1a;
  box-shadow:none;
}
.qmm-card[data-tone="accent"]{
  border-color:#7aa2ff99;
  box-shadow:0 10px 26px rgba(122,162,255,.25);
}

.qmm .stats-collapse-toggle{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:6px 12px;
  min-height:32px;
  border-radius:999px;
  border:1px solid rgba(122,162,255,.45);
  background:linear-gradient(135deg, rgba(122,162,255,.18), rgba(33,59,121,.18));
  color:rgba(220,230,255,.92);
  font-size:12px;
  font-weight:600;
  letter-spacing:.01em;
  text-transform:uppercase;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 10px 24px rgba(9,13,27,.28);
  transition:background .26s ease, border-color .26s ease, box-shadow .26s ease, color .26s ease, transform .16s ease;
}
.qmm .stats-collapse-toggle:hover{
  background:linear-gradient(135deg, rgba(122,162,255,.28), rgba(53,94,182,.24));
  border-color:rgba(122,162,255,.62);
  color:#fff;
  box-shadow:0 14px 30px rgba(66,106,201,.32), inset 0 1px 0 rgba(255,255,255,.18);
}
.qmm .stats-collapse-toggle:active{
  transform:translateY(1px) scale(.99);
}
.qmm-card--collapsible[data-collapsed="true"] .stats-collapse-toggle{
  background:linear-gradient(135deg, rgba(122,162,255,.12), rgba(23,36,78,.12));
  border-color:rgba(122,162,255,.32);
  color:rgba(208,219,255,.82);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.1), 0 6px 18px rgba(9,13,27,.22);
}
.qmm-card--collapsible[data-collapsed="false"] .stats-collapse-toggle{
  background:linear-gradient(135deg, rgba(122,162,255,.36), rgba(83,124,255,.28));
  border-color:rgba(122,162,255,.78);
  color:#fff;
  box-shadow:0 16px 32px rgba(72,112,214,.35), inset 0 1px 0 rgba(255,255,255,.22);
}
.qmm .stats-collapse-toggle__icon{
  width:16px;
  height:16px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  position:relative;
  color:inherit;
  transition:transform .24s ease;
}
.qmm .stats-collapse-toggle__icon::before{
  content:"";
  position:absolute;
  width:8px;
  height:8px;
  border-right:2px solid currentColor;
  border-bottom:2px solid currentColor;
  transform:rotate(45deg);
  transition:transform .24s ease;
}
.qmm .stats-collapse-toggle__label{
  color:inherit;
  font-size:11px;
  letter-spacing:.08em;
  font-weight:700;
}
.qmm-card--collapsible[data-collapsed="false"] .stats-collapse-toggle__icon::before{
  transform:rotate(-135deg);
}
.qmm-card--collapsible[data-collapsed="true"] .stats-collapse-toggle__icon::before{
  transform:rotate(45deg);
}

.qmm-chip-toggle{
  display:inline-flex;
  align-items:stretch;
  border-radius:999px;
  border:1px solid #ffffff1f;
  background:rgba(255,255,255,.05);
  cursor:pointer;
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease, transform .1s ease;
}
.qmm-chip-toggle input{ display:none; }
.qmm-chip-toggle__face{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
}
.qmm-chip-toggle__icon{ font-size:14px; }
.qmm-chip-toggle__label{ font-weight:600; }
.qmm-chip-toggle__desc{ font-size:12px; opacity:.75; }
.qmm-chip-toggle__badge{ font-size:11px; padding:2px 6px; border-radius:999px; background:#ffffff1a; border:1px solid #ffffff22; }
.qmm-chip-toggle:hover{ border-color:#7aa2ff55; background:rgba(122,162,255,.12); }
.qmm-chip-toggle input:checked + .qmm-chip-toggle__face{
  background:linear-gradient(180deg, rgba(122,162,255,.25), rgba(122,162,255,.10));
  box-shadow:0 0 0 1px #7aa2ff55 inset, 0 6px 18px rgba(122,162,255,.22);
}

.qmm .stats-metric-grid{
  display:grid;
  gap:10px;
  grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));
}
.qmm .stats-metric{
  border-radius:12px;
  padding:12px 14px;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  display:flex;
  flex-direction:column;
  gap:6px;
  transition:border-color .18s ease, background .18s ease, transform .14s ease;
}
.qmm .stats-metric:hover{
  border-color:#7aa2ff55;
  background:linear-gradient(180deg, rgba(122,162,255,.22), rgba(122,162,255,.10));
  transform:translateY(-1px);
}
.qmm .stats-metric__label{
  font-size:12px;
  letter-spacing:.02em;
  text-transform:uppercase;
  color:var(--qmm-text-dim);
}
.qmm .stats-metric__value{
  font-size:20px;
  font-weight:700;
  color:#fff;
}

.qmm .stats-list{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.qmm .stats-list__row{
  display:grid;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:10px;
  background:rgba(255,255,255,.035);
  border:1px solid rgba(255,255,255,.08);
  transition:border-color .18s ease, background .18s ease;
}
.qmm .stats-list__row:not(.stats-list__row--header):hover{
  background:rgba(122,162,255,.12);
  border-color:#7aa2ff55;
}
.qmm .stats-list__row--header{
  background:transparent;
  border:none;
  padding:0 6px 2px 6px;
  font-size:11px;
  letter-spacing:.05em;
  text-transform:uppercase;
  color:var(--qmm-text-dim);
}
.qmm .stats-list__row--header .stats-list__cell{
  font-weight:600;
}
.qmm .stats-list__header-label--gold,
.qmm .stats-list__header-label--rainbow{
  display:inline-block;
}
.qmm .stats-list__header-label--gold{
  color:#f7d774;
  background:linear-gradient(135deg,#fff5c0 0%,#f3c76a 55%,#f5b84f 100%);
  background-clip:text;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 1px 4px rgba(0,0,0,.35);
}
.qmm .stats-list__header-label--rainbow{
  color:#ffd6ff;
  background:linear-gradient(90deg,#ff6b6b 0%,#ffd86f 25%,#6bff8f 50%,#6bc7ff 75%,#b86bff 100%);
  background-clip:text;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 1px 4px rgba(0,0,0,.35);
}
.qmm .stats-list__cell{
  min-width:0;
  font-size:13px;
}
.qmm .stats-pet__species{
  display:inline-flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.qmm .stats-pet__label{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.qmm .stats-pet__total-value{
  font-weight:700;
}
.qmm .stats-pet__sprite-icon{
  --stats-pet-sprite-size:28px;
  width:var(--stats-pet-sprite-size);
  height:var(--stats-pet-sprite-size);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  background:rgba(255,255,255,.08);
  padding:2px;
  flex-shrink:0;
}
.qmm .stats-pet__sprite-icon img{
  width:100%;
  height:100%;
  object-fit:contain;
  image-rendering:pixelated;
}
.qmm .stats-weather__name{
  display:inline-flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.qmm .stats-weather__icon{
  width:32px;
  height:32px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  background:rgba(255,255,255,.08);
  overflow:hidden;
  flex-shrink:0;
}
.qmm .stats-weather__icon img{
  width:100%;
  height:100%;
  object-fit:contain;
  image-rendering:pixelated;
}
.qmm .stats-weather__label{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.qmm .stats-list__cell--align-right{ text-align:right; }
.qmm .stats-list__cell--align-center{ text-align:center; }

.qmm .stats-pet-group{
  border:1px solid var(--stats-pet-group-border-color, rgba(255,255,255,.09));
  border-radius:12px;
  padding:10px 12px;
  background:rgba(255,255,255,.05);
  transition:border-color .18s ease, background .18s ease;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  width:100%;
}
.qmm .stats-pet-group + .stats-pet-group{
  margin-top:8px;
}
.qmm .stats-pet-group__summary{
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:650;
  font-size:13px;
  color:var(--qmm-text);
  margin:0;
  user-select:none;
  justify-content:center;
  text-align:center;
}
.qmm .stats-pet-group__content{
  margin-top:8px;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:8px;
}

.qmm-error{
  border:1px solid #ff6a6a55;
  background:rgba(120,20,20,.35);
  border-radius:10px;
  color:#ffdada;
  padding:10px;
  font-size:13px;
  line-height:1.4;
}

.qmm-select{
  background-image:linear-gradient(45deg, transparent 50%, #ffffff80 50%), linear-gradient(135deg, #ffffff80 50%, transparent 50%), linear-gradient(90deg, transparent 50%, rgba(255,255,255,.1) 50%);
  background-position:calc(100% - 18px) 50%, calc(100% - 13px) 50%, 100% 0;
  background-size:5px 5px, 5px 5px, 2.5rem 2.5rem;
  background-repeat:no-repeat;
  padding-right:34px;
}

.qmm-vlist-wrap{ display:flex; flex-direction:column; width:100%; }

/* Inputs */
.qmm-input{
  min-width:90px; background:rgba(0,0,0,.42); color:#fff;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.qmm-input::placeholder{ color:#cbd6e780 }
.qmm-input:focus{ outline:none; border-color:var(--qmm-accent); background:#0f1521; box-shadow:0 0 0 2px #7aa2ff33 }

/* Number input + spinner (unchanged API) */
.qmm-input-number{ display:inline-flex; align-items:center; gap:6px }
.qmm-input-number-input{ width:70px; text-align:center; padding-right:8px }
.qmm-spin{ display:inline-flex; flex-direction:column; gap:2px }
.qmm-step{
  width:22px; height:16px; font-size:11px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:6px; border:1px solid var(--qmm-border);
  background:rgba(255,255,255,.08); color:#fff; cursor:pointer; user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-step:hover{ background:#ffffff18; border-color:#ffffff40 }
.qmm-step:active{ transform:translateY(1px) }

/* Switch (checkbox) */
.qmm-switch{
  appearance:none; width:42px; height:24px; background:#6c7488aa; border-radius:999px;
  position:relative; outline:none; cursor:pointer; transition:background .18s ease, box-shadow .18s ease;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12);
}
.qmm-switch::before{
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px;
  background:#fff; border-radius:50%; transition:transform .2s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
}
.qmm-switch:checked{ background:linear-gradient(180deg, rgba(122,162,255,.9), rgba(122,162,255,.6)) }
.qmm-switch:checked::before{ transform:translateX(18px) }
.qmm-switch:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px }

/* Checkbox & radio (native inputs skinned lightly) */
.qmm-check, .qmm-radio{ transform:scale(1.1); accent-color: var(--qmm-accent) }

/* Slider */
.qmm-range{
  width:180px; appearance:none; background:transparent; height:22px;
}
.qmm-range:focus{ outline:none }
.qmm-range::-webkit-slider-runnable-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-moz-range-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-webkit-slider-thumb{
  appearance:none; width:16px; height:16px; border-radius:50%; margin-top:-5px;
  background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
  transition:transform .1s ease;
}
.qmm-range:active::-webkit-slider-thumb{ transform:scale(1.04) }
.qmm-range::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:#fff; border:none;
  box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
}

.qmm-range-dual{
  position:relative;
  width:100%;
  padding:18px 0 10px;
}
.qmm-range-dual-track{
  position:absolute;
  left:0;
  right:0;
  top:50%;
  transform:translateY(-50%);
  height:8px;
  border-radius:999px;
  background:linear-gradient(90deg, rgba(8,19,33,.8), rgba(27,43,68,.9));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08), inset 0 0 0 1px rgba(118,156,255,.08);
}
.qmm-range-dual-fill{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  height:8px;
  border-radius:999px;
  background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff99);
  box-shadow:0 4px 14px rgba(37,92,255,.3);
  transition:left .12s ease, right .12s ease;
}
.qmm-range-dual-input{
  position:absolute;
  left:0;
  right:0;
  top:50%;
  transform:translateY(-50%);
  width:100%;
  height:28px;
  margin:0;
  background:transparent;
  pointer-events:none;
}
.qmm-range-dual-input::-webkit-slider-runnable-track{ background:none; }
.qmm-range-dual-input::-moz-range-track{ background:none; }
.qmm-range-dual-input::-webkit-slider-thumb{
  pointer-events:auto;
  width:18px;
  height:18px;
  border-radius:50%;
  background:linear-gradient(145deg, #fff, #dce6ff);
  border:2px solid rgba(122,162,255,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.35);
  transition:transform .12s ease, box-shadow .12s ease;
}
.qmm-range-dual-input:active::-webkit-slider-thumb,
.qmm-range-dual-input:focus-visible::-webkit-slider-thumb{
  transform:scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}
.qmm-range-dual-input::-moz-range-thumb{
  pointer-events:auto;
  width:18px;
  height:18px;
  border-radius:50%;
  background:linear-gradient(145deg, #fff, #dce6ff);
  border:2px solid rgba(122,162,255,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.35);
  transition:transform .12s ease, box-shadow .12s ease;
}
.qmm-range-dual-input:active::-moz-range-thumb,
.qmm-range-dual-input:focus-visible::-moz-range-thumb{
  transform:scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}
.qmm-range-dual-input--min{ z-index:2; }
.qmm-range-dual-input--max{ z-index:3; }
.qmm-range-dual-bubble{
  position:absolute;
  top:14px;
  transform:translate(-50%, -100%);
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
  line-height:1;
  font-weight:600;
  color:#dbe6ff;
  background:rgba(17,28,46,.9);
  box-shadow:0 4px 14px rgba(0,0,0,.35);
  pointer-events:none;
  transition:opacity .12s ease, transform .12s ease;
  opacity:.85;
}
.qmm-range-dual-bubble::after{
  content:"";
  position:absolute;
  left:50%;
  bottom:-4px;
  width:8px;
  height:8px;
  background:inherit;
  transform:translateX(-50%) rotate(45deg);
  border-radius:2px;
  box-shadow:0 4px 14px rgba(0,0,0,.35);
}
.qmm-range-dual-input--min:focus-visible + .qmm-range-dual-bubble--min,
.qmm-range-dual-input--max:focus-visible + .qmm-range-dual-bubble--max,
.qmm-range-dual-input--min:active + .qmm-range-dual-bubble--min,
.qmm-range-dual-input--max:active + .qmm-range-dual-bubble--max{
  opacity:1;
  transform:translate(-50%, -110%) scale(1.02);
}

/* ---------- Minimal table ---------- */
/* container */
.qmm-table-wrap--minimal{
  border:1px solid #263040; border-radius:8px; background:#0b0f14; box-shadow:none;
}
/* scroller (height cap) */
.qmm-table-scroll{
  overflow:auto; max-height:44vh; /* override via opts.maxHeight */
}

/* base */
.qmm-table--minimal{
  width:100%;
  border-collapse:collapse;
  background:transparent;
  font-size:13px; line-height:1.35; color:var(--qmm-text, #cdd6e3);
}

/* header */
.qmm-table--minimal thead th{
  position:sticky; top:0; z-index:1;
  text-align:left; font-weight:600;
  padding:8px 10px;
  color:#cbd5e1; background:#0f1318;
  border-bottom:1px solid #263040;
  text-transform:none; letter-spacing:0;
}
.qmm-table--minimal thead th.is-center { text-align: center; }
.qmm-table--minimal thead th.is-left   { text-align: left; }   /* d\xE9j\xE0 pr\xE9sent, ok */
.qmm-table--minimal thead th.is-right  { text-align: right; }
.qmm-table--minimal thead th,
.qmm-table--minimal td { vertical-align: middle; }

/* cells */
.qmm-table--minimal td{
  padding:8px 10px; border-bottom:1px solid #1f2937; vertical-align:middle;
}
.qmm-table--minimal tbody tr:hover{ background:#0f1824; }

/* compact variant */
.qmm-table--compact thead th,
.qmm-table--compact td{ padding:6px 8px; font-size:12px }

/* utils */
.qmm-table--minimal td.is-num{ text-align:right; font-variant-numeric:tabular-nums }
.qmm-table--minimal td.is-center{ text-align:center }
.qmm-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.qmm-prewrap{ white-space:pre-wrap; word-break:break-word }


/* ---------- Split panels ---------- */
.qmm-split{
  display:grid; gap:12px;
  grid-template-columns:minmax(180px,260px) minmax(0,1fr);
  align-items:start;
}
.qmm-split-left{ display:flex; flex-direction:column; gap:10px }
.qmm-split-right{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
}

/* ---------- VTabs (vertical list + filter) ---------- */
.qmm-vtabs{ display:flex; flex-direction:column; gap:8px; min-width:0 }
.qmm-vtabs .filter{ display:block }
.qmm-vtabs .filter input{ width:100% }

.qmm-vlist{
  flex:0 0 auto; overflow:visible;
  border:1px solid var(--qmm-border); border-radius:12px; padding:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
}

.qmm-vtab{
  width:100%; text-align:left; cursor:pointer;
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:8px 10px; border-radius:10px; border:1px solid #ffffff18;
  background:rgba(255,255,255,.03); color:inherit;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-vtab:hover{ background:rgba(255,255,255,.07); border-color:#ffffff34 }
.qmm-vtab:active{ transform:translateY(1px) }
.qmm-vtab.active{
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.08));
  border-color:#9db7ff55;
  box-shadow:0 1px 14px rgba(122,162,255,.18) inset;
}

.qmm-dot{ width:10px; height:10px; border-radius:50%; justify-self:center; box-shadow:0 0 0 1px #0006 inset }
.qmm-chip{ display:flex; align-items:center; gap:8px; min-width:0 }
.qmm-chip img{
  width:20px; height:20px; border-radius:50%; object-fit:cover; border:1px solid #4446;
  box-shadow:0 1px 0 rgba(255,255,255,.08) inset;
}
.qmm-chip .t{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.qmm-tag{
  font-size:11px; line-height:1; padding:3px 7px; border-radius:999px;
  background:#ffffff14; border:1px solid #ffffff26;
}

/* ---------- Small helpers (optional) ---------- */
.qmm .qmm-card{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur)); box-shadow:var(--qmm-shadow);
}
  .qmm .qmm-help{ font-size:12px; color:var(--qmm-text-dim) }
  .qmm .qmm-sep{ height:1px; background:var(--qmm-border); width:100%; opacity:.6; }

/* ta poign\xE9e, inchang\xE9 */
.qmm-grab { margin-left:auto; opacity:.8; cursor:grab; user-select:none; }
.qmm-grab:active { cursor:grabbing; }
.qmm-dragging { opacity:.6; }

/* items animables */
.qmm-team-item {
  will-change: transform;
  transition: transform 160ms ease;
}
.qmm-team-item.drag-ghost {
  opacity: .4;
}

.qmm.qmm-alt-drag { cursor: grab; }
.qmm.qmm-alt-drag:active { cursor: grabbing; }

.qws-win.is-hidden { display: none !important; }

.qmm-hotkey{
  cursor:pointer; user-select:none;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 12px;
  background:linear-gradient(180deg, #ffffff10, #ffffff06);
  color:var(--qmm-text);
  box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.18);
  transition:
    background .18s ease,
    border-color .18s ease,
    box-shadow .18s ease,
    transform .08s ease,
    color .18s ease;
}
.qmm-hotkey{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  white-space:nowrap;
  width: var(--qmm-hotkey-w, 180px); 
}
.qmm-hotkey:hover{ background:linear-gradient(180deg, #ffffff16, #ffffff08); border-color:#ffffff40 }
.qmm-hotkey:active{ transform:translateY(1px) }

.qmm-hotkey:focus-visible{ outline:none }

.qmm-hotkey.is-empty{
  color:var(--qmm-text-dim);
  font-style:italic;
}

.qmm-hotkey.is-assigned{
  border-color: rgba(122,162,255,.45);
  box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.18), 0 0 0 2px rgba(122,162,255,.24);
}

.qmm-hotkey.is-recording{
  outline:2px solid var(--qmm-accent);
  outline-offset:2px;
  border-color: var(--qmm-accent);
  background:linear-gradient(180deg, rgba(122,162,255,.25), rgba(122,162,255,.10));
  animation: qmm-hotkey-breathe 1.2s ease-in-out infinite;
}
  
@keyframes qmm-hotkey-breathe{
  0%   { box-shadow: 0 0 0 0 rgba(122,162,255,.55), 0 1px 16px rgba(0,0,0,.25); }
  60%  { box-shadow: 0 0 0 12px rgba(122,162,255,0), 0 1px 16px rgba(0,0,0,.25); }
  100% { box-shadow: 0 0 0 0 rgba(122,162,255,0),  0 1px 16px rgba(0,0,0,.25); }
}

/* ---------- Segmented (minimal, modern) ---------- */
.qmm-seg{
  --seg-pad: 8px;
  --seg-radius: 999px;
  --seg-stroke: 1.2px;      /* \xE9paisseur du trait */
  --seg-nudge-x: 0px;       /* micro-ajustements optionnels */
  --seg-nudge-w: 0px;
  --seg-fill: rgba(122,162,255,.05);           
  --seg-stroke-color: rgba(122,162,255,.60);

  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: var(--seg-pad);
  border-radius: var(--seg-radius);
  background: var(--qmm-bg-soft);
  border: 1px solid var(--qmm-border-2);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  overflow: hidden;
  background-clip: padding-box; /* important pour que le fond ne passe pas sous la bordure */
}

.qmm-seg--full{ display:flex; width:100% }

.qmm-seg__btn{
  position: relative;
  z-index: 1;
  appearance: none; background: transparent; border: 0; cursor: pointer;
  padding: 8px 14px;
  border-radius: 999px;
  color: var(--qmm-text-dim);
  font: inherit; line-height: 1; white-space: nowrap;
  transition: color .15s ease, transform .06s ease;
}
.qmm-seg__btn-label{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: inherit;
}
.qmm-compact .qmm-seg__btn{ padding: 6px 10px }
.qmm-seg__btn:hover{ color: var(--qmm-text); }
.qmm-seg__btn.active{ color:#fff; font-weight:600; }
.qmm-seg__btn:active{ transform: translateY(1px); }
.qmm-seg__btn[disabled]{ opacity:.5; cursor:not-allowed; }

.qmm-seg__indicator{
  position: absolute;
  top: 0; left: 0;
  height: 100%;
  width: 40px;                      /* maj en JS */
  border-radius: inherit;
  background: var(--seg-fill);              /* \u2B05\uFE0F applique la couleur */
  outline: var(--seg-stroke,1.2px) solid var(--seg-stroke-color);
  outline-offset: calc(-1 * var(--seg-stroke));

  box-shadow: 0 1px 4px rgba(122,162,255,.10);
  transform-origin: left center;
  will-change: transform, width, opacity;
  transition: transform .18s cubic-bezier(.2,.8,.2,1),
              width .18s cubic-bezier(.2,.8,.2,1),
              opacity .18s ease-out;
  pointer-events: none;
}

/* Accessibilit\xE9 */
@media (prefers-reduced-motion: reduce){
  .qmm-seg__indicator, .qmm-seg__btn { transition: none; }
}  /* \u2190 manquait cette accolade */

    `,n=document.createElement("style");n.id="__qmm_css__",n.textContent=e,(document.documentElement||document.body).appendChild(n)}},Cu=class{constructor(e,n={}){this.api=e;this.opts=n;pe(this,"root");pe(this,"filterWrap",null);pe(this,"filterInput",null);pe(this,"list");pe(this,"listWrap",null);pe(this,"items",[]);pe(this,"selectedId",null);pe(this,"onSelectCb");pe(this,"renderItemCustom");pe(this,"emptyText");this.root=$e("div","qmm-vtabs"),this.root.style.minWidth="0",this.emptyText=n.emptyText||"Aucun \xE9l\xE9ment.",this.renderItemCustom=n.renderItem,n.filterPlaceholder&&(this.filterWrap=$e("div","filter"),this.filterInput=document.createElement("input"),this.filterInput.type="search",this.filterInput.placeholder=n.filterPlaceholder,this.filterInput.className="qmm-input",this.filterInput.oninput=()=>this.renderList(),this.filterWrap.appendChild(this.filterInput),this.root.appendChild(this.filterWrap)),this.list=$e("div","qmm-vlist"),this.list.style.minWidth="0",n.maxHeightPx&&(this.list.style.maxHeight=`${n.maxHeightPx}px`,this.list.style.overflow="auto",this.list.style.flex="1 1 auto"),n.fillAvailableHeight?(this.listWrap=document.createElement("div"),this.listWrap.className="qmm-vlist-wrap",Object.assign(this.listWrap.style,{flex:"1 1 auto",minHeight:"0",display:"flex",flexDirection:"column"}),this.list.style.flex="1 1 auto",n.maxHeightPx||(this.list.style.overflow="auto"),this.listWrap.appendChild(this.list),this.root.appendChild(this.listWrap)):this.root.appendChild(this.list),this.selectedId=n.initialId??null,this.onSelectCb=n.onSelect}setItems(e){this.items=Array.isArray(e)?e.slice():[],this.selectedId&&!this.items.some(n=>n.id===this.selectedId)&&(this.selectedId=this.items[0]?.id??null),this.renderList()}getSelected(){return this.items.find(e=>e.id===this.selectedId)??null}select(e){this.selectedId=e,this.renderList(),this.onSelectCb?.(this.selectedId,this.getSelected())}onSelect(e){this.onSelectCb=e}setBadge(e,n){let r=this.list.querySelector(`button[data-id="${kg(e)}"]`);if(!r)return;let o=r.querySelector(".qmm-tag");!o&&n!=null&&(o=$e("span","qmm-tag"),r.appendChild(o)),o&&(n==null||n===""?o.style.display="none":(o.textContent=n,o.style.display=""))}getFilter(){return(this.filterInput?.value||"").trim().toLowerCase()}renderList(){let e=this.list.scrollTop;this.list.innerHTML="";let n=this.getFilter(),r=n?this.items.filter(s=>(s.title||"").toLowerCase().includes(n)||(s.subtitle||"").toLowerCase().includes(n)):this.items;if(!r.length){let s=document.createElement("div");s.style.opacity="0.75",s.textContent=this.emptyText,this.list.appendChild(s);return}let o=document.createElement("ul");o.style.listStyle="none",o.style.margin="0",o.style.padding="0",o.style.display="flex",o.style.flexDirection="column",o.style.gap="4px";for(let s of r){let a=document.createElement("li"),i=document.createElement("button");if(i.className="qmm-vtab",i.dataset.id=s.id,i.disabled=!!s.disabled,this.renderItemCustom)this.renderItemCustom(s,i);else{let l=$e("div","qmm-dot");l.style.background=s.statusColor||"#999a";let c=$e("div","qmm-chip"),d=document.createElement("img");d.src=s.avatarUrl||"",d.alt=s.title;let u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.gap="2px";let y=$e("div","t");y.textContent=s.title;let h=document.createElement("div");if(h.textContent=s.subtitle||"",h.style.opacity="0.7",h.style.fontSize="12px",s.subtitle||(h.style.display="none"),u.appendChild(y),u.appendChild(h),c.appendChild(d),c.appendChild(u),i.appendChild(l),i.appendChild(c),s.badge!=null){let f=$e("span","qmm-tag",Mu(String(s.badge)));i.appendChild(f)}else{let f=document.createElement("div");f.style.width="0",i.appendChild(f)}}i.classList.toggle("active",s.id===this.selectedId),i.onclick=()=>this.select(s.id),a.appendChild(i),o.appendChild(a)}this.list.appendChild(o),this.list.scrollTop=e}};function $e(t,e,n){let r=document.createElement(t);return e&&(r.className=e),n!=null&&(r.innerHTML=n),r}function kg(t){return t.replace(/"/g,'\\"')}function Mu(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}var CA=new Set(["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"]);function MA(t,e){if(t===e)return!0;let n=t==="AltLeft"||t==="AltRight",r=t==="ControlLeft"||t==="ControlRight",o=t==="ShiftLeft"||t==="ShiftRight",s=t==="MetaLeft"||t==="MetaRight";return!!(n&&(e==="AltLeft"||e==="AltRight")||r&&(e==="ControlLeft"||e==="ControlRight")||o&&(e==="ShiftLeft"||e==="ShiftRight")||s&&(e==="MetaLeft"||e==="MetaRight"))}function Pg(){return navigator.platform?.toLowerCase().includes("mac")||/mac|iphone|ipad|ipod/i.test(navigator.userAgent)}function AA(t,e=!1){return(CA.has(t.code)||t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta")&&!e?null:{code:t.code,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}}function To(t,e){return!e||!!e.ctrl!==t.ctrlKey||!!e.shift!==t.shiftKey||!!e.alt!==t.altKey||!!e.meta!==t.metaKey?!1:MA(e.code,t.code)}function nn(t){if(!t)return"";let e=[];return t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push("Meta"),t.code&&e.push(t.code),e.join("+")}function Us(t){if(!t)return null;let e=t.split("+").map(o=>o.trim()).filter(Boolean);if(!e.length)return null;let r={code:TA(e.pop()||"")};for(let o of e){let s=o.toLowerCase();s==="ctrl"||s==="control"?r.ctrl=!0:s==="shift"?r.shift=!0:s==="alt"?r.alt=!0:(s==="meta"||s==="cmd"||s==="command")&&(r.meta=!0)}return r.code?r:null}var cl={space:"Space",enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",bracketleft:"BracketLeft",bracketright:"BracketRight",backslash:"Backslash",slash:"Slash",minus:"Minus",equal:"Equal",semicolon:"Semicolon",quote:"Quote",backquote:"Backquote",comma:"Comma",period:"Period",dot:"Period",capslock:"CapsLock",numlock:"NumLock",scrolllock:"ScrollLock",pause:"Pause",contextmenu:"ContextMenu",printscreen:"PrintScreen",metaleft:"MetaLeft",metaright:"MetaRight",altleft:"AltLeft",altright:"AltRight",controlleft:"ControlLeft",controlright:"ControlRight",shiftleft:"ShiftLeft",shiftright:"ShiftRight"};function TA(t){let e=t.trim();if(!e)return"";let n=e.toLowerCase(),r=n.match(/^key([a-z])$/);if(r)return`Key${r[1].toUpperCase()}`;let o=n.match(/^digit([0-9])$/);if(o)return`Digit${o[1]}`;let s=n.match(/^numpad([0-9])$/);if(s)return`Numpad${s[1]}`;if(n.startsWith("numpad")){let l=n.slice(6);return l?`Numpad${cl[l]??Ig(l)}`:"Numpad"}let a=n.match(/^f([0-9]{1,2})$/);if(a)return`F${a[1]}`;let i=n.match(/^arrow([a-z]+)$/);if(i){let l=i[1];return`Arrow${cl[l]??Ig(l)}`}return cl[n]?cl[n]:e[0].toUpperCase()+e.slice(1)}function Ig(t){return t?t[0].toUpperCase()+t.slice(1):""}function IA(t){if(t==="AltLeft"||t==="AltRight")return"Alt";if(t==="ControlLeft"||t==="ControlRight")return"Ctrl";if(t==="ShiftLeft"||t==="ShiftRight")return"Shift";if(t==="MetaLeft"||t==="MetaRight")return Pg()?"\u2318":"Meta";if(t.startsWith("Key"))return t.slice(3);if(t.startsWith("Digit"))return t.slice(5);if(t.startsWith("Numpad"))return"Numpad "+t.slice(6);let e={ArrowUp:"\u2191",ArrowDown:"\u2193",ArrowLeft:"\u2190",ArrowRight:"\u2192"};return e[t]?e[t]:t}function kA(t){if(!t)return"\u2014";let e=Pg(),n=[];e?(t.ctrl&&n.push("\u2303"),t.alt&&n.push("\u2325"),t.shift&&n.push("\u21E7"),t.meta&&n.push("\u2318")):(t.ctrl&&n.push("Ctrl"),t.alt&&n.push("Alt"),t.shift&&n.push("Shift"),t.meta&&n.push("Meta"));let r=t.alt&&(t.code==="AltLeft"||t.code==="AltRight")||t.ctrl&&(t.code==="ControlLeft"||t.code==="ControlRight")||t.shift&&(t.code==="ShiftLeft"||t.code==="ShiftRight")||t.meta&&(t.code==="MetaLeft"||t.code==="MetaRight"),o=n.slice(),s=IA(t.code);return(!r||o.length===0)&&o.push(s),o.length?o.join(e?"":" + "):s}var PA=[{id:"gui",title:"GUI",icon:"\u{1F5A5}\uFE0F",description:"Choose how you open and move the overlay.",actions:[{id:"gui.toggle",label:"\u{1F441}\uFE0F Toggle menu visibility",hint:"Opens or closes the Arie's Mod overlay.",defaultHotkey:{alt:!0,code:"KeyX"}},{id:"gui.drag",label:"\u270B Drag HUD",hint:"Hold to drag menus interfaces around the screen.",defaultHotkey:{alt:!0,code:"AltLeft"},allowModifierOnly:!0}]},{id:"shops",title:"Shops",icon:"\u{1F6D2}",description:"Quick shortcuts to every shop tab.",actions:[{id:"shops.seeds",label:"\u{1F330} Seeds shop",defaultHotkey:{alt:!0,code:"KeyS"}},{id:"shops.eggs",label:"\u{1F95A} Eggs shop",defaultHotkey:{alt:!0,code:"KeyE"}},{id:"shops.decors",label:"\u{1FA91} Decors shop",defaultHotkey:{alt:!0,code:"KeyD"}},{id:"shops.tools",label:"\u{1F9FA} Tools shop",defaultHotkey:{alt:!0,code:"KeyT"}}]},{id:"game",title:"Game",icon:"\u{1F3AE}",description:"Remap the in-game actions",actions:[{id:"game.action",label:"\u26A1 Action",defaultHotkey:{code:"Space"},holdDetection:{label:"Hold to repeat",defaultEnabled:!1}},{id:"game.inventory",label:"\u{1F392} Inventory",defaultHotkey:{code:"KeyE"}},{id:"game.move-up",label:"\u2B06 Move up",defaultHotkey:{code:"KeyW"}},{id:"game.move-down",label:"\u2B07 Move down",defaultHotkey:{code:"KeyS"}},{id:"game.move-left",label:"\u2B05 Move left",defaultHotkey:{code:"KeyA"}},{id:"game.move-right",label:"\u27A1 Move right",defaultHotkey:{code:"KeyD"}}]},{id:"sell",title:"Sell",icon:"\u{1F4B0}",description:"Streamline selling actions.",actions:[{id:"sell.sell-all",label:"\u{1F33E} All crops",hint:"Trigger the sell-all flow for harvested crops.",defaultHotkey:null},{id:"sell.sell-all-pets",label:"\u{1F43E} All pets",hint:"Sell every non-favorited pet in your inventory.",defaultHotkey:null}]},{id:"editor",title:"Editor",icon:"\u{1F4DD}",description:"Shortcuts for placing/removing items and toggling editor overlays.",actions:[{id:"editor.place-remove",label:"Place / Remove item",hint:"Place selected item on empty tile, or remove the item under your feet.",defaultHotkey:{code:"Space"}},{id:"editor.toggle-overlays",label:"Toggle editor overlays",hint:"Show or hide the editor panels.",defaultHotkey:{code:"KeyU"}},{id:"editor.delete-inventory",label:"Remove selected item from inventory",hint:"Remove the currently selected inventory item.",defaultHotkey:{code:"Delete"}}]}],Pu="keybinds.bindings",Ng="keybinds.hold",LA="aries_mod",Dg="__none__",Ys=new Map,Qs=new Map,pr=new Map,Io=new Map,Br=new Map,Po=new Map,ko=new Map,qg=PA.map(t=>{let e=t.actions.map(n=>{let r={id:n.id,sectionId:t.id,label:n.label,hint:n.hint,allowModifierOnly:n.allowModifierOnly,defaultHotkey:cn(n.defaultHotkey),holdDetection:n.holdDetection?{label:n.holdDetection.label,description:n.holdDetection.description,defaultEnabled:n.holdDetection.defaultEnabled}:void 0};return Ys.set(r.id,r),Qs.set(r.id,cn(n.defaultHotkey)),n.holdDetection&&Br.set(r.id,!!n.holdDetection.defaultEnabled),r});return{id:t.id,title:t.title,description:t.description,icon:t.icon,actions:e}}),Vs="pets",RA="pets.team.",ml="pets.team.next",fl="pets.team.prev",Lu={id:Vs,title:"Pets",icon:"\u{1F437}",description:"Assign shortcuts to your pet teams and cycle through them instantly.",actions:[]};qg.push(Lu);var Iu=new Set;function Js(t){return`${RA}${t}`}function _A(t){Ys.delete(t),Qs.delete(t),pr.delete(t),Io.delete(t),Br.delete(t),Po.delete(t),ko.delete(t)}function Au(t,e){let n={id:t.id,sectionId:Vs,label:t.label,hint:t.hint,allowModifierOnly:t.allowModifierOnly,defaultHotkey:cn(e),holdDetection:t.holdDetection?{label:t.holdDetection.label,description:t.holdDetection.description,defaultEnabled:t.holdDetection.defaultEnabled}:void 0};Ys.set(n.id,n),Qs.set(n.id,cn(e)),Iu.add(n.id),Lu.actions.push(n)}function Ru(t){for(let e of Iu)_A(e);Iu.clear(),Lu.actions=[],Au({id:fl,sectionId:Vs,label:"\u25C0\uFE0F Previous team",defaultHotkey:null},null),Au({id:ml,sectionId:Vs,label:"\u25B6\uFE0F Next team",defaultHotkey:null},null),t.forEach((e,n)=>{let r=String(e?.name||"").trim(),o=r.length?r:`Team ${n+1}`;Au({id:Js(e.id),sectionId:Vs,label:`Use team \u2014 ${o}`,defaultHotkey:null},null)})}Ru([]);var NA={"game.action":"Space","game.inventory":"KeyE","game.move-up":"KeyW","game.move-down":"KeyS","game.move-left":"KeyA","game.move-right":"KeyD"},DA=["game.action","game.inventory","game.move-up","game.move-down","game.move-left","game.move-right"],ul=new Map,Lg=!1,ku="game.action",qA=new Set,dl=new Set;function OA(){let t=ul.get(ku);if(!t)return[];let e=t.combo;return typeof e=="string"&&e.length?[e]:[]}function Rg(){let t=qA.size>0,e=new Set;if(t)for(let n of OA())n&&e.add(n);for(let n of dl)if(!e.has(n))try{pn.unblock(n)}catch{}if(t){for(let n of e)if(!dl.has(n))try{pn.block(n)}catch{}}if(dl.clear(),t)for(let n of e)dl.add(n)}function FA(t){if(!t)return null;let e=nn(t);return e.length?e:null}function BA(t){try{pn.unblock(t)}catch{}try{let e=pn.current();for(let[n,r]of Object.entries(e))if(String(r).split("+").pop()===t)try{pn.remove(n)}catch{}}catch{}}function Og(){return typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(navigator.platform||"")}function HA(t){if(!t)return"";let e=t.match(/^Key([A-Z])$/);if(e)return e[1];let n=t.match(/^Digit([0-9])$/);return n?n[1]:t==="ControlLeft"||t==="ControlRight"?"Ctrl":t==="AltLeft"||t==="AltRight"?"Alt":t==="ShiftLeft"||t==="ShiftRight"?"Shift":t==="MetaLeft"||t==="MetaRight"?Og()?"\u2318":"Win":t==="Space"?"Space":t==="Enter"?"Enter":t==="Escape"?"Esc":t==="Tab"?"Tab":t==="Backspace"?"Backspace":t==="Delete"?"Del":t==="Insert"?"Ins":t==="ArrowUp"?"\u2191":t==="ArrowDown"?"\u2193":t==="ArrowLeft"?"\u2190":t==="ArrowRight"?"\u2192":t}function WA(t){if(!t)return"\u2014";let e=[];t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push(Og()?"\u2318":"Win");let n="",r=t.key;return typeof r=="string"&&r.length===1?n=r.toUpperCase():n=HA(t.code),(n&&["Ctrl","Shift","Alt","\u2318","Win"].includes(n)?e:e.concat(n?[n]:[])).join(" + ")}function Tu(t){if(typeof window>"u")return;let e=NA[t];BA(e);let n=ul.get(t);if(n){if(n.rapidFire)try{pn.stopRapidFire(n.combo)}catch{}ul.delete(t)}let r=FA(Et(t));if(!r){t===ku&&Rg();return}let o=Zs(t),s=!1;if(r!==e)try{pn.replace(e,r),s=!0}catch{}let a=!1;if(o)try{pn.startRapidFire({trigger:r,emit:r,mode:"tap",rateHz:10}),a=!0}catch{}ul.set(t,{combo:r,replaced:s,rapidFire:a}),t===ku&&Rg()}function cn(t){return t?{...t}:null}function zA(t,e){return!t&&!e?!0:!t||!e?!1:nn(t)===nn(e)}function GA(t){if(typeof window>"u")return;let n=_e(Pu)?.[t];return n==null?void 0:n===Dg||typeof n!="string"?null:Us(n)??null}function _g(t,e){typeof window>"u"||mi(Pu,n=>{let r=n&&typeof n=="object"?{...n}:{};return e?r[t]=nn(e):r[t]=Dg,r})}function jA(t){typeof window>"u"||mi(Pu,e=>{let n=e&&typeof e=="object"?{...e}:{};return delete n[t],n})}function KA(t){if(typeof window>"u")return;let n=_e(Ng)?.[t];if(n!=null){if(typeof n=="string")return n==="1";if(typeof n=="number")return n===1;if(typeof n=="boolean")return n}}function UA(t,e){typeof window>"u"||mi(Ng,n=>{let r=n&&typeof n=="object"?{...n}:{};return r[t]=!!e,r})}function Fg(t){let e=ko.get(t);if(!e||e.size===0)return;let n=Zs(t);for(let r of e)r(n)}function pl(t){let e=Io.get(t);if(!e||e.size===0)return;let n=cn(Et(t));for(let r of e)r(n)}function VA(t){if(pr.has(t))return cn(pr.get(t)??null);let e=GA(t),n=cn(e===void 0?Qs.get(t)??null:e);return pr.set(t,n),cn(n)}function Bg(t){if(!Br.has(t))return!1;if(Po.has(t))return Po.get(t)??!1;let e=KA(t),n=e===void 0?!!Br.get(t):e;return Po.set(t,n),n}function Et(t){return VA(t)}function Hg(t){return cn(Qs.get(t)??null)}function $s(t,e){let n=Et(t);if(zA(n,e))return;let r=cn(e);if(r){let o=nn(r);for(let s of Ys.keys()){if(s===t)continue;let a=Et(s);a&&nn(a)===o&&(pr.set(s,null),_g(s,null),pl(s))}}pr.set(t,r),_g(t,r),pl(t)}function Wg(t){pr.delete(t),jA(t),pl(t)}function Zs(t){return Bg(t)}function _u(t,e){!Br.has(t)||Bg(t)===e||(Po.set(t,e),UA(t,e),Fg(t))}function yl(t,e){if(!Br.has(t))return()=>{};let n=ko.get(t)??new Set;return ko.has(t)||ko.set(t,n),n.add(e),()=>{n.delete(e),n.size===0&&ko.delete(t)}}function Mn(t,e){let n=Io.get(t)??new Set;return Io.has(t)||Io.set(t,n),n.add(e),()=>{n.delete(e),n.size===0&&Io.delete(t)}}function An(t,e){return To(e,Et(t))}function zg(){if(!(Lg||typeof window>"u")){Lg=!0;for(let t of DA)Tu(t),Mn(t,()=>Tu(t)),yl(t,()=>Tu(t))}}function Gg(t){return WA(Et(t))}function jg(){return qg.map(t=>({...t,actions:t.actions.map(e=>({...e,defaultHotkey:cn(e.defaultHotkey),holdDetection:e.holdDetection?{label:e.holdDetection.label,description:e.holdDetection.description,defaultEnabled:e.holdDetection.defaultEnabled}:void 0}))}))}typeof window<"u"&&window.addEventListener("storage",t=>{if(t.key===LA){pr.clear(),Po.clear();for(let e of Ys.keys())pl(e);for(let e of Br.keys())Fg(e)}});function mr(t){let e=t.target;return e?e.isContentEditable||e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT":!1}var Nu=class{constructor(e={}){pe(this,"found",new Set);pe(this,"meta",new Map);pe(this,"groupsMap",new Map);pe(this,"atomKey");pe(this,"min");pe(this,"max");pe(this,"gainFactor");pe(this,"howler",null);pe(this,"minVariantsPerAutoGroup");this.atomKey=e.atomKey??"soundEffectsVolumeAtom",this.min=e.min??.001,this.max=e.max??.2000000000000001,this.gainFactor=e.gainFactor??1,this.minVariantsPerAutoGroup=e.minVariantsPerAutoGroup??2,e.autoScan&&this.init()}async init(){await this.scanAll()}abs(e){try{return new URL(e,location.href).href}catch{return e}}isMP3(e){return/\.mp3(?:[\?#][^\s'"]*)?$/i.test(e)}fileName(e){try{return new URL(e,location.href).pathname.split("/").pop()||e}catch{return String(e)}}logicalName(e){return e.replace(/-[A-Za-z0-9_=-]{6,}(?=\.mp3$)/i,"")}clamp(e,n,r){return Math.max(n,Math.min(r,e))}choose(e){return e&&e.length?e[Math.random()*e.length|0]:void 0}toKey(e){return String(e||"").trim().toLowerCase()}add(e,n){if(!e||!this.isMP3(e))return;let r=this.abs(e);if(this.found.has(r))this.meta.get(r)?.from.add(n);else{this.found.add(r);let o=this.fileName(r);this.meta.set(r,{from:new Set([n]),name:o,logicalName:this.logicalName(o)})}}refreshHowler(){return this.howler=window.Howler&&Array.isArray(window.Howler._howls)?window.Howler:null,this.howler}sameAsset(e,n){try{let r=new URL(e,location.href).href,o=new URL(n,location.href).href;if(r===o)return!0;let s=l=>new URL(l,location.href).pathname.split("/").pop(),a=this.logicalName(s(r)),i=this.logicalName(s(o));return a===i}catch{return e===n}}readAtomRaw(){let e=localStorage.getItem(this.atomKey);if(e==null)return null;try{let n=JSON.parse(e);if(typeof n=="number")return n;let r=JSON.stringify(n).match(/-?\d+(?:\.\d+)?/);return r?parseFloat(r[0]):null}catch{let n=String(e).match(/-?\d+(?:\.\d+)?/);return n?parseFloat(n[0]):null}}howlerMaster(){try{return window.Howler&&typeof window.Howler.volume=="function"?window.Howler.volume():1}catch{return 1}}finalVolumeObj(){let e=this.readAtomRaw();e==null&&(e=this.max);let n=this.clamp(e,this.min,this.max),o=(Math.abs(n-this.min)<1e-6?0:n)*this.howlerMaster()*this.gainFactor;return{raw:e,clamped:n,vol:o}}async scanPerformance(){performance.getEntriesByType("resource").map(e=>e.name).filter(Boolean).forEach(e=>this.add(e,"perf"))}async scanHowler(){this.refreshHowler(),this.howler&&this.howler._howls.forEach(e=>{let n=e&&(e._src||e._urls&&e._urls[0]);n&&this.add(n,"howler")})}async scanCaches(){if("caches"in window)try{let e=await caches.keys();for(let n of e){let o=await(await caches.open(n)).keys();for(let s of o){let a=s.url;this.isMP3(a)&&this.add(a,`cache:${n}`)}}}catch{}}async fetchText(e){try{let n=await fetch(e,{mode:"same-origin",credentials:"same-origin"});if(!n.ok)return"";let r=n.headers.get("content-type")||"";return/javascript|ecmascript|css|html/i.test(r)?await n.text():""}catch{return""}}extractMp3s(e){if(!e)return[];let n=/["'`](\/?[^"'`)\s]+?\.mp3(?:\?[^"'`\s]*)?)["'`]/ig,r=[],o;for(;o=n.exec(e);)r.push(o[1]);return r}async scanResourcesForRefs(){let e=new Set;document.querySelectorAll('script[src],link[rel="stylesheet"][href]').forEach(r=>{let o=r.src||r.href;try{let s=new URL(o,location.href);s.origin===location.origin&&e.add(s.href)}catch{}}),e.add(location.href),(await Promise.all([...e].map(r=>this.fetchText(r)))).forEach((r,o)=>{for(let s of this.extractMp3s(r))this.add(s,`ref:${[...e][o]}`)})}async scanDOM(){document.querySelectorAll("audio[src]").forEach(n=>this.add(n.getAttribute("src")||"","dom")),document.querySelectorAll("source[src]").forEach(n=>this.add(n.getAttribute("src")||"","dom"));let e=document.documentElement?.outerHTML||"";for(let n of this.extractMp3s(e))this.add(n,"html")}async scanAll(){return this.found.clear(),this.meta.clear(),await Promise.all([this.scanPerformance(),this.scanHowler(),this.scanCaches(),this.scanDOM()]),await this.scanResourcesForRefs(),this.autoGroups({overwrite:!0}),this.urls()}inferGroupKey(e){let n=String(e||"").replace(/\.mp3$/i,""),r=n.match(/^([A-Za-z]+)[_\-]/);return r||(r=n.match(/^([A-Za-z]+)\d+$/),r)?r[1].toLowerCase():(r=n.match(/^([A-Za-z]+)/),r?r[1].toLowerCase():n.toLowerCase())}defineGroup(e,n){let r=this.toKey(e),o=new Set,s=this.urls().map(i=>[i,this.meta.get(i)]),a=(i,l)=>{if(!n)return!1;if(typeof n=="function")return!!n(i,l);let c=l?.logicalName||l?.name||i;if(n instanceof RegExp)return n.test(c)||n.test(i);let d=String(n).toLowerCase();return c.toLowerCase().startsWith(d)||i.toLowerCase().includes("/"+d)};for(let[i,l]of s)a(i,l&&{name:l.name,logicalName:l.logicalName})&&o.add(i);return this.groupsMap.set(r,o),[...o]}undefineGroup(e){this.groupsMap.delete(this.toKey(e))}autoGroups({overwrite:e=!1,minVariants:n=this.minVariantsPerAutoGroup}={}){return this.rebuildAutoGroups(e,n),this.groups()}rebuildAutoGroups(e,n){let r=new Map;for(let[o,s]of this.meta.entries()){let a=this.inferGroupKey(s?.logicalName||s?.name||o);r.has(a)||r.set(a,new Set),r.get(a).add(o)}for(let[o,s]of r.entries())s.size<n||(e||!this.groupsMap.has(o))&&this.groupsMap.set(o,s)}groups(){let e={};for(let[n,r]of this.groupsMap.entries())e[n]=[...r];return e}getGroup(e){let n=this.groupsMap.get(this.toKey(e));return n?[...n]:[]}pick(e){let n=this.getGroup(e);return this.choose(n)}findExistingHowlByUrl(e){if(this.refreshHowler(),!this.howler)return null;for(let n of this.howler._howls){let r=n&&(n._src||n._urls&&n._urls[0]);if(r&&this.sameAsset(r,e))return n}return null}getGameSfxVolume(){return this.finalVolumeObj()}setGainFactor(e=1){this.gainFactor=+e||1}setAtomConfig(e="soundEffectsVolumeAtom",n=.001,r=.2000000000000001){this.atomKey=e,this.min=n,this.max=r}playUrl(e){let{vol:n}=this.finalVolumeObj(),r=this.findExistingHowlByUrl(e);if(r)try{return r.play(),r}catch{}let o=window.Howl&&window.Howler?window.Howl:null;if(o)try{let s=new o({src:[e],volume:n});return s.play(),s}catch{}try{let s=new Audio(e);return s.volume=Math.max(0,Math.min(1,n)),s.play().catch(()=>{}),s}catch{return null}}playBy(e){let n=this.urls(),r=e instanceof RegExp?e:new RegExp(String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),o=n.find(s=>r.test(s));return o?this.playUrl(o):null}play(e){if(typeof e=="string"){let n=this.map();if(n[e]?.[0])return this.playUrl(n[e][0])}return this.playBy(e)}playGroup(e,n={}){let{index:r,random:o=!0,filter:s}=n,a=this.getGroup(e);if(!a.length||typeof s=="function"&&(a=a.filter(l=>{let c=this.meta.get(l);return s(l,c&&{name:c.name,logicalName:c.logicalName})}),!a.length))return null;let i=typeof r=="number"?a[(r%a.length+a.length)%a.length]:o?this.choose(a):a[0];return this.playUrl(i)}playRandom(e){return this.playGroup(e,{random:!0})}urls(){return[...this.found]}map(){let e={};for(let[n,r]of this.meta.entries()){let o=r.logicalName||r.name;(e[o]||(e[o]=[])).push(n)}return e}info(){return this.urls().map(e=>{let n=this.meta.get(e);return{url:e,name:n?.name,logicalName:n?.logicalName,sources:[...n?.from||[]].join(",")}})}exportJSON(){return JSON.stringify({urls:this.info(),groups:this.groups()},null,2)}async scan(){return this.scanAll()}playHarvest(){return this.playGroup("harvest")}playPlantSeed(){return this.playGroup("plantseed")}playWaterPlant(){return this.playBy("water")}playDestroyPlant(){return this.playBy("Break_Dirt")}playDestroyStone(){return this.playBy("Break_Stone")}playSellNotification(){return this.playBy("Score_PlusOne")}playInfoNotification(){return this.playBy("Keyboard_Enter_01")}playBuy(){return this.playGroup("coinbuy")}},qt=new Nu({autoScan:!0});var Qg="editor.savedGardens",YA=1760866288723,QA=1760867858782,na={Gold:"rgba(200, 170, 0, 1)",Rainbow:"linear-gradient(135deg, #ff0000, #ff7a00, #ffeb3b, #00c853, #40c4ff, #8e24aa)",Wet:"rgb(30, 140, 230)",Chilled:"rgb(100, 190, 200)",Frozen:"rgb(100, 120, 255)",Dawnlit:"rgba(120, 100, 180, 1)",Ambershine:"rgba(160, 70, 50, 1)",Dawncharged:"rgba(160, 140, 220, 1)",Ambercharged:"rgba(240, 110, 80, 1)"},zr=null,Kr=!1,Ou=new Set,Gr=null,No=null,Jg=null,rn=null,fn="plants",$g=null,Zg=null,jn=null,jr=null,Kg=!1,Hr={},Ug=!1,Do=!0,Vg=200,JA=100,Ro=0,Xs=0,ea=!1,hl=null,bl,_o=0,Du=!1;async function qu(t){try{let e=await Un();if(!e)return;await ce.player.avatarTriggerAnimationAtom.set({playerId:e,animation:t}),t==="dig"?qt.playBy("Break_Dirt_01"):t==="dropObject"&&(qt.playGroup("plant")||qt.playGroup("hit_dirt")||qt.playGroup("hit")||qt.playBy(/Hit_Dirt/i))}catch{}}var lt=null,Gt=null,on=null,Sl=!1;function $A(){if(zr&&document.contains(zr))return zr;let t=document.createElement("div");return t.id="qws-editor-overlay",t.textContent="Editor mode",Object.assign(t.style,{position:"fixed",top:"7%",left:"50%",transform:"translateX(-50%)",zIndex:"1000001",padding:"8px 12px",borderRadius:"999px",border:"1px solid #ffffff33",background:"linear-gradient(180deg, rgba(17,24,31,0.95), rgba(12,18,26,0.92))",color:"#e7eef7",font:"600 13px/1.3 system-ui, -apple-system, Segoe UI, Roboto, sans-serif",letterSpacing:"0.3px",boxShadow:"0 10px 30px rgba(0,0,0,.35)",pointerEvents:"none"}),(document.body||document.documentElement||document).appendChild(t),zr=t,t}function Xg(){$A()}function eh(){zr&&(zr.remove(),zr=null)}function Hu(){return fn==="decor"?Zg:$g}function ZA(t){fn==="decor"?Zg=t:$g=t}function XA(){return fn==="decor"?Object.entries(ut||{}).map(([t,e])=>({id:t,label:String(e?.name||t)})):Object.entries(De||{}).map(([t,e])=>({id:t,label:String(e?.crop?.name||e?.seed?.name||t)}))}function eT(t){return t?fn==="decor"?ut?.[t]:De?.[t]:null}function tT(t,e){return fn==="decor"?e?.name||t:e?.crop?.name||e?.seed?.name||t}function th(){return fn==="decor"?"Decor":"Crop"}function nT(){if(Gr&&document.contains(Gr))return Gr;Pt().catch(()=>{});let t=document.createElement("div");t.id="qws-editor-side",Object.assign(t.style,{position:"fixed",top:"12%",left:"12px",zIndex:"1000001",width:"560px",minHeight:"420px",maxHeight:"86vh",height:"min(720px, 86vh)",display:"grid",gridTemplateRows:"auto 1fr",gap:"10px",padding:"10px",borderRadius:"12px",border:"1px solid #ffffff22",background:"linear-gradient(180deg, rgba(14,18,25,0.95), rgba(10,14,20,0.92))",color:"#e7eef7",boxShadow:"0 10px 30px rgba(0,0,0,0.35)",pointerEvents:"auto"});let e=document.createElement("div");e.textContent="Item picker",e.style.fontWeight="700",e.style.fontSize="13px",e.style.letterSpacing="0.08em",e.style.textTransform="uppercase",e.style.opacity="0.85",e.style.textAlign="center";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="260px 1fr",n.style.gap="10px",n.style.minHeight="0";let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="auto 1fr",r.style.gap="8px",r.style.minHeight="0";let o=document.createElement("select");o.id="qws-editor-side-select",o.style.width="100%",o.style.padding="8px",o.style.borderRadius="10px",o.style.border="1px solid #33404e",o.style.background="rgba(20,25,33,0.9)",o.style.color="#e7eef7",o.style.fontWeight="600",o.style.cursor="pointer";let s=document.createElement("option");s.value="plants",s.textContent="Plants";let a=document.createElement("option");a.value="decor",a.textContent="Decor",o.append(s,a),o.value=fn,o.onchange=()=>{fn=o.value==="decor"?"decor":"plants",Fu()},Jg=o;let i=document.createElement("div");i.id="qws-editor-side-list",Object.assign(i.style,{border:"1px solid #2c3643",borderRadius:"10px",background:"rgba(16,21,28,0.9)",overflow:"auto",padding:"6px",maxHeight:"72vh"}),No=i,r.append(o,i);let l=document.createElement("div");return l.id="qws-editor-side-details",l.style.display="grid",l.style.gridTemplateRows="1fr auto",l.style.gap="8px",l.style.border="1px solid #2c3643",l.style.borderRadius="10px",l.style.background="rgba(16,21,28,0.9)",l.style.padding="10px",l.style.minHeight="0",l.style.overflow="hidden",rn=l,n.append(r,l),t.append(e,n),(document.body||document.documentElement||document).appendChild(t),Gr=t,Fu(),Wr(),t}function nh(){nT()}function rh(){Gr&&(Gr.remove(),Gr=null,No=null,Jg=null,rn=null)}function rT(){if(jn&&document.contains(jn))return jn;let t=document.createElement("div");t.id="qws-editor-current-item",Object.assign(t.style,{position:"fixed",top:"12%",right:"12px",zIndex:"1000001",width:"420px",minHeight:"200px",maxHeight:"86vh",display:"grid",gridTemplateRows:"auto 1fr",gap:"10px",padding:"10px",borderRadius:"12px",border:"1px solid #ffffff22",background:"linear-gradient(180deg, rgba(14,18,25,0.95), rgba(10,14,20,0.92))",color:"#e7eef7",boxShadow:"0 10px 30px rgba(0,0,0,0.35)",pointerEvents:"auto"});let e=document.createElement("div");e.textContent="Current item",e.style.fontWeight="700",e.style.fontSize="13px",e.style.letterSpacing="0.08em",e.style.textTransform="uppercase",e.style.opacity="0.85",e.style.textAlign="center";let n=document.createElement("div");return n.id="qws-editor-current-item-content",n.style.display="grid",n.style.gap="10px",n.style.minHeight="0",n.style.overflow="auto",t.append(e,n),(document.body||document.documentElement||document).appendChild(t),jn=t,oT(),ra(),t}function oh(){rT()}function sh(){if(jr){try{jr()}catch{}jr=null}jn&&(jn.remove(),jn=null)}function oT(){if(jr){try{jr()}catch{}jr=null}(async()=>{try{let t=st("myCurrentGardenObjectAtom"),e=st("myValidatedSelectedItemIndexAtom"),n=await at().catch(()=>null);if(!t||!n)return;let r=n.sub(t,()=>{ra()}),o=e?n.sub(e,()=>ra()):null;jr=()=>{try{r()}catch{}if(o)try{o()}catch{}}}catch{}})()}async function ah(){try{let t=await at().catch(()=>null);if(!t)return{tileType:void 0,tileKey:null,tileObject:null};let e=st("myCurrentGardenTileAtom");if(!e)return{tileType:void 0,tileKey:null,tileObject:null};let n=t.get(e);if(!n)return{tileType:void 0,tileKey:null,tileObject:null};let r=n.tileType,o=n.localTileIndex,s=n.userSlotIdx,a=typeof s=="number"&&Number.isFinite(s)?s:0;if(o==null||!Number.isFinite(o))return{tileType:r,tileKey:null,tileObject:null};let i=lt??await ce.root.state.get(),l=Array.isArray(i?.child?.data?.userSlots)?i?.child?.data?.userSlots?.[a]?.data?.garden:i?.child?.data?.userSlots?.[String(a)]?.data?.garden,c=l&&typeof l=="object"?l:qo(),d=String(o),u=r==="Dirt"?c.tileObjects||{}:c.boardwalkTileObjects||{};return{tileType:r,tileKey:d,tileObject:u[d]}}catch{return{tileType:void 0,tileKey:null,tileObject:null}}}function sT(t){if(!t||typeof t!="object")return"Unknown";if(t.objectType==="plant"){let e=De[t.species];return e?.crop?.name||e?.seed?.name||t.species||"Plant"}return t.objectType==="decor"?ut[t.decorId]?.name||t.decorId||"Decor":String(t.objectType||"Item")}function aT(t){if(!t||typeof t!="object")return"Item";if(t.itemType==="Plant"){let e=De[t.species];return e?.crop?.name||e?.seed?.name||t.species||"Plant"}return t.itemType==="Decor"?ut[t.decorId]?.name||t.decorId||"Decor":String(t.itemType||"Item")}function ra(){if(!jn)return;let t=jn.querySelector("#qws-editor-current-item-content");t&&(async()=>{t.innerHTML="";let{tileType:e,tileKey:n,tileObject:r}=await ah();if(!r){let d=document.createElement("div");d.textContent="Look at a plant or decor to edit it.",d.style.opacity="0.7",d.style.textAlign="center",t.appendChild(d);try{let u=await ce.inventory.myInventory.get(),y=await ce.inventory.myValidatedSelectedItemIndex.get(),h=Array.isArray(u?.items)?u.items:[],f=typeof y=="number"?h[y]:null;if(f){let p=document.createElement("div");p.style.display="flex",p.style.flexDirection="column",p.style.alignItems="center",p.style.gap="6px";let m=Tt(f.itemType==="Decor"?"Decor":"Crop",f.itemType==="Decor"?f.decorId:f.species,{size:40,fallback:"?"});m.style.display="inline-block";let g=document.createElement("div");if(g.textContent=aT(f),g.style.fontWeight="700",g.style.fontSize="14px",g.style.overflow="hidden",g.style.textOverflow="ellipsis",g.style.whiteSpace="nowrap",g.style.textAlign="center",p.append(m,g),t.appendChild(p),f.itemType==="Plant"){let w=Array.isArray(f.slots)?f.slots:[],x=new Set;for(let A of w)(Array.isArray(A?.mutations)?A.mutations:[]).forEach(H=>x.add(H));let E=Array.from(x),T=document.createElement("div");if(T.style.display="flex",T.style.flexWrap="wrap",T.style.gap="6px",T.style.justifyContent="center",E.length)for(let A of E){let N=document.createElement("span");N.textContent=an[A]?.name?.charAt(0)?.toUpperCase()||A.charAt(0)?.toUpperCase()||"?",N.style.fontWeight="900",N.style.fontSize="12px",N.style.padding="4px 8px",N.style.borderRadius="999px",N.style.border="1px solid #2c3643",N.style.background="rgba(10,14,20,0.9)";let H=na[A];H&&(H.startsWith("linear-gradient")?(N.style.backgroundImage=H,N.style.backgroundClip="text",N.style.webkitBackgroundClip="text",N.style.color="transparent",N.style.webkitTextFillColor="transparent"):N.style.color=H),T.appendChild(N)}else{let A=document.createElement("div");A.textContent="No mutations",A.style.opacity="0.7",A.style.fontSize="11px",T.appendChild(A)}t.append(T)}let S=document.createElement("button");S.type="button",S.textContent="Place",Object.assign(S.style,{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"1px solid #2b3441",background:"linear-gradient(180deg, rgba(42,154,255,0.12), rgba(30,91,181,0.35))",color:"#e7eef7",fontWeight:"700",cursor:"pointer"}),S.onclick=()=>{zu()},t.appendChild(S)}}catch{}return}let o=sT(r),s=Tt(r.objectType==="decor"?"Decor":"Crop",r.objectType==="decor"?r.decorId:r.species,{size:48,fallback:"?"});s.style.display="inline-block";let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.alignItems="center",a.style.gap="6px";let i=document.createElement("div");i.textContent=o,i.style.fontWeight="700",i.style.fontSize="15px",i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.whiteSpace="nowrap",i.style.textAlign="center",a.append(s,i),t.appendChild(a),r.objectType==="plant"&&iT(t,r,n||"");let l=document.createElement("button");l.type="button",l.textContent="Copy to inventory",Object.assign(l.style,{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"1px solid #2b3441",background:"linear-gradient(180deg, rgba(42,154,255,0.12), rgba(30,91,181,0.35))",color:"#e7eef7",fontWeight:"700",cursor:"pointer"}),l.onclick=()=>{pT(r)},t.appendChild(l);let c=document.createElement("button");c.type="button",c.textContent="Remove",Object.assign(c.style,{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"1px solid #2b3441",background:"linear-gradient(180deg, rgba(220,80,80,0.18), rgba(160,40,40,0.25))",color:"#e7eef7",fontWeight:"700",cursor:"pointer"}),c.onclick=()=>{r.objectType==="plant"?Gu():ju()},t.appendChild(c)})()}function iT(t,e,n){let r=e?.species,o=Array.isArray(e?.slots)?e.slots:[],s=n||"default",a=Hr[s]||{},i=Kg,l=document.createElement("div");l.style.display="grid",l.style.gap="8px";let c=vl(r),d=document.createElement("label");d.style.display="flex",d.style.alignItems="center",d.style.gap="6px",d.style.fontSize="12px",d.style.opacity="0.9";let u=document.createElement("input");u.type="checkbox",u.checked=i,u.onchange=()=>{i=!!u.checked,Kg=i,i&&h()};let y=document.createElement("span");y.textContent="Edit all slots together",d.append(u,y);let h=()=>{i&&(l.querySelectorAll("input[data-slot-idx]").forEach(m=>{m.value=String(m._currentPct||m.value);let g=m._currentMode||"percent";m.disabled=g==="custom",m.style.opacity=g==="custom"?"0.45":"1"}),l.querySelectorAll("input[data-scale-input-slot]").forEach(m=>{m.value=String(m._currentScale||m.value)}),l.querySelectorAll("[data-size-label]").forEach(m=>{let g=m._currentPct;g!=null&&(m.textContent=`${g}%`)}),l.querySelectorAll("input[data-scale-mode-slot]").forEach(m=>{let g=m._currentMode||"percent";m.checked=g==="custom"}),l.querySelectorAll("[data-custom-row-slot]").forEach(m=>{let g=m._currentMode||"percent";m.style.display=g==="custom"?"flex":"none"}),l.querySelectorAll("[data-slider-row-slot]").forEach(m=>{let g=m._currentMode||"percent";m.style.display=g==="custom"?"none":""}))};if(o.forEach((m,g)=>{let S=document.createElement("div");Object.assign(S.style,{border:"1px solid #2c3643",borderRadius:"8px",padding:"8px",background:"rgba(10,14,20,0.9)",display:"grid",gap:"6px"});let w=Number(m?.targetScale),x=mn(r,100),E=Number.isFinite(w)?w:x,{minScale:T,maxScale:A}=oa(r),C=(U=>{let{minScale:ue,maxScale:oe}=oa(r);if(!oe||oe<=ue)return 100;let ae=50+(U-ue)/(oe-ue)*50;return fr(ae)})(E),L=E,v=E<T||E>A,B=a[g]==="custom"||v?"custom":"percent";!a[g]&&v&&(Hr[s]={...Hr[s]||{},[g]:"custom"});let le=document.createElement("div");le.style.display="flex",le.style.justifyContent="space-between",le.style.alignItems="center",le.style.fontSize="11px",le.style.opacity="0.85";let X=document.createElement("span");X.textContent="Size";let de=document.createElement("span");de.textContent=`${C}%`,de.dataset.sizeLabel=String(g),de._currentPct=C,le.append(X,de);let _=document.createElement("input");_.type="range",_.min="50",_.max="100",_.step="1",_.value=String(C),_.dataset.slotIdx=String(g),_._currentPct=C,_._currentMode=B,Object.assign(_.style,{width:"100%",cursor:"pointer"});let re=document.createElement("div");re.dataset.sliderRowSlot=String(g),re.appendChild(_);let R=document.createElement("div");R.style.display="flex",R.style.alignItems="center",R.style.gap="6px",R.style.fontSize="11px",R.style.opacity="0.9";let k=document.createElement("span");k.textContent="Custom scale";let V=document.createElement("input");V.type="text",V.inputMode="decimal",V.autocomplete="off",V.value=String(L),V.dataset.scaleInputSlot=String(g),V._currentScale=L,Object.assign(V.style,{width:"90px",padding:"4px 6px",borderRadius:"6px",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",color:"#e7eef7"});let ee=null,ie=null,fe=()=>{if(!ee)return;let U=ee;ee=null,gl(ue=>{if(ue?.objectType!=="plant")return ue;let oe=Array.isArray(ue.slots)?ue.slots.slice():[];if(i)for(let ae=0;ae<oe.length;ae++)oe[ae]={...oe[ae]||{},...U};else oe[g]={...oe[g]||{},...U};return{...ue,slots:oe}})},G=U=>{ee={...ee||{},...U},ie!=null&&window.clearTimeout(ie),ie=window.setTimeout(()=>{fe()},150)},Z=U=>{let ue=fr(U);C=ue,_._currentPct=ue,de._currentPct=ue,de.textContent=`${ue}%`,_.value=String(ue),L=mn(r,ue),B!=="custom"&&(V.value=L.toFixed(4)),V._currentScale=L,G({targetScale:L}),i&&(l.querySelectorAll("input[data-slot-idx]").forEach(oe=>{oe!==_&&(oe.value=String(ue),oe._currentPct=ue,oe._currentMode="percent",oe.disabled=!1,oe.style.opacity="1")}),l.querySelectorAll("input[data-scale-input-slot]").forEach(oe=>{oe!==V&&(oe.value=L.toFixed(4),oe._currentScale=L)}),l.querySelectorAll("[data-size-label]").forEach(oe=>{oe.textContent=`${ue}%`,oe._currentPct=ue}),p("percent",L,C))},j=U=>{let ue=U.replace(",",".").replace(/\s+/g,""),oe=Number(ue);if(!Number.isFinite(oe))return;L=oe,V.value=ue,V._currentScale=oe;let ae=Bu(r,oe);C=ae,_.value=String(ae),de.textContent=`${ae}%`,G({targetScale:oe}),i&&(l.querySelectorAll("input[data-slot-idx]").forEach(ye=>{ye!==_&&(ye.value=String(ae),ye._currentPct=ae,ye._currentMode="custom",ye.disabled=!0,ye.style.opacity="0.45")}),l.querySelectorAll("input[data-scale-input-slot]").forEach(ye=>{ye!==V&&(ye.value=String(oe),ye._currentScale=oe)}),l.querySelectorAll("[data-size-label]").forEach(ye=>{ye.textContent=`${ae}%`,ye._currentPct=ae}),p("custom",oe,C))};_.oninput=()=>Z(Number(_.value));let Y=()=>j(V.value);V.onblur=Y,V.onkeydown=U=>{U.key==="Enter"&&(U.preventDefault(),Y())},R.append(k,V);let ne=document.createElement("label");ne.style.display="flex",ne.style.alignItems="center",ne.style.gap="6px",ne.style.fontSize="11px",ne.style.opacity="0.9";let q=document.createElement("input");q.type="checkbox",q.dataset.scaleModeSlot=String(g),q._currentMode=B,q.checked=B==="custom";let W=document.createElement("span");W.textContent="Use custom scale";let b=()=>{de.textContent=B==="custom"?`${L.toFixed(2)}x`:`${C}%`,de._currentPct=C},D=()=>{let U=B!=="custom";q._currentMode=B,_._currentMode=B,_.disabled=!U,re.style.display=U?"":"none",R.style.display=U?"none":"flex"};q.onchange=()=>{if(B=q.checked?"custom":"percent",Hr[s]={...Hr[s]||{},[g]:B},B==="custom")G({targetScale:L});else{let U=dh(r,L);L=U,V._currentScale=U,V.value=String(U);let ue=Bu(r,U);C=ue,_._currentPct=ue,_.value=String(ue),G({targetScale:U})}D(),b(),i&&h(),i&&p(B,L,C)};let F=U=>{let ue=ye=>{ye.stopImmediatePropagation?.(),ye.stopPropagation()},oe=()=>{window.addEventListener("keydown",ue,!0),window.addEventListener("keyup",ue,!0)},ae=()=>{window.removeEventListener("keydown",ue,!0),window.removeEventListener("keyup",ue,!0)};U.addEventListener("focus",oe),U.addEventListener("blur",ae),U.addEventListener("keydown",ue)},P=U=>{let ue=new Set(["0","1","2","3","4","5","6","7","8","9","-","."]);U.addEventListener("keydown",oe=>{if(oe.ctrlKey||oe.metaKey||oe.altKey)return;let ae=oe.key;["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End"].includes(ae)||ae.length===1&&!ue.has(ae)&&oe.preventDefault()}),U.addEventListener("input",()=>{let oe=U.value.replace(/[^0-9.-]/g,"");oe!==U.value&&(U.value=oe)})};F(V),P(V),ne.append(q,W),_.disabled=B==="custom",re.style.display=B==="custom"?"none":"",R.style.display=B==="custom"?"flex":"none",D(),b();let I=document.createElement("div");I.style.display="grid",I.style.gap="6px";let J=document.createElement("div");J.textContent="Mutations",J.style.fontSize="11px",J.style.opacity="0.85";let te=document.createElement("div");te.style.display="flex",te.style.flexWrap="wrap",te.style.gap="6px",te.style.alignItems="center";let z=Array.isArray(m?.mutations)?m.mutations.slice():[],M=Object.keys(an||{}),K=U=>{let ue=U.slice();z.length=0,z.push(...ue),gl(oe=>{if(oe?.objectType!=="plant")return oe;let ae=Array.isArray(oe.slots)?oe.slots.slice():[];if(i)for(let ye=0;ye<ae.length;ye++)ae[ye]={...ae[ye]||{},mutations:ue.slice()};else ae[g]={...ae[g]||{},mutations:ue.slice()};return{...oe,slots:ae}}).then(()=>{se()})},$=(U,ue)=>{let oe=na[ue];oe&&(oe.startsWith("linear-gradient")?(U.style.backgroundImage=oe,U.style.backgroundClip="text",U.style.webkitBackgroundClip="text",U.style.color="transparent",U.style.webkitTextFillColor="transparent"):U.style.color=oe)},Q=U=>{let oe=(an[U]||{}).name||U||"?";return String(oe).charAt(0).toUpperCase()},se=()=>{te.innerHTML="";for(let U of z){let ue=document.createElement("span");Object.assign(ue.style,{borderRadius:"999px",padding:"3px 8px",fontSize:"11px",fontWeight:"700",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",cursor:"pointer"});let oe=document.createElement("span");oe.textContent=Q(U),oe.style.fontWeight="900",$(oe,U),ue.title="Remove mutation",ue.onclick=()=>{let ae=z.filter(ye=>ye!==U);K(ae)},ue.appendChild(oe),te.appendChild(ue)}if(z.length<M.length){let U=document.createElement("button");U.type="button",U.textContent="+",Object.assign(U.style,{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",color:"#e7eef7",fontWeight:"900",fontSize:"16px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"}),U.onclick=()=>{let ue=O.style.display!=="none";O.style.display=ue?"none":"grid",U.style.background=ue?"rgba(10,14,20,0.9)":"rgba(32,42,56,0.8)"},te.appendChild(U)}},O=document.createElement("div");O.style.display="none",O.style.gridTemplateColumns="repeat(auto-fill, minmax(90px, 1fr))",O.style.gap="6px",O.style.padding="6px",O.style.border="1px solid #2c3643",O.style.borderRadius="8px",O.style.background="rgba(8,12,18,0.9)";for(let U of M){let ue=an[U]||{},oe=U==="Amberlit"?"Ambershine":U,ae=Array.isArray(m.mutations)&&m.mutations.includes(oe);if(ae)continue;let ye=document.createElement("button");ye.type="button",ye.textContent=ue.name||U||"?",Object.assign(ye.style,{padding:"6px 8px",borderRadius:"8px",border:ae?"1px solid #55d38a":"1px solid #2c3643",background:ae?"rgba(85,211,138,0.22)":"rgba(10,14,20,0.9)",color:"#e7eef7",fontSize:"11px",fontWeight:"700",cursor:"pointer",textAlign:"left"});let he=na[oe];he&&(ye.style.color=he.startsWith("linear-gradient")?"#e7eef7":he,he.startsWith("linear-gradient")&&(ye.style.backgroundImage=he,ye.style.backgroundClip="text",ye.style.webkitBackgroundClip="text",ye.style.color="transparent",ye.style.webkitTextFillColor="transparent")),ye.onclick=()=>{let Ee=Array.isArray(m.mutations)&&m.mutations.includes(oe)?(m.mutations||[]).filter(Ne=>Ne!==oe):[...m.mutations||[],oe];K(Ee)},O.appendChild(ye)}I.append(J,te,O),se(),S.append(le,ne,re,R,I),l.appendChild(S)}),c>1){let m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.justifyContent="space-between",m.style.fontSize="12px",m.style.opacity="0.9",m.style.gap="8px";let g=document.createElement("span");g.textContent=`Slots ${o.length}/${c}`;let S=document.createElement("div");S.style.display="flex",S.style.gap="6px",S.style.alignItems="center";let w=N=>{let H=document.createElement("button");return H.type="button",H.textContent=N,Object.assign(H.style,{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #2b3441",background:"rgba(16,21,28,0.9)",color:"#e7eef7",cursor:"pointer",fontSize:"14px",fontWeight:"600",display:"inline-flex",alignItems:"center",justifyContent:"center"}),H},x=w("+"),E=w("-");(()=>{g.textContent=`Slots ${o.length}/${c}`,x.disabled=o.length>=c,E.disabled=o.length<=1,x.style.opacity=x.disabled?"0.4":"1",E.style.opacity=E.disabled?"0.4":"1"})();let A=()=>({species:r,startTime:YA,endTime:QA,targetScale:mn(r,100),mutations:[]});x.onclick=()=>{o.length>=c||gl(N=>{if(N?.objectType!=="plant")return N;let H=Array.isArray(N.slots)?N.slots.slice():[];return H.length>=c?N:(H.push(A()),{...N,slots:H})}).then(N=>{N&&ra()})},E.onclick=()=>{o.length<=1||gl(N=>{if(N?.objectType!=="plant")return N;let H=Array.isArray(N.slots)?N.slots.slice(0,Math.max(1,N.slots.length-1)):[];return{...N,slots:H}}).then(N=>{N&&ra()})},S.append(E,x),m.append(g,S),t.appendChild(m),t.appendChild(d)}t.appendChild(l);let p=(m,g,S)=>{l.querySelectorAll("input[data-scale-mode-slot]").forEach(x=>{x.checked=m==="custom",x._currentMode=m}),l.querySelectorAll("input[data-slot-idx]").forEach(x=>{x._currentMode=m,x.disabled=m==="custom",x.style.opacity=m==="custom"?"0.45":"1",m==="percent"&&(x.value=String(x._currentPct??S))}),l.querySelectorAll("[data-slider-row-slot]").forEach(x=>{x.style.display=m==="custom"?"none":"",x._currentMode=m}),l.querySelectorAll("[data-custom-row-slot]").forEach(x=>{x.style.display=m==="custom"?"flex":"none",x._currentMode=m}),l.querySelectorAll("input[data-scale-input-slot]").forEach(x=>{m==="custom"&&(x.value=String(x._currentScale??g))}),l.querySelectorAll("[data-size-label]").forEach(x=>{let E=x._currentPct??S;x.textContent=m==="custom"?`${g.toFixed(2)}x`:`${E}%`});let w=Hr[s]||{};for(let x=0;x<o.length;x++)w[x]=m;Hr[s]=w}}function Fu(){if(!No)return;No.innerHTML="";let t=document.createElement("div");t.style.display="grid",t.style.gap="4px";let e=(o,s,a)=>{let i=document.createElement("button");i.type="button",Object.assign(i.style,{width:"100%",display:"grid",gridTemplateColumns:"auto 1fr",alignItems:"center",gap:"8px",padding:"8px",borderRadius:"8px",border:"1px solid "+(a?"#4a6fa5":"#2b3441"),background:a?"rgba(74,111,165,0.18)":"rgba(24,30,39,0.9)",color:"#e7eef7",cursor:"pointer",fontWeight:a?"700":"600"});let l=Tt(th(),o,{size:26,fallback:"\u2753"});l.style.display="inline-block";let c=document.createElement("span");return c.textContent=s,c.style.textAlign="left",c.style.overflow="hidden",c.style.textOverflow="ellipsis",c.style.whiteSpace="nowrap",i.onclick=()=>{ZA(o),Fu(),Wr()},i.append(l,c),i},n=Hu(),r=XA();for(let o of r){let s=n===o.id;t.appendChild(e(o.id,o.label,s))}if(!t.childElementCount){let o=document.createElement("div");o.style.opacity="0.7",o.textContent="No entries.",No.appendChild(o);return}No.appendChild(t)}function Wr(){if(!rn)return;rn.innerHTML="";let t=document.createElement("div");t.style.display="grid",t.style.gap="10px",t.style.minHeight="0",t.style.overflow="auto",t.style.alignContent="flex-start",t.style.justifyItems="center";let e=document.createElement("div");e.style.display="grid",e.style.gap="6px",e.style.justifyItems="start",e.style.marginTop="4px";let n=Hu();if(!n){let c=document.createElement("div");c.style.opacity="0.7",c.style.textAlign="center",c.textContent="Select an item on the left.",t.appendChild(c),rn.append(t,e);return}let r=eT(n),o=tT(n,r),s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns="auto 1fr",s.style.alignItems="center",s.style.gap="10px";let a=Tt(th(),n,{size:48,fallback:"\u2753",alt:o});a.style.display="inline-block";let i=document.createElement("div");if(i.textContent=o,i.style.fontWeight="700",i.style.fontSize="15px",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.textOverflow="ellipsis",s.append(a,i),t.appendChild(s),fn==="plants"){let c=vl(n),d=Lo(n),u=d.slots,y=d.applyAll,h=document.createElement("div");if(h.style.display="grid",h.style.gap="6px",h.style.marginTop="6px",h.style.width="100%",c>1){let p=document.createElement("div");p.style.display="flex",p.style.justifyContent="space-between",p.style.alignItems="center",p.style.fontSize="12px",p.style.opacity="0.9";let m=document.createElement("span");m.textContent="Slots";let g=document.createElement("div");g.style.display="flex",g.style.gap="6px",g.style.alignItems="center";let S=document.createElement("span");S.textContent=`${u.length}/${c}`;let w=document.createElement("button");w.type="button",w.textContent="+",Object.assign(w.style,{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #2b3441",background:"rgba(16,21,28,0.9)",color:"#e7eef7",cursor:"pointer",fontSize:"14px",fontWeight:"600"}),w.onclick=()=>{let E=Lo(n),T=E.slots;if(T.length>=c)return;let A=mn(n,100);ht={...E,species:n,slots:[...T,{enabled:!0,sizePercent:100,customScale:A,sizeMode:"percent",mutations:[]}]},Wr()};let x=document.createElement("button");x.type="button",x.textContent="\u2212",Object.assign(x.style,{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #2b3441",background:"rgba(220,80,80,0.18)",color:"#e7eef7",cursor:"pointer",fontSize:"14px",fontWeight:"600"}),x.onclick=()=>{let E=Lo(n),T=E.slots;T.length<=1||(ht={...E,species:n,slots:T.slice(0,T.length-1)},Wr())},g.append(S,x,w),p.append(m,g),h.appendChild(p)}if(c>1){let p=document.createElement("label");p.style.display="flex",p.style.alignItems="center",p.style.gap="6px",p.style.fontSize="12px",p.style.opacity="0.9";let m=document.createElement("input");m.type="checkbox",m.checked=y,m.onchange=()=>{ht.applyAll=m.checked,Wr()};let g=document.createElement("span");g.textContent="Edit all slots together",p.append(m,g),h.appendChild(p)}let f=document.createElement("div");f.style.display="grid",f.style.gap="6px",u.forEach((p,m)=>{let g=document.createElement("div");Object.assign(g.style,{border:"1px solid #2c3643",borderRadius:"8px",padding:"8px",background:"rgba(10,14,20,0.9)",display:"grid",gap:"6px"});let S=fr(Number.isFinite(p.sizePercent)?p.sizePercent:100),w=mn(n,S),x=ta(n,Number.isFinite(p.customScale)?p.customScale:w),E=p.sizeMode==="custom"?"custom":"percent",T=S,A=E==="custom"?x:w,N=T,H=String(A),C=document.createElement("div");C.style.display="flex",C.style.justifyContent="space-between",C.style.alignItems="center",C.style.fontSize="11px",C.style.opacity="0.85";let L=document.createElement("span");L.textContent="Size";let v=document.createElement("span");v.dataset.sizeLabel=String(m),C.append(L,v);let B=document.createElement("label");B.style.display="flex",B.style.alignItems="center",B.style.gap="6px",B.style.fontSize="11px",B.style.opacity="0.9";let le=document.createElement("input");le.type="checkbox",le.dataset.scaleMode=String(m),le.checked=E==="custom";let X=document.createElement("span");X.textContent="Use custom scale",B.append(le,X);let de=document.createElement("input");de.type="range",de.min="50",de.max="100",de.step="1",de.value=String(T),de.dataset.slotIdx=String(m),Object.assign(de.style,{width:"100%",cursor:"pointer"});let _=document.createElement("div");_.style.display="flex",_.style.alignItems="center",_.style.gap="6px",_.style.fontSize="11px",_.style.opacity="0.9",_.dataset.customRow=String(m);let re=document.createElement("span");re.textContent="Custom scale";let R=document.createElement("input");R.type="text",R.inputMode="decimal",R.autocomplete="off",R.value=H,R.dataset.scaleInput=String(m),Object.assign(R.style,{width:"90px",padding:"4px 6px",borderRadius:"6px",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",color:"#e7eef7"}),_.append(re,R),(z=>{let M=Q=>{Q.stopImmediatePropagation?.(),Q.stopPropagation()},K=()=>{window.addEventListener("keydown",M,!0),window.addEventListener("keyup",M,!0)},$=()=>{window.removeEventListener("keydown",M,!0),window.removeEventListener("keyup",M,!0)};z.addEventListener("focus",K),z.addEventListener("blur",$),z.addEventListener("keydown",M)})(R);let V=z=>`${z.toFixed(2)}x`,ee=z=>z.toFixed(2),ie=z=>{let M=z.value;if(M===""||M==null)return null;let K=M.replace(",",".").replace(/\s+/g,""),$=Number(K);return Number.isFinite($)?$:null};(z=>{let M=new Set(["0","1","2","3","4","5","6","7","8","9","-","."]);z.addEventListener("keydown",K=>{if(K.ctrlKey||K.metaKey||K.altKey)return;let $=K.key;$==="Backspace"||$==="Delete"||$==="Tab"||$==="Enter"||$==="ArrowLeft"||$==="ArrowRight"||$==="ArrowUp"||$==="ArrowDown"||$==="Home"||$==="End"||$.length===1&&!M.has($)&&K.preventDefault()}),z.addEventListener("input",()=>{let K=z.value.replace(/[^0-9.-]/g,"");K!==z.value&&(z.value=K),H=z.value})})(R);let G=()=>{v.textContent=E==="custom"?V(A):`${T}%`},Z=()=>{let z=E!=="custom";de.disabled=E==="custom",de.style.opacity=E==="custom"?"0.45":"1",R.disabled=E!=="custom",R.style.opacity=E==="custom"?"1":"0.5",de.style.display=z?"":"none",_.style.display=z?"none":"flex"},j=()=>{if(!y||!rn)return;let z=E!=="custom";rn.querySelectorAll("input[data-slot-idx]").forEach(M=>{M.value=String(T),M.disabled=E==="custom",M.style.opacity=E==="custom"?"0.45":"1",M.style.display=z?"":"none"}),rn.querySelectorAll("input[data-scale-input]").forEach(M=>{E==="custom"?M.value=H:M.value=ee(A),M.disabled=E!=="custom",M.style.opacity=E==="custom"?"1":"0.5"}),rn.querySelectorAll("input[data-scale-mode]").forEach(M=>{M.checked=E==="custom"}),rn.querySelectorAll("[data-size-label]").forEach(M=>{M.textContent=E==="custom"?V(A):`${T}%`}),rn.querySelectorAll("[data-scale-row]").forEach(M=>{M.remove()}),rn.querySelectorAll("[data-custom-row]").forEach(M=>{M.style.display=z?"none":"flex"})},Y=z=>{let M=Lo(n).slots;ht={...ht,species:n,slots:M.map((K,$)=>!y&&$!==m?K:{...K,sizeMode:E,...z})}},ne=z=>{let M=fr(z);T=M,N=M,de.value=String(M),E!=="custom"&&(A=mn(n,M)),Y({sizePercent:M,...E!=="custom"?{customScale:A}:{}}),G(),j()},q=(z,M)=>{let K=ta(n,z);A=K,typeof M=="string"?H=M:H=R.value,Y({customScale:K}),G(),j()};de.oninput=()=>{ne(Number(de.value))},R.oninput=()=>{let z=R.value;H=z;let M=ie(R);M!=null&&q(M,z)},le.onchange=()=>{if(E=le.checked?"custom":"percent",E==="custom")N=T,A=ta(n,A||mn(n,T)),H=R.value||String(A),Y({customScale:A});else{let z=fr(N);T=z,de.value=String(z),Y({sizePercent:z})}Z(),G(),j()},Z(),G();let W=document.createElement("div");W.style.display="grid",W.style.gap="6px";let b=document.createElement("div");b.textContent="Mutations",b.style.fontSize="11px",b.style.opacity="0.85";let D=document.createElement("button");D.type="button",D.textContent="+",Object.assign(D.style,{width:"28px",height:"28px",borderRadius:"50%",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",color:"#e7eef7",fontWeight:"900",fontSize:"16px",cursor:"pointer",display:"inline-flex",alignItems:"center",justifyContent:"center"});let F=document.createElement("div");F.style.display="flex",F.style.flexWrap="wrap",F.style.gap="6px",F.style.alignItems="center";let P=document.createElement("div");P.style.display="none",P.style.gridTemplateColumns="repeat(auto-fill, minmax(90px, 1fr))",P.style.gap="6px",P.style.padding="6px",P.style.border="1px solid #2c3643",P.style.borderRadius="8px",P.style.background="rgba(8,12,18,0.9)";let I=Object.keys(an||{}),J=()=>{F.innerHTML="";let z=Array.isArray(p.mutations)?p.mutations:[],K=I.map(se=>se==="Amberlit"?"Ambershine":se).every(se=>z.includes(se)),$=(se,O)=>{let U=na[O];U&&(U.startsWith("linear-gradient")?(se.style.backgroundImage=U,se.style.backgroundClip="text",se.style.webkitBackgroundClip="text",se.style.color="transparent",se.style.webkitTextFillColor="transparent"):se.style.color=U)},Q=se=>{let U=(an[se]||{}).name||se||"?";return String(U).charAt(0).toUpperCase()};for(let se of z){let O=document.createElement("span");Object.assign(O.style,{borderRadius:"999px",padding:"3px 8px",fontSize:"11px",fontWeight:"700",border:"1px solid #2c3643",background:"rgba(10,14,20,0.9)",cursor:"pointer"});let U=document.createElement("span");U.textContent=Q(se),U.style.fontWeight="900",$(U,se),O.title="Remove mutation",O.onclick=()=>{let ue=Lo(n).slots;ht={...ht,species:n,slots:y?ue.map(oe=>{let ye=(Array.isArray(oe.mutations)?oe.mutations:[]).filter(he=>he!==se);return{...oe,mutations:ye}}):ue.map((oe,ae)=>{if(ae!==m)return oe;let he=(Array.isArray(oe.mutations)?oe.mutations:[]).filter(ve=>ve!==se);return{...oe,mutations:he}})},Wr()},O.appendChild(U),F.appendChild(O)}K||F.appendChild(D)},te=z=>{P.style.display=z?"grid":"none",D.style.background=z?"rgba(32,42,56,0.8)":"rgba(10,14,20,0.9)"};D.onclick=()=>{let z=P.style.display!=="none";te(!z)};for(let z of I){let M=an[z]||{},K=z==="Amberlit"?"Ambershine":z,$=Array.isArray(p.mutations)&&p.mutations.includes(K);if($)continue;let Q=document.createElement("button");Q.type="button",Q.textContent=M.name||z||"?",Object.assign(Q.style,{padding:"6px 8px",borderRadius:"8px",border:$?"1px solid #55d38a":"1px solid #2c3643",background:$?"rgba(85,211,138,0.22)":"rgba(10,14,20,0.9)",color:"#e7eef7",fontSize:"11px",fontWeight:"700",cursor:"pointer",textAlign:"left"});let se=na[K];se&&(Q.style.color=se.startsWith("linear-gradient")?"#e7eef7":se,se.startsWith("linear-gradient")&&(Q.style.backgroundImage=se,Q.style.backgroundClip="text",Q.style.webkitBackgroundClip="text",Q.style.color="transparent",Q.style.webkitTextFillColor="transparent")),Q.onclick=()=>{let O=Lo(n).slots;ht={...ht,species:n,slots:y?O.map(U=>{let ue=Array.isArray(U.mutations)?U.mutations:[],ae=ue.includes(K)?ue.filter(ye=>ye!==K):[...ue,K];return{...U,mutations:ae}}):O.map((U,ue)=>{if(ue!==m)return U;let oe=Array.isArray(U.mutations)?U.mutations:[],ye=oe.includes(K)?oe.filter(he=>he!==K):[...oe,K];return{...U,mutations:ye}})},Wr()},P.appendChild(Q)}W.append(b,F,P),J(),te(!1),g.append(C,B,de,_,W),f.appendChild(g)}),h.appendChild(f),t.appendChild(h)}let l=document.createElement("button");l.type="button",l.textContent="Add to inventory",Object.assign(l.style,{width:"100%",padding:"8px 10px",borderRadius:"8px",border:"1px solid #2b3441",background:"linear-gradient(180deg, rgba(42,154,255,0.12), rgba(30,91,181,0.35))",color:"#e7eef7",fontWeight:"700",cursor:"pointer"}),l.onclick=()=>{console.log("[EditorService] addSelectedItemToInventory click",{mode:fn,id:n}),dT()},e.appendChild(l),rn.append(t,e)}function lT(t,e){let n=Number(t),r=Number(e);return Number.isFinite(n)&&Number.isFinite(r)?n-r:t.localeCompare(e)}function yr(t,e,n={}){if(!t||typeof t!="object")return null;let r=s=>s&&String(s.playerId||s.id||"")===String(e);if(Array.isArray(t)){let s=t;for(let a=0;a<s.length;a++)if(r(s[a]))return{isArray:!0,matchSlot:s[a],matchIndex:a,entries:null,slotsArray:s};return null}let o=Object.entries(t);n.sortObject&&o.sort(([s],[a])=>lT(s,a));for(let s=0;s<o.length;s++){let[,a]=o[s];if(r(a))return{isArray:!1,matchSlot:a,matchIndex:s,entries:o,slotsArray:null}}return null}function Ur(t,e){if(t.isArray){let r=(t.slotsArray||[]).slice();return r[t.matchIndex]=e(t.matchSlot),r}let n=(t.entries||[]).map(([r,o],s)=>s===t.matchIndex?[r,e(o)]:[r,o]);return Object.fromEntries(n)}function Tn(t,e){return{...t||{},child:{...t?.child||{},data:{...t?.child?.data||{},userSlots:e}}}}async function cT(t,e){if(!t){await e();return}let{atom:n,readKey:r,origRead:o,writeKey:s,origWrite:a}=t,i=n[r],l=s?n[s]:void 0;try{n[r]=o,s&&a&&(n[s]=a),await e()}finally{n[r]=i,s&&(n[s]=l)}}async function Kn(t){console.log("[EditorService] setStateAtom attempt",{hasPatch:!!Gt}),await cT(Gt,async()=>{try{await ce.root.state.set(t),console.log("[EditorService] setStateAtom success")}catch(e){throw console.log("[EditorService] setStateAtom failed",e),e}})}async function dT(){let t=Hu();t&&(fn==="decor"?(console.log("[EditorService] addSelectedItemToInventory decor",t),await mT(t)):(console.log("[EditorService] addSelectedItemToInventory plant",t),await fT(t)))}async function uT(){try{let t=await Un();if(!t)return!1;let e=await ce.inventory.myValidatedSelectedItemIndex.get(),n=await ce.inventory.myInventory.get(),r=Array.isArray(n?.items)?n.items.slice():[];if(e==null||typeof e!="number"||e<0||e>=r.length)return!1;r.splice(e,1);let o=lt??await ce.root.state.get(),s=o?.child?.data?.userSlots,a=yr(s,t);if(!a)return!1;let l=(a.matchSlot?.data||{}).inventory||{},c=Array.isArray(l.favoritedItemIds)?l.favoritedItemIds.filter(h=>r.some(f=>f?.id===h)):void 0,d=Ur(a,h=>{let f=h?.data||{};return{...h||{},data:{...f,inventory:{...l||{},items:r,...c?{favoritedItemIds:c}:{}}}}}),u=Tn(o,d);lt=u,on=u,await Kn(u);let y=Math.max(0,Math.min(r.length-1,e));try{await ce.inventory.myValidatedSelectedItemIndex.set(y)}catch{}return!0}catch(t){return console.log("[EditorService] removeSelectedInventoryItem failed",t),!1}}async function pT(t){try{let e=await Un();if(!e||!t)return!1;let n=lt??await ce.root.state.get(),r=n?.child?.data?.userSlots,o=yr(r,e);if(!o)return!1;let s=o.matchSlot?.data||{},a=s.inventory,i=Array.isArray(a?.items)?a.items.slice():[];if(t.objectType==="plant"){let u={itemType:"Plant",species:t.species,id:t.id,slots:Array.isArray(t.slots)?JSON.parse(JSON.stringify(t.slots)):[],plantedAt:t.plantedAt,maturedAt:t.maturedAt};i.push(u)}else if(t.objectType==="decor")i.push({itemType:"Decor",decorId:t.decorId,quantity:1,rotation:typeof t.rotation=="number"?t.rotation:0});else return!1;let l=s.inventory||{},c=Ur(o,u=>{let y=u?.data||{};return{...u||{},data:{...y,inventory:{...l||{},items:i}}}}),d=Tn(n,c);lt=d,on=d,await Kn(d);try{await ce.inventory.myValidatedSelectedItemIndex.set(i.length-1)}catch{}return!0}catch(e){return console.log("[EditorService] addTileObjectToInventory failed",e),!1}}async function mT(t){try{console.log("[EditorService] addDecorToInventory",t);let e=await Un();if(!e){console.log("[EditorService] addDecorToInventory: no playerId");return}let n=lt??await ce.root.state.get(),r=n?.child?.data?.userSlots;if(!r||typeof r!="object"){console.log("[EditorService] addDecorToInventory: no userSlots");return}let o=yr(r,e);if(!o){console.log("[EditorService] addDecorToInventory: player slot not found");return}let a=(o.matchSlot.data||{}).inventory,i=Array.isArray(a?.items)?a.items.slice():[];console.log("[EditorService] decor before add",{itemsLen:i.length}),i.push({itemType:"Decor",decorId:t,quantity:1});let l=Ur(o,d=>{let u=d?.data||{},y=u.inventory;return{...d||{},data:{...u,inventory:{...y||{},items:i}}}}),c=Tn(n,l);lt=c,on=c;try{await Kn(c)}catch(d){console.log("[EditorService] stateAtom set failed (decor)",d)}console.log("[EditorService] decor after add",{itemsLen:i.length}),console.log("[EditorService] decor added",{decorId:t})}catch(e){console.log("[EditorService] failed to add decor",e)}}async function fT(t){try{console.log("[EditorService] addPlantToInventory",t);let e=await Un();if(!e){console.log("[EditorService] addPlantToInventory: no playerId");return}let n=lt??await ce.root.state.get(),r=n?.child?.data?.userSlots;if(!r||typeof r!="object"){console.log("[EditorService] addPlantToInventory: no userSlots");return}let o=yr(r,e);if(!o){console.log("[EditorService] addPlantToInventory: player slot not found");return}let a=(o.matchSlot.data||{}).inventory,i=Array.isArray(a?.items)?a.items.slice():[],l=De?.[t]??{},c=l?.plant??{},d=c?.harvestType==="Multiple";console.log("[EditorService] plant before add",{itemsLen:i.length,isMultipleHarvest:d});let u=vl(t),y=ht.species===t?ht.slots.slice(0,u):uh(t).slice(0,u),h=[];for(let S of y){if(!S.enabled)continue;let w=kT(t,S),x=Array.isArray(S.mutations)?S.mutations.slice():[];h.push({species:t,startTime:1760866288723,endTime:1760867858782,targetScale:w,mutations:x})}let f=h.length,p={id:typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`plant-${Math.random().toString(16).slice(2)}`,itemType:"Plant",species:t,slots:h,plantedAt:1760779438723,maturedAt:1760865838723};d||(p.name=l?.crop?.name??c?.name??t),i.push(p);let m=Ur(o,S=>{let w=S?.data||{},x=w.inventory;return{...S||{},data:{...w,inventory:{...x||{},items:i}}}}),g=Tn(n,m);lt=g,on=g;try{await Kn(g)}catch(S){console.log("[EditorService] stateAtom set failed (plant)",S)}console.log("[EditorService] plant after add",{itemsLen:i.length+1}),console.log("[EditorService] plant added",{species:t,isMultipleHarvest:d,slotCount:f})}catch(e){console.log("[EditorService] failed to add plant",e)}}function yT(t){Ou.forEach(e=>{try{e(t)}catch{}})}function Yg(t,e={}){let n=!!t,r=n!==Kr;n&&Do?Xg():eh(),n&&Do?nh():rh(),n&&Do?oh():sh(),n?ph():mh(),Kr=n,e.persist!==!1&&void 0,r&&e.emit!==!1&&yT(n)}var In={init(){_T(),Yg(Kr,{persist:!1,emit:!1})},isEnabled(){return Kr},setEnabled(t){Yg(t,{persist:!0,emit:!0})},onChange(t){return Ou.add(t),()=>Ou.delete(t)}},gT={tileObjects:{},boardwalkTileObjects:{}};function hT(t){let e=t?.tileObjects,n=t?.boardwalkTileObjects,r=o=>o&&typeof o=="object"&&Object.keys(o).length===0;return r(e)&&r(n)}function qo(){return{...gT}}function sa(t){let e=t&&typeof t=="object"&&typeof t.tileObjects=="object"?t.tileObjects:{},n=t&&typeof t=="object"&&typeof t.boardwalkTileObjects=="object"?t.boardwalkTileObjects:{};return{tileObjects:{...e},boardwalkTileObjects:{...n}}}function Oo(){try{let t=_e(Qg);return(Array.isArray(t)?t:[]).map(n=>({id:String(n?.id||""),name:String(n?.name||"Untitled"),createdAt:Number(n?.createdAt)||Date.now(),garden:sa(n?.garden||{})})).filter(n=>!!n.id)}catch{return[]}}function Wu(t){try{Oe(Qg,t||[])}catch{}}async function bT(t){try{if(!t)return null;let n=(lt??await ce.root.state.get())?.child?.data?.userSlots,r=yr(n,t,{sortObject:!0});if(!r||!r.matchSlot)return null;let o=r.matchSlot?.data?.garden;return sa(o||{})}catch{return null}}async function ih(t){try{let e=await Un();if(!e)return!1;let n=lt??await ce.root.state.get(),r=n?.child?.data?.userSlots,o=yr(r,e,{sortObject:!0});if(!o||!o.matchSlot)return!1;let s={...o.matchSlot,data:{...o.matchSlot?.data||{},garden:sa(t)}},a=Ur(o,()=>s),i=Tn(n,a);return lt=i,on=i,await Kn(i),!0}catch(e){return console.log("[EditorService] setCurrentGarden failed",e),!1}}async function ST(t){if(!t||typeof t!="object")return!1;try{await ph();let e=await Un();if(!e)return!1;let n=lt??await ce.root.state.get();if(!n)return!1;let r=n?.child?.data?.userSlots,o=yr(r,e,{sortObject:!0});if(!o||!o.matchSlot)return!1;let s={...o.matchSlot,data:{...o.matchSlot?.data||{},garden:sa(t)}},a=Ur(o,()=>s),i=Tn(n,a);return await Kn(i),lt=i,Sl=!0,!0}catch(e){return console.error("[EditorService] applyFriendGardenPreview failed",e),Sl=!1,!1}}async function vT(){if(!Sl)return!1;Sl=!1;try{return await mh(),!0}catch(t){return console.error("[EditorService] clearFriendGardenPreview failed",t),!1}}function wT(){return Oo()}async function lh(t,e){let n=e||await Un();if(!n)return null;let r=await bT(n);if(!r)return null;let o=Date.now(),s=Oo(),a=t?.trim()||"Untitled",i=(h,f)=>{let p=1,m=h,g=new Set(f);for(;g.has(m);)m=`${h} (${p})`,p+=1;return m},l=s.findIndex(h=>h.name===a),c=a,d=null;l>=0&&((typeof window<"u"&&typeof window.confirm=="function"?window.confirm(`A garden named "${a}" already exists. Overwrite it?`):!1)?d=s[l]?.id||null:c=i(a,s.map(p=>p.name)));let u={id:d||`${o}-${Math.random().toString(16).slice(2)}`,name:c,createdAt:o,garden:r},y=[];return d?y=s.map(h=>h.id===d?u:h):(s.unshift(u),y=s.slice(0,50)),Wu(y),u}async function xT(t){if(!t)return!1;let n=Oo().find(r=>r.id===t);return n?ih(n.garden):!1}function ET(t){if(!t)return!1;let e=Oo(),n=e.filter(r=>r.id!==t);return n.length===e.length?!1:(Wu(n),!0)}function CT(t){if(!t)return null;let n=Oo().find(r=>r.id===t);return n?JSON.stringify(n.garden,null,2):null}async function MT(t,e){if(!e)return null;try{let n=JSON.parse(e),r=sa(n),o=Date.now(),s={id:`${o}-${Math.random().toString(16).slice(2)}`,name:t?.trim()||"Imported garden",createdAt:o,garden:r},a=Oo();return a.unshift(s),Wu(a.slice(0,50)),s}catch{return null}}async function Un(){try{let t=await ce.player.playerId.get();return typeof t=="string"&&t?t:null}catch{return null}}function AT(t,e){let n=t?.child?.data?.userSlots,r=yr(n,e,{sortObject:!0});if(!r||!r.matchSlot||typeof r.matchSlot!="object")return{next:t,changed:!1};let o=r.matchSlot?.data?.garden,s=r.matchSlot?.data?.inventory,a=s&&typeof s=="object",i=!hT(o),l=a&&(Array.isArray(s.items)?s.items.length>0:s?.inventory?.items?.length>0);if(!i&&!l)return{next:t,changed:!1};let c={...r.matchSlot,data:{...r.matchSlot?.data||{},garden:qo(),petSlots:RT(r.matchSlot?.data?.petSlots),...a?{inventory:{...s||{},items:[],favoritedItemIds:[]}}:{}}},d=Ur(r,()=>c);return{next:Tn(t,d),changed:!0}}async function TT(t){try{let e=await ce.root.state.get(),{next:n}=AT(e,t);return n}catch{return null}}async function IT(){try{let t=await at().catch(()=>null),e,n;if(t){let l=st("myCurrentGardenTileAtom");if(!l)console.log("[EditorService] logSelectedInventoryItemWithTile: no myCurrentGardenTileAtom");else{let c=t.get(l);e=c?.tileType,n=c?.localTileIndex}}else console.log("[EditorService] logSelectedInventoryItemWithTile: no jotai store");let r=await ce.inventory.myValidatedSelectedItemIndex.get(),o=await ce.inventory.myInventory.get(),s=await ce.inventory.mySelectedItemRotation.get(),a=Array.isArray(o?.items)?o.items:[];if(r==null||typeof r!="number"||r<0||r>=a.length){console.log("[EditorService] logSelectedInventoryItemWithTile: invalid selected index",{selectedIndex:r,itemsLen:a.length});return}let i=a[r];console.log("[EditorService] selected item placement debug",{tileType:e,localTileIndex:n,selectedIndex:r,rotation:s,item:i})}catch(t){console.log("[EditorService] logSelectedInventoryItemWithTile failed",t)}}async function zu(){try{let t=await at().catch(()=>null);if(!t){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: no jotai store");return}let e=st("myCurrentGardenTileAtom");if(!e){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: no myCurrentGardenTileAtom");return}let n=t.get(e);if(!n){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: tileVal is null");return}let r=n.tileType,o=n.localTileIndex,s=n.userSlotIdx,a=typeof s=="number"&&Number.isFinite(s)?s:0;if(o==null||!Number.isFinite(o)){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: invalid localTileIndex",{localTileIndex:o});return}let i=await ce.inventory.myValidatedSelectedItemIndex.get(),l=await ce.inventory.myInventory.get(),c=await ce.inventory.mySelectedItemRotation.get(),d=Array.isArray(l?.items)?l.items:[];if(i==null||typeof i!="number"||i<0||i>=d.length){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: invalid selected index",{selectedIndex:i,itemsLen:d.length});return}let u=d[i];if(u?.itemType!=="Plant"&&u?.itemType!=="Decor"){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: unsupported itemType",{itemType:u?.itemType});return}let y=lt??await ce.root.state.get(),h=y?.child?.data?.userSlots;if(!h||typeof h!="object"){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: no userSlots in state");return}let f=Array.isArray(h),p;if(f)p=h[a];else{let L=String(a);p=h[L]}if(!p){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: slot not found",{userSlotIdx:a,isArray:f});return}let m=p.data||{},g=m.garden&&typeof m.garden=="object"?m.garden:qo(),S={tileObjects:{...g.tileObjects||{}},boardwalkTileObjects:{...g.boardwalkTileObjects||{}}},w=r==="Dirt"?"tileObjects":"boardwalkTileObjects",x=String(o),E;if(u.itemType==="Plant"?E={objectType:"plant",species:u.species,slots:Array.isArray(u.slots)?u.slots:[],plantedAt:u.plantedAt,maturedAt:u.maturedAt}:u.itemType==="Decor"&&(E={objectType:"decor",decorId:u.decorId,rotation:typeof c=="number"?c:u.rotation??0}),!E){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile: failed to build tileObject");return}let T={...S[w],[x]:E},A={tileObjects:w==="tileObjects"?T:S.tileObjects,boardwalkTileObjects:w==="boardwalkTileObjects"?T:S.boardwalkTileObjects},N={...p,data:{...m,garden:A}},H=f?(()=>{let L=h.slice();return L[a]=N,L})():{...h,[String(a)]:N},C=Tn(y,H);lt=C,on=C;try{await Kn(C)}catch(L){console.log("[EditorService] stateAtom set failed (placeSelectedItemInGardenAtCurrentTile)",L)}console.log("[EditorService] placed item in garden",{tileType:r,localTileIndex:o,userSlotIdx:a,selectedIndex:i,itemType:u.itemType,species:u.species,decorId:u.decorId,rotation:c})}catch(t){console.log("[EditorService] placeSelectedItemInGardenAtCurrentTile failed",t)}}async function ch(){try{let t=await at().catch(()=>null);if(!t)return console.log("[EditorService] removeItemFromGardenAtCurrentTile: no jotai store"),!1;let e=st("myCurrentGardenTileAtom");if(!e)return console.log("[EditorService] removeItemFromGardenAtCurrentTile: no myCurrentGardenTileAtom"),!1;let n=t.get(e);if(!n)return console.log("[EditorService] removeItemFromGardenAtCurrentTile: tileVal is null"),!1;let r=n.tileType,o=n.localTileIndex,s=n.userSlotIdx,a=typeof s=="number"&&Number.isFinite(s)?s:0;if(o==null||!Number.isFinite(o))return console.log("[EditorService] removeItemFromGardenAtCurrentTile: invalid localTileIndex",{localTileIndex:o}),!1;let i=lt??await ce.root.state.get(),l=i?.child?.data?.userSlots;if(!l||typeof l!="object")return console.log("[EditorService] removeItemFromGardenAtCurrentTile: no userSlots in state"),!1;let c=Array.isArray(l),d;if(c)d=l[a];else{let T=String(a);d=l[T]}if(!d)return console.log("[EditorService] removeItemFromGardenAtCurrentTile: slot not found",{userSlotIdx:a,isArray:c}),!1;let u=d.data||{},y=u.garden&&typeof u.garden=="object"?u.garden:qo(),h={tileObjects:{...y.tileObjects||{}},boardwalkTileObjects:{...y.boardwalkTileObjects||{}}},f=r==="Dirt"?"tileObjects":"boardwalkTileObjects",p=String(o),g={...h[f]||{}};delete g[p];let S={tileObjects:f==="tileObjects"?g:h.tileObjects,boardwalkTileObjects:f==="boardwalkTileObjects"?g:h.boardwalkTileObjects},w={...d,data:{...u,garden:S}},x=c?(()=>{let T=l.slice();return T[a]=w,T})():{...l,[String(a)]:w},E=Tn(i,x);lt=E,on=E;try{await Kn(E)}catch(T){console.log("[EditorService] stateAtom set failed (removeItemFromGardenAtCurrentTile)",T)}return console.log("[EditorService] removed item from garden",{tileType:r,localTileIndex:o,userSlotIdx:a}),!0}catch(t){return console.log("[EditorService] removeItemFromGardenAtCurrentTile failed",t),!1}}async function Gu(){ch()}async function ju(){ch()}async function gl(t){try{let e=await at().catch(()=>null);if(!e)return!1;let n=st("myCurrentGardenTileAtom");if(!n)return!1;let r=e.get(n);if(!r)return!1;let o=r.tileType,s=r.localTileIndex,a=r.userSlotIdx,i=typeof a=="number"&&Number.isFinite(a)?a:0;if(s==null||!Number.isFinite(s))return!1;let l=lt??await ce.root.state.get(),c=l?.child?.data?.userSlots;if(!c||typeof c!="object")return!1;let d=Array.isArray(c),u;if(d)u=c[i];else{let H=String(i);u=c[H]}if(!u)return!1;let y=u.data||{},h=y.garden&&typeof y.garden=="object"?y.garden:qo(),f={tileObjects:{...h.tileObjects||{}},boardwalkTileObjects:{...h.boardwalkTileObjects||{}}},p=o==="Dirt"?"tileObjects":"boardwalkTileObjects",m=String(s),g=f[p]||{},S=g[m];if(!S)return!1;let w=t(S),x={...g,[m]:w},E={tileObjects:p==="tileObjects"?x:f.tileObjects,boardwalkTileObjects:p==="boardwalkTileObjects"?x:f.boardwalkTileObjects},T={...u,data:{...y,garden:E}},A=d?(()=>{let H=c.slice();return H[i]=T,H})():{...c,[String(i)]:T},N=Tn(l,A);return lt=N,on=N,await Kn(N),!0}catch{return!1}}function fr(t){let e=Number.isFinite(t)?t:100;return Math.max(50,Math.min(100,Math.round(e)))}function oa(t){if(!t)return{minScale:1,maxScale:1};let e=De[t],n=Number(e?.crop?.maxScale);return{minScale:1,maxScale:Number.isFinite(n)&&n>1?n:1}}function dh(t,e){let{minScale:n,maxScale:r}=oa(t);if(!Number.isFinite(e))return n;let o=Math.max(n,r);return Math.max(n,Math.min(o,e))}function ta(t,e){return Number.isFinite(e)?e:1}function mn(t,e){let n=fr(e);if(!t)return 1;let{minScale:r,maxScale:o}=oa(t);if(!o||o<=r)return r;let s=(n-50)/50;return r+s*(o-r)}function Bu(t,e){let{minScale:n,maxScale:r}=oa(t);if(!r||r<=n)return 100;let s=50+(dh(t,e)-n)/(r-n)*50;return fr(s)}function kT(t,e){return e.sizeMode==="custom"?ta(t,e.customScale):mn(t,e.sizePercent)}var ht={species:null,slots:[],applyAll:!1};function vl(t){let n=De[t]?.plant??{},r=n?.harvestType==="Multiple",o=Array.isArray(n.slotOffsets)?n.slotOffsets:[];return r&&o.length>0?o.length:1}function uh(t){let e=vl(t);if(ht.species!==t){let r=mn(t,100);return ht={species:t,slots:Array.from({length:e},()=>({enabled:!0,sizePercent:100,customScale:r,sizeMode:"percent",mutations:[]})),applyAll:!1},ht.slots}let n=ht.slots.slice(0,e);return n.length||(n=[{enabled:!0,sizePercent:100,customScale:mn(t,100),sizeMode:"percent",mutations:[]}]),n=n.map(r=>{let o=fr(r.sizePercent),s=r.sizeMode==="custom"?"custom":"percent",a=mn(t,o),i=ta(t,Number.isFinite(r.customScale)?r.customScale:a),l=s==="custom"?Bu(t,i):o;return{enabled:r.enabled!==!1,sizePercent:l,customScale:i,sizeMode:s,mutations:Array.isArray(r.mutations)?r.mutations:[]}}),ht={...ht,slots:n,applyAll:!!ht.applyAll},n}function Lo(t){return uh(t),ht.applyAll==null&&(ht.applyAll=!1),ht}function PT(t){if(t&&typeof t.read=="function")return"read";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="write"&&e!=="onMount"&&e!=="toString"){let r=n.length;if(r===1||r===2)return e}}throw new Error("stateAtom read() not found")}function LT(t){if(t&&typeof t.write=="function")return"write";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="read"&&e!=="onMount"&&e!=="toString"&&n.length>=2)return e}return null}async function ph(){await at().catch(()=>{});let t=await Un();if(!t)return;let e=st("stateAtom");if(!e)return;try{on=await ce.root.state.get()}catch{on=null}let n=await TT(t);if(!n)return;try{await ce.root.state.set(n)}catch{}if(lt=n,Gt&&Gt.atom===e)return;let r;try{r=PT(e)}catch{return}let o=e[r],s=LT(e)||void 0,a=s?e[s]:void 0;e[r]=()=>lt,s&&(e[s]=()=>lt),Gt={atom:e,readKey:r,origRead:o,writeKey:s,origWrite:a}}function mh(){if(Gt)try{Gt.atom[Gt.readKey]=Gt.origRead,Gt.writeKey&&Gt.origWrite&&(Gt.atom[Gt.writeKey]=Gt.origWrite)}catch{}if(Gt=null,lt=null,on!=null)try{ce.root.state.set(on)}catch{}on=null}function RT(t){return Array.isArray(t)?[]:t&&typeof t=="object"?{}:[]}et("qwsLogSelectedInventoryItemWithTile",()=>{IT()});et("qwsPlaceSelectedItemInGardenAtCurrentTile",()=>{zu()});et("qwsRemoveItemFromGardenAtCurrentTile",()=>{Gu()});et("qwsRemoveDecorFromGardenAtCurrentTile",()=>{ju()});et("qwsEditorListSavedGardens",()=>wT());et("qwsEditorSaveGarden",async t=>await lh(t||"Untitled"));et("qwsEditorClearGarden",async()=>{let t=qo();return await ih(t)});et("qwsEditorLoadGarden",async t=>await xT(t));et("qwsEditorSaveGardenForPlayer",async(t,e)=>await lh(e||"Untitled",t));et("qwsEditorDeleteGarden",t=>ET(t));et("qwsEditorExportGarden",t=>CT(t));et("qwsEditorImportGarden",async(t,e)=>await MT(t,e));et("qwsEditorPreviewFriendGarden",async t=>await ST(t));et("qwsEditorClearFriendGardenPreview",async()=>await vT());function _T(){Ug||typeof window>"u"||(Ug=!0,window.addEventListener("keydown",t=>{if(!mr(t)){if(An("editor.toggle-overlays",t)){if(t.preventDefault(),t.stopPropagation(),!Kr)return;Do=!Do,Do?(Xg(),nh(),oh()):(eh(),rh(),sh());return}if(Kr){if(An("editor.place-remove",t)){t.preventDefault(),t.stopPropagation();let e=Du;Du=!0,DT(t,e);return}An("editor.delete-inventory",t)&&(t.preventDefault(),t.stopPropagation(),uT())}}},!0),window.addEventListener("keyup",t=>{t?.__inGameHotkeysRapidSynthetic__!==!0&&Kr&&An("editor.place-remove",t)&&(Du=!1,Xs=0,Ro=0,ea=!1,hl=null,bl=void 0,_o=0)},!0))}async function NT(){try{let t=await ce.inventory.myInventory.get(),e=await ce.inventory.myValidatedSelectedItemIndex.get(),n=Array.isArray(t?.items)?t.items:[];return typeof e=="number"&&!!n[e]}catch{return!1}}async function DT(t,e=!1){let n=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now();(!e||Xs===0)&&(Xs=n,Ro=0,ea=!1,hl=null,bl=void 0,_o=0);let{tileObject:r,tileKey:o,tileType:s}=await ah(),a=await NT(),i=!!r,l=!r&&a;if(!i&&!l)return;`${s??"?"}|${o??"none"}`===`${bl??"?"}|${hl??"none"}`||(hl=o??null,bl=s,ea=!1,Ro=0,Xs=n,_o=0);let u=n-Xs;if(!ea)ea=!0,Ro=n,_o=n;else{let h=(_o>0?n-_o:u)<Vg?Vg:JA;if(n-Ro<h)return;Ro=n}if(i){if(r?.objectType==="plant"){await Gu(),qu("dig");return}if(r?.objectType==="decor"){await ju(),qu("dig");return}}l&&(await zu(),qu("dropObject"))}var xl=[],fh=!1;function qT(t){return xl.push(t),()=>{let e=xl.indexOf(t);e!==-1&&xl.splice(e,1)}}function OT(t,e){for(let n of[...xl])try{n(t,e)}catch{}}function FT(t){return t?.code===4710||/Version\s*Expired/i.test(t?.reason||"")}function BT(){qT(t=>{if(!FT(t))return;let e=yo();if(!(e.surface==="discord"||e.isInIframe)&&!fh){fh=!0;try{console.warn("[MagicGarden] Version expired, reloading...")}catch{}try{Re.location.reload()}catch{try{window.location.reload()}catch{}}}})}function gh(){if(!Re||!_t)return;BT();function t(n,r){let o=r!==void 0?new _t(n,r):new _t(n);return It.push(o),o.addEventListener("open",()=>{setTimeout(()=>{o.readyState===_t.OPEN&&_r(o,"open-fallback")},800)}),o.addEventListener("message",async s=>{let a=await Xf(s.data);a&&!e()&&(a.type==="Welcome"||a.type==="Config"||a.fullState||a.config)&&_r(o,"message:"+(a.type||"state"))}),o.addEventListener("close",s=>{OT(s,o)}),o}t.prototype=_t.prototype;try{t.OPEN=_t.OPEN}catch{}try{t.CLOSED=_t.CLOSED}catch{}try{t.CLOSING=_t.CLOSING}catch{}try{t.CONNECTING=_t.CONNECTING}catch{}if(Re.WebSocket=t,Re!==window)try{window.WebSocket=t}catch{}function e(){return!!Xn("quinoaWS")}zT()}var Bo=new Map,Fo=Xn("__tmMessageHookInstalled")?"installed":"idle",kn=null,aa=null;function dn(t,e){let n=Bo.get(t);return n?n.push(e):Bo.set(t,[e]),HT(),()=>{let r=Bo.get(t);if(!r)return;let o=r.indexOf(e);o!==-1&&r.splice(o,1),r.length===0&&Bo.delete(t)}}function HT(){if(Fo==="installed"||Fo==="installing")return;Fo="installing";let t=()=>{let e=Re.MagicCircle_RoomConnection||Xn("MagicCircle_RoomConnection");if(!e)return!1;let n=nI(e);if(!n)return!1;let r=function(o,...s){let a=o;try{let i=a?.type;if(i&&Bo.size>0){let c=WT(i,a,{thisArg:this,args:s});if(c.drop)return;a=c.message}}catch(i){console.error("[MG-mod] Erreur dans le hook WS :",i)}return n.fn.call(this,a,...s)};return n.kind==="static"?e.sendMessage=r:e.prototype.sendMessage=r,Fo="installed",et("__tmMessageHookInstalled",!0),kn!==null&&(clearInterval(kn),kn=null),aa!==null&&(clearTimeout(aa),aa=null),!0};t()||(kn=window.setInterval(()=>{t()&&kn!==null&&(clearInterval(kn),kn=null)},200),aa=window.setTimeout(()=>{kn!==null&&(clearInterval(kn),kn=null),Fo!=="installed"&&(Fo="idle"),aa=null},2e4))}function WT(t,e,n){let r=Bo.get(t);if(!r||r.length===0)return{message:e,drop:!1};let o=e;for(let s of[...r])try{let a=s(o,n);if(!a)continue;if(a.kind==="drop")return{message:o,drop:!0};a.kind==="replace"&&(o=a.message)}catch{}return{message:o,drop:!1}}function zT(){if(Xn("__tmHarvestHookInstalled"))return;let t=null,e=null,n=null,r=null;(async()=>{try{t=await ce.data.garden.get()??null}catch{}try{await ce.data.garden.onChange(s=>{t=s??null})}catch{}try{let s=await ce.data.myCurrentGardenObject.get();r=yh(s)}catch{}try{await ce.data.myCurrentGardenObject.onChange(s=>{r=yh(s)})}catch{}})(),(async()=>{try{let s=await ce.server.friendBonusMultiplier.get();e=Hn(s)}catch{}try{await ce.server.friendBonusMultiplier.onChange(s=>{e=Hn(s)})}catch{}try{let s=await ce.server.numPlayers.get();n=$t(s)}catch{}try{await ce.server.numPlayers.onChange(s=>{n=$t(s)})}catch{}})();let o=()=>e??n??null;dn("HarvestCrop",s=>{let a=s.slot,i=s.slotsIndex;if(!Number.isInteger(a)||!Number.isInteger(i))return;let c=t?.tileObjects,d=c?c[String(a)]:void 0;if(!d||typeof d!="object"||d.objectType!=="plant")return;let y=(Array.isArray(d.slots)?d.slots:[])[i];if(!y||typeof y!="object")return;let h=hh(d),f=UT(y),p=Sh(y?.mutations);if((()=>{try{return xt.getState().enabled}catch{return!1}})()){let g=!0;try{g=xt.allowsHarvest({seedKey:h,sizePercent:f,mutations:p})}catch{g=!0}if(!g)return console.log("[HarvestCrop] Blocked by locker",{slot:a,slotsIndex:i,seedKey:h,sizePercent:f,mutations:p}),{kind:"drop"}}Fe.incrementGardenStat("totalHarvested"),(async()=>{try{let S=(await ce.data.garden.get())?.tileObjects??null,w=S?S[String(a)]:void 0,x=Array.isArray(w?.slots)?w.slots?.[i]:void 0;console.log("[HarvestCrop]",{slot:a,slotsIndex:i,cropSlot:x})}catch(g){console.error("[HarvestCrop] Unable to log crop slot",g)}})()}),dn("RemoveGardenObject",s=>{Fe.incrementGardenStat("totalDestroyed")}),dn("WaterPlant",s=>{Fe.incrementGardenStat("watercanUsed"),Fe.incrementGardenStat("waterTimeSavedMs",5*60*1e3)}),dn("PlantSeed",s=>{Fe.incrementGardenStat("totalPlanted")}),dn("PurchaseDecor",s=>{Fe.incrementShopStat("decorBought")}),dn("PurchaseSeed",s=>{Fe.incrementShopStat("seedsBought")}),dn("PurchaseEgg",s=>{Fe.incrementShopStat("eggsBought")}),dn("PurchaseTool",s=>{Fe.incrementShopStat("toolsBought")}),dn("PickupDecor",()=>{if(In.isEnabled())try{let a=Xn("qwsRemoveDecorFromGardenAtCurrentTile")||Re.qwsRemoveDecorFromGardenAtCurrentTile;if(typeof a=="function")return console.log("[PickupDecor][Editor] intercept -> local remove"),a(),{kind:"drop"}}catch(a){console.log("[PickupDecor][Editor] remove interceptor error",a)}if(mt.isDecorPickupLocked())return console.log("[PickupDecor] Blocked by decor picker"),{kind:"drop"}}),dn("HatchEgg",()=>{if(mt.isEggLocked(r))return console.log("[HatchEgg] Blocked by egg locker",{eggId:r}),(async()=>{try{await ZT(r)}catch{}})(),{kind:"drop"};(async()=>{let a=await Uu(),i=JT(a),l=await eI(i);if(!l)return;let c=$T(l,i);if(c.length)for(let d of c){let u=XT(d.mutations);d.species&&Fe.incrementPetHatched(d.species,u)}})()}),dn("SellAllCrops",s=>{let a=mt.getState(),i=mt.getRequiredPercent(),l=a.minRequiredPlayers,c=o();if(!mt.allowsCropSale(c)){let u=c!=null?xs(c):null;return console.log("[SellAllCrops] Blocked by friend bonus restriction",{requiredPct:i,requiredPlayers:l,currentBonusPct:c,currentPlayers:u}),(async()=>{try{await be("Friend bonus locker",`Require at least ${i}% friend bonus`,"error")}catch{}rI()})(),{kind:"drop"}}(async()=>{try{let u=await ce.inventory.myCropItemsToSell.get(),y=Array.isArray(u)?u.length:0;y>0&&Fe.incrementShopStat("cropsSoldCount",y)}catch(u){console.error("[SellAllCrops] Unable to read crop items",u)}try{let u=await ce.shop.totalCropSellPrice.get(),y=Number(u);Number.isFinite(y)&&y>0&&Fe.incrementShopStat("cropsSoldValue",y)}catch(u){console.error("[SellAllCrops] Unable to read crop sell price",u)}})()}),dn("SellPet",s=>{Fe.incrementShopStat("petsSoldCount"),(async()=>{try{let a=await ce.pets.totalPetSellPrice.get(),i=Number(a);Number.isFinite(i)&&i>0&&Fe.incrementShopStat("petsSoldValue",i)}catch(a){console.error("[SellPet] Unable to read pet sell price",a)}})()}),et("__tmHarvestHookInstalled",!0)}function hh(t){if(!t||typeof t!="object")return null;if(typeof t.seedKey=="string"&&t.seedKey)return t.seedKey;if(typeof t.species=="string"&&t.species)return t.species;let e=["seedSpecies","plantSpecies","cropSpecies","speciesId"];for(let n of e){let r=t[n];if(typeof r=="string"&&r)return r}return null}var bh=t=>t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),GT=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=bh(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(De)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})();function jT(t){if(typeof t!="string")return null;let e=bh(t.trim());if(!e)return null;let n=GT.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null}function KT(t){if(!t||typeof t!="object")return null;let e=new Set,n=hh(t);n&&e.add(n);let r=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"];for(let o of r){let s=t[o];typeof s=="string"&&s&&e.add(s)}for(let o of e){let s=jT(o);if(typeof s=="number"&&Number.isFinite(s)&&s>0)return s}return null}function UT(t){if(!t||typeof t!="object")return 100;let e=Number(t.sizePercent??t.sizePct??t.size??t.percent??t.progressPercent);if(Number.isFinite(e))return wl(Math.round(e),0,100);let n=Number(t.targetScale??t.scale);if(Number.isFinite(n)){let r=KT(t);if(typeof r=="number"&&Number.isFinite(r)&&r>1){let a=50+(Math.max(1,Math.min(r,n))-1)/(r-1)*50;return wl(Math.round(a),50,100)}if(n>1&&n<=2){let s=50+(n-1)/1*50;return wl(Math.round(s),50,100)}let o=Math.round(n*100);return wl(o,0,100)}return 100}function Sh(t){if(!Array.isArray(t))return[];let e=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="string")r&&e.push(r);else if(r!=null){let o=String(r);o&&e.push(o)}}return e}function wl(t,e,n){return Math.max(e,Math.min(n,t))}var VT=5e3;async function Uu(){try{let t=await ce.inventory.myInventory.get();return vh(t)}catch(t){return console.error("[HatchEgg] Unable to read inventory",t),[]}}function vh(t){let e=YT(t),n=[];for(let r of e){let o=QT(r);o&&n.push(o)}return n}function YT(t){return t?Array.isArray(t)?t:Array.isArray(t.items)?t.items:Array.isArray(t.inventory)?t.inventory:Array.isArray(t.inventory?.items)?t.inventory.items:[]:[]}function QT(t){if(!t||typeof t!="object")return null;let e=t.item&&typeof t.item=="object"?t.item:t;if(!e||typeof e!="object")return null;let n=e.itemType??e.data?.itemType??"";if(String(n).toLowerCase()!=="pet")return null;let r=e.id??e.data?.id,o=e.petSpecies??e.data?.petSpecies;if(!r||!o)return null;let s=Sh(e.mutations??e.data?.mutations);return{id:String(r),species:String(o),mutations:s}}function JT(t){let e=new Map;for(let n of t)e.set(n.id,n);return e}function $T(t,e){return t.filter(n=>!e.has(n.id))}function yh(t){if(!t||typeof t!="object"||t.objectType!=="egg")return null;let e=t.eggId;return typeof e=="string"&&e?e:null}async function ZT(t){let e=st("quinoaToastsAtom"),n=t?`Hatching locked for ${t}`:"Hatching locked by egg locker";if(!e){await be("Egg hatch locker",n,"error");return}let r=await Rt(e).catch(()=>[]),o=Array.isArray(r)?r.filter(s=>s?.title!=="Egg hatch locker"):[];o.push({isClosable:!0,duration:3500,title:"Egg hatch locker",description:n,variant:"error",id:"quinoa-game-toast"}),await En(e,o)}function XT(t){if(!Array.isArray(t)||t.length===0)return"normal";let e=new Set(t.map(n=>String(n).toLowerCase()));return e.has("rainbow")?"rainbow":e.has("gold")||e.has("golden")?"gold":"normal"}async function eI(t,e=VT){await tI(0);let n=await Uu();return Ku(n,t)?n:new Promise(async r=>{let o=!1,s=null,a=null,i=c=>{if(!o){if(o=!0,a!==null&&clearTimeout(a),s)try{s()}catch{}r(c)}},l=c=>{let d=vh(c);Ku(d,t)&&i(d)};try{s=await ce.inventory.myInventory.onChange(c=>{l(c)})}catch(c){console.error("[HatchEgg] Unable to observe inventory",c),i(null);return}a=setTimeout(()=>{(async()=>{let c=await Uu();Ku(c,t)?i(c):i(null)})()},e)})}function Ku(t,e){return t.some(n=>!e.has(n.id))}function tI(t){return new Promise(e=>setTimeout(e,t))}function nI(t){let e=n=>typeof n=="function";return e(t.sendMessage)?{kind:"static",fn:t.sendMessage.bind(t)}:t.prototype&&e(t.prototype.sendMessage)?{kind:"proto",fn:t.prototype.sendMessage}:null}async function rI(){try{let t=st("quinoaToastsAtom");if(!t)return;let e=await Rt(t).catch(()=>[]),n=Array.isArray(e)?e.filter(r=>{if(!r||typeof r!="object"||r.variant!=="success")return!0;let o=r.icon,s=o?.type==="tile"&&o?.spritesheet==="items"&&Number(o?.index)===11,a=!!r?.description?.props?.values?.cropText;return!(s||a)}):e;n.length!==e.length&&await En(t,n)}catch{}}var Rh="pets.overrides",_h="pets.ui",Nh="pets.teams",Dh="pets.teamSearch",wh="pets.hotkeys",Vu="pets.abilityLogs",da=new Map,Yu=new Map,Xu=null,ep=null,El=null,Cl=null,Ot=[],gr=null;function xh(t){let e=Et(Js(t));e?da.set(t,e):da.delete(t)}function Eh(){Xu=Et(ml)}function Ch(){ep=Et(fl)}function oI(t){let e=_e(wh)??{},n=e[t];if(!n)return;let r=Js(t);if(!Et(r)){let a=Us(n);a&&$s(r,a)}let s={...e};delete s[t],Oe(wh,s)}function sI(t){return Array.isArray(t)?t.map(e=>({id:String(e?.id??""),name:e?.name??null})).filter(e=>e.id.length>0):[]}function aI(){if(!Ot.length){gr=null;return}(!gr||!Ot.includes(gr))&&(gr=Ot[0]??null)}function Mh(t){if(!Ot.length)return null;if(!gr||!Ot.includes(gr))return t===1?Ot[0]??null:Ot[Ot.length-1]??null;if(Ot.length===1)return Ot[0]??null;let n=Ot.indexOf(gr)+t;return n<0&&(n=Ot.length-1),n>=Ot.length&&(n=0),Ot[n]??null}function Ho(t){gr=t?String(t):null}function fa(t){for(let r of Yu.values())try{r()}catch{}if(Yu.clear(),El){try{El()}catch{}El=null}if(Cl){try{Cl()}catch{}Cl=null}let e=sI(t);Ru(e),Ot=e.map(r=>r.id),aI();let n=new Set(Ot);for(let r of Array.from(da.keys()))n.has(r)||da.delete(r);e.forEach(r=>{oI(r.id),xh(r.id);let o=Mn(Js(r.id),()=>xh(r.id));Yu.set(r.id,o)}),Eh(),Ch(),El=Mn(ml,()=>Eh()),Cl=Mn(fl,()=>Ch())}function Rl(t){let e="__qws_pet_team_hk_installed";window[e]||(window.addEventListener("keydown",n=>{if(mr(n))return;let r=o=>{o&&(Ho(o),t(o))};if(ep&&To(n,ep)){let o=Mh(-1);if(o){n.preventDefault(),n.stopPropagation(),r(o);return}}if(Xu&&To(n,Xu)){let o=Mh(1);if(o){n.preventDefault(),n.stopPropagation(),r(o);return}}for(let[o,s]of da)if(To(n,s)){n.preventDefault(),n.stopPropagation(),r(o);break}},!0),window[e]=!0)}var Wo=Bt??{};function ia(t){let e=String(t??""),n=typeof Wo?.[e]?.name=="string"&&Wo[e].name.trim()?Wo[e].name:e;return String(n)}function qh(t){let e=String(t??""),n=typeof Wo?.[e]?.name=="string"&&Wo[e].name.trim()?Wo[e].name:e;return String(n).replace(/(?:\s+|-)?(?:I|II|III|IV|V|VI|VII|VIII|IX|X)\s*$/,"").trim()}function Ah(t){let e=String(t||"").trim(),n=e.match(/^(ab|sp):\s*(.*)$/i);return n?{mode:n[1].toLowerCase()==="ab"?"ability":"species",value:(n[2]||"").trim()}:{mode:"text",value:e}}async function Th(t){await ca();let e=String(t||"").toLowerCase().trim().replace(/(?:\s+|-)?(?:i|ii|iii|iv|v|vi|vii|viii|ix|x)\s*$/i,""),n=new Set;if(!e)return n;for(let r of ma){let o=Array.isArray(r.abilities)?r.abilities:[];for(let s of o)qh(s).toLowerCase()===e&&n.add(s)}return n}var nt=t=>(t??"").toLowerCase(),Oh=t=>typeof t=="string"?t:null,kl=t=>Number.isFinite(t)?t:0,Pl=t=>Array.isArray(t)?t.filter(e=>typeof e=="string"):[];function iI(t){if(!t||gt[t])return t;let e=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return gt[e]?e:t}function Qu(t){return{id:t.id,itemType:"Pet",petSpecies:iI(t.petSpecies),name:t.name??null,xp:t.xp,hunger:t.hunger,mutations:Array.isArray(t.mutations)?t.mutations.slice():[],targetScale:t.targetScale,abilities:Array.isArray(t.abilities)?t.abilities.slice():[]}}function Fh(){let t=_e(Nh)??[];return Array.isArray(t)?t.map(e=>({id:String(e?.id||""),name:String(e?.name||"Team"),slots:Array.isArray(e?.slots)?e.slots.slice(0,3).map(n=>n?String(n):null):[null,null,null]})).filter(e=>e.id):[]}function Ml(t){Oe(Nh,t)}function lI(){try{return crypto.randomUUID()}catch{return`t_${Date.now().toString(36)}_${Math.random().toString(16).slice(2)}`}}function cI(){let t=_e(Dh);return t&&typeof t=="object"?t:{}}function dI(t){Oe(Dh,t)}var rF=Fh();var Ju=cI(),Vr=null,ua=[],pa=[],ma=[],Bh=null,Hh=null,Wh=null,Al=null,Tl=null;function zo(t){if(!t||t.itemType!=="Pet")return null;let e=nt(t.id);return e?{id:e,itemType:"Pet",petSpecies:nt(t.petSpecies??t.data?.petSpecies),name:Oh(t.name??t.data?.name??null),xp:kl(t.xp??t.data?.xp),hunger:kl(t.hunger??t.data?.hunger),mutations:Pl(t.mutations??t.data?.mutations),targetScale:Number.isFinite(t.targetScale??t.data?.targetScale)?Number(t.targetScale??t.data?.targetScale):void 0,abilities:Pl(t.abilities??t.data?.abilities)}:null}function zh(t){let e=t?.slot;if(!e||typeof e!="object")return null;let n=nt(e.id);return n?{id:n,itemType:"Pet",petSpecies:nt(e.petSpecies),name:Oh(e.name??null),xp:kl(e.xp),hunger:kl(e.hunger),mutations:Pl(e.mutations),targetScale:Number.isFinite(e.targetScale)?Number(e.targetScale):void 0,abilities:Pl(e.abilities)}:null}function Gh(t){return JSON.stringify({id:t.id,itemType:"Pet",petSpecies:t.petSpecies,name:t.name??null,mutations:Array.isArray(t.mutations)?t.mutations:[],targetScale:Number.isFinite(t.targetScale)?t.targetScale:null,abilities:Array.isArray(t.abilities)?t.abilities:[]})}function tp(t){let e=new Map,n=Array.isArray(t?.items)?t.items:Array.isArray(t)?t:[];for(let r of n){let o=zo(r);o&&e.set(o.id,Gh(o))}return e}function np(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=zh(r);o&&e.set(o.id,Gh(o))}return e}function jh(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}function Yr(){let t=new Map,e=Array.isArray(pa)?pa:[],n=Array.isArray(Vr?.items)?Vr.items:Array.isArray(Vr)?Vr:[];for(let o of e){let s=zo(o);s&&s.id&&t.set(s.id,s)}for(let o of n){let s=zo(o);s&&s.id&&t.set(s.id,s)}let r=Array.isArray(ua)?ua:[];for(let o of r){let s=zh(o);s&&s.id&&t.set(s.id,s)}ma=Array.from(t.values())}async function uI(){let t=await(async()=>{try{let e=await ce.inventory.myInventory.get();Al=tp(e),Vr=e,Yr()}catch{}return ce.inventory.myInventory.onChange(e=>{let n=tp(e);jh(Al,n)||(Al=n,Vr=e,Yr())})})();Bh=()=>{try{t()}catch{}}}async function pI(){let t=await(async()=>{try{let e=await ce.pets.myPetInfos.get();Tl=np(e),ua=Array.isArray(e)?e:[],Yr()}catch{}return ce.pets.myPetInfos.onChange(e=>{let n=np(e);jh(Tl,n)||(Tl=n,ua=Array.isArray(e)?e:[],Yr())})})();Hh=()=>{try{t()}catch{}}}async function mI(){let t=await(async()=>{try{let e=await lo.get();pa=Array.isArray(e)?e:[],Yr()}catch{}return lo.onChange(e=>{pa=Array.isArray(e)?e:[],Yr()})})();Wh=()=>{try{t()}catch{}}}async function ca(){if(Bh||await uI(),Hh||await pI(),Wh||await mI(),!ma.length)try{let[t,e,n]=await Promise.all([ce.inventory.myInventory.get(),ce.pets.myPetInfos.get(),lo.get()]);Al=tp(t),Tl=np(e),Vr=t,ua=Array.isArray(e)?e:[],pa=Array.isArray(n)?n:[],Yr()}catch{}}async function Vn(){try{await ce.inventory.setSelectedIndexToEnd.set(null)}catch{}try{await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(null)}catch{}try{await we.setSelectedItem(null)}catch{}try{await we.dropObject()}catch{}}async function Ih(t=2e4){await Vn();let e=performance.now();for(;performance.now()-e<t;){try{let n=await ce.ui.activeModal.get();if(!ki(n))return null}catch{return null}try{let n=await ce.inventory.myValidatedSelectedItemIndex.get();if(typeof n=="number"&&Number.isInteger(n)&&n>=0)return n}catch{}await new Promise(n=>setTimeout(n,80))}return null}var Il=new Map,kh={enabled:!1,thresholdPct:10,crops:{}},fI={selectedPetId:null},Ll=[],rp=null;function Ph(t){Oe(Rh,t)}function $u(){let t=_e(Rh);return t&&typeof t=="object"?t:{}}function yI(t){Oe(_h,t)}function Lh(){let t=_e(_h);return{...fI,...t||{}}}function la(t){let e=t??kh;return{enabled:!!e.enabled,thresholdPct:Math.min(100,Math.max(1,Number(e.thresholdPct)||kh.thresholdPct)),crops:{...e.crops||{}}}}function gI(t){return Math.max(0,Math.min(100,t))}function hI(t){let n=gt?.[t],r=n?.diet??n?.compatibleCrops??n?.crops??[];return(Array.isArray(r)?r:[]).filter(s=>typeof s=="string"&&s.length>0)}function bI(t){let e=gt?.[t]?.coinsToFullyReplenishHunger;return typeof e=="number"&&Number.isFinite(e)&&e>0?e:3e3}async function SI(t){try{let e=await we.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===String(t))??null}catch{return null}}function vI(t,e){let n=Array.isArray(e)?e:[];for(let r of n){let o=String(r?.species||"");if(o&&t.has(o))return r}return null}function wI(t){try{rp?.(t)}catch{}}async function xI(t){let e=String(t?.slot?.id||"");if(!e)return;let n=Me.getOverride(e);if(!n.enabled){Il.set(e,!1);return}let r=Me.getHungerPctFor(t),o=Math.max(1,Math.min(100,n.thresholdPct|0||10)),s=Il.get(e)===!0,a=r<o;if(a&&!s){let i;try{i=await Me.getPetAllowedCrops(e)}catch{let u=String(t?.slot?.petSpecies||"");i=new Set(Me.getCompatibleCropsForSpecies(u))}let l=Array.from(i),c=null,d=!1;try{let[u,y]=await Promise.all([we.getCropInventoryState(),we.getFavoriteIds?.()??[]]),h=Array.isArray(u)?u:[],f=new Set(Array.isArray(y)?y:[]),p=h.filter(m=>!f.has(String(m?.id)));if(c=vI(i,p),c?.id&&we.feedPet)try{await we.feedPet(e,c.id)}catch{}}catch{}wI({pet:t,petId:e,species:String(t?.slot?.petSpecies||""),hungerPct:r,thresholdPct:o,allowedCrops:l,chosenItem:c,didUnfavorite:d})}Il.set(e,a)}async function Zu(){let t=Array.isArray(Ll)?Ll:[];for(let e of t)try{await xI(e)}catch{}}var Me={getPets(){return we.getPets()},onPetsChange(t){return we.onPetsChange(t)},onPetsChangeNow(t){return we.onPetsChangeNow(t)},getAbilityName(t){return ia(t)},getAbilityNameWithoutLevel(t){return qh(t)},setUIState(t){let n={...Lh(),...t||{}};return yI(n),n},setSelectedPet(t){return this.setUIState({selectedPetId:t})},getSelectedPetId(){return Lh().selectedPetId??null},getOverride(t){let e=$u();return la(e[t])},setOverride(t,e){let n=$u(),r=la(n[t]),o={enabled:e.enabled??r.enabled,thresholdPct:Number.isFinite(e.thresholdPct)?Math.min(100,Math.max(1,Number(e.thresholdPct))):r.thresholdPct,crops:{...r.crops,...e.crops||{}}};return n[t]=o,Ph(n),Zu(),o},updateOverride(t,e){let n=$u(),r=la(n[t]),o=la(e(r));return n[t]=o,Ph(n),Zu(),o},async setPetAutofeedEnabled(t,e){return this.setOverride(t,{enabled:!!e})},getPetAutofeedEnabled(t){return this.getOverride(t).enabled},async setPetAutofeedThresholdPct(t,e){let n=Math.min(100,Math.max(1,Math.floor(Number(e)||10)));return this.setOverride(t,{thresholdPct:n})},getPetAutofeedThresholdPct(t){return this.getOverride(t).thresholdPct},async setPetAllowedCrop(t,e,n){return this.updateOverride(t,r=>{let o=la(r),s=o.crops[e]??{allowed:!0};return o.crops[e]={allowed:n??s.allowed},o})},async getPetAllowedCrops(t){let e=this.getOverride(t),r=(await SI(t))?.slot?.petSpecies||"",o=this.getCompatibleCropsForSpecies(r),s=new Set;for(let a of o){let i=e.crops[a];(!i||i.allowed)&&s.add(a)}return s},getCompatibleCropsForSpecies(t){return hI(t)},getMaxHungerForSpecies(t){return bI(t)},getHungerPctFor(t){let e=Number(t?.slot?.hunger)||0,n=String(t?.slot?.petSpecies||""),r=this.getMaxHungerForSpecies(n),o=e/r*100;return+gI(o).toFixed(1)},async startAutofeedWatcher(t){rp=t??null;let e=await we.onPetsChangeNow(n=>{Ll=Array.isArray(n)?n.slice():[],Zu()});return()=>{try{e()}catch{}Ll=[],Il.clear(),rp=null}},_teams:Fh(),_teamSubs:new Set,_notifyTeamSubs(){let t=this.getTeams();this._teamSubs.forEach(e=>{try{e(t)}catch{}})},getTeams(){return Array.isArray(this._teams)?this._teams.map(t=>({...t,slots:t.slots.slice(0,3)})):[]},onTeamsChange(t){this._teamSubs.add(t);try{t(this.getTeams())}catch{}return()=>{this._teamSubs.delete(t)}},async onTeamsChangeNow(t){let e=this.onTeamsChange(t);try{t(this.getTeams())}catch{}return e},createTeam(t){let e={id:lI(),name:t?.trim()||`Team ${this._teams.length+1}`,slots:[null,null,null]};return this._teams.push(e),Ml(this._teams),this._notifyTeamSubs(),e},deleteTeam(t){let e=this._teams.findIndex(n=>n.id===t);return e<0?!1:(this._teams.splice(e,1),Ml(this._teams),this._notifyTeamSubs(),!0)},saveTeam(t){let e=this._teams.findIndex(o=>o.id===t.id);if(e<0)return null;let n=this._teams[e],r={id:n.id,name:typeof t.name=="string"?t.name:n.name,slots:Array.isArray(t.slots)?t.slots.slice(0,3):n.slots};return this._teams[e]=r,Ml(this._teams),this._notifyTeamSubs(),r},setTeamsOrder(t){let e=new Map(this._teams.map(r=>[r.id,r])),n=[];for(let r of t){let o=e.get(r);o&&(n.push(o),e.delete(r))}for(let r of e.values())n.push(r);this._teams=n,Ml(this._teams),this._notifyTeamSubs()},getTeamById(t){let e=this._teams.find(n=>n.id===t)||null;return e?{...e,slots:e.slots.slice(0,3)}:null},getTeamSearch(t){return Ju[t]||""},setTeamSearch(t,e){Ju[t]=(e||"").trim(),dI(Ju)},async getInventoryPets(){return await ca(),ma.slice()},async buildFilteredInventoryForTeam(t,e){await ca();let{mode:n,value:r}=Ah(this.getTeamSearch(t)||""),o=await this.getInventoryPets();if(n==="ability"&&r){let i=await Th(r);o=i.size?o.filter(l=>Array.isArray(l.abilities)&&l.abilities.some(c=>i.has(c))):[]}else if(n==="species"&&r){let i=r.toLowerCase();o=o.filter(l=>(l.petSpecies||"").toLowerCase()===i)}else if(r){let i=r.toLowerCase();o=o.filter(l=>nt(l.id).includes(i)||nt(l.petSpecies).includes(i)||nt(l.name).includes(i)||Array.isArray(l.abilities)&&l.abilities.some(c=>nt(c).includes(i)||nt(ia(c)).includes(i))||Array.isArray(l.mutations)&&l.mutations.some(c=>nt(c).includes(i)))}if(e?.excludeIds?.size){let i=e.excludeIds;o=o.filter(l=>!i.has(l.id))}let s=o.map(Qu),a=[];try{let i=await ce.inventory.favoriteIds.get().catch(()=>[]),l=new Set(o.map(c=>c.id));a=(i||[]).filter(c=>l.has(c))}catch{}return{items:s,favoritedItemIds:a}},async buildFilteredInventoryByQuery(t,e){await ca();let n=(t||"").toLowerCase().trim(),r=await this.getInventoryPets();if(n&&(r=r.filter(a=>nt(a.id).includes(n)||nt(a.petSpecies).includes(n)||nt(a.name).includes(n)||Array.isArray(a.abilities)&&a.abilities.some(i=>nt(i).includes(n)||nt(ia(i)).includes(n))||Array.isArray(a.mutations)&&a.mutations.some(i=>nt(i).includes(n)))),e?.excludeIds?.size){let a=e.excludeIds;r=r.filter(i=>!a.has(i.id))}let o=r.map(Qu),s=[];try{let a=await ce.inventory.favoriteIds.get().catch(()=>[]),i=new Set(r.map(l=>l.id));s=(a||[]).filter(l=>i.has(l))}catch{}return{items:o,favoritedItemIds:s}},async chooseSlotPet(t,e,n){let r=Math.max(0,Math.min(2,Math.floor(e||0))),o=this.getTeamById(t);if(!o)return null;let s=new Set;o.slots.forEach((u,y)=>{y!==r&&u&&s.add(String(u))});let a=n&&n.trim().length?await this.buildFilteredInventoryByQuery(n,{excludeIds:s}):await this.buildFilteredInventoryForTeam(t,{excludeIds:s}),i=Array.isArray(a?.items)?a.items:[];try{let u=await lo.get(),h=(Array.isArray(u)?u:[]).map(m=>zo(m)).filter(m=>!!m),f=this.getTeamSearch(t)||"";if(n&&n.trim().length){let m=n.toLowerCase().trim();m&&(h=h.filter(g=>nt(g.id).includes(m)||nt(g.petSpecies).includes(m)||nt(g.name).includes(m)||Array.isArray(g.abilities)&&g.abilities.some(S=>nt(S).includes(m)||nt(ia(S)).includes(m))||Array.isArray(g.mutations)&&g.mutations.some(S=>nt(S).includes(m))))}else if(f&&f.trim().length){let{mode:m,value:g}=Ah(f);if(m==="ability"&&g){let S=await Th(g);h=S.size?h.filter(w=>Array.isArray(w.abilities)&&w.abilities.some(x=>S.has(x))):[]}else if(m==="species"&&g){let S=g.toLowerCase();h=h.filter(w=>(w.petSpecies||"").toLowerCase()===S)}else if(g){let S=g.toLowerCase();h=h.filter(w=>nt(w.id).includes(S)||nt(w.petSpecies).includes(S)||nt(w.name).includes(S)||Array.isArray(w.abilities)&&w.abilities.some(x=>nt(x).includes(S)||nt(ia(x)).includes(S))||Array.isArray(w.mutations)&&w.mutations.some(x=>nt(x).includes(S)))}}s.size&&(h=h.filter(m=>!s.has(m.id)));let p=new Set(i.map(m=>String(m?.id??"")));for(let m of h)p.has(m.id)||(i.push(Qu(m)),p.add(m.id))}catch{}if(!i.length)return null;await Dt(a,{open:!0});let l=await Ih(2e4);if(await ar(),l==null||l<0||l>=i.length)return null;let c=zo(i[l]);if(!c)return null;let d=o.slots.slice(0,3);d[r]=String(c.id),this.saveTeam({id:o.id,slots:d});try{await Vn()}catch{}return c},async pickPetViaFakeInventory(t){let e=await this.buildFilteredInventoryByQuery(t||""),n=Array.isArray(e?.items)?e.items:[];if(!n.length)return null;await Dt(e,{open:!0});let r=await Ih(2e4);return await ar(),r==null||r<0||r>=n.length?null:(await Vn(),zo(n[r]))},async useTeam(t){let e=this.getTeams().find(p=>p.id===t)||null;if(!e)throw new Error("Team not found");let n=(e.slots||[]).filter(p=>typeof p=="string"&&p.length>0).slice(0,3),r=new Set(n),o=await Kh(),s=25,a=(()=>{try{return Number(oi.get())}catch{return 0}})();try{a=Number(await oi.get())}catch{a=0}let i=Math.max(0,s-(Number.isFinite(a)?a:0)),l=new Set;try{let p=await lo.get();Array.isArray(p)&&(l=new Set(p.map(m=>String(m?.id??""))))}catch{}if(n.filter(p=>!o.includes(p)).filter(p=>l.has(p)).length>0){let p=!1;try{p=!!await wd.get()}catch{p=!1}if(p&&i<=0){try{await be("Inventory Full","Cannot equip team: required pets are in the Pet Hutch and your inventory is full.")}catch{}return Ho(t),{swapped:0,placed:0,skipped:n.length}}}let u=0,y=0,h=0;for(let p of n){if(o.includes(p)){h++;continue}if(l.has(p)){let w=!1;try{w=!!await wd.get()}catch{w=!1}if(w)if(i>0)try{let x=await this.getInventoryPets(),E=(Array.isArray(x)?x:[]).find(T=>{let A=String(T?.id||"");return A&&!l.has(A)&&!o.includes(A)&&!r.has(A)});if(E)await we.putItemInStorage(E.id,"PetHutch"),i=Math.max(0,i-1);else{try{await be("Inventory Full","Cannot equip team: no free slot to retrieve a pet from the Pet Hutch.","error")}catch{}return Ho(t),{swapped:u,placed:y,skipped:h}}}catch{try{await be("Inventory Full","Cannot equip team: failed to free up a slot.","error")}catch{}return Ho(t),{swapped:u,placed:y,skipped:h}}else{try{await be("Inventory Full","Cannot equip team: required pets are in the Pet Hutch and your inventory is full.","error")}catch{}return Ho(t),{swapped:u,placed:y,skipped:h}}try{await we.retrieveItemFromStorage(p,"PetHutch"),l.delete(p),i=Math.min(25,i+1)}catch{continue}}let S=o.find(w=>!r.has(w));if(S)try{if(await we.swapPet(S,p),u++,i>0)try{await we.putItemInStorage(S,"PetHutch"),i=Math.max(0,i-1)}catch{}o=o.filter(w=>w!==S),o.push(p)}catch{try{await we.placePet(p,{x:0,y:0},"Boardwalk",64),y++,o.push(p)}catch{}}else try{await we.placePet(p,{x:0,y:0},"Boardwalk",64),y++,o.push(p)}catch{}}try{try{a=Number(await oi.get())}catch{}i=Math.max(0,s-(Number.isFinite(a)?a:0));let p=o.filter(m=>!r.has(m));for(let m of p){if(i<=0)break;try{await we.storePet(m),await we.putItemInStorage(m,"PetHutch"),i=Math.max(0,i-1),o=o.filter(g=>g!==m)}catch{}}}catch{}let f=await EI(n);return Ho(t),f},_logs:[],_logsMax:500,_seenPerfByPet:new Map,_logSubs:new Set,_logsCutoffMs:0,_logsCutoffSkewMs:1500,_logsStorageKey:Vu,_logsSessionStart:Date.now(),_extractAbilityValue(t,e){let n=s=>{let a=Number(s);return Number.isFinite(a)?Math.max(0,a):0},r=e??{},o=Bt[t]?.baseParameters??{};switch(t){case"CoinFinderI":case"CoinFinderII":case"CoinFinderIII":{let s=r.coinsFound??r.coins??0;return n(s)}case"SellBoostI":case"SellBoostII":case"SellBoostIII":case"SellBoostIV":{let s=r.bonusCoins??r.coinsEarned??0;return n(s)}case"ProduceEater":return n(r.sellPrice??0);case"EggGrowthBoost":case"EggGrowthBoostII_NEW":case"EggGrowthBoostII":{let s=r.eggGrowthTimeReductionMinutes??r.minutesReduced??r.reductionMinutes??o.eggGrowthTimeReductionMinutes??0;return n(s)*60*1e3}case"PlantGrowthBoost":case"PlantGrowthBoostII":{let s=r.minutesReduced??r.reductionMinutes??r.plantGrowthReductionMinutes??o.plantGrowthReductionMinutes??0;return n(s)*60*1e3}case"PetXpBoost":case"PetXpBoostII":{let s=r.bonusXp??o.bonusXp??0;return n(s)}case"PetAgeBoost":case"PetAgeBoostII":{let s=r.bonusXp??o.bonusXp??0;return n(s)}case"PetHatchSizeBoost":case"PetHatchSizeBoostII":{let s=r.strengthIncrease??0;return n(s)}case"HungerRestore":case"HungerRestoreII":{let s=r.hungerRestoreAmount??r.hungerRestoredPercentage??o.hungerRestorePercentage??0;return n(s)}default:return 0}},async startAbilityLogsWatcher(){await ca();let t=s=>{let a={},i=Array.isArray(s)?s:[];for(let l of i){let c=String(l?.slot?.id??l?.id??"");c&&(a[c]=l)}return a},e={};try{e=t(await ce.pets.myPetInfos.get())}catch{}let n=null;try{n=await ce.pets.myPetInfos.onChange(s=>{try{e=t(s)}catch{}})}catch{}let r=s=>{let a={};if(!s||typeof s!="object")return a;let i=s;for(let l of Object.keys(i)){let c=i[l]??{},d=c.lastAbilityTrigger??null,u=c.hungerPct??c.hunger_percentage??c.hunger??c.stats?.hungerPct??c.stats?.hunger?.pct??c.stats?.hunger?.percent??null;if(u==null){let h=e[l];u=h?.hungerPct??h?.hunger_percentage??h?.hunger??h?.slot?.hungerPct??h?.slot?.hunger??h?.stats?.hungerPct??h?.stats?.hunger?.pct??h?.stats?.hunger?.percent??null}let y=Number.isFinite(Number(u))?Number(u):null;y!=null&&y>0&&y<=1&&(y*=100),a[l]={petId:l,abilityId:d?.abilityId??null,performedAt:Number.isFinite(d?.performedAt)?d.performedAt:null,data:d?.data??null,position:c.position??null,hungerPct:y}}return a};try{this._ingestAbilityMap(r(await ce.pets.myPetSlotInfos.get()))}catch{}let o=await ce.pets.myPetSlotInfos.onChange(s=>{try{this._ingestAbilityMap(r(s))}catch{}});return()=>{try{o()}catch{}try{n?.()}catch{}}},getAbilityLogs(t){let e=t?.abilityIds&&t.abilityIds.length?new Set(t.abilityIds):null,n=Number.isFinite(t?.since)?t.since:0,r=Math.max(0,Math.floor(t?.limit??0)),o=this._logs.filter(s=>(n?s.performedAt>=n:!0)&&(e?e.has(s.abilityId):!0));return o=o.sort((s,a)=>a.performedAt-s.performedAt),r?o.slice(0,r):o},getAbilityLogsSessionStart(){return this._logsSessionStart},onAbilityLogs(t){this._logSubs.add(t);try{t(this.getAbilityLogs())}catch{}return()=>{this._logSubs.delete(t)}},getSeenAbilityIds(){let t=new Set;for(let e of this._logs)t.add(e.abilityId);return Array.from(t).sort()},clearAbilityLogs(){this._logs.length=0,this._seenPerfByPet.clear(),this._logsCutoffMs=Date.now(),this._notifyLogSubs(),this._persistAbilityLogs()},_notifyLogSubs(){let t=this.getAbilityLogs();this._logSubs.forEach(e=>{try{e(t)}catch{}})},_pushLog(t){this._logs.push(t),this._logs.length>this._logsMax&&this._logs.splice(0,this._logs.length-this._logsMax),this._notifyLogSubs(),this._persistAbilityLogs()},_persistAbilityLogs(){try{let t={version:1,cutoff:this._logsCutoffMs,logs:this._logs.map(e=>({petId:e.petId,species:e.species??null,name:e.name??null,abilityId:e.abilityId,abilityName:e.abilityName,data:e.data,performedAt:e.performedAt,time12:e.time12}))};Oe(Vu,t)}catch{}},_restoreAbilityLogsFromStorage(){try{let t=_e(Vu);if(!t||typeof t!="object")return;let e=Array.isArray(t.logs)?t.logs:[],n=[];for(let o of e){if(!o||typeof o!="object")continue;let s=typeof o.abilityId=="string"?String(o.abilityId):"",a=Number(o.performedAt)||0;!s||!a||n.push({petId:typeof o.petId=="string"?String(o.petId):"",species:typeof o.species=="string"&&o.species?String(o.species):void 0,name:typeof o.name=="string"&&o.name?String(o.name):void 0,abilityId:s,abilityName:typeof o.abilityName=="string"&&o.abilityName?String(o.abilityName):s,data:typeof o.data=="string"?String(o.data):o.data,performedAt:a,time12:typeof o.time12=="string"&&o.time12?String(o.time12):new Date(a).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})}n.sort((o,s)=>o.performedAt-s.performedAt),this._logs=n.slice(-this._logsMax),this._seenPerfByPet.clear();for(let o of this._logs){let s=this._seenPerfByPet.get(o.petId)||0;o.performedAt>s&&this._seenPerfByPet.set(o.petId,o.performedAt)}let r=Number(t.cutoff);Number.isFinite(r)&&r>0&&(this._logsCutoffMs=r)}catch{}},_ingestAbilityMap(t){if(!t||typeof t!="object")return;let e=l=>{let c=Bt[l];return c?.name&&c.name.trim()||l},n=l=>new Date(l).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),r=l=>Number.isFinite(Number(l))?Math.round(Number(l)).toLocaleString("en-US"):"0",o=l=>`${Number.isFinite(Number(l))?Number(l).toFixed(0):"0"}%`,s=l=>`${Number.isFinite(Number(l))?Number(l).toFixed(1):"0.0"} min`,a=(l,c)=>{let d=c??{},u=Bt[l]?.baseParameters??{},y=(p,m)=>(typeof p=="string"?p.trim():"")||m,h=(p,m)=>p??m,f=p=>{if(!p||typeof p!="object")return null;let m=p.species;if(typeof m!="string"||!m.trim())return null;let g=m.trim(),S=[g,g.charAt(0).toUpperCase()+g.slice(1),g.toLowerCase()];for(let w of S){let x=De?.[w]?.crop?.name;if(typeof x=="string"&&x.trim())return x}return null};switch(l){case"CoinFinderI":case"CoinFinderII":case"CoinFinderIII":{let p=d.coinsFound??d.coins??u.baseMaxCoinsFindable;return p!=null?`+ ${r(p)} coins`:"Coins found"}case"SeedFinderI":case"SeedFinderII":case"SeedFinderIII":case"SeedFinderIV":return`x1 ${y(d.seedName,"seed")}`;case"HungerRestore":case"HungerRestoreII":{let p=d.petName,m=y(p==="itself"?"itself":p,"pet"),g=d.hungerRestoreAmount,S=h(d.hungerRestoredPercentage,u.hungerRestorePercentage);return g!=null?`${m}: +${r(g)} hunger`:S!=null?`${m}: ${o(S)}`:`${m}: Hunger restored`}case"DoubleHarvest":return`+1 ${y(d.cropName,"crop")}`;case"DoubleHatch":return`+1 ${y(d.petName,"pet")}`;case"ProduceEater":{let p=y(d.cropName,"crop");if(d.sellPrice!=null)return`Sold ${p}: +${r(d.sellPrice)} coins`;let m=u.cropSellPriceIncreasePercentage;return m!=null?`Eaten: ${p} (+${o(m)} value)`:`Eaten: ${p}`}case"ProduceRefund":{let p=d.numCropsRefunded??d.numItemsRefunded;return p!=null?`+ ${r(p)} crop(s)`:"Crops refunded"}case"SellBoostI":case"SellBoostII":case"SellBoostIII":case"SellBoostIV":{if(d.bonusCoins!=null)return`Sale bonus: +${r(d.bonusCoins)} coins`;let p=u.cropSellPriceIncreasePercentage;return p!=null?`+ ${o(p)}`:"Sale bonus"}case"GoldGranter":case"RainbowGranter":{let p=f(d.growSlot),m=y(d.cropName,p??"crop"),g=l==="GoldGranter"?"Gold":"Rainbow";return`${m}`}case"RainDance":{let p=f(d.growSlot),m=y(d.cropName,p??"crop");return(Array.isArray(d.mutations)?d.mutations:Array.isArray(d.growSlot?.mutations)?d.growSlot.mutations:[]).some(w=>typeof w=="string"&&w.toLowerCase()==="frozen")?`${m}: Chilled + Frozen`:`${m}: Wet`}case"ProduceScaleBoost":case"ProduceScaleBoostII":{let p=d.scaleIncreasePercentage??d.cropScaleIncreasePercentage??u.scaleIncreasePercentage;return p!=null?`+ ${o(p)}`:"Crop size boosted"}case"ProduceMutationBoost":case"ProduceMutationBoostII":case"PetMutationBoost":case"PetMutationBoostII":{let p=h(d.mutationChanceIncreasePercentage,u.mutationChanceIncreasePercentage);return p!=null?`+ ${o(p)} mutation chance`:"Mutation chance up"}case"EggGrowthBoost":case"EggGrowthBoostII_NEW":case"EggGrowthBoostII":{let p=d.minutesReduced??d.eggGrowthTimeReductionMinutes??u.eggGrowthTimeReductionMinutes;return p!=null?`- ${s(p)}`:"Egg growth reduced"}case"PlantGrowthBoost":case"PlantGrowthBoostII":{let p=d.minutesReduced??d.reductionMinutes??u.plantGrowthReductionMinutes;return p!=null?`- ${s(p)}`:"Plant growth reduced"}case"PetXpBoost":case"PetXpBoostII":{let p=d.bonusXp??u.bonusXp;return`+ ${r(p)} XP`}case"PetAgeBoost":case"PetAgeBoostII":{let p=d.bonusXp??u.bonusXp,m=y(d.petName,"pet");return`+ ${r(p)} XP (${m})`}case"PetHatchSizeBoost":case"PetHatchSizeBoostII":{let p=y(d.petName,"pet");if(d.strengthIncrease!=null)return`+${r(d.strengthIncrease)} strength (${p})`;let m=u.maxStrengthIncreasePercentage;return m!=null?`+ ${o(m)} (${p})`:`Strength increased (${p})`}case"HungerBoost":case"HungerBoostII":{let p=u.hungerDepletionRateDecreasePercentage;return p!=null?`- ${o(p)} hunger drain`:"Hunger reduced"}case"PetRefund":case"PetRefundII":{let p=d.eggName??null;return p?`x1 ${p}`:"Pet refunded as egg"}case"Copycat":return"Copied another ability";case"MoonKisser":return"Amber mutations empowered";case"DawnKisser":return"Dawn mutations empowered";default:{let p=Bt[l];return d&&typeof d=="object"&&Object.keys(d).length?JSON.stringify(d):p?.description||"\u2014"}}},i=1e-6;for(let l of Object.keys(t)){let c=t[l];if(!c||typeof c!="object")continue;let d=c.abilityId??null,u=Number(c.performedAt)||0;if(!d||!u)continue;let y=this._seenPerfByPet.get(l)||0;if(u<=y)continue;if(this._logsCutoffMs&&u<this._logsCutoffMs-this._logsCutoffSkewMs){this._seenPerfByPet.set(l,u);continue}let h=Number.isFinite(Number(c.hungerPct))?Number(c.hungerPct):null;if(h!=null&&h>0&&h<=1&&(h*=100),h!=null&&h<=i){this._seenPerfByPet.set(l,u);continue}let f=ma.find(g=>String(g.id)===String(l))||null,p=String(d),m={petId:l,species:f?.petSpecies||void 0,name:f?.name??void 0,abilityId:p,abilityName:e(d),data:a(p,c.data),performedAt:u,time12:n(u)};this._seenPerfByPet.set(l,u);try{Fe.incrementAbilityStat(p,"triggers");let g=this._extractAbilityValue(p,c.data);g>0&&Fe.incrementAbilityStat(p,"totalValue",g)}catch{}this._pushLog(m)}}};try{Me._restoreAbilityLogsFromStorage()}catch{}async function Kh(){try{let t=await we.getPets();return(Array.isArray(t)?t:[]).map(n=>String(n?.slot?.id||"")).filter(n=>!!n).slice(0,3)}catch{return[]}}async function EI(t){let e=await Kh(),n=new Set(t),r=e.filter(d=>!n.has(d)),o=Math.max(0,e.length-t.length);if(o>0){let d=r.slice(0,o);for(let u of d)try{await we.storePet(u),e=e.filter(y=>y!==u)}catch{}}let s=new Set;for(let d of t)e.includes(d)&&s.add(d);let a=0,i=0,l=0;s.size&&(e=e.filter(d=>!s.has(d)),l=s.size);let c=t.filter(d=>!s.has(d));for(let d of c){let u=e.shift();try{u?(await we.swapPet(u,d),a++):(await we.placePet(d,{x:0,y:0},"Boardwalk",64),i++)}catch{}}return{swapped:a,placed:i,skipped:l}}var CI=[{id:"shops.seeds",modal:"seedShop"},{id:"shops.eggs",modal:"eggShop"},{id:"shops.decors",modal:"decorShop"},{id:"shops.tools",modal:"toolShop"}],Uh=!1;function Yh(){Uh||typeof window>"u"||(Uh=!0,window.addEventListener("keydown",t=>{if(!mr(t)){for(let{id:e,modal:n}of CI)if(An(e,t)){t.preventDefault(),t.stopPropagation(),ce.ui.activeModal.set(n);break}}},!0))}function Vh(t,e){let n=Number.isFinite(t)?Math.max(0,t):0,r=Number.isFinite(e)?Math.max(0,e):0;if(r<n){let o=n;n=r,r=o}return n===r?Math.max(0,n):Math.random()*(r-n)+n}function op(t,e=[0,0]){if(!t||t.length!==2)return e;let[n,r]=t,o=Number.isFinite(n)?Math.max(0,n):e[0],s=Number.isFinite(r)?Math.max(0,r):e[1];return o<=s?[o,s]:[s,o]}function MI(t){return t&&typeof t=="object"&&"species"in t}function AI(t){return t&&typeof t=="object"&&"toolId"in t}function TI(t){return t&&typeof t=="object"&&"eggId"in t}function II(t){return t&&typeof t=="object"&&"decorId"in t}function kI(t){if(!t||typeof t!="object")return null;if(typeof t.secondsUntilRestock=="number")return t.secondsUntilRestock;for(let e of Object.keys(t)){let n=t[e];if(typeof n=="number"&&e.toLowerCase().includes("secondsuntilrestock"))return n}return null}function PI(t,e){let n=new Set,r=[t];for(;r.length;){let o=r.pop();if(!(!o||typeof o!="object")&&!n.has(o)){n.add(o);for(let s of Object.keys(o)){let a=o[s];if(Array.isArray(a)&&a.length&&a.every(i=>typeof i=="object")&&a.some(e)){let i=kI(o);return{items:a,sec:i}}}for(let s of Object.keys(o)){let a=o[s];a&&typeof a=="object"&&r.push(a)}}}return{items:[],sec:null}}function LI(t){return t==="seeds"?MI:t==="tools"?AI:t==="eggs"?TI:II}var tt={async readRawData(){try{return await ce.shop.shops.get()}catch{return{}}},async read(t){let e=await this.readRawData();return PI(e,LI(t))},identityFor(t,e){if(typeof e?.name=="string"&&e.name.trim())return e.name.trim();let n={seeds:De,tools:Jt,eggs:Qt,decor:ut},r={seeds:[String(e.species??e.id??"")],tools:[String(e.toolId??e.id??"")],eggs:[String(e.eggId??e.id??"")],decor:[String(e.decorId??e.id??"")]},o=n[t];for(let s of r[t]){if(!s)continue;let a=o[s];if(a){if(t==="seeds"&&a.seed?.name)return a.seed.name;if(a.name)return a.name}}return String(e.species??e.toolId??e.eggId??e.decorId??e.id??"?")},getQty(t){let e=t.initialStock??0,n=Number(e);return Number.isFinite(n)?n:0},priceFromCatalog(t,e){let n=t==="seeds"?De:t==="tools"?Jt:t==="eggs"?Qt:ut,r=[e.species,e.toolId,e.eggId,e.decorId].filter(Boolean).map(String);for(let o of r){let s=n[o];if(s)if(t==="seeds"){let a=Number(s?.seed?.coinPrice);if(Number.isFinite(a))return a}else{let a=Number(s?.coinPrice);if(Number.isFinite(a))return a}}},keyForAuto(t,e){return`${t}:${this.identityFor(t,e)}`},keyForOffer(t,e){let n=this.priceFromCatalog(t,e)??0;return`${this.keyForAuto(t,e)}@${n}`},invKeyFromAutoKey(t,e){let n=e.indexOf(":");return n>=0?e.slice(n+1):e},buyOne(t,e){if(t==="seeds"){let n=e.species??e.name;if(n)try{Xe({type:"PurchaseSeed",species:n}),Fe.incrementShopStat("seedsBought")}catch{}return}if(t==="tools"){let n=e.toolId??e.id;if(n)try{Xe({type:"PurchaseTool",toolId:n}),Fe.incrementShopStat("toolsBought")}catch{}return}if(t==="eggs"){let n=e.eggId??e.id;if(n)try{Xe({type:"PurchaseEgg",eggId:n}),Fe.incrementShopStat("eggsBought")}catch{}return}if(t==="decor"){let n=e.decorId??e.id;if(n)try{Xe({type:"PurchaseDecor",decorId:n}),Fe.incrementShopStat("decorBought")}catch{}return}},sleep(t){return new Promise(e=>setTimeout(e,t))},async buyAllInStock(t,e,n){let r=Math.max(0,this.getQty(e));if(r===0)return;let o=typeof n?.limitPerTick=="number"&&isFinite(n.limitPerTick)?Math.max(0,n.limitPerTick):r,s=[140,220],a=[1e4,18e4],i=op(n?.initialDelayRangeMs,a),l=typeof n?.delayMs=="number"&&isFinite(n.delayMs)?Math.max(0,n.delayMs):void 0,c=n?.clickDelayRangeMs?op(n.clickDelayRangeMs,s):l!==void 0?op([l*.75,l*1.25],s):s,d=Math.min(r,o),u=Math.round(Vh(i[0],i[1]));if(!n?.signal?.aborted&&!(u>0&&(await new Promise((y,h)=>{let f=setTimeout(()=>y(),u);if(n?.signal){let p=()=>{clearTimeout(f),h(new Error("AbortError"))};n.signal.addEventListener("abort",p,{once:!0})}}).catch(()=>{}),n?.signal?.aborted)))for(let y=0;y<d;y++){try{await this.buyOne(t,e)}catch{break}let h=Math.round(Vh(c[0],c[1]));if(n?.signal?.aborted||h>0&&(await new Promise((f,p)=>{let m=setTimeout(()=>f(),h);if(n?.signal){let g=()=>{clearTimeout(m),p(new Error("AbortError"))};n.signal.addEventListener("abort",g,{once:!0})}}).catch(()=>{}),n?.signal?.aborted))return}},async readMyInventory(){try{return await ce.inventory.myInventory.get()}catch{return null}},async readInventoryMaps(){let t=await this.readMyInventory(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};for(let n of t?.items||[]){if(!n||typeof n!="object")continue;let r=Number.isFinite(+n.quantity)?+n.quantity:1;n.itemType==="Seed"&&n.species&&e.seeds.set(String(n.species),(e.seeds.get(String(n.species))??0)+r),n.itemType==="Tool"&&n.toolId&&e.tools.set(String(n.toolId),(e.tools.get(String(n.toolId))??0)+r),n.itemType==="Egg"&&n.eggId&&e.eggs.set(String(n.eggId),(e.eggs.get(String(n.eggId))??0)+r),n.itemType==="Decor"&&n.decorId&&e.decor.set(String(n.decorId),(e.decor.get(String(n.decorId))??0)+r)}return e},async onInventoryChange(t){let e=await ce.inventory.myInventory.onChange(async()=>{try{t(await this.readInventoryMaps())}catch{}});try{t(await this.readInventoryMaps())}catch{}return e},async onQuantityChange(t,e){let n="",r=async()=>{try{let s=await this.read(t),a=this.signatureFor(t,s);a!==n&&(n=a,e())}catch{}},o=await ce.shop.shops.onChange(r);return await r(),o},signatureFor(t,e){let n=e.items.map(r=>{let o=this.keyForOffer(t,r),s=this.getQty(r);return`${o}#${s}`});return n.sort(),`${t}:${n.join("|")}`},async readMyPurchases(){try{return await ce.shop.myShopPurchases.get()}catch{return null}},async readPurchasesMaps(){let t=await this.readMyPurchases(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};if(!t)return e;let n=t.seed?.purchases??{};for(let[a,i]of Object.entries(n))e.seeds.set(a,Number(i)||0);let r=t.tool?.purchases??{};for(let[a,i]of Object.entries(r))e.tools.set(a,Number(i)||0);let o=t.egg?.purchases??{};for(let[a,i]of Object.entries(o))e.eggs.set(a,Number(i)||0);let s=t.decor?.purchases??{};for(let[a,i]of Object.entries(s))e.decor.set(a,Number(i)||0);return e},async onPurchasesChange(t){let e=await ce.shop.myShopPurchases.onChange(async()=>{try{t(await this.readPurchasesMaps())}catch{}});try{t(await this.readPurchasesMaps())}catch{}return e}},Go=new Map,_l={start(t,e,n){let r=tt.keyForAuto(t,e),o=Go.get(r);if(o)try{o.abort()}catch{}let s=new AbortController;Go.set(r,s),tt.buyAllInStock(t,e,{...n,signal:s.signal}).finally(()=>{Go.get(r)===s&&Go.delete(r)})},cancel(t,e){let n=tt.keyForAuto(t,e),r=Go.get(n);if(r){try{r.abort()}catch{}Go.delete(n)}}};var RI="sell-all-pets:list",_I={text:"var(--chakra-colors-Neutral-TrueWhite, #FFFFFF)",bg:"var(--chakra-colors-Blue-Magic, #0067B4)",border:"var(--chakra-colors-Blue-Light, #48ADF4)",hoverBg:"var(--chakra-colors-Blue-Light, #48ADF4)",hoverBorder:"var(--chakra-colors-Blue-Baby, #25AAE2)",activeBg:"var(--chakra-colors-Blue-Dark, #264093)",ring:"var(--chakra-ring-color, rgba(66,153,225,0.6))"},hr={rootSelector:".McFlex.css-wqzc3n",checkSelector:".McFlex.css-bvyqr8",buttonSelectorWide:"button.chakra-button.css-o7uz17, button.chakra-button, button.css-o7uz17",buttonSelectorStrict:"button.chakra-button.css-o7uz17",targetText:"Sell Pet",injectText:"Sell all Pets",injectedClass:"tm-injected-sell-all",styleId:"tm-injected-sell-all-style"};function Zh(t={}){if(!KI())return UI();let e=t.rootSelector??hr.rootSelector,n=t.checkSelector??hr.checkSelector,r=t.buttonSelectorWide??hr.buttonSelectorWide,o=t.buttonSelectorStrict??hr.buttonSelectorStrict,s=t.targetText??hr.targetText,a=t.injectText??hr.injectText,i=t.injectedClass??hr.injectedClass,l=t.theme??_I,c=t.observeHistory??!0,d=typeof t.log=="function"?t.log:t.log?(...S)=>console.debug("[injectSellAllPets]",...S):()=>{},u=t.onClick??DI(d);ZI(i,l);let y=!0,h=!1,f=()=>{!y||h||(h=!0,requestAnimationFrame(()=>{try{document.querySelectorAll(e).forEach(S=>p(S))}finally{h=!1}}))};function p(S){if(!S.querySelector(n)){$h(S,i);return}let x=JI(S,r,o,s);if(!x){$h(S,i);return}$I(x,i,a,(E,T)=>{zI(u,E,T,d)})}let m=new MutationObserver(f);m.observe(document.documentElement,{childList:!0,subtree:!0}),f();let g=null;return c&&(g=XI(f)),{stop(){y&&(y=!1,m.disconnect(),g?.(),d("stopped"))},runOnce(){f()},isRunning(){return y}}}async function Xh(t=()=>{}){let e=await eb(t);e.length!==0&&await tb(e,t)}async function NI(){try{await at()}catch{}let[t,e]=await Promise.all([ce.inventory.myInventory.get().catch(()=>null),ce.inventory.favoriteIds.get().catch(()=>[])]),n=new Set(Array.isArray(e)?e.filter(s=>typeof s=="string"):[]),r=Array.isArray(t?.items)?t.items:[],o=[];return r.forEach((s,a)=>{jI(s)&&(n.has(s.id)||(console.log("[sellAllPets] inventory index",a,s),o.push({...s,inventoryIndex:a})))}),o}function DI(t){return async()=>{let e=await eb(t);e.length!==0&&await tb(e,t)}}async function eb(t){let e=await NI(),n={pets:e,count:e.length};globalThis.__sellAllPetsCandidates=e;try{t("collected-non-favorite-pets",n)}catch{}try{globalThis.dispatchEvent?.(new CustomEvent(RI,{detail:n}))}catch{}return e}async function tb(t,e){let n=t.filter(a=>typeof a?.id=="string"&&a.id.trim().length>0);if(n.length===0){try{e("no-sellable-pets",{requested:t.length})}catch{}try{globalThis.__sellAllPetsResult={attempted:0,sold:0,failures:[]}}catch{}return}let r=[],o=0,s=await qI(n,e);try{e("sell-pets:total-value",{attempted:n.length,totalValue:s})}catch{}for(let a of n){try{e("sell-pet:start",{id:a.id,pet:a})}catch{}try{await we.sellPet(a.id),o+=1,Fe.incrementShopStat("petsSoldCount"),(async()=>{try{let i=await ce.pets.totalPetSellPrice.get(),l=Number(i);Number.isFinite(l)&&l>0&&Fe.incrementShopStat("petsSoldValue",l)}catch(i){console.error("[SellPet] Unable to read pet sell price",i)}})();try{e("sell-pet:success",{id:a.id,pet:a})}catch{}}catch(i){r.push({pet:a,error:i});try{e("sell-pet:error",{id:a.id,error:i,pet:a})}catch{}}}r.length===0&&be("Sell all Pets",`${o} pets have been sold for ${s} coins!`,"success");try{globalThis.__sellAllPetsResult={attempted:n.length,sold:o,failures:r}}catch{}qt.playSellNotification();try{e("sell-pets:complete",{attempted:n.length,sold:o,failures:r})}catch{}}async function qI(t,e){if(!t.length)return"";let n=await OI(),r=0;for(let o of t){let s=BI(o);if(s===null)continue;try{await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(s)}catch(i){try{e("sell-pet:selection-error",{id:o.id,index:s,error:i,pet:o})}catch{}continue}let a=await HI(s,o,e);a!==null&&(r+=a)}return await FI(n,e),r.toLocaleString("en-US")}async function OI(){try{let t=await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();if(typeof t=="number"&&Number.isInteger(t)&&t>=0)return{value:t,valid:!0};if(t===null)return{value:null,valid:!0}}catch{}return{value:null,valid:!1}}async function FI(t,e){if(t.valid)try{await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(t.value)}catch(n){try{e("sell-pet:selection-restore-error",n)}catch{}}}function BI(t){let e=t.inventoryIndex;return typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}async function HI(t,e,n,r=3,o=50){for(let s=0;s<r;s++){try{let a=await ce.pets.totalPetSellPrice.get(),i=Number(a);if(Number.isFinite(i))return i}catch(a){if(s===r-1)try{n("sell-pet:price-read-error",{id:e.id,index:t,error:a,pet:e})}catch{}}s<r-1&&await WI(o)}try{n("sell-pet:price-missing",{id:e.id,index:t,pet:e})}catch{}return null}function WI(t){return new Promise(e=>setTimeout(e,t))}function zI(t,e,n,r){try{let o=t(e,n);GI(o)&&o.catch(s=>Qh(s,r))}catch(o){Qh(o,r)}}function Qh(t,e){try{e("sell-all-click-error",t)}catch{}}function GI(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function jI(t){return!!t&&t.itemType==="Pet"&&typeof t.id=="string"}function KI(){return typeof window<"u"&&typeof document<"u"}function UI(){return{stop(){},runOnce(){},isRunning:()=>!1}}function Jh(t){return(t??"").replace(/\s+/g," ").trim()}function VI(t){let e=Jh(t.textContent);return e||Jh(t.getAttribute("aria-label"))}function YI(t){return t.trim().split(/\s+/).filter(Boolean)}function QI(t){let e=YI(t);return e.length===2&&/^sell$/i.test(e[0])}function JI(t,e,n,r){return Array.from(new Set([...Array.from(t.querySelectorAll(e)),...Array.from(t.querySelectorAll(n))])).filter(a=>a instanceof HTMLButtonElement).filter(a=>!a.classList.contains(hr.injectedClass)).find(a=>{let i=VI(a);return/crops/i.test(i)?!1:QI(i)})??null}function $I(t,e,n,r){let o=t.parentElement||t.closest(".McFlex, .css-0")||t.parentNode;if(!o)return;let s=o.querySelector(`.${e}`);if(s){t.nextElementSibling!==s&&o.insertBefore(s,t.nextSibling),s.textContent!==n&&(s.textContent=n);return}s=document.createElement("button"),s.type="button",s.className=`${e} chakra-button`,s.textContent=n,s.setAttribute("aria-label",n),s.title=n,s.style.marginLeft="8px",getComputedStyle(o).display!=="flex"&&(s.style.display="inline-flex",s.style.alignItems="center"),s.addEventListener("click",i=>r(i,{host:t.closest(".McFlex.css-1wu1jyg"),targetBtn:t,injectedBtn:s})),o.insertBefore(s,t.nextSibling)}function $h(t,e){t.querySelectorAll(`.${e}`).forEach(n=>n.remove())}function ZI(t,e){let n=`${t}-style`;if(document.getElementById(n))return;let r=`
.${t}{
  font-synthesis: none;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
  cursor: pointer;
  display: inline-flex;
  appearance: none;
  align-items: center;
  justify-content: center;
  user-select: none;
  white-space: nowrap;
  vertical-align: middle;

  outline: transparent solid 2px;
  outline-offset: 2px;
  line-height: 1.2;

  border-radius: 15px;                        /* aligns with provided design */
  font-weight: 700;
  height: auto;
  min-width: var(--chakra-sizes-10, 2.5rem);
  box-shadow: rgba(0, 0, 0, 0.3) 0px 4px 12px;
  transform: translateY(0px);
  transition: 0.2s;

  border: 2px solid ${e.border};
  color: ${e.text};
  background: ${e.bg};

  text-transform: none;
  overflow: hidden;
  font-size: 20px;
  padding-inline-start: var(--chakra-space-4, 1rem);
  padding-inline-end: var(--chakra-space-4, 1rem);
  padding-top: var(--chakra-space-3, 0.75rem);
  padding-bottom: var(--chakra-space-3, 0.75rem);

  -webkit-tap-highlight-color: transparent;
}
.${t}:hover{
  transform: translateY(-1px);
  background: ${e.hoverBg};
  border-color: ${e.hoverBorder};
}
.${t}:active{
  transform: translateY(1px);
  background: ${e.activeBg};
}
.${t}:focus-visible{
  box-shadow: 0 0 0 3px ${e.ring};
}
`.trim(),o=document.createElement("style");o.id=n,o.textContent=r,document.head.appendChild(o)}function XI(t){let e=history.pushState?.bind(history),n=history.replaceState?.bind(history),r=s=>s&&function(...a){let i=s.apply(this,a);return t(),i};e&&(history.pushState=r(e)),n&&(history.replaceState=r(n));let o=()=>t();return window.addEventListener("popstate",o),()=>{e&&(history.pushState=e),n&&(history.replaceState=n),window.removeEventListener("popstate",o)}}var nb=!1;function rb(){nb||typeof window>"u"||(nb=!0,window.addEventListener("keydown",t=>{if(!mr(t)){if(An("sell.sell-all",t)){t.preventDefault(),t.stopPropagation(),we.sellAllCrops();return}An("sell.sell-all-pets",t)&&(t.preventDefault(),t.stopPropagation(),Xh())}},!0))}function jo(t){let e=typeof t=="number"?t:Number(t);if(!Number.isFinite(e))return e===1/0?"\u221E":null;let n=Math.abs(e),r=o=>Number.isInteger(o)?String(o):o.toFixed(1);return n>=1e12?`${r(e/1e12)}T`:n>=1e9?`${r(e/1e9)}B`:n>=1e6?`${r(e/1e6)}M`:n>=1e3?`${r(e/1e3)}k`:String(e)}var ql="menu:shops:auto",sp=`${ql}:v1`;function ya(t){return async()=>{let e=await tt.read(t),n=ap(),r=!1;for(let o of e.items??[]){if(!n.has(cb(t,o)))continue;tt.getQty(o)>0&&(r=!0,_l.start(t,o,{delayMs:10,initialDelayRangeMs:[0,0]}))}r&&be("Auto-Buy","Activation success!","success")}}function ap(){let t=new Set;for(let e of ek())for(let n of ip(e))n&&t.add(n);return t}function ob(t){let e=Array.from(t).filter(Boolean);tk(e)}function ek(){return[sb(sp),ab(sp),sb(ql),ab(ql)]}function ip(t){if(!t)return[];if(Array.isArray(t))return t.map(e=>String(e).trim()).filter(Boolean);if(typeof t=="object"){let e=t?.items;return Array.isArray(e)?ip(e):[]}if(typeof t=="string"){let e=t.trim();if(!e)return[];if(e.startsWith("{")||e.startsWith("[")||e==="null")try{let n=JSON.parse(e);return ip(n)}catch{}return e.split(",").map(n=>n.trim()).filter(Boolean)}return[]}function tk(t){let e=Array.from(new Set(t.map(o=>String(o).trim()).filter(Boolean)));e.sort((o,s)=>o.localeCompare(s));let n=e.length?JSON.stringify({version:1,items:e}):"",r=e.join(",");ib(sp,n),ib(ql,r)}function sb(t){try{if(typeof GM_getValue=="function")return GM_getValue(t)}catch{}return null}function ab(t){try{return typeof localStorage>"u"?null:localStorage.getItem(t)}catch{return null}}function ib(t,e){try{typeof GM_setValue=="function"&&(e?GM_setValue(t,e):typeof GM_deleteValue=="function"?GM_deleteValue(t):GM_setValue(t,e))}catch{}try{typeof localStorage<"u"&&(e?localStorage.setItem(t,e):localStorage.removeItem(t))}catch{}}function cb(t,e){let n=tt.identityFor(t,e);return`${t}:${n}`}function nk(t,e){let n=tt.priceFromCatalog(t,e)??0,r=tt.identityFor(t,e);return`${t}:${r}@${n}`}function rk(t,e){return e.map(n=>nk(t,n)).sort().join("|")}function ok(t,e){return String(t==="seeds"?e.species??e.id??e.name??"":t==="tools"?e.toolId??e.id??e.name??"":t==="eggs"?e.eggId??e.id??e.name??"":e.decorId??e.id??e.name??"")}var sk={seeds:"Seed",tools:"Tool",eggs:"Egg",decor:"Decor"};function ak(t,e){let n=sk[t];if(!n)return null;let r=t==="seeds"?e?.species??e?.id??e?.name??"":t==="tools"?e?.toolId??e?.id??e?.name??"":t==="eggs"?e?.eggId??e?.id??e?.name??"":e?.decorId??e?.id??e?.name??"",o=String(r??"").trim();return o?{type:n,id:o}:null}function db(t,e,n){return(t==="seeds"?n.seeds:t==="tools"?n.tools:t==="eggs"?n.eggs:n.decor).get(e)??0}function ik(t,e,n){for(let r of Array.from(t.querySelectorAll("tr"))){let o=r.dataset.pkey,s=r.dataset.stock;if(!o||!s)continue;let a=Number(s),i=db(e,o,n),l=r.children[3];l&&(l.textContent=ub(i,a))}}function ub(t,e){return t>=e&&e>0?`\u2714 ${e}/${e}`:`${t}/${e}`}function lk(t,e,n,r){let o=document.createElement("tr"),s=document.createElement("td"),a=tt.identityFor(e,n),i=document.createElement("div");i.className="qmm-shop-row__name";let l=ak(e,n);if(l){let w=Tt(l.type,l.id,{size:34,alt:a});w.classList.add("qmm-shop-row__icon"),i.appendChild(w)}let c=document.createElement("span");c.textContent=a,c.className="qmm-shop-row__label",i.appendChild(c),s.appendChild(i),o.appendChild(s);let d=document.createElement("td"),u=tt.priceFromCatalog(e,n);d.textContent=u==null?"\u2014":`${jo(u)??String(u)} `,o.appendChild(d);let y=document.createElement("td"),h=cb(e,n),f=t.switch(ap().has(h));f.addEventListener("change",async()=>{let w=ap();if(f.checked){w.add(h),ob(w);try{_l.start(e,n,{delayMs:10,initialDelayRangeMs:[0,0]})}catch{}}else{w.delete(h),ob(w);try{_l.cancel(e,n)}catch{}}}),y.appendChild(f),o.appendChild(y);let p=document.createElement("td");p.className="qmm-num";let m=ok(e,n),g=db(e,m,r),S=tt.getQty(n);return p.textContent=ub(g,S),o.appendChild(p),o.dataset.pkey=m,o.dataset.stock=String(S),o.dataset.pkey=m,o}async function lp(t,e,n,r){n.innerHTML="";let{items:o}=await tt.read(e);o.sort((a,i)=>{let l=tt.priceFromCatalog(e,a)??Number.POSITIVE_INFINITY,c=tt.priceFromCatalog(e,i)??Number.POSITIVE_INFINITY;return(isFinite(l)?l:1/0)-(isFinite(c)?c:1/0)});let s=document.createDocumentFragment();for(let a of o)s.appendChild(lk(t,e,a,r));n.appendChild(s)}var lb={};async function Nl(t,e,n){let{items:r}=await tt.read(e),o=await tt.readPurchasesMaps(),s=rk(e,r);s!==lb[e]&&(lb[e]=s,await lp(t,e,n,o))}async function Dl(t,e,n){let r=n.table(["Item","Price","Auto","Bought"],{minimal:!0,compact:!0,maxHeight:"44vh"});t.appendChild(r.root);let o=await tt.readPurchasesMaps();await lp(n,e,r.tbody,o);try{await tt.onQuantityChange(e,async()=>{try{o=await tt.readPurchasesMaps(),await lp(n,e,r.tbody,o)}catch(s){console.error(s)}})}catch{}try{await tt.onPurchasesChange(s=>{o=s,ik(r.tbody,e,o)})}catch{}}async function pb(t){let e=new Qe({id:"shops",compact:!0});e.mount(t);let n=document.createElement("style");n.textContent=`
    /* adapte les s\xE9lecteurs \xE0 ta lib si besoin */
    .qmm-tabs .qmm-tab, .qmm-tabs button, .qmm-tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      white-space: pre-line; /* respecte 
 */
      line-height: 1.1;
      gap: 2px;
      text-align: center;
      padding-block: 8px; /* un peu d'air vertical */
    }
    .qmm-shop-row__name {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .qmm-shop-row__icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      padding: 2px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    .qmm-shop-row__icon img {
      image-rendering: pixelated;
    }
    .qmm-shop-row__label {
      display: inline-block;
    }
  `,document.head.appendChild(n),e.addTabs([{id:"seeds",title:`\u{1F330}
Seeds`,render:r=>Dl(r,"seeds",e)},{id:"tools",title:`\u{1F9FA}
Tools`,render:r=>Dl(r,"tools",e)},{id:"eggs",title:`\u{1F95A}
Eggs`,render:r=>Dl(r,"eggs",e)},{id:"decor",title:`\u{1F380}
Decor`,render:r=>Dl(r,"decor",e)}]);try{await Nl(e,"seeds",e)}catch{}try{await Nl(e,"tools",e)}catch{}try{await Nl(e,"eggs",e)}catch{}try{await Nl(e,"decor",e)}catch{}}function Xt(t){return t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function cp(t){if(!t)return null;let e=String(t),n=e.split(".").pop()||e;return Xt(n)}function yb(t){let e=t?.crop?.name;return e?Xt(e):null}function ck(t){return t?t.charAt(0).toUpperCase()+t.slice(1):null}var mb=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728","\u{1F506}","\u{1F52E}"];function dk(){let t=[];for(let[e,n]of Object.entries(De)){let r=n?.seed?.name,o=n?.crop?.name,s=n?.plant?.name;t.push({key:e,seedName:r,cropName:o,plantName:s})}return t}function uk(t){let e=new Map;return t.forEach((n,r)=>e.set(n.key,mb[r%mb.length])),e}function pk(){let t=new Map,e=new Map,n=new Map;for(let[r,o]of Object.entries(De)){let s=yb(o);if(!s)continue;t.has(s)||t.set(s,o);let a=[cp(o?.seed?.tileRef),cp(o?.plant?.tileRef),cp(o?.crop?.tileRef),o?.seed?.species?Xt(o.seed.species):null,o?.crop?.name?Xt(o.crop.name):null,o?.plant?.name?Xt(o.plant.name):null,r?Xt(r):null],i=!1,l=o?.plant?.harvestType??o?.seed?.harvestType??o?.grow?.harvestType??o?.harvestType;if(l&&typeof l=="string"){let c=Ge[l]??l;i=String(c).toLowerCase()!=="single"}if(!i&&o?.crop?.name){let c=String(o.crop.name).toLowerCase();/(fruit|berry|bush|tree)/.test(c)&&(i=!0)}for(let c of a)c&&e.set(c,ck(s));n.set(s,!!i)}return{byBase:t,speciesToBaseCap:e,baseIsMulti:n}}var gb=pk();function Ol(t){if(!t)return null;let e=Xt(t);return gb.speciesToBaseCap.get(e)??null}function mk(t){if(!t)return!1;let e=Ol(t);if(!e)return!1;let n=Xt(e);return gb.baseIsMulti.get(n)??!1}var yn={selected:"garden.selectedSeed",assignments:"garden.assignments",autoPlant:"garden.autoPlantEnabled",harvestRules:"garden.harvest.rules.v1",autoSellRules:"garden.autosell.rules.v1"};function Fl(t,e){let n;return function(...r){n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>t.apply(this,r),e)}}function fk(){try{let t=localStorage.getItem(yn.harvestRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var fb=Fl(t=>{try{localStorage.setItem(yn.harvestRules,JSON.stringify(t))}catch{}},150);function yk(){try{let t=localStorage.getItem(yn.autoSellRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var gk=Fl(t=>{try{localStorage.setItem(yn.autoSellRules,JSON.stringify(t))}catch{}},150),Je=class Je{constructor(){pe(this,"seedOptions",dk());pe(this,"_emojiByKey",uk(this.seedOptions));pe(this,"_speciesToKey",new Map);pe(this,"_baseToKeys",new Map);pe(this,"_basePrimary",new Map);pe(this,"_maxScaleByBase",new Map);pe(this,"_selectedSeed",this.seedOptions[0]?.key??"");pe(this,"listeners",new Set);pe(this,"_assign",new Map);pe(this,"_slotState",new Map);pe(this,"_autoTimer",null);pe(this,"_autoRunning",!1);pe(this,"_tickCount",0);pe(this,"_lastResyncErrorAt",0);pe(this,"_autoHarvestTimer",null);pe(this,"_isHarvestTicking",!1);pe(this,"_harvestRules",{});pe(this,"_compiledRules",new Map);pe(this,"_enabledBases",new Set);pe(this,"_autoSellRules",{});pe(this,"_invCountBySeedKey",new Map);pe(this,"_scratchMature",[]);pe(this,"_scratchPairs",[]);pe(this,"_boundTickPlant",()=>{this.tickAutoPlant().catch(()=>{})});pe(this,"_boundTickHarvest",()=>{this._tickAutoHarvest().catch(()=>{})});pe(this,"saveSelectedSeed",Fl(()=>{try{localStorage.setItem(yn.selected,this._selectedSeed)}catch{}},150));pe(this,"saveAssignments",Fl(()=>{try{localStorage.setItem(yn.assignments,JSON.stringify(Array.from(this._assign.entries())))}catch{}},200));pe(this,"_autoSellTimer",null);pe(this,"_autoSellPendingReason",null);pe(this,"_lastKnownPlayers",0);pe(this,"assignments",{get:e=>this._assign.get(e),set:(e,n)=>{this._assign.get(e)!==n&&(this._assign.set(e,n),this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},delete:e=>{this._assign.delete(e)&&(this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},clear:()=>{this._assign.size!==0&&(this._assign.clear(),this.saveAssignments(),this.emit({type:"assignments-changed"}))},invert:e=>{let n=new Map;for(let r=0;r<200;r++)this._assign.has(r)||n.set(r,e);this._assign=n,this.saveAssignments(),this.emit({type:"assignments-changed"})},entries:()=>this._assign.entries(),size:()=>this._assign.size});pe(this,"runtime",{getSlotState:e=>this._slotState.get(e)??"empty",setSlotState:(e,n)=>{this._slotState.get(e)!==n&&(this._slotState.set(e,n),this.emit({type:"runtime-changed",slots:[e]}))}});for(let e of this.seedOptions){let n=[e.key,e.cropName,e.plantName,e.seedName].filter(Boolean);for(let r of n)this._speciesToKey.set(Xt(r),e.key)}for(let[e,n]of Object.entries(De)){let r=yb(n);if(!r)continue;let o=Xt(r),s=this._baseToKeys.get(o)??[];s.length===0&&this._basePrimary.set(o,e),s.push(e),this._baseToKeys.set(o,s);let a=Number(n?.crop?.maxScale)||1;this._maxScaleByBase.has(o)||this._maxScaleByBase.set(o,a)}this.loadSelectedSeed(),this.loadAssignments(),this.restoreAutoPlantState(),this._harvestRules=fk(),this._rebuildCompiledRulesAndEnabledBases(),Object.keys(this._harvestRules).length&&this.emit({type:"harvest-rules-replaced",rules:this.getAllHarvestRules()}),this._autoSellRules=yk(),Object.keys(this._autoSellRules).length&&this.emit({type:"auto-sell-rules-replaced",rules:this.getAllAutoSellRules()}),this._recomputeAutoHarvestLoop();try{we.getCropInventoryState&&we.getCropInventoryState().then(e=>this._rebuildInvCountsFromArray(e||[])).catch(()=>{}),we.onCropInventoryDiffNow&&we.onCropInventoryDiffNow((e,n)=>{Array.isArray(e)&&this._rebuildInvCountsFromArray(e),(n?.added?.length||n?.removed?.length||n?.updated?.length)&&this._scheduleAutoSell("inventory")})}catch{}try{we.onNumPlayersChangeNow(e=>{this._lastKnownPlayers=e,this._scheduleAutoSell("players")}),we.onFavoriteIdsChangeNow&&we.onFavoriteIdsChangeNow(e=>{})}catch{}}_scheduleAutoSell(e){this._autoSellPendingReason=e,this._autoSellTimer===null&&(this._autoSellTimer=window.setTimeout(()=>{this._autoSellTimer=null;let n=this._autoSellPendingReason||"unknown";this._autoSellPendingReason=null,this._runAutoSell(n).catch(()=>{})},120))}loadSelectedSeed(){try{let e=localStorage.getItem(yn.selected);if(!e)return;this.seedOptions.some(r=>r.key===e)&&(this._selectedSeed=e)}catch{}}loadAssignments(){try{let e=localStorage.getItem(yn.assignments);if(!e)return;let n=JSON.parse(e),r=new Map;for(let[o,s]of n)r.set(o,s);this._assign=r}catch{}}restoreAutoPlantState(){try{localStorage.getItem(yn.autoPlant)==="1"&&this.startAutoPlant(!0)}catch{}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(e){for(let n of this.listeners)try{n(e)}catch{}}getEmojiFor(e){let n=this.seedOptions.find(r=>r.seedName===e);return n?this._emojiByKey.get(n.key)??"\u2022":"\u2022"}getEmojiForKey(e){return this._emojiByKey.get(e)??"\u2022"}getSelectedSeed(){return this._selectedSeed}setSelectedSeed(e){this._selectedSeed!==e&&(this._selectedSeed=e,this.saveSelectedSeed(),this.emit({type:"selected-seed-changed"}))}getVisualState(e){if(!this._assign.has(e))return"unassigned";let n=this._slotState.get(e)??"empty";return n==="empty"?"ok":n==="single"?"waiting":"blocked"}getAutoPlantEnabled(){return this._autoRunning}async syncNow(){await this.refreshFromPlayerGarden()}async refreshFromPlayerGarden(){let e=performance.now();try{let n=await we.getGardenState();if(!n||!n.tileObjects)return;let r=n.tileObjects,o=[];for(let[s,a]of Object.entries(r)){let i=Number(s),l=this.classifyTileObject(a??null);this._slotState.get(i)!==l&&(this._slotState.set(i,l),o.push(i))}for(let s of this._slotState.keys())String(s)in r||this._slotState.get(s)!=="empty"&&(this._slotState.set(s,"empty"),o.push(s));o.length&&this.emit({type:"runtime-changed",slots:o}),o.length}catch{this._lastResyncErrorAt=Date.now()}}classifyTileObject(e){if(!e)return"empty";let n=e?.species||e?.name||e?.title;if(n&&mk(n))return"multi";let r=(e.objectType||e.type||"").toString().toLowerCase();return r.includes("plant")||r.includes("crop")||r.includes("egg")||r.includes("decor")||r.includes("item")||r.includes("pet"),"single"}startAutoPlant(e){if(!this._autoRunning){this._autoRunning=!0,this.refreshFromPlayerGarden().catch(()=>{}),e||be("Garden","Auto plant enabled!","success");try{localStorage.setItem(yn.autoPlant,"1")}catch{}this._autoTimer=window.setInterval(this._boundTickPlant,Je.TICK_MS)}}stopAutoPlant(){if(this._autoRunning){this._autoRunning=!1,this._autoTimer!==null&&(window.clearInterval(this._autoTimer),this._autoTimer=null);try{localStorage.setItem(yn.autoPlant,"0")}catch{}be("Garden","Auto plant disabled.","info")}}async tickAutoPlant(){if(!this._autoRunning||(this._tickCount=(this._tickCount+1)%Je.RESYNC_EVERY_TICKS,this._tickCount===0&&await this.refreshFromPlayerGarden(),Date.now()-this._lastResyncErrorAt<1500))return;let e=!1;for(let[n,r]of this._assign){if(this.getVisualState(n)!=="ok"||this.runtime.getSlotState(n)!=="empty")continue;let o=r;if(o)try{await we.plantSeed(n,o),Fe.incrementGardenStat("totalPlanted"),e=!0}catch{}}e&&await this.refreshFromPlayerGarden()}static defaultHarvestRule(){return{enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[],minInventory:91}}static defaultAutoSellRule(){return{enabled:!1,keepMin:0,minSizePct:50,keepVisual:["Normal"],keepWeather:[],minPlayers:0}}getHarvestRule(e){let n=this._harvestRules[e];return n?JSON.parse(JSON.stringify(n)):null}setHarvestRule(e,n){let r=(s,a,i)=>Math.max(a,Math.min(i,Math.floor(Number(s)||0))),o={enabled:!!n.enabled,minScalePct:r(n.minScalePct??50,50,100),visualIncludeNormal:!!n.visualIncludeNormal,visualMutations:Array.isArray(n.visualMutations)?[...n.visualMutations]:[],weatherMode:["ANY","ALL","RECIPES"].includes(n.weatherMode)?n.weatherMode:"ANY",weatherSelected:Array.isArray(n.weatherSelected)?[...n.weatherSelected]:[],weatherRecipes:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(s=>Array.isArray(s)?[...s]:[]):[],minInventory:r(n.minInventory??0,0,91)};this._harvestRules[e]=o,this._compileRule(e,o),this._rebuildEnabledBases(),fb(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(o))}),this._recomputeAutoHarvestLoop()}getAutoHarvestEnabledForSeed(e){return!!this._harvestRules[e]?.enabled}setAutoHarvestEnabledForSeed(e,n){let o={...this._harvestRules[e]??Je.defaultHarvestRule(),enabled:!!n};this._harvestRules[e]=o,this._compileRule(e,o),this._rebuildEnabledBases(),fb(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(o))}),this._recomputeAutoHarvestLoop()}getAllHarvestRules(){return JSON.parse(JSON.stringify(this._harvestRules))}_anyAutoHarvestEnabled(){return this._enabledBases.size>0}_recomputeAutoHarvestLoop(){let e=this._anyAutoHarvestEnabled();e&&this._autoHarvestTimer===null?this._autoHarvestTimer=window.setInterval(this._boundTickHarvest,Je.HARVEST_TICK_MS):!e&&this._autoHarvestTimer!==null&&(window.clearInterval(this._autoHarvestTimer),this._autoHarvestTimer=null)}_isPlantObject(e){return(e?.objectType||e?.type||"").toString().toLowerCase().includes("plant")}getSizeCrop(e,n){let r=Ol(e)??e,o=Xt(r),s=this._maxScaleByBase.get(o)??1;if(!s||s<=1)return 100;let i=50+(Math.max(1,Math.min(s,Number(n)||1))-1)/(s-1)*50;return Math.max(50,Math.min(100,Math.round(i)))}_seedKeyEnabledForBase(e){return this._enabledBases.has(e)}getAutoSellRule(e){let n=this._autoSellRules[e];return n?JSON.parse(JSON.stringify(n)):null}getAllAutoSellRules(){return JSON.parse(JSON.stringify(this._autoSellRules))}getAutoSellEnabledForSeed(e){return!!this._autoSellRules[e]?.enabled}setAutoSellRule(e,n){let r=(i,l,c)=>Math.max(l,Math.min(c,Math.floor(Number(i)||0))),o=["Normal","Gold","Rainbow"],s=["Wet","Chilled","Frozen","Dawnlit","Amberglow"],a={enabled:!!n.enabled,keepMin:r(n.keepMin??0,0,91),minSizePct:r(n.minSizePct??50,50,100),keepVisual:Array.isArray(n.keepVisual)?[...new Set(n.keepVisual.filter(i=>o.includes(i)))]:["Normal"],keepWeather:Array.isArray(n.keepWeather)?[...new Set(n.keepWeather.filter(i=>s.includes(i)))]:[],minPlayers:r(n.minPlayers??0,0,6)};this._autoSellRules[e]=a,gk(this._autoSellRules),this.emit({type:"auto-sell-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(a))}),this._scheduleAutoSell("rules")}static toVisualMask(e){let n=0;for(let r of e)r==="Gold"?n|=Je.V_GOLD:r==="Rainbow"&&(n|=Je.V_RAINBOW);return n}static toWeatherMask(e){let n=0;for(let r of e)r==="Wet"?n|=Je.W_WET:r==="Chilled"?n|=Je.W_CHILLED:r==="Frozen"?n|=Je.W_FROZEN:r==="Dawnlit"?n|=Je.W_DAWNLIT:r==="Amberglow"&&(n|=Je.W_AMBER);return n}static mutsToMasks(e){let n=0,r=0;if(!Array.isArray(e))return[0,0];for(let o=0;o<e.length;o++)switch(e[o]){case"Gold":n|=Je.V_GOLD;break;case"Rainbow":n|=Je.V_RAINBOW;break;case"Wet":r|=Je.W_WET;break;case"Chilled":r|=Je.W_CHILLED;break;case"Frozen":r|=Je.W_FROZEN;break;case"Dawnlit":r|=Je.W_DAWNLIT;break;case"Amberglow":r|=Je.W_AMBER;break;default:break}return[n,r]}_compileRule(e,n){let r={enabled:!!n.enabled,minScalePct:Math.min(100,Math.max(50,Math.floor(n.minScalePct??50))),allowNormal:!!n.visualIncludeNormal,visualMaskWanted:Je.toVisualMask(n.visualMutations||[]),weatherMode:n.weatherMode,weatherMask:Je.toWeatherMask(n.weatherSelected||[]),recipeMasks:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(Je.toWeatherMask):[],minInventory:Math.max(0,Math.floor(n.minInventory??0))};this._compiledRules.set(e,r)}_rebuildCompiledRulesAndEnabledBases(){this._compiledRules.clear();for(let[e,n]of Object.entries(this._harvestRules))this._compileRule(e,n);this._rebuildEnabledBases()}_rebuildEnabledBases(){this._enabledBases.clear();for(let[e,n]of this._baseToKeys)n.some(r=>this._harvestRules[r]?.enabled)&&this._enabledBases.add(e)}_getPrimarySeedKeyForBase(e){return this._basePrimary.get(e)??null}_passesMutationRulesCompiled(e,n,r){if(!e.enabled)return!1;if(n===0){if(!e.allowNormal)return!1}else if(e.visualMaskWanted!==0&&!(n&e.visualMaskWanted))return!1;if(e.weatherMode==="ANY")return e.weatherMask===0?!0:(r&e.weatherMask)!==0;if(e.weatherMode==="ALL")return e.weatherMask===0?!0:(r&e.weatherMask)===e.weatherMask;if(!e.recipeMasks.length)return!0;for(let s=0;s<e.recipeMasks.length;s++){let a=e.recipeMasks[s];if((r&a)===a)return!0}return!1}_rebuildInvCountsFromArray(e){let n=new Map;for(let r of Array.isArray(e)?e:[]){let o=this.seedKeyFromSpecies(r?.species||"")||null;o&&n.set(o,(n.get(o)||0)+1)}this._invCountBySeedKey=n}_getStockForBase(e){let n=this._baseToKeys.get(e);if(!n||!n.length)return 0;let r=0;for(let o of n)r+=this._invCountBySeedKey.get(o)||0;return r}async _tickAutoHarvest(){if(!this._isHarvestTicking&&this._anyAutoHarvestEnabled()){if(this._isHarvestTicking=!0,this._invCountBySeedKey.size===0&&we.getCropInventoryState)try{let e=await we.getCropInventoryState();Array.isArray(e)&&this._rebuildInvCountsFromArray(e)}catch{}try{let e=await we.getGardenState(),n=Date.now(),r=e?.tileObjects??{};this._scratchPairs.length=0;let o=new Map,s=10;e:for(let[l,c]of Object.entries(r)){let d=Number(l);if(!Number.isInteger(d)||!this._isPlantObject(c))continue;let u=c?.species||c?.name||c?.title;if(!u)continue;let y=Ol(u)??u,h=Xt(y);if(!this._seedKeyEnabledForBase(h))continue;let f=this._getPrimarySeedKeyForBase(h);if(!f)continue;let p=this._compiledRules.get(f);if(!p||!p.enabled)continue;let m=o.get(h);if(m===void 0){let S=Math.max(0,p.minInventory||0);if(S>0){let w=this._getStockForBase(h),x=S-w;if(x<=0)continue;m=x}else m=1/0;o.set(h,m)}else if(m<=0)continue;this._scratchMature.length=0;let g=Array.isArray(c?.slots)?c.slots:[];for(let S=0;S<g.length;S++){let w=g[S]?.endTime;typeof w=="number"&&w<=n&&this._scratchMature.push(S)}if(this._scratchMature.length!==0)for(let S=0;S<this._scratchMature.length;S++){let w=this._scratchMature[S],x=c?.slots?.[w],E=x?.targetScale??1,T=this.getSizeCrop(u,E);if(T<(p.minScalePct||50)||!xt.allowsHarvest({seedKey:f,sizePercent:T,mutations:Array.isArray(x?.mutations)?x.mutations:[]}))continue;let[A,N]=Je.mutsToMasks(x?.mutations);if(this._passesMutationRulesCompiled(p,A,N)){if(m!==1/0&&m<=0||(this._scratchPairs.push({slot:d,sub:w}),m!==1/0&&(m-=1,o.set(h,m),m<=0)))break;if(this._scratchPairs.length>=s)break e}}}let a=!1,i=0;for(let l=0;l<this._scratchPairs.length;l++){let{slot:c,sub:d}=this._scratchPairs[l];try{await we.harvestCrop(c,d),Fe.incrementGardenStat("totalHarvested"),a=!0,i++}catch{}}a&&await this.refreshFromPlayerGarden()}catch{}finally{this._isHarvestTicking=!1}}}seedKeyFromSpecies(e){if(!e)return null;let n=Xt(e),r=this._speciesToKey.get(n);if(r)return r;let o=Ol(e);if(!o)return null;let s=Xt(o);return this._basePrimary.get(s)??this._baseToKeys.get(s)?.[0]??null}sizePercent(e,n){return this.getSizeCrop(e,n)}_hasVisual(e,n){let r=Array.isArray(e?.mutations)?e.mutations:[];return n==="Normal"?!(r.includes("Gold")||r.includes("Rainbow")):r.includes(n)}_hasWeather(e,n){return(Array.isArray(e?.mutations)?e.mutations:[]).includes(n)}async _runAutoSell(e){let n=(()=>{try{return localStorage.getItem("qws:autoSell:dbg")==="1"}catch{return!1}})(),r=(s,...a)=>{if(n)try{console.debug("[AutoSell]",s,...a)}catch{}let i=a.length===0?void 0:a.length===1?a[0]:a},o=s=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:0}).format(s);try{let[s,a]=await Promise.all([we.getCropInventoryState?.()??null,we.getFavoriteIds?.()??[]]),i=Array.isArray(s)?s:[],l=new Set(Array.isArray(a)?a:[]),c=this._lastKnownPlayers;if(!i.length){r("skip: inventory empty");return}let d=new Map;for(let m of i){let g=this.seedKeyFromSpecies(m?.species||"")||"__unknown__";(d.get(g)??d.set(g,[]).get(g)).push(m)}let u=[];for(let[m,g]of d){let S=this._autoSellRules[m];if(!S?.enabled){r("seed skip: disabled",m);continue}if(c<(S.minPlayers||0)){r("seed skip: minPlayers",{seedKey:m,numPlayers:c,need:S.minPlayers||0});continue}let w=g.map(A=>({it:A,size:this.sizePercent(A?.species||"",Number(A?.scale)||1)})).sort((A,N)=>N.size-A.size),x=[];for(let{it:A,size:N}of w)[...S.keepVisual||[]].some(H=>this._hasVisual(A,H))||[...S.keepWeather||[]].some(H=>this._hasWeather(A,H))||N<(S.minSizePct||50)||x.push({it:A,size:N});let E=x.filter(A=>!l.has(A.it.id)),T=Math.max(0,S.keepMin|0);if(E.length<=T){r("seed keep all (pool <= keepMin)",{seedKey:m,pool:E.length,keepMin:T});continue}for(let A=T;A<E.length;A++)u.push(E[A].it.id);r("seed sell add",{seedKey:m,count:E.length-T})}if(u.length===0){r("no sell candidates");return}let y=new Set(u),h=[];for(let m of i){let g=String(m.id);y.has(g)||l.has(g)||h.push(g)}r("tempFavAdds",h.length);let f=0;try{f=Number(await ce.shop.totalCropSellPrice?.get?.())||0}catch{}for(let m of h)try{await we.toggleFavoriteItem(m)}catch(g){r("tempFav add err",m,g)}try{let m=Number(await ce.shop.totalCropSellPrice?.get?.());Number.isFinite(m)&&m>=0&&(f=m)}catch{}let p=!1;try{we.sellNow?await we.sellNow("autosell"):((async()=>{try{let m=await ce.inventory.myCropItemsToSell.get(),g=Array.isArray(m)?m.length:0;g>0&&Fe.incrementShopStat("cropsSoldCount",g)}catch(m){console.error("[SellAllCrops] Unable to read crop items",m)}try{let m=await ce.shop.totalCropSellPrice.get(),g=Number(m);Number.isFinite(g)&&g>0&&Fe.incrementShopStat("cropsSoldValue",g)}catch(m){console.error("[SellAllCrops] Unable to read crop sell price",m)}})(),await we.sellAllCrops()),p=!0,r("sell done",{sold:u.length})}catch(m){r("sell error",m)}try{let m="Auto-Sell";if(p){let g=o(Math.max(0,f));typeof be=="function"&&be(m,f>0?`Sold (~${g}\u{1F4B0})`:"Sold successfully","success")}else typeof be=="function"&&be(m,"Sell failed","error")}catch{}for(let m of h)try{await we.toggleFavoriteItem(m)}catch(g){r("restore err",m,g)}}catch{}}};pe(Je,"TICK_MS",350),pe(Je,"RESYNC_EVERY_TICKS",10),pe(Je,"HARVEST_TICK_MS",1e3),pe(Je,"V_GOLD",1),pe(Je,"V_RAINBOW",2),pe(Je,"W_WET",1),pe(Je,"W_CHILLED",2),pe(Je,"W_FROZEN",4),pe(Je,"W_DAWNLIT",8),pe(Je,"W_AMBER",16);var dp=Je,Pe=new dp;function bt(t,e){let n=document.createElement("label");n.style.display="inline-flex",n.style.alignItems="center",n.style.gap="6px",n.style.padding="4px 8px",n.style.border="1px solid #4444",n.style.borderRadius="8px";let r=document.createElement("input");r.type="checkbox";let o=document.createElement("span");return o.textContent=e??t,n.append(r,o),{wrap:n,input:r,key:t}}function Lt(t,e){t.checked=!!e}function br(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function hk(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.alignItems="center",s.style.gap="8px",r.appendChild(s);function a(){o.innerHTML="";let g=Pe.getSelectedSeed(),S=new Set;for(let[,T]of Pe.assignments.entries())S.add(T);Pe.seedOptions.forEach(({key:T,seedName:A})=>{let N=document.createElement("button");N.className="qmm-vtab",N.style.display="grid",N.style.gridTemplateColumns="16px 1fr auto",N.style.alignItems="center",N.style.gap="8px",N.style.textAlign="left",N.style.padding="6px 8px",N.style.borderRadius="8px",N.style.border="1px solid #4445",N.style.background="#1f2328",N.style.color="#e7eef7";let H=T===Pe.getSelectedSeed();N.style.background=H?"#2b8a3e":"#1f2328";let C=document.createElement("span");C.className="qmm-dot",C.style.background=S.has(T)?"#2ecc71":"#7779";let L=document.createElement("span");L.className="label",L.textContent=A;let v=Tt("Seed",T,{size:18,alt:A,fallback:Pe.getEmojiForKey?.(T)||"\u{1F331}"});N.append(C,L,v),N.onmouseenter=()=>N.style.borderColor="#6aa1",N.onmouseleave=()=>N.style.borderColor="#4445",N.onclick=()=>Pe.setSelectedSeed(T),o.appendChild(N)}),s.innerHTML="";let w=document.createElement("button");br(w,"Clear"),w.onclick=()=>Pe.assignments.clear();let x=document.createElement("button");br(x,"Invert"),x.onclick=()=>Pe.assignments.invert(Pe.getSelectedSeed());let E=e.switch(!1);E.checked=Pe.getAutoPlantEnabled?.()??!1,E.addEventListener("change",()=>{E.checked?Pe.startAutoPlant?.():Pe.stopAutoPlant?.()}),E.style.marginLeft="auto",s.append(w,x,E)}let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.gap="8px",n.appendChild(i);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="repeat(10, 1fr) 12px repeat(10, 1fr)",l.style.gridTemplateRows="repeat(10, 1fr)",l.style.gap="2px",l.style.height="53vh",l.style.aspectRatio="20 / 10",l.style.width="auto",l.style.padding="6px",l.style.border="1px solid #3335",l.style.borderRadius="8px",l.style.background="#0f1115",l.style.boxSizing="border-box",l.oncontextmenu=g=>g.preventDefault(),i.appendChild(l);let c=!1,d="assign";l.addEventListener("mousedown",g=>{c=!0,d=g.button===2?"erase":"assign"}),window.addEventListener("mouseup",()=>{c=!1});function u(g){g.style.border="1px solid #0002",g.style.borderRadius="4px",g.style.cursor="pointer",g.style.userSelect="none",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center"}function y(g){return g==="unassigned"?"#9aa1a822":g==="ok"?"#28a74555":g==="waiting"?"#ffc10755":"#dc354555"}function h(g){let S=l.querySelector(`div[data-slot="${g}"]`);if(!S)return;S.style.background=y(Pe.getVisualState(g));let w=Pe.assignments.get(g),x=S.querySelector("span");if(w){let E=Pe.seedOptions.find(A=>A.key===w)?.seedName??w;x.innerHTML="",x.style.opacity="1";let T=Tt("Seed",w,{size:16,alt:E,fallback:Pe.getEmojiForKey?.(w)||"\u{1F331}"});x.appendChild(T)}else x.textContent="",x.style.opacity="0.5"}function f(){for(let g=0;g<200;g++)h(g)}for(let g=0;g<10;g++){for(let w=0;w<10;w++)l.appendChild(p(g*20+w));let S=document.createElement("div");S.style.width="12px",S.style.height="100%",S.style.pointerEvents="none",S.style.background="transparent",l.appendChild(S);for(let w=10;w<20;w++)l.appendChild(p(g*20+w))}function p(g){let S=document.createElement("div");S.dataset.slot=String(g),u(S);let w=document.createElement("span");return w.style.pointerEvents="none",w.style.fontWeight="600",w.style.fontSize="10px",w.style.color="#e7eef7aa",S.appendChild(w),S.addEventListener("click",x=>{if(x.ctrlKey||x.metaKey){let E=Pe.runtime.getSlotState(g),T=E==="empty"?"single":E==="single"?"multi":"empty";Pe.runtime.setSlotState(g,T)}else Pe.assignments.set(g,Pe.getSelectedSeed())}),S.addEventListener("contextmenu",x=>{x.preventDefault(),Pe.assignments.delete(g)}),S.addEventListener("mouseover",()=>{c&&(d==="assign"?Pe.assignments.set(g,Pe.getSelectedSeed()):Pe.assignments.delete(g))}),S}let m=Pe.subscribe(g=>{g.type==="assignments-changed"||g.type==="runtime-changed"?(g.slots?.length?g.slots.forEach(h):f(),g.type==="assignments-changed"&&a()):(g.type==="seed-list-changed"||g.type==="selected-seed-changed")&&a()});a(),f()}var hb=new Map;function Pn(t){let e=hb.get(t);if(!e){e={enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:new Set,weatherMode:"ANY",weatherSelected:new Set,weatherRecipes:[],minInventory:91};let n=Pe.getHarvestRule?.(t);n&&(e.enabled=!!n.enabled,e.minScalePct=n.minScalePct??50,e.visualIncludeNormal=!!n.visualIncludeNormal,e.visualMutations=new Set(n.visualMutations??[]),e.weatherMode=n.weatherMode??"ANY",e.weatherSelected=new Set(n.weatherSelected??[]),e.weatherRecipes=(n.weatherRecipes??[]).map(r=>new Set(r)),e.minInventory=Math.max(0,Math.floor(n.minInventory??91))),hb.set(t,e)}return e}function bk(t){return{enabled:t.enabled,minScalePct:t.minScalePct,visualIncludeNormal:t.visualIncludeNormal,visualMutations:[...t.visualMutations],weatherMode:t.weatherMode,weatherSelected:[...t.weatherSelected],weatherRecipes:t.weatherRecipes.map(e=>[...e]),minInventory:t.minInventory}}function Sk(t,e){t.innerHTML="",t.__unsubHarvest?.();let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.gap="6px",r.appendChild(s);let a=document.createElement("button");br(a,"Enable all"),a.onclick=()=>{Pe.seedOptions.forEach(M=>{let K=Pn(M.key);K.enabled=!0,Pe.setAutoHarvestEnabledForSeed?.(M.key,!0)}),ne(),Y&&q(Y)};let i=document.createElement("button");br(i,"Disable all"),i.onclick=()=>{Pe.seedOptions.forEach(M=>{let K=Pn(M.key);K.enabled=!1,Pe.setAutoHarvestEnabledForSeed?.(M.key,!1)}),ne(),Y&&q(Y)},s.append(a,i);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.gap="10px",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=e.label("\u2014");d.style.fontWeight="700",d.style.fontSize="14px";let u=e.switch(!1);u.title="Enable auto-harvest for this seed",c.append(d,u);let y=document.createElement("div");y.style.border="1px solid #4445",y.style.borderRadius="10px",y.style.padding="12px",y.style.display="flex",y.style.flexDirection="column",y.style.gap="12px",y.style.alignItems="center",y.style.overflow="auto",y.style.minHeight="0";let h=(M,K)=>{let $=document.createElement("div");$.style.display="grid",$.style.justifyItems="center",$.style.gap="8px",$.style.textAlign="center",$.style.border="1px solid #4446",$.style.borderRadius="10px",$.style.padding="10px",$.style.background="#1f2328",$.style.boxShadow="0 0 0 1px #0002 inset",$.style.width="min(720px, 100%)";let Q=document.createElement("div");return Q.textContent=M,Q.style.fontWeight="600",Q.style.opacity="0.95",$.append(Q,K),$},f=()=>{let M=document.createElement("div");return M.style.display="flex",M.style.flexWrap="wrap",M.style.justifyContent="center",M.style.alignItems="center",M.style.gap="8px",M},p=f(),m=e.slider(50,100,1,50);m.style.width="240px";let g=e.label("50%");p.append(m,g),m.addEventListener("input",()=>{g.textContent=`${m.value}%`});let S=f(),w=e.label("Harvest only if stock <"),x=e.inputNumber(0,91,1,91);x.style.width="72px",x.style.textAlign="center";let E=e.label("(stock: \u2014)");E.style.opacity="0.85",S.append(w,x.wrap??x,E);let T=f(),A=bt("Normal"),N=bt("Gold"),H=bt("Rainbow");T.append(A.wrap,N.wrap,H.wrap);let C=f(),L=bt("Wet"),v=bt("Chilled"),B=bt("Frozen"),le=bt("Dawnlit"),X=bt("Amberglow");C.append(L.wrap,v.wrap,B.wrap,le.wrap,X.wrap);let de=f(),_=J("weather-mode","ANY","Any (OR)"),re=J("weather-mode","ALL","All (AND)"),R=J("weather-mode","RECIPES","Recipes (AND within, OR across)");de.append(_.wrap,re.wrap,R.wrap);let k=document.createElement("div");k.style.display="grid",k.style.gap="8px",k.style.justifyItems="center",k.style.width="min(720px, 100%)";let V=f(),ee=document.createElement("div");ee.textContent="Recipes (OR between rows)",ee.style.fontWeight="600";let ie=document.createElement("button");br(ie,"+ Recipe"),ie.style.maxWidth="140px",V.append(ee,ie);let fe=document.createElement("div");fe.style.display="grid",fe.style.gap="8px",fe.style.justifyItems="stretch",k.append(V,fe);function G(M,K){let $=document.createElement("div");$.style.display="flex",$.style.flexWrap="wrap",$.style.justifyContent="center",$.style.alignItems="center",$.style.gap="8px",$.style.border="1px solid #4446",$.style.borderRadius="10px",$.style.padding="8px",$.style.background="#0f1318",$.style.boxShadow="0 0 0 1px #0002 inset";let Q=bt("Wet"),se=bt("Chilled"),O=bt("Frozen"),U=bt("Dawnlit"),ue=bt("Amberglow");[Q,se,O,U,ue].forEach(({input:ae,key:ye,wrap:he})=>{Lt(ae,K.has(ye)),ae.addEventListener("change",()=>{ae.checked?K.add(ye):K.delete(ye),P()}),$.append(he)});let oe=document.createElement("button");return br(oe,"\xD7"),oe.style.width="36px",oe.onclick=()=>{Pn(Y).weatherRecipes.splice(M,1),j(),P()},$.append(oe),$}let Z=(M,K,$)=>{let Q=parseInt(M||String(K),10);return Math.max(K,Math.min($,Number.isFinite(Q)?Q:K))};function j(){fe.innerHTML="";let M=Y?Pn(Y):null;M&&M.weatherRecipes.forEach((K,$)=>fe.appendChild(G($,K)))}ie.onclick=()=>{Pn(Y).weatherRecipes.push(new Set),j(),P()},y.append(h("Minimum size",p),h("Inventory buffer",S),h("Color mutations",T),h("Weather mutations",C),h("Weather match mode",de),h("Recipes",k)),l.append(c,y),n.append(r,l);let Y=null;function ne(){o.innerHTML="",Pe.seedOptions.forEach(M=>{let K=Pn(M.key),$=document.createElement("button");$.className="qmm-vtab",$.style.background=M.key===Y?"#2b8a3e":"#1f2328",$.style.gridTemplateColumns="16px 1fr auto";let Q=document.createElement("span");Q.className="qmm-dot";let se=Pe.getAutoHarvestEnabledForSeed?.(M.key)??Pn(M.key).enabled;Q.style.background=se?"#2ecc71":"#7779";let O=document.createElement("span");O.className="label",O.textContent=M.cropName||M.key;let U=Tt("Crop",M.key,{size:18,alt:M.seedName||M.key,fallback:Pe.getEmojiForKey?.(M.key)||"\u{1F331}"});$.append(Q,O,U),$.onclick=()=>{Y=M.key,q(M.key),ne()},o.appendChild($)})}function q(M){let K=Pn(M);u.checked=Pe.getAutoHarvestEnabledForSeed?.(M)??K.enabled,d.textContent=`Settings \u2014 ${M}`,u.checked=K.enabled,m.value=String(K.minScalePct),m.dispatchEvent(new Event("input")),x.value=String(Math.max(0,Math.min(91,K.minInventory??91))),Lt(A.input,K.visualIncludeNormal),Lt(N.input,K.visualMutations.has("Gold")),Lt(H.input,K.visualMutations.has("Rainbow")),Lt(L.input,K.weatherSelected.has("Wet")),Lt(v.input,K.weatherSelected.has("Chilled")),Lt(B.input,K.weatherSelected.has("Frozen")),Lt(le.input,K.weatherSelected.has("Dawnlit")),Lt(X.input,K.weatherSelected.has("Amberglow")),_.input.checked=K.weatherMode==="ANY",re.input.checked=K.weatherMode==="ALL",R.input.checked=K.weatherMode==="RECIPES",k.style.display=K.weatherMode==="RECIPES"?"":"none",j(),D()}let W=[];function b(M){return M?W.reduce((K,$)=>{let Q=Pe.seedKeyFromSpecies?.($?.species||"");return K+(Q===M?1:0)},0):0}function D(){if(!Y){E.textContent="(stock: \u2014)";return}E.textContent=`(stock: ${b(Y)})`}let F=null;we.onCropInventoryChangeNow?.(M=>{W=Array.isArray(M)?M:[],D()}).then(M=>{F=M}).catch(()=>{});function P(){if(!Y)return;let M=Pn(Y);M.enabled=!!u.checked,M.minScalePct=parseInt(m.value,10)||50,M.minInventory=Z(x.value,0,999),M.visualIncludeNormal=!!A.input.checked,I(M.visualMutations,[["Gold",N.input],["Rainbow",H.input]]),I(M.weatherSelected,[["Wet",L.input],["Chilled",v.input],["Frozen",B.input],["Dawnlit",le.input],["Amberglow",X.input]]),M.weatherMode=re.input.checked?"ALL":R.input.checked?"RECIPES":"ANY",Pe.setHarvestRule?.(Y,bk(M)),ne()}function I(M,K){M.clear(),K.forEach(([$,Q])=>{Q.checked&&M.add($)})}function J(M,K,$){let Q=document.createElement("label");Q.style.display="inline-flex",Q.style.alignItems="center",Q.style.gap="6px";let se=document.createElement("input");se.type="radio",se.name=M,se.value=K;let O=document.createElement("span");return O.textContent=$,Q.append(se,O),se.addEventListener("change",()=>{k.style.display=K==="RECIPES"&&se.checked?"":"none",P()}),{wrap:Q,input:se,value:K}}u.addEventListener("change",P),m.addEventListener("change",P),x.addEventListener("input",()=>{x.value=String(Z(x.value,0,999))}),x.addEventListener("change",P),[A.input,N.input,H.input,L.input,v.input,B.input,le.input,X.input].forEach(M=>M.addEventListener("change",P));let te=Pe.subscribe?.(M=>{if(M?.type==="harvest-rule-changed"){if(ne(),M.seedKey===Y){let K=M.rule,$=Pn(M.seedKey);$.minInventory=Math.max(0,Math.min(91,parseInt(x.value||"91",10))),q(Y)}}else M?.type==="harvest-rules-replaced"&&(ne(),Y&&q(Y))});t.__unsubHarvest=()=>{if(te?.(),F)try{F()}catch{}},x.addEventListener("input",()=>{x.value=String(Math.max(0,Math.min(91,parseInt(x.value||"91",10))))});let z=Pe.seedOptions[0]?.key||null;z&&(Y=z),ne(),Y&&q(Y)}var pp=new Map;function Ko(t){let e=pp.get(t);if(!e){e={enabled:!1,keepMin:0,minSizePct:50,keepVisual:new Set,keepWeather:new Set,minPlayers:1};let n=Pe.getAutoSellRule?.(t);n&&(e.enabled=!!n.enabled,e.keepMin=n.keepMin??0,e.minSizePct=n.minSizePct??50,e.keepVisual=new Set(n.keepVisual??[]),e.keepWeather=new Set(n.keepWeather??[]),e.minPlayers=typeof n.minPlayers=="number"?n.minPlayers:1),pp.set(t,e)}return e}function up(t){return{enabled:t.enabled,keepMin:t.keepMin,minSizePct:t.minSizePct,keepVisual:[...t.keepVisual],keepWeather:[...t.keepWeather],minPlayers:t.minPlayers}}async function vk(t,e){t.innerHTML="",t.__unsubAutoSell?.();let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.gap="6px",r.appendChild(s);let a=document.createElement("button");br(a,"Enable all"),a.onclick=()=>{Pe.seedOptions.forEach(ne=>{let q=Ko(ne.key),W={...up(q),enabled:!0};Pe.setAutoSellRule?.(ne.key,W),q.enabled=!0}),ee(),V&&ie(V)};let i=document.createElement("button");br(i,"Disable all"),i.onclick=()=>{Pe.seedOptions.forEach(ne=>{let q=Ko(ne.key),W={...up(q),enabled:!1};Pe.setAutoSellRule?.(ne.key,W),q.enabled=!1}),ee(),V&&ie(V)},s.append(a,i);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.gap="10px",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=e.label("\u2014");d.style.fontWeight="700",d.style.fontSize="14px";let u=e.switch(!1);u.title="Enable auto-sell for this crop",c.append(d,u);let y=document.createElement("div");y.style.border="1px solid #4445",y.style.borderRadius="10px",y.style.padding="12px",y.style.display="flex",y.style.flexDirection="column",y.style.gap="12px",y.style.alignItems="center",y.style.overflow="auto",y.style.minHeight="0";let h=(ne,q)=>{let W=document.createElement("div");W.style.display="grid",W.style.justifyItems="center",W.style.gap="8px",W.style.textAlign="center",W.style.border="1px solid #4446",W.style.borderRadius="10px",W.style.padding="10px",W.style.background="#1f2328",W.style.boxShadow="0 0 0 1px #0002 inset",W.style.width="min(720px, 100%)";let b=document.createElement("div");return b.textContent=ne,b.style.fontWeight="600",b.style.opacity="0.95",W.append(b,q),W},f=()=>{let ne=document.createElement("div");return ne.style.display="flex",ne.style.flexWrap="wrap",ne.style.justifyContent="center",ne.style.alignItems="center",ne.style.gap="8px",ne},p=f(),m=e.label("Sell only if players \u2265"),g=e.inputNumber(1,6,1,1);g.style.width="64px",g.style.textAlign="center";let S=e.label("(now: "+await we.getNumPlayers()+")");S.style.opacity="0.85",p.append(m,g.wrap,S);let w=f(),x=e.label("Keep at least"),E=e.inputNumber(0,91,1,0);E.style.width="72px",E.style.textAlign="center";let T=e.label("items");w.append(x,E.wrap??E,T);let A=f(),N=e.slider(50,100,1,50);N.style.width="240px";let H=e.label("50%");A.append(N,H),N.addEventListener("input",()=>{H.textContent=`${N.value}%`});let C=f(),L=bt("Normal"),v=bt("Gold"),B=bt("Rainbow");C.append(L.wrap,v.wrap,B.wrap);let le=f(),X=bt("Wet"),de=bt("Chilled"),_=bt("Frozen"),re=bt("Dawnlit"),R=bt("Amberglow");le.append(X.wrap,de.wrap,_.wrap,re.wrap,R.wrap);let k=e.label("Favorites are never sold. Per-crop rules let you keep stock for pets.");k.style.opacity="0.9",k.style.fontSize="12px",y.append(h("Sell condition",p),h("Inventory buffer",w),h("Minimum size",A),h("Keep color mutations (never sell)",C),h("Keep weather mutations (never sell)",le),k),l.append(c,y),n.append(r,l);let V=null;function ee(){o.innerHTML="",Pe.seedOptions.forEach(ne=>{let q=Pe.getAutoSellEnabledForSeed?.(ne.key)??Ko(ne.key).enabled,W=document.createElement("button");W.className="qmm-vtab",W.style.background=ne.key===V?"#2b8a3e":"#1f2328",W.style.gridTemplateColumns="16px 1fr auto";let b=document.createElement("span");b.className="qmm-dot",b.style.background=q?"#2ecc71":"#7779";let D=document.createElement("span");D.className="label",D.textContent=ne.cropName||ne.key;let F=Tt("Crop",ne.key,{size:18,alt:ne.seedName||ne.key,fallback:Pe.getEmojiForKey?.(ne.key)||"\u{1F331}"});W.append(b,D,F),W.onclick=()=>{V=ne.key,ie(ne.key),ee()},o.appendChild(W)})}function ie(ne){let q=Ko(ne);d.textContent=`Auto-sell \u2014 ${ne}`,u.checked=Pe.getAutoSellEnabledForSeed?.(ne)??q.enabled,g.value=String(Math.max(1,Math.min(6,q.minPlayers||1))),E.value=String(Math.max(0,Math.min(91,q.keepMin||0))),N.value=String(q.minSizePct||50),N.dispatchEvent(new Event("input")),Lt(L.input,q.keepVisual.has("Normal")),Lt(v.input,q.keepVisual.has("Gold")),Lt(B.input,q.keepVisual.has("Rainbow")),Lt(X.input,q.keepWeather.has("Wet")),Lt(de.input,q.keepWeather.has("Chilled")),Lt(_.input,q.keepWeather.has("Frozen")),Lt(re.input,q.keepWeather.has("Dawnlit")),Lt(R.input,q.keepWeather.has("Amberglow"))}function fe(){if(!V)return;let ne=Ko(V);ne.enabled=!!u.checked,ne.minPlayers=G(g.value,1,6),ne.keepMin=G(E.value,0,91),ne.minSizePct=G(N.value,50,100),ne.keepVisual.clear(),L.input.checked&&ne.keepVisual.add("Normal"),v.input.checked&&ne.keepVisual.add("Gold"),B.input.checked&&ne.keepVisual.add("Rainbow"),ne.keepWeather.clear(),X.input.checked&&ne.keepWeather.add("Wet"),de.input.checked&&ne.keepWeather.add("Chilled"),_.input.checked&&ne.keepWeather.add("Frozen"),re.input.checked&&ne.keepWeather.add("Dawnlit"),R.input.checked&&ne.keepWeather.add("Amberglow"),Pe.setAutoSellRule?.(V,up(ne)),ee()}function G(ne,q,W){let b=parseInt(ne||String(q),10);return Math.max(q,Math.min(W,Number.isFinite(b)?b:q))}u.addEventListener("change",fe),g.addEventListener("input",()=>{g.value=String(Math.max(1,Math.min(6,parseInt(g.value||"1",10))))}),g.addEventListener("change",fe),E.addEventListener("input",()=>{E.value=String(G(E.value,0,91))}),E.addEventListener("change",fe),N.addEventListener("change",fe);let Z=Pe.subscribe?.(ne=>{if(ne?.type==="auto-sell-rule-changed"){let q=ne.rule,W=Ko(ne.seedKey);W.enabled=!!q.enabled,W.keepMin=q.keepMin,W.minSizePct=q.minSizePct,W.keepVisual=new Set(q.keepVisual??[]),W.keepWeather=new Set(q.keepWeather??[]),W.minPlayers=q.minPlayers,ee(),V===ne.seedKey&&ie(V)}else ne?.type==="auto-sell-rules-replaced"&&(pp.clear(),ee(),V&&ie(V))});[L.input,v.input,B.input,X.input,de.input,_.input,re.input,R.input].forEach(ne=>ne.addEventListener("change",fe));let j=null;typeof we.onNumPlayersNow=="function"&&we.onNumPlayersNow(ne=>{S.textContent=`(now: ${ne})`}).then(ne=>{j=ne}).catch(()=>{}),t.__unsubAutoSell=()=>{if(Z?.(),j)try{j()}catch{}};let Y=Pe.seedOptions[0]?.key||null;Y&&(V=Y),ee(),V&&ie(V)}async function bb(t){let e=new Qe({id:"garden",compact:!0});e.mount(t),e.addTabs([{id:"auto-plant",title:"Auto plant",render:n=>hk(n,e)},{id:"auto-harvest",title:"Auto harvest",render:n=>Sk(n,e)},{id:"auto-sell",title:"Auto sell",render:n=>vk(n,e)}])}function Sb(t){for(let e of t){let n=document.querySelector(`div[data-slot="${e}"]`);if(!n)continue;let r=n.style.background;n.style.outline="2px solid #88f",setTimeout(()=>{n.style.outline="",n.style.background=r},350)}}var Bl="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yWIx4QmQjniP/DFmXUHhpXgYKiwj0jItaDYoKCJwwYeA8MCCDGJuOoIQJFQEHjhJiW1NwKgKQTnbpNVZyKIIqeEtci87LqvPjrDXFvdx/v/r9eT//////////8X/O/34YjQv//nbVV62e+zRaNdv5k3Nlkv54MsiVZJ2XPNImgx6LJVuEpwRk5xtEkjOFydK6U44SZKtPgOpWFyUrA5KVwmCTAGQasapCi+pBXrShYhskHhSRHScOBoQjCMWFSqaA+hRJoD6EhSXc0qk25kNUMSzoQpY4x2EatYayUjWUjakatczs/X6ssMtcmvSZausPNb1Z7MvsZNtBRrR1vBf8Fl4/xpo2gYAPVqmZh3Zqv0o3AwpxomhWHeCsQjJYtDR7Oz09UeaGmZLiY9UBT1bvBXDXLaLg7lpUq79eJRnBoGZcjQTIU2QmlCpBRpZLpk6gKKER4ApYROtLHiXKhLWJYoV9Wv/+5RE9I8C3GLBgyFE8lsMeDBkI54KgY8CDATVwgApIWj0jpl1oLeWDtoUPes6hly6zueDsS8io9hriUNB3GPDCgoloBCgoCpRstUAnAQHUSTcAmVGcv2VV/9aWqqu212q5xjVZI4mG8LIwk8L0T/zXdc6WGAln0Kv8/jUBpZGq6nVUmNf89VL2oCVJjqk2qiS//YwrDQXEBQxI1VUaWqnglaJ0ZnIUsbjOFEozLLDhrJUFUmZpqv9Vv9mjF7HV2XZv9s/2Paeaw1JVh3NZ3alqp89m2L6vxi1jBjFS8S7FguQVjiwFeb/8O/5ZkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5Rk3QDBygs8yCEYED0hV4IEJgwLEY7GIYR+QVyl2chTDDGqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=";function Hl(t){return Math.max(0,Math.min(1,t))}function ga(t){return/^data:audio\/[a-z0-9.+-]+;base64,/i.test(t.trim())}function Qr(t,e="audio/mpeg"){let n=(t||"").trim();return n?ga(n)?n:`data:${e};base64,${n}`:""}var vb="audio.settings",wb="audio.library",mp=class{constructor(e){pe(this,"enabled",!0);pe(this,"volume",.7);pe(this,"minPlayGapMs",1200);pe(this,"lastPlayTs",0);pe(this,"library",new Map);pe(this,"defaultSoundName",null);pe(this,"defaultSoundDataUrl",null);pe(this,"mode","oneshot");pe(this,"stopConf",{mode:"manual"});pe(this,"loopIntervalMs",1500);pe(this,"weatherMode","oneshot");pe(this,"weatherStopConf",{mode:"manual"});pe(this,"weatherLoopIntervalMs",1500);pe(this,"petMode","oneshot");pe(this,"petStopConf",{mode:"manual"});pe(this,"petLoopIntervalMs",1500);pe(this,"loops",new Map);pe(this,"oneshotQueue",[]);pe(this,"oneshotQueueTimer",null);pe(this,"oneshotProcessing",!1);pe(this,"weatherVolume",.7);pe(this,"weatherDefaultSoundName",null);pe(this,"petVolume",.7);pe(this,"petDefaultSoundName",null);pe(this,"purchaseChecker");pe(this,"audioCtx",null);pe(this,"primed",!1);pe(this,"builtinDefault",null);pe(this,"suppressPersist",0);e?.minPlayGapMs!=null&&(this.minPlayGapMs=Math.max(0,e.minPlayGapMs|0)),e?.volume!=null&&(this.volume=Hl(e.volume)),this.suppressPersist++;try{if(Bl&&Bl.trim()&&Bl.indexOf("TODO:")===-1){let n=Qr(Bl);this.registerSound("Default",n),this.defaultSoundName="Default",this.builtinDefault={name:"Default",dataUrl:n}}if(e?.defaultSound){let n=Qr(e.defaultSound);this.defaultSoundDataUrl=n,this.registerSound("LegacyDefault",n),this.defaultSoundName="LegacyDefault"}}finally{this.suppressPersist--}this.loadFromStorage(),this.ensureBuiltinPresent(),this.ensureDefaultSoundValidity()&&this.persistSettings()}ensureBuiltinPresent(){this.builtinDefault&&!this.library.has(this.builtinDefault.name)&&this.library.set(this.builtinDefault.name,this.builtinDefault.dataUrl)}ensureDefaultSoundValidity(){let e=!1,n=()=>{if(this.builtinDefault&&this.library.has(this.builtinDefault.name))return this.builtinDefault.name;let i=this.library.keys().next();return i.done?null:i.value},r=(i,l)=>i&&this.library.has(i)?i:l&&this.library.has(l)?l:n(),o=r(this.defaultSoundName);o!==this.defaultSoundName&&(this.defaultSoundName=o,e=!0);let s=r(this.weatherDefaultSoundName,o);s!==this.weatherDefaultSoundName&&(this.weatherDefaultSoundName=s,e=!0);let a=r(this.petDefaultSoundName,o);return a!==this.petDefaultSoundName&&(this.petDefaultSoundName=a,e=!0),e}persistSettings(){if(!(this.suppressPersist>0))try{let e={enabled:this.enabled,volume:this.volume,minPlayGapMs:this.minPlayGapMs,mode:this.mode,stop:this.stopConf,loopIntervalMs:this.loopIntervalMs,defaultSoundName:this.defaultSoundName,contexts:{shops:{volume:this.volume,mode:this.mode,stop:this.stopConf,loopIntervalMs:this.loopIntervalMs,defaultSoundName:this.defaultSoundName},weather:{volume:this.weatherVolume,mode:this.weatherMode,stop:this.weatherStopConf,loopIntervalMs:this.weatherLoopIntervalMs,defaultSoundName:this.weatherDefaultSoundName},pets:{volume:this.petVolume,mode:this.petMode,stop:this.petStopConf,loopIntervalMs:this.petLoopIntervalMs,defaultSoundName:this.petDefaultSoundName}}};Oe(vb,e)}catch{}}persistLibrary(){if(!(this.suppressPersist>0))try{let e=[];for(let[n,r]of this.library.entries())this.builtinDefault&&n===this.builtinDefault.name||e.push({name:n,data:r});Oe(wb,e)}catch{}}loadFromStorage(){this.suppressPersist++;try{try{let e=_e(wb);if(Array.isArray(e)){this.library.clear(),this.ensureBuiltinPresent();for(let n of e){let r=String(n&&n.name||"").trim(),o=String(n&&n.data||"").trim();!r||!o||this.builtinDefault&&r===this.builtinDefault.name||this.library.set(r,ga(o)?o:Qr(o))}}}catch{}try{let e=_e(vb);if(e&&typeof e=="object"){if(typeof e.enabled=="boolean"&&(this.enabled=e.enabled),typeof e.minPlayGapMs=="number"&&(this.minPlayGapMs=Math.max(0,e.minPlayGapMs|0)),typeof e.volume=="number"&&(this.volume=Hl(e.volume)),(e.mode==="loop"||e.mode==="oneshot")&&(this.mode=e.mode),e.stop&&typeof e.stop=="object"){let h=e.stop.mode;h==="purchase"?this.stopConf={mode:"purchase"}:h==="manual"?this.stopConf={mode:"manual"}:h==="repeat"&&(this.stopConf={mode:"manual"})}if(typeof e.loopIntervalMs=="number"&&(this.loopIntervalMs=Math.max(150,e.loopIntervalMs|0)),typeof e.defaultSoundName=="string"){let h=e.defaultSoundName.trim();this.defaultSoundName=h||null}let n=!1,r=!1,o=!1,s=!1,a=!1,i=!1,l=!1,c=!1,d=!1,u=!1,y=(h,f)=>{if(!f||typeof f!="object")return;let p=x=>{if(typeof x!="number")return;let E=Hl(x);h==="weather"?(this.weatherVolume=E,n=!0):h==="pets"?(this.petVolume=E,i=!0):this.volume=E},m=x=>{(x==="loop"||x==="oneshot")&&(h==="weather"?(this.weatherMode=x,r=!0):h==="pets"?(this.petMode=x,l=!0):this.mode=x)},g=x=>{if(!x||typeof x!="object")return;let E=x.mode;E==="purchase"?h==="weather"?(this.weatherStopConf={mode:"purchase"},o=!0):h==="pets"?(this.petStopConf={mode:"purchase"},c=!0):this.stopConf={mode:"purchase"}:E==="manual"?h==="weather"?(this.weatherStopConf={mode:"manual"},o=!0):h==="pets"?(this.petStopConf={mode:"manual"},c=!0):this.stopConf={mode:"manual"}:E==="repeat"&&(h==="weather"?(this.weatherStopConf={mode:"manual"},o=!0):h==="pets"?(this.petStopConf={mode:"manual"},c=!0):this.stopConf={mode:"manual"})},S=x=>{if(typeof x!="number"||!Number.isFinite(x))return;let E=Math.max(150,Math.floor(x));h==="weather"?(this.weatherLoopIntervalMs=E,s=!0):h==="pets"?(this.petLoopIntervalMs=E,d=!0):this.loopIntervalMs=E},w=x=>{if(typeof x!="string")return;let E=x.trim();h==="weather"?(this.weatherDefaultSoundName=E||null,a=!0):h==="pets"?(this.petDefaultSoundName=E||null,u=!0):this.defaultSoundName=E||null};p(f.volume),m(f.mode),g(f.stop),S(f.loopIntervalMs),w(f.defaultSoundName)};e.contexts&&typeof e.contexts=="object"&&(y("shops",e.contexts.shops),y("weather",e.contexts.weather),y("pets",e.contexts.pets)),n||(this.weatherVolume=this.volume),r||(this.weatherMode=this.mode),o||(this.weatherStopConf=this.stopConf.mode==="purchase"?{mode:"purchase"}:{mode:"manual"}),s||(this.weatherLoopIntervalMs=this.loopIntervalMs),a||(this.weatherDefaultSoundName=this.defaultSoundName),i||(this.petVolume=this.volume),l||(this.petMode=this.mode),c||(this.petStopConf=this.stopConf.mode==="purchase"?{mode:"purchase"}:{mode:"manual"}),d||(this.petLoopIntervalMs=this.loopIntervalMs),u||(this.petDefaultSoundName=this.defaultSoundName)}}catch{}}finally{this.suppressPersist--}}isProtectedSound(e){return!!(this.builtinDefault&&this.builtinDefault.name===e)}registerSound(e,n,r){let o=String(e||"").trim();if(!o)return;let s=Qr(n,r||"audio/mpeg");this.library.set(o,s);let a=this.defaultSoundName,i=this.weatherDefaultSoundName,l=this.petDefaultSoundName;this.defaultSoundName||(this.defaultSoundName=o),this.weatherDefaultSoundName||(this.weatherDefaultSoundName=o),this.petDefaultSoundName||(this.petDefaultSoundName=o),this.ensureBuiltinPresent(),this.persistLibrary(),(a!==this.defaultSoundName||i!==this.weatherDefaultSoundName||l!==this.petDefaultSoundName)&&this.persistSettings()}unregisterSound(e){if(this.isProtectedSound(e)||!this.library.delete(e))return;let r=this.defaultSoundName,o=this.weatherDefaultSoundName,s=this.petDefaultSoundName;r===e&&(this.defaultSoundName=null),o===e&&(this.weatherDefaultSoundName=null),s===e&&(this.petDefaultSoundName=null);let a=r===e||o===e||s===e||this.ensureDefaultSoundValidity();this.persistLibrary(),a&&this.persistSettings()}listSounds(){return Array.from(this.library.keys())}setDefaultSoundByName(e,n="shops"){if(this.library.has(e)){if(n==="weather"){if(this.weatherDefaultSoundName===e)return;this.weatherDefaultSoundName=e}else if(n==="pets"){if(this.petDefaultSoundName===e)return;this.petDefaultSoundName=e}else{if(this.defaultSoundName===e)return;this.defaultSoundName=e}this.persistSettings()}}resetLibrary(e){let n=this.defaultSoundName,r=this.weatherDefaultSoundName;this.suppressPersist++;try{this.library.clear(),this.ensureBuiltinPresent();let s=[];for(let a of e){let i=String(a?.name||"").trim();if(!i||this.isProtectedSound(i))continue;let l=ga(a.data)?a.data:Qr(a.data);this.library.set(i,l),s.push(i)}s.length&&(this.defaultSoundName=s[0],this.weatherDefaultSoundName=s[0])}finally{this.suppressPersist--}let o=this.ensureDefaultSoundValidity()||n!==this.defaultSoundName||r!==this.weatherDefaultSoundName;this.persistLibrary(),o&&this.persistSettings()}setNotificationBase64(e){let n=e&&e.trim()?ga(e)?e:Qr(e):"";this.defaultSoundDataUrl=n||null,n&&(this.registerSound("LegacyDefault",n),this.defaultSoundName="LegacyDefault",this.weatherDefaultSoundName="LegacyDefault"),this.persistSettings()}getDefaultSoundName(e="shops"){return e==="weather"?this.weatherDefaultSoundName??this.defaultSoundName:e==="pets"?this.petDefaultSoundName??this.defaultSoundName:this.defaultSoundName}resolveToDataUrl(e,n){if(!e){let o=n==="weather"?this.weatherDefaultSoundName??this.defaultSoundName:n==="pets"?this.petDefaultSoundName??this.defaultSoundName:this.defaultSoundName;return o&&this.library.has(o)?this.library.get(o):this.defaultSoundDataUrl||null}let r=e.trim();return this.library.has(r)?this.library.get(r):ga(r)?r:/^[A-Za-z0-9+/=\s]+$/.test(r)&&r.length>100?Qr(r):null}setEnabled(e){let n=!!e;this.enabled!==n&&(this.enabled=n,this.persistSettings())}isEnabled(){return this.enabled}setMute(e){this.setEnabled(!e)}isMuted(){return!this.enabled}setVolume(e,n="shops"){let r=Hl(e);if(n==="weather"){if(this.weatherVolume===r)return;this.weatherVolume=r}else if(n==="pets"){if(this.petVolume===r)return;this.petVolume=r}else{if(this.volume===r)return;this.volume=r}this.forEachLoop(n,o=>{o.volume=r}),this.persistSettings()}getVolume(e="shops"){return e==="weather"?this.weatherVolume:e==="pets"?this.petVolume:this.volume}setMinPlayGap(e){let n=Math.max(0,e|0);this.minPlayGapMs!==n&&(this.minPlayGapMs=n,this.persistSettings())}getMinPlayGap(){return this.minPlayGapMs}setPlaybackMode(e,n="shops"){if(n==="weather"){if(this.weatherMode===e)return;this.weatherMode=e}else if(n==="pets"){if(this.petMode===e)return;this.petMode=e}else{if(this.mode===e)return;this.mode=e}this.persistSettings()}getPlaybackMode(e="shops"){return e==="weather"?this.weatherMode:e==="pets"?this.petMode:this.mode}setStopRepeat(e,n="shops"){this.setStopManual(n)}setStopManual(e="shops"){if(e==="weather"){if(this.weatherStopConf.mode==="manual")return;this.weatherStopConf={mode:"manual"}}else if(e==="pets"){if(this.petStopConf.mode==="manual")return;this.petStopConf={mode:"manual"}}else{if(this.stopConf.mode==="manual")return;this.stopConf={mode:"manual"}}this.forEachLoop(e,n=>{n.baseStop={mode:"manual"}}),this.persistSettings()}setStopPurchase(e="shops"){if(e==="weather"){if(this.weatherStopConf.mode==="purchase")return;this.weatherStopConf={mode:"purchase"}}else if(e==="pets"){if(this.petStopConf.mode==="purchase")return;this.petStopConf={mode:"purchase"}}else{if(this.stopConf.mode==="purchase")return;this.stopConf={mode:"purchase"}}this.forEachLoop(e,n=>{n.baseStop={mode:"purchase"}}),this.persistSettings()}clearStopCondition(e="shops"){this.setStopManual(e)}setLoopInterval(e,n="shops"){let r=Math.max(150,e|0);if(n==="weather"){if(this.weatherLoopIntervalMs===r)return;this.weatherLoopIntervalMs=r}else if(n==="pets"){if(this.petLoopIntervalMs===r)return;this.petLoopIntervalMs=r}else{if(this.loopIntervalMs===r)return;this.loopIntervalMs=r}this.forEachLoop(n,o=>{o.baseLoopInterval=r}),this.persistSettings()}getLoopInterval(e="shops"){return e==="weather"?this.weatherLoopIntervalMs:e==="pets"?this.petLoopIntervalMs:this.loopIntervalMs}setPurchaseChecker(e){this.purchaseChecker=e}getPlaybackSettings(e="shops"){let n=this.getVolume(e),r=this.getPlaybackMode(e),s=(e==="weather"?this.weatherStopConf:e==="pets"?this.petStopConf:this.stopConf).mode==="purchase"?{mode:"purchase"}:{mode:"manual"},a=this.getLoopInterval(e),i=this.getDefaultSoundName(e);return{enabled:this.enabled,volume:n,minPlayGapMs:this.minPlayGapMs,mode:r,stop:s,loopIntervalMs:a,primed:this.primed,defaultSoundName:i,hasLegacyDefault:!!this.defaultSoundDataUrl,librarySize:this.library.size,libraryNames:this.listSounds()}}async notify(e="shops"){let n=this.resolveToDataUrl(null,e);await this.playOnce(n,this.getVolume(e),e)}async playNotify(e="shops"){await this.notify(e)}async trigger(e="global",n={},r="shops"){let o=m=>{if(typeof m!="string")return;let g=m.trim();return g||void 0},s=m=>m?m.mode==="purchase"?{mode:"purchase"}:m.mode==="manual"?{mode:"manual"}:m.mode==="repeat"?{mode:"manual"}:{mode:"manual"}:null,a=o(n.sound??null),i=this.getPlaybackMode(r),l=n.mode==="oneshot"||n.mode==="loop"?n.mode:i,d=(r==="weather"?this.weatherStopConf:r==="pets"?this.petStopConf:this.stopConf).mode==="purchase"?{mode:"purchase"}:{mode:"manual"},u=this.getLoopInterval(r),y=this.getVolume(r);if(l==="oneshot"){this.stopLoop(e);let m=this.resolveToDataUrl(a??null,r);this.enqueueOneshot({key:e,dataUrl:m,volume:y,context:r});return}this.stopLoop(e);let h=s(n.stop??null),f=n.loopIntervalMs!=null&&Number.isFinite(n.loopIntervalMs)?Math.max(150,Math.round(n.loopIntervalMs)):null,p={key:e,timer:null,plays:0,soundOverride:a,stopped:!1,stopOverride:h,loopIntervalOverride:f,context:r,baseStop:d,baseLoopInterval:u,volume:y};this.loops.set(e,p),this.scheduleNext(p,0)}forEachLoop(e,n){for(let r of this.loops.values())r.context===e&&n(r)}stopLoop(e="global"){let n=this.loops.get(e);n&&(n.stopped=!0,n.timer!=null&&(clearTimeout(n.timer),n.timer=null),this.loops.delete(e))}stopAllLoops(e){if(e){for(let[n,r]of this.loops)r.context===e&&this.stopLoop(n);return}for(let[n]of this.loops)this.stopLoop(n)}async prime(){try{this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext)),this.audioCtx.state==="suspended"&&await this.audioCtx.resume();let e=this.audioCtx.createOscillator(),n=this.audioCtx.createGain();n.gain.value=1e-4,e.connect(n).connect(this.audioCtx.destination),e.start(),e.stop(this.audioCtx.currentTime+.02),this.primed=!0}catch{this.primed=!0}}async importFileAsSound(e,n={}){let{name:r,maxBytes:o=200*1024,maxSeconds:s=10,bitrates:a=[48e3,32e3,2e4,12e3,8e3],maxInputBytes:i=8*1024*1024}=n,l=g=>{try{be("Audio import",g,"error").catch(()=>{})}catch{}},c=null,d=async()=>(c||(c=await this.decodeFileToBuffer(e)),c);if(!e||!(e instanceof File))throw new Error("No file provided.");let u=new Map([["mp3",new Set(["audio/mpeg","audio/mp3"])],["wav",new Set(["audio/wav","audio/x-wav","audio/wave"])],["ogg",new Set(["audio/ogg"])]]),y=(e.type||"").toLowerCase(),h=(e.name?.split(".").pop()||"").toLowerCase();if(!h||!u.has(h))throw l("Unsupported audio format. Allowed formats: MP3, WAV, OGG."),new Error(`Unsupported audio extension: ${h||"unknown"}`);let f=u.get(h);if(!y||!f.has(y))throw l("File extension and MIME type must match (MP3, WAV, OGG only)."),new Error(y?`MIME type ${y} is not valid for .${h} files.`:`Missing MIME type for .${h} files.`);if(e.size>i)throw new Error(`Input file too large (${Math.round(e.size/1024)}KB). Limit is ${Math.round(i/1024)}KB.`);if(e.size<=o){let g=await d();if(g.duration>s){let x=g.duration,E=s.toFixed(1).replace(/\.0$/,""),T=x.toFixed(1).replace(/\.0$/,"");throw l(`File duration is ${T}s (limit: ${E}s).`),new Error(`Audio duration ${T}s exceeds limit of ${E}s.`)}let S=await this.blobToDataURL(e),w=this.uniqueName(r||e.name);return this.registerSound(w,S),{name:w,dataUrl:S,bytes:e.size,wasCompressed:!1}}let p=this.chooseAudioMime();if(!(!!p&&typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(p)))throw new Error("Compression unavailable in this browser; file exceeds 200KB.");if(c=await d(),c.duration>s){let g=c.duration,S=s.toFixed(1).replace(/\.0$/,""),w=g.toFixed(1).replace(/\.0$/,"");throw l(`File duration is ${w}s (limit: ${S}s).`),new Error(`Audio duration ${w}s exceeds limit of ${S}s.`)}for(let g of a){let S=await this.recordBufferToBlob(c,p,g);if(S.size<=o){let w=await this.blobToDataURL(S),x=this.uniqueName(r||e.name);return this.registerSound(x,w),{name:x,dataUrl:w,bytes:S.size,wasCompressed:!0}}}throw l(`Unable to compress under ${Math.round(o/1024)}KB. Try a shorter clip.`),new Error(`Could not compress under ${Math.round(o/1024)}KB. Try a shorter clip.`)}async playOnce(e,n,r,o={}){if(!this.enabled)return!0;let s=Date.now();if(s-this.lastPlayTs<this.minPlayGapMs)return!1;if(this.lastPlayTs=s,!e){if(this.primed&&this.audioCtx)try{let a=this.audioCtx.createOscillator(),i=this.audioCtx.createGain();i.gain.value=n*.1,a.frequency.value=880,a.connect(i).connect(this.audioCtx.destination),a.start(),a.stop(this.audioCtx.currentTime+.06)}catch{}return!0}try{let a=new Audio;a.src=e,a.volume=n,a.muted=!this.enabled,a.crossOrigin="anonymous";let i=o?.awaitEnd===!0,l=null,c=null;i&&(l=new Promise(u=>{let y=()=>{a.removeEventListener("ended",y),a.removeEventListener("error",y),u()};c=y,a.addEventListener("ended",y),a.addEventListener("error",y)}));let d=a.play();d&&typeof d.then=="function"&&await d.catch(()=>{c?.()}),l&&await l}catch{}return!0}scheduleNext(e,n){let r=async()=>{if(e.stopped)return;let o=e.stopOverride??e.baseStop;if(o.mode==="purchase"&&this.purchaseChecker)try{if(this.purchaseChecker(e.key)){this.stopLoop(e.key);return}}catch{}let s=this.resolveToDataUrl(e.soundOverride,e.context);if(await this.playOnce(s,e.volume,e.context,{awaitEnd:!0})&&e.plays++,o.mode==="repeat"){let c=Math.max(1,o.repeats|0);if(e.plays>=c){this.stopLoop(e.key);return}}let i=e.loopIntervalOverride??e.baseLoopInterval,l=Math.max(150,i|0);e.timer=setTimeout(()=>this.scheduleNext(e,0),l)};n>0?e.timer=setTimeout(r,n):r().catch(()=>{})}enqueueOneshot(e){if(e.context==="weather"){let n=this.oneshotQueue.findIndex(r=>r.context!=="weather");n===-1?this.oneshotQueue.push(e):this.oneshotQueue.splice(n,0,e)}else this.oneshotQueue.push(e);this.scheduleOneshotProcessing()}scheduleOneshotProcessing(){if(!this.oneshotQueue.length||this.oneshotQueueTimer!=null)return;let e=Date.now()-this.lastPlayTs,n=Math.max(0,this.minPlayGapMs-e);this.oneshotQueueTimer=window.setTimeout(()=>{this.oneshotQueueTimer=null,!this.oneshotProcessing&&this.processOneshotQueue()},n)}processOneshotQueue(){if(this.oneshotProcessing||!this.oneshotQueue.length)return;let e=this.oneshotQueue.shift();this.oneshotProcessing=!0,(async()=>{let r=!1;try{r=!await this.playOnce(e.dataUrl,e.volume,e.context)}finally{this.oneshotProcessing=!1,r&&this.enqueueOneshot(e),this.scheduleOneshotProcessing()}})().catch(()=>{})}chooseAudioMime(){let e=["audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/webm","audio/ogg","audio/mp4"];for(let n of e)try{if(typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(n))return n}catch{}return null}uniqueName(e){let n=String(e||"Sound").replace(/\.[a-z0-9]+$/i,"").trim()||"Sound";if(!this.library.has(n))return n;let r=2;for(;this.library.has(`${n} (${r})`);)r++;return`${n} (${r})`}async blobToDataURL(e){return await new Promise((n,r)=>{let o=new FileReader;o.onload=()=>n(String(o.result)),o.onerror=r,o.readAsDataURL(e)})}async decodeFileToBuffer(e){let n=await e.arrayBuffer(),r=window.AudioContext||window.webkitAudioContext,o=new r;try{let s=await new Promise((a,i)=>{o.decodeAudioData(n.slice(0),a,i)});return await o.close().catch(()=>{}),s}catch{try{await o.close()}catch{}throw new Error("Failed to decode audio file.")}}async recordBufferToBlob(e,n,r){let o=window.AudioContext||window.webkitAudioContext,s=new o,a=s.createMediaStreamDestination(),i=s.createBufferSource();i.buffer=e;let l=s.createGain();l.gain.value=.9,i.connect(l).connect(a);let c=[],d=new MediaRecorder(a.stream,{mimeType:n,bitsPerSecond:r}),u=new Promise((h,f)=>{d.ondataavailable=p=>{p.data&&p.data.size&&c.push(p.data)},d.onerror=p=>f(p.error||new Error("MediaRecorder error")),d.onstop=()=>{try{h(new Blob(c,{type:n}))}catch(p){f(p)}}});d.start(),i.start(),await new Promise(h=>{i.onended=()=>h()}),d.stop();let y=await u;try{await s.close()}catch{}return y}},Ae=new mp({minPlayGapMs:1200,volume:.7});var Lb="notifier.prefs",Rb="notifier.rules",_b="notifier.weatherPrefs",Nb="notifier.loopDefaults",Wl={[me.Common]:"Common",[me.Uncommon]:"Uncommon",[me.Rare]:"Rare",[me.Legendary]:"Legendary",[me.Mythic]:"Mythical",[me.Divine]:"Divine",[me.Celestial]:"Celestial"},wk=t=>String(t??"").toLowerCase();var Db=t=>{if(!t)return"";let e=[];if(t.sound){let r=Ae.listSounds().includes(t.sound)?t.sound:t.sound.length>32?`${t.sound.slice(0,29)}\u2026`:t.sound;e.push(`Sound: ${r}`)}if(t.playbackMode==="oneshot"?e.push("Mode: One-shot"):t.playbackMode==="loop"&&e.push("Mode: Loop"),t.stopMode==="purchase"?e.push("Stop: Until purchase"):t.stopMode==="manual"&&e.push("Stop: Manual"),t.loopIntervalMs!=null){let n=Number(t.loopIntervalMs);if(Number.isFinite(n)){let r=Math.max(1,Math.round(n)),o=r/1e3,s=o>=1?`${(o>=10?Math.round(o):Math.round(o*10)/10).toFixed(o>=10?0:1)} s`:`${r} ms`;e.push(`Interval: ${s}`)}}return e.join(" \u2022 ")},Lp=(t,e)=>{if(e)return{label:"Now",title:t?new Date(t).toLocaleString():"Currently active"};if(!t)return{label:"Never",title:"Never seen"};let n=Date.now(),r=Math.max(0,n-t),o;if(r<45e3)o="Just now";else if(r<9e4)o="1 min ago";else if(r<60*60*1e3){let s=Math.round(r/6e4);o=`${s} min${s>1?"s":""} ago`}else if(r<36*60*60*1e3){let s=Math.round(r/36e5);o=`${s} hour${s>1?"s":""} ago`}else{let s=Math.round(r/864e5);o=`${s} day${s>1?"s":""} ago`}return{label:o,title:new Date(t).toLocaleString()}};var Rp=t=>JSON.stringify(t.map(e=>[e.id,e.notify?1:0,e.lastSeen||0,e.isCurrent?1:0])),qb=t=>{let e=[t.name];if(t.multiplier!=null){let n=Number(t.multiplier);if(Number.isFinite(n)){let r=Math.abs(n-Math.round(n))<.01?Math.round(n):Math.round(n*100)/100;e[0]=`${e[0]} \xD7${r}`}}return e.join(" ")},Uo=t=>{let e=typeof t=="number"?t:Number(t);return Number.isFinite(e)?e:void 0},xk=t=>{if(!t||typeof t!="object")return null;let e=typeof t.kind=="string"?t.kind.trim():"",n=e.toLowerCase(),r="unknown";(n==="weather"||n==="lunar"||n==="base")&&(r=n);let o={kind:r,rawKind:e||void 0},s=Uo(t.startWindowMin);s!==void 0&&(o.startWindowMin=s);let a=Uo(t.startWindowMax);a!==void 0&&(o.startWindowMax=a);let i=Uo(t.durationMinutes);i!==void 0&&(o.durationMinutes=i);let l=Uo(t.periodMinutes);return l!==void 0&&(o.periodMinutes=l),o},Ek=t=>{if(!Array.isArray(t))return[];let e=[];for(let n of t){if(!n||typeof n!="object")continue;let r=typeof n.name=="string"?n.name.trim():"";if(!r)continue;let o={name:r},s=Uo(n.multiplier);s!==void 0&&(o.multiplier=s);let a=typeof n.conditional=="string"?n.conditional.trim():"";a&&(o.conditional=a),e.push(o)}return e},Ob=(()=>{let t=[];for(let[e,n]of Object.entries(Dr??{})){let r=String(e||"").trim();if(!r)continue;let o=typeof n?.displayName=="string"?String(n.displayName).trim():"",s=(o||r).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\s+/g," ").trim(),a=typeof n?.atomValue=="string"?String(n.atomValue).trim():"",i=Gn(r)??Gn(o)??null,l=a||s,c=typeof n?.description=="string"?String(n.description).trim():null,d=Uo(n?.weightInCycle),u=xk(n?.cycle),y=Ek(n?.mutations);t.push({id:`Weather:${r}`,name:s||r,atomValue:a,spriteKey:i,type:l,description:c,cycle:u,weightInCycle:d??null,mutations:y})}return t})(),Fb=new Map,Bb=new Map,jl=new Map;for(let t of Ob)Fb.set(t.id,t),jl.set(t.name.toLowerCase(),t),Bb.set(t.atomValue.toLowerCase(),t),jl.set(t.id.slice(8).toLowerCase(),t);var fp=null;function Ck(){if(fp)return fp;let t=new Map;for(let[e,n]of Object.entries(De))if(n?.seed){let r=`Seed:${e}`;t.set(r,{type:"Seed",name:n.seed.name,rarity:Wl[n.seed.rarity]??n.seed.rarity})}for(let[e,n]of Object.entries(Qt)){let r=`Egg:${e}`;t.set(r,{type:"Egg",name:n.name,rarity:Wl[n.rarity]??n.rarity})}for(let[e,n]of Object.entries(Jt)){let r=`Tool:${e}`;t.set(r,{type:"Tool",name:n.name,rarity:Wl[n.rarity]??n.rarity})}for(let[e,n]of Object.entries(ut)){let r=`Decor:${e}`;t.set(r,{type:"Decor",name:n.name,rarity:Wl[n.rarity]??n.rarity})}return fp=t,t}var Jo=new Map,wr=new Map,gp=!1,Qo={},hp=!1,gn=new Map,Kl=!1,bp=new Set,Ln=Object.prototype.hasOwnProperty,vr=null,xb=null,Sp=new Set,hn=null,vp=null,wp=null;function Vo(){if(!Kl){Kl=!0,gn=new Map;try{let t=_e(Rb);if(t&&typeof t=="object")for(let[e,n]of Object.entries(t)){let r=Mk(n);r&&gn.set(String(e),r)}}catch{gn=new Map}}}function Mk(t){let e={};return Ln.call(t??{},"sound")&&(e.sound=t?.sound??null),Ln.call(t??{},"playbackMode")&&(e.playbackMode=t?.playbackMode??null),Ln.call(t??{},"stopMode")&&(e.stopMode=t?.stopMode??null),Ln.call(t??{},"stopRepeats")&&(e.stopRepeats=t?.stopRepeats??null),Ln.call(t??{},"loopIntervalMs")&&(e.loopIntervalMs=t?.loopIntervalMs??null),Gb(void 0,e)}function Eb(){if(Kl)try{let t={};for(let[e,n]of gn.entries())t[e]={...n};Oe(Rb,t)}catch{}}function _p(){if(!gp){gp=!0,wr=new Map;try{let t=_e(_b);if(t&&typeof t=="object")for(let[e,n]of Object.entries(t)){if(!e)continue;let r={};typeof n?.notify=="boolean"&&(r.notify=!!n.notify),typeof n?.lastSeen=="number"&&Number.isFinite(n.lastSeen)&&(r.lastSeen=Number(n.lastSeen)),wr.set(String(e),r)}}catch{wr=new Map}}}function Hb(){if(gp)try{let t={};for(let[e,n]of wr.entries()){let r={};n.notify&&(r.notify=!0),typeof n.lastSeen=="number"&&Number.isFinite(n.lastSeen)&&(r.lastSeen=n.lastSeen),(r.notify||r.lastSeen!=null)&&(t[e]=r)}Oe(_b,t)}catch{}}function ba(t){_p();let e=wr.get(t);if(e)return e;let n={};return wr.set(t,n),n}function Wb(){if(!hp){hp=!0,Qo={};try{let t=_e(Nb);if(t&&typeof t=="object")for(let[e,n]of Object.entries(t)){let r=e;if(r!=="shops"&&r!=="weather")continue;let s=n?.stopMode==="purchase"?"purchase":"manual",a=Number(n?.stopRepeats),i=Number.isFinite(a)?Math.max(1,Math.floor(a)):null,l=Number(n?.loopIntervalMs),c=Ae.getPlaybackSettings(r),d=Number.isFinite(l)?l:c.loopIntervalMs,u=Math.max(150,Math.floor(d||0));Qo[r]={stopMode:s,stopRepeats:i,loopIntervalMs:u}}}catch{Qo={}}}}function Ak(){if(hp)try{let t={};for(let[e,n]of Object.entries(Qo)){if(!n)continue;let r=Math.max(150,Math.floor(n.loopIntervalMs|0)),o=n.stopRepeats!=null?Math.max(1,Math.floor(n.stopRepeats|0)):null;t[e]={stopMode:n.stopMode,stopRepeats:o,loopIntervalMs:r}}Oe(Nb,t)}catch{}}function Cb(t){Wb();let e=Qo[t],n=Ae.getPlaybackSettings(t),r=Math.max(150,Math.floor(n.loopIntervalMs||0)),o=e?.loopIntervalMs,s=Math.max(150,Math.floor(o??r)),a=e?.stopMode==="purchase"?"purchase":null,i=n.stop.mode==="purchase"?"purchase":null;return t==="shops"?{stopMode:a??i??"purchase",stopRepeats:null,loopIntervalMs:s}:{stopMode:"manual",stopRepeats:null,loopIntervalMs:s}}function Tk(){vr&&Sp.forEach(t=>{try{t(vr)}catch{}})}function zl(){_p();let t=Ob.map(r=>{let o=ba(r.id),s=!!o.notify,a=typeof o.lastSeen=="number"&&Number.isFinite(o.lastSeen)?o.lastSeen:null;return{id:r.id,name:r.name,type:r.type,spriteKey:r.spriteKey,atomValue:r.atomValue,notify:s,lastSeen:a,isCurrent:r.id===hn,description:r.description,cycle:r.cycle?{...r.cycle}:null,weightInCycle:r.weightInCycle,mutations:r.mutations.map(i=>({...i}))}}),e=JSON.stringify(t.map(r=>[r.id,r.notify?1:0,r.lastSeen||0,r.isCurrent?1:0])),n=e!==xb;xb=e,vr={updatedAt:Date.now(),currentId:hn,rows:t},n&&Tk()}function Ik(t){let e={},n=gn.get(t);return n?.sound&&(e.sound=n.sound),e.mode="oneshot",e}function zb(t){if(!Fb.get(t))return;let n=Ik(t);Ae.trigger(t,n,"weather").catch(()=>{})}function Mb(t,e={}){let r=(l=>l==null?"":typeof l=="string"?l.trim():String(l||"").trim())(t);if(!e.force&&vp===r)return;let o=r.toLowerCase(),s=Bb.get(o)||jl.get(o);if(!s&&o){let l=o.replace(/\s+/g,"");s=jl.get(l)}let a=hn,i=Date.now();if(s){let l=ba(s.id);l.lastSeen=i,wr.set(s.id,l)}hn=s?.id??null,vp=r,hn&&Fe.incrementWeatherStat(hn.replace("Weather:","")),a&&a!==hn&&Ae.stopLoop(a),s&&ba(s.id).notify&&zb(s.id),s&&Hb(),zl()}function kk(t,e){return!t&&!e?!0:!t||!e?!1:t.sound===e.sound&&t.playbackMode===e.playbackMode&&t.stopMode===e.stopMode&&t.loopIntervalMs===e.loopIntervalMs}function Pk(t){if(typeof t!="string")return;let e=t.trim();return e||void 0}function Lk(t){if(t==null)return;let e=String(t);return e==="oneshot"||e==="loop"?e:void 0}function Rk(t){if(t==null)return;if(String(t)==="purchase")return"purchase"}function _k(t){if(t==null)return;let e=Number(t);if(!Number.isFinite(e))return;let n=Math.max(150,Math.floor(e));return n>=150?n:void 0}function Gb(t,e){let n={...t??{}};if(Ln.call(e,"sound")){let r=Pk(e.sound);r?n.sound=r:delete n.sound}if(Ln.call(e,"playbackMode")){let r=Lk(e.playbackMode);r?n.playbackMode=r:delete n.playbackMode}if(Ln.call(e,"stopMode")){let r=Rk(e.stopMode);r?n.stopMode=r:delete n.stopMode,delete n.stopRepeats}if(Ln.call(e,"stopRepeats")&&delete n.stopRepeats,Ln.call(e,"loopIntervalMs")){let r=_k(e.loopIntervalMs);r!=null?n.loopIntervalMs=r:delete n.loopIntervalMs}return Object.keys(n).length?n:null}function xp(){Vo();let t={};for(let[e,n]of gn.entries())t[e]={...n.sound?{sound:n.sound}:{},...n.playbackMode?{playbackMode:n.playbackMode}:{},...n.stopMode?{stopMode:n.stopMode}:{},...n.loopIntervalMs!=null?{loopIntervalMs:n.loopIntervalMs}:{}};return t}function Ab(){if(!Kl)return;let t=xp();bp.forEach(e=>{try{e(t)}catch{}})}function Nk(){try{let t=_e(Lb)??{},e=new Map;if(t&&typeof t=="object")for(let[n,r]of Object.entries(t)){let s=(Number(r)|0)&1;n&&s!==void 0&&e.set(String(n),s)}Jo=e}catch{Jo=new Map}}function Dk(){try{let t={};for(let[e,n]of Jo)t[e]=n&1;Oe(Lb,t)}catch{}}var ha=t=>(Jo.get(t)??0)&1,yp=(t,e)=>{if(!t)return;let n=e&1;n?Jo.set(t,n):Jo.delete(t),Dk(),Ub()},Yo=new Map,Tb="",sn=null,Ep=null,Cp=null,Mp=new Set,Ap=new Map,Tp=null,qk={Shovel:1,WateringCan:99};function Gl(t){let e=qk[t];return e?(Ap.get(t)||0)>=e:!1}function Ib(t){try{let e=Array.isArray(t)?t:[];Ap=new Map(e.map(n=>[String(n.toolId),Number(n.quantity)||0]))}catch{Ap=new Map}Ub()}function Ok(){let t=ce;return t.inventory?.myToolInventory??t.shop?.myToolInventory??t.myToolInventoryAtom??null}function Fk(t){return t.slice().sort().join("|")}var Ip=new Set;function jb(t){let e=n=>({createdAt:Number(n?.createdAt)||0,purchases:n?.purchases&&typeof n.purchases=="object"?n.purchases:{}});return{seed:e(t?.seed),egg:e(t?.egg),tool:e(t?.tool),decor:e(t?.decor)}}function kb(t){let e=jb(t);Ip.forEach(n=>{try{n(e)}catch{}})}var kp=new Set;function Kb(t){let e=n=>({inventory:Array.isArray(n?.inventory)?n.inventory:[],secondsUntilRestock:Number(n?.secondsUntilRestock)||0});return{seed:e(t?.seed),egg:e(t?.egg),tool:e(t?.tool),decor:e(t?.decor)}}function Pb(t){let e=Kb(t);kp.forEach(n=>{try{n(e)}catch{}})}function Ul(t){let e=Ck(),n=[{key:"seed",type:"Seed"},{key:"egg",type:"Egg"},{key:"tool",type:"Tool"},{key:"decor",type:"Decor"}],r=new Set;for(let{key:c,type:d}of n){let u=t?.[c]??{},y=Array.isArray(u?.inventory)?u.inventory:[];for(let h of y){let f=d==="Seed"?`Seed:${h.species}`:d==="Egg"?`Egg:${h.eggId}`:d==="Tool"?`Tool:${h.toolId}`:`Decor:${h.decorId}`;r.add(f);let p=e.get(f),g=!!(ha(f)&1),S={id:f,type:d,name:p?.name??f.split(":")[1]??f,rarity:p?.rarity,popup:g,followed:g};Yo.set(f,S)}}for(let c of Array.from(Yo.keys()))r.has(c)||Yo.delete(c);let o=Array.from(Yo.values()),s=o.reduce((c,d)=>c+(d.followed?1:0),0),a={updatedAt:Date.now(),rows:o,counts:{items:o.length,followed:s}},i=Fk(o.map(c=>c.id)),l=i!==Tb;sn=a,l&&(Tb=i,Vb())}function Ub(){if(!sn)return;for(let[n,r]of Yo){let s=!!(ha(n)&1);if(n.startsWith("Tool:")){let a=n.slice(5);Gl(a)&&(s=!1)}r.popup=s,r.followed=s}let t=Array.from(Yo.values()),e=t.reduce((n,r)=>n+(r.followed?1:0),0);sn={...sn,updatedAt:Date.now(),rows:t,counts:{items:t.length,followed:e}},Vb()}function Vb(){if(!sn)return;let t={...sn,rows:sn.rows.slice()};Mp.forEach(e=>{try{e(t)}catch{}})}var Pp=!1;async function Sr(){if(!Pp){Pp=!0,Nk(),Vo();try{let t=await ce.shop.shops.get();Ul(t),Pb(t)}catch{}try{Ep=await ce.shop.shops.onChange(t=>{try{Ul(t)}catch{}try{Pb(t)}catch{}})}catch{}try{let t=await ce.shop.myShopPurchases.get();kb(t)}catch{}try{Cp=await ce.shop.myShopPurchases.onChange(t=>{try{kb(t)}catch{}})}catch{}try{let t=Ok();if(t){try{Ib(await t.get())}catch{}try{Tp=await t.onChange(e=>{try{Ib(e)}catch{}})}catch{}}}catch{}try{let t=ce.data?.weather;if(t){try{Mb(await t.get(),{force:!0})}catch{}try{wp=await t.onChange(e=>{try{Mb(e)}catch{}})}catch{}}}catch{}}}function Bk(){try{Ep?.()}catch{}Ep=null;try{Cp?.()}catch{}Cp=null;try{Tp?.()}catch{}Tp=null;try{wp?.()}catch{}if(wp=null,hn)try{Ae.stopLoop(hn)}catch{}hn=null,vp=null,Pp=!1}var We={async start(){return await Sr(),()=>Bk()},async get(){return await Sr(),sn||Ul(await ce.shop.shops.get().catch(()=>null)),sn},onChange(t){return Mp.add(t),()=>{Mp.delete(t)}},async onChangeNow(t){if(await Sr(),sn)t(sn);else{try{Ul(await ce.shop.shops.get())}catch{}sn&&t(sn)}return this.onChange(t)},onShopsChange(t){return kp.add(t),()=>{kp.delete(t)}},async onShopsChangeNow(t){await Sr();try{t(Kb(await ce.shop.shops.get()))}catch{}return this.onShopsChange(t)},onPurchasesChange(t){return Ip.add(t),()=>{Ip.delete(t)}},async onPurchasesChangeNow(t){await Sr();try{t(jb(await ce.shop.myShopPurchases.get()))}catch{}return this.onPurchasesChange(t)},async getWeatherState(){return await Sr(),vr||zl(),vr},onWeatherChange(t){return Sp.add(t),()=>{Sp.delete(t)}},async onWeatherChangeNow(t){return await Sr(),vr||zl(),vr&&t(vr),this.onWeatherChange(t)},getWeatherNotify(t){return t?!!ba(t).notify:!1},setWeatherNotify(t,e){if(!t)return;_p();let n=ba(t),r=!!e;if(!!n.notify!==r){if(n.notify=r,wr.set(t,n),Hb(),r)hn===t&&zb(t);else try{Ae.stopLoop(t)}catch{}zl()}},getContextStopDefaults(t){return Cb(t)},setContextStopDefaults(t,e){if(t!=="shops"&&t!=="weather")return;Wb();let n=Cb(t),r=Number(e?.loopIntervalMs),o=Number.isFinite(r)?Math.max(150,Math.floor(r)):n.loopIntervalMs,s=e.stopMode==="purchase"?"purchase":"manual",a={stopMode:t==="weather"?"manual":s,stopRepeats:null,loopIntervalMs:o};Qo[t]=a,Ak()},getPref(t){if(t.startsWith("Tool:")){let r=t.slice(5);if(Gl(r))return{popup:!1,followed:!1}}let n=!!(ha(t)&1);return{popup:n,followed:n}},setPopup(t,e){if(e&&t.startsWith("Tool:")&&Gl(t.slice(5)))return;let n=ha(t),r=e?n|1:n&-2;yp(t,r)},setPrefs(t,e){let r=ha(t);typeof e.popup=="boolean"&&(r=e.popup?r|1:r&-2),yp(t,r)},clearPrefs(t){yp(t,0)},isIdCapped(t){return t.startsWith("Tool:")?Gl(t.slice(5)):!1},filterRows(t,e){let n=t.slice(),r=e.type??"all";r&&r!=="all"&&(n=n.filter(s=>s.type.toLowerCase()===r));let o=e.rarity??"all";return o!=="all"&&(n=n.filter(s=>wk(s.rarity)===o)),n},getRule(t){if(!t)return null;Vo();let e=gn.get(t);return e?{...e.sound?{sound:e.sound}:{},...e.playbackMode?{playbackMode:e.playbackMode}:{},...e.stopMode?{stopMode:e.stopMode}:{},...e.loopIntervalMs!=null?{loopIntervalMs:e.loopIntervalMs}:{}}:null},getAllRules(){return xp()},setRule(t,e){if(!t||!e||typeof e!="object")return;Vo();let n=gn.get(t),r=Gb(n,e);kk(n,r)||(r?gn.set(t,r):gn.delete(t),Eb(),Ab())},clearRule(t){if(!t)return;Vo(),gn.delete(t)&&(Eb(),Ab())},onRulesChange(t){return Vo(),bp.add(t),()=>{bp.delete(t)}},async onRulesChangeNow(t){return await Sr(),t(xp()),this.onRulesChange(t)}};function Yb(t,e=De){let n=e?.[t];return n?.seed?.name??n?.plant?.name??n?.crop?.name??void 0}function Qb(t,e=Qt){return e?.[t]?.name??void 0}function Jb(t,e=Jt){return e?.[t]?.name??void 0}function $b(t,e=ut){return e?.[t]?.name??void 0}var bn=(t,e)=>Object.assign(t.style,e),Np=(t,e)=>{for(let[n,r]of Object.entries(e))t.style.setProperty(n,r)};function Hk(t,e=24){let n=document.createElement("div");Object.assign(n.style,{width:`${e}px`,height:`${e}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",flex:`0 0 ${e}px`});let[r,o]=t.split(":"),s=r==="Seed"||r==="Egg"||r==="Tool"||r==="Decor"?r:null,a=s==="Seed"?"\u{1F331}":s==="Egg"?"\u{1F95A}":s==="Tool"?"\u{1F9F0}":s==="Decor"?"\u{1F3E0}":"\u{1F514}";if(s&&o){let i=Tt(s,o,{size:e,fallback:a,alt:Xb(t)});n.appendChild(i)}else{let i=document.createElement("span");i.textContent=a,i.style.fontSize=`${Math.max(10,e-2)}px`,i.setAttribute("aria-hidden","true"),n.appendChild(i)}return n}function Xb(t){let[e,n]=t.split(":");switch(e){case"Seed":return Yb(n)??n;case"Egg":return Qb(n)??n;case"Tool":return Jb(n)??n;case"Decor":return $b(n)??n;default:return n}}function Zb(t,e){if(!e)return 0;let[n,r]=String(t).split(":"),o=n==="Seed"?e.seed:n==="Egg"?e.egg:n==="Tool"?e.tool:e.decor;if(!o||!o.purchases)return 0;let s=o.purchases[r];return typeof s=="number"&&s>0?s:0}var Dp=class{constructor(){pe(this,"slot",document.createElement("div"));pe(this,"btn",document.createElement("button"));pe(this,"badge",document.createElement("span"));pe(this,"panel",document.createElement("div"));pe(this,"bellWrap",document.createElement("div"));pe(this,"lastShops",null);pe(this,"lastPurch",null);pe(this,"prevOverlayIds",new Set);pe(this,"currentOverlayIds",new Set);pe(this,"rulesById",new Map);pe(this,"shopUpdates",0);pe(this,"purchasesUpdates",0);pe(this,"bootArmed",!1);pe(this,"justRestocked",!1);pe(this,"mo",null);pe(this,"rows",[]);pe(this,"lastPanelSig",null);this.slot=this.createSlot(),this.btn=this.createButton(),this.ensureBellCSS(),this.badge=this.createBadge(),this.panel=this.createPanel(),this.installScrollGuards(this.panel);let e=!1;this.btn.onclick=async()=>{if(!e){e=!0;try{await Ae.prime()}catch{}}let n=this.panel.style.display!=="block";this.panel.style.display=n?"block":"none",n&&this.renderPanel(),this.updateBellWiggle()},this.slot.append(this.btn,this.badge,this.panel),this.attachLeftOfTargetCanvas(),this.observeDomForRelocation(),window.addEventListener("pointerdown",n=>{if(this.panel.style.display!=="block")return;let r=n.target;this.slot.contains(r)||(this.panel.style.display="none")}),Ae.setPurchaseChecker(n=>!n||this.currentOverlayIds.has(n)?!1:Zb(n,this.lastPurch)>0)}destroy(){try{this.mo?.disconnect()}catch{}try{this.slot.remove()}catch{}try{Ae.stopAllLoops()}catch{}}ensureBellCSS(){if(document.getElementById("qws-bell-anim-css"))return;let e=document.createElement("style");e.id="qws-bell-anim-css",e.textContent=`
@keyframes qwsBellShake {
  0% { transform: rotate(0deg); }
  10% { transform: rotate(-16deg); }
  20% { transform: rotate(12deg); }
  30% { transform: rotate(-10deg); }
  40% { transform: rotate(8deg); }
  50% { transform: rotate(-6deg); }
  60% { transform: rotate(4deg); }
  70% { transform: rotate(-2deg); }
  80% { transform: rotate(1deg); }
  100% { transform: rotate(0deg); }
}

/* Classe appliqu\xE9e sur le span cloche quand il y a des items dans l'overlay */
.qws-bell--wiggle {
  animation: qwsBellShake 1.2s ease-in-out infinite;
  transform-origin: 50% 0%;
  display: inline-block;
}

/* Respecte l'accessibilit\xE9 */
@media (prefers-reduced-motion: reduce) {
  .qws-bell--wiggle { animation: none !important; }
}
`,document.head.appendChild(e)}setShops(e){let n=this.lastShops;this.lastShops=e,this.shopUpdates++,this.justRestocked=!!(n&&((n.seed?.secondsUntilRestock??0)<(e.seed?.secondsUntilRestock??0)||(n.tool?.secondsUntilRestock??0)<(e.tool?.secondsUntilRestock??0)||(n.egg?.secondsUntilRestock??0)<(e.egg?.secondsUntilRestock??0)||(n.decor?.secondsUntilRestock??0)<(e.decor?.secondsUntilRestock??0))),this.recompute()}setPurchases(e){this.lastPurch=e,this.purchasesUpdates++,this.recompute()}notifyStateUpdated(){this.recompute()}setRules(e){this.rulesById.clear();for(let[n,r]of Object.entries(e))!n||!r||this.rulesById.set(n,{...r});this.refreshActiveLoops()}buildTriggerOverrides(e){if(!e)return null;let n={};return e.sound&&(n.sound=e.sound),(e.playbackMode==="loop"||e.playbackMode==="oneshot")&&(n.mode=e.playbackMode),e.stopMode==="purchase"?n.stop={mode:"purchase"}:e.stopMode==="manual"&&(n.stop={mode:"manual"}),e.loopIntervalMs!=null&&Number.isFinite(e.loopIntervalMs)&&(n.loopIntervalMs=Math.max(150,Math.floor(Number(e.loopIntervalMs)))),Object.keys(n).length?n:null}triggerMany(e){let n=[];for(let o of e){let s=this.buildTriggerOverrides(this.rulesById.get(o))??{},a=this.resolvePlaybackMode(o),i=s.sound?`sound:${s.sound.trim().toLowerCase()}`:"sound:__default__";n.push({id:o,overrides:s,mode:a,soundKey:i})}if(!n.length)return;let r=new Map;for(let o of n){let s=r.get(o.soundKey)??{loops:[],oneshots:[]};o.mode==="loop"?s.loops.push(o):s.oneshots.push(o),r.set(o.soundKey,s)}for(let{loops:o,oneshots:s}of r.values()){if(o.length){for(let a of o)Ae.trigger(a.id,a.overrides,"shops").catch(()=>{});continue}if(s.length){let a=s[0];Ae.trigger(a.id,a.overrides,"shops").catch(()=>{})}}}triggerWithRule(e){this.triggerMany([e])}resolvePlaybackMode(e){let n=this.rulesById.get(e),r=Ae.getPlaybackMode("shops");return n?n.playbackMode==="loop"?"loop":n.playbackMode==="oneshot"?"oneshot":(n.stopMode||n.loopIntervalMs!=null)&&r==="loop"?"loop":r:r}refreshActiveLoops(){if(!this.currentOverlayIds.size)return;let e=[];for(let n of this.currentOverlayIds)this.resolvePlaybackMode(n)==="loop"&&(Ae.stopLoop(n),e.push(n));e.length&&this.triggerMany(e)}async recompute(){if(!this.lastShops||!this.lastPurch)return;let e=[],n=(i,l)=>{if(!(We.getPref?.(i)||{}).popup)return;let d=Zb(i,this.lastPurch),u=Math.max(l-d,0);u>0&&e.push({id:i,qty:u})};for(let i of this.lastShops.seed.inventory)n(`Seed:${i.species}`,i.initialStock);for(let i of this.lastShops.tool.inventory)n(`Tool:${i.toolId}`,i.initialStock);for(let i of this.lastShops.egg.inventory)n(`Egg:${i.eggId}`,i.initialStock);for(let i of this.lastShops.decor.inventory)n(`Decor:${i.decorId}`,i.initialStock);this.rows=e,this.renderBadge(),this.panel.style.display==="block"&&this.renderPanel(),this.updateBellWiggle();let r=new Set(e.map(i=>i.id));this.currentOverlayIds=r;let o=(this.lastShops.seed?.inventory?.length??0)+(this.lastShops.tool?.inventory?.length??0)+(this.lastShops.egg?.inventory?.length??0)+(this.lastShops.decor?.inventory?.length??0)===0,s=this.shopUpdates>=3&&this.purchasesUpdates>=2&&!o;if(!this.bootArmed){if(!s){this.prevOverlayIds=r;return}this.bootArmed=!0,r.size>0&&this.triggerMany(r),this.prevOverlayIds=r,this.justRestocked=!1;return}if(r.size===0){Ae.stopAllLoops(),this.prevOverlayIds=r,this.justRestocked=!1;return}if(this.justRestocked){this.triggerMany(r);for(let i of this.prevOverlayIds)r.has(i)||Ae.stopLoop(i);this.prevOverlayIds=r,this.justRestocked=!1;return}let a=[];for(let i of r)this.prevOverlayIds.has(i)||a.push(i);a.length&&this.triggerMany(a);for(let i of this.prevOverlayIds)r.has(i)||Ae.stopLoop(i);this.prevOverlayIds=r,this.justRestocked=!1}renderBadge(){let e=this.rows.length;this.badge.textContent=e?String(e):"",bn(this.badge,{display:e?"inline-flex":"none"})}resolveShopItem(e){if(!this.lastShops)return null;let[n,r]=String(e).split(":");if(!n||!r)return null;if(n==="Seed"){let o=this.lastShops.seed?.inventory?.find(s=>String(s.species)===r);return o?{kind:"seeds",item:o}:null}if(n==="Tool"){let o=this.lastShops.tool?.inventory?.find(s=>String(s.toolId)===r);return o?{kind:"tools",item:o}:null}if(n==="Egg"){let o=this.lastShops.egg?.inventory?.find(s=>String(s.eggId)===r);return o?{kind:"eggs",item:o}:null}if(n==="Decor"){let o=this.lastShops.decor?.inventory?.find(s=>String(s.decorId)===r);return o?{kind:"decor",item:o}:null}return null}async handleBuyClick(e,n){let r=this.resolveShopItem(e);if(!r){n.disabled=!0;return}n.disabled=!0;let o=n.textContent;n.textContent="Buying...";try{await Promise.resolve(tt.buyOne(r.kind,r.item))}catch{}finally{n.textContent=o||"Buy",n.disabled=!1}}async handleBuyAllClick(e,n){let r=this.resolveShopItem(e);if(!r){n.disabled=!0;return}let o=this.rows.find(a=>a.id===e)?.qty??0;if(o<=0){n.disabled=!0;return}n.disabled=!0;let s=n.textContent;n.textContent="Buying...";try{for(let a=0;a<o;a++)await Promise.resolve(tt.buyOne(r.kind,r.item))}catch{}finally{n.textContent=s||"Buy all",n.disabled=!1}}renderPanel(){let e=JSON.stringify(this.rows.map(r=>[r.id,r.qty]));if(e===this.lastPanelSig)return;this.lastPanelSig=e,this.panel.replaceChildren();let n=document.createElement("div");if(n.textContent="Tracked items available",bn(n,{fontWeight:"700",opacity:"0.9",padding:"4px 2px",borderBottom:"1px solid var(--qws-border-2, #ffffff14)",marginBottom:"4px"}),this.panel.appendChild(n),!this.rows.length){let r=document.createElement("div");r.textContent="No tracked items are available.",bn(r,{opacity:"0.75",padding:"8px 2px"}),this.panel.appendChild(r);return}for(let r of this.rows){let o=document.createElement("div");Object.assign(o.style,{display:"grid",gridTemplateColumns:"24px 1fr max-content max-content max-content",alignItems:"center",gap:"8px",padding:"6px 4px",borderBottom:"1px solid var(--qws-border-2, #ffffff14)"});let s=Hk(r.id,24),a=document.createElement("div");a.textContent=Xb(r.id),Object.assign(a.style,{fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"var(--qws-text, #e7eef7)"});let i=document.createElement("div");i.textContent=`\xD7${r.qty}`,Object.assign(i.style,{fontVariantNumeric:"tabular-nums",opacity:"0.9",color:"var(--qws-text-dim, #b9c3cf)",textAlign:"right"});let l=document.createElement("button");l.type="button",l.textContent="Buy",Object.assign(l.style,{padding:"4px 10px",borderRadius:"10px",border:"1px solid var(--qws-border, #ffffff33)",background:"var(--qws-accent, #7aa2ff)",color:"#0b1017",fontWeight:"700",cursor:"pointer",fontSize:"12px",boxShadow:"var(--qws-shadow, 0 6px 18px rgba(0,0,0,.35))",transition:"filter 120ms ease, transform 120ms ease"}),l.onmouseenter=()=>{l.style.filter="brightness(1.05)"},l.onmouseleave=()=>{l.style.filter="",l.style.transform=""},l.onmousedown=()=>{l.style.transform="translateY(1px)"},l.onmouseup=()=>{l.style.transform=""},l.onclick=d=>{d.stopPropagation(),this.handleBuyClick(r.id,l)},this.resolveShopItem(r.id)||(l.disabled=!0,l.style.opacity="0.6",l.style.cursor="not-allowed",l.title="Unavailable");let c=document.createElement("button");c.type="button",c.textContent="Buy all",Object.assign(c.style,{padding:"4px 10px",borderRadius:"10px",border:"1px solid var(--qws-border, #ffffff33)",background:"var(--qws-panel, #111823cc)",color:"var(--qws-text, #e7eef7)",fontWeight:"700",cursor:"pointer",fontSize:"12px",boxShadow:"var(--qws-shadow, 0 6px 18px rgba(0,0,0,.35))",transition:"filter 120ms ease, transform 120ms ease"}),c.onmouseenter=()=>{c.style.filter="brightness(1.08)"},c.onmouseleave=()=>{c.style.filter="",c.style.transform=""},c.onmousedown=()=>{c.style.transform="translateY(1px)"},c.onmouseup=()=>{c.style.transform=""},c.onclick=d=>{d.stopPropagation(),this.handleBuyAllClick(r.id,c)},this.resolveShopItem(r.id)||(c.disabled=!0,c.style.opacity="0.6",c.style.cursor="not-allowed",c.title="Unavailable"),o.append(s,a,i,l,c),this.panel.appendChild(o)}}createSlot(){let e=document.createElement("div");return bn(e,{position:"relative",display:"inline-flex",alignItems:"center",marginRight:"0",pointerEvents:"auto",fontFamily:"var(--chakra-fonts-body, GreyCliff CF), system-ui, sans-serif",color:"var(--chakra-colors-chakra-body-text, #e7eef7)",userSelect:"none"}),Np(e,{"-webkit-font-smoothing":"antialiased","-webkit-text-size-adjust":"100%","text-rendering":"optimizeLegibility"}),e}createButton(){let e=document.createElement("button");e.type="button",e.setAttribute("aria-label","Notifications");let n=document.createElement("span");return n.className="qws-bell",n.textContent="\u{1F514}",n.setAttribute("aria-hidden","true"),this.bellWrap=document.createElement("div"),this.bellWrap.className="qws-bell-wrap",this.bellWrap.appendChild(n),this.applyFallbackButtonStyles(),e.appendChild(this.bellWrap),e.addEventListener("mouseenter",()=>{e.hasAttribute("style")&&(e.style.borderColor="var(--qws-accent, #7aa2ff)")}),e.addEventListener("mouseleave",()=>{e.hasAttribute("style")&&(e.style.borderColor="var(--chakra-colors-chakra-border-color, #ffffff33)")}),e}updateBellWiggle(){let e=this.btn.querySelector(".qws-bell");if(!e)return;let n=this.rows.length>0&&this.panel.style.display!=="block";e.classList.toggle("qws-bell--wiggle",n)}createBadge(){let e=document.createElement("span");return bn(e,{position:"absolute",top:"-6px",right:"-6px",minWidth:"18px",height:"18px",padding:"0 6px",borderRadius:"999px",background:"var(--chakra-colors-Red-Magic, #D02128)",color:"var(--chakra-colors-Neutral-TrueWhite, #fff)",fontSize:"12px",fontWeight:"700",display:"none",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,.35)",lineHeight:"18px",pointerEvents:"none"}),e}createPanel(){let e=document.createElement("div");return e.setAttribute("role","dialog"),e.setAttribute("aria-label","Tracked items available"),bn(e,{position:"absolute",top:"calc(100% + var(--chakra-space-2, 0.5rem))",right:"0",width:"min(280px, 70vw)",maxHeight:"50vh",overflow:"auto",overscrollBehavior:"contain",touchAction:"pan-y",borderRadius:"var(--chakra-radii-card, 12px)",border:"1px solid var(--qws-border, #ffffff22)",background:"var(--qws-panel, #111823cc)",backdropFilter:"blur(var(--qws-blur, 8px))",color:"var(--qws-text, #e7eef7)",boxShadow:"var(--qws-shadow, 0 10px 36px rgba(0,0,0,.45))",padding:"8px",display:"none",zIndex:"var(--chakra-zIndices-DialogModal, 7010)"}),Np(e,{"-webkit-backdrop-filter":"blur(var(--qws-blur, 8px))"}),e}installScrollGuards(e){let n=r=>{r.stopPropagation()};e.addEventListener("wheel",n,{passive:!0,capture:!0}),e.addEventListener("mousewheel",n,{passive:!0,capture:!0}),e.addEventListener("DOMMouseScroll",n,{passive:!0,capture:!0}),e.addEventListener("touchmove",n,{passive:!0,capture:!0})}findTargetCanvas(){try{let e=document.querySelector("span[tabindex] canvas");return e||(Array.from(document.querySelectorAll("canvas")).map(o=>({c:o,r:o.getBoundingClientRect()})).filter(({r:o})=>o.width<=512&&o.height<=512&&o.top<300).sort((o,s)=>o.r.left-s.r.left||o.r.top-s.r.top)[0]?.c??null)}catch{return null}}closestFlexWithEnoughChildren(e,n=3){let r=e;for(;r&&r.parentElement;){let o=r.parentElement;if(getComputedStyle(o).display.includes("flex")&&o.children.length>=n)return o;r=o}return null}findToolbarContainer(){try{let e=document.querySelector(".McFlex.css-13izacw");if(e)return e;let n=document.querySelector('button[aria-label="Chat"]'),r=n?this.closestFlexWithEnoughChildren(n):null;if(r)return r;let o=this.findTargetCanvas();if(o){let s=this.closestFlexWithEnoughChildren(o);if(s)return s;let a=this.findAnchorBlockFromCanvas(o);if(a&&a.parentElement)return a.parentElement}return null}catch{return null}}applyFallbackButtonStyles(){this.btn.className="",bn(this.btn,{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",height:"36px",padding:"0 12px",borderRadius:"var(--chakra-radii-button, 50px)",border:"1px solid var(--chakra-colors-chakra-border-color, #ffffff33)",background:"var(--qws-panel, #111823cc)",backdropFilter:"blur(var(--qws-blur, 8px))",color:"var(--qws-text, #e7eef7)",boxShadow:"var(--qws-shadow, 0 10px 36px rgba(0,0,0,.45))",cursor:"pointer",transition:"border-color var(--chakra-transition-duration-fast,150ms) ease",outline:"none",position:"relative"}),Np(this.btn,{"-webkit-backdrop-filter":"blur(var(--qws-blur, 8px))","-webkit-tap-highlight-color":"transparent"}),this.bellWrap.className="qws-bell-wrap",bn(this.bellWrap,{display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",height:"100%"})}applyToolbarLook(e){let n=e?.querySelector("button.chakra-button");if(!n)return;this.btn.className=n.className,this.btn.removeAttribute("style"),this.btn.removeAttribute("data-focus-visible-added");let r=n.querySelector("div");r&&(this.bellWrap.className=r.className,this.bellWrap.removeAttribute("style")),bn(this.bellWrap,{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}),bn(this.btn,{position:"relative"})}findAnchorBlockFromCanvas(e){try{let n=e.closest("span[tabindex]");if(n&&n.parentElement)return n.parentElement;let r=e;for(;r&&r.parentElement;){let o=r.parentElement;if(getComputedStyle(o).display.includes("flex")&&o.children.length<=3)return o;r=o}return null}catch{return null}}insertLeftOf(e,n){let r=e.parentElement;if(!r||!e.isConnected||!r.isConnected)return;let o=getComputedStyle(r),s=o.display.includes("flex"),a=o.flexDirection||"row";try{s&&a.startsWith("row")&&a.endsWith("reverse")?n!==e.nextSibling&&r.insertBefore(n,e.nextSibling):r.insertBefore(n,e)}catch{}}attachLeftOfTargetCanvas(){try{let e=this.findToolbarContainer();if(e&&e.isConnected){this.applyToolbarLook(e),(this.slot.parentElement!==e||this.slot.nextElementSibling)&&e.appendChild(this.slot);return}let n=this.findTargetCanvas(),r=n?this.findAnchorBlockFromCanvas(n):null;if(!r||!r.parentElement||!r.isConnected){let o=document.getElementById("qws-notifier-fallback");o||(o=document.createElement("div"),o.id="qws-notifier-fallback",bn(o,{position:"fixed",zIndex:"var(--chakra-zIndices-PresentableOverlay, 5100)",top:"calc(10px + var(--sait, 0px))",right:"calc(10px + var(--sair, 0px))"}),document.body.appendChild(o)),this.applyFallbackButtonStyles(),o.contains(this.slot)||o.appendChild(this.slot);return}this.applyFallbackButtonStyles(),(this.slot.parentElement!==r.parentElement||this.slot.nextElementSibling!==r&&r.previousElementSibling!==this.slot)&&this.insertLeftOf(r,this.slot)}catch{}}observeDomForRelocation(){try{this.mo?.disconnect(),this.mo=new MutationObserver(()=>this.attachLeftOfTargetCanvas()),this.mo.observe(document.body,{childList:!0,subtree:!0}),this.attachLeftOfTargetCanvas()}catch{}}};async function eS(){let t=new Dp,e=await We.onPurchasesChangeNow(s=>t.setPurchases(s)),n=await We.onShopsChangeNow(s=>t.setShops(s)),r=await We.onChangeNow(()=>t.notifyStateUpdated()),o=await We.onRulesChangeNow(s=>t.setRules(s));window.__qws_cleanup_notifier=()=>{try{n()}catch{}try{e()}catch{}try{r()}catch{}try{o()}catch{}try{t.destroy()}catch{}}}var Wk=["plant","egg","tool","decor"],en="romann-buyall-btn",tS="tm-buyall-css",Zo="div.McFlex.css-1kkwxjt",oS="div.McFlex.css-1lfov12",sS="div.McFlex.css-b9riu6",Bp="data-tm-shop-index",zk=20;var Gk={plant:ce.shop.seedShop,egg:ce.shop.eggShop,tool:ce.shop.toolShop,decor:ce.shop.decorShop},jk={seedShop:"plant",eggShop:"egg",toolShop:"tool",decorShop:"decor"},aS={},Kk={},Sa=!1,Uk={};async function Vk(){try{let t=await ce.ui.activeModal.get();if(console.log("[TM][BuyAll] activeModal =",t),typeof t!="string"||!t)return null;let e=jk[t]??null;return console.log("[TM][BuyAll] mapped modal -> shop =",{modalId:t,shop:e}),e}catch(t){return console.warn("[TM][BuyAll] failed to read active modal",t),null}}function Yk(t,e){return e?t==="plant"?e?.species?String(e.species):null:t==="egg"?e?.eggId?String(e.eggId):null:t==="tool"?e?.toolId?String(e.toolId):null:t==="decor"&&e?.decorId?String(e.decorId):null:null}function Qk(t,e){return e?t==="plant"?e?.species?String(e.species):null:t==="egg"?e?.eggId?String(e.eggId):null:t==="tool"?e?.toolId?String(e.toolId):null:t==="decor"&&e?.decorId?String(e.decorId):null:null}function Jk(t,e){let n=Array.isArray(e?.inventory)?e.inventory:[],r=[];for(let o of n){let s=Yk(t,o);s&&r.push({id:s,name:Qk(t,o),raw:o})}return r}function nS(t,e){let n=Jk(t,e);aS[t]=n,Kk[t]=n.length}async function $k(){for(let t of Wk){let e=Gk[t];if(console.log(await e.get()),!!e){if(!Sa)return;try{nS(t,await e.get())}catch(n){console.warn(`[TM] buyAll failed to fetch ${t} inventory`,n)}if(!Sa)return;try{let n=await e.onChange(r=>{nS(t,r)});if(!Sa){try{n()}catch(r){console.warn(`[TM] buyAll failed to cancel stale ${t} inventory watcher`,r)}return}Uk[t]=()=>{try{n()}catch(r){console.warn(`[TM] buyAll failed to unsubscribe ${t} inventory`,r)}}}catch(n){console.warn(`[TM] buyAll failed to subscribe to ${t} inventory`,n)}}}}function Zk(){Sa||(Sa=!0,$k().catch(t=>{console.warn("[TM] buyAll inventory init error",t)}))}function Xk(t,e){let n=aS[t];return!n||e<0||e>=n.length?null:n[e]??null}var eP={plant:t=>we.purchaseSeed(t),egg:t=>we.purchaseEgg(t),tool:t=>we.purchaseTool(t),decor:t=>we.purchaseDecor(t)};function tP(t){switch(t){case"plant":Fe.incrementShopStat("seedsBought");break;case"decor":Fe.incrementShopStat("decorBought");break;case"egg":Fe.incrementShopStat("eggsBought");break;case"tool":Fe.incrementShopStat("toolsBought");break;default:break}}async function nP(t,e,n){if(!t||!e)return;let r=eP[t];if(!r)return;let o=typeof n=="number"?Math.max(0,Math.floor(n)):0;if(!(o<=0))for(let s=0;s<o;s+=1)try{await r(e),tP(t)}catch(a){console.warn("[TM] buyAll purchase failed",{shop:t,itemId:e,attempt:s+1,error:a});break}}function rP(t){if(!t)return;let e=t.replace(/\u00A0|\u202F/g," ").trim(),n=/(\d{1,3}(?:[ \u00A0\u202F.,]\d{3})+|\d+(?:[.,]\d+)?)(\s*[kKmMbBtT])?/g,r,o=null,s=null;for(;r=n.exec(e);)o=r[1],s=(r[2]||"").trim().toUpperCase()||null;if(!o)return;if(s){let i=Number(o.replace(/[ \u00A0\u202F]/g,"").replace(",","."));return Number.isFinite(i)?Math.round(i*(s==="K"?1e3:s==="M"?1e6:s==="B"?1e9:s==="T"?1e12:1)):void 0}if(/[ \u00A0\u202F.,]\d{3}/.test(o)){let i=Number(o.replace(/[ \u00A0\u202F.,]/g,""));return Number.isFinite(i)?i:void 0}else{let i=Number(o.replace(",","."));return Number.isFinite(i)?Math.round(i):void 0}}var $o=null,iS=null,qp=!1,Op=!1;function oP(t,e){if(!e)return 0;let[n,r]=String(t).split(":"),o=n==="Seed"?e.seed:n==="Egg"?e.egg:n==="Tool"?e.tool:e.decor;if(!o||!o.purchases)return 0;let s=o.purchases[r];return typeof s=="number"&&s>0?s:0}function sP(t,e){if(!t||!e)return null;let n=String(e);switch(t){case"plant":return`Seed:${n}`;case"egg":return`Egg:${n}`;case"tool":return`Tool:${n}`;case"decor":return`Decor:${n}`;default:return null}}function aP(){qp||(qp=!0,We.onShopsChangeNow(t=>{$o=t}).catch(t=>{qp=!1,console.warn("[TM] buyAll notifier shops subscription failed",t)})),Op||(Op=!0,We.onPurchasesChangeNow(t=>{iS=t}).catch(t=>{Op=!1,console.warn("[TM] buyAll notifier purchases subscription failed",t)}))}function iP(t,e){if(!t||!e||!$o)return{initialStock:null};let r=(t==="plant"?$o.seed?.inventory??[]:t==="egg"?$o.egg?.inventory??[]:t==="tool"?$o.tool?.inventory??[]:$o.decor?.inventory??[]).find(a=>a?t==="plant"?String(a.species)===e:t==="egg"?String(a.eggId)===e:t==="tool"?String(a.toolId)===e:String(a.decorId)===e:!1);if(!r)return{initialStock:null};let o=Number(r.initialStock);return{initialStock:Number.isFinite(o)?o:null}}function lP(t,e){let n=sP(t,e);if(!n)return{notifierItemId:null,initialStock:null,purchased:null,remaining:null};let r=n.split(":")[1]??null,{initialStock:o}=iP(t,r);if(o==null)return{notifierItemId:n,initialStock:o,purchased:null,remaining:null};let s=oP(n,iS),a=Math.max(0,o-s);return{notifierItemId:n,initialStock:o,purchased:s,remaining:a}}function cP(t){return t?!!t.querySelector(".chakra-text.css-1ox18rb"):!1}function lS(t){let e=t.querySelectorAll(`:scope > ${Zo}`);return e.length?Array.from(e):Array.from(t.querySelectorAll(Zo))}function rS(t){if(!t)return;let n=(t.querySelector(".css-1uduba2")?.innerText??t.textContent??"").trim();return rP(n)}function dP(t){let e=t.querySelector(sS);return e||(Array.from(t.querySelectorAll("div")).find(r=>r.querySelectorAll("button.chakra-button").length>=2)??null)}function uP(){if(document.getElementById(tS))return;let t=`
    .${en}{
      background: var(--chakra-colors-Blue-Magic, #0067B4) !important;
      border-color: var(--chakra-colors-Blue-Dark, #264093) !important;
      color: #fff !important;
      border-width: 2px;
      border-radius: 5px;
      text-transform: uppercase;
      height: 40px;
      padding-inline: 24px;
      padding-top: 12px;
      padding-bottom: 12px;
      width: 100%;
    }
    .${en}:hover{
      background: var(--chakra-colors-Blue-Light, #48ADF4) !important;
      border-color: var(--chakra-colors-Blue-Magic, #0067B4) !important;
    }
    .${en}:focus-visible{
      outline: transparent solid 2px;
      outline-offset: 2px;
      box-shadow: var(--chakra-ring-offset-shadow, 0 0 #0000),
                  var(--chakra-ring-shadow, 0 0 #0000),
                  0 0 0 3px var(--chakra-ring-color, rgba(66,153,225,0.6));
    }
    /* \xC9tat disabled : couleurs/gris EXACTES demand\xE9es + blocage du hover */
    .${en}[disabled],
    .${en}[aria-disabled="true"]{
      background: var(--chakra-colors-Neutral-Grey) !important;
      border-color: var(--chakra-colors-Neutral-EarlGrey) !important;
      color: var(--chakra-colors-Neutral-EarlGrey) !important;
      opacity: 0.7 !important;
      cursor: not-allowed !important;
      box-shadow: none !important;
      pointer-events: none; /* pour l\u2019aria-disabled \xE9ventuel */
    }
    .${en}[disabled]:hover,
    .${en}[disabled]:focus,
    .${en}[aria-disabled="true"]:hover,
    .${en}[aria-disabled="true"]:focus{
      background: var(--chakra-colors-Neutral-Grey) !important;
      border-color: var(--chakra-colors-Neutral-EarlGrey) !important;
      color: var(--chakra-colors-Neutral-EarlGrey) !important;
      box-shadow: none !important;
    }
  `.trim(),e=document.createElement("style");e.id=tS,e.textContent=t,document.head.appendChild(e)}function pP(t){let e=document.createElement("button");if(e.type="button",t?.className){let o=`${t.className} ${en}`.replace(new RegExp(`\\b${en}\\b`,"g"),"").trim();e.className=`${o} ${en}`.trim()}else e.className=`chakra-button ${en}`;let n=document.createElement("div");n.className="McFlex css-1fxg3mj";let r=document.createElement("span");return r.className="css-1uduba2",r.textContent="Buy all",n.appendChild(r),e.appendChild(n),e.addEventListener("click",async o=>{if(o.preventDefault(),o.stopPropagation(),e.disabled)return;let s=e.closest(Zo),a=s?.closest(oS)||document.body,i=lS(a),l=i.length,c=s?.getAttribute(Bp),d=c!=null&&c!==""?Number.parseInt(c,10):-1;(!Number.isFinite(d)||d<0)&&(d=s?i.indexOf(s):-1);let u=d>=0?d+1:-1,y=await Vk(),h=null,f=null,p="none",m,g;if(y&&s&&dP(s)){let x=e,E=x.previousElementSibling,T=x.nextElementSibling;m=rS(E),g=rS(T);let A=d>=0?Xk(y,d):null;A?(h=A.id,f=A.name??A.id,p="inventory"):d>=0&&typeof m=="number"&&typeof g=="number"&&(p="index")}let S=lP(y??null,h);nP(y,h,S.remaining),window.dispatchEvent(new CustomEvent("tm:buyAll",{detail:{index1:u,index0:d,total:l,shopType:y,itemId:h,itemName:f,reason:p,coin:m,credit:g,element:s,remaining:S.remaining,notifierItemId:S.notifierItemId}}))}),e}function Hp(t){let e=t.closest(oS);if(e&&!t.hasAttribute(Bp)){let i=lS(e).indexOf(t);i>=0&&t.setAttribute(Bp,String(i))}let n=t.querySelector(sS)||Array.from(t.querySelectorAll("div")).find(a=>a.querySelectorAll("button.chakra-button").length>=2);if(!n)return;let r=n.querySelectorAll("button.chakra-button");if(r.length<2)return;let o=n.querySelector(`button.${en}`);o||(o=pP(r[0]),n.insertBefore(o,r[1]));let s=cP(t);o.disabled=s,o.setAttribute("aria-disabled",s?"true":"false")}function Wp(t=document){t.querySelectorAll(Zo).forEach(Hp)}var zp=null,va=null;function cS(){uP(),aP(),Zk(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>Wp()):Wp(),zp=new MutationObserver(e=>{for(let n of e)for(let r of n.addedNodes)r instanceof Element&&(r.matches(Zo)&&Hp(r),r.querySelectorAll?.(Zo).forEach(Hp))});let t=()=>zp.observe(document.body,{childList:!0,subtree:!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),dS()}function dS(){va==null&&(va=window.setInterval(()=>Wp(),zk))}function mP(){va!=null&&(window.clearInterval(va),va=null)}document.addEventListener("visibilitychange",()=>{document.hidden?mP():zp&&dS()});var Fp={containerSelector:".McFlex.css-1lfov12",itemSelector:".McFlex.css-1kkwxjt",flagSelector:".chakra-text.css-pyjzrq"};function uS(t={}){if(!fP())return{stop(){},runOnce(){},isRunning(){return!1}};let e=t.containerSelector??Fp.containerSelector,n=t.itemSelector??Fp.itemSelector,r=t.flagSelector??Fp.flagSelector,o=t.root??document,s=t.observeHistory??!0,a=t.preferDirectChildren??!1,i=typeof t.log=="function"?t.log:t.log?(...p)=>console.debug("[ReorderObserver]",...p):()=>{},l=!0,c=!1;function d(){!l||c||(c=!0,requestAnimationFrame(()=>{try{let p=yP(o,e);for(let m of p)bP(m,n,r,a)}finally{c=!1}}))}let u=o.documentElement??o,y=new MutationObserver(d);y.observe(u,{childList:!0,subtree:!0}),d();let h=null;if(s){let{unhook:p}=SP(d);h=p}return{stop(){l&&(l=!1,y.disconnect(),h?.(),h=null,i("Stopped."))},runOnce(){d()},isRunning(){return l}}}function fP(){return typeof window<"u"&&typeof document<"u"}function yP(t,e){return Array.from(t.querySelectorAll(e))}function gP(){try{return document.querySelector(":scope"),!0}catch{return!1}}function hP(t,e){if(gP()){let n=Array.from(t.querySelectorAll(`:scope > ${e}`));if(n.length>0)return n}return Array.from(t.querySelectorAll(e))}function bP(t,e,n,r){let o=r?Array.from(t.children).filter(l=>l instanceof Element&&l.matches(e)):hP(t,e);if(o.length===0)return;let s=[],a=[];for(let l of o)(l.querySelector(n)?s:a).push(l);if(s.length===0)return;let i=!1;for(let l of o)if(!!!l.querySelector(n))i=!0;else if(i){let d=document.createDocumentFragment();for(let u of s)d.appendChild(u);for(let u of a)d.appendChild(u);t.appendChild(d);return}}function SP(t){let e=history.pushState?.bind(history),n=history.replaceState?.bind(history);function r(s){return s&&function(...i){let l=s.apply(this,i);return t(),l}}let o=()=>t();return e&&(history.pushState=r(e)),n&&(history.replaceState=r(n)),window.addEventListener("popstate",o),{unhook(){e&&(history.pushState=e),n&&(history.replaceState=n),window.removeEventListener("popstate",o)}}}var yB=new Promise(t=>{document.readyState!=="loading"?t():addEventListener("DOMContentLoaded",()=>t(),{once:!0})});function wa(t){let e=document.createElement("style");return e.textContent=t,document.head.appendChild(e),e}function vP(t){if(typeof t=="function")return t;if(typeof t=="string")return e=>e.matches?.(t)??!1;throw new Error("Selector or predicate required")}function Vl(t,e,{root:n=document,callForExisting:r=!0}={}){let o=vP(t),s=new WeakSet,a=l=>{s.has(l)||o(l)&&(s.add(l),e(l))};r&&"querySelectorAll"in n&&n.querySelectorAll("*").forEach(a);let i=new MutationObserver(l=>{for(let c of l)for(let d of Array.from(c.addedNodes)){if(d.nodeType!==1)continue;let u=d;a(u),u.querySelectorAll?.("*").forEach(a)}});return i.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>i.disconnect()}}var wP=".css-1rszi55";var pS="tm-feed-from-inventory-btn",xP="tm-feed-from-inventory-row";var mS=!1;function gS(){mS||(mS=!0,!(typeof document>"u")&&Vl(wP,t=>{t instanceof HTMLElement&&EP(t)}))}function EP(t){try{CP(t)}catch(e){console.warn("[PetPanel] Failed to inject feed button",e)}}function CP(t){if(t.querySelector(`.${pS}`))return;let e=t.querySelector("button.chakra-button"),n=fS(e,"INSTANT FEED");n.classList.add(pS),n.setAttribute("aria-label","Feed pet from inventory"),n.title="Feed pet from inventory",n.style.width="100%",n.style.minWidth="100%",n.style.alignContent="center",n.style.alignItems="center",n.style.padding="6px 14px",n.style.fontSize="13px",n.style.border="2px solid #FFC83D",n.style.color="rgb(205 200 193)",n.style.borderRadius="10px",n.style.height="40px",n.addEventListener("click",()=>{MP(n)});let r=document.createElement("div");r.classList.add("McFlex",xP),r.style.marginTop="8px",r.style.justifyContent="center",r.style.width="100%",r.style.flexDirection="column",r.style.alignItems="stretch",r.style.gap="8px",r.appendChild(n);let o=fS(e,"FEED FROM INVENTORY");o.style.width="100%",o.style.minWidth="100%",o.style.alignContent="center",o.style.alignItems="center",o.style.marginTop="8px",o.style.padding="6px 14px",o.style.fontSize="13px",o.style.border="2px solid #BA5E1E",o.style.color="rgb(205 200 193)",o.style.borderRadius="10px",o.style.height="40px",r.appendChild(o),o.addEventListener("click",()=>{AP(o)});let s=t.querySelector(".McFlex.css-cabebk"),a=t.querySelector(".McFlex.css-1hd05pq");s&&a&&a.parentElement===s.parentElement?a.parentElement.insertBefore(r,a):s?.parentElement?s.parentElement.insertBefore(r,s.nextSibling):t.appendChild(r)}function fS(t,e){let n=document.createElement("button");n.type="button",t?.className?n.className=t.className:n.className="chakra-button";let r=document.createElement("div");r.className=t?.firstElementChild instanceof HTMLElement?t.firstElementChild.className:"McFlex";let o=document.createElement("p"),s=t?.querySelector(".chakra-text");return o.className=s instanceof HTMLElement?s.className:"chakra-text",o.textContent=e,r.appendChild(o),n.appendChild(r),n}async function MP(t){let e=t.disabled;t.disabled=!0;try{let n=await hS();if(!n){await be("Feed from inventory","No expanded pet detected.","error");return}let r=await Gp(n);if(!r){await be("Feed from inventory","Unable to resolve expanded pet.","error");return}let o=String(r?.slot?.petSpecies||""),s=Me.getCompatibleCropsForSpecies(o)??[],a=new Set(s.map(g=>String(g||"")));if(!a.size){await be("Feed from inventory","No compatible crops for this pet.","info");return}let i=await we.getCropInventoryState(),l=Array.isArray(i)?i:[],c=await we.getFavoriteIdSet().catch(()=>new Set),d=l.find(g=>{let S=String(g?.species||"");if(!S||!a.has(S))return!1;let w=String(g?.id||"");return w&&!c.has(w)}),u=String(d?.id||"");if(!u){await be("Feed from inventory","No compatible crops in inventory (excluding favorites).","info");return}let y=jp(r);await we.feedPet(n,u);let h=await SS(n,y,{initialDelay:150}),f=h!=null?` Hunger: ${bS(h)}%.`:"",p=String(d?.species||"crop"),m=r?.slot?.name||o||n;await be("Feed from inventory",`Fed ${m} with ${p}.${f}`,"success")}catch(n){console.error("[Pet panel] Failed to feed pet from inventory",n),await be("Feed from inventory",n instanceof Error?n.message:"Failed to feed pet.","error")}finally{t.disabled=e}}async function AP(t){let e=t.disabled,n=!1;t.disabled=!0;try{let r=await hS();if(!r){await be("Feed from inventory","No expanded pet detected.","error");return}let o=await Gp(r);if(!o){await be("Feed from inventory","Unable to resolve expanded pet.","error");return}let s=String(o?.slot?.petSpecies||""),a=jp(o),i=await TP(r,s);if(!i.size){await be("Feed from inventory","No compatible crops for this pet.","info");return}let l=await we.getCropInventoryState(),c=Array.isArray(l)?l:[],d=await we.getFavoriteIdSet().catch(()=>new Set),u=c.filter(m=>{let g=String(m?.species||"");if(!g||!i.has(g))return!1;let S=String(m?.id||"");return S&&!d.has(S)});if(!u.length){await be("Feed from inventory","No compatible crops in inventory.","info");return}let y=m=>{let g=new Set;for(let S of m){let w=String(S?.id||"");w&&g.add(w)}return Array.from(d).filter(S=>g.has(S))};await Vn().catch(()=>{});let h=u.slice(),f=y(h);await Dt({items:h,favoritedItemIds:f},{open:!0});let p=o?.slot?.name||s||r;for(await be("Feed from inventory",`Showing ${h.length} compatible crop(s) for ${p}. Select a crop to feed it immediately.`,"info");;){let m=await _P(2e4);if(m==null){await be("Feed from inventory","No crop selected.","info");break}if(m<0||m>=h.length){await be("Feed from inventory","Invalid crop selection.","error"),await Vn().catch(()=>{});continue}let g=h[m],S=String(g?.id||"");if(!S){await be("Feed from inventory","Invalid crop selection.","error"),await Vn().catch(()=>{});continue}let w=a;await we.feedPet(r,S);let x=await SS(r,w,{initialDelay:200});x!=null&&(a=x);let E=x!=null?` Hunger: ${bS(x)}%.`:"",T=String(g?.species||"crop"),A=o?.slot?.name||s||r;if(await be("Feed from inventory",`Fed ${A} with ${T}.${E}`,"success"),x!=null&&x>=99.9){n=!0;try{await ar()}catch{}break}let H=null;try{let v=await we.getCropInventoryState();H=Array.isArray(v)?v:null}catch{H=null}let C=H?.filter(v=>{let B=String(v?.species||"");if(!B||!i.has(B))return!1;let le=String(v?.id||"");return le&&!d.has(le)})??null,L=()=>h.filter(v=>String(v?.id||"")!==S);if(C?C.some(B=>String(B?.id||"")===S)&&(C=L()):C=L(),h=C,!h.length){await be("Feed from inventory","No compatible crops in inventory.","info"),n=!0;try{await ar()}catch{}break}f=y(h),await Dt({items:h,favoritedItemIds:f},{open:!1}),await Vn().catch(()=>{})}}catch(r){console.error("[Pet panel] Failed to handle inventory feed",r),await be("Feed from inventory",r instanceof Error?r.message:"Failed to feed pet from inventory.","error")}finally{try{await Vn()}catch{}if(n)try{await ar()}catch{}t.disabled=e}}async function hS(){try{let t=await ce.pets.expandedPetSlotId.get(),e=typeof t=="string"?t.trim():"";return e.length?e:null}catch{return null}}async function Gp(t){try{let e=await Me.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===t)??null}catch(e){return console.warn("[Pet panel] Failed to fetch pets",e),null}}async function TP(t,e){let n=Me.getCompatibleCropsForSpecies(e)??[];return new Set(n)}function bS(t){if(!Number.isFinite(t))return"";let e=Math.max(0,Math.min(100,t)),n=Math.round(e*10)/10;return Number.isInteger(n)?String(n):n.toFixed(1)}var IP=.05,kP=4e3,PP=120;function LP(t){if(!t||typeof t!="object")return!1;let e=t.slot;return!!e&&typeof e=="object"}function jp(t){if(!LP(t))return null;try{let e=Me.getHungerPctFor(t);return typeof e=="number"&&Number.isFinite(e)?e:null}catch{return null}}async function RP(t){try{let e=await Gp(t);return jp(e)}catch{return null}}async function SS(t,e,n={}){let{initialDelay:r=0,timeout:o=kP,interval:s=PP}=n;r>0&&await yS(r);let a=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),i=null;for(;;){let l=await RP(t);if(l!=null&&(i=l,e==null||l>=Math.min(100,e+IP)||l>=99.9))return l;if((typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now())-a>=o)return i;s>0&&await yS(s)}}function yS(t){return new Promise(e=>setTimeout(e,t))}async function _P(t=2e4){let e=performance.now();for(;performance.now()-e<t;){try{let n=await ce.ui.activeModal.get();if(!ki(n))return null}catch{return null}try{let n=await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();if(typeof n=="number"&&Number.isInteger(n)&&n>=0)return n}catch{}await new Promise(n=>setTimeout(n,80))}return null}var vS=t=>String(t??"").trim();function NP(t){let e=vS(t).toLowerCase();if(!e)return null;for(let n of Object.keys(De))if(n.toLowerCase()===e)return n;return null}function wS(t){if(!t||typeof t!="object")return null;if(typeof t.baseSellPrice=="number"&&Number.isFinite(t.baseSellPrice))return t.baseSellPrice;for(let e of["produce","crop","item","items","data"])if(t[e]){let n=wS(t[e]);if(n!=null)return n}try{let e=new Set,n=[t];for(;n.length;){let r=n.pop();if(!(!r||typeof r!="object"||e.has(r))){if(e.add(r),typeof r.baseSellPrice=="number"){let o=r.baseSellPrice;if(Number.isFinite(o))return o}for(let o of Object.values(r))o&&typeof o=="object"&&n.push(o)}}}catch{}return null}function xS(t){let e=NP(t);if(!e)return null;let n=De[e],r=[n?.produce?.baseSellPrice,n?.crop?.baseSellPrice,n?.item?.baseSellPrice,n?.items?.Produce?.baseSellPrice].filter(o=>typeof o=="number"&&Number.isFinite(o));return r.length?r[0]:wS(n)}function DP(t,e="round"){switch(e){case"floor":return Math.floor(t);case"ceil":return Math.ceil(t);case"none":return t;case"round":default:return Math.round(t)}}function qP(t){return Number.isFinite(t)?1+(Math.max(1,Math.min(6,Math.floor(t)))-1)*.1:1}var OP={Gold:25,Rainbow:50},Yl={Wet:2,Chilled:2,Frozen:10},Ql={Dawnlit:2,Dawnbound:3,Amberlit:5,Amberbound:6},FP={"Wet+Dawnlit":3,"Chilled+Dawnlit":3,"Wet+Dawnbound":4,"Chilled+Dawnbound":4,"Wet+Amberlit":6,"Chilled+Amberlit":6,"Wet+Amberbound":7,"Chilled+Amberbound":7,"Frozen+Dawnlit":11,"Frozen+Dawnbound":12,"Frozen+Amberlit":14,"Frozen+Amberbound":15};function BP(t){return t==="Gold"||t==="Rainbow"}function HP(t){return t==="Wet"||t==="Chilled"||t==="Frozen"}function WP(t){return t==="Dawnlit"||t==="Dawnbound"||t==="Amberlit"||t==="Amberbound"}function Kp(t){let e=vS(t).toLowerCase();return e?e==="amberglow"||e==="ambershine"||e==="amberlight"?"Amberlit":e==="dawn"||e==="dawnlight"?"Dawnlit":e==="gold"?"Gold":e==="rainbow"?"Rainbow":e==="wet"?"Wet":e==="chilled"?"Chilled":e==="frozen"?"Frozen":e==="dawnlit"?"Dawnlit":e==="dawnbound"?"Dawnbound":e==="amberlit"?"Amberlit":e==="dawncharged"||e==="dawnradiant"||e==="dawn-radiant"||e==="dawn charged"?"Dawnbound":e==="amberbound"||e==="ambercharged"||e==="amberradiant"||e==="amber-radiant"||e==="amber charged"?"Amberbound":t:""}function zP(t){if(!Array.isArray(t))return 1;let e=1;for(let n of t){let r=Kp(n);if(BP(r)){let o=OP[r];o>e&&(e=o)}}return e}function GP(t){if(!Array.isArray(t))return null;let e=null;for(let n of t){let r=Kp(n);if(HP(r)){if(e==null){e=r;continue}Yl[r]>Yl[e]&&(e=r)}}return e}function jP(t){if(!Array.isArray(t))return null;let e=null;for(let n of t){let r=Kp(n);if(WP(r)){if(e==null){e=r;continue}Ql[r]>Ql[e]&&(e=r)}}return e}function KP(t,e){if(!t&&!e)return 1;if(t&&!e)return Yl[t];if(!t&&e)return Ql[e];let n=`${t}+${e}`,r=FP[n];return typeof r=="number"?r:Math.max(Yl[t],Ql[e])}function UP(t){let e=zP(t),n=GP(t),r=jP(t),o=KP(n,r);return e*o}function Jr(t,e,n,r){let o=r?.getBasePrice??xS,s=r?.scaleTransform??((f,p)=>p),a=r?.rounding??"round",i=o(t);if(!(Number.isFinite(i)&&i>0))return 0;let l=Number(e);if(!Number.isFinite(l)||l<=0)return 0;let c=s(t,l);if(!Number.isFinite(c)||c<=0)return 0;let d=UP(n),u=qP(r?.friendPlayers),y=i*c*d*u;return Math.max(0,DP(y,a))}function Jl(t,e,n){if(!t||t.itemType!=="Produce")return 0;let r=n==null?e:{...e,friendPlayers:n};return Jr(t.species,t.scale,t.mutations,r)}function Up(t,e,n){if(!t)return 0;let r=n==null?e:{...e,friendPlayers:n};return Jr(t.species,t.targetScale,t.mutations,r)}function Vp(t,e,n){if(!t||t.objectType!=="plant"||!Array.isArray(t.slots))return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of t.slots)o+=Up(s,r);return o}function ES(t,e,n){if(!Array.isArray(t))return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of t)s?.itemType==="Produce"&&(o+=Jl(s,r));return o}function CS(t,e,n){if(!t||typeof t!="object")return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of Object.keys(t)){let a=t[s];a?.objectType==="plant"&&(o+=Vp(a,r))}return o}var xa=Object.freeze({getBasePrice:xS,rounding:"round"});var $l=t=>!!t&&t.objectType==="plant",VP=t=>Array.from({length:t},(e,n)=>n),MS=(t,e,n)=>Math.max(e,Math.min(n,t));function AS(){let t=null,e,n=null,r=null,o=null,s=new Set,a=()=>{for(let p of s)try{p()}catch{}},i=!1,l=()=>{i||(i=!0,requestAnimationFrame(()=>{i=!1,f()}))};function c(){let p=Array.isArray(t?.slots)?t.slots.length:0;return p?Array.isArray(n)&&n.length===p?n:VP(p):[]}function d(){if(!$l(t))return 0;let p=t.slots??[],m=Array.isArray(p)?p.length:0;if(!m)return 0;let g=Number.isFinite(r)?r:0,S=MS(g,0,m-1),x=c().indexOf(S);return x>=0?x:0}function u(){if(!$l(t))return[];let p=Array.isArray(t.slots)?t.slots:[],m=c(),g=[];for(let S of m)p[S]!=null&&g.push(p[S]);return g}function y(){if(!$l(t))return null;let p=u();if(!p.length)return null;let m=d(),g=p[MS(m,0,p.length-1)],S=Up(g,xa,e);return Number.isFinite(S)&&S>0?S:null}function h(){if(!$l(t))return null;let p=Vp(t,xa,e);return Number.isFinite(p)&&p>0?p:null}function f(){let m=y()??h()??null;m!==o&&(o=m,a())}return(async()=>{try{t=await nr.get()}catch{}try{e=await si.get()}catch{}try{let p=await rr.get();n=Array.isArray(p)?p.slice():null}catch{}try{r=await tr.get()}catch{}si.onChange(p=>{e=p}),rr.onChange(p=>{n=Array.isArray(p)?p.slice():null}),nr.onChange(p=>{t=p,l()}),tr.onChange(p=>{r=Number.isFinite(p)?p:0,l()}),f()})(),{get(){return o},onChange(p){return s.add(p),()=>s.delete(p)},stop(){s.clear()}}}function YP(){return Xn("QPM")}function QP(t){return YP()?t.querySelector("span.qpm-crop-size"):null}var Yp={rootSelector:".McFlex.css-fsggty",innerSelector:".McFlex.css-1l3zq7, .McFlex.css-11dqzw",markerClass:"tm-crop-price"},JP=".McFlex.css-1l3zq7, .McFlex.css-11dqzw",TS="tm-crop-price-icon",IS="tm-crop-price-label",$P=":scope > .chakra-text.css-1uvlb8k",DS="\u{1F512}",ZP="2px solid rgb(188, 53, 215)",XP="15px",qS="css-qnqsp4",Zl="tm-locker-tooltip-lock-icon",eL="tmLockerOriginalColor",tL="tmLockerOriginalDisplay",nL="tmLockerOriginalAlign",kS="tmLockerOriginalHtml",Xl="tmLockerOriginalBorder",ec="tmLockerOriginalBorderRadius",tc="tmLockerOriginalPosition",nc="tmLockerOriginalOverflow",rL=new RegExp(`^${DS}(?:\\u00A0|\\s|&nbsp;)*`),oL="\u2014",sL=new Intl.NumberFormat("en-US"),aL=t=>t==null?oL:sL.format(Math.max(0,Math.round(t))),iL=typeof window<"u"&&typeof document<"u";function PS(t,e){return Array.from(t.querySelectorAll(e))}function lL(t){return typeof t=="function"?t:t?(...e)=>console.debug("[AppendCropPrice/GO]",...e):()=>{}}function cL(t,e,n){PS(t,e.rootSelector).forEach(r=>{PS(r,e.innerSelector).forEach(n)})}function dL(t,e,n,r,o){cL(t,e,s=>{if(mL(s,n)){yL(s,n),LS(s,!1);return}LS(s,o),EL(s,r,n)})}function uL(){try{return xt.getCurrentSlotSnapshot().harvestAllowed??null}catch{return null}}function pL(t){try{return xt.onSlotInfoChange(t)}catch{return null}}function OS(t={}){if(!iL)return{stop(){},runOnce(){},isRunning:()=>!1};let e={rootSelector:t.rootSelector??Yp.rootSelector,innerSelector:t.innerSelector??Yp.innerSelector},n=t.markerClass??Yp.markerClass,r=t.root??document,o=lL(t.log),s=AS(),a=xt.getState().enabled,i=!0,l=uL(),c=!a,d,u,y=!1,h=null,f=()=>{if(!i||!c)return;let T=s.get(),A=l===!1;T===d&&A===u&&!y||(d=T,u=A,y=!1,dL(r,e,n,aL(T),A),o("render",{value:T,locked:A}))},p=null,m=()=>{p!=null&&(typeof globalThis<"u"&&typeof globalThis.clearTimeout=="function"&&globalThis.clearTimeout(p),p=null)};(()=>{!a||c||p!=null||typeof globalThis>"u"||typeof globalThis.setTimeout!="function"||(p=globalThis.setTimeout(()=>{p=null,c||(c=!0,f())},500))})();let S=()=>{if(h||typeof MutationObserver>"u")return;let T=document.body??document.documentElement??document;T&&(h=new MutationObserver(A=>{let N=!1;for(let H of A){for(let C of Array.from(H.addedNodes))if(C instanceof Element){if(C.classList.contains("qpm-crop-size")){N=!0;break}if(C.querySelector(".qpm-crop-size")){N=!0;break}}if(N)break}N&&(y=!0,f())}),h.observe(T,{childList:!0,subtree:!0}))},w=()=>{if(h){try{h.disconnect()}catch{}h=null}};S();let x=pL(T=>{l=T.harvestAllowed??null,m(),!c&&a&&(c=!0),f()});a&&x==null&&(m(),c=!0),f();let E=s.onChange(f);return{stop(){if(i){if(i=!1,m(),w(),E?.(),typeof x=="function")try{x()}catch{}s.stop(),o("stopped")}},runOnce(){f()},isRunning(){return i}}}function mL(t,e){return!(t instanceof Element)||!t.matches(JP)?!1:fL(t,e).length===1}function fL(t,e){return Array.from(t.children).filter(r=>!(r.tagName==="SPAN"&&r.classList.contains(e)))}function yL(t,e){t.querySelectorAll(`:scope > span.${CSS.escape(e)}`).forEach(r=>r.remove())}function gL(){if(typeof document>"u")return;document.querySelectorAll(`span.${Zl}`).forEach(e=>{e.closest(`.${qS}`)||e.remove()})}function hL(t){return t.closest(`.${qS}`)}function LS(t,e){if(!(t instanceof HTMLElement))return;t.querySelectorAll(":scope > span.tm-locker-lock-emoji").forEach(s=>s.remove()),gL();let n=t.querySelector($P)??t.querySelector(":scope > .chakra-text"),r=hL(t),o=t.closest(".css-502lyi");if(o&&o!==r&&(_S(o),NS(o)),!e){n&&(RS(n),bL(n)),r&&(_S(r),NS(r));return}n&&RS(n),r&&(SL(r),vL(r),wL(r))}function bL(t){Qp(t,eL,"color"),Qp(t,tL,"display"),Qp(t,nL,"align-items")}function RS(t){let e=t.dataset[kS];if(e!==void 0){t.innerHTML=e,delete t.dataset[kS];return}let n=t.innerHTML,r=xL(n);r!==n&&(t.innerHTML=r)}function Qp(t,e,n){let r=t.dataset,o=r[e];o!==void 0&&(o?t.style.setProperty(n,o):t.style.removeProperty(n),delete r[e])}function SL(t){t.dataset[Xl]===void 0&&(t.dataset[Xl]=t.style.border??""),t.dataset[ec]===void 0&&(t.dataset[ec]=t.style.borderRadius??""),t.dataset[nc]===void 0&&(t.dataset[nc]=t.style.overflow??"")}function vL(t){t.style.border=ZP,t.style.borderRadius=XP,t.style.overflow="visible",(typeof window<"u"?window.getComputedStyle(t).position:t.style.position||"static")==="static"&&(t.dataset[tc]===void 0&&(t.dataset[tc]=t.style.position??""),t.style.position="relative")}function _S(t){let e=t.dataset[Xl];e!==void 0?(e?t.style.border=e:t.style.removeProperty("border"),delete t.dataset[Xl]):t.style.removeProperty("border");let n=t.dataset[ec];n!==void 0?(n?t.style.borderRadius=n:t.style.removeProperty("border-radius"),delete t.dataset[ec]):t.style.removeProperty("border-radius");let r=t.dataset[nc];r!==void 0?(r?t.style.overflow=r:t.style.removeProperty("overflow"),delete t.dataset[nc]):t.style.removeProperty("overflow");let o=t.dataset[tc];o!==void 0?(o?t.style.position=o:t.style.removeProperty("position"),delete t.dataset[tc]):t.style.position==="relative"&&t.style.removeProperty("position")}function wL(t){let e=t.querySelectorAll(`:scope > span.${Zl}`);e.forEach((r,o)=>{o>0&&r.remove()});let n=e[0]??null;n||(n=document.createElement("span"),n.className=Zl,t.append(n)),n.textContent=DS,n.style.position="absolute",n.style.top="0",n.style.right="0",n.style.left="",n.style.transform="translate(50%, -50%)",n.style.fontSize="18px",n.style.padding="2px 8px",n.style.borderRadius="999px",n.style.border="none",n.style.background="transparent",n.style.color="white",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="1"}function NS(t){t.querySelectorAll(`:scope > span.${Zl}`).forEach(e=>e.remove())}function xL(t){return t.replace(rL,"")}function EL(t,e,n){let r=Array.from(t.querySelectorAll(`:scope > span.${CSS.escape(n)}`)),o=r[0]??null;for(let c=1;c<r.length;c++)r[c].remove();o||(o=document.createElement("span"),o.className=n),o.style.display="block",o.style.marginTop="6px",o.style.fontWeight="700",o.style.color="#FFD84D",o.style.fontSize="14px";let s=o.querySelector(`:scope > span.${TS}`);s||(s=document.createElement("span"),s.className=TS,s.setAttribute("aria-hidden","true"),s.style.width="18px",s.style.height="18px",s.style.display="inline-block",s.style.verticalAlign="middle",s.style.marginRight="6px",s.style.userSelect="none",s.style.pointerEvents="none",s.style.backgroundSize="contain",s.style.backgroundRepeat="no-repeat",s.style.backgroundPosition="center",o.insertBefore(s,o.firstChild));let a=`url("${po.img64}")`;s.style.backgroundImage!==a&&(s.style.backgroundImage=a);let i=o.querySelector(`:scope > span.${IS}`);i||(i=document.createElement("span"),i.className=IS,i.style.display="inline",o.appendChild(i)),i.textContent!==e&&(i.textContent=e);let l=QP(t);if(l){let c=l.nextElementSibling;c!==o&&t.insertBefore(o,c);return}t.lastElementChild!==o&&t.appendChild(o)}var CL=".css-vmnhaw",Jp="tm-sell-crops-lock";var WS="tmSellLockBorder",zS="tmSellLockRadius",GS="tmSellLockPosition",jS="tmSellLockPadding",KS="tmSellLockBox",US="tmSellLockShadow",VS="tmSellLockOverflow";function YS(){if(typeof window>"u"||typeof document>"u")return{stop(){}};let t=null,e=$t(1),n=!0,r=[],o=()=>t??e??0,s=c=>{Array.from(document.querySelectorAll(CL)).forEach(u=>ML(u,c))},a=()=>{if(!n)return;let c=mt.getRequiredPercent(),d=o(),u=c>0&&!(Number.isFinite(d)&&d+1e-4>=c);s(u)},i=()=>{let c=new MutationObserver(()=>a());c.observe(document.documentElement,{childList:!0,subtree:!0}),r.push(()=>c.disconnect())},l=async()=>{try{let c=await ce.server.friendBonusMultiplier.get();t=Hn(c)}catch{}try{let c=await ce.server.friendBonusMultiplier.onChange(d=>{t=Hn(d),a()});typeof c=="function"&&r.push(c)}catch{}try{let c=await ce.server.numPlayers.get();e=$t(c)}catch{}try{let c=await ce.server.numPlayers.onChange(d=>{e=$t(d),a()});typeof c=="function"&&r.push(c)}catch{}};return i(),r.push(mt.subscribe(()=>a())),l(),a(),{stop(){n=!1,r.splice(0).forEach(c=>{try{c()}catch{}}),s(!1)}}}function ML(t,e){if(!t)return;if(!TL(t)){FS(t),HS(t);return}if(!e){FS(t),HS(t);return}$r(t,WS,"border"),$r(t,zS,"borderRadius"),$r(t,GS,"position"),$r(t,jS,"padding"),$r(t,KS,"boxSizing"),$r(t,US,"boxShadow"),$r(t,VS,"overflow"),t.style.border="none",t.style.borderRadius="",t.style.padding="",t.style.boxSizing="",t.style.boxShadow="none",t.style.overflow="",window.getComputedStyle(t).position==="static"&&(t.style.position="relative"),t.style.zIndex="1000",AL(t)}function $r(t,e,n){let r=t.dataset;r[e]===void 0&&(r[e]=t.style[n])}function FS(t){Zr(t,WS,"border"),Zr(t,zS,"borderRadius"),Zr(t,GS,"position"),Zr(t,jS,"padding"),Zr(t,KS,"boxSizing"),Zr(t,US,"boxShadow"),Zr(t,VS,"overflow")}function Zr(t,e,n){let r=t.dataset;if(r[e]===void 0)return;let o=r[e];o?t.style.setProperty(BS(n),o):t.style.removeProperty(BS(n)),delete r[e]}function BS(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function AL(t){if(t.querySelector(`span.${Jp}`))return;let n=document.createElement("span");n.className=Jp,n.textContent="\u{1F512}",n.style.position="absolute",n.style.top="-4px",n.style.right="-4px",n.style.fontSize="16px",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="2",t.appendChild(n)}function HS(t){t.querySelectorAll(`span.${Jp}`).forEach(e=>e.remove())}function TL(t){let e=t.querySelector("button");if(!e)return null;let n=(e.textContent||"").trim();return/sell\s*crops/i.test(n)?e:null}var QS=".css-502lyi",$p="tm-egg-lock",IL="rgb(188, 53, 215)",ZS="tmEggLockBorder",XS="tmEggLockRadius",e0="tmEggLockPosition",t0="tmEggLockOverflow";function n0(){if(typeof window>"u"||typeof document>"u")return{stop(){}};let t=!0,e=null,n=[],r=()=>mt.isEggLocked(e),o=()=>{if(!t)return;let i=r();Array.from(document.querySelectorAll(QS)).forEach(c=>{if(!kL(c)){Zp(c);return}PL(c,i)})},s=()=>{let i=new MutationObserver(()=>o());i.observe(document.documentElement,{childList:!0,subtree:!0}),n.push(()=>i.disconnect())},a=async()=>{try{let l=await ce.data.myCurrentGardenObject.get();e=$S(l)}catch{}try{let l=await ce.data.myCurrentGardenObject.onChange(c=>{e=$S(c),o()});typeof l=="function"&&n.push(l)}catch{}let i=mt.subscribe(()=>o());n.push(i)};return s(),a(),o(),{stop(){t=!1,n.splice(0).forEach(l=>{try{l()}catch{}}),Array.from(document.querySelectorAll(QS)).forEach(Zp)}}}function kL(t){return(t.textContent||"").toLowerCase().includes("egg")}function PL(t,e){if(!e){Zp(t);return}rc(t,ZS,"border"),rc(t,XS,"borderRadius"),rc(t,e0,"position"),rc(t,t0,"overflow"),t.style.border=`3px solid ${IL}`,t.style.borderRadius="16px",t.style.overflow="visible",window.getComputedStyle(t).position==="static"&&(t.style.position="relative"),LL(t)}function Zp(t){oc(t,ZS,"border"),oc(t,XS,"borderRadius"),oc(t,e0,"position"),oc(t,t0,"overflow"),RL(t)}function rc(t,e,n){let r=t.dataset;r[e]===void 0&&(r[e]=t.style[n])}function oc(t,e,n){let r=t.dataset;if(r[e]===void 0)return;let o=r[e];o?t.style.setProperty(JS(n),o):t.style.removeProperty(JS(n)),delete r[e]}function JS(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function LL(t){if(t.querySelector(`span.${$p}`))return;let n=document.createElement("span");n.className=$p,n.textContent="\u{1F512}",n.style.position="absolute",n.style.top="-8px",n.style.right="-8px",n.style.fontSize="16px",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="2",t.appendChild(n)}function RL(t){t.querySelectorAll(`span.${$p}`).forEach(e=>e.remove())}function $S(t){if(!t||typeof t!="object"||t.objectType!=="egg")return null;let e=t.eggId;return typeof e=="string"&&e?e:null}var r0=".css-502lyi",Xp="tm-decor-lock",_L="rgb(188, 53, 215)",s0="tmDecorLockBorder",a0="tmDecorLockRadius",i0="tmDecorLockPosition",l0="tmDecorLockOverflow",NL=(()=>{let t=new Set;try{Object.entries(ut).forEach(([e,n])=>{e&&t.add(e.toLowerCase());let r=n?.name;typeof r=="string"&&r&&t.add(r.toLowerCase())})}catch{}return Array.from(t).filter(Boolean)})();function c0(){if(typeof window>"u"||typeof document>"u")return{stop(){}};let t=!0,e=[],n=()=>mt.isDecorPickupLocked(),r=()=>{if(!t)return;let a=n();Array.from(document.querySelectorAll(r0)).forEach(l=>{if(!DL(l)){em(l);return}qL(l,a)})},o=()=>{let a=new MutationObserver(()=>r());a.observe(document.documentElement,{childList:!0,subtree:!0}),e.push(()=>a.disconnect())},s=()=>{let a=mt.subscribe(()=>r());e.push(a)};return o(),s(),r(),{stop(){t=!1,e.splice(0).forEach(i=>{try{i()}catch{}}),Array.from(document.querySelectorAll(r0)).forEach(em)}}}function DL(t){let e=(t.textContent||"").toLowerCase();return!e||!t.querySelector("canvas")?!1:NL.some(n=>n&&e.includes(n))}function qL(t,e){if(!e){em(t);return}sc(t,s0,"border"),sc(t,a0,"borderRadius"),sc(t,i0,"position"),sc(t,l0,"overflow"),t.style.border=`3px solid ${_L}`,t.style.borderRadius="16px",t.style.overflow="visible",window.getComputedStyle(t).position==="static"&&(t.style.position="relative"),OL(t)}function em(t){ac(t,s0,"border"),ac(t,a0,"borderRadius"),ac(t,i0,"position"),ac(t,l0,"overflow"),FL(t)}function sc(t,e,n){let r=t.dataset;r[e]===void 0&&(r[e]=t.style[n])}function ac(t,e,n){let r=t.dataset;if(r[e]===void 0)return;let o=r[e];o?t.style.setProperty(o0(n),o):t.style.removeProperty(o0(n)),delete r[e]}function o0(t){return t.replace(/[A-Z]/g,e=>`-${e.toLowerCase()}`)}function OL(t){if(t.querySelector(`span.${Xp}`))return;let n=document.createElement("span");n.className=Xp,n.textContent="\u{1F512}",n.style.position="absolute",n.style.top="-8px",n.style.right="-8px",n.style.fontSize="16px",n.style.pointerEvents="none",n.style.userSelect="none",n.style.zIndex="2",t.appendChild(n)}function FL(t){t.querySelectorAll(`span.${Xp}`).forEach(e=>e.remove())}var m0="Ariedam64",f0="MagicGarden-modMenu",y0="main",d0="quinoa-ws.min.user.js",u0=`https://raw.githubusercontent.com/${m0}/${f0}`,BL=`https://api.github.com/repos/${m0}/${f0}/commits/${y0}`;async function HL(t,e){let n=await fetch(t,{cache:"no-store",...e});if(!n.ok)throw new Error(`Failed to load remote resource: ${n.status} ${n.statusText}`);return await n.text()}async function p0(t,e){return new Promise((n,r)=>{let o=typeof GM_xmlhttpRequest=="function"?GM_xmlhttpRequest:typeof GM<"u"&&typeof GM.xmlHttpRequest=="function"?GM.xmlHttpRequest:null;if(!o)return r(new Error("GM_xmlhttpRequest not available"));o({method:"GET",url:t,headers:e?.headers,onload:s=>{s.status>=200&&s.status<300?n(s.responseText):r(new Error(`GM_xhr failed: ${s.status}`))},onerror:s=>r(s)})})}async function g0(t,e){let n=sr(),r=typeof GM_xmlhttpRequest=="function"||typeof GM<"u"&&typeof GM.xmlHttpRequest=="function";if(n&&r)return await p0(t,e);try{return await HL(t,e)}catch(o){if(r)return await p0(t,e);throw o}}async function WL(){try{let t=await g0(BL,{headers:{Accept:"application/vnd.github+json"}}),e=JSON.parse(t);if(e&&typeof e.sha=="string"&&e.sha.trim().length>0)return e.sha.trim()}catch(t){console.warn("[MagicGarden] Failed to resolve latest commit SHA:",t)}return null}async function zL(){let t=await WL(),e=t?`${u0}/${t}/${d0}`:`${u0}/refs/heads/${y0}/${d0}?t=${Date.now()}`;return await g0(e)}async function h0(){try{let t=await zL(),e=GL(t);if(!e)throw new Error("Metadata block not found in remote script");let n=e.get("version")?.[0],r=e.get("downloadurl")?.[0]??e.get("updateurl")?.[0];return{version:n,download:r}}catch(t){return console.error("Unable to retrieve remote version:",t),null}}function GL(t){let e=t.match(/\/\/ ==UserScript==([\s\S]*?)\/\/ ==\/UserScript==/);if(!e)return null;let r=e[1].matchAll(/^\/\/\s*@([^\s]+)\s+(.+)$/gm),o=new Map;for(let[,s,a]of r){let i=s.trim().toLowerCase(),l=a.trim();if(!i)continue;let c=o.get(i);c?c.push(l):o.set(i,[l])}return o}function ic(){if(typeof GM_info<"u"&&GM_info?.script?.version)return GM_info.script.version}var b0=!1,dc=[],Ea=null,cc,rm=null,tm=null,lc=null;function w0(){if(typeof document>"u")return null;let t=document.querySelector("button.chakra-button.css-w004xu");return t||(Array.from(document.querySelectorAll("button.chakra-button.css-35ruvm")).find(n=>(n.textContent??"").includes("Grow"))??null)}function om(t,e){let n=t.querySelector(".css-telpzl"),r=()=>{let l=t.cloneNode(!0);return l.querySelectorAll(".css-telpzl").forEach(c=>c.remove()),(l.textContent??"").replace(/\s+/g," ").trim()},o=()=>{let l=t.dataset.baseLabel??"",c=t.dataset.lastQuantity,d=r(),u=(()=>{if(!d)return"";if(c&&c.length>0){let y=` \xD7${c}`;if(d.endsWith(y))return d.slice(0,-y.length).replace(/\s+$/,"");let h=`\xD7${c}`;if(d.endsWith(h))return d.slice(0,-h.length).replace(/\s+$/,"")}return d})();return u&&u!==l||!l&&u?(t.dataset.baseLabel=u,u):l},s=l=>{let c=Array.from(t.childNodes).find(u=>n&&u===n?!1:(u.textContent??"").trim().length>0);if(c){c.textContent=l;return}let d=n??t.firstChild;t.insertBefore(document.createTextNode(l),d??null)},a=o();if(n&&(n.textContent="",n.style.marginLeft="",n.style.display="none"),e==null){t.dataset.lastQuantity="",s(a);return}let i=a?`${a} \xD7${e}`:`\xD7${e}`;t.dataset.lastQuantity=String(e),s(i)}function x0(t){typeof IntersectionObserver>"u"||(lc?lc.disconnect():lc=new IntersectionObserver(e=>{e.filter(n=>n.isIntersecting).forEach(n=>{om(n.target,rm)})}),lc.observe(t))}function jL(){if(typeof document>"u"||tm||typeof MutationObserver>"u")return;let t=document.body;t&&(tm=new MutationObserver(()=>{let e=w0();e&&(x0(e),om(e,rm))}),tm.observe(t,{childList:!0,subtree:!0}))}function S0(t){if(typeof document>"u")return;rm=t;let e=w0();if(!e){jL();return}x0(e),om(e,t)}function v0(t){return!t||!Array.isArray(t.items)?[]:t.items.slice()}function KL(t){if(t==null||t<0||t>=dc.length)return null;let e=dc[t];if(!e)return null;let n=Number(e.quantity);return Number.isFinite(n)?n:null}function nm(t=!1){if(Ea==null){S0(null),cc=null;return}let e=KL(Ea);!t&&e===cc||(S0(e),cc=e)}async function UL(){try{return await ce.inventory.myInventory.get()}catch{return null}}async function VL(){try{let t=await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();return typeof t=="number"?t:null}catch{return null}}async function E0(){if(!b0){b0=!0,dc=v0(await UL()),Ea=await VL(),nm(!0);try{await ce.inventory.myInventory.onChange(t=>{dc=v0(t),nm()})}catch{}try{await ce.inventory.myPossiblyNoLongerValidSelectedItemIndex.onChange(t=>{typeof t=="number"?Ea=t:Ea=null,cc=null,nm(!0)})}catch{}}}var YL=3600,C0=30,QL=30,sm=t=>t?gt[t]??null:null,JL=t=>t?an[t]??null:null,M0=t=>{let e=t?.targetScale;return typeof e=="number"&&Number.isFinite(e)?e:1},$L=t=>{let e=t?.xp;return typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):0},am=t=>{let e=sm(t?.petSpecies??"");if(!e)return 0;let n=typeof e.maxScale=="number"&&e.maxScale>1?e.maxScale:1,r=M0(t),s=(n>1?(r-1)/(n-1):0)*20+80,a=Math.floor(Number.isFinite(s)?s:0);return Math.max(a,0)},ZL=t=>{let e=t-QL;return Math.max(e,0)},A0=t=>{let e=sm(t?.petSpecies??"");if(!e)return 0;let n=typeof e.hoursToMature=="number"&&e.hoursToMature>0?e.hoursToMature:1,r=am(t);if(r<=0)return 0;let o=$L(t)/(n*YL),s=Math.min(Math.floor(o*C0),C0),a=ZL(r),i=Math.min(a+s,r);return Math.max(i,0)},T0=t=>(Array.isArray(t?.mutations)?t.mutations:[]).reduce((n,r)=>{let s=JL(r)?.coinMultiplier;return typeof s=="number"&&Number.isFinite(s)&&s>0?n*s:n},1),XL=t=>{let e=sm(t?.petSpecies??"");if(!e)return 0;let n=typeof e.maturitySellPrice=="number"?e.maturitySellPrice:0,r=am(t);if(r<=0)return 0;let o=A0(t),s=M0(t),a=T0(t),i=n*(o/r)*s*a;return Number.isFinite(i)?Math.round(Math.max(i,0)):0},im=t=>({value:XL(t),strength:A0(t),maxStrength:am(t),coinMultiplier:T0(t)});var k0=[{itemType:"Seed",identifierKey:"species",resolveCoinPrice:t=>{if(!t)return null;let n=De[t]?.seed?.coinPrice;return Xo(n)},logKey:"seeds",emptyLogMessage:"[InventorySorting] Aucune seed trouv\xE9e dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({species:t,quantity:e,coinPrice:n,value:r})},{itemType:"Tool",identifierKey:"toolId",resolveCoinPrice:t=>{if(!t)return null;let n=Jt[t]?.coinPrice;return Xo(n)},logKey:"tools",emptyLogMessage:"[InventorySorting] Aucun tool trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({toolId:t,quantity:e,coinPrice:n,value:r})},{itemType:"Egg",identifierKey:"eggId",resolveCoinPrice:t=>{if(!t)return null;let n=Qt[t]?.coinPrice;return Xo(n)},logKey:"eggs",emptyLogMessage:"[InventorySorting] Aucun egg trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({eggId:t,quantity:e,coinPrice:n,value:r})},{itemType:"Decor",identifierKey:"decorId",resolveCoinPrice:t=>{if(!t)return null;let n=ut[t]?.coinPrice;return Xo(n)},logKey:"decors",emptyLogMessage:"[InventorySorting] Aucun decor trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({decorId:t,quantity:e,coinPrice:n,value:r})}],Ca=null,uc=null,eR=null,lm=0,cm=new Set;function Xo(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()){let e=Number(t);return Number.isFinite(e)?e:null}return null}function tR(t){if(!t||typeof t!="object")return null;let e=t.items;return Array.isArray(e)?e:[]}function P0(t){if(typeof t=="string"){let e=t.trim();return e||null}return typeof t=="number"&&Number.isFinite(t)?String(t):null}function nR(t){return k0.find(e=>e.itemType===t)}function L0(t,e={}){if(!t||typeof t!="object")return null;let n=typeof t?.itemType=="string"?t.itemType.trim():"";if(!n)return null;switch(n){case"Pet":{let o=im(t).value;return typeof o=="number"&&Number.isFinite(o)?o:null}case"Plant":{let r=Array.isArray(t?.slots)?t.slots:[],o=e.playersInRoom??void 0,s=0;for(let a of r){let i=typeof a?.species=="string"?a.species:null,l=a?.targetScale,c=Number.isFinite(l)?l:Number(l),d=Number.isFinite(c)?c:null,u=Array.isArray(a?.mutations)?a.mutations.filter(h=>typeof h=="string"):[];if(!i||d==null)continue;let y=Jr(i,d,u,{friendPlayers:o});typeof y=="number"&&Number.isFinite(y)&&(s+=y)}return s}case"Produce":{let r=e.playersInRoom??void 0,o=Jl(t,void 0,r);return typeof o=="number"&&Number.isFinite(o)?o:null}default:{let r=nR(n);if(!r)return null;let o=P0(t?.[r.identifierKey]),s=Xo(t?.quantity),a=r.resolveCoinPrice(o);if(s==null||a==null)return null;let i=a*s;return Number.isFinite(i)?i:null}}}function rR(t){let n=t.filter(o=>(typeof o?.itemType=="string"?o.itemType.trim():"")==="Pet").map(o=>{let s=im(o),a=typeof o?.id=="string"?o.id:null,i=typeof o?.name=="string"&&o.name.trim()?o.name:null,l=typeof o?.petSpecies=="string"?o.petSpecies:null;return{id:a,name:i,petSpecies:l,value:s.value,strength:s.strength,maxStrength:s.maxStrength,coinMultiplier:s.coinMultiplier}});return{totalValue:n.reduce((o,s)=>o+(Number.isFinite(s.value)?s.value:0),0),pets:n}}function oR(t,e){let r=t.filter(s=>(typeof s?.itemType=="string"?s.itemType.trim():"")==="Plant").map(s=>{let a=typeof s?.id=="string"?s.id:null,i=typeof s?.species=="string"?s.species:null,l=Number.isFinite(s?.plantedAt)?s.plantedAt:null,c=Number.isFinite(s?.maturedAt)?s.maturedAt:null,u=(Array.isArray(s?.slots)?s.slots:[]).map(h=>{let f=typeof h?.species=="string"?h.species:null,p=h?.targetScale,m=Number.isFinite(p)?p:Number(p),g=Number.isFinite(m)?m:null,S=Array.isArray(h?.mutations)?h.mutations.filter(x=>typeof x=="string"):[],w=f&&g!=null?Jr(f,g,S,{friendPlayers:e}):0;return{species:f,targetScale:g,mutations:S,value:w}}),y=u.reduce((h,f)=>h+(Number.isFinite(f.value)?f.value:0),0);return{id:a,species:i,plantedAt:l,maturedAt:c,value:y,slots:u}});return{totalValue:r.reduce((s,a)=>s+(Number.isFinite(a.value)?a.value:0),0),playersInRoom:Number.isFinite(e)?e:null,plants:r}}function sR(t,e){let r=t.filter(s=>(typeof s?.itemType=="string"?s.itemType.trim():"")==="Produce").map(s=>{let a=typeof s?.id=="string"?s.id:null,i=typeof s?.species=="string"?s.species:null,l=s?.scale,c=Number.isFinite(l)?l:Number(l),d=Number.isFinite(c)?c:null,u=Array.isArray(s?.mutations)?s.mutations.filter(h=>typeof h=="string"):[],y=Jl(s,void 0,e);return{id:a,species:i,scale:d,mutations:u,value:y}});return{totalValue:r.reduce((s,a)=>s+(Number.isFinite(a.value)?a.value:0),0),crops:r}}function aR(t){let e={seeds:{totalValue:0,items:[]},tools:{totalValue:0,items:[]},eggs:{totalValue:0,items:[]},decors:{totalValue:0,items:[]}};for(let n of k0){let o=t.filter(a=>(typeof a?.itemType=="string"?a.itemType.trim():"")===n.itemType).map(a=>{let i=a?.[n.identifierKey],l=P0(i),c=a?.quantity,d=Xo(c),u=n.resolveCoinPrice(l),y=d!=null&&u!=null?u*d:null;return n.createEntry(l,d,u,y)}),s=o.reduce((a,i)=>{let l=i.value;return typeof l=="number"&&Number.isFinite(l)?a+l:a},0);e[n.logKey]={totalValue:s,items:o}}return e}async function iR(){try{let t=await ce.server.numPlayers.get();return Number.isFinite(t)?t:void 0}catch{return}}async function lR(t){let e=tR(t);if(e===null)return null;let n=e??[],r=await iR();return{pets:rR(n),plants:oR(n,r),crops:sR(n,r),misc:aR(n)}}function cR(t){for(let e of cm)try{e(t)}catch(n){console.warn("[InventoryValue] Listener error",n)}}async function I0(t){let e=++lm;try{let n=await lR(t);if(e!==lm)return;Ca=n,cR(Ca)}catch(n){if(e!==lm)return;Ca=null,console.warn("[InventoryValue] Impossible de calculer la valeur de l'inventaire",n)}}async function R0(){return uc||(uc=(async()=>{try{let t=await ce.inventory.myInventory.get();await I0(t)}catch(t){Ca=null,console.warn("[InventoryValue] Impossible de r\xE9cup\xE9rer l'inventaire initial",t)}try{eR=await ce.inventory.myInventory.onChange(t=>{I0(t)})}catch(t){console.warn("[InventoryValue] Impossible de s'abonner \xE0 myInventory",t)}})(),uc)}function _0(){return Ca}function N0(t){return cm.add(t),()=>{cm.delete(t)}}var Z0={gridSelector:"div.McGrid.css-1kv58ap",filtersBlockSelector:".McGrid.css-o1vp12",closeButtonSelector:"button.css-vuqwsg",checkboxSelector:"label.chakra-checkbox.css-1v6h4z7",checkboxLabelSelector:".chakra-checkbox__label",injectDarkStyles:!0},X0="input.chakra-input.css-8e1l1i";var dm=["alpha","qty","rarity","value"],ev=["none","alpha","qty","rarity","value","size","mutations","strength"],tv="mg-mod.inventory.sortKey",dR=new Set(ev),nv="mg-mod.inventory.sortDirection",uR=new Set(["asc","desc"]),rv="Order:",pR={asc:"Ascending",desc:"Descending"},D0=t=>{if(typeof t!="string")return null;let e=t.trim();if(!e)return null;let r=(Bt[e]??null)?.name;if(typeof r!="string")return null;let o=r.trim();return o||null},ov="mg-mod.inventory.showValues",mR=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(ov)??null;return t==="1"?!0:t==="0"?!1:null}catch(t){return console.warn("[InventorySorting] Impossible de lire la pr\xE9f\xE9rence d'affichage des valeurs d'inventaire",t),null}},fR=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(ov,t?"1":"0")}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder la pr\xE9f\xE9rence d'affichage des valeurs d'inventaire",e)}},sv=!0,Ma=t=>{sv=t},yR=()=>sv,es={none:"asc",alpha:"asc",qty:"desc",rarity:"asc",value:"desc",size:"desc",mutations:"desc",strength:"desc"},_n=["asc","desc"],gR=t=>typeof t=="string"&&dR.has(t),hR=t=>typeof t=="string"&&uR.has(t),bR=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(tv)??null;return gR(t)?t:null}catch(t){return console.warn("[InventorySorting] Impossible de lire la valeur de tri persist\xE9e",t),null}},pc=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(tv,t)}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder la valeur de tri",e)}},SR=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(nv)??null;return hR(t)?t:null}catch(t){return console.warn("[InventorySorting] Impossible de lire l'ordre de tri persist\xE9",t),null}},mc=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(nv,t)}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder l'ordre de tri",e)}},av={seed:[],tool:[],decor:[],crop:["size","mutations"],produce:["size","mutations"],plant:[],pet:["mutations","strength"]},gm=new Map,hm=new Set,vR=t=>(hm.add(t),()=>{hm.delete(t)}),wR=t=>{hm.forEach(e=>{try{e(t)}catch(n){console.warn("[InventorySorting] Listener de contexte de filtre en erreur",n)}})},iv={none:"None",alpha:"A\u2013Z",qty:"Quantity",rarity:"Rarity",value:"Values",size:"Size",mutations:"Mutations",strength:"Strength"},gc="tmInventoryBaseIndex",q0=".McFlex.css-zo8r2v",xR=".McFlex.css-1p00rng",bm="tm-inventory-item-value",O0=`${bm}__text`,Aa="tmInventoryValue",lv="\u2026",um="\u2014",pm="tm-value-toggle__summary-icon",F0="tm-value-toggle__summary-text",B0=(()=>{let t=po?.img64??"";return typeof t!="string"||!t?"":t.startsWith("data:")?t:`data:image/png;base64,${t}`})(),mm=B0?`url("${B0}")`:"";function H0(t){return t.map(e=>e.wrapper)}function ER(t,e){if(!t||t.length!==e.length)return!0;for(let n=0;n<e.length;n++)if(t[n]!==e[n].wrapper)return!0;return!1}var CR=(t,e=120)=>{let n;return(...r)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}};function MR(t){if(!t||!document.contains(t))return!1;let e=t.getBoundingClientRect(),n=getComputedStyle(t);return n.display==="none"||n.visibility==="hidden"||n.opacity==="0"?!1:e.width>0&&e.height>0}var AR=t=>t.matches("[data-checked]")||!!t.querySelector("[data-checked]"),Ft=t=>(t??"").trim().toLowerCase(),wm=(t,e)=>{let n=t.map(o=>Ft(o)).filter(o=>o&&o!=="all");n.sort();let r=Ft(e);return`${n.join("|")}::${r}`},TR=(t,e)=>{if(t===e)return!0;if(!t||!e||t.size!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0},IR=t=>gm.get(t)??null,kR=(t,e)=>{let n=wm(t,e);return IR(n)},PR=(t,e)=>{let n=new Set;e.forEach(o=>{let s=Ft(o);s&&n.add(s)});let r=gm.get(t)??null;r&&TR(r,n)||(gm.set(t,n),wR(t))},LR=t=>t?t.querySelector(X0)??null:null,RR=t=>{let e=LR(t);return typeof e?.value=="string"?e.value:""},Yn=t=>Ft(RR(t)),_R=async(t,e,n)=>{if(t)try{let r=await ce.inventory.myInventory.get();if(!r||typeof r!="object"){console.log("[InventorySorting] Inventaire introuvable pour le log de recherche.");return}let o=Array.isArray(r.items)?r.items:[],{filteredItems:s}=xc(o,e,n),a=bc(t),i=a?Sc(a):[];console.log("[InventorySorting] R\xE9sultats filtr\xE9s (recherche) :",s),console.log("[InventorySorting] Nombre d'\xE9l\xE9ments DOM pour la recherche :",i.length)}catch(r){console.warn("[InventorySorting] Impossible de journaliser les r\xE9sultats filtr\xE9s de la recherche",r)}},Sm=[me.Common,me.Uncommon,me.Rare,me.Legendary,me.Mythic,me.Divine,me.Celestial].filter(Boolean),NR=(()=>{let t=new Map;Sm.forEach((n,r)=>{let o=Ft(n);o&&t.set(o,r)});let e=t.get(Ft(me.Mythic));return typeof e=="number"&&t.set(Ft("Mythic"),e),t})(),W0=t=>{let e=Ft(t);return e?NR.get(e)??Sm.length:Sm.length},DR=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"],wc=t=>t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),qR=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=wc(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(De)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})(),OR=t=>{if(typeof t!="string")return null;let e=wc(t.trim());if(!e)return null;let n=qR.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null},hc=(t,e,n)=>Math.max(e,Math.min(n,t)),FR=(t,e)=>{if(!Number.isFinite(t))return 50;let n=50,r=100,o=1,s=Math.max(o,t);if(typeof e=="number"&&Number.isFinite(e)&&e>o){let u=(Math.min(e,s)-o)/(e-o),y=n+u*(r-n);return hc(Math.round(y),n,r)}let a=2,l=(Math.min(a,s)-o)/(a-o),c=n+l*(r-n);return hc(Math.round(c),n,r)},fm=(t,e)=>{if(!(!t||typeof t!="object"))for(let n of DR){let r=t[n];if(typeof r=="string"){let o=r.trim();o&&e.add(o)}}},BR=(t,e)=>{if(!Number.isFinite(e))return null;let n=null;for(let r of t)if(n=OR(r),n!=null)break;return FR(e,n)},z0=t=>{if(!t||typeof t!="object")return null;let e=new Set;fm(t,e),fm(t.item,e),fm(t.data,e);let r=(typeof t.itemType=="string"?t.itemType:"").trim();if(r==="Crop"||r==="Produce"){let o=Number(t.scale);return BR(e,o)}return null},yc=(t,e)=>{if(!t||typeof t!="object")return;let n=t.mutations;if(Array.isArray(n))for(let o of n)typeof o=="string"&&o.trim()&&e.push(o.trim());let r=t.slots;if(Array.isArray(r))for(let o of r)yc(o,e)},G0=t=>{if(!t||typeof t!="object")return[];let e=[];return yc(t,e),yc(t.item,e),yc(t.data,e),e},cv={crop:["Produce"],crops:["Produce"],produce:["Produce"],seed:["Seed"],seeds:["Seed"],plant:["Plant"],plants:["Plant"],pet:["Pet"],pets:["Pet"],tool:["Tool"],tools:["Tool"],decor:["Decor"],decors:["Decor"],decoration:["Decor"],decorations:["Decor"],egg:["Egg"],eggs:["Egg"]},HR=(()=>{let t=new Map;for(let[n,r]of Object.entries(cv))for(let o of r){let s=Ft(o);if(!s)continue;let a=t.get(s)??new Set;a.add(n),t.set(s,a)}let e={};return t.forEach((n,r)=>{e[r]=Array.from(n)}),e})(),WR=(t,e)=>{if(!t)return[];let n=e[t];if(Array.isArray(n)&&n.length)return n;if(t.endsWith("s")){let r=t.slice(0,-1);if(r){let o=e[r];if(Array.isArray(o)&&o.length)return o}}return[]},zR=(t,e)=>{let n=Ft(t);if(!n)return[];let r=new Set,o=e[n];Array.isArray(o)&&o.forEach(a=>r.add(a));let s=HR[n]??[];for(let a of s){let i=e[a];Array.isArray(i)&&i.forEach(l=>r.add(l))}return Array.from(r)};function GR(t){let e=Ft(t);if(!e||e==="all")return[];let n=cv[e];if(n)return n;let r=e.endsWith("s")?e.slice(0,-1):e;if(!r)return[];let o=r.charAt(0).toUpperCase()+r.slice(1);return o?[o]:[]}function jR(t,e){if(!e)return!0;let n=new Set,r=a=>{if(a==null)return!1;if(typeof a=="string")return Ft(a).includes(e);if(typeof a=="number"||typeof a=="boolean")return Ft(String(a)).includes(e);if(Array.isArray(a)){for(let i of a)if(r(i))return!0;return!1}if(typeof a=="object"){if(n.has(a))return!1;n.add(a);for(let[i,l]of Object.entries(a))if(i!=="itemType"){if(i==="abilities"){if(Array.isArray(l))for(let c of l){let d=D0(c);if(d&&r(d))return!0}continue}if(r(l))return!0}}return!1},o=Array.isArray(t?.abilities)?t.abilities.map(a=>D0(a)).filter(a=>typeof a=="string"&&!!a):[],s=[vm(t),typeof t?.species=="string"?t.species:null,typeof t?.seedSpecies=="string"?t.seedSpecies:null,typeof t?.plantSpecies=="string"?t.plantSpecies:null,typeof t?.petSpecies=="string"?t.petSpecies:null,typeof t?.eggId=="string"?t.eggId:null,typeof t?.decorId=="string"?t.decorId:null,typeof t?.toolId=="string"?t.toolId:null,typeof t?.id=="string"?t.id:null,...o];for(let a of s)if(r(a))return!0;return r(t)}function KR(t){let n=_0()?.plants?.playersInRoom??null;for(let r of t){if(!r||typeof r!="object")continue;let o=L0(r,{playersInRoom:n});r.value=o??null}}function xc(t,e,n){let r=e.map(y=>Ft(y)).filter(Boolean),o=new Set,s=!1;for(let y of r){let h=GR(y);if(h.length){s=!0;for(let f of h)f&&o.add(f)}}let a=!s,i=a?t.slice():t.filter(y=>{let h=typeof y?.itemType=="string"?y.itemType.trim():"";return h?o.has(h):!1}),l=Ft(n),c=l?i.filter(y=>jR(y,l)):i;KR(c);let d=new Set;for(let y of c){let h=typeof y?.itemType=="string"?y.itemType.trim():"";h&&d.add(h)}let u=wm(e,l);return PR(u,d),{filteredItems:c,keepAll:a,itemTypes:o,detectedItemTypes:d}}function bc(t){return t.querySelector(q0)||document.querySelector(q0)}function Sc(t){let e=[],n=Array.from(t.children);for(let r of n){if(!(r instanceof HTMLElement))continue;if(r.matches(".css-vmnhaw")){e.push({wrapper:r,card:r});continue}let o=r.querySelector(".css-vmnhaw");o instanceof HTMLElement&&e.push({wrapper:r,card:o})}return e}var UR=[{threshold:1e12,suffix:"T"},{threshold:1e9,suffix:"B"},{threshold:1e6,suffix:"M"},{threshold:1e3,suffix:"K"}],vc=typeof Intl<"u"&&typeof Intl.NumberFormat=="function"?new Intl.NumberFormat(void 0,{maximumFractionDigits:2,minimumFractionDigits:0}):null,dv=t=>{let e=Math.abs(t);for(let{threshold:n,suffix:r}of UR)if(e>=n)return`${(t/n).toFixed(1).replace(/\.0$/,"")}${r}`;return vc?vc.format(t):String(t)},uv=t=>vc?vc.format(t):String(t),pv=t=>{if(!t||typeof t!="object")return null;let e=t.value;if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim()){let n=Number(e);return Number.isFinite(n)?n:null}return null},VR=t=>t?t.__valueSummary??null??t.querySelector(".tm-value-toggle__summary"):null,YR=t=>{if(t.style.gap||(t.style.gap="0.25rem"),mm){let n=t.querySelector(`.${pm}`);n&&n.tagName!=="SPAN"&&(n.remove(),n=null),n||(n=document.createElement("span"),n.className=pm,n.setAttribute("aria-hidden","true"),n.style.width="1.2rem",n.style.height="1.2rem",n.style.flexShrink="0",n.style.display="inline-block",n.style.backgroundSize="contain",n.style.backgroundRepeat="no-repeat",n.style.backgroundPosition="center",n.style.pointerEvents="none",n.style.userSelect="none",t.insertBefore(n,t.firstChild)),n&&n.style.backgroundImage!==mm&&(n.style.backgroundImage=mm)}else t.querySelector(`.${pm}`)?.remove();let e=t.querySelector(`.${F0}`);return e||(e=document.createElement("span"),e.className=F0,e.style.fontWeight="700",e.style.color="inherit",t.appendChild(e)),e},eo=(t,e,n)=>{if(!t)return;let r=YR(t);r.textContent=e,n?t.title=n:t.removeAttribute("title")};async function j0(t,e,n){if(!t)return;let r=VR(t);if(!r)return;let o=Symbol("value-summary");t.__valueSummaryToken=o,eo(r,lv);try{let s=await ce.inventory.myInventory.get();if(t.__valueSummaryToken!==o)return;if(!s||typeof s!="object"){eo(r,um);return}let a=Array.isArray(s.items)?s.items:[],{filteredItems:i}=xc(a,e,n);if(!i.length){eo(r,"0","0");return}let l=0,c=!1;for(let y of i){let h=pv(y);typeof h=="number"&&Number.isFinite(h)&&(l+=h,c=!0)}if(!c){eo(r,um);return}let d=dv(l),u=uv(l);eo(r,d,u)}catch(s){if(console.warn("[InventorySorting] Impossible de calculer la valeur filtr\xE9e",s),t.__valueSummaryToken!==o)return;eo(r,um)}}function QR(t,e){let n=t.querySelector(xR),r=t.dataset[Aa];if(!n){r!=null&&delete t.dataset[Aa];return}let o=n.querySelector(`.${bm}`);if(!yR()){o?.parentElement&&o.parentElement.removeChild(o),r!=null&&delete t.dataset[Aa];return}if(typeof e!="number"||!Number.isFinite(e)){o?.parentElement&&o.parentElement.removeChild(o),r!=null&&delete t.dataset[Aa];return}let s=dv(e),a=uv(e),i=o;i||(i=document.createElement("div"),i.className=bm),Object.assign(i.style,{fontSynthesis:"none",WebkitFontSmoothing:"antialiased",WebkitTextSizeAdjust:"100%",display:"inline-flex",alignItems:"center",justifyContent:"flex-start",gap:"0.15rem",marginTop:"3px",fontFamily:'var(--chakra-fonts-body, "GreyCliff CF", sans-serif)',fontWeight:"700",fontSize:"0.65rem",lineHeight:"1",textTransform:"none",color:"var(--chakra-colors-Yellow-Magic, #F3D32B)"});let l=i.querySelector(`.${O0}`);l||(i.textContent="",l=document.createElement("span"),l.className=O0,l.style.display="inline-flex",l.style.alignItems="center",l.style.color="inherit",i.appendChild(l)),l.textContent=s,i.title=a,t.dataset[Aa]=String(e),(i.parentElement!==n||i!==n.lastElementChild)&&n.appendChild(i)}function JR(t){t.forEach((e,n)=>{e.wrapper.dataset[gc]=String(n),e.card.dataset[gc]=String(n)})}function ym(t){let e=t.wrapper.dataset[gc]??t.card.dataset[gc];if(e==null)return null;let n=Number(e);return Number.isFinite(n)?n:null}var Ta=t=>typeof t=="string"?t.trim():"",$R=(t,e)=>{let n=t;for(let r of e){if(!n||typeof n!="object")return"";n=n[r]}return Ta(n)},mv=(t,e)=>{for(let n of e){let r=$R(t,n);if(r)return r}return""},ZR=t=>De[t],XR=t=>gt[t],e2=t=>Qt[t],t2=t=>Jt[t],n2=t=>ut[t],r2=[["seed","name"],["plant","name"],["crop","name"]],o2=[["seed","rarity"],["crop","rarity"],["plant","rarity"]],K0=[["crop","name"],["plant","name"],["seed","name"]],U0=[["crop","rarity"],["plant","rarity"],["seed","rarity"]],s2=[["plant","name"],["crop","name"],["seed","name"]],a2=[["plant","rarity"],["crop","rarity"],["seed","rarity"]],fc=(t,e,n)=>({identifierField:t,getEntry:ZR,getNamePaths:e,getRarityPaths:n}),i2={Seed:fc("species",r2,o2),Crop:fc("species",K0,U0),Produce:fc("species",K0,U0),Plant:fc("species",s2,a2),Pet:{identifierField:"petSpecies",getEntry:XR,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Egg:{identifierField:"eggId",getEntry:e2,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Tool:{identifierField:"toolId",getEntry:t2,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Decor:{identifierField:"decorId",getEntry:n2,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]}},fv=t=>i2[t]??null,vm=t=>{if(!t||typeof t!="object")return"";let e=Ta(t.itemType),n=fv(e);if(n){let s=Ia(t,n.identifierField)??"";if(s){let a=n.getEntry(s),i=n.getNamePaths?mv(a,n.getNamePaths):"";return i||s}}let r=Ta(t.name);if(r)return r;let o=Ta(t.id);return o||e},l2=new Set(["Produce","Crop","Plant","Pet"]),V0=t=>{if(!t||typeof t!="object")return 0;let n=(typeof t.itemType=="string"?t.itemType:"").trim();if(l2.has(n))return 1;let r=t.quantity,o=Number(r);return Number.isFinite(o)&&o>=0?o:0},Y0=t=>{if(!t||typeof t!="object")return"";let e=Ta(t.itemType),n=fv(e);if(!n||!n.getRarityPaths?.length)return"";let r=Ia(t,n.identifierField)??"";if(!r)return"";let o=n.getEntry(r);return mv(o,n.getRarityPaths)},yv=(t,e,n)=>{if(!t||typeof t!="object")return null;let r=[t,t.item,t.data];for(let o of r){if(!o||typeof o!="object")continue;let s=o[e],a=n(s);if(a!=null)return a}return null},Ia=(t,e)=>yv(t,e,n=>{if(typeof n!="string")return null;let r=n.trim();return r||null}),Q0=(t,e)=>yv(t,e,n=>{if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"&&n.trim()){let r=Number(n);return Number.isFinite(r)?r:null}return null}),c2=(()=>{let t=new Map,e=(n,r,o)=>{if(typeof n!="string")return;let s=wc(n);!s||t.has(s)||t.set(s,{maxScale:r,hoursToMature:o})};for(let[n,r]of Object.entries(gt)){let o=Number(r?.maxScale),s=Number(r?.hoursToMature);!Number.isFinite(o)||o<=1||!Number.isFinite(s)||s<=0||(e(n,o,s),e(r?.name,o,s))}return t})(),d2=t=>{if(typeof t!="string")return null;let e=wc(t);return e?c2.get(e)??null:null},J0=t=>{if(!t||typeof t!="object"||(typeof t.itemType=="string"?t.itemType:"").trim()!=="Pet")return null;let r=Q0(t,"xp"),o=typeof r=="number"&&Number.isFinite(r)?r:0,s=Q0(t,"targetScale"),a=typeof s=="number"&&Number.isFinite(s)?s:1,i=new Set,l=Ia(t,"petSpecies");l&&i.add(l);let c=Ia(t,"species");c&&i.add(c);let d=Ia(t,"name");d&&i.add(d);let u=null;for(let T of i)if(u=d2(T),u)break;if(!u)return null;let{maxScale:y,hoursToMature:h}=u;if(!Number.isFinite(y)||y<=1||!Number.isFinite(h)||h<=0)return null;let f=Math.max(0,o),p=h*3600,m=p>0?Math.min(Math.floor(f/p*30),30):0,g=1,S=hc(a,g,y),w=y-g,x=w>0?Math.floor((S-g)/w*20+80):80,E=m+x-30;return hc(E,0,100)},Xr=(t,e)=>{let n=vm(t),r=vm(e);if(n&&r){let c=n.localeCompare(r,void 0,{sensitivity:"base"});if(c!==0)return c}if(!n&&r)return 1;if(n&&!r)return-1;let o=typeof t?.itemType=="string"?t.itemType:"",s=typeof e?.itemType=="string"?e.itemType:"",a=o.localeCompare(s,void 0,{sensitivity:"base"});if(a!==0)return a;let i=typeof t.id=="string"?t.id:"",l=typeof e.id=="string"?e.id:"";return i.localeCompare(l,void 0,{sensitivity:"base"})};function gv(t,e,n){let r=t.slice(),o=n==="desc";switch(e){case"alpha":r.sort((s,a)=>{let i=Xr(s,a);return o?-i:i});break;case"qty":r.sort((s,a)=>{let i=V0(s),l=V0(a);if(i!==l){let c=i-l;return o?-c:c}return Xr(s,a)});break;case"rarity":r.sort((s,a)=>{let i=Y0(s),l=Y0(a),c=W0(i),d=W0(l);if(c!==d){let y=c-d;return o?-y:y}let u=i.localeCompare(l,void 0,{sensitivity:"base"});return u!==0?u:Xr(s,a)});break;case"value":r.sort((s,a)=>{let i=s?.value,l=a?.value,c=typeof i=="number"&&Number.isFinite(i),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&i!==l){let u=i-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:Xr(s,a)});break;case"size":r.sort((s,a)=>{let i=z0(s),l=z0(a),c=typeof i=="number"&&Number.isFinite(i),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&i!==l){let u=i-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:Xr(s,a)});break;case"mutations":r.sort((s,a)=>{let i=G0(s),l=G0(a),c=i.length,d=l.length;if(c!==d){let u=c-d;return o?-u:u}if(c>0&&d>0){let u=i.slice().sort((f,p)=>f.localeCompare(p,void 0,{sensitivity:"base"})).join("\0"),y=l.slice().sort((f,p)=>f.localeCompare(p,void 0,{sensitivity:"base"})).join("\0"),h=u.localeCompare(y,void 0,{sensitivity:"base"});if(h!==0)return h}return Xr(s,a)});break;case"strength":r.sort((s,a)=>{let i=J0(s),l=J0(a),c=typeof i=="number"&&Number.isFinite(i),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&i!==l){let u=i-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:Xr(s,a)});break;default:break}return r}async function ka(t,e,n,r){try{let o=await ce.inventory.myInventory.get();if(!o||typeof o!="object"){console.log("[InventorySorting] Inventaire introuvable pour le log des filtres.");return}let s=Array.isArray(o.items)?o.items:[],{filteredItems:a,keepAll:i,itemTypes:l}=xc(s,t,r),c=e?(n&&_n.includes(n)?n:es[e])??"asc":n&&_n.includes(n)?n:"asc",d=e?gv(a,e,c):a.slice(),u=i?"toutes cat\xE9gories":`types: ${Array.from(l).join(", ")||"(aucun)"}`,y=e?`tri: ${e} (${c})`:"tri: (non sp\xE9cifi\xE9)",h=r?`recherche: "${r}"`:"recherche: (vide)";console.log(`[InventorySorting] myInventory filtr\xE9 (${u}, ${y}, ${h}).`)}catch(o){console.warn("[InventorySorting] Impossible de r\xE9cup\xE9rer myInventory pour le log",o)}}function u2(t){let e=new WeakMap,n=async(r,o,s,a)=>{let i=JSON.stringify({filters:o}),l=e.get(r),c=s.every(p=>ym(p)!=null),d=l?l.searchQuery!==a:!1,u=l?l.entryCount!==s.length:!1,y=l?l.filtersKey!==i:!1,h=l?l.baseItems.length!==s.length:!1;if(l&&!(!l||y||u||h||!c||d)){l.entryByBaseIndex.clear();for(let p of s){let m=ym(p);m!=null&&l.entryByBaseIndex.set(m,p)}return l.filtersKey=i,l.searchQuery=a,l.entryCount=s.length,l}try{let p=await ce.inventory.myInventory.get();if(!p||typeof p!="object")return console.log("[InventorySorting] Inventaire introuvable pour le tri DOM."),null;let m=Array.isArray(p.items)?p.items:[],{filteredItems:g}=xc(m,o,a);if(g.length!==s.length)return console.warn(`[InventorySorting] Nombre d'\xE9l\xE9ments filtr\xE9s (${g.length}) diff\xE9rent du DOM (${s.length}). R\xE9organisation annul\xE9e.`),null;JR(s);let S={filtersKey:i,searchQuery:a,entryCount:s.length,baseItems:g.slice(),entryByBaseIndex:new Map};return s.forEach((w,x)=>{S.entryByBaseIndex.set(x,w)}),e.set(r,S),S}catch(p){return console.warn("[InventorySorting] Impossible de r\xE9cup\xE9rer myInventory pour le tri DOM",p),null}};return async(r,o,s)=>{if(typeof document>"u")return;let a=bc(r);if(!a)return;let i=Sc(a);if(!i.length)return;let l=Rn(r,t.checkboxSelector,t.checkboxLabelSelector),c=Yn(r),d=await n(r,l,i,c);if(!d)return;let u=new Map;d.baseItems.forEach((g,S)=>{u.set(g,S)});let y=s&&_n.includes(s)?s:es[o]??"asc",h=!o||o==="none"?d.baseItems.slice():gv(d.baseItems,o,y),f=[],p=new Set;for(let g of h){let S=u.get(g);if(S==null)continue;let w=d.entryByBaseIndex.get(S);if(!w||p.has(w))continue;let x=pv(g);QR(w.card,x),f.push(w),p.add(w)}if(f.length!==i.length){console.warn(`[InventorySorting] Impossible de r\xE9ordonner l'inventaire : correspondances insuffisantes (${f.length}/${i.length}).`);return}let m=document.createDocumentFragment();f.forEach(g=>{m.appendChild(g.wrapper)}),a.appendChild(m),d.entryByBaseIndex.clear(),f.forEach(g=>{let S=ym(g);S!=null&&d.entryByBaseIndex.set(S,g)})}}function Rn(t,e,n){return Array.from(t.querySelectorAll(e)).filter(AR).map(r=>(r.querySelector(n)?.textContent??"").trim()).filter(Boolean)}function $0(t,e=iv,n=av,r=""){let o=t.map(f=>(f??"").trim().toLowerCase()).filter(Boolean),s=Ft(r),a=f=>{if(!f.length)return null;let p=new Set(f[0]);for(let m=1;m<f.length;m++){let g=f[m];p=new Set([...p].filter(S=>g.has(S)))}return p},i=o.map(f=>new Set([...dm,...WR(f,n)])),l=kR(t,s),c=[];l&&l.size&&l.forEach(f=>{let p=zR(f,n);c.push(new Set([...dm,...p]))});let d=a(i),u=a(c),y=null;return d&&u?y=new Set([...d].filter(f=>u.has(f))):d?y=new Set(d):u&&(y=new Set(u)),(!y||!y.size)&&(y=new Set(dm)),ev.filter(f=>f==="none"||y.has(f)).map(f=>({value:f,label:e[f]||f}))}function hv(){if(typeof navigator>"u")return!1;let t=navigator,e=t.userAgentData?.platform||t.platform||"";if(e&&/mac/i.test(e))return!0;let n=typeof t.userAgent=="string"?t.userAgent:"";return/mac os x/i.test(n)}function p2(){return!hv()}function m2(t="inv-sort-dark-styles"){if(document.getElementById(t))return;let e=`
    .tm-sort-select {
      color: #e7eef7 !important;
      background-color: rgba(17,17,17,0.98) !important;
      border: 1px solid rgba(255,255,255,0.25) !important;
      outline: none !important;
      -webkit-appearance: none;
      appearance: none;
      color-scheme: dark;
      padding-right: 28px !important;
    }
    .tm-sort-select:focus { box-shadow: 0 0 0 2px rgba(122,162,255,.35); }
    .tm-sort-select option { color: #e7eef7; background-color: #111; }
    .tm-sort-select option:checked { background-color: #222; }
    .tm-sort-select option:hover   { background-color: #1a1a1a; }
    .tm-select-wrap { position: relative; display: inline-flex; align-items: center; }
    .tm-select-arrow {
      position: absolute; right: 10px; top: 50%;
      transform: translateY(-50%);
      pointer-events: none; display: inline-flex; align-items: center; justify-content: center;
    }
    .tm-select-arrow svg { display: block; }
  `,n=document.createElement("style");n.id=t,n.textContent=e,document.head.appendChild(n)}function f2(t){let e=document.createElement("div");e.className="tm-sort-wrap",Object.assign(e.style,{display:"block",width:"100%",margin:"0",padding:"0",position:"relative",flex:"0 0 auto",minHeight:"0",contain:"layout style"});let n=document.createElement("div");n.className="tm-sorting-bar",Object.assign(n.style,{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"8px",marginTop:"10px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.12)",width:"100%",boxSizing:"border-box",position:"relative",flex:"0 0 auto",height:"auto",minHeight:"0",maxHeight:"none",alignSelf:"stretch"});let r=document.createElement("span");r.textContent="Sort by:",Object.assign(r.style,{font:"inherit",opacity:"0.8",flex:"0 0 auto"});let o=document.createElement("div");o.className="tm-select-wrap";let s=document.createElement("select");s.className="tm-sort-select tm-sort-select--key",t&&(Object.assign(s.style,{padding:"6px 10px",border:"1px solid rgba(255,255,255,0.25)",borderRadius:"6px",background:"rgba(17,17,17,0.98)",color:"#e7eef7",cursor:"pointer",flex:"0 0 auto",width:"auto",outline:"none",appearance:"none"}),s.style.setProperty("-webkit-appearance","none"));let a=document.createElement("span");a.className="tm-select-arrow",a.innerHTML=`
    <svg width="12" height="8" viewBox="0 0 12 8" aria-hidden="true">
      <path d="M1 1l5 5 5-5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `,t?o.append(s,a):o.append(s),n.append(r,o);let i=document.createElement("span");i.className="tm-direction-label",i.textContent=rv,Object.assign(i.style,{font:"inherit",opacity:"0.8",flex:"0 0 auto"});let l=document.createElement("div");l.className="tm-select-wrap";let c=document.createElement("select");c.className="tm-sort-select tm-direction-select";let d=t&&!hv();d&&(Object.assign(c.style,{padding:"6px 10px",border:"1px solid rgba(255,255,255,0.25)",borderRadius:"6px",background:"rgba(17,17,17,0.98)",color:"#e7eef7",cursor:"pointer",flex:"0 0 auto",width:"auto",outline:"none",appearance:"none"}),c.style.setProperty("-webkit-appearance","none"));let u=document.createElement("span");u.className="tm-select-arrow",u.innerHTML=`
    <svg width="12" height="8" viewBox="0 0 12 8" aria-hidden="true">
      <path d="M1 1l5 5 5-5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `,d?l.append(c,u):l.append(c),n.append(i,l);let y=document.createElement("span");y.className="tm-value-toggle__divider",Object.assign(y.style,{alignSelf:"stretch",width:"1px",minHeight:"24px",background:"rgba(255,255,255,0.15)",flex:"0 0 auto",opacity:"0.5"});let h=document.createElement("label");h.className="tm-value-toggle",Object.assign(h.style,{display:"inline-flex",alignItems:"center",gap:"8px",font:"inherit",opacity:"0.9",cursor:"pointer",flex:"0 0 auto"});let f=document.createElement("span");f.className="tm-value-toggle__control",Object.assign(f.style,{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",width:"36px",height:"20px",flex:"0 0 auto"});let p=document.createElement("input");p.type="checkbox",p.className="tm-value-toggle__checkbox",Object.assign(p.style,{position:"absolute",inset:"0",margin:"0",opacity:"0",cursor:"pointer"});let m=document.createElement("span");m.className="tm-value-toggle__switch",Object.assign(m.style,{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"flex-start",width:"100%",height:"100%",borderRadius:"999px",background:"rgba(255,255,255,0.25)",transition:"background 120ms ease",padding:"2px",boxSizing:"border-box"});let g=document.createElement("span");g.className="tm-value-toggle__thumb",Object.assign(g.style,{width:"16px",height:"16px",borderRadius:"50%",background:"#111",boxShadow:"0 1px 3px rgba(0,0,0,0.35)",transform:"translateX(0)",transition:"transform 120ms ease, background 120ms ease"}),m.appendChild(g),f.append(p,m);let S=document.createElement("span");S.className="tm-value-toggle__label",S.textContent="Show values",Object.assign(S.style,{font:"inherit",color:"inherit"}),h.append(f,S);let w=document.createElement("span");w.className="tm-value-toggle__summary",Object.assign(w.style,{font:"inherit",color:"var(--chakra-colors-Yellow-Magic, #F3D32B)",display:"inline-flex",alignItems:"center",justifyContent:"flex-end",flex:"1 1 auto",whiteSpace:"nowrap",marginLeft:"auto",textAlign:"right",gap:"0.25rem"}),eo(w,lv),n.append(y,h,w);let x=E=>{m.style.background=E?"var(--chakra-colors-Yellow-Magic, #F3D32B)":"rgba(255,255,255,0.25)",g.style.transform=E?"translateX(16px)":"translateX(0)",h.setAttribute("data-checked",E?"true":"false"),h.setAttribute("role","switch"),h.setAttribute("aria-checked",E?"true":"false")};return p.addEventListener("change",()=>{x(p.checked)}),e.__syncValueToggle=x,x(p.checked),e.appendChild(n),{wrap:e,bar:n,select:s,directionSelect:c,directionLabel:i,valueToggleInput:p,valueToggleLabel:h,valueSummary:w}}function y2(t,e,n,r,o,s,a,i){let l=t.querySelector(e.filtersBlockSelector);if(!l)return null;let c=null,d=l.querySelector(":scope > .tm-sort-wrap"),u,y,h=null,f=null,p=null;if(d){let g=d.querySelector("select.tm-sort-select--key"),S=d.querySelector("select.tm-direction-select");if(!g||!S)return null;u=g,y=S,h=d.querySelector(".tm-direction-label"),f=d.querySelector('label.tm-value-toggle input[type="checkbox"]'),p=d.querySelector(".tm-value-toggle__summary"),d.__valueSummary=p??null,h&&(h.textContent=o),d.parentElement!==l?(d.style.gridColumn="1 / -1",l.appendChild(d)):d.style.gridColumn="1 / -1"}else{let g=f2(n);d=g.wrap,u=g.select,y=g.directionSelect,h=g.directionLabel,f=g.valueToggleInput,p=g.valueSummary,d.__grid=t,d.__valueSummary=p??null,d.style.gridColumn="1 / -1",l.appendChild(d),h&&(h.textContent=o),f&&(f.checked=a,f.addEventListener("change",()=>{let S=f?f.checked:!1;d.__showValues=S,i(S)})),u.addEventListener("change",()=>{let S=u.value;d.__prevValue=S;let w=y?.value||"asc",x=d.__grid,E=x?Rn(x,e.checkboxSelector,e.checkboxLabelSelector):[],T=Yn(x);console.log("[InventorySorting] Tri s\xE9lectionn\xE9 :",S),ka(E,S,w,T),s(S,w,E,T)}),y.addEventListener("change",()=>{let S=y.value;d.__prevDirection=S;let w=u?.value||"none",x=d.__grid,E=x?Rn(x,e.checkboxSelector,e.checkboxLabelSelector):[],T=Yn(x);console.log("[InventorySorting] Ordre de tri s\xE9lectionn\xE9 :",S),ka(E,w,S,T),s(w,S,E,T)})}f&&(f.checked=a);let m=d.__syncValueToggle;return m&&m(f?.checked??a),d.__grid=t,d.__showValues=f?.checked??a,{wrap:d,select:u,directionSelect:y,valueToggleInput:f,valueSummary:p}}function g2(t,e,n){let r=n??t.value;t.innerHTML="";for(let o of e){let s=document.createElement("option");s.value=o.value,s.textContent=o.label,t.appendChild(s)}e.some(o=>o.value==="none")&&(t.value="none"),r&&e.some(o=>o.value===r)&&r!=="none"&&(t.value=r)}function h2(t,e,n){let r=n??t.value??null;t.innerHTML="";for(let o of _n){let s=document.createElement("option");s.value=o,s.textContent=e[o]??o,t.appendChild(s)}r&&_n.includes(r)?t.value=r:t.value=_n[0]}function b2(t={}){let e={...Z0,...t},n={...av,...e.mapExtraByFilter||{}},r={...iv,...e.labelByValue||{}},o=e.directionLabel??rv,s={...pR,...e.directionLabelByValue||{}},a={...es,...e.defaultDirectionBySortKey||{}},i=p2();e.injectDarkStyles&&i&&m2();let l=e.applySorting??u2(e),c=mR()??!0;Ma(c);let d=null,u=null,y=null,h=null,f=null,p=null,m=null,g=null,S=null,w=null,x=!0,E=null,T=null,A=null,N=null,H=k=>{if(!k){E=null;return}let V=bc(k);if(!V){E=null;return}let ee=Sc(V);E=H0(ee)},C=(k,V,ee)=>Promise.resolve(l(k,V,ee)).then(()=>{H(k)}),L=new MutationObserver(k=>{k.some(ee=>ee.type==="attributes"?["data-checked","style","class","hidden","aria-hidden"].includes(ee.attributeName||""):ee.type==="childList")&&_()}),v=k=>{d!==k&&(L.disconnect(),d=k,m=null,g=null,S=null,E=null,T=null,N=null,x=!0,!d&&p&&(p(),p=null),!d&&A&&(A(),A=null),d&&L.observe(d,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-checked","style","class","hidden","aria-hidden"]}))},B=new MutationObserver(()=>{let k=!!(d&&document.contains(d));!k&&d&&v(null);let V=k?d:null,ee=document.querySelector(e.gridSelector);ee!==V&&(v(ee),ee&&de())}),le=()=>{if(d&&document.contains(d))return d;let k=document.querySelector(e.gridSelector);return k!==d&&v(k),d&&document.contains(d)?d:null},X=()=>{let k=le();if(!k)return;let V=y?.value??"none",ee=a[V]??es[V]??"asc",ie=h?.value??ee;C(k,V,ie)},de=()=>{let k=le();if(!k||!MR(k)){x=!0;return}Ma(c),x&&(x=!1,R0().catch(O=>{console.warn("[InventorySorting] Impossible d'initialiser la surveillance de la valeur de l'inventaire",O)}));let V=y2(k,e,i,r,o,(O,U,ue,oe)=>{S=O,w=U,g=JSON.stringify({filters:ue??[],search:oe??""}),pc(O),mc(U),e.onSortChange?.(O,U),C(k,O,U)},c,O=>{c=O,Ma(O),fR(O),f&&(f.checked=O),X()});if(!V)return;u=V.wrap,y=V.select,h=V.directionSelect,f=V.valueToggleInput??null,p||(p=N0(()=>{let O=le();if(!O||!u)return;let U=Rn(O,e.checkboxSelector,e.checkboxLabelSelector),ue=Yn(O);j0(u,U,ue)}));let ee=Rn(k,e.checkboxSelector,e.checkboxLabelSelector),ie=bc(k),fe=ie?Sc(ie):[],G=N===null||N!==fe.length,Z=G||!y?.options?.length,j=G||!h?.options?.length,Y=ER(E,fe),ne=H0(fe),q=Yn(k);T=wm(ee,q),A||(A=vR(O=>{O===T&&setTimeout(_,0)})),j0(u,ee,q);let W=JSON.stringify({filters:ee,search:q}),b=W!==g;if(W!==m){m=W,console.log("[InventorySorting] Filtres actifs :",ee);let O=y?.value??void 0,U=h?.value??void 0;ka(ee,O,U,q)}let D=$0(ee,r,n,q),F=typeof u.__prevValue=="string"?u.__prevValue:null,P=bR(),I=(F&&D.some(O=>O.value===F)?F:null)||(P&&D.some(O=>O.value===P)?P:null);Z&&(g2(y,D,I),N=fe.length),u.__prevValue=y.value;let J=y.value,te=typeof u.__prevDirection=="string"?u.__prevDirection:null,z=SR(),M=a[J]??es[J]??"asc",K=(te&&_n.includes(te)?te:null)||(z&&_n.includes(z)?z:null)||M,$;h?(j&&h2(h,s,K),K&&_n.includes(K)&&h.value!==K&&(h.value=K),$=h.value,_n.includes($)||($=M,h.value=M),u.__prevDirection=$):$=M,J!==S||$!==w||b&&Y?(S=J,w=$,g=W,pc(J),mc($),e.onSortChange?.(J,$),C(k,J,$)):(b&&(g=W,console.log("[InventorySorting] Filtres modifi\xE9s mais la liste DOM est inchang\xE9e, tri non r\xE9appliqu\xE9.")),E=ne)},_=CR(de,120),re=k=>{let V=k.target;if(!V)return;let ee=V.closest(e.gridSelector),ie=le();if(k.type==="input"&&V instanceof HTMLInputElement&&V.matches(X0)&&ee&&ee===ie){console.log("[InventorySorting] Texte de recherche modifi\xE9 :",V.value);let fe=Rn(ie,e.checkboxSelector,e.checkboxLabelSelector),G=Yn(ie);_R(ie,fe,G)}ee&&ee===ie&&setTimeout(_,0)};return(()=>{let k=document.body||document.documentElement;k&&B.observe(k,{childList:!0,subtree:!0}),v(document.querySelector(e.gridSelector)),document.addEventListener("change",re,!0),document.addEventListener("input",re,!0),de()})(),{destroy(){L.disconnect(),B.disconnect(),document.removeEventListener("change",re,!0),document.removeEventListener("input",re,!0),p&&(p(),p=null),A&&(A(),A=null),u&&u.parentElement&&u.parentElement.removeChild(u),u=null,y=null,h=null,f=null,d=null,m=null,g=null,S=null,w=null,x=!0,E=null},update:de,getActiveFilters(){let k=le();return k?Rn(k,e.checkboxSelector,e.checkboxLabelSelector):[]},getCurrentSortKey(){return y?.value??null},getCurrentSortDirection(){return h?.value??null},setSortKey(k){if(!y)return;y.value=k,u.__prevValue=k;let V=le();if(V){let ee=Rn(V,e.checkboxSelector,e.checkboxLabelSelector),ie=Yn(V),fe=JSON.stringify({filters:ee,search:ie});console.log("[InventorySorting] Tri s\xE9lectionn\xE9 (programmatique) :",k);let G=h?.value??a[k]??es[k]??"asc";h&&(h.value=G,u.__prevDirection=G),ka(ee,k,G,ie),g=fe,S=k,w=G,pc(k),mc(G),e.onSortChange?.(k,G),Ma(c),C(V,k,G)}},setSortDirection(k){if(!h)return;h.value=k,u.__prevDirection=k;let V=le(),ee=y?.value??"none";if(V){let ie=Rn(V,e.checkboxSelector,e.checkboxLabelSelector),fe=Yn(V),G=JSON.stringify({filters:ie,search:fe});console.log("[InventorySorting] Ordre de tri s\xE9lectionn\xE9 (programmatique) :",k),ka(ie,ee,k,fe),g=G,S=ee,w=k,pc(ee),mc(k),e.onSortChange?.(ee,k),Ma(c),C(V,ee,k)}},getSortOptions(){let k=le(),V=k?Rn(k,e.checkboxSelector,e.checkboxLabelSelector):[],ee=Yn(k);return $0(V,r,n,ee)},getGrid(){return le()}}}function bv(t={}){if(typeof window>"u"||typeof document>"u")return{stop(){},refresh(){},getController(){return null}};let{waitForGrid:e=!0,log:n,...r}=t,o=r,s=null,a=null,i=null,l=typeof n=="function"?n:n?(...y)=>console.debug("[InventorySorting]",...y):()=>{},c=()=>{if(s)return s;if(e){let y=o.gridSelector??Z0.gridSelector;if(!document.querySelector(y))return null}return s=b2(o),l("attached"),s},d=()=>{if(s||a||!e)return;let y=document.body||document.documentElement;y&&(a=new MutationObserver(()=>{c()&&(a?.disconnect(),a=null,l("attached via mutation"))}),a.observe(y,{childList:!0,subtree:!0}))},u=()=>{c()||d()};return document.readyState==="loading"?(i=()=>{i=null,u()},document.addEventListener("DOMContentLoaded",i,{once:!0})):u(),{stop(){i&&(document.removeEventListener("DOMContentLoaded",i),i=null),a?.disconnect(),a=null,s?.destroy(),s=null},refresh(){s?s.update():u()},getController(){return s}}}var wv={intervalMs:6e4,log:!1},xm=t=>(t||"").replace(/\s+/g," ").trim(),S2=/game\s*update\s+ava?ilab?le/i,v2=/your\s+daily\s+bread/i,Sn=(t,...e)=>{t&&console.log("[checkModal]",...e)},Sv=!1,w2=t=>{Sv||(Sv=!0,Sn(t,"Game Update: \u267B\uFE0F rechargement de la page dans un instant..."),Re.setTimeout(()=>{Sn(t,"Game Update: \u{1F504} rechargement maintenant."),Re.location.reload()},500))},x2=t=>{if(!t||!(t instanceof HTMLElement))return!1;let e=t.getBoundingClientRect();if(e.width<=0||e.height<=0)return!1;let n=getComputedStyle(t);if(n.display==="none"||n.visibility==="hidden"||parseFloat(n.opacity)===0)return!1;let r=t;for(;r;){let o=getComputedStyle(r);if(o.display==="none"||o.visibility==="hidden")return!1;r=r.parentElement}return!0};function xv(){let t=document.querySelectorAll('section.chakra-modal__content[role="dialog"], section.chakra-modal__content[role="alertdialog"]');for(let e of t){let n=e.querySelector("header.chakra-modal__header"),r=xm(n?.textContent||e.textContent||"");if(S2.test(r))return e}return null}function Ev(){let t=document.querySelectorAll('section.chakra-modal__content[role="dialog"], section.chakra-modal__content[role="alertdialog"]');for(let e of t){let n=xm(e.textContent||"");if(!v2.test(n))continue;let r=e.querySelector("button.chakra-button.css-1o32am8");if(!r){let o=e.querySelectorAll("button");r=Array.from(o).find(s=>/claim/i.test(xm(s.textContent)))??null}if(r)return{section:e,button:r}}return null}var vv=new WeakSet;function E2(t,e){if(vv.has(t))return Sn(e,"Bread: bouton d\xE9j\xE0 cliqu\xE9 (guard)."),!1;let n=t.getAttribute("aria-disabled");return t.disabled||n==="true"?(Sn(e,"Bread: bouton d\xE9sactiv\xE9."),!1):x2(t)?(t.click(),vv.add(t),Sn(e,"Bread: \u2705 click() envoy\xE9."),!0):(Sn(e,"Bread: bouton non visible."),!1)}function Cv(t){let{log:e}={...wv,...t},n=xv(),r=!!n;r&&(Sn(e,"Game Update: \u2705 d\xE9tect\xE9.",n),w2(e));let o=Ev(),s=!!o,a=!1;return o&&(Sn(e,"Daily Bread: \u2705 d\xE9tect\xE9.",o.section),a=E2(o.button,e)),!r&&!s&&Sn(e,"Rien d\xE9tect\xE9 pour l\u2019instant."),{gameUpdateFound:r,breadFound:s,breadClicked:a}}function Em(t){let{intervalMs:e,log:n}={...wv,...t},r=!1,o=()=>r?{gameUpdateFound:!1,breadFound:!1,breadClicked:!1}:Cv({log:n});o();let s=Re.setInterval(o,e),a=()=>{r||(r=!0,Re.clearInterval(s),Sn(n,"\u23F9\uFE0F Observateur arr\xEAt\xE9."))};return Sn(n,`\u25B6\uFE0F Observateur d\xE9marr\xE9 (intervalle: ${e} ms).`),{stop:a,tick:o}}var C2={startModalObserver:Em,checkOnce:Cv,findGameUpdateModal:xv,findBreadModal:Ev};et("CheckModal",C2);var Av="activityLog.history",Mv=500;function Tv(t){if(!t||typeof t!="object")return null;let e=Number(t.timestamp);if(!Number.isFinite(e))return null;let n=(()=>{let s=t.parameters;if(!s||typeof s!="object")return s;let a=typeof s?.pet?.id=="string"?s.pet.id:null;return a&&!s.petId?{...s,petId:a}:s})(),r=typeof t.action=="string"&&t.action.trim()?String(t.action):null,o={...t,timestamp:e,parameters:n};return r!==null&&(o.action=r),o}function Cm(t){let e=[];if(!Array.isArray(t))return e;for(let n of t){let r=Tv(n);r&&e.push(r)}return e}function Mm(t){let e=new WeakSet,n=r=>{if(r===null)return null;if(typeof r!="object")return r;if(e.has(r))return"__CYCLE__";if(e.add(r),Array.isArray(r))return r.map(n);let o={},s=Object.keys(r).sort();for(let a of s)o[a]=n(r[a]);return o};try{return JSON.stringify(n(t))}catch{return""}}function M2(t){let e=t?.parameters,n=[e?.id,e?.pet?.id,e?.petId,e?.playerId,e?.userId,e?.objectId,e?.slotId,e?.itemId,e?.cropId,e?.seedId,e?.decorId,e?.toolId,e?.targetId,e?.abilityId];for(let r of n)if(typeof r=="string"&&r.trim())return r;return null}function Ec(t){let e=Number(t.timestamp),n=typeof t.action=="string"?t.action:"",r=M2(t)??"__noid__";return`${Number.isFinite(e)?String(e):`t:${Mm({timestamp:t.timestamp??null})}`}|${n}|${r}`}function Iv(t,e){return Mm(t)===Mm(e)}function kv(){try{let t=_e(Av);if(!Array.isArray(t))return[];let e=[];for(let n of t){let r=Tv(n);r&&e.push(r)}return e}catch{return[]}}function A2(t){let e=t.slice().sort((n,r)=>Number(n.timestamp||0)-Number(r.timestamp||0));e.length>Mv&&e.splice(0,e.length-Mv);try{Oe(Av,e)}catch{}}function T2(t,e){let n=new Map,r=(a,i)=>{let l=n.get(a);l?l.push(i):n.set(a,[i])};for(let a of t)r(Ec(a),a);let o=[],s=[];for(let a of e){let i=Ec(a),l=n.get(i),c=l?.shift();c?Iv(c,a)||s.push(a):o.push(a),l&&l.length===0&&n.delete(i)}return{added:o,updated:s}}function I2(t,e){let n=kv(),{added:r,updated:o}=T2(t,e);if(!r.length&&!o.length)return n;let s=new Map;for(let c of n)s.set(Ec(c),c);let a=!1,i=c=>{let d=Ec(c),u=s.get(d);(!u||!Iv(u,c))&&(s.set(d,c),a=!0)};if(o.forEach(i),r.forEach(i),!a)return n;let l=Array.from(s.values());return A2(l),l}async function k2(){try{let t=kv();await bo(t,{open:!0})}catch{}}async function Pv(){let t=[],e=[],n=async(s,a)=>{try{let i=typeof a<"u"?Cm(a):e,l=Cm(s);I2(i,l),e=l}catch{}};try{let s=Cm(await xd.get());await n(s)}catch{}try{let s=await xd.onChange((a,i)=>{n(a,i)});t.push(()=>{try{s()}catch{}})}catch{}let r=null;try{r=await ce.ui.activeModal.get()??null}catch{}let o=async s=>{let a=s??null;a===ho&&r!==ho&&await k2(),r=a};try{let s=await ce.ui.activeModal.onChange(o);t.push(()=>{try{s()}catch{}})}catch{}return async()=>{for(let s of t)try{await s()}catch{}}}var Fv="activityLog.filter",Lv="mg-activity-log-filter-style",Rv="data-mg-activity-log-filter-ready",to="mg-activity-log-filter",Pa="mg-activity-log-filter-btn",Tm="is-active",P2=["all","found","buy","sell","harvest","plant","feed","hatch","water","boost","remove","other"],L2={all:"All",found:"Finds",buy:"Purchases",sell:"Sold",harvest:"Harvests",plant:"Planted",feed:"Feed",hatch:"Hatch",water:"Water",boost:"Boosts",remove:"Remove",other:"Other"},Am={purchaseDecor:"buy",purchaseSeed:"buy",purchaseEgg:"buy",purchaseTool:"buy",waterPlant:"water",plantSeed:"plant",plantGardenPlant:"plant",potPlant:"plant",removeGardenObject:"remove",harvest:"harvest",feedPet:"feed",plantEgg:"hatch",hatchEgg:"hatch",instaGrow:"boost",customRestock:"boost",spinSlotMachine:"boost",sellAllCrops:"sell",sellPet:"sell",logItems:"boost",mutationPotion:"boost",ProduceScaleBoost:"boost",ProduceScaleBoostII:"boost",DoubleHarvest:"boost",DoubleHatch:"boost",ProduceEater:"boost",SellBoostI:"boost",SellBoostII:"boost",SellBoostIII:"boost",SellBoostIV:"boost",ProduceRefund:"boost",PlantGrowthBoost:"boost",PlantGrowthBoostII:"boost",HungerRestore:"boost",HungerRestoreII:"boost",GoldGranter:"boost",RainbowGranter:"boost",RainDance:"boost",PetXpBoost:"boost",PetXpBoostII:"boost",EggGrowthBoost:"boost",EggGrowthBoostII_NEW:"boost",EggGrowthBoostII:"boost",PetAgeBoost:"boost",PetAgeBoostII:"boost",CoinFinderI:"boost",CoinFinderII:"boost",CoinFinderIII:"boost",SeedFinderI:"boost",SeedFinderII:"boost",SeedFinderIII:"boost",SeedFinderIV:"boost",PetHatchSizeBoost:"boost",PetHatchSizeBoostII:"boost",MoonKisser:"boost",DawnKisser:"boost",PetRefund:"boost",PetRefundII:"boost"},_v=Object.fromEntries(Object.entries(Am).map(([t,e])=>[t.toLowerCase(),e])),Bv=[{key:"found",re:/\bfound\b/i},{key:"buy",re:/\b(bought|purchas(e|ed))\b/i},{key:"sell",re:/\bsold\b/i},{key:"harvest",re:/harvest/i},{key:"water",re:/water(ed)?/i},{key:"plant",re:/planted/i},{key:"feed",re:/\bfed\b/i},{key:"hatch",re:/\bhatched?\b/i},{key:"remove",re:/\b(remove|removed|delete)\b/i},{key:"boost",re:/\b(boost|potion|refund|granter|growth|restock|spin)\b/i}],Nv=!1,Qn=q2()??"all";function Hv(){Nv||typeof document>"u"||(Nv=!0,O2(),Vl(t=>t instanceof HTMLElement&&t.matches("p.chakra-text")&&/activity\s*log/i.test(t.textContent||""),t=>{let e=t.closest("div.McGrid");if(!e||e.hasAttribute(Rv))return;let n=e.querySelector("div.McFlex.css-2tfeb0")??t.closest("div.McFlex"),r=e.querySelector("div.McFlex.css-iek5kf")??e.querySelectorAll("div.McFlex")[1]??null;!n||!r||(e.setAttribute(Rv,"1"),R2(n,r))},{callForExisting:!0}))}function R2(t,e){let n=document.createElement("div");n.className=to,n.style.width="100%",n.style.boxSizing="border-box",n.style.gridColumn="1 / -1",n.style.alignSelf="start",n.style.justifyContent="flex-start",n.style.flex="0 0 auto",n.style.minHeight="auto";let r=document.createElement("span");r.textContent="Filter by action:",r.className=`${to}__label`;let o=document.createElement("div");o.className=`${to}__buttons`,o.style.flex="1 1 100%",o.style.minWidth="0",o.style.alignItems="center",n.append(r,o),e.insertBefore(n,e.firstChild);let s=e.querySelector("div.McFlex.css-173k61n")??e.querySelector("div.McFlex")??e,a=u=>{let y=N2(Array.from(u.keys()));y.includes("all")||y.unshift("all"),o.innerHTML="";for(let h of y){let f=u.get(h)??0,p=document.createElement("button");p.type="button",p.className=`${Pa}${h===Qn?` ${Tm}`:""}`,p.textContent=`${D2(h)}${f?` (${f})`:""}`,p.dataset.action=h,p.addEventListener("click",()=>{Qn=h,Ov(h),qv(o),Dv(s,Qn)}),o.appendChild(p)}},i=()=>{let u=new Map;for(let y of zv(s)){let h=Wv(y);u.set(h,(u.get(h)??0)+1)}a(u),!u.has(Qn)&&Qn!=="all"&&(Qn="all",Ov(Qn),qv(o)),Dv(s,Qn)},l=new MutationObserver(()=>i());l.observe(s,{childList:!0,subtree:!0}),i();let c=()=>l.disconnect(),d=()=>c();n.addEventListener("DOMNodeRemovedFromDocument",d,{once:!0})}function Wv(t){let e=t.dataset.action||t.getAttribute("data-action")||t.getAttribute("data-activity")||t.dataset.mgAction;if(e&&typeof e=="string"){let r=e.trim();if(r){let o=_2(r);return t.dataset.mgAction=o,o}}let n=(t.textContent||"").trim();for(let{key:r,re:o}of Bv)if(o.test(n))return t.dataset.mgAction=r,r;return t.dataset.mgAction="other","other"}function _2(t){let e=t.toLowerCase();if(Am[t])return Am[t];if(_v[e])return _v[e];for(let{key:n,re:r}of Bv)if(r.test(e))return n;return e||"other"}function zv(t){return Array.from(t.children).filter(n=>n instanceof HTMLElement).filter(n=>{if(n.classList.contains(to))return!1;let r=n.textContent||"";return/\bago\b/i.test(r)||n.querySelector("p.chakra-text")})}function N2(t){let e=new Set,n=[];for(let r of P2)r!=="all"&&t.includes(r)&&!e.has(r)&&(e.add(r),n.push(r));for(let r of t)r!=="all"&&(e.has(r)||(e.add(r),n.push(r)));return n}function Dv(t,e){for(let n of zv(t)){let r=n.dataset.mgAction??Wv(n),o=e==="all"||r===e;n.style.display=o?"":"none"}}function qv(t){t.querySelectorAll(`.${Pa}`).forEach(e=>{if(!(e instanceof HTMLButtonElement))return;let n=e.dataset.action;e.classList.toggle(Tm,n===Qn)})}function D2(t){return L2[t]??t.replace(/[_-]+/g," ").replace(/\b\w/g,e=>e.toUpperCase())}function q2(){try{return _e(Fv)||null}catch{return null}}function Ov(t){try{Oe(Fv,String(t))}catch{}}function O2(){if(document.getElementById(Lv))return;let t=`
.${to}{
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px 10px;
  margin:8px 0 10px 0;
  border-radius:12px;
  background:linear-gradient(180deg, #f7e8d4, #f1dcc1);
  border:1px solid #d7b989;
  box-shadow:inset 0 1px 0 rgba(255,255,255,0.45), 0 6px 14px rgba(120,70,34,0.22);
  flex-wrap:wrap;
  max-width:100%;
  box-sizing:border-box;
}
.${to}__label{
  font-size:12px;
  letter-spacing:0.03em;
  text-transform:uppercase;
  opacity:0.85;
  font-weight:700;
  color:#7b4b2b;
}
.${to}__buttons{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  flex:1 1 100%;
  min-width:0;
}
.${Pa}{
  border:1px solid #caa56f;
  background:linear-gradient(180deg, #ffe9c8, #f6d7aa);
  color:#5c3416;
  border-radius:999px;
  padding:4px 10px;
  font-size:12px;
  cursor:pointer;
  transition:background 120ms ease, border-color 120ms ease, transform 120ms ease;
  white-space:nowrap;
}
.${Pa}:hover{
  background:linear-gradient(180deg, #ffe2b2, #f3c98d);
  border-color:#d7b989;
}
.${Pa}.${Tm}{
  background:linear-gradient(180deg, #ffcd82, #f3b05e);
  border-color:#e3a23d;
  box-shadow:0 0 0 1px rgba(227,162,61,0.35), 0 4px 10px rgba(158,94,32,0.25);
  transform:translateY(-1px);
}
`,e=wa(t);e.id=Lv}function Im(t){let e="hud.pos",n="hud.collapsed",r="hud.hidden",o=O=>`hud.windows.${O}`;if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>Im(t),{once:!0});return}let i=`
  :root{
    --qws-bg:        #0f1318;
    --qws-panel:     #111823cc;
    --qws-border:    #ffffff22;
    --qws-border-2:  #ffffff14;
    --qws-accent:    #7aa2ff;
    --qws-text:      #e7eef7;
    --qws-text-dim:  #b9c3cf;
    --qws-blur:      8px;
    --qws-shadow:    0 10px 36px rgba(0,0,0,.45);
  }

  /* ---------- HUD floating box ---------- */
  .qws2{
    position:fixed; right:16px; bottom:16px; z-index:2000000;
    position:fixed; right:16px; bottom:16px; z-index:1000010;
    font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color:var(--qws-text);
    background:var(--qws-panel);
    border:1px solid var(--qws-border);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:var(--qws-shadow);
    backdrop-filter:blur(var(--qws-blur));
    min-width:160px;
    display:flex; flex-direction:column; gap:8px;
  }
  .qws2.hidden{ display:none }
  .qws2 .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .qws2 .col{ display:flex; flex-direction:column; gap:4px }
  .qws2 .title{ font-weight:700; letter-spacing:.2px }
  .qws2 .sp{ flex:1 }

  .qws2 .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 8px; border-radius:999px;
    border:1px solid #ffffff26;
    background:rgba(255,255,255,.06);
    color:var(--qws-text);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  }
  .qws2 .ok{   background:rgba(36, 161, 72, .20);  border-color:#48d17066 }
  .qws2 .warn{ background:rgba(241, 194, 27, .18); border-color:#ffd65c66 }
  .qws2 .bad{  background:rgba(218, 30, 40, .20);  border-color:#ff7c8666 }

  .qws2 .btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:6px 10px;
    background:linear-gradient(180deg, #ffffff12, #ffffff06);
    color:#fff;
    transition:transform .1s ease, background .18s ease, border-color .18s ease;
  }
  .qws2 .btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws2 .btn:active{ transform:translateY(1px) }
  .qws2 .drag{ cursor:move; opacity:.9 }

  .qws2 .mini{ display:none }
  .qws2.min .mini{ display:inline-flex }
  .qws2.min .body{ display:none }

  /* Launcher always shown */
  .qws-launch{ margin-top:4px; border-top:1px solid var(--qws-border); padding-top:6px; display:block }
  .qws-launch .launch-item{ display:flex; align-items:center; gap:8px; margin:4px 0 }
  .qws-launch .launch-item .name{ flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .qws-launch .launch-item .btn.active{
    background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.12));
    border-color:#9db7ff66;
  }

  /* ---------- Windows ---------- */
  .qws-win{
    position:fixed; z-index:2000001; min-width:260px; max-width:900px; max-height:90vh; overflow:auto;
    background:var(--qws-panel); color:var(--qws-text);
    border:1px solid var(--qws-border); border-radius:12px;
    box-shadow:var(--qws-shadow); backdrop-filter:blur(var(--qws-blur));
  }
  .qws-win .w-head{
    display:flex; align-items:center; gap:8px; padding:10px 12px;
    border-bottom:1px solid var(--qws-border); cursor:move;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .qws-win .w-title{ font-weight:700 }
  .qws-win .sp{ flex:1 }
  .qws-win .w-btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:4px 8px; background:linear-gradient(180deg, #ffffff12, #ffffff06); color:#fff;
  }
  .qws-win .w-btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws-win .w-body{ padding:12px }

  /* Inputs inside windows */
  .qws-win input[type="text"], .qws-win input[type="number"]{
    width:120px; padding:8px 10px; border-radius:10px;
    border:1px solid var(--qws-border); background:rgba(0,0,0,.42); color:#fff;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  }
  .qws-win .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
  `,l=document.createElement("style");l.textContent=i,(document.documentElement||document.body).appendChild(l);let c=document.createElement("div");c.className="qws2",c.innerHTML=`
    <div class="row drag">
      <div class="title">Arie's Mod</div>
      <div class="sp"></div>
      <span id="qws2-status-mini" class="pill warn mini">\u2026</span>
      <button id="qws2-min" class="btn" title="Minimize/Expand">\u2013</button>
      <button id="qws2-hide" class="btn" title="Hide">\u2715</button>
    </div>

    <!-- Status & store side-by-side (no mode label) -->
    <div class="row" style="margin:2px 0 2px 0;">
      <span id="qws2-status" class="pill warn">status</span>
      <span id="qws2-version" class="pill warn">\u2026</span>
    </div>

    <div class="body">
      <div id="qws-launch" class="qws-launch"></div>
    </div>
  `,(document.documentElement||document.body).appendChild(c);let d=O=>{c.classList.toggle("hidden",O);try{Oe(r,O)}catch{}return O},u=()=>d(!c.classList.contains("hidden")),y=!1,h=!1,f="gui.toggle",p="gui.drag",m=new Set,g=Et(f),S=Et(p),w=!1,x=(O,U)=>O===U||(O==="AltLeft"||O==="AltRight")&&(U==="AltLeft"||U==="AltRight")||(O==="ControlLeft"||O==="ControlRight")&&(U==="ControlLeft"||U==="ControlRight")||(O==="ShiftLeft"||O==="ShiftRight")&&(U==="ShiftLeft"||U==="ShiftRight")||(O==="MetaLeft"||O==="MetaRight")&&(U==="MetaLeft"||U==="MetaRight"),E=O=>{for(let U of m)if(x(O,U))return!0;return!1},T=(O,U)=>!U||!!U.ctrl!==O.ctrlKey||!!U.shift!==O.shiftKey||!!U.alt!==O.altKey||!!U.meta!==O.metaKey?!1:x(U.code,O.code),A=()=>{if(!S){w=!1;return}let O=E("AltLeft"),U=E("ControlLeft"),ue=E("ShiftLeft"),oe=E("MetaLeft");if(!!S.alt!==O){w=!1;return}if(!!S.ctrl!==U){w=!1;return}if(!!S.shift!==ue){w=!1;return}if(!!S.meta!==oe){w=!1;return}w=E(S.code)};A();let N=O=>O.code==="Insert"||O.key==="Insert",H=O=>{if(S&&w)return!0;let U="altKey"in O&&O.altKey,ue="ctrlKey"in O&&O.ctrlKey,oe="metaKey"in O&&O.metaKey,ae="shiftKey"in O&&O.shiftKey,ye=y&&!U&&!ue&&!oe;return ye&&!ae&&(h=!0),ye&&!ae},C=O=>{if(!N(O))return;if(O.type==="keydown"){y||(h=!1),y=!0;return}let U=O.target,ue=!!U&&(U.isContentEditable||/^(input|textarea|select)$/i.test(U.tagName)),oe=h;y=!1,h=!1,!oe&&!ue&&(O.preventDefault(),u())};window.addEventListener("keydown",C,!0),window.addEventListener("keyup",C,!0),window.addEventListener("blur",()=>{y=!1,h=!1,m.clear(),A()},!0),document.addEventListener("visibilitychange",()=>{document.visibilityState!=="visible"&&(y=!1,h=!1,m.clear(),A())});function L(O){let U=O.getBoundingClientRect(),ue=window.innerWidth,oe=window.innerHeight,ae=parseFloat(getComputedStyle(O).right)||ue-U.right,ye=parseFloat(getComputedStyle(O).bottom)||oe-U.bottom,he=Math.max(8,ue-U.width-8),ve=Math.max(8,oe-U.height-8);ae=Math.min(Math.max(ae,8),he),ye=Math.min(Math.max(ye,8),ve),O.style.right=ae+"px",O.style.bottom=ye+"px"}function v(O){L(O);let U=O.getBoundingClientRect(),oe=O.querySelector(".w-head")?.getBoundingClientRect()||U,ae=window.innerWidth,ye=window.innerHeight,he=8,ve=parseFloat(getComputedStyle(O).right);Number.isNaN(ve)&&(ve=ae-U.right);let Ee=parseFloat(getComputedStyle(O).bottom);Number.isNaN(Ee)&&(Ee=ye-U.bottom);let Ne=Math.max(he,ae-U.width-he),He=Math.max(he,ye-U.height-he);if(oe.top<he){let ze=he-oe.top;Ee=Math.max(he,Math.min(He,Ee-ze))}if(U.left<he){let ze=he-U.left;ve=Math.max(he,Math.min(Ne,ve-ze))}O.style.right=ve+"px",O.style.bottom=Ee+"px"}function B(O){O.style.right="16px",O.style.bottom="16px",v(O)}function le(O,U){let ue=O.getBoundingClientRect(),oe=window.innerHeight,ae=parseFloat(getComputedStyle(O).bottom);Number.isNaN(ae)&&(ae=oe-ue.bottom),U(),requestAnimationFrame(()=>{let ye=O.getBoundingClientRect(),he=ye.top-ue.top,ve=ae+he,Ee=Math.max(8,oe-ye.height-8);ve=Math.min(Math.max(8,ve),Ee),O.style.bottom=ve+"px",v(O)})}function X(){try{let O=parseFloat(c.style.right)||16,U=parseFloat(c.style.bottom)||16;Oe(e,{r:O,b:U})}catch{}}try{let O=_e(e);O&&typeof O.r=="number"&&typeof O.b=="number"&&(c.style.right=O.r+"px",c.style.bottom=O.b+"px");let U=_e(n);if(U===!0||U==="1"||U===1){c.classList.add("min");let oe=c.querySelector("#qws2-min");oe&&(oe.textContent="+")}let ue=_e(r);(ue===!0||ue==="1"||ue===1)&&c.classList.add("hidden"),requestAnimationFrame(()=>L(c)),window.addEventListener("resize",()=>L(c))}catch{}let de=c.querySelector(".drag"),_=c.querySelector("#qws2-min"),re=c.querySelector("#qws2-hide"),R=c.querySelector("#qws2-status-mini"),k=c.querySelector("#qws2-status"),V=c.querySelector("#qws2-version"),ee=c.querySelector("#qws-launch");if(!de||!_||!re||!R||!k||!V||!ee){console.warn("[QuinoaWS] HUD elements missing, abort init");return}let ie=ee,fe=()=>{let O=[];if(g){let U=Gg(f);U&&U!=="\u2014"&&O.push(U)}O.push("Insert"),re.title=O.length?`Hide (${O.join(" / ")})`:"Hide"};fe(),Mn(f,O=>{g=O,fe()}),Mn(p,O=>{S=O,A()}),function(){let U=0,ue=0,oe=0,ae=0,ye=!1;de.addEventListener("mousedown",he=>{ye=!0,U=he.clientX,ue=he.clientY;let ve=c.getBoundingClientRect();oe=parseFloat(getComputedStyle(c).right)||window.innerWidth-ve.right,ae=parseFloat(getComputedStyle(c).bottom)||window.innerHeight-ve.bottom,document.body.style.userSelect="none"}),window.addEventListener("mousemove",he=>{if(!ye)return;let ve=he.clientX-U,Ee=he.clientY-ue,Ne=oe-ve,He=ae-Ee,ze=c.getBoundingClientRect(),Ve=window.innerWidth,ot=window.innerHeight,vt=Math.max(8,Ve-ze.width-8),dt=Math.max(8,ot-ze.height-8);Ne=Math.min(Math.max(Ne,8),vt),He=Math.min(Math.max(He,8),dt),c.style.right=Ne+"px",c.style.bottom=He+"px"}),window.addEventListener("mouseup",()=>{ye&&(ye=!1,document.body.style.userSelect="",X())})}(),_.onclick=()=>{le(c,()=>{c.classList.toggle("min"),_.textContent=c.classList.contains("min")?"+":"\u2013";try{Oe(n,c.classList.contains("min"))}catch{}})},re.onclick=()=>{d(!0)},window.addEventListener("keydown",O=>{m.add(O.code),A();let U=O.target;U&&(U.isContentEditable||/^(input|textarea|select)$/i.test(U.tagName))||O.repeat||T(O,g)&&(y&&!O.altKey&&!O.ctrlKey&&!O.metaKey&&!O.shiftKey&&(h=!0),O.preventDefault(),u())},!0),window.addEventListener("keyup",O=>{m.delete(O.code),A()},!0);let G=new Map,Z=0;function j(O,U,ue){if(G.has(O)){let He=G.get(O);He.el.style.display="",q(He.el),J(O,!0);return}let oe=document.createElement("div");oe.className="qws-win",oe.innerHTML=`
      <div class="w-head">
        <div class="w-title"></div>
        <div class="sp"></div>
        <button class="w-btn" data-act="min" title="Minimize/Expand">\u2013</button>
        <button class="w-btn" data-act="close" title="Close">\u2715</button>
      </div>
      <div class="w-body"></div>
    `,(document.documentElement||document.body).appendChild(oe);let ae=oe.querySelector(".w-head"),ye=oe.querySelector(".w-title"),he=oe.querySelector('[data-act="min"]'),ve=oe.querySelector('[data-act="close"]'),Ee=oe.querySelector(".w-body");ye.textContent=U;let Ne=Z++%5*24;oe.style.right=16+Ne+"px",oe.style.bottom=16+Ne+"px",L(oe),q(oe),function(){let ze=0,Ve=0,ot=0,vt=0,dt=!1;ae.addEventListener("mousedown",Ct=>{if(Ct.target.closest(".w-btn"))return;dt=!0,ze=Ct.clientX,Ve=Ct.clientY;let ge=oe.getBoundingClientRect();ot=parseFloat(getComputedStyle(oe).right)||window.innerWidth-ge.right,vt=parseFloat(getComputedStyle(oe).bottom)||window.innerHeight-ge.bottom,document.body.style.userSelect="none",q(oe)}),window.addEventListener("mousemove",Ct=>{if(!dt)return;let Kt=Ct.clientX-ze,ge=Ct.clientY-Ve,Le=ot-Kt,Se=vt-ge,ke=oe.getBoundingClientRect(),Ze=window.innerWidth,yt=window.innerHeight,Mt=Math.max(8,Ze-ke.width-8),Ut=Math.max(8,yt-ke.height-8);Le=Math.min(Math.max(Le,8),Mt),Se=Math.min(Math.max(Se,8),Ut),oe.style.right=Le+"px",oe.style.bottom=Se+"px"}),window.addEventListener("mouseup",()=>{dt=!1,document.body.style.userSelect="",W(O,oe)})}(),he.onclick=()=>{le(oe,()=>{let He=Ee.style.display==="none";Ee.style.display=He?"":"none",he.textContent=He?"\u2013":"+"})},ve.onclick=()=>{oe.style.display="none",J(O,!1)},F(oe);try{ue(Ee)}catch(He){Ee.textContent=String(He)}W(O,oe),G.set(O,{id:O,el:oe,head:ae,body:Ee}),J(O,!0)}function Y(O){return O.style.display!=="none"}function ne(O,U,ue){let oe=G.get(O);return oe?Y(oe.el)?(oe.el.style.display="none",J(O,!1),!1):(oe.el.style.display="",q(oe.el),v(oe.el),J(O,!0),!0):(j(O,U,ae=>{let ye=ae.closest(".qws-win");ye&&b(O,ye),ue(ae)}),!0)}function q(O){let U=2000001;G.forEach(ue=>{let oe=parseInt(getComputedStyle(ue.el).zIndex||String(2000001),10);oe>U&&(U=oe)}),O.style.zIndex=String(U+1)}function W(O,U){try{let ue=parseFloat(U.style.right)||16,oe=parseFloat(U.style.bottom)||16;Oe(o(O),{r:ue,b:oe})}catch{}}function b(O,U){try{let ue=_e(o(O));ue&&typeof ue.r=="number"&&(U.style.right=ue.r+"px"),ue&&typeof ue.b=="number"&&(U.style.bottom=ue.b+"px"),v(U)}catch{}}window.addEventListener("resize",()=>{G.forEach(O=>v(O.el))});function D(){let O=null,U=ve=>{let Ee=ve;return Ee&&Ee.closest?.(".qws-win, .qws2")||null},ue=ve=>{if(!H(ve)||ve.button!==0)return;let Ee=U(ve.target);if(!Ee||Ee.style.display==="none")return;let Ne=Ee.getBoundingClientRect(),He=window.innerWidth,ze=window.innerHeight,Ve=parseFloat(getComputedStyle(Ee).right),ot=parseFloat(getComputedStyle(Ee).bottom);Number.isNaN(Ve)&&(Ve=He-Ne.right),Number.isNaN(ot)&&(ot=ze-Ne.bottom),O={el:Ee,sx:ve.clientX,sy:ve.clientY,or:Ve,ob:ot},document.body.style.userSelect="none",q(Ee),ve.preventDefault(),ve.stopPropagation()},oe=ve=>{if(!O)return;let Ee=ve.clientX-O.sx,Ne=ve.clientY-O.sy,He=O.or-Ee,ze=O.ob-Ne,Ve=O.el.getBoundingClientRect(),ot=window.innerWidth,vt=window.innerHeight,dt=Math.max(8,ot-Ve.width-8),Ct=Math.max(8,vt-Ve.height-8);He=Math.min(Math.max(He,8),dt),ze=Math.min(Math.max(ze,8),Ct),O.el.style.right=`${He}px`,O.el.style.bottom=`${ze}px`},ae=()=>{if(!O)return;document.body.style.userSelect="",L(O.el);let ve=O.el,Ee=!1;G.forEach(Ne=>{Ne.el===ve&&!Ee&&(W(Ne.id,ve),Ee=!0)}),!Ee&&ve===c&&X(),O=null},ye=()=>ae(),he=ve=>{if(!S){ae();return}(T(ve,S)||!w)&&ae()};window.addEventListener("mousedown",ue,!0),window.addEventListener("mousemove",oe,!0),window.addEventListener("mouseup",ye,!0),window.addEventListener("keyup",he,!0)}function F(O){let U=ae=>{if(!ae||!(ae instanceof HTMLElement))return!1;if(ae instanceof HTMLTextAreaElement)return!0;if(ae instanceof HTMLInputElement){let ye=(ae.type||"").toLowerCase();return ye==="text"||ye==="number"||ye==="search"}return ae.isContentEditable===!0},ue=ae=>{let ye=ae.target,he=document.activeElement,ve=Ee=>!!(Ee&&(O.contains(Ee)||Ee.closest?.(".qws-win")||Ee.closest?.(".qws2")));(ve(ye)&&U(ye)||ve(he)&&U(he))&&(ae.stopPropagation(),ae.stopImmediatePropagation?.())},oe=["keydown","keypress","keyup"];return oe.forEach(ae=>{window.addEventListener(ae,ue,{capture:!0}),document.addEventListener(ae,ue,{capture:!0}),O.addEventListener(ae,ue,{capture:!0})}),()=>{oe.forEach(ae=>{window.removeEventListener(ae,ue,{capture:!0}),document.removeEventListener(ae,ue,{capture:!0}),O.removeEventListener(ae,ue,{capture:!0})})}}let P=[],I=new Map;function J(O,U){let ue=I.get(O);ue&&(ue.textContent=U?"Close":"Open",ue.dataset.open=U?"1":"0",U?ue.classList.add("active"):ue.classList.remove("active"))}function te(O,U,ue){P.push({id:O,title:U,render:ue}),z(O,U,ue)}function z(O,U,ue){let oe=document.createElement("div");oe.className="launch-item",oe.innerHTML=`<div class="name">${se(U)}</div>`;let ae=document.createElement("button");ae.className="btn",ae.textContent="Open",ae.dataset.open="0",I.set(O,ae),ae.onclick=()=>{let ye=G.get(O);ye&&ye.el.style.display!=="none"?(ye.el.style.display="none",J(O,!1)):(j(O,U,he=>{let ve=he.closest(".qws-win");ve&&b(O,ve),ue(he)}),J(O,!0))},oe.appendChild(ae),ee.appendChild(oe)}try{t?.onRegister?.(te)}catch{}F(c),D(),function(){let U=(ae,ye)=>{V.textContent=ae,Q(V,ye)},ue=ae=>{ae?(V.dataset.download=ae,V.style.cursor="pointer",V.title="Download the new version"):(delete V.dataset.download,V.style.removeProperty("cursor"),V.removeAttribute("title"))};U("checking\u2026","warn"),ue(null);let oe=ae=>{let ye=sr(),he=globalThis.GM,ve=typeof GM_openInTab=="function"?GM_openInTab:typeof he?.openInTab=="function"?he.openInTab.bind(he):null;if(ye&&ve)try{ve(ae,{active:!0,setParent:!0});return}catch(Ee){console.warn("[MagicGarden] GM_openInTab failed, falling back to window.open",Ee)}window.open(ae,"_blank","noopener,noreferrer")};V.addEventListener("click",()=>{let ae=V.dataset.download;ae&&oe(ae)}),(async()=>{let ae=ic();try{let ye=await h0(),he=ye?.version?.trim();if(!he){U(ae||"version inconnue","warn");return}if(!ae){U(he,"warn"),ue(ye?.download||null);return}if(ae===he){U(ae,"ok"),ue(null);return}U(`${ae} \u2192 ${he}`,"warn"),ue(ye?.download||null)}catch(ye){console.error("[MagicGarden] Failed to check version:",ye),U(ae||"Unknown","warn")}})()}(),(async()=>{try{await at()}catch{}})(),setInterval(()=>{let O=K(),U=$(),ue=U.message==="store none",oe=O.level==="bad",ae=ue&&oe?"bad":O.level==="ok"&&U.level==="ok"?"ok":"warn",ye=`${O.message}, ${U.message}`;k.textContent="status",k.title=ye,Q(k,ae);let he=ae==="ok"?"OK":ae==="warn"?"WARN":"ISSUES";R.textContent=he,R.title=ye,Q(R,ae)},800);function M(){for(let O=0;O<It.length;O++)if(It[O].readyState===_t.OPEN)return It[O];throw new Error("no page ws")}function K(){try{return M(),{level:"ok",message:"ws open"}}catch{return!!window.__QWS_workerFound||gi?{level:"ok",message:"ws via worker"}:{level:"bad",message:"ws none"}}}function $(){try{let O=ps(),U=uf();return O?{level:"ok",message:`store ${U.via||"ready"}`}:U.via==="polyfill"||U.polyfill?{level:"warn",message:"store polyfill"}:{level:"bad",message:"store none"}}catch{return{level:"bad",message:"store error"}}}function Q(O,U){O.classList.remove("ok","warn","bad"),U&&O.classList.add(U)}function se(O){return O.replace(/[&<>"']/g,U=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[U])}}function Gv(){Yh(),rb(),zg(),(async()=>{await Me.startAutofeedWatcher(()=>{}),await tt.onQuantityChange("seeds",ya("seeds")),await tt.onQuantityChange("tools",ya("tools")),await tt.onQuantityChange("eggs",ya("eggs")),await tt.onQuantityChange("decor",ya("decor"));try{fa(Me.getTeams())}catch{}try{await Me.onTeamsChangeNow(t=>{try{fa(t)}catch{}})}catch{}try{Rl(async t=>{try{await Me.useTeam(t)}catch(e){console.warn("[Pets] hotkey useTeam failed:",e)}})}catch{}await Pe.syncNow().catch(()=>{}),await we.onGardenDiffNow(async(t,e)=>{await Pe.syncNow().catch(()=>{}),Sb([...e.added,...e.updated,...e.removed])}),await Me.startAbilityLogsWatcher(),await Pv(),Hv(),await eS(),cS(),uS(),OS(),YS(),c0(),n0(),Zh(),gS(),E0(),bv(),Em({intervalMs:6e4,log:!0})})()}var F2="NoWeatherEffect",jv=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728","\u{1F506}","\u{1F52E}"],tw=Object.entries(De).map(([t,e])=>({key:t,seedName:e?.seed?.name??"",cropName:e?.crop?.name??""})),nw=new Map,rw=new Map;tw.forEach((t,e)=>{let n=jv[e%jv.length];nw.set(t.key,n),t.seedName&&rw.set(t.seedName,n)});var Ac=()=>tw,Na=t=>{if(t)return nw.get(t)??"\u2022"},Da=t=>{if(t)return rw.get(t)??"\u2022"};function B2(t){let e=t.replace(/_/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return e?e.charAt(0).toUpperCase()+e.slice(1):t}var H2=Nr??{},xr=Object.entries(tn).filter(t=>{let[e,n]=t;return e==="Puddle"?!1:typeof n=="number"&&Number.isFinite(n)}).map(([t,e])=>({key:t,label:H2[t]??B2(t),tileRef:e})),W2=t=>{let e=Math.max(24,t?.size??48),n=qe(document.createElement("div"),{width:`${e}px`,height:`${e}px`,display:"grid",placeItems:"center"}),r=qe(document.createElement("span"),{color:"#ff5c5c",fontSize:`${Math.round(e*.65)}px`,fontWeight:"700",textShadow:"0 1px 2px rgba(0, 0, 0, 0.6)",lineHeight:"1"});return r.textContent="\u2716",n.appendChild(r),n};xr.unshift({key:F2,label:"No weather effect",tileRef:null,iconFactory:W2});var Pm=t=>xr.some(e=>e.key===t),ow={Wet:"condition",Chilled:"condition",Frozen:"condition",Dawnlit:"lighting",Amberlit:"lighting",Dawncharged:"lighting",Ambercharged:"lighting"},z2={condition:["Wet","Chilled","Frozen"],lighting:["Dawnlit","Amberlit","Dawncharged","Ambercharged"]};function sw(t){t.forEach(e=>{Pm(e)||t.delete(e)})}function Mc(t){sw(t);let e=new Set;xr.forEach(n=>{if(!t.has(n.key))return;let r=ow[n.key];r&&(e.has(r)?t.delete(n.key):e.add(r))})}var qe=(t,e)=>(Object.entries(e).forEach(([n,r])=>{t.style[n]=r}),t),Tc=new Map,La=new Map,qa=new Map,Fa=new WeakMap,Kv=!1,Ic=!1,km=!1,Cc=null,G2=0;function j2(){try{if(Ie.listPlants().length||Ie.listAllPlants().length)return!0}catch{}try{if(Ie.listTilesByCategory(/mutations/i).length)return!0}catch{}return!1}function Er(t=0){Ic||typeof window>"u"||(Cc!=null&&window.clearTimeout(Cc),Cc=window.setTimeout(()=>{Cc=null,Z2()},Math.max(0,t)))}function aw(){Kv||(Kv=!0,window.addEventListener("mg:sprite-detected",()=>{Tc.clear(),La.clear(),Array.from(qa.keys()).forEach(e=>{Rm(e)})}))}function K2(t,e,n){let r=qa.get(t);r||(r=new Set,qa.set(t,r)),r.add(e),Fa.set(e,n)}function Uv(t,e){let n=qa.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Fa.delete(r);return}Lc(r,e)}),n.size===0&&qa.delete(t))}var U2=new Set(["Bamboo","Cactus"]);function V2(t){let e=new Set;try{Ie.listPlants().forEach(s=>e.add(s))}catch{}try{Ie.listAllPlants().forEach(s=>e.add(s))}catch{}let n=Array.from(e,s=>{let a=s.split(/[?#]/)[0]??s;return(a.split("/").pop()??a).replace(/\.[^.]+$/,"")});if(!t)return n;let r=n.map(s=>s.toLowerCase()),o=s=>n.filter((a,i)=>s(a,r[i]??a.toLowerCase()));if(U2.has(t)){let s=o((i,l)=>l==="tallplants");if(s.length)return s;let a=o((i,l)=>/tall/.test(i)||/tall/.test(l));if(a.length)return a}else{let s=o((i,l)=>l==="plants");if(s.length)return s;let a=o((i,l)=>!/tall/.test(i)&&!/tall/.test(l));if(a.length)return a}return n}function iw(t,e=[]){let n=typeof t=="number"&&Number.isFinite(t)?t:Number(t);if(!Number.isFinite(n))return null;if(n<=0)return n;let r=e.map(o=>o.toLowerCase());return r.some(o=>o.includes("tall"))||r.some(o=>o.includes("plants")),n-1}async function Y2(t){await Pt();let e=De[t];if(!e)return null;let n=e?.crop?.tileRef??e?.plant?.tileRef??e?.seed?.tileRef,r=V2(t),o=iw(n,r);if(o==null)return null;for(let s of r)try{let i=(await kt(s)).find(c=>c.index===o);if(!i)continue;let l=Ie.toCanvas(i);if(l&&l.width>0&&l.height>0){let c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");if(!d)continue;return d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),c.toDataURL()}}catch{}return null}function Lc(t,e){let n=Fa.get(t);if(!n)return;let{size:r,fallback:o}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",e){let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,s.style.width="100%",s.style.height="100%",s.style.objectFit="contain",s.style.imageRendering="pixelated",t.appendChild(s)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.8))}px`}function Rm(t){let e=Tc.get(t);if(e!==void 0)return Uv(t,e),Promise.resolve(e);let n=La.get(t);if(n)return n;let r=Y2(t).then(o=>(Tc.set(t,o),La.delete(t),Uv(t,o),o)).catch(()=>(La.delete(t),null));return La.set(t,r),r}function kc(t,e={}){aw();let n=Math.max(12,e.size??24),r=e.fallback??"\u{1F331}",o=document.createElement("span");K2(t,o,{size:n,fallback:r});let s=Tc.get(t);return Lc(o,s??null),Rm(t),o}var Pc=new Map,Ra=new Map,Oa=new Map,Vv=!1,_a=null;function lw(){Vv||(Vv=!0,window.addEventListener("mg:sprite-detected",()=>{Pc.clear(),Ra.clear(),_a=null,Array.from(Oa.keys()).forEach(e=>{_m(e)})}))}function Q2(){if(_a)return _a;let t=new Set;try{Ie.listTilesByCategory(/mutations/i).forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return e.length||e.push("mutations"),_a=e,_a}function J2(t,e,n){let r=Oa.get(t);r||(r=new Set,Oa.set(t,r)),r.add(e),Fa.set(e,n)}function Yv(t,e){let n=Oa.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Fa.delete(r);return}Lc(r,e)}),n.size===0&&Oa.delete(t))}async function $2(t){await Pt();let e=xr.find(o=>o.key===t);if(!e||e.tileRef==null)return null;let[n]=Q2(),r=iw(e.tileRef,n?[n]:[]);if(r==null||!n)return null;try{let s=(await kt(n)).find(i=>i.index===r);if(!s)return null;let a=Ie.toCanvas(s);if(a&&a.width>0&&a.height>0){let i=document.createElement("canvas");i.width=a.width,i.height=a.height;let l=i.getContext("2d");return l?(l.imageSmoothingEnabled=!1,l.drawImage(a,0,0),i.toDataURL()):null}}catch{}return null}function _m(t){let e=Pc.get(t);if(e!==void 0)return Yv(t,e),Promise.resolve(e);let n=Ra.get(t);if(n)return n;let r=$2(t).then(o=>(Pc.set(t,o),Ra.delete(t),Yv(t,o),o)).catch(()=>(Ra.delete(t),null));return Ra.set(t,r),r}function cw(t,e={}){lw();let n=Math.max(12,e.size??36),r=e.fallback??"?",o=document.createElement("span");J2(t,o,{size:n,fallback:r});let s=Pc.get(t);return Lc(o,s??null),_m(t),o}function Z2(){Ic||km||typeof window>"u"||(km=!0,(async()=>{try{if(await Pt(),!j2()){Er(200);return}Ic=!0,aw(),lw();try{Object.keys(De).forEach(e=>{e&&Rm(e)})}catch{}xr.forEach(t=>{t.tileRef!=null&&_m(t.key)})}finally{km=!1}})().catch(t=>{console.warn("[LockerSprites]","preload failed",t),Er(500)}))}typeof window<"u"&&(Er(),window.addEventListener("mg:sprite-detected",()=>{Ic||Er(100)}));function Qv(){return{minScalePct:50,maxScalePct:100,scaleLockMode:"RANGE",lockMode:"LOCK",minInventory:91,avoidNormal:!1,visualMutations:new Set,weatherMode:"ANY",weatherSelected:new Set,weatherRecipes:[]}}function X2(t,e){t.minScalePct=e.minScalePct,t.maxScalePct=e.maxScalePct,t.scaleLockMode=e.scaleLockMode,t.lockMode=e.lockMode,t.minInventory=e.minInventory,t.avoidNormal=e.avoidNormal,t.visualMutations.clear(),e.visualMutations.forEach(n=>t.visualMutations.add(n)),t.weatherMode=e.weatherMode,t.weatherSelected.clear(),e.weatherSelected.forEach(n=>t.weatherSelected.add(n)),t.weatherRecipes.length=0,e.weatherRecipes.forEach(n=>t.weatherRecipes.push(new Set(n)))}function Jv(t,e){let n=e??{},r=n.scaleLockMode==="MINIMUM"?"MINIMUM":n.scaleLockMode==="MAXIMUM"?"MAXIMUM":n.scaleLockMode==="NONE"?"NONE":"RANGE",o=Math.max(50,Math.min(100,Math.round(n.minScalePct??50))),s=Math.max(50,Math.min(100,Math.round(n.maxScalePct??100)));r==="RANGE"?(s=Math.max(51,Math.min(100,s)),s<=o&&(o>=99?(o=99,s=100):s=Math.min(100,Math.max(51,o+1)))):r==="MINIMUM"?o=Math.max(50,Math.min(100,o)):r==="MAXIMUM"&&(s=Math.max(50,Math.min(100,s))),t.minScalePct=o,t.maxScalePct=s,t.scaleLockMode=r,t.lockMode=n.lockMode==="ALLOW"?"ALLOW":"LOCK",t.minInventory=Math.max(0,Math.min(999,Math.round(n.minInventory??91))),t.avoidNormal=n.avoidNormal===!0||n.includeNormal===!1,t.visualMutations.clear(),(n.visualMutations??[]).forEach(a=>{(a==="Gold"||a==="Rainbow")&&t.visualMutations.add(a)}),t.weatherMode=n.weatherMode==="ALL"||n.weatherMode==="RECIPES"?n.weatherMode:"ANY",t.weatherSelected.clear(),(n.weatherSelected??[]).forEach(a=>{let i=a;Pm(i)&&t.weatherSelected.add(i)}),t.weatherRecipes.length=0,(n.weatherRecipes??[]).forEach(a=>{let i=new Set;Array.isArray(a)&&a.forEach(l=>{let c=l;Pm(c)&&i.add(c)}),t.weatherRecipes.push(i)})}function $v(t){sw(t.weatherSelected),t.weatherRecipes.forEach(o=>Mc(o));let e=t.scaleLockMode==="MINIMUM"?"MINIMUM":t.scaleLockMode==="MAXIMUM"?"MAXIMUM":t.scaleLockMode==="NONE"?"NONE":"RANGE",n=Math.max(50,Math.min(100,Math.round(t.minScalePct||50))),r=Math.max(50,Math.min(100,Math.round(t.maxScalePct||100)));return e==="RANGE"?(r=Math.max(51,Math.min(100,r)),r<=n&&(n>=99?(n=99,r=100):r=Math.min(100,Math.max(51,n+1)))):e==="MINIMUM"?n=Math.max(50,Math.min(100,n)):e==="MAXIMUM"&&(r=Math.max(50,Math.min(100,r))),{minScalePct:n,maxScalePct:r,scaleLockMode:e,lockMode:t.lockMode==="ALLOW"?"ALLOW":"LOCK",minInventory:Math.max(0,Math.min(999,Math.round(t.minInventory||91))),avoidNormal:!!t.avoidNormal,includeNormal:!t.avoidNormal,visualMutations:Array.from(t.visualMutations),weatherMode:t.weatherMode,weatherSelected:Array.from(t.weatherSelected),weatherRecipes:t.weatherRecipes.map(o=>Array.from(o))}}var Lm=class{constructor(e){pe(this,"global");pe(this,"overrides",new Map);pe(this,"listeners",new Set);pe(this,"syncing",!1);this.global={enabled:!1,settings:Qv(),hasPersistedSettings:!0},this.syncFromService(e)}applyPersisted(e){this.global.enabled=!!e.enabled,Jv(this.global.settings,e.settings),this.global.hasPersistedSettings=!0;let n=new Set;Object.entries(e.overrides??{}).forEach(([r,o])=>{let s=this.ensureOverride(r,{silent:!0});s.enabled=!!o?.enabled,Jv(s.settings,o?.settings),s.hasPersistedSettings=!0,n.add(r)});for(let r of Array.from(this.overrides.keys()))n.has(r)||this.overrides.delete(r)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(){for(let e of this.listeners)try{e()}catch{}}syncFromService(e){this.syncing=!0,this.applyPersisted(e),this.emit(),this.syncing=!1}setGlobalEnabled(e){this.global.enabled=!!e,this.persistGlobal(),this.emit()}notifyGlobalSettingsChanged(){this.persistGlobal(),this.emit()}ensureOverride(e,n={}){let r=this.overrides.get(e);return r||(r={enabled:!1,settings:Qv(),hasPersistedSettings:!1},this.overrides.set(e,r),n.silent||this.emit()),r}getOverride(e){return this.overrides.get(e)}setOverrideEnabled(e,n){let r=this.ensureOverride(e,{silent:!0});r.enabled=!!n,this.persistOverride(e),this.emit()}notifyOverrideSettingsChanged(e){let n=this.overrides.get(e);n&&(n.hasPersistedSettings=!0,this.persistOverride(e),this.emit())}removeOverride(e){this.overrides.has(e)&&(this.overrides.delete(e),this.syncing||(xt.removeOverride(e),xt.recomputeCurrentSlot()),this.emit())}persistGlobal(){this.syncing||(xt.setGlobalState({enabled:this.global.enabled,settings:$v(this.global.settings)}),xt.recomputeCurrentSlot())}persistOverride(e){if(this.syncing)return;let n=this.overrides.get(e);n?(xt.setOverride(e,{enabled:n.enabled,settings:$v(n.settings)}),n.hasPersistedSettings=!0):xt.removeOverride(e),xt.recomputeCurrentSlot()}};function Nm(t,e){t.checked=!!e}function Zv({key:t,label:e,spriteSize:n,dense:r,kind:o="main",iconFactory:s}){let a=o==="main"&&!r,d={position:"relative",display:"grid",justifyItems:"center",alignItems:"center",gap:r||a?"3px":"6px",padding:r?"4px 6px":a?"6px 8px":"10px 12px",border:"1px solid #4445",borderRadius:"10px",background:"#0f1318",cursor:"pointer",minWidth:r?"80px":a?"88px":"120px",transition:"border-color 120ms ease, box-shadow 120ms ease, background 120ms ease",boxShadow:"0 0 0 1px #0002 inset"};a&&(d.width="100%");let u=qe(document.createElement("label"),d);u.title="Active filters influence harvest conditions";let y=document.createElement("input");y.type="checkbox",qe(y,{position:"absolute",inset:"0",opacity:"0",pointerEvents:"none",margin:"0"}),y.dataset.weatherToggle=o,u.appendChild(y),u.dataset.weatherToggle=o;let h=Math.max(24,n??(r?36:a?52:72)),f=s?s({size:h,fallback:e.charAt(0)||"?"}):cw(t,{size:h,fallback:e.charAt(0)||"?"});qe(f,{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.45))"}),u.appendChild(f);let p=qe(document.createElement("div"),{fontSize:r?"11px":"11.5px",fontWeight:r?"500":"600",opacity:"0.85",textAlign:"center"});p.textContent=e,u.appendChild(p);let m=()=>{y.disabled?(u.style.cursor="default",u.style.opacity="0.55",u.style.pointerEvents="none"):(u.style.cursor="pointer",u.style.opacity="",u.style.pointerEvents="")},g=()=>{y.checked?qe(u,{borderColor:"#6aa6",boxShadow:"0 0 0 1px #6aa4 inset, 0 2px 6px rgba(0, 0, 0, 0.45)",background:"#182029"}):qe(u,{borderColor:"#4445",boxShadow:"0 0 0 1px #0002 inset",background:"#0f1318"}),m()},S=x=>{Nm(y,x),g()},w=x=>{y.disabled=!!x,g()};return y.addEventListener("change",g),y.addEventListener("mg-weather-toggle-refresh",g),g(),{key:t,wrap:u,input:y,setChecked:S,setDisabled:w}}function ts(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function Xv(t,e){t.textContent=e,t.style.margin="0",t.style.padding="4px 8px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.minWidth="36px",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function dw(t,e,n={}){let r=document.createElement("div");r.dataset.lockerSettingsCard="1",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="12px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.alignItems="center",r.style.overflow="auto",r.style.minHeight="0",r.style.width="min(760px, 100%)";let o=null,s=()=>{if(!o)return;let ge=e.lockMode==="ALLOW"?"Allow":"Lock";o.textContent=`${ge} when any recipe row matches (OR between rows)`},a=(ge,Le)=>{let Se=document.createElement("div");Se.style.display="grid",Se.style.justifyItems="center",Se.style.gap="8px",Se.style.textAlign="center",Se.style.border="1px solid #4446",Se.style.borderRadius="10px",Se.style.padding="10px",Se.style.background="#1f2328",Se.style.boxShadow="0 0 0 1px #0002 inset",Se.style.width="min(720px, 100%)";let ke=document.createElement("div");return ke.textContent=ge,ke.style.fontWeight="600",ke.style.opacity="0.95",Se.append(ke,Le),Se},i=()=>{let ge=document.createElement("div");return ge.style.display="flex",ge.style.flexWrap="wrap",ge.style.justifyContent="center",ge.style.alignItems="center",ge.style.gap="8px",ge},l=ge=>ge==="allow"?"ALLOW":"LOCK",c=ge=>ge==="ALLOW"?"allow":"lock",d=i();d.style.flexDirection="column",d.style.alignItems="center",d.style.gap="10px";let u=document.createElement("div");u.style.fontSize="12px",u.style.opacity="0.8",u.style.textAlign="center";let y=!1,h=t.segmented([{value:"lock",label:"Lock"},{value:"allow",label:"Allow"}],c(e.lockMode),ge=>{y||(e.lockMode=l(ge),f(),n.onChange?.())},{ariaLabel:"Harvest mode"});d.append(h,u);let f=()=>{let ge=c(e.lockMode);if(h.get?.()!==ge){y=!0;try{h.set?.(ge)}finally{y=!1}}u.textContent=ge==="allow"?"Harvest only when every active filter category matches":"Harvest is locked whenever any active filter matches",s()},p=i();p.style.flexDirection="column",p.style.alignItems="center",p.style.width="100%",p.style.gap="12px";let m=i();m.style.flexWrap="wrap",m.style.justifyContent="center",m.style.gap="12px";let g=t.slider(50,100,1,e.minScalePct);qe(g,{width:"min(420px, 100%)"});let S=t.slider(50,100,1,e.maxScalePct);qe(S,{width:"min(420px, 100%)"});let w=ge=>{switch(ge){case"minimum":return"MINIMUM";case"maximum":return"MAXIMUM";case"ranged":return"RANGE";default:return"NONE"}},x=ge=>{switch(ge){case"MINIMUM":return"minimum";case"MAXIMUM":return"maximum";case"RANGE":return"ranged";default:return"none"}},E=!1,T=x(e.scaleLockMode),A=t.segmented([{value:"none",label:"None"},{value:"minimum",label:"Minimum"},{value:"maximum",label:"Maximum"},{value:"ranged",label:"Range"}],T,ge=>{E||fe(w(ge),!0)},{ariaLabel:"Scale lock mode"});m.append(A);let N=t.rangeDual(50,100,1,e.minScalePct,e.maxScalePct);qe(N.root,{width:"min(420px, 100%)",marginLeft:"auto",marginRight:"auto"});let H=N.min,C=N.max,L=t.label("50%"),v=t.label("100%"),B=t.label("50%"),le=t.label("100%");[L,v,B,le].forEach(ge=>{ge.style.margin="0",ge.style.fontWeight="600"});let X=(ge,Le)=>{let Se=qe(document.createElement("div"),{display:"flex",alignItems:"center",gap:"6px"}),ke=t.label(ge);return ke.style.margin="0",ke.style.opacity="0.9",Se.append(ke,Le),Se},de=qe(document.createElement("div"),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"min(420px, 100%)",gap:"16px"});de.append(X("Min",L),X("Max",v));let _=qe(document.createElement("div"),{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%"});_.append(g,X("Minimum",B));let re=qe(document.createElement("div"),{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%"});re.append(S,X("Maximum",le));let R=qe(document.createElement("div"),{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%"});R.append(N.root,de),p.append(m,_,re,R);let k=(ge,Le=ge)=>{let Se=parseInt(H.value,10),ke=parseInt(C.value,10);Number.isFinite(Se)||(Se=e.minScalePct),Number.isFinite(ke)||(ke=e.maxScalePct),Se=Math.max(50,Math.min(99,Se)),ke=Math.max(51,Math.min(100,ke)),ke<=Se&&(Se>=99?(Se=99,ke=100):ke=Math.min(100,Math.max(51,Se+1))),N.setValues(Se,ke),L.textContent=`${Se}%`,v.textContent=`${ke}%`,ge&&(e.minScalePct=Se,e.maxScalePct=ke,Le&&n.onChange?.())},V=(ge,Le=ge)=>{let Se=parseInt(g.value,10);Number.isFinite(Se)||(Se=e.minScalePct),Se=Math.max(50,Math.min(100,Se)),g.value=String(Se),B.textContent=`${Se}%`,ge&&(e.minScalePct=Se,Le&&n.onChange?.())},ee=(ge,Le=ge)=>{let Se=parseInt(S.value,10);Number.isFinite(Se)||(Se=e.maxScalePct),Se=Math.max(50,Math.min(100,Se)),S.value=String(Se),le.textContent=`${Se}%`,ge&&(e.maxScalePct=Se,Le&&n.onChange?.())},ie=()=>{let ge=e.scaleLockMode==="RANGE",Le=e.scaleLockMode==="MINIMUM",Se=e.scaleLockMode==="MAXIMUM";R.style.display=ge?"":"none",_.style.display=Le?"":"none",re.style.display=Se?"":"none";let ke=x(e.scaleLockMode);if(A.get?.()!==ke){E=!0;try{A.set?.(ke)}finally{E=!1}}},fe=(ge,Le)=>{let Se=e.scaleLockMode;e.scaleLockMode=ge,ge==="RANGE"?(N.setValues(e.minScalePct,e.maxScalePct),k(Se!==ge,!1)):ge==="MINIMUM"?(g.value=String(e.minScalePct),V(Se!==ge,!1)):ge==="MAXIMUM"&&(S.value=String(e.maxScalePct),ee(Se!==ge,!1)),ie(),Le&&Se!==ge&&n.onChange?.()};g.addEventListener("input",()=>V(!1)),g.addEventListener("change",()=>V(!0)),S.addEventListener("input",()=>ee(!1)),S.addEventListener("change",()=>ee(!0)),H.addEventListener("input",()=>k(!1)),C.addEventListener("input",()=>k(!1)),H.addEventListener("change",()=>k(!0)),C.addEventListener("change",()=>k(!0)),k(!1),V(!1),ee(!1),fe(e.scaleLockMode,!1);let G=i();G.style.flexWrap="wrap",G.style.gap="8px";let Z=(ge,Le)=>{let Se=document.createElement("button");Se.type="button",Se.title="Active filters influence harvest conditions",qe(Se,{padding:"6px 12px",borderRadius:"8px",border:"1px solid #4445",background:"#1f2328",color:"#e7eef7",fontWeight:"600",letterSpacing:"0.3px",transition:"border-color 120ms ease, box-shadow 120ms ease, background 120ms ease, opacity 120ms ease",boxShadow:"0 0 0 1px #0002 inset",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",minWidth:"92px",cursor:"pointer"});let ke=document.createElement("span");return ke.textContent=ge,Le&&qe(ke,{backgroundImage:Le,backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",fontWeight:"700",textShadow:"0 0 6px rgba(0, 0, 0, 0.35)"}),Se.appendChild(ke),Se.addEventListener("mouseenter",()=>{Se.disabled||Se.dataset.active==="1"||(Se.style.borderColor="#6aa1")}),Se.addEventListener("mouseleave",()=>{Se.dataset.active!=="1"&&(Se.style.borderColor="#4445")}),Se},j=Z("Normal"),Y=Z("Gold","linear-gradient(120deg, #f5d76e, #c9932b, #f9e9b6)"),ne=Z("Rainbow","linear-gradient(90deg, #ff6b6b, #f7d35c, #3fd3ff, #9b6bff, #ff6b6b)"),q=(ge,Le)=>{ge.dataset.active=Le?"1":"0",ge.style.borderColor=Le?"#6aa6":"#4445",ge.style.boxShadow=Le?"0 0 0 1px #6aa4 inset, 0 2px 6px rgba(0, 0, 0, 0.45)":"0 0 0 1px #0002 inset",ge.style.background=Le?"#182029":"#1f2328",ge.style.opacity=ge.disabled?"0.55":"",ge.style.cursor=ge.disabled?"default":"pointer"},W=()=>{q(j,e.avoidNormal),q(Y,e.visualMutations.has("Gold")),q(ne,e.visualMutations.has("Rainbow"))};j.addEventListener("click",()=>{e.avoidNormal=!e.avoidNormal,W(),n.onChange?.()}),Y.addEventListener("click",()=>{e.visualMutations.has("Gold")?e.visualMutations.delete("Gold"):e.visualMutations.add("Gold"),W(),n.onChange?.()}),ne.addEventListener("click",()=>{e.visualMutations.has("Rainbow")?e.visualMutations.delete("Rainbow"):e.visualMutations.add("Rainbow"),W(),n.onChange?.()}),G.append(j,Y,ne);let b=qe(document.createElement("div"),{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",columnGap:"6px",rowGap:"6px",justifyItems:"stretch",width:"min(640px, 100%)",marginInline:"auto"}),F=(ge=>(Le,Se)=>{Se?ge.add(Le):ge.delete(Le),n.onChange?.()})(e.weatherSelected),P=xr.map(ge=>{let Le=Zv({key:ge.key,label:ge.label,kind:"main",iconFactory:ge.iconFactory});return Le.input.addEventListener("change",()=>F(ge.key,Le.input.checked)),b.appendChild(Le.wrap),Le}),I=()=>{let ge=r.dataset.disabled==="1"||e.weatherMode==="RECIPES";b.style.opacity=ge?"0.55":"",b.style.pointerEvents=ge?"none":"",P.forEach(Le=>Le.setDisabled(ge))},J=`locker-weather-mode-${++G2}`,te=i(),z=(ge,Le)=>{let Se=document.createElement("label");Se.style.display="inline-flex",Se.style.alignItems="center",Se.style.gap="6px";let ke=t.radio(J,ge),Ze=document.createElement("span");return Ze.textContent=Le,Se.append(ke,Ze),ke.addEventListener("change",()=>{ke.checked&&(e.weatherMode=ge,Q.style.display=ge==="RECIPES"?"":"none",I(),n.onChange?.())}),{wrap:Se,input:ke}},M=z("ANY","Any match (OR)"),K=z("ALL","All match (AND)"),$=z("RECIPES","Recipes (match rows)");te.append(M.wrap,K.wrap,$.wrap);let Q=document.createElement("div");Q.style.display="grid",Q.style.gap="8px",Q.style.justifyItems="center",Q.style.width="min(720px, 100%)";let se=i();se.style.width="100%",se.style.justifyContent="space-between";let O=document.createElement("div");o=O,s(),O.style.fontWeight="600",O.style.opacity="0.9";let U=document.createElement("button");U.style.maxWidth="140px",ts(U,"+ Recipe"),se.append(O,U);let ue=document.createElement("div");ue.style.display="grid",ue.style.gap="8px",ue.style.gridTemplateColumns="repeat(auto-fit, minmax(320px, 1fr))",ue.style.justifyItems="stretch";let oe=null,ae=new Set,ye=document.createElement("div");ye.textContent="No recipe rows yet.",ye.style.fontSize="12px",ye.style.opacity="0.7",ye.style.textAlign="center";let he=()=>{let ge=oe!==null,Le=r.dataset.disabled==="1";U.disabled=ge||Le,U.style.opacity=ge?"0.7":"",U.style.pointerEvents=ge?"none":""},ve=(ge,Le)=>{oe=ge,ae=new Set(Le??[]),Mc(ae),dt()},Ee=()=>{oe=null,ae=new Set,dt()},Ne=()=>{if(oe===null)return;let ge=new Set(ae);Mc(ge),oe===e.weatherRecipes.length?e.weatherRecipes.push(ge):oe>=0&&oe<e.weatherRecipes.length&&(e.weatherRecipes[oe]=ge),oe=null,ae=new Set,dt(),n.onChange?.()},He=ge=>{ge<0||(ge<e.weatherRecipes.length&&e.weatherRecipes.splice(ge,1),oe!==null&&(ge===oe?(oe=null,ae=new Set):ge<oe&&(oe-=1)),dt(),n.onChange?.())},ze=ge=>{let{key:Le,label:Se}=ge,ke=document.createElement("div");qe(ke,{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #4445",background:"#11161c",color:"#e7eef7",fontSize:"12px",fontWeight:"600",letterSpacing:"0.2px"});let Ze=ge.iconFactory?ge.iconFactory({size:20,fallback:Se.charAt(0)||"?"}):cw(Le,{size:20,fallback:Se.charAt(0)||"?"});qe(Ze,{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.45))"});let yt=document.createElement("span");return yt.textContent=Se,ke.append(Ze,yt),ke},Ve=(ge,Le)=>{ge.innerHTML="";let Se=document.createElement("div");qe(Se,{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"flex-start"});let ke=0;if(xr.forEach(Ze=>{Le.has(Ze.key)&&(ke+=1,Se.appendChild(ze(Ze)))}),ke===0){let Ze=document.createElement("div");Ze.textContent="No weather mutation selected.",Ze.style.fontSize="12px",Ze.style.opacity="0.7",Ze.style.textAlign="left",Se.appendChild(Ze)}ge.appendChild(Se)},ot=()=>{let ge=r.dataset.disabled==="1";r.querySelectorAll("input,button,select,textarea").forEach(Se=>{Se.dataset.weatherToggle!=="main"&&(Se.disabled=ge,Se.dispatchEvent(new Event("mg-weather-toggle-refresh")))}),I(),W(),r.style.opacity=ge?"0.55":"",he()};function vt(ge,Le){let Se=qe(document.createElement("div"),{display:"grid",gridTemplateColumns:"repeat(4, minmax(80px, 1fr))",columnGap:"6px",rowGap:"6px",justifyItems:"center"}),ke=new Map;return xr.forEach(Ze=>{let yt=Zv({key:Ze.key,label:Ze.label,spriteSize:40,dense:!0,kind:"recipe",iconFactory:Ze.iconFactory});ke.set(Ze.key,yt),yt.setChecked(ge.has(yt.key)),yt.input.addEventListener("change",()=>{let Mt=yt.input.checked,Ut=ow[yt.key];Mt&&Ut&&z2[Ut].forEach(Vt=>{Vt!==yt.key&&ge.has(Vt)&&(ge.delete(Vt),ke.get(Vt)?.setChecked(!1))}),Mt?ge.add(yt.key):ge.delete(yt.key),Le()}),Se.appendChild(yt.wrap)}),Se}function dt(){ue.innerHTML="";let ge=oe!==null&&oe===e.weatherRecipes.length;if(e.weatherRecipes.length+(ge?1:0)===0){ue.appendChild(ye),ot();return}if(e.weatherRecipes.forEach((Se,ke)=>{Mc(Se);let Ze=oe===ke,yt=Ze?ae:Se,Mt=qe(document.createElement("div"),{display:"flex",gap:Ze?"10px":"12px",border:"1px solid #4446",borderRadius:"10px",padding:Ze?"12px":"10px 12px",background:"#0f1318",boxShadow:"0 0 0 1px #0002 inset",width:"100%"});Ze?Mt.style.flexDirection="column":(Mt.style.flexDirection="row",Mt.style.alignItems="center",Mt.style.justifyContent="space-between",Mt.style.flexWrap="wrap");let Ut=document.createElement("div");if(Ve(Ut,yt),Ze||(Ut.style.flex="1 1 auto",Ut.style.minWidth="220px"),Mt.appendChild(Ut),Ze){let Vt=vt(yt,()=>Ve(Ut,yt));Mt.appendChild(Vt);let qn=qe(document.createElement("div"),{display:"flex",gap:"8px",width:"100%"}),On=document.createElement("button");ts(On,"\u274C"),On.onclick=Ee;let ud=document.createElement("button");if(ts(ud,"\u2714\uFE0F"),ud.onclick=Ne,qn.append(On,ud),oe!==null&&oe<e.weatherRecipes.length){let ds=document.createElement("button");ts(ds,"\u{1F5D1}\uFE0F"),ds.title="Delete",ds.setAttribute("aria-label","Delete"),ds.onclick=()=>He(ke),qn.append(ds)}Mt.appendChild(qn)}else{let Vt=qe(document.createElement("div"),{display:"flex",gap:"6px",alignItems:"center",justifyContent:"flex-end",flex:"0 0 auto"});Vt.style.flexWrap="nowrap";let qn=document.createElement("button");Xv(qn,"\u270F\uFE0F"),qn.title="Edit",qn.setAttribute("aria-label","Edit"),qn.onclick=()=>ve(ke,Se);let On=document.createElement("button");Xv(On,"\u{1F5D1}\uFE0F"),On.title="Delete",On.setAttribute("aria-label","Delete"),On.onclick=()=>He(ke),Vt.append(qn,On),Mt.appendChild(Vt)}ue.appendChild(Mt)}),ge&&oe!==null){let Se=ae,ke=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"10px",border:"1px solid #4446",borderRadius:"10px",padding:"12px",background:"#0f1318",boxShadow:"0 0 0 1px #0002 inset",width:"100%"}),Ze=document.createElement("div");Ve(Ze,Se),ke.appendChild(Ze);let yt=vt(Se,()=>Ve(Ze,Se));ke.appendChild(yt);let Mt=qe(document.createElement("div"),{display:"flex",gap:"8px",width:"100%"}),Ut=document.createElement("button");ts(Ut,"\u274C"),Ut.onclick=Ee;let Vt=document.createElement("button");ts(Vt,"\u2714\uFE0F"),Vt.onclick=Ne,Mt.append(Ut,Vt),ke.appendChild(Mt),ue.appendChild(ke)}ot()}U.onclick=()=>{ve(e.weatherRecipes.length)},Q.append(se,ue),r.append(a("Harvest mode",d),a("Filter by size",p),a("Filter by color",G),a("Filter by weather",b),a("Weather filter mode",te),a("Weather recipes",Q));let Ct=()=>{f(),N.setValues(e.minScalePct,e.maxScalePct),g.value=String(e.minScalePct),S.value=String(e.maxScalePct),k(!1),V(!1),ee(!1),fe(e.scaleLockMode,!1),W(),P.forEach(ge=>ge.setChecked(e.weatherSelected.has(ge.key))),M.input.checked=e.weatherMode==="ANY",K.input.checked=e.weatherMode==="ALL",$.input.checked=e.weatherMode==="RECIPES",Q.style.display=e.weatherMode==="RECIPES"?"":"none",I(),dt()},Kt=ge=>{r.dataset.disabled=ge?"1":"0",ot()};return Ct(),{root:r,refresh:Ct,setDisabled:Kt}}function e5(t){let e=mt.getState(),n=null,r=$t(1),o=[],s=[],a=!1,i=G=>Math.max(0,Math.min(Mi,Math.round(G/ws)*ws)),l=()=>n??r??0,c=qe(document.createElement("div"),{display:"grid",gap:"12px",justifyItems:"center",width:"100%",maxWidth:"1100px"}),d=t.card("Friend bonus locker",{align:"stretch"});d.root.style.width="100%",d.header.style.display="flex",d.header.style.alignItems="center",d.header.style.justifyContent="space-between";let u=qe(document.createElement("div"),{display:"grid",gap:"6px"}),y=t.flexRow({justify:"between",align:"center",fullWidth:!0}),h=document.createElement("div");h.textContent="Minimum friend bonus required\u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E \u200E ",h.style.fontWeight="600";let f=qe(document.createElement("div"),{fontWeight:"700",color:"#ff7a1f",textShadow:"0 1px 1px rgba(0, 0, 0, 0.5)"});y.append(h,f);let p=$t(e.minRequiredPlayers)??0,m=t.slider(0,Mi,ws,p);m.style.width="100%",u.append(y,m);let g=qe(document.createElement("div"),{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"999px",fontWeight:"700",fontSize:"12px",letterSpacing:"0.25px"});g.style.marginLeft="auto",d.header.appendChild(g);let S=qe(document.createElement("div"),{fontSize:"12.5px",lineHeight:"1.5",opacity:"0.92"});d.body.append(u,S),c.append(d.root);let w=t.card("Decor pick locker",{align:"stretch"});w.root.style.width="100%";let x=qe(document.createElement("div"),{display:"flex",alignItems:"center",justifyContent:"space-between",gap:"12px"}),E=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"4px"}),T=document.createElement("div");T.textContent="Prevents placed decors from being picked up",T.style.fontSize="12.5px",T.style.opacity="0.85",E.append(T);let A=t.switch(e.decorPickupLocked);A.addEventListener("change",()=>{let G=!!A.checked;e.decorPickupLocked=G,mt.setDecorPickupLocked(G)}),x.append(E,A),w.body.append(x),c.append(w.root);let N=t.card("Egg hatch locker",{align:"stretch"});N.root.style.width="100%";let H=qe(document.createElement("div"),{display:"grid",gap:"8px",width:"100%"});N.body.append(H),c.append(N.root);let C="\u{1F512}",L="\u{1F513}",v=new Map,B=qe(document.createElement("div"),{opacity:"0.7",fontSize:"12px"});B.textContent="No eggs detected in shop.";let le=(G,Z)=>{G.textContent=Z?C:L,G.style.background=Z?"#331616":"#12301d",G.style.color=Z?"#fca5a5":"#9ef7c3"},X,de=G=>{let Z=qe(document.createElement("div"),{display:"grid",gridTemplateColumns:"auto auto 1fr",alignItems:"center",gap:"10px",padding:"8px 10px",border:"1px solid #4445",borderRadius:"10px",background:"#0f1318"}),j=document.createElement("button");j.type="button",j.style.border="1px solid #4445",j.style.borderRadius="10px",j.style.padding="6px 10px",j.style.fontSize="14px",j.style.fontWeight="700",j.addEventListener("click",()=>{let q=!e.eggLocks?.[G.id];e.eggLocks={...e.eggLocks||{},[G.id]:q},mt.setEggLock(G.id,q),X()});let Y=Tt("Egg",G.id,{size:32,fallback:"\u{1F95A}"});Y.style.filter="drop-shadow(0 1px 1px rgba(0,0,0,0.45))";let ne=document.createElement("div");return ne.style.fontWeight="600",ne.style.color="#e7eef7",Z.append(j,Y,ne),{row:Z,toggle:j,name:ne}};X=()=>{if(H.innerHTML="",!o.length){H.appendChild(B);return}let G=document.createDocumentFragment(),Z=new Set;o.forEach(j=>{let Y=j.id;Z.add(Y);let ne=v.get(Y);ne||(ne=de(j),v.set(Y,ne)),ne.name.textContent=j.name||Y;let q=!!e.eggLocks?.[Y];le(ne.toggle,q),G.appendChild(ne.row)});for(let j of Array.from(v.keys())){if(Z.has(j))continue;let Y=v.get(j);Y&&Y.row.remove(),v.delete(j)}H.appendChild(G)};let _=G=>{m.value=String(G),f.textContent=`+${G}%`},re=G=>{let Z=G==="success"?{bg:"#0f2f1f",border:"#1b7c4a",color:"#8cf6ba"}:G==="warn"?{bg:"#321616",border:"#c74343",color:"#fca5a5"}:{bg:"#16263d",border:"#3f82d1",color:"#a5c7ff"};g.style.background=Z.bg,g.style.border=`1px solid ${Z.border}`,g.style.color=Z.color},R=()=>{let G=i($t(e.minRequiredPlayers)??0),Z=l(),j=e.minRequiredPlayers,Y=Z!=null?xs(Z):null,ne=G<=0||Z!=null&&Z+1e-4>=G;if(G<=0){g.textContent="Unlocked",re("info"),S.textContent=Z!=null?`Current friend bonus: ${Z}% (${Y} players).`:"Current friend bonus not detected yet.";return}g.textContent=ne?"Sale allowed":"Sale locked",re(ne?"success":"warn"),S.textContent=ne?`Current bonus ${Z}% (${Y} players) meets the requirement (${G}%).`:`Requires ${G}% (${j} players) or more`},k=G=>{let Z=Number(m.value),j=i(Number.isFinite(Z)?Z:0);_(j),e.minRequiredPlayers=xs(j),R(),G&&mt.setMinRequiredPlayers(e.minRequiredPlayers)};m.addEventListener("input",()=>k(!1)),m.addEventListener("change",()=>k(!0));let V=G=>{e={...G},Nm(A,e.decorPickupLocked),_($t(e.minRequiredPlayers)??0),R(),X()},ee=async()=>{if(a)return;a=!0;try{let Z=await ce.server.friendBonusMultiplier.get();n=Hn(Z)}catch{}try{let Z=await ce.server.friendBonusMultiplier.onChange(j=>{n=Hn(j),R()});typeof Z=="function"&&s.push(Z)}catch{}try{let Z=await ce.server.numPlayers.get();r=$t(Z)}catch{}try{let Z=await ce.server.numPlayers.onChange(j=>{r=$t(j),R()});typeof Z=="function"&&s.push(Z)}catch{}let G=mt.subscribe(V);s.push(G);try{let Z=await ce.shop.eggShop.get();o=ew(Z),X()}catch{}try{let Z=await ce.shop.eggShop.onChange(j=>{o=ew(j),X()});typeof Z=="function"&&s.push(Z)}catch{}};return{render:G=>{G.innerHTML="",G.style.maxHeight="54vh",G.style.overflow="auto",G.append(c),V(mt.getState()),R(),ee()},destroy:()=>{for(;s.length;){let G=s.pop();try{G?.()}catch{}}}}}function ew(t){let e=new Set,n=[],r=(s,a)=>{if(typeof s!="string"||!s||e.has(s))return;e.add(s);let i=typeof a=="string"&&a||typeof t?.names?.[s]=="string"&&t.names[s]||s;n.push({id:s,name:i})},o=s=>{if(!s||typeof s!="object")return;if(Array.isArray(s)){s.forEach(o);return}let a=s.eggId??s.id??null;r(a,s.name);for(let i of Object.values(s))i&&typeof i=="object"&&o(i)};return o(t),n}function t5(t,e){let n=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",alignItems:"center",width:"100%"}),r=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",alignItems:"center",width:"100%"}),o=qe(document.createElement("div"),{display:"flex",alignItems:"center",gap:"10px",justifyContent:"space-between",border:"1px solid #4445",borderRadius:"10px",padding:"12px 16px",background:"#1f2328",boxShadow:"0 0 0 1px #0002 inset",width:"min(760px, 100%)"}),s=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"4px"}),a=document.createElement("div");a.textContent="Global locker",a.style.fontWeight="600",a.style.fontSize="15px";let i=document.createElement("div");i.textContent="Set the rules for locking or allowing harvests using the filters below",i.style.opacity="0.8",i.style.fontSize="12px",s.append(a,i);let l=qe(document.createElement("label"),{display:"flex",alignItems:"center",gap:"8px"}),c=t.label("Enabled");c.style.margin="0";let d=t.switch(e.global.enabled);l.append(c,d),o.append(s,l);let u=dw(t,e.global.settings,{onChange:()=>e.notifyGlobalSettingsChanged()});r.append(o,u.root),n.append(r);let y=()=>{Nm(d,e.global.enabled),u.setDisabled(!e.global.enabled),u.refresh()};d.addEventListener("change",()=>{e.setGlobalEnabled(!!d.checked)});let h=e.subscribe(()=>{y()});return y(),{render:p=>{p.innerHTML="",p.style.maxHeight="54vh",p.style.overflow="auto",p.append(n),y()},destroy:()=>h()}}function n5(t,e){let n=qe(document.createElement("div"),{display:"grid",gridTemplateColumns:"minmax(220px, 280px) minmax(0, 1fr)",gap:"10px",alignItems:"stretch",height:"54vh",overflow:"hidden"}),r=qe(document.createElement("div"),{display:"grid",gridTemplateRows:"1fr",gap:"8px",minHeight:"0"});n.appendChild(r);let o=qe(document.createElement("div"),{display:"grid",gridTemplateColumns:"1fr",rowGap:"6px",overflow:"auto",paddingRight:"2px",border:"1px solid #4445",borderRadius:"10px",padding:"6px"});r.appendChild(o);let s=qe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",minHeight:"0"});n.appendChild(s);let a=qe(document.createElement("div"),{display:"grid",gap:"12px",justifyItems:"center",alignContent:"start",height:"100%",overflow:"auto"});s.appendChild(a);let i=null,l=null,c=new Map,d=S=>{let w=Math.max(0,S.scrollHeight-S.clientHeight);return Math.max(0,Math.min(S.scrollTop,w))},u=(S,w)=>{let x=Math.max(0,S.scrollHeight-S.clientHeight),E=Math.max(0,Math.min(w,x));return S.scrollTop=E,E},y=S=>{let w=c.get(S)??{detail:0,card:0};w.detail=d(a);let x=a.querySelector('[data-locker-settings-card="1"]');x&&(w.card=d(x)),c.set(S,w)};a.addEventListener("scroll",()=>{if(!l)return;let S=c.get(l)??{detail:0,card:0};S.detail=d(a),c.set(l,S)});let h=()=>{let S=d(o);o.innerHTML="";let w=Ac();if(!w.length){let E=document.createElement("div");E.textContent="No crops available.",E.style.opacity="0.7",E.style.fontSize="12px",E.style.textAlign="center",E.style.padding="16px",o.appendChild(E),u(o,S),i=null;return}Er(),i&&!w.some(E=>E.key===i)&&(i=null);let x=document.createDocumentFragment();w.forEach(E=>{let T=document.createElement("button");T.className="qmm-vtab",T.style.display="grid",T.style.gridTemplateColumns="16px 1fr auto",T.style.alignItems="center",T.style.gap="8px",T.style.textAlign="left",T.style.padding="6px 8px",T.style.borderRadius="8px",T.style.border="1px solid #4445",T.style.background=i===E.key?"#2b8a3e":"#1f2328",T.style.color="#e7eef7";let A=document.createElement("span");A.className="qmm-dot",A.style.background=e.getOverride(E.key)?.enabled?"#2ecc71":"#e74c3c";let N=document.createElement("span");N.className="label",N.textContent=E.cropName||E.key;let H=Na(E.key)||Da(E.seedName)||"\u{1F331}",C=kc(E.key,{size:24,fallback:H});T.append(A,N,C),T.onmouseenter=()=>T.style.borderColor="#6aa1",T.onmouseleave=()=>T.style.borderColor="#4445",T.onclick=()=>{i!==E.key&&(i=E.key,h(),f())},x.appendChild(T)}),o.appendChild(x),u(o,S)},f=()=>{if(l&&y(l),a.innerHTML="",!i){let _=document.createElement("div");_.textContent="Select a crop on the left to customise its locker settings.",_.style.opacity="0.7",_.style.fontSize="13px",_.style.textAlign="center",_.style.padding="32px 24px",_.style.border="1px dashed #4445",_.style.borderRadius="10px",_.style.width="min(760px, 100%)",a.appendChild(_),l=null;return}let w=Ac().find(_=>_.key===i);if(!w){i=null,l=null,f();return}let x=e.ensureOverride(i,{silent:!0}),E=t.flexRow({justify:"between",align:"center",fullWidth:!0});E.style.border="1px solid #4445",E.style.borderRadius="10px",E.style.padding="12px 16px",E.style.background="#1f2328",E.style.boxShadow="0 0 0 1px #0002 inset",E.style.width="min(760px, 100%)";let T=t.flexRow({gap:10,align:"center"});T.style.flexWrap="nowrap";let A=Na(w.key)||Da(w.seedName)||"\u{1F331}",N=kc(w.key,{size:32,fallback:A}),H=document.createElement("div");H.textContent=w.cropName||w.key,H.style.fontWeight="600",H.style.fontSize="15px",T.append(N,H);let C=t.flexRow({gap:8,align:"center"});C.style.flexWrap="nowrap";let L=t.label("Override");L.style.margin="0";let v=t.switch(x.enabled);C.append(L,v),E.append(T,C);let B=document.createElement("div");B.style.fontSize="12px",B.style.opacity="0.75",B.style.textAlign="center",B.style.width="min(760px, 100%)";let le=()=>{B.textContent=x.enabled?"This crop uses its own locker filters.":"Uses the global locker settings."},X=dw(t,x.settings,{onChange:()=>{i&&e.notifyOverrideSettingsChanged(i)}}),de=()=>{X.setDisabled(!x.enabled),X.refresh(),le()};if(v.addEventListener("change",()=>{if(!i)return;let _=x.enabled,re=!!v.checked;re&&!_&&!x.hasPersistedSettings&&X2(x.settings,e.global.settings),re&&(x.hasPersistedSettings=!0),e.setOverrideEnabled(i,re)}),de(),a.append(E,B,X.root),i){let _=c.get(i)??{detail:0,card:0};_.detail=u(a,_.detail),_.card=u(X.root,_.card),c.set(i,_);let re=i;X.root.addEventListener("scroll",()=>{if(l!==re)return;let R=c.get(re)??{detail:d(a),card:0};R.card=d(X.root),c.set(re,R)}),l=re}},p=()=>{h(),f()},m=e.subscribe(p);return{render:S=>{S.innerHTML="",S.append(n),p()},destroy:()=>m()}}async function uw(t){let e=new Qe({id:"locker",compact:!0});e.mount(t);let n=new Lm(xt.getState()),r=e5(e),o=t5(e,n),s=n5(e,n);e.addTabs([{id:"locker-general",title:"General",render:l=>o.render(l)},{id:"locker-overrides",title:"Overrides",render:l=>s.render(l)},{id:"locker-restrictions",title:"Restrictions",render:l=>r.render(l)}]),e.switchTo("locker-general");let a=[];a.push(xt.subscribe(l=>n.syncFromService(l.state))),a.push(()=>r.destroy()),a.push(()=>o.destroy()),a.push(()=>s.destroy());let i=()=>{for(;a.length;){let l=a.pop();try{l?.()}catch{}}};e.on("unmounted",i)}var Ce="mg-crop-simulation",vn=50,no=100,Nn=1,r5=3,Dm=["None","Gold","Rainbow"],qm=["None","Wet","Chilled","Frozen"],Om=["None","Dawnlit","Dawnbound","Amberlit","Amberbound"],ns=["+0%","+10%","+20%","+30%","+40%","+50%"],rs=1,ww=ns.length,o5={None:{mgColor:"none"},Gold:{mgColor:"gold"},Rainbow:{mgColor:"rainbow"}},s5={None:{mgWeather:"none"},Wet:{mgWeather:"wet"},Chilled:{mgWeather:"chilled"},Frozen:{mgWeather:"frozen"}},a5={None:{mgLighting:"none"},Dawnlit:{mgLighting:"dawnlit"},Dawnbound:{mgLighting:"dawnbound"},Amberlit:{mgLighting:"amberlit"},Amberbound:{mgLighting:"amberbound"}},Wm=new Qe({compact:!0}),i5=Wm.ensureStyles;i5?.call(Wm);var l5=new Intl.NumberFormat("en-US"),c5=new Intl.NumberFormat("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}),d5={sizePercent:vn,color:"None",weatherCondition:"None",weatherLighting:"None",friendPlayers:rs},pw=96;var mw=["wet","chilled","frozen"],u5=[["dawnlit"],["dawnbound","dawncharged","dawn radiant","dawnradiant","dawn-radiant"],["ambershine","amberlit"],["amberbound","ambercharged","amber radiant","amberradiant","amber-radiant"]],xw={Wet:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.2},Chilled:{blendMode:"source-atop",colors:["rgb(183, 183, 236)"],alpha:.5},Frozen:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.6},Dawnlit:{blendMode:"source-atop",colors:["rgb(120, 100, 180)"],alpha:.4},Ambershine:{blendMode:"source-atop",colors:["rgb(255, 140, 26)","rgb(230, 92, 26)","rgb(178, 58, 26)"],alpha:.5},Dawncharged:{blendMode:"source-atop",colors:["rgb(100, 80, 160)","rgb(110, 90, 170)","rgb(120, 100, 180)"],alpha:.5},Ambercharged:{blendMode:"source-atop",colors:["rgb(167, 50, 30)","rgb(177, 60, 40)","rgb(187, 70, 50)"],alpha:.5}},p5=(()=>{let t=new Map;mw.forEach((n,r)=>{t.set(n.toLowerCase(),r)});let e=mw.length;return u5.forEach(n=>{n.forEach(r=>{t.set(r.toLowerCase(),e)}),e+=1}),t})(),m5=new Set(["dawnlit","dawncharged","ambershine","ambercharged"]),f5=new Map([["wet","Wet"],["damp","Wet"],["moist","Wet"],["chilled","Chilled"],["cold","Chilled"],["frozen","Frozen"],["ice","Frozen"],["icy","Frozen"],["dawnlit","Dawnlit"],["dawn-lit","Dawnlit"],["dawnbound","Dawnlit"],["dawn-bound","Dawnlit"],["dawncharged","Dawncharged"],["dawn-charged","Dawncharged"],["dawn radiant","Dawncharged"],["dawnradiant","Dawncharged"],["dawn-radiant","Dawncharged"],["ambershine","Ambershine"],["amber-shine","Ambershine"],["amberlit","Ambershine"],["amber-lit","Ambershine"],["amberbound","Ambercharged"],["amber-bound","Ambercharged"],["ambercharged","Ambercharged"],["amber-charged","Ambercharged"],["amber radiant","Ambercharged"],["amberradiant","Ambercharged"],["amber-radiant","Ambercharged"]]),y5=(()=>{let t=new Map;return Object.keys(xw).forEach(e=>{t.set(e.toLowerCase(),e)}),f5.forEach((e,n)=>{t.set(n,e)}),t})(),g5=(()=>{let t=new Map,e=Nr;for(let[n,r]of Object.entries(e))typeof n!="string"||typeof r!="string"||(t.set(n.toLowerCase(),r),t.set(r.toLowerCase(),r));return t})(),h5=new Set(["Bamboo","Cactus"]),fw=(()=>{let t=new Map,e=an;for(let[s,a]of Object.entries(e)){if(typeof s!="string"||!s.trim())continue;let i=typeof a?.name=="string"&&a.name.trim().length>0?a.name:s,l=typeof a?.tileRef=="number"?a.tileRef:null,c=l!=null?"weather":"color",d={id:s,label:i,tileRef:l,category:c};t.set(s.toLowerCase(),d),t.set(i.toLowerCase(),d)}let n=Nr;for(let[s,a]of Object.entries(n)){if(typeof s!="string"||typeof a!="string")continue;let i=t.get(s.toLowerCase());if(!i)continue;let l=a.toLowerCase();t.has(l)||t.set(l,i)}let r=t.get("gold");r&&t.set("golden",r);let o={id:"Normal",label:"Normal",tileRef:null,category:"color"};return t.set("normal",o),t})(),Hc=new Map,Rc=new Map,Fm=new Map,_c=new Map,Wc=new Map,Nc=new Map,zc=new Map,Dc=new Map,Gc=new Map,qc=new Map,yw=0,b5=`
.${Ce} {
  display: none;
  width: min(100%, 500px);
  padding: 12px 14px;
  color: #e2e8f0;
  display: flex;
  flex-direction: column;
  gap: 10px;
  font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
  position: relative;
  z-index: 2000;
  pointer-events: auto;
}
.${Ce} .mg-crop-simulation__header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 8px;
}
.${Ce} .mg-crop-simulation__title {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  color: #f8fafc;
}
.${Ce} .mg-crop-simulation__crop-name {
  font-size: 13px;
  font-weight: 600;
  color: #38bdf8;
  text-transform: capitalize;
}
.${Ce} .mg-crop-simulation__sprite-section {
  display: flex;
  flex-direction: column;
}
.${Ce} .mg-crop-simulation__sprite-box {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
}
.${Ce} .mg-crop-simulation__sprite {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: ${pw}px;
  height: ${pw}px;
  position: relative;
  flex-shrink: 0;
  --mg-crop-simulation-scale: 1;
  transform-origin: center;
  transform: scale(var(--mg-crop-simulation-scale));
}
.${Ce} .mg-crop-simulation__sprite-layer,
.${Ce} .mg-crop-simulation__sprite-fallback {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.${Ce} .mg-crop-simulation__sprite-layer img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
}
.${Ce} .mg-crop-simulation__sprite-layer--base {
  z-index: 1;
}
.${Ce} .mg-crop-simulation__sprite-layer--overlay {
  z-index: 2;
  transform: translateY(-4px);
}
.${Ce} .mg-crop-simulation__sprite-layer--overlay-lighting {
  transform: translateY(-30px);
}
.${Ce} .mg-crop-simulation__sprite-fallback {
  z-index: 0;
  font-size: 42px;
}
.${Ce} .mg-crop-simulation__slider-container {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 6px;
}
.${Ce} .mg-crop-simulation__slider-row {
  display: flex;
  align-items: center;
  gap: 8px;
}
.${Ce} .mg-crop-simulation__slider-label {
  font-size: 12px;
  color: rgba(226, 232, 240, 0.82);
  flex: 0 0 auto;
}
.${Ce} .mg-crop-simulation__slider-value {
  margin-left: auto;
  font-size: 12px;
  font-variant-numeric: tabular-nums;
  color: #f8fafc;
  text-align: right;
  width: 4ch;
  min-width: 4ch;
  flex: 0 0 4ch;
  white-space: nowrap;
}
.${Ce} .mg-crop-simulation__slider-weight {
  font-size: 11px;
  color: rgba(148, 163, 184, 0.82);
  font-variant-numeric: tabular-nums;
  text-align: center;
  white-space: nowrap;
}
.${Ce} .mg-crop-simulation__slider {
  flex: 1 1 auto;
  min-width: 0;
  accent-color: #38bdf8;
}
.${Ce} .mg-crop-simulation__price {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 700;
  font-size: 14px;
  color: #ffd84d;
  align-self: flex-start;
  margin-top: auto;
}
.${Ce} .mg-crop-simulation__price-icon {
  width: 20px;
  height: 20px;
  flex: 0 0 auto;
  display: inline-block;
  user-select: none;
  pointer-events: none;
}
.${Ce} .mg-crop-simulation__price-value {
  line-height: 1;
}
.${Ce} .mg-crop-simulation__section-title {
  font-size: 11px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgba(148, 163, 184, 0.9);
}
.${Ce}.mg-crop-simulation--calculator {
  align-items: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__layout {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 12px;
  width: min(440px, 100%);
  margin: 0 auto;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section {
  display: grid;
  gap: 10px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #4446;
  background: #1f2328;
  box-shadow: 0 0 0 1px #0002 inset;
  justify-items: stretch;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section-heading {
  font-size: 11px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgba(226, 232, 240, 0.82);
  font-weight: 600;
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section--preview {
  justify-items: center;
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section--preview .mg-crop-simulation__slider-row {
  width: 100%;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__mutations-weather {
  display: grid;
  gap: 8px;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__mutations-heading {
  font-size: 10px;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: rgba(148, 163, 184, 0.82);
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price {
  margin-top: 0;
}
.${Ce} .mg-crop-simulation__segmented {
  display: flex;
  width: 100%;
}
.${Ce} .mg-crop-simulation__segmented-control {
  --qmm-bg-soft: rgba(11, 15, 19, 0.8);
  --qmm-border-2: rgba(148, 163, 184, 0.28);
  --qmm-text: #e2e8f0;
  --qmm-text-dim: rgba(148, 163, 184, 0.82);
  --seg-pad: 6px;
  --seg-fill: rgba(56, 191, 248, 0.02);
  --seg-stroke-color: rgba(255, 255, 255, 0.49);
  flex: 1 1 auto;
  min-width: 0;
  width: 100%;
}
.${Ce} .mg-crop-simulation__segmented-control .qmm-seg__btn {
  font-size: 11px;
  letter-spacing: 0.02em;
  font-weight: 600;
  flex: 1 1 0;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  min-width: 0;
}
.${Ce} .qmm-seg__btn[data-mg-color="none"],
.${Ce} .qmm-seg__btn[data-mg-color="none"].active {
  color: rgba(148, 163, 184, 0.92);
}
.${Ce} .qmm-seg__btn[data-mg-color="gold"],
.${Ce} .qmm-seg__btn[data-mg-color="gold"].active {
  color: #facc15;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-color="gold"] .qmm-seg__btn-label,
.${Ce} .qmm-seg__btn[data-mg-color="gold"].active .qmm-seg__btn-label {
  color: transparent;
  background-image: linear-gradient(90deg, #fef08a, #facc15, #fef08a);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 100% 100%;
  background-repeat: no-repeat;
}
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"],
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"].active {
  color: #fbbf24;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"] .qmm-seg__btn-label,
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"].active .qmm-seg__btn-label {
  color: transparent;
  background-image: linear-gradient(90deg, #f87171, #fbbf24, #34d399, #38bdf8, #c084fc);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 100% 100%;
  background-repeat: no-repeat;
}
.${Ce} .qmm-seg__btn[data-mg-weather="none"],
.${Ce} .qmm-seg__btn[data-mg-weather="none"].active,
.${Ce} .qmm-seg__btn[data-mg-lighting="none"],
.${Ce} .qmm-seg__btn[data-mg-lighting="none"].active {
  color: rgba(148, 163, 184, 0.92);
}
.${Ce} .qmm-seg__btn[data-mg-weather="wet"],
.${Ce} .qmm-seg__btn[data-mg-weather="wet"].active {
  color: #5AF6F5;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-weather="chilled"],
.${Ce} .qmm-seg__btn[data-mg-weather="chilled"].active {
  color: #AFE0F6;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-weather="frozen"],
.${Ce} .qmm-seg__btn[data-mg-weather="frozen"].active {
  color: #AABEFF;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnlit"],
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnlit"].active {
  color: #7864B4;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnbound"],
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnbound"].active {
  color: #9785CB;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="amberlit"],
.${Ce} .qmm-seg__btn[data-mg-lighting="amberlit"].active {
  color: #A04632;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="amberbound"],
.${Ce} .qmm-seg__btn[data-mg-lighting="amberbound"].active {
  color: #F06E50;
  font-weight: 700;
}
.${Ce} .mg-crop-simulation__mutations-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
`,gw=null;function S5(){gw||(gw=wa(b5))}function hw(t){if(typeof t!="string")return null;let e=t.trim().toLowerCase();return e?y5.get(e)??null:null}function jc(t){return hw(t.id)??hw(t.label)}function Kc(t){let e=t.toLowerCase();return p5.get(e)??Number.MAX_SAFE_INTEGER}function v5(t){return m5.has(t.toLowerCase())}function zm(t){let e=new Set,n=new Map,r=[];return t.forEach((o,s)=>{e.has(o)||(e.add(o),r.push(o),n.set(o,s))}),r.sort((o,s)=>{let a=Kc(o)-Kc(s);return a!==0?a:(n.get(o)??0)-(n.get(s)??0)}),r}function w5(t){let e=t.map(n=>jc(n)).filter(n=>n!=null);return zm(e)}function Ew(t,e,n){return`${t}::variant::${e}::effects::${n.join("+")}`}function x5(){let t=new Set;try{Ie.listTilesByCategory(/mutations/i).forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return e.length?e:["mutations"]}async function E5(t){if(await Pt(),typeof window>"u")return null;let e=De[t];if(!e)return null;let n=e?.crop?.tileRef??e?.plant?.tileRef??e?.seed?.tileRef,r=A5(t),o=T5(n,r);if(o==null)return null;for(let s of r)try{let i=(await kt(s)).find(c=>c.index===o);if(!i)continue;let l=Ie.toCanvas(i);if(l&&l.width>0&&l.height>0){let c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");if(!d)continue;return d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),c}}catch{}return null}function Cw(t){let e=Fm.get(t);if(e!==void 0)return Promise.resolve(e);let n=_c.get(t);if(n)return n;let r=E5(t).then(o=>(Fm.set(t,o),_c.delete(t),o)).catch(()=>(Fm.set(t,null),_c.delete(t),null));return _c.set(t,r),r}async function Mw(t,e){let n=await Cw(t);if(!n)return null;if(e==="normal")return n;let r={sheet:"",url:"",index:0,col:0,row:0,size:n.width,data:n};return Ie.toCanvas(r)}function C5(t,e){if(e==="normal")return I5(t);let n=`${t}::${e}`,r=Wc.get(n);if(r!==void 0)return Promise.resolve(r);let o=Nc.get(n);if(o)return o;let s=Mw(t,e).then(a=>a?a.toDataURL():null).then(a=>(Wc.set(n,a??null),Nc.delete(n),a??null)).catch(()=>(Wc.set(n,null),Nc.delete(n),null));return Nc.set(n,s),s}function M5(t){let e=t.tileRef;if(e==null)return Promise.resolve(null);let n=t.id.toLowerCase(),r=Gc.get(n);if(r!==void 0)return Promise.resolve(r);let o=qc.get(n);if(o)return o;let s=(async()=>{await Pt();let a=x5(),i=e>0?e-1:e;for(let l of a)try{let d=(await kt(l)).find(y=>y.index===i);if(!d)continue;let u=Ie.toCanvas(d);if(u&&u.width>0&&u.height>0){let y=document.createElement("canvas");y.width=u.width,y.height=u.height;let h=y.getContext("2d");if(!h)continue;return h.imageSmoothingEnabled=!1,h.drawImage(u,0,0),y.toDataURL()}}catch{}return null})().then(a=>(Gc.set(n,a),qc.delete(n),a)).catch(()=>(Gc.set(n,null),qc.delete(n),null));return qc.set(n,s),s}function A5(t){let e=new Set;try{Ie.listPlants().forEach(s=>e.add(s))}catch{}try{Ie.listAllPlants().forEach(s=>e.add(s))}catch{}let n=Array.from(e,s=>{let a=s.split(/[?#]/)[0]??s;return(a.split("/").pop()??a).replace(/\.[^.]+$/,"")});if(!t)return n.length?n:["plants"];let r=n.map(s=>s.toLowerCase()),o=s=>n.filter((a,i)=>s(a,r[i]??a.toLowerCase()));if(h5.has(t)){let s=o((i,l)=>l==="tallplants");if(s.length)return s;let a=o((i,l)=>/tall/.test(i)||/tall/.test(l));if(a.length)return a}else{let s=o((i,l)=>l==="plants");if(s.length)return s;let a=o((i,l)=>!/tall/.test(i)&&!/tall/.test(l));if(a.length)return a}return n.length?n:["plants"]}function T5(t,e=[]){let n=typeof t=="number"&&Number.isFinite(t)?t:Number(t);if(!Number.isFinite(n))return null;if(n<=0)return n;let r=e.map(o=>o.toLowerCase());return r.some(o=>o.includes("tall"))||r.some(o=>o.includes("plants")),n-1}function I5(t){let e=Hc.get(t);if(e!==void 0)return Promise.resolve(e);let n=Rc.get(t);if(n)return n;let r=Cw(t).then(o=>{let s=o?o.toDataURL():null;return Hc.set(t,s),Rc.delete(t),s}).catch(()=>(Hc.set(t,null),Rc.delete(t),null));return Rc.set(t,r),r}function k5(t){let e=t.map((n,r)=>({mutation:n,index:r}));return e.sort((n,r)=>{let o=jc(n.mutation),s=jc(r.mutation),a=o?Kc(o):Number.MAX_SAFE_INTEGER,i=s?Kc(s):Number.MAX_SAFE_INTEGER;return a!==i?a-i:n.index-r.index}),e.map(n=>n.mutation)}function P5(t,e){if(!e.colors.length)return;let n=t.getContext("2d");if(n){if(n.save(),n.imageSmoothingEnabled=!1,n.globalCompositeOperation=e.blendMode,n.globalAlpha=e.alpha,e.colors.length===1)n.fillStyle=e.colors[0]??"transparent";else{let r=n.createLinearGradient(0,0,0,t.height),o=e.colors.length-1;e.colors.forEach((s,a)=>{let i=o===0?0:a/o;r.addColorStop(i,s)}),n.fillStyle=r}n.fillRect(0,0,t.width,t.height),n.restore()}}function L5(t,e,n){let r=zm(n);if(!r.length)return C5(t,e);let o=Ew(t,e,r),s=zc.get(o);if(s!==void 0)return Promise.resolve(s);let a=Dc.get(o);if(a)return a;let i=Mw(t,e).then(l=>{if(!l)return null;let c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");return d?(d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),r.forEach(u=>{let y=xw[u];y&&P5(c,y)}),c.toDataURL()):null}).then(l=>(zc.set(o,l??null),Dc.delete(o),l??null)).catch(()=>(zc.set(o,null),Dc.delete(o),null));return Dc.set(o,i),i}function R5(t,e,n){let r=zm(n);if(r.length===0){if(e==="normal")return Hc.get(t);let s=`${t}::${e}`;return Wc.get(s)}let o=Ew(t,e,r);return zc.get(o)}function _5(t){let e=jc(t);return e?v5(e):!1}function Oc(t,e,n,r){if(t.innerHTML="",e){let o=document.createElement("span");o.className="mg-crop-simulation__sprite-layer mg-crop-simulation__sprite-layer--base";let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,o.appendChild(s),t.appendChild(o)}if(n.forEach(({src:o,mutation:s},a)=>{let i=document.createElement("span");i.className="mg-crop-simulation__sprite-layer mg-crop-simulation__sprite-layer--overlay",i.style.setProperty("--mg-crop-simulation-layer",String(a+1)),_5(s)&&i.classList.add("mg-crop-simulation__sprite-layer--overlay-lighting");let l=document.createElement("img");l.src=o,l.alt="",l.decoding="async",l.loading="lazy",l.draggable=!1,i.appendChild(l),t.appendChild(i)}),!e&&n.length===0){let o=document.createElement("span");o.className="mg-crop-simulation__sprite-fallback";let s=typeof r=="string"&&r.trim().length>0?r:"\u{1F331}";o.textContent=s,t.appendChild(o)}}function N5(t,e,n){yw+=1;let r=yw;if(t.dataset.spriteSeq=String(r),!e){Oc(t,null,[],n.fallback??null);return}let{colorVariant:o,weatherMutations:s}=n,a=k5(s),i=o==="normal"?w5(a):[],l=R5(e,o,i),c=a.map(h=>{let f=Gc.get(h.id.toLowerCase());return typeof f=="string"&&f.length>0?{mutation:h,src:f}:null}).filter(h=>h!=null);Oc(t,typeof l=="string"?l:null,c,n.fallback??null);let u=L5(e,o,i),y=a.map(async h=>({mutation:h,src:await M5(h)}));Promise.all([u,Promise.all(y)]).then(([h,f])=>{if(t.dataset.spriteSeq!==String(r))return;let p=f.filter(m=>typeof m.src=="string"&&m.src.length>0);Oc(t,h??null,p,n.fallback??null)}).catch(()=>{t.dataset.spriteSeq===String(r)&&Oc(t,null,[],n.fallback??null)})}function D5(t){let e=typeof t=="string"?t.trim().toLowerCase():"";return e==="gold"?"gold":e==="rainbow"?"rainbow":"normal"}function q5(t){if(typeof t!="string")return null;let e=t.trim();if(!e)return null;let n=e.toLowerCase(),r=fw.get(n);if(r)return r;let o=g5.get(n);if(o){let s=fw.get(o.toLowerCase());if(s)return s}return{id:e,label:e,tileRef:null,category:"weather"}}function O5(t,e,n={}){let r=n.colorLabel??"None",o=D5(r),s=Array.isArray(n.weatherLabels)?n.weatherLabels:[],a=new Set,i=[];for(let l of s){if(!l||typeof l!="string")continue;let c=q5(l);if(!c||c.category!=="weather")continue;let d=c.id.toLowerCase();a.has(d)||(a.add(d),i.push(c))}N5(t,e,{colorVariant:o,weatherMutations:i,fallback:n.fallback??null})}var Ba=(t,e)=>{let n=r=>r.startsWith("--")?r:r.replace(/[A-Z]/g,o=>"-"+o.toLowerCase());for(let[r,o]of Object.entries(e))t.style.setProperty(n(r),o);return t},bw=null;function F5(){S5(),!bw&&(bw=wa(`
    .${Ce}.mg-crop-simulation--calculator {
      width: 100%;
      max-width: none;
      min-width: 0;
      position: relative;
    }
    .${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price {
      justify-content: center;
      margin: 0 0 12px;
      font-size: 20px;
      gap: 10px;
    }
    .${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price-value {
      font-size: 20px;
    }
    .mg-crop-calculator__placeholder {
      font-size: 13px;
      text-align: center;
      opacity: 0.7;
      padding: 24px 12px;
    }
  `))}function os(t,e,n){return Math.min(n,Math.max(e,t))}function Wa(t,e){let n=typeof t=="string"?t.trim().toLowerCase():"";for(let r of e)if(r.toLowerCase()===n)return r;return e[0]}function Aw(t){if(typeof t!="number"||!Number.isFinite(t))return rs;let e=Math.round(t);return os(e,rs,ww)}function B5(t){let e=Aw(t);return ns[e-1]??ns[0]}function H5(t){let e=Wa(t,ns),n=ns.indexOf(e),r=n>=0?n+1:rs;return os(r,rs,ww)}function W5(t,e){let r=os(Math.round(e),vn,no)/100;t.style.setProperty("--mg-crop-simulation-scale",r.toString())}function Bm(t,e,n,r){let o=os(Math.round(e),vn,no);t.sizeSlider.value=String(o),t.sizeValue.textContent=`${o}%`,W5(t.sprite,o),typeof n=="number"&&Number.isFinite(n)&&n>Nn?t.sizeSlider.dataset.maxScale=String(n):delete t.sizeSlider.dataset.maxScale;let[s,a]=G5(r,o,n);t.sizeWeight.textContent=j5(s,a)}function Ha(t){if(typeof t!="number"||!Number.isFinite(t))return"\u2014";let e=Math.max(0,Math.round(t));return l5.format(e)}function z5(t,e){let n=typeof t=="number"&&Number.isFinite(t)?Math.max(0,t):null,r=typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):null;return n==null&&r==null?"\u2014":n==null?Ha(r):r==null||Math.round(n)===Math.round(r)?Ha(n):`${Ha(n)} \u2013 ${Ha(r)}`}function G5(t,e,n){let r=typeof t=="number"?t:Number(t);if(!Number.isFinite(r)||r==null||r<=0)return[null,null];let o=Tw(e,n);if(!Number.isFinite(o)||o<=0)return[null,null];let s=r*o,a=typeof n=="number"&&Number.isFinite(n)&&n>Nn?n:Nn,i=1+Math.max(0,(a-o)*.02),l=s*i;return[s,l]}function Sw(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?null:c5.format(t).replace(/(\.\d*?[1-9])0+$/u,"$1").replace(/\.0+$/u,"")}function j5(t,e){let n=Sw(t),r=Sw(e);return!n&&!r?"\u2014":!r||n===r?`${n??r} kg`:`${n??"\u2014"} \u2013 ${r} kg`}function Tw(t,e){let n=Number(t);if(!Number.isFinite(n))return Nn;let r=os(n,vn,no),o=typeof e=="number"&&Number.isFinite(e)&&e>Nn?e:r5;if(o<=Nn)return Nn;let s=(r-vn)/(no-vn),a=Nn+s*(o-Nn);return Number.isFinite(a)?a:Nn}function Fc(t,e,n,r,o){let s=Wa(e,t),a=t.map(l=>({value:l,label:l,disabled:!n})),i=Wm.segmented(a,s,n&&r?l=>r(l):void 0,{ariaLabel:o,fullWidth:!0});return i.classList.add("mg-crop-simulation__segmented-control"),i}function Hm(t,e){t.querySelectorAll(".qmm-seg__btn").forEach(r=>{let o=r.textContent?.trim();if(!o)return;let s=e[o];s&&Object.entries(s).forEach(([a,i])=>{i&&(r.dataset[a]=i)})})}function K5(t){let e=[];return t.color!=="None"&&e.push(t.color),t.weatherCondition!=="None"&&e.push(t.weatherCondition),t.weatherLighting!=="None"&&e.push(t.weatherLighting),e}function U5(t){let e=[];return t.weatherCondition!=="None"&&e.push(t.weatherCondition),t.weatherLighting!=="None"&&e.push(t.weatherLighting),e}function vw(t,e,n,r){let o=Tw(n,r);if(!Number.isFinite(o)||o<=0)return null;let s=K5(e),a=Aw(e.friendPlayers),i={...xa,friendPlayers:a},l=Jr(t,o,s,i);return Number.isFinite(l)&&l>0?l:null}function Bc(t){let e=De[t],n=[e?.crop?.maxScale,e?.plant?.maxScale,e?.seed?.maxScale];for(let r of n){let o=typeof r=="number"?r:Number(r);if(Number.isFinite(o)&&o>0)return o}return null}function V5(t){let e=De[t],n=[e?.produce?.baseWeight,e?.crop?.baseWeight,e?.item?.baseWeight,e?.seed?.baseWeight];for(let r of n){let o=typeof r=="number"?r:Number(r);if(Number.isFinite(o)&&o>0)return o}return null}async function Iw(t){F5(),Er();let e=new Qe({id:"calculator",compact:!0});e.addTab("crops","Crops",n=>{n.innerHTML="",n.style.padding="8px",n.style.boxSizing="border-box",n.style.height="61vh",n.style.overflow="auto",n.style.display="grid";let r=Ba(document.createElement("div"),{display:"grid",gridTemplateColumns:"minmax(220px, 280px) minmax(0, 1fr)",gap:"10px",alignItems:"stretch",height:"100%",overflow:"hidden"});n.appendChild(r);let o=Ba(document.createElement("div"),{display:"grid",gridTemplateRows:"minmax(0, 1fr)",minHeight:"0",flex:"0 0 260px",minWidth:"220px",maxWidth:"280px"});r.appendChild(o);let s=Ba(document.createElement("div"),{display:"grid",gridTemplateColumns:"1fr",overflow:"auto",paddingRight:"2px",border:"1px solid #4445",borderRadius:"10px",minHeight:"0",height:"100%"});o.appendChild(s);let a=Ba(document.createElement("div"),{display:"flex",flexDirection:"column",minHeight:"0",flex:"1 1 auto"});r.appendChild(a);let i=Ba(document.createElement("div"),{flex:"1 1 auto",overflow:"auto",display:"flex",justifyContent:"center"});a.appendChild(i);let l=document.createElement("div");l.className=`${Ce} mg-crop-simulation--visible mg-crop-simulation--calculator`;let c=document.createElement("div");c.className="mg-crop-calculator__layout";let d=(W,b)=>{let D=document.createElement("div");if(D.className="mg-crop-calculator__section",b&&D.classList.add(b),W){let F=document.createElement("div");F.className="mg-crop-calculator__section-heading",F.textContent=W,D.appendChild(F)}return D},u=d(null,"mg-crop-calculator__section--preview"),y=document.createElement("div");y.className="mg-crop-simulation__price";let h=document.createElement("img");h.className="mg-crop-simulation__price-icon",h.src=po.img64,h.alt="",h.decoding="async",h.loading="lazy",h.setAttribute("aria-hidden","true"),h.draggable=!1;let f=document.createElement("span");f.className="mg-crop-simulation__price-value",f.textContent="\u2014",y.append(h,f);let p=document.createElement("div");p.className="mg-crop-simulation__sprite-section";let m=document.createElement("div");m.className="mg-crop-simulation__sprite-box";let g=document.createElement("span");g.className="mg-crop-simulation__sprite",m.appendChild(g);let S=document.createElement("div");S.className="mg-crop-simulation__slider-container";let w=document.createElement("div");w.className="mg-crop-simulation__slider-row";let x=document.createElement("span");x.className="mg-crop-simulation__slider-label",x.textContent="Size";let E=e.slider(vn,no,1,vn);E.classList.add("mg-crop-simulation__slider"),E.disabled=!0;let T=document.createElement("span");T.className="mg-crop-simulation__slider-value",T.textContent=`${vn}%`;let A=document.createElement("span");A.className="mg-crop-simulation__slider-weight",A.textContent="\u2014",w.append(x,E,T),S.append(w,A),p.append(m,S),u.appendChild(p);let N=d("Mutations"),H=document.createElement("div");H.className="mg-crop-simulation__segmented",N.appendChild(H);let C=document.createElement("div");C.className="mg-crop-calculator__mutations-weather";let L=document.createElement("div");L.className="mg-crop-simulation__segmented";let v=document.createElement("div");v.className="mg-crop-simulation__segmented",C.append(L,v),N.appendChild(C);let B=d("Friend bonus","mg-crop-calculator__section--friend-bonus"),le=document.createElement("div");le.className="mg-crop-simulation__segmented",B.appendChild(le),c.append(y,u,N,B),l.appendChild(c),i.appendChild(l);let X={root:l,sprite:g,sizeSlider:E,sizeValue:T,sizeWeight:A,colorMutations:H,weatherConditions:L,weatherLighting:v,friendBonus:le,priceValue:f},de=new Map,_=new Map,re=Ac();re.forEach(W=>_.set(W.key,W));let R=W=>{let b=de.get(W);if(b)return b;let D={...d5};return de.set(W,D),D},k=null,V=null,ee=null;function ie(W,b){let D=W?.color??Dm[0],F=Fc(Dm,D,b,b?P=>{if(!k)return;let I=R(k);I.color=Wa(P,Dm),ie(I,!0),fe(I,!0),G(I,!0),Y(),j()}:void 0,"Mutations");Hm(F,o5),X.colorMutations.innerHTML="",X.colorMutations.appendChild(F)}function fe(W,b){let D=W?.weatherCondition??qm[0],F=Fc(qm,D,b,b?P=>{if(!k)return;let I=R(k);I.weatherCondition=Wa(P,qm),fe(I,!0),Y(),j()}:void 0,"Weather condition");Hm(F,s5),X.weatherConditions.innerHTML="",X.weatherConditions.appendChild(F)}function G(W,b){let D=W?.weatherLighting??Om[0],F=Fc(Om,D,b,b?P=>{if(!k)return;let I=R(k);I.weatherLighting=Wa(P,Om),G(I,!0),Y(),j()}:void 0,"Weather lighting");Hm(F,a5),X.weatherLighting.innerHTML="",X.weatherLighting.appendChild(F)}function Z(W,b){let D=B5(W?.friendPlayers??rs),F=Fc(ns,D,b,b?P=>{if(!k)return;let I=R(k);I.friendPlayers=H5(P),Z(I,!0),j()}:void 0,"Friend bonus");X.friendBonus.innerHTML="",X.friendBonus.appendChild(F)}function j(){let W=k;if(!W){X.priceValue.textContent="\u2014";return}let b=R(W),D=vw(W,b,b.sizePercent,V),F=Math.min(no,b.sizePercent+1),P=vw(W,b,F,V);X.priceValue.textContent=z5(D,P)}function Y(){let W=k;if(!W){X.sprite.innerHTML="";return}let b=R(W),D=_.get(W),F=Na(W)||(D?.seedName?Da(D.seedName):void 0)||"\u{1F331}";O5(X.sprite,W,{colorLabel:b.color,weatherLabels:U5(b),fallback:F})}function ne(){let W=k;if(!W){X.sprite.innerHTML="",X.sizeSlider.disabled=!0,ee=null,Bm(X,vn,null,ee),ie(null,!1),fe(null,!1),G(null,!1),Z(null,!1),X.priceValue.textContent="\u2014";return}V=Bc(W),ee=V5(W);let b=R(W);X.sizeSlider.disabled=!1,Bm(X,b.sizePercent,V,ee),ie(b,!0),fe(b,!0),G(b,!0),Z(b,!0),Y(),j()}E.addEventListener("input",()=>{if(!k)return;let W=R(k),b=Number(E.value),D=os(Math.round(b),vn,no);W.sizePercent=D,Bm(X,D,V,ee),j()});function q(){let W=s.scrollTop;if(s.innerHTML="",!re.length){let D=document.createElement("div");D.className="mg-crop-calculator__placeholder",D.textContent="No crops available.",s.appendChild(D),k=null,V=null,ne();return}k&&!re.some(D=>D.key===k)&&(k=re[0].key,V=Bc(k)),k||(k=re[0].key,V=Bc(k));let b=document.createDocumentFragment();Er(),re.forEach(D=>{let F=document.createElement("button");F.className="qmm-vtab",F.style.display="grid",F.style.gridTemplateColumns="16px 1fr auto",F.style.alignItems="center",F.style.gap="8px",F.style.textAlign="left",F.style.padding="6px 8px",F.style.marginBottom="6px",F.style.borderRadius="8px",F.style.border="1px solid #4445",F.style.background=k===D.key?"#2b8a3e":"#1f2328",F.style.color="#e7eef7";let P=document.createElement("span");P.className="qmm-dot",P.style.background=k===D.key?"#2ecc71":"#4c566a";let I=document.createElement("span");I.className="label",I.textContent=D.cropName||D.key;let J=Na(D.key)||Da(D.seedName)||"\u{1F331}",te=kc(D.key,{size:24,fallback:J});F.append(P,I,te),F.onmouseenter=()=>F.style.borderColor="#6aa1",F.onmouseleave=()=>F.style.borderColor="#4445",F.onclick=()=>{k!==D.key&&(k=D.key,V=Bc(D.key),q())},b.appendChild(F)}),s.appendChild(b),s.scrollTop=W,ne()}q()}),e.mount(t)}var Cr=t=>Math.max(1,Math.min(100,Math.round(t))),ft={globalEnabled:!0,generalEnabled:!1,defaultThresholdPct:25,pets:{}},Gm=!1,Vc=null,jm=[],za=new Map;function Y5(){try{let t=_e("pets.alerts");t&&typeof t=="object"&&(ft={globalEnabled:t.globalEnabled!==!1,generalEnabled:!!t.generalEnabled,defaultThresholdPct:Cr(t.defaultThresholdPct??ft.defaultThresholdPct),pets:typeof t.pets=="object"&&t.pets?t.pets:{}})}catch{}return ft}function ss(){try{Oe("pets.alerts",ft)}catch{}}function Km(t){let e=Cr(ft.defaultThresholdPct);if(ft.generalEnabled)return{enabled:ft.globalEnabled!==!1,thresholdPct:e};if(!t)return{enabled:!1,thresholdPct:e};let n=ft.pets[t]??{},r=n.enabled??!1,o=Cr(n.thresholdPct??e);return{enabled:r,thresholdPct:o}}async function kw(t){try{await Ae.trigger(t,{},"pets")}catch{}}function Q5(t){let e=String(t?.slot?.id||"");if(!e||!ft.globalEnabled){za.set(e,!1);return}let{enabled:n,thresholdPct:r}=Km(e),o=Me.getHungerPctFor(t),s=n&&Number.isFinite(o)&&o<r,a=za.get(e)===!0,i=ft.generalEnabled?"pets:general":`pet:${e}`,l=Ae.getPlaybackMode?.("pets")??"oneshot";if(s)l==="loop"?kw(i):a||kw(i);else try{Ae.stopLoop(i)}catch{}za.set(e,s)}async function Uc(t=null){let e=t??jm;for(let n of Array.isArray(e)?e:[])try{Q5(n)}catch{}}async function J5(){if(!Gm){Y5();try{Vc=await Me.onPetsChangeNow(t=>{jm=Array.isArray(t)?t.slice(0,3):[],Uc(jm)})}catch{Vc=null}Gm=!0}}function $5(){try{Vc?.()}catch{}Vc=null,Gm=!1,za.clear()}var wn={async start(){return await J5(),()=>$5()},isGlobalEnabled(){return ft.globalEnabled!==!1},setGlobalEnabled(t){ft.globalEnabled=!!t,t||za.clear(),ss()},isGeneralEnabled(){return!!ft.generalEnabled},setGeneralEnabled(t){ft.generalEnabled=!!t,ss(),this.refreshNow()},getGeneralThresholdPct(){return Cr(ft.defaultThresholdPct)},setGeneralThresholdPct(t){let e=Cr(t);return ft.defaultThresholdPct=e,ss(),this.refreshNow(),e},getDefaultThresholdPct(){return Cr(ft.defaultThresholdPct)},setDefaultThresholdPct(t){let e=Cr(t);return ft.defaultThresholdPct=e,ss(),e},isPetEnabled(t){return Km(t).enabled},setPetEnabled(t,e){t&&(ft.pets[t]={...ft.pets[t]||{},enabled:!!e},ss(),Uc())},getPetThresholdPct(t){return Km(t).thresholdPct},setPetThresholdPct(t,e){if(!t)return this.getDefaultThresholdPct();let n=Cr(e);return ft.pets[t]={...ft.pets[t]||{},thresholdPct:n},ss(),Uc(),n},async refreshNow(){await Uc()}};var Mr=null,Yc=null,Qc=null,Jc=null,$c=null,Jn=()=>{if(Mr){try{Mr.remove()}catch{}Mr=null}Yc&&(Yc(),Yc=null),Qc&&(Qc(),Qc=null),Jc&&(Jc(),Jc=null),$c&&($c(),$c=null)},Pw=(t,e)=>{e?(t.setAttribute("aria-disabled","true"),t.style.opacity="0.5",t.style.pointerEvents="none",t.style.cursor="not-allowed",t.title="Max owned \u2014 notifications disabled"):(t.removeAttribute("aria-disabled"),t.style.opacity="",t.style.pointerEvents="",t.style.cursor="",t.removeAttribute("title"))},Lw=t=>{let e=document.createElement("label");e.style.display="inline-flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.width="100%",e.style.padding="4px 6px",e.style.userSelect="none",e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let n=document.createElement("span");n.style.position="relative",n.style.width="42px",n.style.height="24px",n.style.borderRadius="999px",n.style.background="#1f2328",n.style.border="1px solid #4446",n.style.display="inline-block",n.style.boxShadow="inset 0 0 0 1px #0005";let r=document.createElement("span");r.style.position="absolute",r.style.top="50%",r.style.left="3px",r.style.transform="translateY(-50%)",r.style.width="18px",r.style.height="18px",r.style.borderRadius="50%",r.style.background="#e7eef7",r.style.boxShadow="0 1px 2px rgba(0,0,0,.7)",r.style.transition="left 160ms ease, transform 160ms ease";let o=document.createElement("input");o.type="checkbox",o.style.position="absolute",o.style.opacity="0",o.style.pointerEvents="none",o.tabIndex=-1;let s=a=>{o.checked=a,e.setAttribute("aria-checked",a?"true":"false"),r.style.left=a?"21px":"3px",r.style.transform=a?"translateY(-50%) scale(1.02)":"translateY(-50%) scale(1)",a?(n.style.background="linear-gradient(180deg, #2b5cff, #1e40ff)",n.style.borderColor="#7aa2ff",n.style.boxShadow="0 0 0 2px #7aa2ff55, inset 0 0 0 1px #0005"):(n.style.background="#1f2328",n.style.borderColor="#4446",n.style.boxShadow="inset 0 0 0 1px #0005")};return o.disabled=!0,e.addEventListener("mousedown",a=>a.preventDefault()),e.addEventListener("click",a=>{a.preventDefault(),a.stopPropagation(),s(!o.checked),t?.(o.checked)}),n.appendChild(r),e.appendChild(o),e.appendChild(n),s(!1),e},Um=(t,e)=>{let n=t.querySelector("input"),r=t.querySelector("span"),o=r?.querySelector("span");!n||!r||!o||(n.checked=!!e,o.style.left=e?"21px":"3px",o.style.transform=e?"translateY(-50%) scale(1.02)":"translateY(-50%) scale(1)",e?(r.style.background="linear-gradient(180deg, #2b5cff, #1e40ff)",r.style.borderColor="#7aa2ff",r.style.boxShadow="0 0 0 2px #7aa2ff55, inset 0 0 0 1px #0005",t.setAttribute("aria-checked","true")):(r.style.background="#1f2328",r.style.borderColor="#4446",r.style.boxShadow="inset 0 0 0 1px #0005",t.setAttribute("aria-checked","false")))},Ga=t=>{let e=document.createElement("div");return e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.borderBottom="1px solid #ffffff12",e.style.padding="4px 6px",e.style.boxSizing="border-box",e.appendChild(t),e},Ar=(t,e="center")=>{let n=document.createElement("div");return n.textContent=t,n.style.fontWeight="600",n.style.opacity="0.9",n.style.padding="4px 6px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent=e==="left"?"flex-start":"center",n};function Vm(t){let e=String(t||"").trim(),n=(()=>{let a=e.toLowerCase();return a==="mythical"?"Mythical":a==="celestial"?"Celestial":a==="divine"?"Divine":a==="legendary"?"Legendary":a==="rare"?"Rare":a==="uncommon"?"Uncommon":a==="common"?"Common":e||"\u2014"})(),r={Common:"#E7E7E7",Uncommon:"#67BD4D",Rare:"#0071C6",Legendary:"#FFC734",Mythical:"#9944A7",Divine:"#FF7835",Celestial:null},o=new Set(["Common","Uncommon","Legendary","Divine"]),s=document.createElement("div");if(s.textContent=n,Object.assign(s.style,{display:"inline-flex",justifyContent:"center",alignItems:"center",padding:"4px 8px",borderRadius:"5px",fontSize:"12px",fontWeight:"700",margin:"2px auto",color:o.has(n)?"#0b0b0b":"#ffffff",boxShadow:"0 0 0 1px #0006 inset",lineHeight:"1.1",whiteSpace:"nowrap"}),n==="Celestial"){if(!document.getElementById("qws-celestial-kf")){let a=document.createElement("style");a.id="qws-celestial-kf",a.textContent=`
@keyframes qwsCelestialShift {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}`,document.head.appendChild(a)}s.style.background=`linear-gradient(130deg,
      rgb(0,180,216) 0%,
      rgb(124,42,232) 40%,
      rgb(160,0,126) 60%,
      rgb(255,215,0) 100%)`,s.style.backgroundSize="200% 200%",s.style.animation="qwsCelestialShift 4s linear infinite"}else s.style.background=r[n]||"#444";return s}var ja=(t,e,n)=>{let r=e?.querySelector("button[data-role='rule']")??null,o=t.querySelector('[data-role="rule-hint"]'),s=!!(n&&(n.sound||n.playbackMode||n.stopMode||n.loopIntervalMs!=null)),a=s?Db(n):"";r&&(r.dataset.active=s?"1":"0",r.title=s&&a?`Custom rule \u2014 ${a}`:"Custom rule"),o&&(s&&a?(o.textContent=a,o.style.visibility="visible"):(o.textContent="",o.style.visibility="hidden"))},Rw=(t,e,n)=>{Jn();let r=document.createElement("div");r.className="qws-rule-popover",Object.assign(r.style,{position:"fixed",zIndex:"var(--qws-z-popover)",minWidth:"260px",maxWidth:"320px",padding:"14px 16px",borderRadius:"14px",border:"1px solid #32404e",background:"linear-gradient(180deg, #111923, #0b131c)",boxShadow:"0 16px 40px rgba(0,0,0,0.45)"});let o=12,s=(z,M,K)=>!Number.isFinite(M)||!Number.isFinite(K)?z:K>=M?Math.min(Math.max(z,M),K):Math.min(Math.max(z,K),M),a=(z,M)=>{let K=r.offsetWidth,$=r.offsetHeight,Q=s(z,o,window.innerWidth-K-o),se=s(M,o,window.innerHeight-$-o);return r.style.left=`${Math.round(Q)}px`,r.style.top=`${Math.round(se)}px`,{left:Q,top:se}},i=document.createElement("div");i.style.display="flex",i.style.justifyContent="space-between",i.style.alignItems="flex-start",i.style.gap="12px",i.style.cursor="move",i.style.userSelect="none",i.style.touchAction="none";let l=document.createElement("div"),c=document.createElement("div");c.textContent=e.name,c.style.fontWeight="700",c.style.fontSize="14px",c.style.lineHeight="1.2";let d=document.createElement("div");d.textContent=e.type,d.style.opacity="0.7",d.style.fontSize="12px",l.append(c,d);let u=document.createElement("button");u.type="button",u.textContent="\u2715",Object.assign(u.style,{background:"transparent",border:"none",color:"#c8d7e8",fontSize:"16px",lineHeight:"1",cursor:"pointer"}),u.addEventListener("click",z=>{z.preventDefault(),z.stopPropagation(),Jn()}),i.append(l,u);let y=null,h=z=>{if(!y||z.pointerId!==y.pointerId)return;let M=z.clientX-y.startX,K=z.clientY-y.startY;a(y.baseLeft+M,y.baseTop+K)},f=z=>{if(y&&!(z&&z.pointerId!==y.pointerId)){document.removeEventListener("pointermove",h),document.removeEventListener("pointerup",f),document.removeEventListener("pointercancel",f);try{i.releasePointerCapture(y.pointerId)}catch{}y=null}},p=z=>{if(z.button!==0)return;let M=z.target;if(M&&u.contains(M))return;y&&f();let K=r.getBoundingClientRect();y={pointerId:z.pointerId,startX:z.clientX,startY:z.clientY,baseLeft:K.left,baseTop:K.top};try{i.setPointerCapture(z.pointerId)}catch{}document.addEventListener("pointermove",h),document.addEventListener("pointerup",f),document.addEventListener("pointercancel",f),z.preventDefault()};i.addEventListener("pointerdown",p),$c=()=>{i.removeEventListener("pointerdown",p),f()},r.appendChild(i);let m=We.getRule(e.id),g=Ae.getPlaybackSettings(e.context),S=e.context==="shops"||e.context==="weather"?We.getContextStopDefaults(e.context):{stopMode:"manual",stopRepeats:null,loopIntervalMs:g.loopIntervalMs},w=e.context==="shops",x=(g.defaultSoundName||"").trim()||"Default",E=z=>z==="loop"?"Loop":"One-shot",T=E(g.mode),A=Math.max(150,Math.floor(S.loopIntervalMs??g.loopIntervalMs??150)),N=document.createElement("div");N.className="qws-rule-field";let H=document.createElement("label");H.textContent="Sound";let C=document.createElement("select");C.className="qmm-input",C.style.width="100%",(()=>{let z=m?.sound??"";C.innerHTML="";let M=document.createElement("option");M.value="",M.textContent=x,C.appendChild(M);let K=Ae.listSounds();for(let $ of K){if($===x&&z!==$)continue;let Q=document.createElement("option");Q.value=$,Q.textContent=$,C.appendChild(Q)}if(z&&!K.includes(z)){let $=document.createElement("option");$.value=z,$.textContent=z.length>32?`${z.slice(0,29)}\u2026`:z,$.dataset.extra="1",C.appendChild($)}C.value=z})(),N.append(H,C),r.appendChild(N);let v=document.createElement("div");v.className="qws-rule-field";let B=document.createElement("label");B.textContent="Playback mode";let le=document.createElement("select");le.className="qmm-input",(w?g.mode==="loop"?["loop","oneshot"]:["oneshot","loop"]:["oneshot"]).forEach(z=>{let M=document.createElement("option");M.value=z,M.textContent=E(z),le.appendChild(M)});let de=w?m?.playbackMode??g.mode:"oneshot";le.value=de==="loop"&&!w?"oneshot":de,w||(le.disabled=!0),v.append(B,le),r.appendChild(v);let _=null,re=document.createElement("div");if(re.className="qws-rule-field",w){let z=document.createElement("label");z.textContent="Stop condition",_=document.createElement("select"),_.className="qmm-input";let M=document.createElement("option");M.value="purchase",M.textContent="Until purchase",_.appendChild(M);let K=m?.stopMode??S.stopMode;_.value="purchase",re.append(z,_),r.appendChild(re)}let R=document.createElement("div");R.className="qws-rule-field";let k=document.createElement("label");k.textContent="Loop interval (ms)";let V=document.createElement("input");V.type="number",V.className="qmm-input",V.min="150",V.step="50",V.placeholder=String(A),V.value=m?.loopIntervalMs!=null?String(m.loopIntervalMs):"",V.inputMode="numeric",R.append(k,V),w&&r.appendChild(R),(z=>{z.addEventListener("keydown",M=>{if(M.stopPropagation(),M.stopImmediatePropagation(),M.ctrlKey||M.metaKey||M.altKey)return;let K=M.key;/^[0-9]$/.test(K)||K==="Backspace"||K==="Delete"||K==="Tab"||K==="Enter"||K==="ArrowLeft"||K==="ArrowRight"||K==="ArrowUp"||K==="ArrowDown"||K==="Home"||K==="End"||M.preventDefault()}),z.addEventListener("input",()=>{let M=z.value.replace(/\D+/g,"");M!==z.value&&(z.value=M)})})(V);let ie=()=>{let z=le.value;return z==="oneshot"||z==="loop"?z:w?g.mode:"oneshot"},fe=()=>(!w||_?.value==="purchase","purchase"),G=()=>{if(!w){re.style.display="none",R.style.display="none";return}let M=ie()==="loop";re.style.display=M?"grid":"none",R.style.display=M?"grid":"none"},Z=()=>{w&&le.value!=="loop"&&(le.value="loop",G())};le.addEventListener("change",()=>{G()}),w&&_&&_.addEventListener("change",()=>{Z()}),w&&V.addEventListener("input",Z),G();let j=document.createElement("div");j.textContent="Leave fields empty to inherit global defaults.",j.style.opacity="0.7",j.style.fontSize="12px",r.appendChild(j);let Y=document.createElement("div");Y.className="qws-rule-actions";let ne=t.btn("Clear",{variant:"ghost",size:"sm"});ne.addEventListener("click",z=>{z.preventDefault(),z.stopPropagation(),We.clearRule(e.id),Jn()}),m||t.setButtonEnabled(ne,!1);let q=t.btn("Save",{variant:"primary",size:"sm"});q.addEventListener("click",z=>{z.preventDefault(),z.stopPropagation();let M=C.value?.trim()||null,K=le.value||"",$=_?.value||"",Q=V.value?.trim(),se=K==="oneshot"||K==="loop"?K:null;se===g.mode&&(se=null);let O=w&&$==="purchase"?"purchase":null;O!=null&&O===S.stopMode&&(O=null);let U=null;if(w&&Q){let ue=Number(Q);if(Number.isFinite(ue)){let oe=Math.max(150,Math.min(1e4,Math.floor(ue)));oe!==A&&(U=oe)}}w&&!se&&g.mode!=="loop"&&(O!=null||U!=null)&&(se="loop"),We.setRule(e.id,{sound:M,playbackMode:se,stopMode:O,loopIntervalMs:U}),Jn()}),Y.append(ne,q),r.appendChild(Y),document.body.appendChild(r);let W=n.getBoundingClientRect(),b=r.offsetWidth,D=r.offsetHeight,F=W.right-b,P=W.bottom+8;F<o&&(F=o),F+b>window.innerWidth-o&&(F=window.innerWidth-b-o),P+D>window.innerHeight-o&&(P=W.top-D-8),P<o&&(P=o),a(F,P);let I=z=>{let M=z.target;M&&(r.contains(M)||n.contains(M)||Jn())};setTimeout(()=>document.addEventListener("pointerdown",I,!0)),Yc=()=>document.removeEventListener("pointerdown",I,!0);let J=z=>{Mr&&(Mr.contains(z.target)||z.stopImmediatePropagation())};document.addEventListener("keydown",J,!0),Qc=()=>document.removeEventListener("keydown",J,!0);let te=z=>{let M=z.target;Mr&&M&&Mr.contains(M)&&z.stopImmediatePropagation()};document.addEventListener("wheel",te,{capture:!0,passive:!0}),Jc=()=>{document.removeEventListener("wheel",te,{capture:!0})},Mr=r};function Z5(t,e){t.innerHTML="",wn.start().catch(()=>{});let n=G=>{let Z=e.card(G,{tone:"muted"});return Z.body.style.display="grid",Z.body.style.gap="10px",Z},r=(G,Z,j)=>{let{root:Y,label:ne}=e.formRow(G,Z,{alignTop:j?.alignTop,labelWidth:"160px"});return ne.style.opacity="0.9",ne.style.fontWeight="600",Y},o=(G,Z,j)=>{let Y=e.toggleChip(j,{type:"radio",name:G,value:Z});return Y.root.classList.add("qmm-radio-chip"),{label:Y.root,input:Y.input}},s=G=>e.select({id:G,width:"180px"}),a=(G="Play")=>e.btn("",{icon:"\u25B6",size:"sm",tooltip:G,ariaLabel:G}),i=G=>e.btn(G,{size:"sm"}),l=()=>e.errorBar(),c=document.createElement("div");Object.assign(c.style,{display:"grid",gridTemplateRows:"1fr",gap:"12px",height:"54vh",minHeight:"0",overflow:"hidden"}),t.appendChild(c);let d=n("Audio & Playback");c.appendChild(d.root);let u={},y=[{key:"shops",label:"Shops",allowPurchase:!0,showStop:!0},{key:"weather",label:"Weather",allowPurchase:!1},{key:"pets",label:"Pets",allowPurchase:!0,showStop:!1}];for(let G of y){let Z=document.createElement("div");Object.assign(Z.style,{display:"grid",gap:"12px",padding:"16px",borderRadius:"12px",border:"1px solid #1f2429",background:"#111821"});let j=document.createElement("div");j.textContent=G.label,j.style.fontWeight="700",j.style.fontSize="14px",j.style.letterSpacing="0.02em",Z.appendChild(j);let Y=document.createElement("div");Y.style.display="flex",Y.style.alignItems="center",Y.style.gap="8px";let ne=s(`ap.defaultSound.${G.key}`);ne.dataset.soundSelect=G.key;let q=a(`Play ${G.label.toLowerCase()} sound`);Y.append(ne,q),Z.appendChild(r("Default sound",Y));let W=document.createElement("div");W.style.display="flex",W.style.alignItems="center",W.style.gap="10px";let b=document.createElement("input");b.type="range",b.min="0",b.max="100",b.step="1",b.style.width="220px";let D=document.createElement("span");D.style.minWidth="32px",D.style.textAlign="right",W.append(b,D),Z.appendChild(r("Volume",W));let F=document.createElement("div");F.style.display="flex",F.style.gap="12px";let P=o(`ap.mode.${G.key}`,"oneshot","One-shot");F.append(P.label);let I=null;G.allowPurchase&&(I=o(`ap.mode.${G.key}`,"loop","Loop"),F.append(I.label)),Z.appendChild(r("Playback mode",F));let J,te,z;if(G.allowPurchase){let M=document.createElement("div");M.style.display="flex",M.style.flexDirection="column",M.style.gap="10px",z=document.createElement("div"),z.style.display="flex",z.style.flexDirection="column",z.style.gap="4px";let K=document.createElement("div");K.textContent="Loop interval",K.style.opacity="0.8",K.style.fontSize="12px",K.style.fontWeight="600";let $=document.createElement("div");$.style.display="inline-flex",$.style.alignItems="center",$.style.gap="8px",te=document.createElement("input"),te.type="number",te.min="150",te.max="10000",te.step="50",te.style.width="100px",te.style.textAlign="center";let Q=document.createElement("span");Q.textContent="ms between plays",Q.style.opacity="0.85",$.append(te,Q),z.append(K,$);let se=document.createElement("div");se.textContent=G.showStop===!1?"Loops keep repeating; stop manually by disabling the alert.":"Loops stop automatically when the item is purchased.",se.style.opacity="0.75",se.style.fontSize="12px",se.style.lineHeight="1.4",M.append(se,z),G.showStop!==!1?J=r("Stop condition",M):J=r("Loop interval",M),Z.appendChild(J)}else{let M=document.createElement("div");M.textContent="Weather alerts play once per trigger.",M.style.opacity="0.75",M.style.fontSize="12px",M.style.lineHeight="1.4",Z.appendChild(r("Details",M))}u[G.key]={container:Z,select:ne,playBtn:q,volumeRange:b,volumeValue:D,modeOneshot:P.input,modeLoop:I?.input,stopRow:J,loopInput:te,loopWrap:z},d.body.appendChild(Z)}let h=l();d.body.appendChild(h.el);let f=n("Sound library");c.appendChild(f.root);let p=document.createElement("div");Object.assign(p.style,{display:"flex",flexDirection:"column",gap:"12px",width:"100%"});let m=document.createElement("input");m.type="file",m.accept="audio/*",m.multiple=!0,m.style.display="none";let g=document.createElement("div");Object.assign(g.style,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px",padding:"18px 22px",width:"100%",minHeight:"110px",borderRadius:"14px",border:"1px dashed #5d6a7d",background:"linear-gradient(180deg, #0b141c, #091018)",transition:"border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease",cursor:"pointer",textAlign:"center"}),g.tabIndex=0,g.setAttribute("role","button"),g.setAttribute("aria-label","Select audio files");let S=document.createElement("div");S.textContent="Select audio files",Object.assign(S.style,{fontWeight:"600",fontSize:"14px",letterSpacing:"0.02em"});let w=document.createElement("div"),x="Click to browse or drop files";w.textContent=x,Object.assign(w.style,{fontSize:"12px",opacity:"0.75"}),g.append(S,w);let E=G=>{G?(g.style.borderColor="#6fc3ff",g.style.boxShadow="0 0 0 3px #6fc3ff22",g.style.background="linear-gradient(180deg, #102030, #0b1826)"):(g.style.borderColor="#5d6a7d",g.style.boxShadow="none",g.style.background="linear-gradient(180deg, #0b141c, #091018)")};g.addEventListener("mouseenter",()=>E(!0)),g.addEventListener("mouseleave",()=>E(document.activeElement===g)),g.addEventListener("focus",()=>E(!0)),g.addEventListener("blur",()=>E(!1)),g.addEventListener("dragover",G=>{G.preventDefault(),E(!0),G.dataTransfer&&(G.dataTransfer.dropEffect="copy")}),g.addEventListener("dragleave",()=>E(document.activeElement===g));let T=()=>m.click();g.addEventListener("click",T),g.addEventListener("keydown",G=>{(G.key==="Enter"||G.key===" ")&&(G.preventDefault(),T())});let A=G=>{if(!G||!G.length){w.textContent=x;return}w.textContent=G.length===1?G[0].name:`${G.length} files selected`};g.addEventListener("drop",async G=>{G.preventDefault();let Z=G.dataTransfer?.files||null;A(Z),await ie(Z),A(null),E(document.activeElement===g)}),p.append(m,g),f.body.appendChild(p);let N=document.createElement("div");N.textContent="MP3, WAV, OGG \u2014 limited to \u2264 10 s and \u2264 200 KB.",N.style.opacity="0.75",N.style.fontSize="12px",f.body.appendChild(N);let H=document.createElement("div");Object.assign(H.style,{display:"grid",gridTemplateRows:"auto 1fr",gap:"6px",border:"1px solid #4445",borderRadius:"10px",background:"#10161c",padding:"10px"});let C=document.createElement("div");Object.assign(C.style,{display:"grid",gridTemplateColumns:"minmax(0, 1fr) auto",gap:"12px",fontSize:"12px",letterSpacing:"0.05em",textTransform:"uppercase",opacity:"0.65",paddingBottom:"4px",borderBottom:"1px solid #ffffff14"});let L=document.createElement("span");L.textContent="Sound";let v=document.createElement("span");v.textContent="Actions",v.style.justifySelf="end",C.append(L,v);let B=document.createElement("div");Object.assign(B.style,{display:"flex",flexDirection:"column",gap:"6px",maxHeight:"240px",overflowY:"auto",paddingRight:"4px",minHeight:"0",padding:"4px 0"}),H.append(C,B),f.body.appendChild(H);let le=l();f.body.appendChild(le.el);let X=(G,Z)=>{let j=(G.value||"").trim(),Y=j?Number(j):NaN,ne=Number.isFinite(Y)?Y:Z,q=Math.max(150,Math.min(1e4,Math.floor(ne)));return G.value=String(q),q},de=G=>{let Z=u[G],j=Z.modeLoop?.checked??!1;Z.stopRow&&(Z.stopRow.style.display=j?"":"none"),Z.loopWrap&&(Z.loopWrap.style.display=j?"flex":"none")},_=(G,Z)=>{if(G==="weather"&&Z==="loop"){Ae.setPlaybackMode("oneshot",G),u[G].modeOneshot.checked=!0,u[G].modeLoop&&(u[G].modeLoop.checked=!1),de(G);return}Ae.setPlaybackMode(Z,G),de(G)},re=()=>{let G=u.shops;if(!G.loopInput)return;let Z=X(G.loopInput,Ae.getLoopInterval("shops"));return Ae.setLoopInterval(Z,"shops"),G.modeLoop?.checked||(G.modeLoop&&(G.modeLoop.checked=!0),G.modeOneshot.checked=!1,_("shops","loop")),Ae.setStopPurchase("shops"),We.setContextStopDefaults("shops",{stopMode:"purchase",stopRepeats:null,loopIntervalMs:Z}),Z};for(let G of y){let Z=u[G.key];Z.select.addEventListener("change",()=>{Ae.setDefaultSoundByName(Z.select.value,G.key),k()}),Z.playBtn.addEventListener("click",()=>{Ae.trigger("preview",{sound:Z.select.value},G.key).catch(()=>{})}),Z.volumeRange.addEventListener("input",()=>{let j=Math.max(0,Math.min(100,parseInt(Z.volumeRange.value||"0",10)||0));Z.volumeValue.textContent=`${j}%`,Ae.setVolume(j/100,G.key)}),Z.modeOneshot.addEventListener("change",()=>{if(Z.modeOneshot.checked&&(_(G.key,"oneshot"),G.key==="shops")){let j=Z.loopInput?X(Z.loopInput,Ae.getLoopInterval("shops")):Ae.getLoopInterval("shops");Ae.setLoopInterval(j,"shops"),Ae.setStopManual("shops"),We.setContextStopDefaults("shops",{stopMode:"manual",stopRepeats:null,loopIntervalMs:j})}}),Z.modeLoop?.addEventListener("change",()=>{Z.modeLoop?.checked&&(_(G.key,"loop"),G.key==="shops"&&re())}),G.allowPurchase&&(Z.loopInput?.addEventListener("change",re),Z.loopInput?.addEventListener("blur",re))}let R=()=>{let G=Ae.listSounds(),Z=(Y,ne)=>{let q=Y.value;Y.innerHTML="";for(let b of G){let D=document.createElement("option");D.value=b,D.textContent=b,Y.appendChild(D)}let W=Ae.getDefaultSoundName(ne);G.includes(q)?Y.value=q:W&&G.includes(W)?Y.value=W:G.length&&(Y.value=G[0])};for(let Y of y)Z(u[Y.key].select,Y.key);let j=Array.from(document.querySelectorAll("select[data-sound-select]"));for(let Y of j){let ne=Y.dataset.soundSelect||"shops";u[ne]?.select!==Y&&Z(Y,ne)}},k=()=>{B.replaceChildren();let G=Ae.listSounds();if(!G.length){let Y=document.createElement("div");Y.textContent="No sounds in the library.",Y.style.opacity="0.75",Y.style.textAlign="center",Y.style.padding="12px 6px",B.appendChild(Y);return}let Z=Ae.getDefaultSoundName("shops"),j=Ae.getDefaultSoundName("weather");for(let Y of G){let ne=document.createElement("div");Object.assign(ne.style,{display:"grid",gridTemplateColumns:"minmax(0, 1fr) auto",gap:"12px",alignItems:"center",padding:"8px 10px",borderRadius:"8px",border:"1px solid #1f2429",background:"#151b22"});let q=document.createElement("div");Object.assign(q.style,{display:"flex",alignItems:"center",gap:"8px",minWidth:"0"});let W=document.createElement("span");W.textContent=Y,W.style.fontWeight="600",W.style.overflow="hidden",W.style.textOverflow="ellipsis",W.style.whiteSpace="nowrap",q.appendChild(W);let b=document.createElement("div");b.style.display="flex",b.style.gap="6px";let D=se=>{let O=document.createElement("span");return O.textContent=se,Object.assign(O.style,{fontSize:"11px",padding:"2px 6px",borderRadius:"999px",background:"#2b5cff33",border:"1px solid #2b5cff66",color:"#9cbcff",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.04em"}),O},F=Z===Y,P=j===Y,I=Ae.getDefaultSoundName("pets")===Y;F&&b.appendChild(D("Shops")),P&&b.appendChild(D("Weather")),I&&b.appendChild(D("Pets")),b.childElementCount&&q.appendChild(b),(F||P||I)&&(ne.style.borderColor="#2b5cff99",ne.style.boxShadow="0 0 0 1px #2b5cff33");let J=document.createElement("div");Object.assign(J.style,{display:"flex",gap:"6px",justifyContent:"flex-end",flexWrap:"wrap"});let te=i("\u25B6"),z=i("Set shops"),M=i("Set weather"),K=i("Set pets"),$=i("Remove");te.title="Preview",z.title="Set as shops default",M.title="Set as weather default",K.title="Set as pets default",$.title="Remove from library";let Q=typeof Ae.isProtectedSound=="function"&&Ae.isProtectedSound(Y);(Q||F||P)&&($.disabled=!0,$.style.opacity="0.6",Q?$.title="Built-in sound cannot be removed":$.title="Currently used as default"),te.onclick=()=>Ae.trigger("preview",{sound:Y},"shops").catch(()=>{}),z.onclick=()=>{Ae.setDefaultSoundByName(Y,"shops"),R(),k()},M.onclick=()=>{Ae.setDefaultSoundByName(Y,"weather"),R(),k()},K.onclick=()=>{Ae.setDefaultSoundByName(Y,"pets"),R(),k()},$.onclick=()=>{Ae.unregisterSound(Y),R(),k()},J.append(te,z,M,K,$),ne.append(q,J),B.appendChild(ne)}},V=G=>{let Z=u[G],j=Ae.getPlaybackSettings(G),Y=Ae.listSounds();j.defaultSoundName&&Y.includes(j.defaultSoundName)&&(Z.select.value=j.defaultSoundName);let ne=Math.round(j.volume*100);Z.volumeRange.value=String(ne),Z.volumeValue.textContent=`${ne}%`,Z.modeLoop&&j.mode==="loop"?Z.modeLoop.checked=!0:Z.modeOneshot.checked=!0;let q=G==="shops"||G==="weather"?We.getContextStopDefaults(G):{stopMode:"manual",stopRepeats:null,loopIntervalMs:j.loopIntervalMs},W=Math.max(150,Math.min(1e4,Math.floor(q.loopIntervalMs||j.loopIntervalMs||150))),b=Z.loopInput?X(Z.loopInput,W):W;Ae.setLoopInterval(b,G),G==="shops"?Z.modeLoop?.checked?(Ae.setStopPurchase("shops"),We.setContextStopDefaults("shops",{stopMode:"purchase",stopRepeats:null,loopIntervalMs:b})):(Ae.setStopManual("shops"),We.setContextStopDefaults("shops",{stopMode:"manual",stopRepeats:null,loopIntervalMs:b})):G==="weather"?(_("weather","oneshot"),Ae.setStopManual("weather"),We.setContextStopDefaults("weather",{stopMode:"manual",stopRepeats:null,loopIntervalMs:b})):G==="pets"&&(Ae.setLoopInterval(b,"pets"),Ae.setStopManual("pets")),de(G)},ee=()=>{R(),V("shops"),V("weather"),V("pets"),k()},ie=async G=>{if(le.clear(),!G||!G.length)return;let Z=[];for(let j of Array.from(G))try{let Y=await Ae.importFileAsSound(j,{maxBytes:204800,maxSeconds:10,bitrates:[48e3,32e3,2e4,12e3,8e3],maxInputBytes:8388608});Z.push(Y.name)}catch(Y){le.show(`Failed for "${j.name}": ${Y?.message||Y}`)}if(Z.length){R(),k();for(let j of y)Ae.getDefaultSoundName(j.key)||Ae.setDefaultSoundByName(Z[0],j.key);R(),k()}m.value=""};m.onchange=async()=>{let G=m.files;A(G),await ie(G),A(null),E(document.activeElement===g)},ee();let fe=document.createElement("div");Object.assign(fe.style,{overflow:"auto",minHeight:"0",height:"100%",display:"grid",gap:"12px"}),fe.append(d.root,f.root),c.appendChild(fe),t.__cleanup__=(()=>{let G=t.__cleanup__;return()=>{try{G?.()}catch{}}})()}function X5(t,e){if(t.innerHTML="",t.style.cssText="",!document.getElementById("qws-rule-style")){let _=document.createElement("style");_.id="qws-rule-style",_.textContent=`
:root {
  /* PATCH: z-index centralis\xE9 */
  --qws-z-popover: 99999999999999;
}

/* PATCH: bouton engrenage carr\xE9, centr\xE9, plus gros */
.qws-rule-btn {
  display: inline-grid;
  place-items: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border-radius: 8px;
  line-height: 1;
  font-size: 18px; /* taille de l'ic\xF4ne */
  min-width: 32px; /* \xE9vite les r\xE9tr\xE9cissements */
  box-sizing: border-box;
}
.qws-rule-btn[data-active="1"] {
  background: linear-gradient(180deg, #1b2735, #101821);
  box-shadow: 0 0 0 1px #658dff88 inset;
  color: #c7daff;
}

/* PATCH: popover toujours devant */
.qws-rule-popover {
  position: fixed !important;
  z-index: var(--qws-z-popover) !important;
  display: flex;
  flex-direction: column;
  gap: 10px;
  color: #f1f6ff;
}
.qws-rule-popover .qws-rule-field {
  display: grid;
  gap: 6px;
}
.qws-rule-popover .qws-rule-field label {
  font-weight: 600;
  font-size: 13px;
}
.qws-rule-popover .qws-rule-actions {
  display: flex;
  justify-content: space-between;
  gap: 8px;
}

/* PATCH: r\xE9serve un espace pour le r\xE9sum\xE9 afin d'\xE9viter tout shift */
[data-role="rule-hint"] {
  min-height: 1.2em;  /* ~1 ligne r\xE9serv\xE9e */
}
`,document.head.appendChild(_)}let n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateRows:"auto 1fr",gap:"10px",height:"54vh",overflow:"hidden",minHeight:"0",position:"relative"}),t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="10px",r.style.rowGap="8px",n.appendChild(r);let o=e.label("Type"),s=document.createElement("select");s.className="qmm-input",s.style.minWidth="140px",s.id="shop.filter.type",[["all","All"],["seed","Seeds"],["egg","Eggs"],["tool","Tools"],["decor","Decor"]].forEach(([_,re])=>{let R=document.createElement("option");R.value=_,R.textContent=re,s.appendChild(R)}),s.value="all";let a=e.label("Rarity"),i=document.createElement("select");i.className="qmm-input",i.style.minWidth="160px",i.id="shop.filter.rarity",[["all","All"],["common","Common"],["uncommon","Uncommon"],["rare","Rare"],["legendary","Legendary"],["mythical","Mythical"],["divine","Divine"],["celestial","Celestial"]].forEach(([_,re])=>{let R=document.createElement("option");R.value=_,R.textContent=re,i.appendChild(R)}),i.value="all";let l=document.createElement("div");l.id="shop.followedCount",l.textContent="Followed: 0",l.title="Items with Overlay enabled",l.style.padding="6px 10px",l.style.borderRadius="999px",l.style.border="1px solid #4445",l.style.background="#1f2328",l.style.color="#e7eef7",l.style.fontWeight="600",l.style.marginLeft="auto",l.style.width="115px",r.append(o,s,a,i,l);let c=document.createElement("div");c.style.border="1px solid #4445",c.style.borderRadius="10px",c.style.padding="10px",c.style.background="#0f1318",c.style.overflow="hidden",c.style.display="grid",c.style.gridTemplateRows="auto 1fr",c.style.minHeight="0",n.appendChild(c);let d=document.createElement("div"),u="minmax(200px, 1fr) 9rem 7rem 8rem";d.style.display="grid",d.style.gridTemplateColumns=u,d.style.justifyContent="start",d.style.columnGap="0",d.style.borderBottom="1px solid #ffffff1a",d.style.padding="0 0 4px 0",d.style.position="sticky",d.style.top="0",d.append(Ar("Item","left"),Ar("Rarity"),Ar("Notify"),Ar("Custom rules")),c.appendChild(d);let y=document.createElement("div");y.style.display="grid",y.style.gridTemplateColumns=u,y.style.justifyContent="start",y.style.gridAutoRows="auto",y.style.alignContent="start",y.style.minHeight="0",y.style.height="100%",y.style.overflow="auto",y.style.overscrollBehavior="contain",y.style.width="100%",y.style.scrollbarGutter="stable",c.appendChild(y);let h=()=>{let _=Array.from(y.children);for(let re=0;re+3<_.length;re+=4){let R=_[re],k=_[re+3],V=R?.dataset?.id;V&&ja(R,k??null,We.getRule(V))}},f=_=>{let re=new Map(_.rows.map(k=>[k.id,k])),R=Array.from(y.children);for(let k=0;k+3<R.length;k+=4){let V=R[k],ee=R[k+2],ie=R[k+3],fe=V.dataset.id,G=re.get(fe);if(!G)continue;let Z=ee.querySelector("label");Z&&Um(Z,!!G.popup),V.dataset.follow=G.followed?"1":"0",ja(V,ie??null,We.getRule(fe));let j=We.isIdCapped?.(fe)??!1;Z&&Pw(Z,j)}},p=()=>{let _=y.offsetWidth-y.clientWidth;d.style.boxSizing="border-box",d.style.paddingRight=`${_}px`};p();let m=new ResizeObserver(p);m.observe(y);let g=()=>p();window.addEventListener("resize",g);let S=new Map,w=null,x=new Set,E=()=>({type:s.value||"all",rarity:i.value||"all"}),T=_=>We.filterRows(_,E()),A=_=>{let re=document.createElement("div");Object.assign(re.style,{display:"flex",alignItems:"center",gap:"6px",padding:"4px 6px",borderBottom:"1px solid #ffffff12"});let R=40,k=document.createElement("div");Object.assign(k.style,{width:`${R}px`,height:`${R}px`,flex:`0 0 ${R}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",background:"#101820",marginRight:"6px",aspectRatio:"1 / 1"});let V=ne=>{let q=ne.indexOf(":");return q>=0?ne.slice(q+1):ne},ee=_.type==="Seed"?"\u{1F331}":_.type==="Egg"?"\u{1F95A}":_.type==="Tool"?"\u{1F9F0}":"\u{1F3E0}",ie=V(_.id),fe=Tt(_.type,ie,{size:R-6,fallback:ee,alt:_.name});k.appendChild(fe);let G=document.createElement("div");Object.assign(G.style,{display:"flex",flexDirection:"column",gap:"2px",lineHeight:"1.15",minWidth:"0",flex:"1 1 auto"});let Z=document.createElement("div");Z.textContent=_.name,Object.assign(Z.style,{fontWeight:"700",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"});let j=document.createElement("div");j.textContent=_.type,j.style.opacity="0.7",j.style.fontSize="12px";let Y=document.createElement("div");return Y.dataset.role="rule-hint",Y.style.display="none",Y.style.opacity="0.75",Y.style.fontSize="11px",Y.style.whiteSpace="nowrap",Y.style.overflow="hidden",Y.style.textOverflow="ellipsis",Y.style.minHeight="1.2em",Y.style.visibility="hidden",G.append(Z,j,Y),re.append(k,G),re},N=_=>{let re=A(_);re.dataset.id=_.id,re.dataset.type=_.type,re.dataset.follow=_.followed?"1":"0",re.dataset.context="shops";let R=document.createElement("div");R.style.display="flex",R.style.alignItems="center",R.style.justifyContent="center",R.style.borderBottom="1px solid #ffffff12",R.appendChild(Vm(String(_.rarity??"\u2014")));let k=Lw(G=>{try{We.setPopup(_.id,!!G)}catch{}let Z=We.getPref(_.id);re.dataset.follow=Z.followed?"1":"0"});Um(k,!!_.popup),k.style.padding="0";let V=Ga(k),ee=We.isIdCapped?.(_.id)??!1;Pw(k,ee);let ie=e.btn("",{icon:"\u2699",size:"sm",tooltip:"Custom rule",ariaLabel:`Custom rule for ${_.name}`});ie.dataset.role="rule",ie.classList.add("qws-rule-btn"),ie.addEventListener("click",G=>{G.preventDefault(),G.stopPropagation(),Rw(e,{id:_.id,name:_.name,type:_.type,context:"shops"},ie)});let fe=Ga(ie);fe.dataset.role="rule-cell",y.append(re,R,V,fe),ja(re,fe,We.getRule(_.id))};function H(){Jn(),y.innerHTML="",x=new Set}function C(){let _=document.createElement("div");_.textContent="No items.",_.style.opacity="0.75",_.style.gridColumn="1 / -1",_.style.padding="8px",y.appendChild(_)}function L(){if(H(),!w){C();return}let _=T(w.rows);_.length?_.forEach(re=>{N(re),x.add(re.id)}):C(),h(),l.textContent=`Followed: ${w.counts.followed}`,p()}function v(_){l.textContent=`Followed: ${_.counts.followed}`}function B(_){let re=new Set;for(let R of T(_.rows))re.add(R.id);return re}let le=null,X=null;(async()=>{try{await We.start()}catch{}le=await We.onChangeNow(_=>{let re=w;if(w=_,!re){L(),f(w);return}let R=x,k=B(_),V=!1;if(R.size!==k.size)V=!0;else for(let ee of k)if(!R.has(ee)){V=!0;break}V?L():(v(_),f(_))});try{X=await We.onRulesChangeNow(()=>h())}catch{}})();let de=()=>{w&&L()};s.onchange=de,i.onchange=de,t.__cleanup__=(()=>{let _=t.__cleanup__;return()=>{try{le?.()}catch{}try{X?.()}catch{}try{m.disconnect()}catch{}try{window.removeEventListener("resize",g)}catch{}try{Jn()}catch{}try{_?.()}catch{}}})()}function e_(t,e){t.innerHTML="",wn.start().catch(()=>{});let n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateColumns:"minmax(220px, 260px) minmax(0, 1fr)",gap:"10px",alignItems:"stretch",height:"54vh",overflow:"hidden",border:"1px solid #4445",borderRadius:"10px",padding:"10px",background:"#0f1318"}),t.appendChild(n);let r=document.createElement("div");Object.assign(r.style,{display:"grid",gridTemplateColumns:"1fr",rowGap:"6px",overflow:"auto",padding:"6px",border:"1px solid #4445",borderRadius:"10px"}),n.appendChild(r);let o=document.createElement("div");Object.assign(o.style,{display:"flex",flexDirection:"column",gap:"10px",overflow:"auto",minHeight:"0"}),n.appendChild(o);let s=[],a=null,i=wn.isGeneralEnabled(),l=(m,g)=>{let{root:S}=e.formRow(m,g,{labelWidth:"180px"});return S},c=e.card("General notifications",{tone:"muted",align:"stretch"});c.body.style.display="grid",c.body.style.gap="10px";let d=e.flexRow({justify:"start",gap:10}),u=e.switch(wn.isGeneralEnabled()),y=document.createElement("div");y.textContent="Use a shared threshold for all pets",y.style.opacity="0.9",d.append(u,y),c.body.append(l("Enable general",d));let h=e.inputNumber(1,100,1,wn.getGeneralThresholdPct());c.body.append(l("General threshold (%)",h.wrap??h)),o.appendChild(c.root);let f=()=>{i=wn.isGeneralEnabled(),u.checked=i,h.value=String(wn.getGeneralThresholdPct())};u.onchange=()=>{wn.setGeneralEnabled(u.checked),f()},h.addEventListener("change",()=>{let m=Math.max(1,Math.min(100,Number(h.value)||wn.getGeneralThresholdPct()));h.value=String(wn.setGeneralThresholdPct(m))}),f();let p=()=>{if(r.innerHTML="",!s.length){let m=document.createElement("div");m.textContent="No active pets.",m.style.opacity="0.75",r.appendChild(m);return}for(let m of s){let g=m?.slot??{},S=String(g?.name||g?.petSpecies||"Pet"),w=Me.getHungerPctFor(m),x=Number.isFinite(w)?`${w}%`:"\u2014",E=document.createElement("div");E.style.display="flex",E.style.alignItems="center",E.style.justifyContent="space-between",E.style.gap="10px",E.style.width="100%",E.style.textAlign="left",E.style.padding="6px 8px",E.style.borderRadius="8px",E.style.border="1px solid #4445",E.style.background="#121820";let T=document.createElement("div");T.style.display="flex",T.style.alignItems="center",T.style.gap="8px",T.style.minWidth="0";let A=document.createElement("div");A.style.width="40px",A.style.height="40px",A.style.borderRadius="8px",A.style.display="inline-flex",A.style.alignItems="center",A.style.justifyContent="center",A.style.background="#111821",A.style.border="1px solid #1f2429",A.style.overflow="hidden";let N=()=>{A.replaceChildren();let de=document.createElement("span");de.textContent="\u{1F43E}",de.style.fontSize="28px",de.setAttribute("aria-hidden","true"),A.appendChild(de)},H=0,C=(de,_)=>{H+=1;let re=H,R=String(de??"").trim();if(!R){N();return}N(),ll(R,_).then(k=>{if(re!==H)return;if(!k){N();return}let V=new Image;V.src=k,V.alt=R||"pet",V.decoding="async",V.loading="lazy",V.draggable=!1,Object.assign(V.style,{width:"100%",height:"100%",imageRendering:"auto",objectFit:"contain"}),A.replaceChildren(V)}).catch(()=>{re===H&&N()})},L=String(g?.petSpecies||""),v=g?.mutations??m?.mutations;C(L,v);let B=document.createElement("div");B.style.display="flex",B.style.flexDirection="column",B.style.gap="2px",B.style.minWidth="0";let le=document.createElement("div");le.textContent=S,le.style.fontWeight="600",le.style.overflow="hidden",le.style.textOverflow="ellipsis",le.style.whiteSpace="nowrap",B.append(le),T.append(A,B);let X=document.createElement("div");X.textContent=x,X.style.fontWeight="700",X.style.color="#FFD84D",E.append(T,X),r.appendChild(E)}};(async()=>{try{a=await Me.onPetsChangeNow(m=>{s=Array.isArray(m)?m.slice(0,3):[],p()})}catch{s=[],p()}})(),t.__cleanup__=(()=>{let m=t.__cleanup__;return()=>{try{a?.()}catch{}try{m?.()}catch{}}})()}function t_(t,e){t.innerHTML="",t.style.cssText="";let n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateRows:"1fr",height:"54vh",overflow:"hidden",minHeight:"0"}),t.appendChild(n);let r=document.createElement("div");r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="10px",r.style.background="#0f1318",r.style.overflow="hidden",r.style.display="grid",r.style.gridTemplateRows="auto 1fr",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div"),s="minmax(240px, 1fr) 9rem 7rem 8rem";o.style.display="grid",o.style.gridTemplateColumns=s,o.style.justifyContent="start",o.style.columnGap="0",o.style.borderBottom="1px solid #ffffff1a",o.style.padding="0 0 4px 0",o.style.position="sticky",o.style.top="0",o.append(Ar("Weather","left"),Ar("Last seen"),Ar("Notify"),Ar("Custom rules")),r.appendChild(o);let a=document.createElement("div");a.style.display="grid",a.style.gridTemplateColumns=s,a.style.justifyContent="start",a.style.gridAutoRows="auto",a.style.alignContent="start",a.style.minHeight="0",a.style.height="100%",a.style.overflow="auto",a.style.overscrollBehavior="contain",a.style.width="100%",a.style.scrollbarGutter="stable",r.appendChild(a);let i=new Map,l=()=>{let H=Array.from(a.children);for(let C=0;C+3<H.length;C+=4){let L=H[C],v=H[C+3],B=L?.dataset?.id;B&&ja(L,v??null,We.getRule(B))}},c=()=>{let H=a.offsetWidth-a.clientWidth;o.style.boxSizing="border-box",o.style.paddingRight=`${H}px`};c();let d=new ResizeObserver(c);d.observe(a);let u=()=>c();window.addEventListener("resize",u);let y=H=>{let C=document.createElement("div");Object.assign(C.style,{display:"flex",alignItems:"center",gap:"8px",padding:"6px",borderBottom:"1px solid #ffffff12"});let L=40,v=document.createElement("div");Object.assign(v.style,{width:`${L}px`,height:`${L}px`,flex:`0 0 ${L}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",background:"#101820"});let B=il(H.spriteKey??H.id,{size:L-4,fallback:"\u{1F326}",alt:H.name});v.appendChild(B);let le=document.createElement("div");Object.assign(le.style,{display:"flex",flexDirection:"column",gap:"4px",lineHeight:"1.2",minWidth:"0",flex:"1 1 auto"});let X=document.createElement("div");Object.assign(X.style,{display:"flex",alignItems:"center",gap:"6px",minWidth:"0"});let de=document.createElement("div");if(de.textContent=H.name,Object.assign(de.style,{fontWeight:"700",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:"1 1 auto"}),X.appendChild(de),H.isCurrent){let k=document.createElement("span");k.textContent="Current",Object.assign(k.style,{fontSize:"11px",padding:"2px 6px",borderRadius:"999px",background:"#2b5cff33",border:"1px solid #2b5cff66",color:"#9cbcff",fontWeight:"600",whiteSpace:"nowrap"}),X.appendChild(k)}let _=document.createElement("div");_.textContent="Mutations",Object.assign(_.style,{fontSize:"11px",opacity:"0.7",fontWeight:"600"});let re=document.createElement("div");if(Object.assign(re.style,{display:"flex",flexWrap:"wrap",gap:"6px",alignItems:"flex-start",fontSize:"12px",lineHeight:"1.3",opacity:H.mutations.length?"0.85":"0.6"}),H.mutations.length)for(let k of H.mutations){let V=document.createElement("span");V.textContent=qb(k),Object.assign(V.style,{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"999px",background:"#ffffff12",whiteSpace:"nowrap"}),re.appendChild(V)}else{let k=document.createElement("span");k.textContent="No mutation effects.",k.style.whiteSpace="nowrap",re.appendChild(k)}let R=document.createElement("div");return R.dataset.role="rule-hint",R.style.opacity="0.75",R.style.fontSize="11px",R.style.whiteSpace="nowrap",R.style.overflow="hidden",R.style.textOverflow="ellipsis",R.style.minHeight="1.2em",R.style.visibility="hidden",le.append(X,_,re,R),C.append(v,le),H.isCurrent&&(C.style.background="linear-gradient(180deg, #1b2735, #141d25)",C.style.borderRadius="8px"),C},h=H=>{let C=y(H);C.dataset.id=H.id,C.dataset.context="weather",C.dataset.current=H.isCurrent?"1":"0";let L=document.createElement("div"),{label:v,title:B}=Lp(H.lastSeen,H.isCurrent);L.textContent=v,L.title=B,L.style.fontWeight="600",L.style.opacity=v==="Never"?"0.7":"1",L.style.whiteSpace="nowrap";let le=Ga(L);i.set(H.id,L);let X=Lw(R=>{try{We.setWeatherNotify(H.id,!!R)}catch{}});Um(X,!!H.notify),X.style.padding="0";let de=Ga(X),_=e.btn("",{icon:"\u2699",size:"sm",tooltip:"Custom rule",ariaLabel:`Custom rule for ${H.name}`});_.dataset.role="rule",_.classList.add("qws-rule-btn"),_.addEventListener("click",R=>{R.preventDefault(),R.stopPropagation(),Rw(e,{id:H.id,name:H.name,type:H.type,context:"weather"},_)});let re=Ga(_);re.dataset.role="rule-cell",a.append(C,le,de,re),ja(C,re,We.getRule(H.id))},f=()=>{Jn(),a.innerHTML="",i.clear()},p=()=>{let H=document.createElement("div");H.textContent="No weather entries.",H.style.opacity="0.75",H.style.gridColumn="1 / -1",H.style.padding="8px",a.appendChild(H)},m=null,g="",S=()=>{if(m)for(let H of m.rows){let C=i.get(H.id);if(C){let{label:L,title:v}=Lp(H.lastSeen,H.isCurrent);C.textContent=L,C.title=v,C.style.opacity=L==="Never"?"0.7":"1"}}},w=()=>{f(),!m||!m.rows.length?p():(m.rows.forEach(h),l()),c(),S()},x=null,E=null;(async()=>{try{await We.start()}catch{}try{x=await We.onWeatherChangeNow(H=>{m=H,g=Rp(H.rows),w()})}catch{}try{E=await We.onRulesChangeNow(()=>l())}catch{}})();let T=async()=>{try{let H=await We.getWeatherState(),C=Rp(H.rows),L=C!==g;m=H,g=C,L?w():S()}catch{}},A=window.setInterval(S,3e4),N=window.setInterval(()=>{T()},6e4);t.__cleanup__=(()=>{let H=t.__cleanup__;return()=>{try{x?.()}catch{}try{E?.()}catch{}try{d.disconnect()}catch{}try{window.removeEventListener("resize",u)}catch{}try{window.clearInterval(A)}catch{}try{window.clearInterval(N)}catch{}try{Jn()}catch{}try{H?.()}catch{}}})()}function _w(t){let e=new Qe({id:"alerts",compact:!0,windowSelector:".qws-win"});e.addTab("shops","\u{1F6D2} Shops",n=>X5(n,e)),e.addTab("weather","\u{1F326} Weather",n=>t_(n,e)),e.addTab("pets","\u{1F43E} Pets",n=>e_(n,e)),e.addTab("settings","\u2699\uFE0F Settings",n=>Z5(n,e)),e.mount(t)}var n_=new Intl.NumberFormat("en-US"),ct=t=>n_.format(Math.max(0,Math.floor(t||0))),r_=new Set(["egggrowthboost","egggrowthboostii_new","egggrowthboostii","plantgrowthboost","plantgrowthboostii"]),o_=new Set(["petxpboost","petxpboostii","petageboost","petageboostii"]),s_=new Set(["pethatchsizeboost","pethatchsizeboostii"]),a_=new Set(["hungerrestore","hungerrestoreii","hungerboost","hungerboostii"]);function $n(t){return typeof t=="object"&&t!==null}function Nw(t){return(t.totalPlanted??0)<=0&&(t.totalHarvested??0)<=0&&(t.totalDestroyed??0)<=0&&(t.watercanUsed??0)<=0&&(t.waterTimeSavedMs??0)<=0}function Dw(t){return(t.seedsBought??0)<=0&&(t.decorBought??0)<=0&&(t.eggsBought??0)<=0&&(t.toolsBought??0)<=0&&(t.cropsSoldCount??0)<=0&&(t.cropsSoldValue??0)<=0&&(t.petsSoldCount??0)<=0&&(t.petsSoldValue??0)<=0}function qw(t){let e=Object.values(t.pets?.hatchedByType??{});return e.length===0?!0:e.every(n=>{if(!n)return!0;let r=Number(n.normal)||0,o=Number(n.gold)||0,s=Number(n.rainbow)||0;return r<=0&&o<=0&&s<=0})}async function Zc(t,e){try{let n=await t.get();if(!Array.isArray(n))return 0;let r=0;for(let o of n){if(!o||typeof o!="object")continue;let s=Number(o.quantity);Number.isFinite(s)&&s>0&&(r+=Math.max(0,Math.floor(s)))}return r}catch(n){return console.warn(`[StatsMenu] Failed to read ${e} inventory`,n),0}}async function Ww(t){if(!Nw(t.garden))return;let e;try{e=await ai.get()}catch(r){console.warn("[StatsMenu] Failed to read garden data",r);return}if(!e||!$n(e.tileObjects))return;let n=0;for(let r of Object.values(e.tileObjects)){if(!$n(r))continue;(typeof r.objectType=="string"?r.objectType.toLowerCase():"")==="plant"&&(n+=1)}n<=0||Fe.update(r=>{Nw(r.garden)&&(r.garden.totalPlanted=n)})}async function zw(t){if(!Dw(t.shops))return;let e=null;try{e=await ai.get()}catch(d){console.warn("[StatsMenu] Failed to read garden data",d)}let n=0,r=0,o=0,s=0;if(e&&$n(e.tileObjects))for(let d of Object.values(e.tileObjects)){if(!$n(d))continue;let u=typeof d.objectType=="string"?d.objectType.toLowerCase():"";u==="plant"?n+=1:u==="egg"&&(r+=1)}if(e&&$n(e.boardwalkTileObjects))for(let d of Object.values(e.boardwalkTileObjects))d!=null&&(o+=1);let[a,i,l,c]=await Promise.all([Zc(hd,"seed"),Zc(bd,"tool"),Zc(Sd,"egg"),Zc(vd,"decor")]);n+=a,r+=l,o+=c,s+=i,!(n<=0&&r<=0&&o<=0&&s<=0)&&Fe.update(d=>{Dw(d.shops)&&(n>0&&(d.shops.seedsBought??0)<=0&&(d.shops.seedsBought=n),r>0&&(d.shops.eggsBought??0)<=0&&(d.shops.eggsBought=r),o>0&&(d.shops.decorBought??0)<=0&&(d.shops.decorBought=o),s>0&&(d.shops.toolsBought??0)<=0&&(d.shops.toolsBought=s))})}function i_(t){return Array.isArray(t)?t:$n(t)&&Array.isArray(t.items)?t.items:[]}function Ow(t){if(!Array.isArray(t))return"normal";let e=!1;for(let n of t){if(typeof n!="string")continue;let r=n.trim().toLowerCase();if(r==="rainbow")return"rainbow";r==="gold"&&(e=!0)}return e?"gold":"normal"}async function Gw(t){if(!qw(t))return;let e;try{e=await gd.get()}catch(i){console.warn("[StatsMenu] Failed to read inventory data",i),e=null}let n;try{n=await Lr.get()}catch(i){console.warn("[StatsMenu] Failed to read active pet data",i),n=null}let r=i_(e),o=Array.isArray(n)?n:[];if(r.length===0&&o.length===0)return;let s=new Map;for(let i of r){if(!$n(i)||(typeof i.itemType=="string"?i.itemType.toLowerCase():"")!=="pet")continue;let d=(typeof i.petSpecies=="string"?i.petSpecies:null)?.trim();if(!d)continue;let u=d.toLowerCase(),y=s.get(u)??{normal:0,gold:0,rainbow:0},h=Ow(i.mutations);y[h]=(y[h]??0)+1,s.set(u,y)}for(let i of o){if(!$n(i))continue;let l=$n(i.slot)?i.slot:null;if(!l)continue;let d=(typeof l.petSpecies=="string"?l.petSpecies:null)?.trim();if(!d)continue;let u=d.toLowerCase(),y=s.get(u)??{normal:0,gold:0,rainbow:0},h=Ow(l.mutations);y[h]=(y[h]??0)+1,s.set(u,y)}let a=!1;for(let i of s.values())if((i.normal??0)>0||(i.gold??0)>0||(i.rainbow??0)>0){a=!0;break}a&&Fe.update(i=>{if(qw(i))for(let[l,c]of s){if((c.normal??0)<=0&&(c.gold??0)<=0&&(c.rainbow??0)<=0)continue;let d=i.pets.hatchedByType[l]??{normal:0,gold:0,rainbow:0};d.normal=(d.normal??0)+(c.normal??0),d.gold=(d.gold??0)+(c.gold??0),d.rainbow=(d.rainbow??0)+(c.rainbow??0),i.pets.hatchedByType[l]=d}})}function l_(t,e){let n=t.toLowerCase(),r=Number.isFinite(e)?Math.max(0,e):0;if(r_.has(n))return Qw(r);if(o_.has(n))return`${ct(r)} XP`;if(s_.has(n))return`${ct(r)} strength`;if(a_.has(n)){let o=Math.round(r);return`${Math.abs(r-o)<1e-6?ct(o):r.toFixed(1)}% hunger`}return jo(r)??ct(r)}var Fw=560,jw="menu:stats:collapsed",Xc=null;function Kw(){try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}try{if(typeof localStorage<"u")return localStorage}catch{}return null}function c_(){let t=Kw();if(!t)return{};try{let e=t.getItem(jw);if(!e)return{};let n=JSON.parse(e);if(!n||typeof n!="object")return{};let r=Object.entries(n).filter(o=>typeof o[1]=="boolean");return Object.fromEntries(r)}catch(e){return console.warn("[StatsMenu] Failed to read collapse state",e),{}}}function d_(t){let e=Kw();if(e)try{e.setItem(jw,JSON.stringify(t))}catch(n){console.warn("[StatsMenu] Failed to save collapse state",n)}}function Uw(){return Xc||(Xc=c_()),Xc}function u_(t,e){let r=Uw()[t];return typeof r=="boolean"?r:e}function p_(t,e){let n=Uw();if(n[t]===e)return;let r={...n,[t]:e};Xc=r,d_(r)}var m_=new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),TW=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}),Vw=[me.Common,me.Uncommon,me.Rare,me.Legendary,me.Mythic,me.Divine,me.Celestial],f_={[me.Common]:"#E7E7E7",[me.Uncommon]:"#67BD4D",[me.Rare]:"#0071C6",[me.Legendary]:"#FFC734",[me.Mythic]:"#9944A7",[me.Divine]:"#FF7835",[me.Celestial]:"#7C2AE8"};function Va(t,e,n={}){let r=t.card(e,{tone:"muted",align:"stretch",subtitle:n.subtitle,icon:n.icon});r.root.classList.add("qmm-card--collapsible");let o=document.createElement("button");o.type="button",o.className="qmm-btn qmm-btn--ghost qmm-btn--sm stats-collapse-toggle",o.style.marginLeft="auto";let s=document.createElement("span");s.className="stats-collapse-toggle__icon",s.setAttribute("aria-hidden","true");let a=document.createElement("span");a.className="stats-collapse-toggle__label",o.append(s,a);let i=r.header.querySelector(".qmm-card__title");i?i.insertAdjacentElement("afterend",o):r.header.appendChild(o);let l=n.storageId?.trim()||null,c=null,d=()=>{c&&(c.cancel(),c=null)},u=p=>{let m=r.body;if(d(),typeof window.matchMedia=="function"&&window.matchMedia("(prefers-reduced-motion: reduce)").matches){m.style.display=p?"none":"grid",m.style.height="",m.style.opacity="",m.style.overflow="";return}let S="cubic-bezier(0.33, 1, 0.68, 1)",w=220;if(m.style.overflow="hidden",p){let x=m.offsetHeight;m.style.height=`${x}px`,m.style.opacity="1",c=m.animate([{height:`${x}px`,opacity:1},{height:"0px",opacity:0}],{duration:w,easing:S,fill:"forwards"})}else{m.style.display="grid",m.style.height="0px",m.style.opacity="0";let x=m.scrollHeight;c=m.animate([{height:"0px",opacity:0},{height:`${x}px`,opacity:1}],{duration:w,easing:S,fill:"forwards"})}if(!c){m.style.display=p?"none":"grid",m.style.height="",m.style.opacity="",m.style.overflow="";return}c.onfinish=()=>{p?(m.style.display="none",m.style.opacity=""):(m.style.display="grid",m.style.opacity=""),m.style.height="",m.style.overflow="",c=null},c.oncancel=()=>{m.style.height="",m.style.opacity="",m.style.overflow="",p&&(m.style.display="none"),c=null}},y=(p,m=!0,g=!0)=>{g?u(p):(d(),r.body.style.display=p?"none":"grid",r.body.style.height="",r.body.style.opacity="",r.body.style.overflow=""),r.root.dataset.collapsed=p?"true":"false",o.setAttribute("aria-expanded",String(!p));let S=p?"Show":"Hide",w=`${S} ${e}`;a.textContent=S,o.setAttribute("aria-label",w),o.title=w,r.root.classList.toggle("is-collapsed",p),m&&l&&p_(l,p)},h=!!n.startCollapsed,f=l?u_(l,h):h;return y(f,!1,!1),o.addEventListener("click",()=>{let p=r.root.dataset.collapsed==="true";y(!p)}),{root:r.root,body:r.body,header:r.header,setCollapsed:y}}function Yw(t){let e=document.createElement("div");e.className="stats-metric-grid";for(let n of t){let r=document.createElement("div");r.className="stats-metric",n.hint&&(r.title=n.hint);let o=document.createElement("span");o.className="stats-metric__label",o.textContent=n.label;let s=document.createElement("span");s.className="stats-metric__value qmm-num",s.textContent=n.value,r.append(o,s),e.appendChild(r)}return e}function y_(t){let e=document.createElement("span");e.className="stats-weather__name";let n=document.createElement("span");n.className="stats-weather__icon";let r=il(t.spriteKey??t.label,{size:32,fallback:"\u{1F326}",alt:t.label});n.appendChild(r);let o=document.createElement("span");return o.className="stats-weather__label",o.textContent=t.label,e.append(n,o),{content:e}}function Ym(t,e){let n=document.createElement("div");n.className="stats-list";let r=a=>a.width?a.width:a.minWidth?`minmax(${a.minWidth}, 1fr)`:"minmax(0, 1fr)",o=t.map(r).join(" "),s=document.createElement("div");s.className="stats-list__row stats-list__row--header",s.style.gridTemplateColumns=o;for(let a of t){let i=document.createElement("span");i.className="stats-list__cell";let l=a.align??"left";l!=="left"&&i.classList.add(`stats-list__cell--align-${l}`),a.headerClassName&&i.classList.add(a.headerClassName),i.textContent=a.label,s.appendChild(i)}n.appendChild(s);for(let a of e){let i=document.createElement("div");i.className="stats-list__row",i.style.gridTemplateColumns=o,a.forEach((l,c)=>{let d=t[c],u=document.createElement("span");u.className="stats-list__cell";let y=l.align??d.align??"left";y!=="left"&&(u.classList.add(`stats-list__cell--align-${y}`),y==="right"&&u.classList.add("qmm-num")),l.hint&&(u.title=l.hint);let h=!!l.content;if(l.content&&u.appendChild(l.content),l.text!=null)if(h){let f=document.createElement("span");f.textContent=l.text,u.appendChild(f)}else u.textContent=l.text;else h||(u.textContent="");i.appendChild(u)}),n.appendChild(i)}return n}function Qw(t){let e=Math.max(0,t||0);if(e<1e3)return`${ct(e)} ms`;let n=e/1e3;if(n<60)return`${n.toFixed(1)} s`;let r=n/60;return r<60?`${r.toFixed(1)} min`:`${(r/60).toFixed(1)} h`}function g_(t){return m_.format(new Date(t))}function h_(t,e,n){let r=t.card("\u{1F5D3}\uFE0F Tracking",{tone:"muted",align:"stretch",compactHeader:!0}),o=Number.isFinite(n.createdAt)?Math.max(0,Math.floor(n.createdAt)):0,s=o>0,a=t.flexRow({align:"center",gap:12,className:"stats-meta"}),i=document.createElement("span");i.className="stats-meta__label",i.textContent="Tracking started:",a.appendChild(i);let l=document.createElement("strong");l.className="stats-meta__value",l.textContent=s?g_(o):"Unavailable",a.appendChild(l);let c=t.btn("RESET",{variant:"danger"});c.style.marginLeft="auto",c.addEventListener("click",()=>{let d=Fe.reset();Ww(d),zw(d),Gw(d)}),a.appendChild(c),r.body.appendChild(a),e.appendChild(r.root)}function b_(t,e,n){let r=Va(t,"\u{1F331} Garden",{subtitle:"Field activity",storageId:"garden"}),o=[{label:"Total planted",value:ct(n.garden.totalPlanted)},{label:"Total harvested",value:ct(n.garden.totalHarvested)},{label:"Total destroyed",value:ct(n.garden.totalDestroyed)},{label:"Watering can Used",value:ct(n.garden.watercanUsed)},{label:"Water time saved",value:Qw(n.garden.waterTimeSavedMs),hint:`${ct(n.garden.waterTimeSavedMs)} ms`}];r.body.appendChild(Yw(o)),e.appendChild(r.root)}function S_(t,e,n){let r=Va(t,"\u{1F3EA} Shops",{subtitle:"Purchases & sales",storageId:"shops"}),o=[{label:"Seeds bought",value:ct(n.shops.seedsBought)},{label:"Tools bought",value:ct(n.shops.toolsBought)},{label:"Eggs bought",value:ct(n.shops.eggsBought)},{label:"Decor bought",value:ct(n.shops.decorBought)},{label:"Crops sold",value:`${ct(n.shops.cropsSoldCount)} items`},{label:"Crop revenue",value:jo(n.shops.cropsSoldValue)??ct(n.shops.cropsSoldValue)},{label:"Pets sold",value:`${ct(n.shops.petsSoldCount)} pets`},{label:"Pet revenue",value:jo(n.shops.petsSoldValue)??ct(n.shops.petsSoldValue)}];r.body.appendChild(Yw(o)),e.appendChild(r.root)}function v_(){let t=new Map;for(let e of Vw)t.set(e,[]);for(let e of Object.keys(gt)){let r=gt[e]?.rarity??me.Common,o=t.get(r)??[];o.push(e),t.set(r,o)}for(let e of t.values())e.sort((n,r)=>n.localeCompare(r));return t}var td=new Map,Ka=new Map,Ua=new Map,Qm=new WeakMap,Bw=!1,ed=null;function w_(){ed=null}function x_(){if(ed)return ed;let t=new Set;try{Ie.listPets().forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return ed=e,e}function E_(t){let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}async function C_(t){await Pt();let n=gt[t]?.tileRef;if(n==null)return null;let r=E_(n);if(r==null)return null;let o=new Set(x_());o.size===0&&(o.add("pets"),o.add("Pets"));for(let s of o)try{let i=(await kt(s)).find(c=>c.index===r);if(!i)continue;let l=Ie.toCanvas(i);if(l&&l.width>0&&l.height>0){let c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");if(!d)continue;return d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),c.toDataURL()}}catch{}return null}function Jw(t,e){let n=Qm.get(t);if(!n)return;let{size:r,fallback:o}=n;if(t.classList.add("stats-pet__sprite-icon"),t.style.setProperty("--stats-pet-sprite-size",`${r}px`),t.innerHTML="",e){t.style.fontSize="";let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,t.appendChild(s)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.7))}px`}function M_(t,e,n){let r=Ua.get(t);r||(r=new Set,Ua.set(t,r)),r.add(e),Qm.set(e,n)}function Hw(t,e){let n=Ua.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Qm.delete(r);return}Jw(r,e)}),n.size===0&&Ua.delete(t))}function $w(t){if(typeof window>"u")return Promise.resolve(null);let e=td.get(t);if(e!==void 0)return Hw(t,e),Promise.resolve(e);let n=Ka.get(t);if(n)return n;let r=C_(t).then(o=>(td.set(t,o),Ka.delete(t),Hw(t,o),o)).catch(()=>(Ka.delete(t),null));return Ka.set(t,r),r}function A_(){Bw||typeof window>"u"||(Bw=!0,window.addEventListener("mg:sprite-detected",()=>{td.clear(),Ka.clear(),w_(),Array.from(Ua.keys()).forEach(e=>{$w(e)})}))}function T_(t,e={}){let n=Math.max(12,e.size??28),r=t.trim().charAt(0)||"\u{1F43E}",s=(e.fallback??r).toString(),a=document.createElement("span");if(typeof window>"u")return a.classList.add("stats-pet__sprite-icon"),a.style.setProperty("--stats-pet-sprite-size",`${n}px`),a.textContent=s,a.style.fontSize=`${Math.max(10,Math.round(n*.7))}px`,a;A_(),M_(t,a,{size:n,fallback:s});let i=td.get(t);return Jw(a,i??null),$w(t),a}function I_(t){let e=document.createElement("span");e.className="stats-pet__species";let n=T_(t,{size:28,fallback:t.trim().charAt(0).toUpperCase()||"\u{1F43E}"}),r=document.createElement("span");return r.className="stats-pet__label",r.textContent=t,e.appendChild(n),e.appendChild(r),{content:e}}function k_(t){let e=document.createElement("span");return e.className="stats-pet__total-value qmm-num",e.textContent=ct(t),{content:e,align:"center"}}function P_(t,e,n){let r=Va(t,"\u{1F43E} Pets",{subtitle:"Hatching overview",storageId:"pets"}),o=v_();for(let s of Vw){let a=o.get(s)??[];if(!a.length)continue;let i=document.createElement("div");i.className="stats-pet-group",i.style.setProperty("--stats-pet-group-border-color",f_[s]);let l=document.createElement("div");l.className="stats-pet-group__summary",l.textContent="";let c=Vm(s);c.style.margin="0",l.appendChild(c),i.appendChild(l);let d=document.createElement("div");d.className="stats-pet-group__content";let u=[{label:"Species",width:"2.2fr"},{label:"Normal",align:"center",width:"1fr"},{label:"Gold",align:"center",width:"1fr",headerClassName:"stats-list__header-label--gold"},{label:"Rainbow",align:"center",width:"1fr",headerClassName:"stats-list__header-label--rainbow"},{label:"Total",align:"center",width:"1fr"}],y=[];for(let h of a){let f=h.toLowerCase(),p=n.pets.hatchedByType[f]??{normal:0,gold:0,rainbow:0},m=p.normal+p.gold+p.rainbow;y.push([I_(h),{text:ct(p.normal),align:"center"},{text:ct(p.gold),align:"center"},{text:ct(p.rainbow),align:"center"},k_(m)])}d.appendChild(Ym(u,y)),i.appendChild(d),r.body.appendChild(i)}e.appendChild(r.root)}function L_(t,e,n){let r=Va(t,"\u{1F9E0} Abilities",{subtitle:"Trigger counts",storageId:"abilities"}),o=Object.keys(Bt).sort((i,l)=>{let c=Bt[i]?.name??i,d=Bt[l]?.name??l;return c.localeCompare(d)}),s=[{label:"Ability",width:"2.2fr"},{label:"Triggers",align:"right",width:"1fr"},{label:"Value",align:"right",width:"1.2fr"}],a=[];for(let i of o){let l=Bt[i],c=n.abilities[i]??{triggers:0,totalValue:0},d=l_(i,c.totalValue);a.push([{text:l?.name??i,hint:l?.description},{text:ct(c.triggers)},{text:d}])}r.body.appendChild(Ym(s,a)),e.appendChild(r.root)}function R_(t,e,n){let r=Va(t,"\u26C5 Weather",{subtitle:"Events overview",storageId:"weather"}),o=[{label:"Weather",width:"2fr"},{label:"TOTAL",align:"right",width:"1fr"}],s=[],a=Object.keys(Dr).map(i=>{let l=Dr[i],c=l?.atomValue??i,d=i.toLowerCase(),u=n.weather[d]??{triggers:0},y=Gn(i)??Gn(l?.atomValue)??Gn(l?.displayName)??null;return{key:d,label:c,triggers:u.triggers,spriteKey:y}}).sort((i,l)=>i.label.localeCompare(l.label));for(let i of a)s.push([y_({label:i.label,spriteKey:i.spriteKey}),{text:ct(i.triggers)}]);r.body.appendChild(Ym(o,s)),e.appendChild(r.root)}function Jm(t){let e=t;if(typeof e.__statsCleanup=="function"){try{e.__statsCleanup()}catch(g){console.error("[StatsMenu] Cleanup error",g)}e.__statsCleanup=void 0}let n=t.firstElementChild,r=n?.classList.contains("qmm")?n.querySelector(".qmm-views")??null:null,o=r?r.scrollTop:null,s=null,a=!1,i=()=>{},l=()=>{if(!a){a=!0;try{i()}catch(g){console.error("[StatsMenu] Unsubscribe error",g)}s!==null&&(cancelAnimationFrame(s),s=null),e.__statsCleanup===l&&(e.__statsCleanup=void 0)}};i=Fe.subscribe(()=>{if(!e.isConnected){l();return}s===null&&(s=requestAnimationFrame(()=>{s=null,Jm(t)}))}),e.__statsCleanup=l;let c=new Qe({id:"stats",compact:!0});c.mount(t);let d=c.root.closest(".qws-win");d&&(d.style.minWidth=`${Fw}px`);let u=getComputedStyle(t),y=Number.parseFloat(u.paddingLeft)||0,h=Number.parseFloat(u.paddingRight)||0,f=Math.max(0,Fw-y-h);t.style.minWidth=`${f}px`;let p=c.root.querySelector(".qmm-views");if(!p)return;p.innerHTML="",p.style.display="grid",p.style.gap="12px",p.style.padding="4px 0",p.style.minHeight="0",p.style.alignContent="start",p.style.maxHeight="54vh";let m=Fe.getSnapshot();Ww(m).catch(g=>{console.error("[StatsMenu] Failed to initialize garden stats",g)}),zw(m).catch(g=>{console.error("[StatsMenu] Failed to initialize shop stats",g)}),Gw(m).catch(g=>{console.error("[StatsMenu] Failed to initialize pet stats",g)}),h_(c,p,m),b_(c,p,m),S_(c,p,m),P_(c,p,m),L_(c,p,m),R_(c,p,m),o!==null&&(p.scrollTop=o)}function Zw(t,e){let n=t.querySelector(".label");n?n.textContent=e:t.textContent=e}function xn(t,e="warn"){try{window.toastSimple?.(t,"",e)}catch{}}function Tr(t){let e=document.createElement("div");e.className="dd-debug-columns",t.appendChild(e);let n=document.createElement("div");n.className="dd-debug-column";let r=document.createElement("div");return r.className="dd-debug-column",e.append(n,r),{columns:e,leftCol:n,rightCol:r}}function jt(t){let e=String(t??"");if(!e.length)return;let n=()=>{let r=document.createElement("textarea");r.value=e,r.setAttribute("readonly","true"),r.style.position="fixed",r.style.left="-9999px",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select();let o=!1;try{o=document.execCommand("copy")}catch{}document.body.removeChild(r);try{window.toastSimple?.(o?"Copied":"Copy failed","",o?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(e).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(n):n()}function ro(t){try{return new RegExp(t,"i")}catch{return/.*/i}}function oo(t){t.style.maxHeight="260px",t.style.overflow="auto",t.style.background="#0b1016",t.style.border="1px solid #ffffff18",t.style.borderRadius="12px",t.style.padding="12px",t.style.margin="6px 0 0",t.style.fontSize="12px",t.style.lineHeight="1.5",t.style.color="#dbe4ff",t.style.boxShadow="inset 0 1px 0 rgba(255,255,255,.04)"}function Xw(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Tr(t),o=[],s=[],a=[],i=e.card("\u{1F3A7} Audio player",{tone:"muted",subtitle:"Inspect detected sounds, auto groups and Howler status."});n.appendChild(i.root);let l=document.createElement("div");l.className="dd-audio-summary";let c=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div");l.append(c,d,u);let y=document.createElement("div");y.className="dd-audio-volume";let h=document.createElement("div");h.className="dd-audio-volume";let f=e.errorBar(),p=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),m=e.btn("Rescan sounds",{icon:"\u{1F504}",variant:"primary",onClick:()=>{q({rescan:!0})}}),g=e.btn("Refresh snapshot",{icon:"\u{1F501}",onClick:()=>{q()}}),S=e.btn("Copy JSON",{icon:"\u{1F4CB}",onClick:()=>jt(qt.exportJSON())});p.append(m,g,S),i.body.append(l,y,h,f.el,p);let w=e.card("\u{1F39B}\uFE0F Groups",{tone:"muted",subtitle:"Browse auto-generated groups and play random variations."});n.appendChild(w.root);let x=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),E=e.inputText("filter groups (regex)","");E.classList.add("dd-grow");let T=e.btn("Clear",{icon:"\u{1F9F9}",onClick:()=>{E.value="",Y(),E.focus()}});x.append(E,T);let A=document.createElement("p");A.className="dd-card-description",A.style.margin="0";let N=document.createElement("div");N.className="dd-audio-list";let H=document.createElement("div");H.className="dd-audio-empty",H.textContent="No groups match the current filter.",w.body.append(x,A,N,H);let C=e.card("\u{1F509} Sounds",{tone:"muted",subtitle:"Inspect detected files and trigger playback."});r.appendChild(C.root);let L=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),v=e.inputText("filter sounds (regex)","");v.classList.add("dd-grow");let B=e.btn("Clear",{icon:"\u{1F9F9}",onClick:()=>{v.value="",ne(),v.focus()}}),le=e.btn("Copy visible URLs",{icon:"\u{1F4CB}",onClick:()=>{a.length&&jt(a.map(W=>W.url).join(`
`))}});L.append(v,B,le);let X=document.createElement("p");X.className="dd-card-description",X.style.margin="0";let de=document.createElement("div");de.className="dd-audio-list";let _=document.createElement("div");_.className="dd-audio-empty",_.textContent="No sounds match the current filter.",C.body.append(L,X,de,_),E.addEventListener("input",()=>Y()),E.addEventListener("keydown",W=>{W.key==="Enter"&&(W.preventDefault(),Y())}),v.addEventListener("input",()=>ne()),v.addEventListener("keydown",W=>{W.key==="Enter"&&(W.preventDefault(),ne())});let re=!1;function R(W){return W.logicalName||W.name||k(W.url)}function k(W){try{return new URL(W,location.href).pathname.split("/").pop()||W}catch{return W}}function V(W,b=3){return W==null||Number.isNaN(W)||!Number.isFinite(W)?"\u2014":W.toFixed(b)}function ee(W,b){let D=W.setEnabled;typeof D=="function"?D(b):W.disabled=!b}let ie=m.querySelector(".label"),fe=ie?.textContent??"Rescan sounds";function G(W){ee(m,!W),ie&&(ie.textContent=W?"Scanning\u2026":fe)}function Z(){o=qt.info().slice().sort((W,b)=>R(W).localeCompare(R(b))),s=Object.entries(qt.groups()).sort((W,b)=>W[0].localeCompare(b[0]))}function j(){let W=new Set;o.forEach(J=>{(J.sources||"").split(",").map(te=>te.trim()).filter(Boolean).forEach(te=>W.add(te))});let b=qt.getGameSfxVolume(),D=window?.Howler,F=null;try{if(D&&typeof D.volume=="function"){let J=D.volume();typeof J=="number"&&Number.isFinite(J)&&(F=J)}}catch{}let P=Array.isArray(D?._howls)?D._howls.length:0;c.innerHTML=`<strong>${o.length}</strong> sounds detected`,d.innerHTML=`<strong>${s.length}</strong> auto groups`,u.innerHTML=`<strong>${W.size}</strong> unique source tags`,y.textContent=`Atom raw: ${V(b.raw)} (clamped ${V(b.clamped)})`;let I="";F!=null?(I=` \xB7 Howler master ${V(F)}`,P&&(I+=` (${P} howl${P===1?"":"s"})`)):P&&(I=` \xB7 ${P} howl${P===1?"":"s"} registered`),h.textContent=`Final output volume: ${V(b.vol)}${I}`}function Y(){let W=ro(E.value.trim()||".*"),b=new Map(o.map(P=>[P.url,P]));N.innerHTML="";let D=0,F=P=>!!P&&W.test(P);for(let[P,I]of s){if(!(F(P)||I.some(ye=>{let he=b.get(ye);return F(ye)||F(he?.logicalName)||F(he?.name)})))continue;D++;let te=I[0]||"",z=b.get(te),M=document.createElement("div");M.className="dd-audio-row";let K=document.createElement("div");K.className="dd-audio-row__info";let $=document.createElement("div");$.className="dd-audio-row__title",$.textContent=P;let Q=document.createElement("div");Q.className="dd-audio-meta";let se=[];se.push(`${I.length} variation${I.length===1?"":"s"}`),z?.name&&se.push(`Sample: ${z.name}`),z?.sources&&se.push(`Sources: ${z.sources}`),Q.textContent=se.join(" \u2022 ");let O=document.createElement("div");O.className="dd-audio-url",O.textContent=te||"(no sample)",K.append($,Q,O),M.appendChild(K);let U=e.flexRow({gap:6,wrap:!1,align:"center"});U.className="dd-audio-actions";let ue=e.btn("Play",{icon:"\u25B6\uFE0F",size:"sm",onClick:()=>{qt.playGroup(P,{random:!0})}}),oe=e.btn("Copy URLs",{icon:"\u{1F4CB}",size:"sm",onClick:()=>jt(I.join(`
`))}),ae=te?e.btn("Open",{icon:"\u{1F517}",size:"sm",onClick:()=>{try{window.open(te,"_blank","noopener,noreferrer")}catch{}}}):null;U.append(ue,oe),ae&&U.append(ae),M.appendChild(U),N.appendChild(M)}A.textContent=s.length?`${D} / ${s.length} groups shown.`:"No groups have been detected yet. Run a rescan to populate the cache.",N.style.display=D?"":"none",H.textContent=s.length?"No groups match the current filter.":"No groups detected yet. Run a rescan to populate the cache.",H.style.display=D?"none":"block",ee(T,E.value.trim().length>0)}function ne(){let W=ro(v.value.trim()||".*");a=[],de.innerHTML="";let b=D=>!!D&&W.test(D);for(let D of o){if(!(b(D.logicalName)||b(D.name)||b(D.sources)||b(D.url)))continue;a.push(D);let F=document.createElement("div");F.className="dd-audio-row";let P=document.createElement("div");P.className="dd-audio-row__info";let I=document.createElement("div");I.className="dd-audio-row__title",I.textContent=R(D);let J=document.createElement("div");J.className="dd-audio-meta";let te=[];D.name&&D.name!==D.logicalName&&te.push(`File: ${D.name}`),D.logicalName&&te.push(`Logical: ${D.logicalName}`),D.sources&&te.push(`Sources: ${D.sources}`),J.textContent=te.join(" \u2022 ");let z=document.createElement("div");z.className="dd-audio-url",z.textContent=D.url,P.append(I,J,z),F.appendChild(P);let M=e.flexRow({gap:6,wrap:!1,align:"center"});M.className="dd-audio-actions";let K=e.btn("Play",{icon:"\u25B6\uFE0F",size:"sm",onClick:()=>{qt.playUrl(D.url)}}),$=e.btn("Copy",{icon:"\u{1F4CB}",size:"sm",onClick:()=>jt(D.url)}),Q=e.btn("Open",{icon:"\u{1F517}",size:"sm",onClick:()=>{try{window.open(D.url,"_blank","noopener,noreferrer")}catch{}}});M.append(K,$,Q),F.appendChild(M),de.appendChild(F)}X.textContent=o.length?`${a.length} / ${o.length} sounds shown.`:"No sounds have been detected yet. Run a rescan to populate the cache.",de.style.display=a.length?"":"none",_.textContent=o.length?"No sounds match the current filter.":"No sounds detected yet. Run a rescan to populate the cache.",_.style.display=a.length?"none":"block",ee(le,a.length>0),ee(B,v.value.trim().length>0)}async function q(W={}){if(re)return;re=!0;let{rescan:b=!1}=W;f.clear(),b?G(!0):ee(m,!1),ee(g,!1);let D=null;try{if(b)try{await qt.scan()}catch(F){D=F}if(Z(),j(),Y(),ne(),D){let F=D instanceof Error?D.message:String(D);f.show(`Scan failed: ${F}`),console.error("[debug] audio scan failed",D)}}finally{b?G(!1):ee(m,!0),ee(g,!0),re=!1}}q()}function ex(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Tr(t);{let s=e.card("\u{1F5C4}\uFE0F Capture store",{tone:"muted",subtitle:"Initialize the Jotai store so atoms can be inspected."});n.appendChild(s.root);let a=document.createElement("span");a.className="dd-status-chip";let i=()=>{let d=ps();a.textContent=d?"Store captured":"Store not captured",a.classList.toggle("is-ok",d),a.classList.toggle("is-warn",!d)};i();let l=e.flexRow({gap:10,align:"center",wrap:!0}),c=e.btn("Capture store",{variant:"primary",icon:"\u23FA",onClick:async()=>{try{await at()}catch{}i()}});l.append(c,a),s.body.appendChild(l)}{let s=e.card("\u{1F50D} Explore atoms",{tone:"muted",subtitle:"Filter labels using a regular expression."});n.appendChild(s.root);let a=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),i=e.inputText("regex label (ex: position|health)","");i.classList.add("dd-grow");let l=e.btn("List",{icon:"\u{1F4C4}",onClick:()=>u()}),c=e.btn("Copy",{icon:"\u{1F4CB}",onClick:()=>jt(d.textContent||"")});a.append(i,l,c);let d=document.createElement("pre");oo(d),d.style.minHeight="140px";async function u(){let y=i.value.trim(),h=ro(y||".*"),m=Pr(/.*/).filter(g=>h.test(String(g?.debugLabel||g?.label||""))).map(g=>String(g?.debugLabel||g?.label||"<?>"));d.textContent=m.join(`
`)}s.body.append(a,d)}{let s=e.card("\u{1F9ED} Inspect an atom",{tone:"muted",subtitle:"Get the current value or subscribe to updates."});r.appendChild(s.root);let a=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),i=e.inputText("atom label (ex: positionAtom)","");i.classList.add("dd-grow");let l=document.createElement("pre");oo(l),l.style.minHeight="160px";let c=null,d=e.btn("Get",{icon:"\u{1F441}",onClick:async()=>{let f=st(i.value.trim());if(!f){l.textContent=`Atom "${i.value}" not found`;return}try{o(l,await Rt(f))}catch(p){o(l,p?.message||String(p))}}}),u=e.btn("Subscribe",{icon:"\u{1F514}",onClick:async()=>{let f=i.value.trim();if(!f)return;let p=st(f);if(!p){l.textContent=`Atom "${f}" not found`;return}if(c){c(),c=null,u.textContent="Subscribe";return}c=await er(p,async()=>{try{o(l,await Rt(p))}catch{}}),u.textContent="Unsubscribe"}}),y=e.btn("Copy",{icon:"\u{1F4CB}",onClick:()=>jt(l.textContent||"")});a.append(i,d,u,y);let h=document.createElement("p");h.className="dd-inline-note",h.textContent="Tip: subscriptions keep the value updated after each mutation.",s.body.append(a,h,l)}{let s=e.card("\u270F\uFE0F Update an atom",{tone:"muted",subtitle:"Publish a new value (JSON)."});r.appendChild(s.root);let a=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),i=e.inputText("atom label (ex: activeModalAtom)","");i.classList.add("dd-grow");let l=document.createElement("textarea");l.className="qmm-input dd-textarea",l.placeholder='JSON or text value, e.g. inventory or { "x": 1, "y": 2 }';let c=e.btn("Set",{icon:"\u2705",variant:"primary",onClick:async()=>{let u=i.value.trim();if(!u){xn("Enter an atom label");return}try{await at()}catch(g){xn(g?.message||"Unable to capture store");return}if(!ps()){xn('Store not captured. Use "Capture store" first.');return}let y=st(u);if(!y){xn(`Atom "${u}" not found`);return}let h=l.value,f=h.trim(),p=h,m=!1;if(f)try{p=JSON.parse(f)}catch{m=!0}else p="";try{await En(y,p),xn(m?"Set OK (raw text)":"Set OK")}catch(g){xn(g?.message||"Set failed")}}}),d=e.btn("Copy JSON",{icon:"\u{1F4CB}",onClick:()=>jt(l.value)});a.append(i,c,d),s.body.append(a,l)}function o(s,a){s.textContent=typeof a=="string"?a:JSON.stringify(a,null,2)}}var Ir=t=>{let e=new Date(t),n=(r,o=2)=>String(r).padStart(o,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`},sx=t=>t.replace(/[<>&]/g,e=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[e]),rd=class{constructor(e=2e3){this.max=e;pe(this,"arr",[])}push(e){this.arr.push(e),this.arr.length>this.max&&this.arr.splice(0,this.arr.length-this.max)}toArray(){return this.arr.slice()}clear(){this.arr.length=0}},nd=new Map;function $m(){return Array.from(nd.values())}function ax(){return`status: ${It.some(n=>n.readyState===WebSocket.OPEN)?"OPEN":"none"} \u2022 mode: ${gi?"worker":"page/auto"}`}var tx=Symbol.for("qmm.wsCtorHooked"),nx=Symbol.for("qmm.wsPatchedSend"),rx=!1;function ix(t){let e=window.WebSocket;if(!e[tx]){let n=new Proxy(e,{construct(r,o,s){let a=Reflect.construct(r,o,s);try{ox(a,"new",t)}catch{}return a}});n[tx]=!0,window.WebSocket=n}It.forEach(n=>{try{ox(n,"existing",t)}catch{}}),rx||(rx=!0)}function ox(t,e,n){if(nd.has(t))return;let r=`WS#${1+nd.size} (${bi(t.readyState)})`,o={ws:t,id:r,listeners:[]};It.includes(t)||It.push(t),_r?.(t,e);let s=l=>{let c="";try{c=typeof l.data=="string"?l.data:JSON.stringify(l.data)}catch{c=String(l.data)}n({t:Date.now(),dir:"in",text:c,ws:t})};t.addEventListener("message",s),o.listeners.push(()=>t.removeEventListener("message",s));let a=()=>{o.id=o.id.replace(/\(.*\)/,`(${bi(t.readyState)})`)},i=()=>{o.id=o.id.replace(/\(.*\)/,`(${bi(t.readyState)})`)};if(t.addEventListener("open",a),t.addEventListener("close",i),o.listeners.push(()=>t.removeEventListener("open",a)),o.listeners.push(()=>t.removeEventListener("close",i)),!t[nx]){let l=t.send.bind(t);o.sendOrig=l,t[nx]=!0,t.send=c=>{try{let d=typeof c=="string"?c:JSON.stringify(c);n({t:Date.now(),dir:"out",text:d,ws:t})}catch{n({t:Date.now(),dir:"out",text:String(c),ws:t})}return l(c)}}nd.set(t,o)}function lx(t,e){if(typeof t.__atoms_live_cleanup__=="function")try{t.__atoms_live_cleanup__()}catch{}t.innerHTML="",t.classList.add("dd-debug-view");let n=new Map,r=[],o=!1,s=null,{leftCol:a,rightCol:i}=Tr(t),l=e.card("\u{1F9EA} Pick atoms",{tone:"muted",subtitle:"Filter labels with a regex then toggle atoms to monitor."});a.appendChild(l.root);let c=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),d=e.inputText("regex label (ex: position|health)","");d.classList.add("dd-grow");let u=e.btn("Refresh",{icon:"\u{1F50D}",onClick:()=>_()});c.append(d,u);let y=document.createElement("div");y.className="dd-atom-list";let h=document.createElement("p");h.className="dd-card-description",h.textContent="No atoms match the current filter.",h.style.display="none";let f=document.createElement("p");f.className="dd-card-description",f.style.marginTop="8px",l.body.append(c,y,h,f),d.addEventListener("keydown",q=>{q.key==="Enter"&&(q.preventDefault(),_())});let p=e.card("\u{1F4E1} Live atom log",{tone:"muted",subtitle:"Start recording to capture updates for the selected atoms."});i.appendChild(p.root);let m=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),g=e.btn("Start recording",{variant:"primary",onClick:()=>ie()}),S=e.btn("Clear log",{variant:"ghost",icon:"\u{1F9F9}",onClick:()=>{r.length=0,s=null,k(!1),V(null),R()}}),w=e.btn("Copy log",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>Z()});m.append(g,S,w),p.body.appendChild(m);let x=document.createElement("div");x.className="dd-log",x.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";let E=document.createElement("div");E.className="dd-log__empty",E.textContent="No updates yet.",x.appendChild(E),p.body.appendChild(x);let T=document.createElement("p");T.className="dd-card-description",T.textContent="Select a log entry to inspect previous and next values.";let A=e.flexRow({gap:12,wrap:!0,fullWidth:!0}),N=document.createElement("div");N.style.flex="1 1 320px";let H=document.createElement("strong");H.textContent="Previous",H.style.display="block",H.style.marginBottom="6px";let C=document.createElement("pre");oo(C),C.style.minHeight="140px",C.textContent="",N.append(H,C);let L=document.createElement("div");L.style.flex="1 1 320px";let v=document.createElement("strong");v.textContent="Next",v.style.display="block",v.style.marginBottom="6px";let B=document.createElement("pre");oo(B),B.style.minHeight="140px",B.textContent="",L.append(v,B);let le=document.createElement("div");le.style.flex="1 1 100%",le.style.minWidth="0";let X=document.createElement("strong");X.textContent="History",X.style.display="block",X.style.marginBottom="6px";let de=document.createElement("div");de.style.display="flex",de.style.flexDirection="column",de.style.gap="10px",de.style.maxHeight="320px",de.style.overflow="auto",le.append(X,de),A.append(N,L,le),p.body.append(T,A);function _(){let q=d.value.trim(),W=ro(q||".*"),b=Pr(W);y.innerHTML="",h.style.display=b.length?"none":"block",b.map(D=>({atom:D,label:String(D?.debugLabel||D?.label||"<unknown>")})).sort((D,F)=>D.label.localeCompare(F.label)).forEach(({atom:D,label:F})=>{let P=document.createElement("label");P.className="dd-atom-list__item",P.title=F;let I=document.createElement("input");I.type="checkbox",I.checked=n.has(F),I.className="dd-atom-list__checkbox";let J=document.createElement("span");if(J.className="dd-atom-list__label",J.textContent=F,P.append(I,J),I.addEventListener("change",async()=>{if(I.checked){let te=n.get(F);te?te.atom=D:n.set(F,{atom:D,lastValue:null,unsubscribe:null}),o&&(await G(F)||(I.checked=!1))}else{let te=n.get(F);if(te?.unsubscribe)try{te.unsubscribe()}catch{}n.delete(F)}re(),R()}),y.appendChild(P),n.has(F)){let te=n.get(F);te&&(te.atom=D)}}),re()}function re(){let q=n.size;f.textContent=q?`${q} atom${q>1?"s":""} selected.`:"No atom selected."}function R(){Zw(g,o?"Stop recording":"Start recording"),g.classList.toggle("active",o),g.disabled=!o&&!n.size,S.disabled=r.length===0,w.disabled=r.length===0}function k(q=!1){if(x.innerHTML="",!r.length){x.appendChild(E),ee(null,null);return}r.forEach((W,b)=>{let D=document.createElement("div");D.className="atoms-log-row",D.dataset.idx=String(b),D.style.display="grid",D.style.gridTemplateColumns="minmax(120px, 160px) minmax(0, 1fr)",D.style.gap="12px",D.style.padding="10px 12px",D.style.margin="4px 0",D.style.borderRadius="12px",D.style.border="1px solid rgba(255,255,255,.12)";let F=s===b;D.style.background=F?"rgba(92,126,255,.16)":"rgba(11,16,22,.85)",D.style.borderColor=F?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)",D.style.cursor="pointer",D.addEventListener("mouseenter",()=>{D.style.borderColor="rgba(255,255,255,.28)"}),D.addEventListener("mouseleave",()=>{let M=s===b;D.style.borderColor=M?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)"});let P=document.createElement("div");P.style.display="flex",P.style.flexDirection="column",P.style.gap="2px";let I=document.createElement("strong");I.textContent=W.label;let J=document.createElement("span");J.style.opacity="0.7",J.style.fontSize="12px",J.textContent=`${Ir(W.timestamp)}${W.type==="initial"?" \u2022 initial":""}`,P.append(I,J);let te=document.createElement("div");te.style.fontSize="12px",te.style.lineHeight="1.45",te.style.whiteSpace="pre-wrap";let z=W.type==="initial"?"[initial] ":"";te.textContent=z+ne(W.next),D.append(P,te),D.addEventListener("click",()=>{s=b,k(!1),V(W)}),x.appendChild(D)}),q&&(x.scrollTop=x.scrollHeight),s!=null&&!r[s]&&(s=r.length?Math.min(s,r.length-1):null),s!=null&&ee(r[s]?.label??null,s)}function V(q){if(!q){T.textContent="Select a log entry to inspect previous and next values.",H.textContent="Previous",C.textContent="",v.textContent="Next",B.textContent="",ee(null,null);return}let W=q.type==="initial"?" (initial)":"";T.textContent=`${q.label} \u2014 ${Ir(q.timestamp)}${W}`,H.textContent=q.type==="initial"?"Previous (none)":"Previous",C.textContent=q.type==="initial"?"(no previous snapshot)":Y(q.previous),v.textContent=q.type==="initial"?"Initial value":"Next",B.textContent=Y(q.next),ee(q.label,s)}function ee(q,W){if(de.innerHTML="",!q){let D=document.createElement("p");D.className="dd-card-description",D.textContent="Select a log entry to inspect the value history.",de.appendChild(D);return}let b=r.map((D,F)=>({rec:D,idx:F})).filter(({rec:D})=>D.label===q);if(!b.length){let D=document.createElement("p");D.className="dd-card-description",D.textContent="No history recorded yet.",de.appendChild(D);return}b.forEach(({rec:D,idx:F},P)=>{let I=document.createElement("div");I.style.display="flex",I.style.flexDirection="column",I.style.gap="6px",I.style.padding="10px 12px",I.style.borderRadius="12px",I.style.border="1px solid rgba(255,255,255,.12)";let J=F===W;I.style.background=J?"rgba(92,126,255,.16)":"rgba(11,16,22,.85)",I.style.borderColor=J?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)",I.style.cursor="pointer",I.addEventListener("mouseenter",()=>{J||(I.style.borderColor="rgba(255,255,255,.24)")}),I.addEventListener("mouseleave",()=>{I.style.borderColor=J?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)"}),I.addEventListener("click",()=>{s=F,k(!1),V(r[s])});let te=document.createElement("div");te.style.display="flex",te.style.alignItems="center",te.style.justifyContent="space-between";let z=document.createElement("div");z.style.display="flex",z.style.alignItems="center",z.style.gap="8px";let M=document.createElement("span");M.textContent=`#${P+1}`,M.style.fontSize="11px",M.style.letterSpacing=".04em",M.style.textTransform="uppercase",M.style.padding="2px 6px",M.style.borderRadius="999px",M.style.background="rgba(255,255,255,.08)",M.style.border="1px solid rgba(255,255,255,.16)";let K=document.createElement("span");K.textContent=D.type==="initial"?"Initial":"Update",K.style.fontSize="11px",K.style.opacity="0.75",K.style.textTransform="uppercase",z.append(M,K);let $=document.createElement("span");$.textContent=Ir(D.timestamp),$.style.fontSize="12px",$.style.opacity="0.75",te.append(z,$);let Q=document.createElement("pre");oo(Q),Q.style.margin="0",Q.textContent=Y(D.next),I.append(te,Q),de.appendChild(I)})}async function ie(){if(o){fe();return}if(!n.size){xn("Select at least one atom");return}try{await at()}catch(q){xn(q?.message||"Unable to capture store");return}o=!0,R();for(let q of Array.from(n.keys()))await G(q)||n.delete(q);n.size||fe(),re(),R()}function fe(){if(o){o=!1;for(let q of n.values())if(q.unsubscribe){try{q.unsubscribe()}catch{}q.unsubscribe=null}R()}}async function G(q){let W=n.get(q);if(!W)return!1;if(W.unsubscribe){try{W.unsubscribe()}catch{}W.unsubscribe=null}try{let b=j(await Rt(W.atom));W.lastValue=b;let D=await er(W.atom,async()=>{let P=j(W.lastValue),I;try{I=await Rt(W.atom)}catch(z){I=z?.message||String(z)}let J=j(I);W.lastValue=J;let te={label:q,timestamp:Date.now(),previous:P,next:J,type:"update"};r.push(te),s==null&&(s=r.length-1),k(!0),V(r[s]),R()}),F={label:q,timestamp:Date.now(),previous:null,next:j(b),type:"initial"};return r.push(F),s==null&&(s=r.length-1),k(!0),V(r[s]),W.unsubscribe=()=>{try{D()}catch{}},!0}catch(b){return xn(b?.message||`Unable to subscribe to ${q}`),n.delete(q),re(),R(),!1}}function Z(){if(!r.length)return;let q=r.map(W=>{let b=W.previous==null?"(no previous snapshot)":Y(W.previous),D=Y(W.next),F=W.type==="initial"?"initial":"update";return`[${Ir(W.timestamp)}] ${W.label} (${F})
previous: ${b}
next: ${D}`}).join(`

`);jt(q)}function j(q){if(q==null)return q;try{if(typeof structuredClone=="function")return structuredClone(q)}catch{}try{return JSON.parse(JSON.stringify(q))}catch{return q}}function Y(q){if(typeof q=="string")return q;try{return JSON.stringify(q,null,2)}catch{return String(q)}}function ne(q){let W=Y(q).replace(/\s+/g," ").trim();return W.length>140?W.slice(0,140)+"\u2026":W}_(),R(),t.__atoms_live_cleanup__=()=>{fe();for(let q of n.values())if(q.unsubscribe)try{q.unsubscribe()}catch{}n.clear(),r.length=0,s=null}}var __={tileRefsMap:"Map tiles",tileRefsPlants:"Plants",tileRefsTallPlants:"Tall plants",tileRefsSeeds:"Seeds",tileRefsItems:"Items",tileRefsAnimations:"Animations",tileRefsPets:"Pets",tileRefsMutations:"Mutations",tileRefsDecor:"Decor"};function N_(t){let e=t.replace(/_/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return e?e.charAt(0).toUpperCase()+e.slice(1):t}function D_(t){let e=new Map;for(let{source:n,refs:r}of t.sources){let o=__[n]??n;for(let[s,a]of Object.entries(r)){if(typeof a!="number"||Number.isNaN(a))continue;let i=a>0?a-1:a,l={index:i,key:s,source:n,sourceLabel:o,qualifiedName:`${n}.${s}`,displayName:N_(s)},c=e.get(i);c?c.push(l):e.set(i,[l])}}return e}var q_=[{id:"plants-tall",label:"Tall plants",test:t=>t.includes("tall"),sources:[{source:"tileRefsTallPlants",refs:wt}]},{id:"plants",label:"Plants",test:t=>t.includes("plants"),sources:[{source:"tileRefsPlants",refs:Te}]},{id:"mutations",label:"Mutations",test:t=>t.includes("mutation"),sources:[{source:"tileRefsMutations",refs:tn}]},{id:"seeds",label:"Seeds",test:t=>t.includes("seed"),sources:[{source:"tileRefsSeeds",refs:je}]},{id:"items",label:"Items",test:t=>t.includes("item"),sources:[{source:"tileRefsItems",refs:uo}]},{id:"pets",label:"Pets",test:t=>t.includes("pet"),sources:[{source:"tileRefsPets",refs:pt}]},{id:"decor",label:"Decor",test:t=>t.includes("decor"),sources:[{source:"tileRefsDecor",refs:xe}]},{id:"animations",label:"Animations",test:t=>t.includes("anim"),sources:[{source:"tileRefsAnimations",refs:Si}]},{id:"map",label:"Map",test:t=>t.includes("map"),sources:[{source:"tileRefsMap",refs:ey}]}],Xm=q_.map(t=>({...t,entries:D_(t)})),Zm=new Map;for(let t of Xm)for(let{source:e}of t.sources){let n=Zm.get(e);n?n.push(t):Zm.set(e,[t])}var O_=(()=>{let t=new Map;for(let e of Xm)for(let[n,r]of e.entries){let o=t.get(n);o?o.push(...r):t.set(n,[...r])}return t})();function F_(t){return t.toLowerCase()}function cx(t,e){let n=F_(t);for(let o of Xm){if(!o.test(n))continue;let s=o.entries.get(e);if(s?.length)return{sheetId:o.id,sheetLabel:o.label,entries:[...s]}}let r=O_.get(e);if(r?.length===1){let o=r[0],s=Zm.get(o.source);if(!s||s.some(a=>a.test(n)))return{sheetId:o.source,sheetLabel:o.sourceLabel,entries:[...r]}}return null}var B_=["None","Gold","Rainbow"],H_=["None","Wet","Chilled","Frozen"];function Dn(t){let e=t.split(/[?#]/)[0];return(e.split("/").filter(Boolean).pop()??e).replace(/\.[a-z0-9]+$/i,"")}function dx(t,e){let n=Dn(e),r=(t||"").toLowerCase();if(r==="tiles")return n;if(r==="cosmetics")return n.split("_")[0]||n;try{let s=e.split(/[?#]/)[0].replace(/^https?:\/\/[^/]+\//,"").split("/").filter(Boolean);if(s.length>=2)return s[1].split(".")[0]||n}catch{}return n}var W_="expression",z_=/\/cosmetics\/mid_defaultblack\.png(?:$|\?)/i;function G_(t){return(t??"").toLowerCase()===W_}function j_(t){return t.find(e=>z_.test(e.split(/[?#]/)[0]))??null}function K_(t){let e=Dn(t);return e.replace(/^Mid_DefaultBlack[_-]?/i,"").replace(/_/g," ").trim()||e}async function U_(t){let e=await fetch(t,{credentials:"include"});if(!e.ok)throw new Error(`Failed to load image ${t}: ${e.status}`);let n=await e.blob(),r=URL.createObjectURL(n);try{return await new Promise((o,s)=>{let a=new Image;a.onload=()=>{URL.revokeObjectURL(r),o(a)},a.onerror=i=>{URL.revokeObjectURL(r),s(i)},a.src=r})}catch(o){throw URL.revokeObjectURL(r),o}}function V_(t){let e=document.createElement("canvas");e.width=t.width,e.height=t.height;let n=e.getContext("2d");if(!n)throw new Error("Failed to get 2D context for expression canvas");return n.imageSmoothingEnabled=!1,n.drawImage(t,0,0),e}async function ux(t){try{let e=await U_(t);return V_(e)}catch(e){return console.error("[Sprites] Failed to load canvas for expression asset",{url:t,error:e}),null}}function Y_(t,e){let n=t?.width??e?.width??1,r=t?.height??e?.height??1,o=document.createElement("canvas");o.width=n,o.height=r;let s=o.getContext("2d");if(!s)throw new Error("Failed to get 2D context when blending canvases");return s.imageSmoothingEnabled=!1,t?s.drawImage(t,0,0,n,r):e&&s.drawImage(e,0,0,n,r),e&&s.drawImage(e,0,0,n,r),o}function mx(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Tr(t),o=e.card("Sprite Explorer",{tone:"muted",subtitle:"Browse captured assets by manifest family."});n.appendChild(o.root);let s=e.card("Assets",{tone:"muted",subtitle:"Click an entry to open the file in a new tab."});r.appendChild(s.root);let a=["all",...Array.from(new Set(Ie.listFamilies().filter(Boolean))).sort()],i="all",l="all",c=new Map,d=e.select({width:"100%"});a.forEach(M=>{let K=document.createElement("option");K.value=M,K.textContent=M==="all"?"All families":M,d.appendChild(K)}),d.value=i;let u=e.select({width:"100%"});u.disabled=!0;let y=document.createElement("div");y.className="dd-sprite-control-grid",y.append(px("Asset family",d),px("Asset category",u)),o.body.appendChild(y);let h=document.createElement("div");h.className="dd-sprite-filter-panel",o.body.appendChild(h);let f=document.createElement("div"),p=document.createElement("div"),m=document.createElement("div");h.append(f,p,m);let g=B_,S=Nr,w=H_.map(M=>({value:M,label:M==="None"?"None":S[M]??M})),x=[{id:"None",key:"None",label:"None"},{id:"Dawnlit",key:"Dawnlit",label:S.Dawnlit??"Dawnlit"},{id:"Ambershine",key:"Amberlit",label:S.Amberlit??"Amberlit"},{id:"Dawncharged",key:"Dawnbound",label:S.Dawnbound??"Dawnbound"},{id:"Ambercharged",key:"Amberbound",label:S.Amberbound??"Amberbound"}],E=x.map(M=>({value:M.id,label:M.label})),T="None",A="None",N="None",H="None",C=M=>i==="tiles"&&l.toLowerCase().includes(M),L=(M,K,$,Q,se)=>{M.innerHTML="";let O=document.createElement("span");O.className="dd-sprite-filter-label",O.textContent=K;let U=document.createElement("div");U.className="dd-sprite-segmented",$.forEach(({value:ue,label:oe})=>{let ae=document.createElement("button");ae.type="button",ae.className="dd-sprite-seg-btn",ae.textContent=oe,ue===Q&&ae.classList.add("is-active"),ae.addEventListener("click",()=>{se(ue),D(),z()}),U.append(ae)}),M.append(O,U)},v=null,B=[],le=!1,X=[],de=null,_=Q_(),re=(M,K=F())=>{let $=M;for(let Q of K){let se=Ie.applyCanvasFilter($,Q);se&&($=se)}return $},R=e.card("Export",{tone:"muted",subtitle:"Download the assets currently visible in the explorer."});n.appendChild(R.root);let k=e.btn("Export visible assets",{variant:"primary",icon:"\u2B07",onClick:b}),V=document.createElement("span");V.className="dd-sprite-stats",V.textContent="Select assets to export.";let ee=document.createElement("div");ee.className="dd-sprite-export-progress";let ie=document.createElement("div");ie.className="dd-sprite-export-progress__bar",ee.append(ie),R.body.append(k,V,ee);let fe=!1,G=M=>{ie.style.width=`${M}%`,ee.style.opacity=M>0&&M<100?"1":"0"},Z=()=>{let M=i==="all"?"all":i||"assets",K=l&&l!=="all"?`-${l}`:"";return`${M}${K}`.replace(/[^a-z0-9_-]+/gi,"_")||"assets"},j=()=>{if(le){V.textContent=B.length?`${B.length} tiles ready to export.`:"Load a tilesheet to export.";return}if(X.length){V.textContent=`${X.length} assets ready to download.`;return}V.textContent="Select assets to export."};function Y(M,K){let $=document.createElement("a");$.href=URL.createObjectURL(M),$.download=K,document.body.appendChild($),$.click(),$.remove(),setTimeout(()=>URL.revokeObjectURL($.href),1e4)}async function ne(M,K){let $=await new Promise((Q,se)=>{M.toBlob(O=>{if(!O){se(new Error("canvas.toBlob returned null"));return}Q(O)},"image/png")});Y($,K)}async function q(M){let{previewArea:K,expressionUrls:$,baseUrl:Q,baseCanvas:se}=M;K.innerHTML="",K.classList.remove("dd-sprite-grid--tiles");let O=document.createElement("div");if(O.className="dd-sprite-grid__item",se||Q){let ae=document.createElement("img");ae.className="dd-sprite-grid__img",ae.alt="Mid Default Black base",ae.loading="lazy",ae.referrerPolicy="no-referrer",ae.src=se?se.toDataURL():Q,O.appendChild(ae)}let U=document.createElement("span");U.className="dd-sprite-grid__name",U.textContent="Mid Default Black (base)";let ue=document.createElement("span");if(ue.className="dd-sprite-grid__meta",ue.textContent=Q??"Base asset missing (Mid_DefaultBlack)",O.append(U,ue),K.appendChild(O),!$.length){let ae=document.createElement("div");ae.className="dd-sprite-grid__empty",ae.textContent="No expression assets recorded yet.",K.appendChild(ae);return}let oe=await Promise.all($.map(async ae=>({url:ae,overlayCanvas:await ux(ae)})));for(let{url:ae,overlayCanvas:ye}of oe){let he=K_(ae);if(!ye){let Ve=document.createElement("div");Ve.className="dd-sprite-grid__item";let ot=document.createElement("span");ot.className="dd-sprite-grid__name",ot.textContent=`${he} (failed to render)`;let vt=document.createElement("span");vt.className="dd-sprite-grid__meta",vt.textContent=ae,Ve.append(ot,vt),K.appendChild(Ve);continue}let ve=Y_(se,ye),Ee=document.createElement("a");Ee.className="dd-sprite-grid__item",Ee.href=ae,Ee.target="_blank",Ee.rel="noopener noreferrer";let Ne=document.createElement("img");Ne.className="dd-sprite-grid__img",Ne.src=ve.toDataURL(),Ne.alt=he,Ne.loading="lazy",Ne.referrerPolicy="no-referrer";let He=document.createElement("span");He.className="dd-sprite-grid__name",He.textContent=he;let ze=document.createElement("span");ze.className="dd-sprite-grid__meta",ze.textContent=ae,Ee.append(Ne,He,ze),Ee.addEventListener("click",Ve=>{Ve.preventDefault(),Ve.stopPropagation(),ne(ye??ve,`${Dn(ae)}.png`)}),K.appendChild(Ee)}}async function W(M){try{let K=await fetch(M,{credentials:"include"});if(!K.ok)throw new Error(`HTTP ${K.status}`);let $=await K.blob(),Q=Dn(M);/\.[a-z0-9]+$/i.test(Q)||(Q+=".png"),Y($,Q)}catch(K){console.error("[Sprites] Asset download failed",{url:M,error:K})}}async function b(){if(fe)return;let M=le&&!!v&&B.length>0,K=X.length>0;if(!M&&!K){G(0),V.textContent="Select assets to export.";return}fe=!0,k.disabled=!0,G(0),V.textContent="Preparing export...";try{if(M){let $=Co(v),Q=F();await Ie.exportFilteredTileset({tiles:B,filters:Q,baseName:$,onProgress:(se,O)=>{let U=O?Math.round(se/O*100):0;G(U),V.textContent=`Processing ${se}/${O} tiles`}})}else{let $=Z();await Ie.exportAssets({urls:X,baseName:$,onProgress:(Q,se)=>{let O=se?Math.round(Q/se*100):0;G(O),V.textContent=`Processing ${Q}/${se} assets`}})}G(100),V.textContent="Export ready \u2014 check your downloads.",setTimeout(()=>G(0),1e3)}catch($){console.error("[Sprites] Export failed",$),V.textContent="Export failed (see console).",G(0)}finally{fe=!1,k.disabled=!1}}let D=()=>{let M=C("plant")||C("pet"),K=C("plant"),$=C("plant");h.style.display=M?"":"none",f.style.display=M?"":"none",p.style.display=K?"":"none",m.style.display=$?"":"none",L(f,"Color",g.map(Q=>({value:Q,label:Q})),T,Q=>{T=Q}),L(p,"Weather",w,A,Q=>{A=Q}),L(m,"Lighting",E,N,Q=>{N=Q,H=x.find(se=>se.id===Q)?.key??Q})},F=()=>{let M=[];return T!=="None"&&M.push(T),T==="Gold"||T==="Rainbow"||C("plant")&&(A!=="None"&&M.push(A),N!=="None"&&M.push(N)),M};D();let P=document.createElement("p");P.className="dd-sprite-stats",P.textContent="Select a family to inspect its assets.",o.body.appendChild(P);let I=document.createElement("div");I.className="dd-sprite-grid",s.body.appendChild(I);let J=M=>{if(!c.has(M)){let K=Ie.listAssetsForFamily(M),$=Array.from(new Set(K.map(Q=>dx(M,Q))));$.sort(),c.set(M,$)}return c.get(M)??[]},te=()=>{if(i==="all"){u.innerHTML="";let Q=document.createElement("option");Q.value="all",Q.textContent="All categories",u.appendChild(Q),u.value="all",u.disabled=!0,l="all";return}if(!(i==="tiles"||i==="cosmetics")){u.innerHTML="";let Q=document.createElement("option");Q.value="all",Q.textContent="All categories",u.appendChild(Q),u.value="all",u.disabled=!0,l="all";return}let K=J(i);u.innerHTML="";let $=document.createElement("option");$.value="all",$.textContent="All categories",u.appendChild($),K.forEach(Q=>{let se=document.createElement("option");se.value=Q,se.textContent=Q,u.appendChild(se)}),K.length?(u.disabled=!1,l=K.includes(l)?l:"all",u.value=l):(u.disabled=!0,l="all")},z=async()=>{let M=F(),K=i==="all"?Ie.lists().all:Ie.listAssetsForFamily(i),$=K;i!=="all"&&l!=="all"&&($=$.filter(ae=>dx(i,ae)===l)),X=$,I.innerHTML="";let Q=null,se=i==="tiles"&&l!=="all"&&$.length>0;if(I.classList.toggle("dd-sprite-grid--tiles",se),v=null,B=[],le=se,i==="cosmetics"&&G_(l)){let ae=j_(K),ye=ae?await ux(ae):null;le=!1,v=null,B=[],I.classList.remove("dd-sprite-grid--tiles"),await q({previewArea:I,expressionUrls:$,baseUrl:ae,baseCanvas:ye});let he=ae?Dn(ae):"Mid Default Black";P.textContent=`${$.length} expression overlays on ${he}`,j();return}if(se){let ae=$[0],ye=Co(ae),he=await kt(ye);if(v=ae,B=he,Q=he.length,he.length)he.forEach(ve=>{let Ee=document.createElement("a");Ee.className="dd-sprite-grid__item",Ee.href=ae,Ee.target="_blank",Ee.rel="noopener noreferrer";let Ne=Ie.toCanvas(ve),He=cx(ve.sheet,ve.index),ze=He?.sheetId==="plants",Ve=re(Ne,M);if(ze&&M.length&&de&&Object.keys(de).length>0){let Kt=[];T!=="None"&&Kt.push(T),A!=="None"&&Kt.push(A),N!=="None"&&Kt.push(N);let ge=Ie.renderPlantWithMutationsNonTall({baseTile:ve,mutations:Kt,mutationIcons:de});ge&&(Ve=ge)}Ve.className="dd-sprite-grid__img";let ot=document.createElement("span");ot.className="dd-sprite-grid__name";let vt=He?.entries.map(Kt=>Kt.displayName).filter(Boolean);vt&&vt.length?ot.textContent=vt.join(", "):ot.textContent=`${Dn(ve.url)} #${ve.index+1}`;let dt=document.createElement("span");dt.className="dd-sprite-grid__meta";let Ct=He?.sheetLabel??ve.sheet;dt.textContent=`${Ct} (${ve.col},${ve.row})`,Ee.append(Ve,ot,dt),Ee.addEventListener("click",Kt=>{Kt.preventDefault(),Kt.stopPropagation();let Le=`${He?.sheetLabel??Dn(ve.url)}_#${String(ve.index+1).padStart(3,"0")}.png`;ne(Ve,Le)}),I.appendChild(Ee)});else{let ve=document.createElement("div");ve.className="dd-sprite-grid__empty",ve.textContent=`No tiles could be sliced for ${Dn(ae)} yet.`,I.appendChild(ve)}}else if($.length)$.forEach(ae=>{let ye=document.createElement("a");ye.className="dd-sprite-grid__item",ye.href=ae,ye.target="_blank",ye.rel="noopener noreferrer";let he=document.createElement("img");he.className="dd-sprite-grid__img",he.src=ae,he.alt=Dn(ae),he.loading="lazy",he.referrerPolicy="no-referrer";let ve=document.createElement("span");ve.className="dd-sprite-grid__name",ve.textContent=Dn(ae);let Ee=document.createElement("span");Ee.className="dd-sprite-grid__meta",Ee.textContent=ae,ye.append(he,ve,Ee),I.appendChild(ye),ye.addEventListener("click",Ne=>{Ne.preventDefault(),Ne.stopPropagation(),W(ae)})});else{let ae=document.createElement("div");ae.className="dd-sprite-grid__empty",ae.textContent="No assets recorded for this selection yet.",I.appendChild(ae)}let U=i==="all"?"all families":`family "${i}" (${K.length})`,ue=i==="all"||l==="all"?"all categories":`category "${l}"`,oe=Q!==null?`${Q} tiles`:`${$.length} assets`;P.textContent=`${oe} \xB7 ${U} \xB7 ${ue}`,j()};d.addEventListener("change",()=>{i=d.value||"all",l="all",T="None",A="None",N="None",te(),D(),z()}),u.addEventListener("change",()=>{l=u.value||"all",T="None",A="None",N="None",D(),z()}),te(),z(),_.then(M=>{de=M}).catch(()=>{de={}}).finally(()=>{z()})}function px(t,e){let n=document.createElement("label");n.className="dd-sprite-control";let r=document.createElement("span");return r.className="dd-sprite-control__label",r.textContent=t,n.append(r,e),n}async function Q_(){let t={},e=await kt("mutations"),n={Wet:"Wet",Chilled:"Chilled",Frozen:"Frozen",Dawnlit:"Dawnlit",Amberlit:"Ambershine",Dawnbound:"Dawncharged",Amberbound:"Ambercharged"};for(let[r,o]of Object.entries(tn)){if(typeof o!="number")continue;let s=o>0?o-1:o,a=e.find(l=>l.index===s);if(!a)continue;t[r]={tile:a};let i=n[r];i&&(t[i]={tile:a})}return console.debug("[Sprites] mutationIcons loaded",{keys:Object.keys(t)}),t}function fx(t,e){if(typeof t.__ws_cleanup__=="function")try{t.__ws_cleanup__()}catch{}t.innerHTML="",t.classList.add("dd-debug-view");let n=new rd(2e3),r=new Map,o=0,s=!1,a=!0,i=!0,l=!0,c="",d=!1,u=!1,y=null,h=[],f=Q=>{if(y=Q,[...ee.querySelectorAll("[data-fid]")].forEach(se=>{se.classList.toggle("selected",String(Q||"")===se.dataset.fid)}),Q!=null){let se=r.get(Q);se&&(fe.value=se.text)}},p=Q=>h.some(se=>se.test(Q)),m=e.card("\u{1F4E1} Live traffic",{tone:"muted",subtitle:"Monitor, filter, and replay WebSocket frames."});t.appendChild(m.root);let g=e.card("\u{1F649} Mutes (regex)",{tone:"muted",subtitle:"Hide unwanted messages."});t.appendChild(g.root);let S=e.card("\u{1F9FE} Frame log",{tone:"muted"});t.appendChild(S.root);let w=e.card("\u{1F4E4} Send a frame",{tone:"muted",subtitle:"Pick or compose a payload and send it."});t.appendChild(w.root);let x=document.createElement("div");x.className="dd-toolbar dd-toolbar--stretch",m.body.appendChild(x);let E=document.createElement("span");E.className="dd-status-chip";let T=e.select({width:"220px"}),A=e.btn("Pause",{variant:"secondary",onClick:()=>{s=!s,N(s?"Resume":"Pause"),A.classList.toggle("active",s),A.title=s?"Resume live updates":"Pause live updates"}}),N=Q=>{let se=A.querySelector(".label");se?se.textContent=Q:A.textContent=Q};N("Pause"),A.title="Suspend live updates";let H=e.btn("Clear",{variant:"ghost",icon:"\u{1F9F9}",onClick:()=>{n.clear(),r.clear(),f(null),te(!0)}}),C=e.btn("Copy visible",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>z()});x.append(E,T,A,H,C);let L=document.createElement("div");L.className="dd-toolbar dd-toolbar--stretch",m.body.appendChild(L);let v=e.inputText("filter text (case-insensitive)","");v.classList.add("dd-grow"),v.addEventListener("input",()=>{c=v.value.trim().toLowerCase(),te(!0)});let B=e.toggleChip("IN",{checked:!0,icon:"\u2190",tooltip:"Show incoming messages"});B.input.addEventListener("change",()=>{i=B.input.checked,te(!0)});let le=e.toggleChip("OUT",{checked:!0,icon:"\u2192",tooltip:"Show outgoing messages"});le.input.addEventListener("change",()=>{l=le.input.checked,te(!0)});let X=e.toggleChip("Active socket",{checked:!1,icon:"\u{1F3AF}",tooltip:"Limit to the selected socket"});X.input.addEventListener("change",()=>{d=X.input.checked,te(!0)});let de=e.toggleChip("Auto-scroll",{checked:!0,icon:"\u{1F4DC}",tooltip:"Keep the log aligned with the latest frames"});de.input.addEventListener("change",()=>{a=de.input.checked}),L.append(v,B.root,le.root,X.root,de.root);let _=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),re=e.inputText("add regex (e.g. ping|keepalive)","");re.classList.add("dd-grow");let R=e.btn("Add",{icon:"\u2795",onClick:()=>{let Q=re.value.trim();if(Q)try{h.push(new RegExp(Q,"i")),re.value="",V(),te(!0)}catch{}}});_.append(re,R),g.body.appendChild(_);let k=document.createElement("div");k.className="dd-mute-chips",g.body.appendChild(k);function V(){k.innerHTML="",h.forEach((Q,se)=>{let O=e.btn(`/${Q.source}/i \xD7`,{variant:"ghost",size:"sm",onClick:()=>{h.splice(se,1),V(),te(!0)}});k.appendChild(O)})}let ee=document.createElement("div");ee.className="dd-log",ee.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",ee.style.fontSize="12px",ee.style.lineHeight="1.4",ee.style.userSelect="text";let ie=document.createElement("div");ie.className="dd-log__empty",ie.textContent="No frames visible yet.",ee.appendChild(ie),S.body.appendChild(ee);let fe=document.createElement("textarea");fe.className="qmm-input dd-textarea",fe.placeholder="Select a frame or paste a payload here. Choose Text or JSON below.";let G=document.createElement("div");G.className="dd-send-controls";let Z=e.radioGroup("ws-send-mode",[{value:"text",label:"Text"},{value:"json",label:"JSON"}],"text",()=>{}),j=e.toggleChip("Use source WS",{checked:!1,icon:"\u21A9"});j.input.addEventListener("change",()=>{u=j.input.checked});let Y=e.btn("Send",{variant:"primary",icon:"\u{1F4E8}",onClick:()=>K()}),ne=e.btn("Copy payload",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>jt(fe.value)});G.append(Z,j.root,Y,ne),w.body.append(fe,G);function q(){let Q=$m();T.innerHTML="",Q.forEach((se,O)=>{let U=document.createElement("option");U.value=String(O),U.textContent=se.id+(se.ws===Bn?" \u2022 page":""),T.appendChild(U)}),!T.value&&T.options.length&&(T.value="0"),b()}function W(){let Q=Number(T.value),se=$m();return Number.isFinite(Q)?se[Q]?.ws??null:null}function b(){let Q=ax();E.textContent=Q;let se=Q.toLowerCase();E.classList.toggle("is-ok",/open|connected|ready/.test(se)),E.classList.toggle("is-warn",/closing|connecting|pending/.test(se))}function D(){let Q=ee.querySelector(".ws-row")!=null;ie.style.display=Q?"none":""}function F(Q){return!(Q.dir==="in"&&!i||Q.dir==="out"&&!l||c&&!Q.text.toLowerCase().includes(c)||d&&Q.ws&&W()&&Q.ws!==W()||p(Q.text))}function P(Q,se){let O=document.createElement("div");O.className="acts";let U=document.createElement("button");U.className="qmm-btn",U.textContent="Copy",U.onclick=ae=>{ae.stopPropagation(),jt(se.text)};let ue=document.createElement("button");ue.className="qmm-btn",ue.textContent="\u2192 Editor",ue.onclick=ae=>{ae.stopPropagation(),fe.value=se.text,f(Q)};let oe=document.createElement("button");return oe.className="qmm-btn",oe.textContent="Replay",oe.title="Send right away (to current WS or source WS if enabled)",oe.onclick=ae=>{ae.stopPropagation(),M(se)},O.append(U,ue,oe),O}function I(Q){let se=document.createElement("div");se.className="ws-row",se.dataset.fid=String(Q.id);let O=document.createElement("div");O.className="ts",O.textContent=Ir(Q.t);let U=document.createElement("div");U.className="arrow",U.textContent=Q.dir==="in"?"\u2190":"\u2192",U.style.color=Q.dir==="in"?"#4bd17a":"#8ab4ff";let ue=document.createElement("div");ue.className="body",ue.innerHTML=`<code>${sx(Q.text)}</code>`;let oe=P(Q.id,Q);return se.append(O,U,ue,oe),se.onclick=()=>f(Q.id),se.ondblclick=()=>{fe.value=Q.text,f(Q.id)},se}function J(Q){if(!F(Q))return;let se=I(Q);ee.appendChild(se),D(),a&&(ee.scrollTop=ee.scrollHeight)}function te(Q=!1){ee.querySelectorAll(".ws-row").forEach(se=>se.remove()),n.toArray().forEach(se=>{F(se)&&ee.appendChild(I(se))}),D(),y!=null&&f(y),a&&(ee.scrollTop=ee.scrollHeight)}function z(){let Q=n.toArray().filter(se=>F(se)).map(se=>`[${Ir(se.t)}] ${se.dir==="in"?"<-":"->"} ${se.text}`).join(`
`);jt(Q)}function M(Q){let se=u&&Q.ws?Q.ws:W();if(!se||se.readyState!==WebSocket.OPEN)return;if((Z.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{se.send(JSON.parse(Q.text))}catch{se.send(Q.text)}else se.send(Q.text)}function K(){let Q=W(),se=y!=null&&u?r.get(y)?.ws??null:null,O=(u?se:Q)||Q;if(!O||O.readyState!==WebSocket.OPEN)return;if((Z.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{O.send(JSON.parse(fe.value))}catch{O.send(fe.value)}else O.send(fe.value)}ix(Q=>{if(s)return;let se={...Q,id:++o};n.push(se),r.set(se.id,se),b(),J(se)}),q(),te(!0);let $=window.setInterval(()=>{q()},1e3);t.__ws_cleanup__=()=>{window.clearInterval($)}}var yx=!1;function J_(){if(yx)return;yx=!0;let t=document.createElement("style");t.id="mg-debug-data-styles",t.textContent=`
  .dd-debug-view{display:flex;flex-direction:column;gap:16px;}
  .dd-debug-columns{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(320px,1fr));align-items:start;}
  @media (max-width:720px){.dd-debug-columns{grid-template-columns:minmax(0,1fr);}}
  .dd-debug-column{display:flex;flex-direction:column;gap:16px;min-width:0;}
  .dd-card-description{font-size:13px;opacity:.72;margin:0;}
  .dd-atom-list{display:flex;flex-direction:column;gap:4px;margin-top:8px;max-height:40vh;overflow:auto;padding-right:4px;}
  .dd-atom-list__item{display:flex;align-items:center;gap:8px;font-size:13px;padding:4px 6px;border-radius:8px;border:1px solid transparent;cursor:pointer;transition:background .12s ease,border-color .12s ease;}
  .dd-atom-list__item:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.1);}
  .dd-atom-list__checkbox{accent-color:#5c7eff;}
  .dd-atom-list__label{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .dd-status-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:999px;font-size:12px;font-weight:600;letter-spacing:.01em;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);color:#f5f7ff;}
  .dd-status-chip.is-ok{color:#49d389;background:rgba(73,211,137,.14);border-color:rgba(73,211,137,.32);}
  .dd-status-chip.is-warn{color:#ffb760;background:rgba(255,183,96,.12);border-color:rgba(255,183,96,.32);}
  .dd-toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
  .dd-toolbar--stretch{width:100%;}
  .dd-toolbar .qmm-input{min-width:160px;}
  .dd-toolbar .dd-grow{flex:1 1 220px;min-width:180px;}
  .dd-mute-chips{display:flex;flex-wrap:wrap;gap:6px;}
  .dd-log{position:relative;border:1px solid #ffffff18;border-radius:16px;background:#0b1016;padding:10px;max-height:48vh;overflow:auto;box-shadow:inset 0 1px 0 rgba(255,255,255,.04);}
  .dd-log__empty{padding:28px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-log .ws-row{position:relative;display:grid;grid-template-columns:96px 20px minmax(0,1fr);gap:10px;padding:8px 12px;border-radius:12px;border:1px solid transparent;transition:background .15s ease,border-color .15s ease;align-items:start;margin:2px 0;}
  .dd-log .ws-row .ts{opacity:.76;font-size:12px;}
  .dd-log .ws-row .arrow{font-weight:600;}
  .dd-log .ws-row .body{white-space:pre-wrap;word-break:break-word;}
  .dd-log .ws-row .body code{font-family:inherit;font-size:12px;color:#dbe4ff;}
  .dd-log .ws-row .acts{position:absolute;top:6px;right:8px;display:flex;gap:6px;padding:4px 6px;background:rgba(13,18,25,.94);border:1px solid rgba(255,255,255,.18);border-radius:8px;opacity:0;visibility:hidden;transition:opacity .12s ease;z-index:1;}
  .dd-log .ws-row .acts .qmm-btn{padding:2px 6px;font-size:11px;}
  .dd-log .ws-row:hover .acts{opacity:1;visibility:visible;}
  .dd-log .ws-row:hover{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.18);}
  .dd-log .ws-row.selected{background:rgba(92,126,255,.16);border-color:rgba(92,126,255,.42);}
  .dd-send-controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
  .dd-send-controls .qmm-radio-group{display:flex;gap:10px;}
  .dd-textarea{min-height:140px;}
  .dd-inline-note{font-size:12px;opacity:.7;}
  .dd-log-filter-group{display:flex;flex-wrap:wrap;gap:6px;align-items:center;}
  .dd-script-log{position:relative;border:1px solid #ffffff18;border-radius:16px;background:#0b1016;max-height:48vh;overflow:auto;box-shadow:inset 0 1px 0 rgba(255,255,255,.04);}
  .dd-script-log__empty{padding:28px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-script-log__row{display:grid;grid-template-columns:minmax(92px,96px) minmax(70px,90px) minmax(120px,160px) minmax(0,1fr);gap:12px;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.06);align-items:start;}
  .dd-script-log__row:last-child{border-bottom:none;}
  .dd-script-log__ts{font-size:12px;opacity:.7;font-family:var(--qmm-font-mono,monospace);}
  .dd-script-log__level{display:inline-flex;align-items:center;justify-content:center;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.03em;text-transform:uppercase;min-width:58px;}
  .dd-script-log__level.is-debug{background:rgba(138,180,255,.14);color:#8ab4ff;border:1px solid rgba(138,180,255,.32);}
  .dd-script-log__level.is-info{background:rgba(92,126,255,.14);color:#9fb6ff;border:1px solid rgba(92,126,255,.32);}
  .dd-script-log__level.is-warn{background:rgba(255,183,96,.12);color:#ffb760;border:1px solid rgba(255,183,96,.32);}
  .dd-script-log__level.is-error{background:rgba(255,108,132,.16);color:#ff6c84;border:1px solid rgba(255,108,132,.32);}
  .dd-script-log__source{font-size:12px;font-weight:600;opacity:.85;}
  .dd-script-log__context{display:block;font-size:11px;opacity:.6;margin-top:2px;text-transform:uppercase;letter-spacing:.05em;}
  .dd-script-log__message-wrap{display:flex;flex-direction:column;gap:6px;}
  .dd-script-log__message{font-size:13px;line-height:1.45;white-space:pre-wrap;word-break:break-word;}
  .dd-script-log__actions{display:flex;gap:6px;justify-content:flex-end;align-self:flex-end;}
  .dd-script-log__actions button{padding:2px 8px;font-size:11px;border-radius:8px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:inherit;cursor:pointer;transition:background .12s ease,border-color .12s ease;}
  .dd-script-log__actions button:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.28);}
  .dd-script-log__details{grid-column:1/-1;margin:4px 0 0;background:#05080c;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px;white-space:pre-wrap;font-family:var(--qmm-font-mono,monospace);font-size:12px;line-height:1.4;display:none;word-break:break-word;max-height:180px;overflow:auto;}
  .dd-script-log__row.is-open .dd-script-log__details{display:block;}
  .dd-log-source-chips{display:flex;flex-wrap:wrap;gap:6px;}
  .dd-log-toolbar-spacer{flex:1 1 auto;}
  .dd-audio-summary{display:grid;gap:4px;font-size:13px;}
  .dd-audio-summary strong{font-size:14px;}
  .dd-audio-volume{font-family:var(--qmm-font-mono,monospace);font-size:12px;opacity:.78;}
  .dd-audio-list{display:flex;flex-direction:column;gap:8px;margin-top:4px;max-height:48vh;overflow:auto;padding-right:4px;}
  .dd-audio-row{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-start;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(9,12,18,.72);}
  .dd-audio-row__info{flex:1 1 260px;min-width:0;display:flex;flex-direction:column;gap:6px;}
  .dd-audio-row__title{font-weight:600;font-size:13px;word-break:break-word;}
  .dd-audio-meta{font-size:12px;opacity:.72;display:flex;flex-wrap:wrap;gap:8px;}
  .dd-audio-url{font-family:var(--qmm-font-mono,monospace);font-size:11px;word-break:break-all;color:#d6dcffb3;}
  .dd-audio-actions{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto;}
  .dd-audio-empty{padding:24px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-sprite-controls{display:flex;flex-direction:column;gap:12px;}
  .dd-sprite-control-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));}
  .dd-sprite-control{display:flex;flex-direction:column;gap:4px;}
  .dd-sprite-control__label{font-size:11px;opacity:.72;text-transform:uppercase;letter-spacing:.08em;}
  .dd-sprite-control.is-hidden{display:none;}
  .dd-sprite-control .qmm-select{width:100%;}
  .dd-sprite-stats{font-size:12px;opacity:.72;margin-top:8px;}
  .dd-sprite-grid{display:grid;gap:12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);padding:12px;background:rgba(6,8,12,.8);max-height:62vh;min-height:360px;overflow:auto;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));}
  .dd-sprite-grid--tiles{grid-template-columns:repeat(3,minmax(0,1fr));}
  .dd-sprite-grid__item{display:flex;flex-direction:column;gap:6px;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,.05);background:rgba(255,255,255,.02);text-decoration:none;color:inherit;transition:background .12s ease,border-color .12s ease,transform .12s ease;}
  .dd-sprite-grid__item:hover{background:rgba(255,255,255,.04);border-color:rgba(255,255,255,.16);transform:translateY(-1px);}
  .dd-sprite-grid__item:focus-visible{outline:2px solid rgba(92,126,255,.5);}
  .dd-sprite-grid__img{width:100%;height:120px;object-fit:contain;background:#020407;border-radius:8px;border:1px solid rgba(255,255,255,.08);image-rendering:pixelated;}
  .dd-sprite-grid__name{font-weight:600;font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .dd-sprite-grid__meta{font-size:11px;opacity:.65;font-family:var(--qmm-font-mono,monospace);word-break:break-word;}
  .dd-sprite-grid__empty{text-align:center;font-size:13px;opacity:.65;padding:20px 0;}
  .dd-sprite-filter-panel{margin-top:16px;display:flex;flex-direction:column;gap:8px;}
  .dd-sprite-filter-row{display:flex;gap:6px;align-items:center;flex-wrap:wrap;}
  .dd-sprite-filter-row .dd-sprite-filter-label{font-size:11px;text-transform:uppercase;letter-spacing:0.1em;opacity:0.6;}
  .dd-sprite-segmented{display:flex;gap:4px;flex-wrap:wrap;}
  .dd-sprite-seg-btn{background:#111418;border:1px solid #29303a;border-radius:8px;padding:4px 10px;font-size:12px;color:#d2ddff;cursor:pointer;transition:background .12s ease,border .12s ease;}
  .dd-sprite-seg-btn.is-active{background:#3d58ff;border-color:#5d7cff;color:#fff;}
  .dd-sprite-export-progress{height:4px;width:100%;border-radius:999px;background:rgba(255,255,255,.06);overflow:hidden;transition:opacity .2s ease;opacity:0;}
  .dd-sprite-export-progress__bar{height:100%;width:0;background:linear-gradient(90deg,#44ffa4,#2ea3ff 35%,#ff7b9a);transition:width .25s ease;}
  `,document.head.appendChild(t)}async function gx(t){J_();let e=new Qe({id:"debug-tools",compact:!0});e.mount(t),e.addTab("jotai","Jotai",n=>ex(n,e)),e.addTab("atoms-live","Live atoms",n=>lx(n,e)),e.addTab("sprites","Sprites",n=>mx(n,e)),e.addTab("audio-player","Audio player",n=>Xw(n,e)),e.addTab("websocket","WebSocket",n=>fx(n,e))}var $_="https://raw.githubusercontent.com/Ariedam64/MagicGarden-modMenu/refs/heads/main/rooms.json";function bx(){if(typeof GM_xmlhttpRequest=="function")return GM_xmlhttpRequest;if(typeof GM<"u"&&typeof GM.xmlHttpRequest=="function")return GM.xmlHttpRequest.bind(GM)}async function Z_(t,e){let n=await fetch(t,{cache:"no-store",...e});if(!n.ok)throw new Error(`Failed to load remote resource: ${n.status} ${n.statusText}`);return await n.text()}async function hx(t,e){let n=bx();if(!n)throw new Error("GM_xmlhttpRequest not available");return await new Promise((r,o)=>{n({method:"GET",url:t,headers:e?.headers,onload:s=>{s.status>=200&&s.status<300?r(s.responseText??""):o(new Error(`GM_xmlhttpRequest failed: ${s.status}`))},onerror:s=>{o(new Error(s.error??"GM_xmlhttpRequest error"))},ontimeout:()=>o(new Error("GM_xmlhttpRequest timeout")),onabort:()=>o(new Error("GM_xmlhttpRequest aborted"))})})}async function X_(t,e){let n=sr(),r=!!bx();if(n&&r)return await hx(t,e);try{return await Z_(t,e)}catch(o){if(r)return await hx(t,e);throw o}}async function Sx(){let t=await X_($_);try{return JSON.parse(t)}catch(e){throw new Error("Failed to parse rooms JSON",{cause:e})}}var tf=6;function xx(t){let e=/^([a-zA-Z]+)/.exec(t);return e&&e[1]?e[1].toLowerCase():"other"}function eN(t,e=[]){let n=new Set(t.map(s=>s.category)),r=new Set,o=[];for(let s of e)n.has(s)&&(r.has(s)||(r.add(s),o.push(s)));for(let s of t)r.has(s.category)||(r.add(s.category),o.push(s.category));return o}function Ex(t,e=[]){let n=t.map(r=>({...r}));return{definitions:n,categoryOrder:eN(n,e)}}function Cx(t){return{definitions:t.definitions.map(e=>({...e})),categoryOrder:[...t.categoryOrder]}}var tN=Ex([]),sd=Cx(tN),as="idle",ef=null;function nN(t){if(!t||typeof t!="object")return null;let e=t.publicRooms;if(!e||typeof e!="object")return null;let n=[],r=[];for(let[o,s]of Object.entries(e)){if(!Array.isArray(s)||!s.length)continue;let a=typeof o=="string"?o.trim():"";if(a){r.includes(a)||r.push(a);for(let i of s){if(typeof i!="string")continue;let l=i.indexOf(":");if(l<=0)continue;let c=i.slice(0,l).trim(),d=i.slice(l+1).trim();!c||!d||n.push({name:c,idRoom:d,category:a})}}}return n.length?Ex(n,r):null}function rN(t){sd=Cx(t)}function nf(){return as==="pending"||as==="fulfilled"||as==="rejected"?ef:typeof window>"u"?null:(as="pending",ef=(async()=>{try{let t=await Sx(),e=nN(t);e&&rN(e),as="fulfilled"}catch(t){as="rejected",console.warn("[MagicGarden] Unable to load remote rooms list",t)}})(),ef)}async function oN(){let t=nf();t&&await t}function sN(t){if(!t)return null;let e=typeof t.name=="string"?t.name.trim():"",n=typeof t.idRoom=="string"?t.idRoom.trim():"";return!e||!n?null:{name:e,idRoom:n,category:xx(e)}}function aN(){let t=_e("room.customRooms")??[];if(!Array.isArray(t))return[];let e=[];for(let n of t){let r=sN(n);r&&e.push(r)}return e}function iN(t){let e=t.map(n=>({name:n.name,idRoom:n.idRoom}));Oe("room.customRooms",e)}var Ya=null;function od(){return Ya||(Ya=aN()),Ya.map(t=>({...t}))}function vx(t){Ya=t.map(e=>({...e})),iN(Ya)}function is(t){return t.trim().toLowerCase()}function wx(t){let e=Date.now();return Promise.all(t.map(async n=>{try{let r=await by(n.idRoom,{endpoint:"info",timeoutMs:1e4});if(!r.ok)throw new Error(`HTTP ${r.status}`);let o=r.parsed??(()=>{try{return JSON.parse(r.body)}catch{return}})(),s=lN(typeof o?.numPlayers=="number"?o.numPlayers:0),a=tf,i=typeof o?.currentGame=="string"&&o.currentGame.trim().length?o.currentGame.trim():void 0,l=typeof o?.hostPlayerId=="string"&&o.hostPlayerId.trim().length?o.hostPlayerId.trim():void 0,c=cN(o?.players,l);return{...n,players:s,capacity:a,isFull:s>=a,lastUpdatedAt:e,currentGame:i,hostPlayerId:l,playerDetails:c}}catch(r){let o=dN(r);return{...n,players:0,capacity:tf,isFull:!1,lastUpdatedAt:e,hostPlayerId:void 0,playerDetails:[],error:o}}}))}function lN(t){return Number.isFinite(t)?Math.max(0,Math.min(tf,Math.floor(t))):0}function cN(t,e){if(!Array.isArray(t))return[];let n=[];for(let r of t){if(!r||typeof r!="object")continue;let o=typeof r.id=="string"&&r.id.trim().length?r.id.trim():void 0,s=typeof r.databaseUserId=="string"&&r.databaseUserId.trim().length?r.databaseUserId.trim():void 0,i=(typeof r.name=="string"?r.name.trim():"")||"Unknown player",l=typeof r.isConnected=="boolean"?r.isConnected:!1,c=typeof r.discordAvatarUrl=="string"&&r.discordAvatarUrl.trim().length?r.discordAvatarUrl.trim():void 0;n.push({id:o,databaseUserId:s,name:i,isConnected:l,discordAvatarUrl:c,isHost:!!(e&&(o===e||s===e))})}return n}function dN(t){if(!t)return"Erreur inconnue.";if(typeof t=="string")return t;if(t instanceof Error)return t.message||"Erreur inconnue.";try{return JSON.stringify(t)}catch{return String(t)}}var Zn={getPublicRooms(){return nf(),sd.definitions.map(t=>({...t}))},getPublicRoomsCategoryOrder(){return nf(),[...sd.categoryOrder]},getCustomRooms(){return od()},addCustomRoom(t){let e=typeof t.name=="string"?t.name.trim():"",n=typeof t.idRoom=="string"?t.idRoom.trim():"";if(!e)return{ok:!1,error:"Room name is required."};if(!n)return{ok:!1,error:"Room identifier is required."};let r=is(e),o=is(n),s=[...this.getPublicRooms(),...od()];if(s.some(l=>is(l.idRoom)===o))return{ok:!1,error:"This room already exists."};if(s.some(l=>is(l.name)===r))return{ok:!1,error:"A room with this name already exists."};let a={name:e,idRoom:n,category:xx(e)},i=[...od(),a];return vx(i),{ok:!0,room:{...a}}},removeCustomRoom(t){let e=is(t),n=od(),r=n.filter(o=>is(o.idRoom)!==e);return r.length===n.length?!1:(vx(r),!0)},async fetchPublicRoomsStatus(){await oN();let t=sd.definitions.map(e=>({...e}));return wx(t)},async fetchCustomRoomsStatus(){let t=this.getCustomRooms();return t.length?wx(t):[]},canJoinPublicRoom(t){return!(t.error||t.isFull||this.isDiscordActivity())},isDiscordActivity(){return sr()},joinPublicRoom(t){let e=vy(t.idRoom,{siteFallbackOnDiscord:!0,preferSoft:!1});return e.ok,e}};var ls=null;async function ad(t){if(!ls)return;let e=window.qwsEditorClearFriendGardenPreview;if(typeof e=="function")try{await e()}catch(r){console.error("[FriendsMenu] clear garden preview",r)}let n=ls.button;if(!t||t!==n){let r=n.dataset.gardenDefaultLabel??"Garden";n.textContent=r}ls=null}var Qa=null;function uN(t){if(!t)return null;let e=Date.parse(t);if(!Number.isFinite(e))return null;let n=Math.max(0,Math.floor((Date.now()-e)/1e3));if(n<60)return n<=15?"just now":`${n}s`;let r=Math.floor(n/60);if(r<60)return`${r}min`;let o=Math.floor(r/60);return o<24?`${o}h`:`${Math.floor(o/24)}d`}function pN(t){if(t==null||!Number.isFinite(t))return null;let e=Math.abs(t),n=[{threshold:1e12,suffix:"T"},{threshold:1e9,suffix:"B"},{threshold:1e6,suffix:"M"},{threshold:1e3,suffix:"K"}];for(let{threshold:r,suffix:o}of n)if(e>=r)return`${(t/r).toFixed(2)}${o}`;return t.toLocaleString("en-US")}function mN(t,e){let n=document.createElement("span");return n.textContent=t,n.style.fontSize="16px",n.style.lineHeight="1",n.style.opacity=e?"1":"0.3",n.style.display="inline-flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.width="auto",n.style.height="auto",n.style.fontWeight="500",n}function fN(t,e){let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="1fr",n.style.alignItems="stretch",n.style.gap="8px",n.style.padding="10px 12px",n.style.borderRadius="10px",n.style.border="1px solid rgba(255, 255, 255, 0.08)",n.style.background="rgba(255, 255, 255, 0.02)",n.style.boxShadow="0 1px 0 rgba(0, 0, 0, 0.35) inset",n.style.cursor="default";let r=e.room??{},o=typeof r.id=="string"?r.id.trim():typeof r.roomId=="string"?r.roomId.trim():null,s=r.playersCount??r.players_count??r.players??null,a=Number.isFinite(Number(s))&&s!==null?Math.floor(Number(s)):null,i=Zn.isDiscordActivity(),c=typeof a=="number"?Math.max(0,6-a):null,d=!!o&&typeof a=="number"&&c!==null&&c>0&&!i,u=d?"Join this room":i?"Joining rooms is disabled on Discord":a!==null&&a>=6?"Room is full":"Unable to join this room",y=document.createElement("div");if(y.style.width="48px",y.style.height="48px",y.style.display="grid",y.style.placeItems="center",y.style.borderRadius="50%",y.style.background="rgba(255, 255, 255, 0.07)",y.style.fontWeight="600",y.style.fontSize="14px",y.style.color="#f8fafc",y.style.overflow="hidden",e.avatarUrl){let q=document.createElement("img");q.src=e.avatarUrl,q.alt=e.playerName??e.playerId??"Friend avatar",q.width=48,q.height=48,q.style.borderRadius="50%",q.style.objectFit="cover",y.appendChild(q)}else{let q=document.createElement("span"),W=(e.playerName??e.playerId??"F").trim();q.textContent=W.charAt(0).toUpperCase(),q.style.fontSize="15px",y.appendChild(q)}let h=document.createElement("div");h.style.display="grid",h.style.gridTemplateColumns="52px 1fr",h.style.alignItems="center",h.style.gap="10px",h.style.minWidth="0";let f=document.createElement("div");f.style.display="grid",f.style.gridTemplateColumns="1fr auto",f.style.alignItems="stretch",f.style.gap="12px";let p=document.createElement("div");p.style.display="grid",p.style.gap="4px",p.style.minWidth="0",p.style.alignItems="flex-start";let m=document.createElement("div");m.textContent=e.playerName??e.playerId??"Unknown friend",m.style.fontWeight="600",m.style.fontSize="13px",m.style.whiteSpace="nowrap",m.style.overflow="hidden",m.style.textOverflow="ellipsis",m.style.flex="1";let g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.gap="6px";let S=document.createElement("span"),w=!!e.isOnline;S.style.width="10px",S.style.height="10px",S.style.borderRadius="50%",S.style.background=w?"#34d399":"#f87171",S.style.display="inline-block";let x=document.createElement("span");x.textContent=w?"Online":"Offline",x.style.fontSize="11px",x.style.opacity="0.7",g.append(S,x);let E=document.createElement("div");E.style.display="flex",E.style.flexDirection="column",E.style.alignItems="flex-end",E.style.justifyContent="flex-start",E.style.height="100%",E.style.minHeight="38px",E.style.alignSelf="stretch",E.style.gap="4px";let T=uN(e.lastEventAt),A=null;T&&(A=document.createElement("div"),A.style.fontSize="11px",A.style.opacity="0.65",A.style.whiteSpace="nowrap",A.textContent=`Last seen ${T}`),p.append(m,g),A&&p.append(A),f.append(p,E),h.append(y,f);let N=document.createElement("div");N.style.display="grid",N.style.justifyItems="end",N.style.alignItems="end",N.style.alignContent="stretch",N.style.gridAutoFlow="row",N.style.gridTemplateRows="repeat(3, min-content)",N.style.gap="6px";let H=document.createElement("span");H.textContent="\u25BE",H.style.display="inline-block",H.style.transition="transform 0.2s ease",H.style.transform="rotate(-90deg)";let C=t.btn("Details",{size:"sm",variant:"ghost",icon:H});C.style.minWidth="86px",C.style.justifyContent="center",C.title="Show friend privacy badges and coins information when available.";let L=t.btn("Join",{size:"sm",variant:"primary"});L.style.minWidth="86px",L.style.boxShadow="0 4px 10px rgba(56, 189, 248, 0.35)",t.setButtonEnabled(L,d),L.title=u,L.addEventListener("click",()=>{!d||!o||Zn.joinPublicRoom({idRoom:o})});let v=document.createElement("div");v.style.display="grid",v.style.gap="4px",v.style.justifyItems="center",v.append(L);let B=document.createElement("div");B.style.fontSize="11px",B.style.opacity="0.6",B.style.whiteSpace="nowrap",B.style.textAlign="center",B.style.margin="0",c!==null?B.textContent=c>0?`${c} slot${c===1?"":"s"} left`:"Room full":B.textContent="Room size unknown",v.appendChild(B),N.append(C,v);let le=document.createElement("div");le.style.display="grid",le.style.gridTemplateColumns="minmax(0, 1fr) auto",le.style.alignItems="stretch",le.style.gap="10px",le.append(h,N);let X=document.createElement("div");X.style.overflow="hidden",X.style.maxHeight="0",X.style.opacity="0",X.style.marginTop="0",X.style.transition="max-height 160ms ease, opacity 160ms ease, margin-top 160ms ease";let de=pN(e.coins),_=document.createElement("div");_.style.display="grid",_.style.gridTemplateColumns="minmax(0, 1fr)",_.style.alignItems="stretch",_.style.gap="6px",_.style.padding="6px 0 0 0";let re=document.createElement("div");if(re.style.display="flex",re.style.alignItems="center",re.style.gap="0",re.style.flexWrap="nowrap",re.style.minHeight="0",re.style.justifyContent="flex-start",re.style.width="auto",[{label:"\u{1F4B0}",enabled:!!e.privacy?.showCoins},{label:"\u{1F392}",enabled:!!e.privacy?.showInventory},{label:"\u{1F331}",enabled:!!e.privacy?.showGarden},{label:"\u{1F4CB}",enabled:!!e.privacy?.showActivityLog},{label:"\u{1F4F0}",enabled:!!e.privacy?.showJournal},{label:"\u{1F4CA}",enabled:!!e.privacy?.showStats}].forEach(({label:q,enabled:W})=>{re.append(mN(q,W))}),de){let q=document.createElement("div");q.style.display="flex",q.style.justifyContent="flex-end",q.style.paddingRight="16px";let W=document.createElement("div");W.textContent=`${de} coins`,W.style.fontSize="12px",W.style.opacity="0.8",W.style.whiteSpace="nowrap",W.style.justifySelf="end",q.append(W),_.append(q)}let R=document.createElement("div");R.style.display="flex",R.style.alignItems="center",R.style.gap="8px";let k=document.createElement("span");k.textContent="Privacy",k.style.fontSize="12px",k.style.fontWeight="600",k.style.opacity="0.8",R.append(k,re),_.append(R);let V=q=>{q.style.textTransform="none",q.style.padding="6px 10px",q.style.background="rgba(148, 163, 184, 0.12)",q.style.color="#f8fafc",q.style.border="1px solid rgba(248, 250, 252, 0.3)",q.style.boxShadow="0 2px 6px rgba(0, 0, 0, 0.2)",q.addEventListener("mouseenter",()=>{q.style.background="rgba(248, 250, 252, 0.12)"}),q.addEventListener("mouseleave",()=>{q.style.background="rgba(148, 163, 184, 0.12)"})},ee=null,ie=t.flexRow({gap:6,align:"center"});ie.style.flexWrap="wrap",ie.style.marginTop="4px",ie.style.justifyContent="flex-start",ie.style.alignSelf="flex-start";let fe=(q,W,b,D)=>{let F=t.btn(q,{size:"sm",variant:"ghost"});return V(F),F.addEventListener("click",async()=>{if(e.playerId){F.disabled=!0;try{let I=(await gs([e.playerId],{sections:[W]}))[0],J=b(I);if(!J){await be(q,`${q} data unavailable.`,"info");return}await D(J)}catch(P){console.error(`[FriendsMenu] Failed to load ${q.toLowerCase()}`,P),await be(q,`Unable to load ${q.toLowerCase()}.`,"error")}finally{F.disabled=!1}}}),F};ie.appendChild(fe("Inventory","inventory",q=>q?.state?.inventory??null,q=>Dt(q,{open:!0}))),ee=t.btn("Garden",{size:"sm",variant:"ghost"}),V(ee),ee.dataset.gardenDefaultLabel="Garden";let G=q=>{ee&&(ee.textContent=q)};ee.addEventListener("click",async()=>{if(!ee)return;let q=ls?.button===ee;ee.disabled=!0;let W=()=>G("Garden");if(q){try{await ad(ee)}finally{ee.disabled=!1,W()}return}ee.textContent="Loading...",await ad();try{if(!e.playerId){await be("Garden","Player ID unavailable.","error");return}let[b]=await gs([e.playerId],{sections:["garden"]}),D=b?.state?.garden??null;if(!D){await be("Garden","Garden data unavailable.","info");return}let F=window.qwsEditorPreviewFriendGarden;if(typeof F!="function"){await be("Garden","Garden preview unavailable.","error");return}if(!await F(D)){await be("Garden","Unable to preview garden.","error");return}ls={button:ee,playerId:e.playerId},G("Stop garden")}catch(b){console.error("[FriendsMenu] garden preview failed",b),await ad(),await be("Garden","Unable to load garden.","error")}finally{ee.disabled=!1,ls?.button!==ee&&W()}}),ie.appendChild(ee),ie.appendChild(fe("Activity Log","activityLog",q=>q?.state?.activityLog??q?.state?.activityLogs??null,q=>bo(q,{open:!0}))),ie.appendChild(fe("Stats","stats",q=>q?.state?.stats??null,q=>Pi(q,{open:!0}))),ie.appendChild(fe("Journal","journal",q=>q?.state?.journal??null,q=>Or(q,{open:!0}))),_.append(ie);let Z=t.btn("Remove friend",{size:"sm",variant:"danger"});Z.style.textTransform="none",Z.style.padding="6px 10px",Z.style.alignSelf="flex-start",Z.addEventListener("click",async()=>{let q=e.playerId;if(!q)return;let W=await Fn.get();if(!W)return;let b=Z.textContent;Z.disabled=!0,Z.textContent="Removing...";try{await Mf(W,q)?(Z.textContent="Removed",Qa?.({force:!0})):Z.textContent=b}catch(D){console.error("[FriendsMenu] removeFriend",D),Z.textContent=b}finally{Z.disabled=!1}}),_.append(Z),X.append(_);let j=C.querySelector(".label"),Y=!1,ne=()=>{if(Y){let q=`${_.scrollHeight}px`;X.style.maxHeight=q,X.style.opacity="1",X.style.marginTop="6px",C.setAttribute("aria-expanded","true"),j&&(j.textContent="Hide details"),H.style.transform="rotate(0deg)"}else X.style.maxHeight="0",X.style.opacity="0",X.style.marginTop="0",C.setAttribute("aria-expanded","false"),j&&(j.textContent="Details"),H.style.transform="rotate(-90deg)"};return C.addEventListener("click",()=>{Y=!Y,ne(),!Y&&ee&&(async()=>(await ad(ee),G("Garden")))()}),ne(),n.append(le,X),n}function yN(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gap="10px";let r=e.flexRow({align:"center",gap:8}),o=e.inputText("Search for a friend...");o.style.flex="1",o.style.minWidth="0";let s=e.btn("Refresh",{size:"sm",variant:"ghost"});s.style.background="rgba(248, 250, 252, 0.08)",s.style.color="#f8fafc",s.style.border="1px solid rgba(248, 250, 252, 0.15)",s.style.boxShadow="0 2px 6px rgba(0,0,0,0.35)",r.append(o,s);let a=document.createElement("div");a.style.fontSize="12px",a.style.opacity="0.7",a.textContent="Loading friends...";let i=document.createElement("div");i.style.display="grid",i.style.gap="8px",i.style.padding="10px",i.style.borderRadius="10px",i.style.border="1px solid rgba(255, 255, 255, 0.08)",i.style.background="rgba(255, 255, 255, 0.02)",i.style.maxHeight="36vh",i.style.overflow="auto",n.append(r,a,i),t.appendChild(n);let l=[],c=!1,d=!1,u=m=>{i.innerHTML="";let g=document.createElement("div");g.textContent=m,g.style.opacity="0.6",g.style.fontSize="12px",g.style.textAlign="center",i.appendChild(g)},y=m=>m.trim().toLowerCase(),h=()=>{if(d)return;if(i.innerHTML="",c){u("Loading friends...");return}let m=Rr().showOnlineFriendsOnly,g=y(o.value),S=l.filter(x=>(x.playerName??x.playerId??"").toLowerCase().includes(g)),w=m?S.filter(x=>!!x.isOnline):S;if(!w.length){l.length===0?(u("You have no friends yet."),a.textContent="No friends available."):g.length>0?(u("No friends match that search."),a.textContent=`${l.length} friends loaded.`):m?(u("No online friends right now."),a.textContent=`${l.length} friends loaded (online filter).`):(u("Nothing to show."),a.textContent=`${l.length} friends loaded.`);return}for(let x of w)i.appendChild(fN(e,x));m?a.textContent=`${w.length} online friend${w.length!==1?"s":""} shown.`:a.textContent=`${l.length} friends loaded.`},f=async m=>{if(!d){c=!0,a.textContent="Loading friends...",s.disabled=!0,h();try{let g=await Fn.get();if(!g){l=[],a.textContent="Player ID unavailable.",u("Unable to identify your player.");return}if(!m?.force){let S=vf();if(S.length){l=S,a.textContent=`${l.length} friends loaded.`;return}}l=await ui(g),a.textContent=l.length?`${l.length} friends loaded.`:"You have no friends yet."}catch(g){console.error("[FriendsMenu] Failed to load friends",g),l=[],a.textContent="Failed to load friends.",u("Unable to load friends.");return}finally{c=!1,s.disabled=!1,h()}}};o.addEventListener("input",()=>{h()}),s.addEventListener("click",()=>{f({force:!0})});let p=yi(()=>{d||h()});Qa=f,f(),t.__cleanup__=()=>{d=!0,p(),Qa===f&&(Qa=null)}}function gN(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gap="12px";let r=e.card("My profile");r.body.style.display="grid",r.body.style.gap="12px";let o=document.createElement("div");o.style.display="flex",o.style.alignItems="center",o.style.gap="12px";let s=document.createElement("div");s.style.width="48px",s.style.height="48px",s.style.borderRadius="50%",s.style.background="rgba(255, 255, 255, 0.04)",s.style.display="flex",s.style.alignItems="center",s.style.justifyContent="center",s.style.overflow="hidden",s.style.border="1px solid rgba(255, 255, 255, 0.08)";let a=document.createElement("img");a.alt="Player avatar",a.style.width="100%",a.style.height="100%",a.style.objectFit="cover",a.style.borderRadius="50%",a.style.display="none";let i=document.createElement("span");i.style.fontSize="18px",i.style.fontWeight="600",i.style.color="#f8fafc",i.style.display="block",s.append(a,i);let l=document.createElement("div");l.style.display="grid",l.style.gap="4px",l.style.flex="1";let c=document.createElement("div");c.textContent="Loading profile...",c.style.fontSize="14px",c.style.fontWeight="600";let d=document.createElement("div");d.textContent="Loading player ID...",d.style.fontSize="12px",d.style.opacity="0.8",l.append(c,d),o.append(s,l),r.body.appendChild(o);let u=e.card("Add friend");u.body.style.display="flex",u.body.style.flexDirection="column",u.body.style.gap="10px";let y=e.inputText("Player ID");y.style.width="100%";let h=document.createElement("div");h.style.fontSize="12px",h.style.opacity="0.7",h.style.minHeight="18px";let f=e.btn("Send request",{variant:"primary",fullWidth:!0});f.disabled=!0,f.title="Waiting for profile info...",u.body.append(y,h,f),n.append(r.root,u.root),t.appendChild(n);let p=null,m=!1,g=()=>{let w=y.value.trim();f.disabled=m||!p||!w};y.addEventListener("input",g),f.addEventListener("click",async()=>{if(!p){h.textContent="Player ID missing.";return}let w=y.value.trim();if(!w){h.textContent="Enter a player ID or name.";return}m=!0,g(),h.textContent="Sending request...";try{let x=await Cf(p,w);h.textContent=x?"Friend request sent.":"Unable to send request (maybe already friends).",x&&(y.value="")}catch(x){console.error("[FriendsMenu] sendFriendRequest failed",x),h.textContent="Failed to send request."}finally{m=!1,g()}}),(async()=>{let[w,x]=await Promise.all([Fn.get(),yd.get()]);p=w;let E=(x?.name??"").trim();c.textContent=E||"Your profile",d.textContent=w?`Player ID: ${w}`:"Player ID unavailable.";let T=(x?.discordAvatarUrl??"").trim();if(T)a.src=T,a.style.display="",i.style.display="none";else{a.src="",a.style.display="none";let A=(E||w||"P").trim();i.textContent=A?A.charAt(0).toUpperCase():"P",i.style.display=""}g()})()}function hN(t,e){t.innerHTML="";let n=e.card("Incoming requests");n.body.style.display="grid",n.body.style.gap="10px";let r=e.flexRow({justify:"end",align:"center"}),o=e.btn("Refresh",{size:"sm",variant:"ghost"});o.style.background="rgba(248, 250, 252, 0.08)",o.style.color="#f8fafc",o.style.border="1px solid rgba(248, 250, 252, 0.15)",o.style.boxShadow="0 2px 6px rgba(0,0,0,0.35)",o.title="Reload friend requests",o.addEventListener("click",()=>{h({force:!0})}),r.appendChild(o),n.body.appendChild(r);let s=document.createElement("div");s.style.fontSize="12px",s.style.opacity="0.8",s.textContent="",n.body.appendChild(s);let a=document.createElement("div");a.style.display="grid",a.style.gap="8px",a.style.maxHeight="26vh",a.style.overflow="auto",n.body.appendChild(a),t.appendChild(n.root);let i=null,l=[],c=!1,d=!1,u=new Set,y=()=>{if(!d){if(a.innerHTML="",c){let p=document.createElement("div");p.textContent="Loading friend requests...",p.style.opacity="0.6",p.style.fontSize="12px",p.style.textAlign="center",a.appendChild(p),s.textContent="";return}if(!l.length){let p=document.createElement("div");p.textContent="No incoming friend requests.",p.style.opacity="0.6",p.style.fontSize="12px",p.style.textAlign="center",a.appendChild(p);return}for(let p of l){let m=document.createElement("div");m.style.display="grid",m.style.gridTemplateColumns="40px 1fr auto",m.style.alignItems="center",m.style.gap="10px",m.style.padding="8px 12px",m.style.borderRadius="10px",m.style.background="rgba(255, 255, 255, 0.03)",m.style.border="1px solid rgba(255, 255, 255, 0.04)";let g=document.createElement("div");if(g.style.width="36px",g.style.height="36px",g.style.borderRadius="50%",g.style.display="grid",g.style.placeItems="center",g.style.background="rgba(255, 255, 255, 0.05)",p.avatarUrl){let H=document.createElement("img");H.src=p.avatarUrl,H.alt=p.playerName??p.playerId??"Friend request avatar",H.width=36,H.height=36,H.style.borderRadius="50%",H.style.objectFit="cover",g.appendChild(H)}else{let H=document.createElement("span"),C=(p.playerName??p.playerId??"F").trim();H.textContent=C.charAt(0).toUpperCase(),H.style.fontWeight="600",H.style.fontSize="15px",g.appendChild(H)}let S=document.createElement("div");S.style.display="flex",S.style.flexDirection="column",S.style.gap="2px";let w=document.createElement("div");w.textContent=p.playerName??p.playerId??"Unknown player",w.style.fontWeight="600",w.style.fontSize="13px";let x=document.createElement("div");x.textContent=p.room?.id?`In room ${p.room.id}`:"No room information",x.style.fontSize="11px",x.style.opacity="0.7",S.append(w,x);let E=e.flexRow({gap:4,align:"center"}),T=e.btn("\u274C",{size:"sm"});T.title="Reject request";let A=e.btn("\u2705",{size:"sm"});A.title="Accept request";let N=H=>async()=>{if(!(!i||!p.playerId)&&!u.has(p.playerId)){u.add(p.playerId),s.textContent=`${H==="accept"?"Accepting":"Rejecting"} ${p.playerName??p.playerId}...`;try{await di({playerId:i,otherPlayerId:p.playerId,action:H})}catch(C){console.error("[FriendsMenu] respondFriendRequest",C)}finally{u.delete(p.playerId),await h({force:!0}),Qa?.({force:!0})}}};T.addEventListener("click",N("reject")),A.addEventListener("click",N("accept")),E.append(T,A),m.append(g,S,E),a.appendChild(m)}s.textContent=`${l.length} pending request${l.length>1?"s":""}.`}};async function h(p){if(!d){if(!i){s.textContent="Waiting for player ID to load requests...",a.innerHTML="";let m=document.createElement("div");m.textContent="Waiting for player ID to load requests.",m.style.opacity="0.6",m.style.fontSize="12px",m.style.textAlign="center",a.appendChild(m);return}c=!0,y();try{if(!p?.force){let m=wf();if(m.length){l=m;return}}l=await co(i)}catch(m){console.error("[FriendsMenu] fetchIncomingRequestsWithViews",m),l=[]}finally{c=!1,y()}}}(async()=>{let p=await Fn.get();if(i=p,!p){s.textContent="Waiting for player ID to load requests...",a.innerHTML="";let m=document.createElement("div");m.textContent="Waiting for player ID to load requests.",m.style.opacity="0.6",m.style.fontSize="12px",m.style.textAlign="center",a.appendChild(m);return}await h()})(),t.__cleanup__=()=>{d=!0}}function bN(t,e){t.innerHTML="";let n=Rr(),r=document.createElement("div");r.style.display="grid",r.style.gap="12px";let o=e.card("Global settings");o.body.style.display="grid",o.body.style.gap="12px";let s=e.card("Privacy");s.body.style.display="grid",s.body.style.gap="12px";let a=l=>Of(l),i=(l,c,d,u)=>{let y=document.createElement("div");y.style.display="grid",y.style.gridTemplateColumns="1fr auto",y.style.alignItems="center",y.style.gap="12px";let h=document.createElement("div");h.style.display="grid",h.style.gap="2px";let f=document.createElement("div");if(f.textContent=l,f.style.fontWeight="600",f.style.fontSize="13px",d){let m=document.createElement("div");m.textContent=d,m.style.fontSize="12px",m.style.opacity="0.7",h.append(f,m)}else h.append(f);let p=e.switch(c);return p.addEventListener("input",()=>{u(p.checked)}),y.append(h,p),y};o.body.append(i("Show online friends only",n.showOnlineFriendsOnly,void 0,l=>a({showOnlineFriendsOnly:l})),i("Auto-accept incoming requests",n.autoAcceptIncomingRequests,void 0,l=>a({autoAcceptIncomingRequests:l})),i("Hide my room from the public list",n.hideRoomFromPublicList,"If another player in your room keeps this option disabled, the room will still appear in the public list.",l=>a({hideRoomFromPublicList:l}))),s.body.append(i("Friends can view my garden",n.showGarden,void 0,l=>a({showGarden:l})),i("Friends can view my inventory",n.showInventory,void 0,l=>a({showInventory:l})),i("Friends can see my coins",n.showCoins,void 0,l=>a({showCoins:l})),i("Friends can see my activity log",n.showActivityLog,void 0,l=>a({showActivityLog:l})),i("Friends can view my journal",n.showJournal,void 0,l=>a({showJournal:l})),i("Friends can see my stats",n.showStats,void 0,l=>a({showStats:l}))),r.append(o.root,s.root),t.appendChild(r)}function Mx(t){let e=new Qe({id:"friends",compact:!0});e.mount(t),e.root.style.width="420px",e.root.style.maxWidth="420px",e.root.style.minWidth="340px",e.addTabs([{id:"friends-all",title:"Friend list",render:n=>yN(n,e)},{id:"friends-add",title:"Add friend",render:n=>gN(n,e)},{id:"friends-requests",title:"Request",render:n=>hN(n,e)},{id:"friends-settings",title:"Settings",render:n=>bN(n,e)}]),e.switchTo("friends-all")}function SN(t){let e=String(t||""),n=(Me.getAbilityNameWithoutLevel?.(e)||"").replace(/[\s\-_]+/g,"").toLowerCase(),r=o=>e.startsWith(o)||n===o.toLowerCase();if(r("ProduceScaleBoost"))return{bg:"rgba(34,139,34,0.9)",hover:"rgba(34,139,34,1)"};if(r("PlantGrowthBoost"))return{bg:"rgba(0,128,128,0.9)",hover:"rgba(0,128,128,1)"};if(r("EggGrowthBoost"))return{bg:"rgba(180,90,240,0.9)",hover:"rgba(180,90,240,1)"};if(r("PetAgeBoost"))return{bg:"rgba(147,112,219,0.9)",hover:"rgba(147,112,219,1)"};if(r("PetHatchSizeBoost"))return{bg:"rgba(128,0,128,0.9)",hover:"rgba(128,0,128,1)"};if(r("PetXpBoost"))return{bg:"rgba(30,144,255,0.9)",hover:"rgba(30,144,255,1)"};if(r("HungerBoost"))return{bg:"rgba(255,20,147,0.9)",hover:"rgba(255,20,147,1)"};if(r("SellBoost"))return{bg:"rgba(220,20,60,0.9)",hover:"rgba(220,20,60,1)"};if(r("CoinFinder"))return{bg:"rgba(180,150,0,0.9)",hover:"rgba(180,150,0,1)"};if(r("ProduceMutationBoost"))return{bg:"rgba(138,43,226,0.9)",hover:"rgba(138,43,226,1)"};if(r("DoubleHarvest"))return{bg:"rgba(0,120,180,0.9)",hover:"rgba(0,120,180,1)"};if(r("ProduceEater"))return{bg:"rgba(255,69,0,0.9)",hover:"rgba(255,69,0,1)"};if(r("ProduceRefund"))return{bg:"rgba(255,99,71,0.9)",hover:"rgba(255,99,71,1)"};if(r("PetMutationBoost"))return{bg:"rgba(156,65,181,0.9)",hover:"rgba(156,65,181,1)"};if(r("HungerRestore"))return{bg:"rgba(255,105,180,0.9)",hover:"rgba(255,105,180,1)"};if(r("PetRefund"))return{bg:"rgba(0,80,120,0.9)",hover:"rgba(0,80,120,1)"};if(r("Copycat"))return{bg:"rgba(255,140,0,0.9)",hover:"rgba(255,140,0,1)"};if(r("GoldGranter"))return{bg:"linear-gradient(135deg, rgba(225,200,55,0.9) 0%, rgba(225,180,10,0.9) 40%, rgba(215,185,45,0.9) 70%, rgba(210,185,45,0.9) 100%)",hover:"linear-gradient(135deg, rgba(220,200,70,1) 0%, rgba(210,175,5,1) 40%, rgba(210,185,55,1) 70%, rgba(200,175,30,1) 100%)"};if(r("RainbowGranter"))return{bg:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))",hover:"linear-gradient(45deg, rgba(200,0,0,1), rgba(200,120,0,1), rgba(160,170,30,1), rgba(60,170,60,1), rgba(50,170,170,1), rgba(40,150,180,1), rgba(20,90,180,1), rgba(70,30,150,1))"};if(r("SeedFinderIV"))return{bg:"linear-gradient(130deg, rgba(0,180,216,0.9) 0%, rgba(124,42,232,0.9) 40%, rgba(160,0,126,0.9) 60%, rgba(255,215,0,0.9) 100%)",hover:"linear-gradient(130deg, rgba(0,180,216,1) 0%, rgba(124,42,232,1) 40%, rgba(160,0,126,1) 60%, rgba(255,215,0,1) 100%)"};if(r("SeedFinder")){let o=e.replace(/.*?([IVX]+)$/,"$1");return o==="II"?{bg:"rgba(183,121,31,0.9)",hover:"rgba(183,121,31,1)"}:o==="III"?{bg:"rgba(139,62,152,0.9)",hover:"rgba(139,62,152,1)"}:{bg:"rgba(94,172,70,0.9)",hover:"rgba(94,172,70,1)"}}return{bg:"rgba(100,100,100,0.9)",hover:"rgba(150,150,150,1)"}}function vN(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 260px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",n.style.border="1px solid #4445",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#0f1318",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateColumns="1fr",r.style.rowGap="6px",r.style.overflow="auto",r.style.padding="6px",r.style.border="1px solid #4445",r.style.borderRadius="10px",n.appendChild(r);let o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="12px",o.style.overflow="auto",o.style.minHeight="0",n.appendChild(o);let s=(g,S)=>{let w=e.card(g,{tone:"muted",align:"center"});return w.body.append(S),w.root.style.maxWidth="720px",w.root},a=()=>e.flexRow({justify:"center"}),i=(()=>{let g=a(),S=e.switch(!1);return S.id="pets.autofeed.enabled",g.append(S,e.label("Enable Autofeed for this pet")),{wrap:s("\u{1F513} Activation",g),sw:S}})();o.appendChild(i.wrap);let l=(()=>{let g=a(),S=e.label("Feed when hunger < (%)"),w=e.inputNumber(1,100,1,10);return w.id="pets.autofeed.thresholdPct",g.append(S,w.wrap??w),{wrap:s("\u2699\uFE0F Local threshold",g),num:w}})();o.appendChild(l.wrap);let c=(()=>{let g=e.table(["Allow","Crop"],{minimal:!0,maxHeight:"50vh",fixed:!0});return{wrap:s("\u{1F33E} Compatible crops",g.root),tbody:g.tbody}})();o.appendChild(c.wrap);let d=[],u=Me.getSelectedPetId?.()??null;function y(){if(r.innerHTML="",!d.length){let g=document.createElement("div");g.textContent="No pets to display",g.style.opacity="0.75",r.appendChild(g),p(null);return}for(let g of d){let S=String(g?.slot?.id||""),w=(g?.slot?.name||g?.slot?.petSpecies||"Pet").toString(),x=Me.getHungerPctFor(g),E=document.createElement("button");E.className="qmm-btn",E.dataset.pid=S,E.setAttribute("aria-pressed",S===u?"true":"false"),E.style.display="flex",E.style.justifyContent="space-between",E.style.alignItems="center",E.style.width="100%",E.style.textAlign="left";let T=document.createElement("div");T.textContent=`${w}`;let A=document.createElement("div");A.style.opacity="0.8",A.textContent=`${x}%`,E.append(T,A),E.classList.toggle("active",S===u),E.onclick=()=>{u!==S&&(u=S,Me.setSelectedPet(u),r.querySelectorAll("button.qmm-btn").forEach(N=>{let H=N.dataset.pid===u;N.classList.toggle("active",H),N.setAttribute("aria-pressed",H?"true":"false")}),p(S))},r.appendChild(E)}}function h(){i.sw.onchange=async()=>{if(u)try{await Me.setPetAutofeedEnabled(u,!!i.sw.checked)}catch{}},l.num.addEventListener("change",async()=>{if(!u)return;let g=Math.max(1,Math.min(100,Number(l.num.value)||10));l.num.value=String(g);try{await Me.setPetAutofeedThresholdPct(u,g)}catch{}})}async function f(g,S){let w=c.tbody;if(w.innerHTML="",!g||!S){let T=document.createElement("tr"),A=document.createElement("td");A.colSpan=2,A.style.opacity="0.75",A.textContent="Select a pet to view compatible crops.",T.appendChild(A),w.appendChild(T);return}let x=[],E=new Set;try{let T=Me.getCompatibleCropsForSpecies(S);x=Array.isArray(T)?T:[]}catch{}try{let T=await Me.getPetAllowedCrops(g);E=T instanceof Set?T:new Set(Array.isArray(T)?T:[])}catch{E=new Set(x)}if(!x.length){let T=document.createElement("tr"),A=document.createElement("td");A.colSpan=2,A.style.opacity="0.75",A.textContent="No compatible crops for this species.",T.appendChild(A),w.appendChild(T);return}x.forEach(T=>{let A=document.createElement("tr"),N=document.createElement("td"),H=e.switch(E.has(T));H.ariaLabel=`Allow ${T}`,H.onchange=async()=>{if(u)try{await Me.setPetAllowedCrop(u,T,!!H.checked)}catch{}},N.appendChild(H);let C=document.createElement("td");C.textContent=T,A.append(N,C),w.appendChild(A)})}async function p(g){let S=!!g;if(i.sw.disabled=!S,l.num.disabled=!S,!S){i.sw.checked=!1,l.num.value="10",await f(null,null);return}try{i.sw.checked=await Me.getPetAutofeedEnabled(g)}catch{i.sw.checked=!1}try{let E=await Me.getPetAutofeedThresholdPct(g);l.num.value=String(Math.max(1,Math.min(100,E|0||10)))}catch{l.num.value="10"}let x=(d.find(E=>String(E?.slot?.id||"")===g)||null)?.slot?.petSpecies||null;await f(g,x)}Me.onPetsChangeNow(g=>{d=Array.isArray(g)?g.slice():[],d.some(S=>String(S?.slot?.id||"")===u)||(u=d[0]?.slot?.id?String(d[0].slot.id):null,Me.setSelectedPet(u)),y(),p(u)}).then(g=>{t.__unsubPets=g}).catch(()=>{}),h(),t.__cleanup__=()=>{try{t.__unsubPets?.()}catch{}}}function wN(t,e){t.innerHTML="";let n=[],r=null,o=null,s=new Set,a=!1,i=null,l=null,c=0,d=null,u=[null,null,null];function y(j,Y,ne=.22){let W=((b,D)=>{let F=b.replace("#",""),P=parseInt(F.length===3?F[0]+F[0]:F.slice(0,2),16),I=parseInt(F.length===3?F[1]+F[1]:F.slice(2,4),16),J=parseInt(F.length===3?F[2]+F[2]:F.slice(4,6),16);return`rgba(${P},${I},${J},${D})`})(Y,ne);j.style.border=`1px solid ${W}`,j.style.background="#1f2328",j.style.boxShadow="none",j.style.transition="none"}let h=(j,Y)=>{let ne=e.card(j,{tone:"muted",align:"center"});return ne.body.append(Y),ne.root.style.maxWidth="720px",ne.root},f=j=>e.flexRow({justify:j?.justify??"center"}),p=document.createElement("div");p.style.display="grid",p.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",p.style.gap="10px",p.style.alignItems="stretch",p.style.height="54vh",p.style.overflow="hidden",t.appendChild(p);let m=document.createElement("div");m.style.display="grid",m.style.gridTemplateRows="1fr auto",m.style.gap="8px",m.style.minHeight="0",p.appendChild(m);let g=document.createElement("div");g.style.display="flex",g.style.flexDirection="column",g.style.gap="6px",g.style.overflow="auto",g.style.padding="6px",g.style.border="1px solid #4445",g.style.borderRadius="10px",g.style.scrollBehavior="smooth",g.style.minHeight="0",m.appendChild(g);let S=document.createElement("div");S.style.display="flex",S.style.gap="6px",m.appendChild(S);let w=e.btn("\u2795 New",{variant:"primary",size:"sm"});w.id="pets.teams.new",w.style.flex="1 1 0";let x=e.btn("\u{1F5D1}\uFE0F Delete",{variant:"danger",size:"sm"});x.id="pets.teams.delete",x.style.flex="1 1 0",y(w,"#22c55e",.22),y(x,"#ef4444",.22),S.append(w,x);function E(){return n.find(j=>j.id===r)||null}function T(j){let Y=Array.from(g.children);if(!Y.length)return 0;let ne=Y[0].getBoundingClientRect();if(j<ne.top+ne.height/2)return 0;for(let q=0;q<Y.length;q++){let W=Y[q].getBoundingClientRect(),b=W.top+W.height/2;if(j<b)return q}return Y.length}function A(j){let Y=document.createElement("span");Y.style.display="inline-flex",Y.style.alignItems="center",Y.style.lineHeight="1";let ne=8,q=12,W=3,b=Array.isArray(j)?j.filter(Boolean):[];if(!b.length){let D=document.createElement("span");return D.textContent="No ability",D.style.opacity="0.75",D.style.fontSize="12px",Y.appendChild(D),Y}return b.forEach((D,F)=>{let P=document.createElement("span"),{bg:I,hover:J}=SN(D);P.title=Me.getAbilityName(D)||D,P.setAttribute("aria-label",P.title),Object.assign(P.style,{display:"inline-block",width:`${q}px`,height:`${q}px`,borderRadius:`${W}px`,marginRight:F===b.length-1?"0":`${ne}px`,background:I,transition:"transform 80ms ease, box-shadow 120ms ease, background 120ms ease",cursor:"default",boxShadow:"0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"}),P.onmouseenter=()=>{P.style.background=J,P.style.transform="scale(1.08)",P.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff33"},P.onmouseleave=()=>{P.style.background=I,P.style.transform="none",P.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"},Y.appendChild(P)}),Y}function N(){let j=Array.from(g.children);if(j.forEach(q=>q.style.transform=""),i===null||l===null)return;let Y=i,ne=l;j.forEach((q,W)=>{q.style.transition="transform 120ms ease",W!==Y&&(ne>Y&&W>Y&&W<ne&&(q.style.transform=`translateY(${-c}px)`),ne<Y&&W>=ne&&W<Y&&(q.style.transform=`translateY(${c}px)`))})}function H(){Array.from(g.children).forEach(j=>{j.style.transform="",j.style.transition=""})}async function C(){o=null,s=new Set;try{let j=await Me.getPets(),Y=Array.isArray(j)?j.map(ne=>String(ne?.slot?.id||"")).filter(Boolean):[];s=new Set(Y);for(let ne of n){let q=(ne.slots||[]).filter(Boolean);if(q.length!==Y.length)continue;let W=!0;for(let b of q)if(!s.has(b)){W=!1;break}if(W){o=ne.id;break}}}catch{}}async function L(j=!1){if(j||await C(),H(),i=null,l=null,c=0,g.innerHTML="",!n.length){let Y=document.createElement("div");Y.textContent="No teams yet. Create one!",Y.style.opacity="0.75",Y.style.textAlign="center",Y.style.padding="8px",g.appendChild(Y),ie(null);return}n.forEach((Y,ne)=>{let q=document.createElement("div"),W=Y.id===o;q.dataset.index=String(ne),q.textContent="",q.style.height="36px",q.style.lineHeight="36px",q.style.padding="0 10px",q.style.border="1px solid #ffffff15",q.style.borderRadius="6px",q.style.cursor="pointer",q.style.fontSize="13px",q.style.overflow="hidden",q.style.whiteSpace="nowrap",q.style.textOverflow="ellipsis",q.style.display="flex",q.style.flex="0 0 auto",q.style.gap="8px",q.style.alignItems="center",q.style.background=Y.id===r?"#2a313a":"#1f2328";let b=document.createElement("span");b.style.width="10px",b.style.height="10px",b.style.borderRadius="50%",b.style.boxShadow="0 0 0 1px #0006 inset",b.style.background=W?"#48d170":"#64748b",b.title=W?"This team is currently active":"Inactive team";let D=document.createElement("span");D.textContent=Y.name||"(unnamed)",D.style.overflow="hidden",D.style.textOverflow="ellipsis",D.style.whiteSpace="nowrap",q.append(b,D);let F=document.createElement("span");F.className="qmm-grab",F.title="Drag to reorder",F.innerHTML="&#8942;",F.draggable=!0,q.onmouseenter=()=>q.style.borderColor="#6aa1",q.onmouseleave=()=>q.style.borderColor="#ffffff15",q.onclick=P=>{if(P.__byDrag)return;r!==Y.id&&(r=Y.id,L(!0)),ie(E())},F.addEventListener("dragstart",P=>{i=ne,c=q.getBoundingClientRect().height,q.classList.add("qmm-dragging"),P.dataTransfer?.setData("text/plain",String(ne)),P.dataTransfer&&(P.dataTransfer.effectAllowed="move");try{let I=q.cloneNode(!0);I.style.width=`${q.getBoundingClientRect().width}px`,I.style.position="absolute",I.style.top="-9999px",document.body.appendChild(I),P.dataTransfer.setDragImage(I,I.offsetWidth/2,I.offsetHeight/2),setTimeout(()=>document.body.removeChild(I),0)}catch{}}),F.addEventListener("dragend",()=>{q.classList.remove("qmm-dragging"),H(),i=null,l=null}),q.addEventListener("dragover",P=>{if(P.preventDefault(),P.dataTransfer&&(P.dataTransfer.dropEffect="move"),i===null)return;let I=Number(P.currentTarget.dataset.index||-1);if(I<0)return;let J=q.getBoundingClientRect(),te=J.top+J.height/2,z=P.clientY<te?I:I+1,M=Math.max(0,Math.min(n.length,z));l!==M&&(l=M,N());let K=28,$=g.getBoundingClientRect();P.clientY<$.top+K?g.scrollTop-=18:P.clientY>$.bottom-K&&(g.scrollTop+=18)}),q.addEventListener("drop",P=>{if(P.preventDefault(),P.__byDrag=!0,i===null)return;let I=l??T(P.clientY);if(I>i&&(I-=1),I=Math.max(0,Math.min(n.length-1,I)),I!==i){let J=n.slice(),[te]=J.splice(i,1);J.splice(I,0,te),n=J;try{Me.setTeamsOrder(n.map(z=>z.id))}catch{}}H(),i=null,l=null,c=0,L()}),q.appendChild(F),g.appendChild(q)})}g.addEventListener("dragover",j=>{if(j.preventDefault(),j.dataTransfer&&(j.dataTransfer.dropEffect="move"),i===null)return;let Y=T(j.clientY);l!==Y&&(l=Y,N());let ne=28,q=g.getBoundingClientRect();j.clientY<q.top+ne?g.scrollTop-=18:j.clientY>q.bottom-ne&&(g.scrollTop+=18)}),g.addEventListener("drop",j=>{if(j.preventDefault(),i===null)return;let Y=l??T(j.clientY);if(Y>i&&(Y-=1),Y=Math.max(0,Math.min(n.length-1,Y)),Y!==i){let ne=n.slice(),[q]=ne.splice(i,1);ne.splice(Y,0,q),n=ne;try{Me.setTeamsOrder(n.map(W=>W.id))}catch{}}H(),i=null,l=null,c=0,L()}),w.onclick=()=>{r=Me.createTeam("New Team").id,L(),ie(E())},x.onclick=()=>{!r||Me.deleteTeam(r)};let v=null;(async()=>{try{v=await Me.onTeamsChangeNow(async j=>{n=Array.isArray(j)?j.slice():[],r&&!n.some(Y=>Y.id===r)&&(r=n[0]?.id??null),!r&&n.length&&(r=n[0].id),L(),fa(n),await Me.getInventoryPets().catch(()=>[]),await ie(E())})}catch{}})();let B=document.createElement("div");B.style.display="grid",B.style.gridTemplateRows="auto 1fr",B.style.gap="10px",B.style.minHeight="0",p.appendChild(B);let le=document.createElement("div");le.style.display="flex",le.style.alignItems="center",le.style.gap="8px";let X=document.createElement("div");X.textContent="Team editor \u2014 ",X.style.fontWeight="700",X.style.fontSize="14px";let de=document.createElement("button");de.id="pets.teams.useThisTeam",de.textContent="Use this team",de.style.padding="6px 10px",de.style.borderRadius="8px",de.style.border="1px solid #4445",de.style.background="#1f2328",de.style.color="#e7eef7",de.style.cursor="pointer",de.onmouseenter=()=>de.style.borderColor="#6aa1",de.onmouseleave=()=>de.style.borderColor="#4445",de.disabled=!0;let _=document.createElement("button");_.id="pets.teams.save",_.textContent="\u{1F4BE} Save",_.style.padding="6px 10px",_.style.borderRadius="8px",_.style.border="1px solid #4445",_.style.background="#1f2328",_.style.color="#e7eef7",_.style.cursor="pointer",_.onmouseenter=()=>_.style.borderColor="#6aa1",_.onmouseleave=()=>_.style.borderColor="#4445",_.disabled=!0,le.append(X,de),B.appendChild(le);let re=document.createElement("div");re.style.border="1px solid #4445",re.style.borderRadius="10px",re.style.padding="10px",re.style.display="flex",re.style.flexDirection="column",re.style.gap="12px",re.style.overflow="auto",re.style.minHeight="0",re.style.background="#0f1318",B.appendChild(re);let R=(()=>{let j=f();j.style.width="100%";let Y=e.inputText("Team name","");return Y.id="pets.teams.editor.name",Y.style.flex="1",Y.style.minWidth="0",_.style.marginLeft="auto",_.style.padding="6px 10px",j.append(Y,_),re.appendChild(h("\u{1F3F7}\uFE0F Team name",j)),{nameInput:Y}})(),k=(()=>{let j=document.createElement("div");j.style.display="flex",j.style.flexDirection="column",j.style.gap="10px",j.style.alignItems="center";let Y=!1,ne="ability",q=e.segmented([{value:"ability",label:"\u2728 Ability"},{value:"species",label:"\u{1F9EC} Species"}],"ability",async J=>{Y||(ne=J,await F(),W.value="",P())},{ariaLabel:"Search mode"}),W=document.createElement("select");W.className="qmm-input",W.id="pets.teams.filter.select",W.style.minWidth="260px";let b=()=>ne,D=J=>{ne=J,Y=!0,q.set(J),Y=!1},F=async()=>{let J=W.value,te=await Me.getInventoryPets().catch(()=>[]);W.innerHTML="";let z=document.createElement("option");if(z.value="",z.textContent="\u2014 No filter \u2014",W.appendChild(z),b()==="ability"){let M=new Set;for(let K of te){let $=Array.isArray(K?.abilities)?K.abilities.filter(Boolean):[];for(let Q of $){let se=Me.getAbilityNameWithoutLevel?.(Q)||"";se&&M.add(se)}}for(let K of Array.from(M).sort(($,Q)=>$.localeCompare(Q))){let $=document.createElement("option");$.value=K,$.textContent=K,W.appendChild($)}}else{let M=new Set;for(let K of te){let $=String(K?.petSpecies||"").trim();$&&M.add($)}for(let K of Array.from(M).sort(($,Q)=>$.localeCompare(Q))){let $=document.createElement("option");$.value=K,$.textContent=K.charAt(0).toUpperCase()+K.slice(1),W.appendChild($)}}Array.from(W.options).some(M=>M.value===J)&&(W.value=J)},P=()=>{let J=E();if(!J)return;let te=(W.value||"").trim(),z=b()==="ability"?te?`ab:${te}`:"":te?`sp:${te}`:"";Me.setTeamSearch(J.id,z)};W.addEventListener("change",P),j.append(q,W),re.appendChild(h("\u{1F50D} Search",j));let I=(J,te)=>{let z=(J||"").trim();if(!z)return;if(!Array.from(W.options).some(K=>K.value===z)){let K=document.createElement("option");K.value=z,K.textContent=te??z,W.appendChild(K)}};return{getMode:b,setMode:D,select:W,rebuild:F,apply:P,setFromSearchString(J){let te=(J||"").match(/^(ab|sp):\s*(.*)$/i);if(!te){D("ability"),W.value="";return}let z=te[1].toLowerCase()==="ab"?"ability":"species",M=(te[2]||"").trim();D(z),I(M,z==="species"?M.charAt(0).toUpperCase()+M.slice(1):M),W.value=M}}})(),V=(()=>{let j=document.createElement("div");j.style.display="grid",j.style.gridTemplateColumns="1fr",j.style.rowGap="10px",j.style.justifyItems="center";let Y=J=>{let te=document.createElement("div"),z=28,M=40;te.style.display="grid",te.style.gridTemplateColumns=`${M}px minmax(0,1fr) ${z}px ${z}px`,te.style.alignItems="center",te.style.gap="8px",te.style.width="min(560px, 100%)",te.style.border="1px solid #4445",te.style.borderRadius="10px",te.style.padding="8px 10px",te.style.background="#0f1318";let K=document.createElement("div");Object.assign(K.style,{width:`${M}px`,height:`${M}px`,display:"inline-flex",alignItems:"center",justifyContent:"center"});let $=()=>{K.replaceChildren();let he=document.createElement("span");he.textContent="\u{1F43E}",he.style.fontSize=`${Math.max(M-6,12)}px`,he.setAttribute("aria-hidden","true"),K.appendChild(he)},Q=0,se=(he,ve)=>{Q+=1;let Ee=Q,Ne=String(he??"").trim();if(!Ne){$();return}$(),ll(Ne,ve).then(He=>{if(Ee!==Q)return;if(!He){$();return}let ze=new Image;ze.src=He,ze.alt=Ne||"pet",ze.decoding="async",ze.loading="lazy",ze.draggable=!1,Object.assign(ze.style,{width:"100%",height:"100%",imageRendering:"auto",objectFit:"contain"}),K.replaceChildren(ze)}).catch(()=>{Ee===Q&&$()})},O=document.createElement("div");O.style.display="flex",O.style.flexDirection="column",O.style.gap="6px",O.style.minWidth="0";let U=document.createElement("div");U.style.fontWeight="700",U.textContent="None",U.style.overflow="hidden",U.style.textOverflow="ellipsis",U.style.whiteSpace="nowrap";let ue=A([]);ue.style.display="inline-block",O.append(U,ue);let oe=document.createElement("button");oe.textContent="+",Object.assign(oe.style,{width:`${z}px`,minWidth:`${z}px`,height:`${z}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),oe.title="Choose a pet",oe.setAttribute("aria-label","Choose a pet");let ae=document.createElement("button");ae.textContent="\u2212",Object.assign(ae.style,{width:`${z}px`,minWidth:`${z}px`,height:`${z}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),ae.title="Remove this pet",ae.setAttribute("aria-label","Remove this pet"),te.append(K,O,oe,ae);function ye(he){if(!he){U.textContent="None",se(void 0,void 0);let Ve=A([]);Ve.style.display="inline-block",O.replaceChild(Ve,O.children[1]),ue=Ve;return}let ve=String(he.petSpecies||"").trim(),Ee=Array.isArray(he.mutations)?he.mutations:[];se(ve,Ee);let Ne=ve?ve.charAt(0).toUpperCase()+ve.slice(1):"";U.textContent=he.name?.trim()||Ne||"Pet";let He=Array.isArray(he.abilities)?he.abilities.filter(Boolean):[],ze=A(He);ze.style.display="inline-block",O.replaceChild(ze,O.children[1]),ue=ze}return oe.onclick=async()=>{let he=E();if(he){oe.disabled=!0,ae.disabled=!0,e.setWindowVisible(!1);try{await Me.chooseSlotPet(he.id,J),await ee(E())}finally{e.setWindowVisible(!0),oe.disabled=!1,ae.disabled=!1}}},ae.onclick=async()=>{let he=E();if(!he)return;let ve=he.slots.slice(0,3);ve[J]=null,Me.saveTeam({id:he.id,slots:ve}),await ee(he)},{root:te,nameEl:U,abilitiesEl:ue,btnChoose:oe,btnClear:ae,update:ye}},ne=Y(0),q=Y(1),W=Y(2);j.append(ne.root,q.root,W.root);let b=document.createElement("div");b.style.display="flex",b.style.gap="6px",b.style.justifyContent="center";let D=e.btn("Current active",{variant:"primary"});D.id="pets.teams.useCurrent",D.style.minWidth="140px";let F=e.btn("Clear slots",{variant:"secondary"});F.id="pets.teams.clearSlots",F.style.minWidth="140px";let P="#0f1318";b.append(D,F),Object.assign(D.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:P,boxShadow:"none"}),Object.assign(F.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:P,boxShadow:"none"});let I=document.createElement("div");return I.style.display="flex",I.style.flexDirection="column",I.style.gap="8px",I.append(j,b),re.appendChild(h("\u26A1 Active pets (3 slots)",I)),{rows:[ne,q,W],btnUseCurrent:D,btnClear:F}})();async function ee(j){let Y=j??E();if(!Y)return;let ne=await Me.getInventoryPets().catch(()=>null);if(!(!ne||ne.length===0)){d=new Map;for(let W of ne){let b=W?.id!=null?String(W.id):"";b&&d.set(b,W)}}let q=d??new Map;[0,1,2].forEach(W=>{let b=Y.slots[W]||null;if(!b){u[W]!==null&&(V.rows[W].update(null),u[W]=null);return}let D=q.get(b);D&&u[W]!==b&&(V.rows[W].update(D),u[W]=b)})}async function ie(j){let Y=!!j;if(R.nameInput.disabled=!Y,V.btnClear.disabled=!Y,V.btnUseCurrent.disabled=!Y,de.disabled=!Y,_.disabled=!Y,Y){let ne=Me.getTeamSearch(j.id)||"",q=ne.match(/^(ab|sp):\s*(.*)$/i),W=q?q[1].toLowerCase()==="ab"?"ability":"species":"ability";k.setMode(W),await k.rebuild(),q&&k.setFromSearchString(ne)}else await k.rebuild();if(!Y){V.rows.forEach(ne=>ne.update(null)),R.nameInput.value="";return}R.nameInput.value=String(j.name||""),await ee(j)}R.nameInput.addEventListener("keydown",j=>{j.key==="Enter"&&j.currentTarget.blur()}),R.nameInput.addEventListener("blur",()=>{let j=E();if(!j)return;let Y=R.nameInput.value.trim();Y!==j.name&&Me.saveTeam({id:j.id,name:Y})}),V.btnUseCurrent.onclick=async()=>{let j=E();if(j)try{let Y=await Me.getPets(),q=(Array.isArray(Y)?Y:[]).map(b=>String(b?.slot?.id||"")).filter(b=>!!b).slice(0,3),W=[q[0]||null,q[1]||null,q[2]||null];Me.saveTeam({id:j.id,slots:W}),await ee(j)}catch{}},V.btnClear.onclick=async()=>{let j=E();j&&(Me.saveTeam({id:j.id,slots:[null,null,null]}),await ee(j))},_.onclick=()=>{let j=E();if(!j)return;let Y=R.nameInput.value.trim(),ne=j.slots.slice(0,3);Me.saveTeam({id:j.id,name:Y,slots:ne}),ee(j)};function fe(j,Y){if(j.length!==Y.length)return!1;let ne=new Set(j);for(let q of Y)if(!ne.has(q))return!1;return!0}async function G(j,Y=2e3){let ne=(j.slots||[]).filter(Boolean),q=performance.now();for(;performance.now()-q<Y;){let W=await Me.getPets().catch(()=>null),b=Array.isArray(W)?W.map(D=>String(D?.slot?.id||"")).filter(Boolean):[];if(fe(b,ne))return!0;await new Promise(D=>setTimeout(D,80))}return!1}de.onclick=async()=>{let j=E();if(j)try{a=!0,o=j.id,await L(!0),await Me.useTeam(j.id),await G(j),await ie(E()),await L()}catch(Y){console.warn("[Pets] Use this team failed:",Y),await L()}finally{a=!1}};let Z=null;(async()=>{try{Z=await Sf(async()=>{a||(await ee(E()),await L())})}catch{}})(),Rl(async j=>{let Y=n.find(ne=>ne.id===j)||null;try{a=!0,Y&&(o=Y.id,await L(!0)),await Me.useTeam(j),Y&&await G(Y),await ie(E()),await L()}catch(ne){console.warn("[Pets] hotkey useTeam failed:",ne),await L()}finally{a=!1}}),t.__cleanup__=(()=>{let j=t.__cleanup__;return()=>{try{v?.()}catch{}try{Z?.()}catch{}try{j?.()}catch{}}})()}function xN(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.height="54vh",t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="8px",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="8px 10px",r.style.background="#0f1318",n.appendChild(r);let o=e.select({id:"pets.logs.filter.ability",width:"200px"}),s=e.select({id:"pets.logs.sort",width:"140px"});[["desc","Newest first"],["asc","Oldest first"]].forEach(([C,L])=>{let v=document.createElement("option");v.value=C,v.textContent=L,s.appendChild(v)}),s.value="desc";let a=e.inputText("search (pet / ability / details)","");a.id="pets.logs.search",a.style.minWidth="220px";let i=e.btn("\u{1F9F9} Clear",{size:"sm"});i.id="pets.logs.clear",i.style.flex="0 0 auto",r.append(e.label("Ability"),o,e.label("Sort"),s,a,i);let l=document.createElement("div");l.style.border="1px solid #4445",l.style.borderRadius="10px",l.style.padding="10px",l.style.background="#0f1318",l.style.overflow="hidden",l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="grid",c.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",c.style.columnGap="0",c.style.borderBottom="1px solid #ffffff1a",c.style.padding="0 0 6px 0";function d(C,L="center"){let v=document.createElement("div");return v.textContent=C,v.style.fontWeight="600",v.style.opacity="0.9",v.style.padding="6px 8px",v.style.textAlign=L,v}c.append(d("Date & Time"),d("Pet"),d("Ability"),d("Details","left")),l.appendChild(c);let u=document.createElement("div");u.style.display="grid",u.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",u.style.gridAutoRows="auto",u.style.alignContent="start",u.style.overflow="auto",u.style.width="100%",u.style.minHeight="0",l.appendChild(u);let y=Me.getAbilityLogsSessionStart?.()??0,h=[],f="",p="desc",m="";function g(){let C=o.value;o.innerHTML="";let L=[["","All abilities"],...Me.getSeenAbilityIds().map(v=>[v,v])];for(let[v,B]of L){let le=document.createElement("option");le.value=v,le.textContent=B,o.appendChild(le)}o.value=L.some(([v])=>v===C)?C:""}function S(C){let L=Number(C);if(!Number.isFinite(L))return"";let v=new Date(L);if(Number.isNaN(v.getTime()))return"";let B=String(v.getMonth()+1).padStart(2,"0"),le=String(v.getDate()).padStart(2,"0"),X=String(v.getFullYear()%100).padStart(2,"0");return`${B}/${le}/${X}`}function w(C,L="center"){let v=document.createElement("div");return v.textContent=C,v.style.padding="6px 8px",v.style.display="flex",v.style.flexDirection="column",v.style.justifyContent="center",v.style.alignItems=L==="left"?"flex-start":"center",v.style.textAlign=L,v.style.whiteSpace=L==="left"?"pre-wrap":"normal",v.style.wordBreak=L==="left"?"break-word":"normal",v.style.borderBottom="1px solid #ffffff12",v}function x(C){let L=w("","center");L.style.gap="2px";let v=document.createElement("div"),B=document.createElement("div"),le=typeof C.date=="string"&&C.date.trim().length>0;le&&(v.textContent=C.date??""),B.textContent=C.time12,le&&L.appendChild(v),L.appendChild(B);let X=C.petName||C.species||"Pet",de=w(X,"center"),_=w(C.abilityName||C.abilityId,"center"),re=typeof C.data=="string"?C.data:(()=>{try{return JSON.stringify(C.data)}catch{return""}})(),R=w(re,"left");C.isActiveSession&&[L,de,_,R].forEach(k=>{k.style.background="rgba(89, 162, 255, 0.14)"}),u.append(L,de,_,R)}let E=C=>String(C??"").toLowerCase().replace(/\s+/g,"").replace(/([ivx]+)$/i,"");function T(){let C=h.slice();if(f&&f.trim()){let L=E(f);C=C.filter(v=>{let B=E(v.abilityId),le=E(Me.getAbilityNameWithoutLevel(v.abilityId));return B===L||le===L})}if(m&&m.trim()){let L=m.toLowerCase();C=C.filter(v=>{let B=(v.petName||v.species||"").toLowerCase(),le=(v.abilityName||"").toLowerCase(),X=(v.abilityId||"").toLowerCase(),de=(typeof v.data=="string"?v.data:(()=>{try{return JSON.stringify(v.data)}catch{return""}})()).toLowerCase();return B.includes(L)||le.includes(L)||X.includes(L)||de.includes(L)||(v.petId||"").toLowerCase().includes(L)})}return C.sort((L,v)=>p==="asc"?L.performedAt-v.performedAt:v.performedAt-L.performedAt),C}function A(){u.innerHTML="";let C=T();if(!C.length){let L=document.createElement("div");L.textContent="No logs yet.",L.style.opacity="0.75",L.style.gridColumn="1 / -1",L.style.padding="8px",u.appendChild(L);return}C.forEach(x),p==="asc"?u.scrollTop=u.scrollHeight+32:u.scrollTop=0}o.onchange=()=>{f=o.value,A()},s.onchange=()=>{p=s.value||"desc",A()},a.addEventListener("input",()=>{m=a.value.trim(),A()}),i.onclick=()=>{try{Me.clearAbilityLogs()}catch{}};let N=null,H=null;(async()=>{try{N=await Me.startAbilityLogsWatcher(),g(),H=Me.onAbilityLogs(C=>{h=C.map(L=>({petId:L.petId,petName:L.name??null,species:L.species??null,abilityId:L.abilityId,abilityName:L.abilityName,data:L.data,performedAt:L.performedAt,date:S(L.performedAt),time12:L.time12,isActiveSession:y>0&&L.performedAt>=y})),g(),A()})}catch{}})(),t.__cleanup__=(()=>{let C=t.__cleanup__;return()=>{try{H?.()}catch{}try{N?.()}catch{}try{C?.()}catch{}}})(),A()}function Ax(t){let e=new Qe({id:"pets",compact:!0,windowSelector:".qws-win"});e.mount(t),e.addTab("autofeed","\u{1F37D}\uFE0F Autofeed",n=>vN(n,e)),e.addTab("manager","\u{1F9F0} Manager",n=>wN(n,e)),e.addTab("logs","\u{1F4DD} Logs",n=>xN(n,e))}var Tx=t=>{let e=Math.max(0,Math.round(t));if(e<60)return`${e} s`;let n=Math.floor(e/60),r=e%60;return r===0?`${n} min`:`${n} min ${r} s`},EN=new Intl.NumberFormat("en-US"),Ix=t=>EN.format(Math.max(0,Math.floor(t||0))),CN=t=>{if(t<1e3)return`${t} ms`;let e=t/1e3;return e<10?`${e.toFixed(1)} s`:`${Math.round(e)} s`},MN=t=>new Date(t).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Ja=10,kx=(t,e,n)=>{if(t<=0||e<=0)return"";let r=t*(e+Ja),o=CN(r);return n?` \xB7 Estimated time ${o} (${MN(n)})`:` \xB7 Estimated time ${o}`};async function Px(t){let e=new Qe({id:"misc",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gap="8px",n.style.minHeight="0",n.style.justifyItems="center";let r=(()=>{let l=e.card("\u{1F504} Auto reconnect on session conflict",{tone:"muted",align:"center"});l.root.style.maxWidth="480px",l.body.style.display="grid",l.body.style.gap="10px";let c=e.flexRow({align:"center",justify:"between",fullWidth:!0}),d=document.createElement("div");d.style.display="inline-flex",d.style.alignItems="center",d.style.gap="8px";let u=e.label("Activate");u.style.margin="0";let y=e.switch(Ke.readAutoRecoEnabled(!1));d.append(u,y),c.append(d);let h=Math.round(Ke.getAutoRecoDelayMs()/1e3),f=e.flexRow({align:"center",gap:10,justify:"between",fullWidth:!0}),p=e.label("Reconnect after");p.style.margin="0";let m=e.slider(30,300,30,h);m.style.flex="1";let g=document.createElement("div");g.style.minWidth="72px",g.style.textAlign="right",g.textContent=Tx(h),f.append(p,m,g);let S=document.createElement("div");S.style.opacity="0.8",S.style.fontSize="12px",S.style.lineHeight="1.35";let w=T=>Math.max(30,Math.min(300,Math.round(T/30)*30)),x=()=>{let T=!!y.checked;m.disabled=!T,Ke.writeAutoRecoEnabled(T),S.textContent=T?"Automatically log back in if this account is disconnected because it was opened in another session.":"Auto reconnect on session conflict is turned off."},E=(T,A)=>{let N=w(T);m.value=String(N),g.textContent=Tx(N),A&&Ke.setAutoRecoDelayMs(N*1e3),x()};return y.addEventListener("change",x),m.addEventListener("input",()=>E(Number(m.value),!1)),m.addEventListener("change",()=>E(Number(m.value),!0)),x(),l.body.append(c,f,S),l.root})(),o=(()=>{let l=document.createElement("div");l.style.display="flex",l.style.alignItems="center",l.style.gap="12px",l.style.flexWrap="wrap";let c=(g,S,w)=>{let x=document.createElement("div");x.style.display="inline-flex",x.style.alignItems="center",x.style.gap="6px";let E=e.label(g);return E.style.fontSize="13px",E.style.margin="0",E.style.justifySelf="start",w&&(E.id=w),x.append(E,S),x},d=e.switch(Ke.readGhostEnabled(!1));d.id="player.ghostMode";let u=c("Ghost",d,"label.ghost"),y=e.inputNumber(10,1e3,5,50);y.id="player.moveDelay";let h=y.wrap??y;h.style&&(h.style.margin="0"),y.style&&(y.style.width="84px");let f=c("Delay (ms)",h,"label.delay");l.append(u,f);let p=Ke.createGhostController();y.value=String(Ke.getGhostDelayMs()),y.addEventListener("change",()=>{let g=Math.max(10,Math.min(1e3,Math.floor(Number(y.value)||50)));y.value=String(g),p.setSpeed?.(g),Ke.setGhostDelayMs(g)}),d.checked&&p.start(),d.onchange=()=>{let g=!!d.checked;Ke.writeGhostEnabled(g),g?p.start():p.stop()},l.__cleanup__=()=>{try{p.stop()}catch{}};let m=e.card("\u{1F3AE} Player controls",{tone:"muted",align:"center"});return m.root.style.maxWidth="440px",m.body.append(l),m.root})(),s=(()=>{let l=e.formGrid({columnGap:6,rowGap:6});l.style.gridTemplateColumns="1fr";let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="flex-start",c.style.gap="8px",c.style.gridColumn="1 / -1";let d=e.label("Selected");d.style.fontSize="13px",d.style.margin="0";let u=document.createElement("div");u.id="misc.seedDeleter.summary",u.style.fontSize="13px",u.style.opacity="0.9",u.textContent="0 species - 0 seeds",c.append(d,u),l.append(c);let y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.gap="8px",y.style.justifyContent="flex-start",y.style.gridColumn="1 / -1";let h=e.label("Actions");h.style.fontSize="13px",h.style.margin="0";let f=e.flexRow({gap:6}),p=e.btn("Select seeds",{variant:"primary",size:"sm"}),m=e.btn("Delete",{variant:"danger",size:"sm",disabled:!0}),g=e.btn("Clear",{size:"sm",disabled:!0});f.append(p,m,g),y.append(h,f),l.append(y);let S=e.label("Status");S.style.fontSize="13px",S.style.margin="0",S.style.justifySelf="start";let w=document.createElement("div");w.style.fontSize="13px",w.style.fontWeight="600",w.style.color="#f9f9f9",w.style.whiteSpace="nowrap",w.textContent="Idle";let x=e.flexRow({gap:6}),E=e.btn("Pause",{size:"sm"}),T=e.btn("Play",{size:"sm"}),A=e.btn("Stop",{size:"sm",variant:"ghost"});E.onclick=()=>{Ke.pauseSeedDeletion(),L()},T.onclick=()=>{Ke.resumeSeedDeletion(),L()},A.onclick=()=>{Ke.cancelSeedDeletion(),L()},x.append(E,T,A);let N={species:"\u2014",done:0,total:0,remaining:0},H=()=>{let G=Ke.isSeedDeletionRunning(),Z=Ke.isSeedDeletionPaused(),Y=`${N.species||"\u2014"} (${N.done}/${N.total})`;return G?Z?`Paused \xB7 ${Y}`:Y:"Idle"},C=()=>{w.textContent=H()},L=()=>{let G=Ke.isSeedDeletionRunning(),Z=Ke.isSeedDeletionPaused();E.disabled=!G||Z,T.disabled=!G||!Z,A.disabled=!G,C()},v=null,B=null,le=()=>{B!==null&&(clearTimeout(B),B=null)},X=()=>{le(),B=window.setTimeout(()=>ie(),1e3)},de=G=>{let Z=G.detail;N.species=Z.species,N.done=Z.done,N.total=Z.total,N.remaining=Z.remainingForSpecies,C(),L()},_=()=>{N.species="\u2014",N.done=0,N.total=0,N.remaining=0,C(),L()},re=()=>L(),R=()=>L();window.addEventListener("qws:seeddeleter:progress",de),window.addEventListener("qws:seeddeleter:done",_),window.addEventListener("qws:seeddeleter:error",_),window.addEventListener("qws:seeddeleter:paused",re),window.addEventListener("qws:seeddeleter:resumed",R);let k=()=>{window.removeEventListener("qws:seeddeleter:progress",de),window.removeEventListener("qws:seeddeleter:done",_),window.removeEventListener("qws:seeddeleter:error",_),window.removeEventListener("qws:seeddeleter:paused",re),window.removeEventListener("qws:seeddeleter:resumed",R)};C(),L();let V=document.createElement("div");V.style.display="flex",V.style.alignItems="center",V.style.gap="8px",V.style.gridColumn="1 / -1",V.append(S,x,w),l.append(V);function ee(){let G=Ke.getCurrentSeedSelection?.()||[],Z=G.length,j=0;for(let Y of G)j+=Math.max(0,Math.floor(Y?.qty||0));return{sel:G,speciesCount:Z,totalQty:j}}function ie(){let{speciesCount:G,totalQty:Z}=ee(),j=Wi,Y=Z*(j+Ja),ne=Ke.isSeedDeletionRunning(),q=ne?v:Y>0?Date.now()+Y:null,W=kx(Z,j,q);u.textContent=`${G} species - ${Ix(Z)} seeds${W}`;let b=G>0&&Z>0;e.setButtonEnabled(m,b),e.setButtonEnabled(g,b),!ne&&Z>0?X():le()}p.onclick=async()=>{await Ke.openSeedSelectorFlow(e.setWindowVisible.bind(e)),ie()},g.onclick=()=>{try{Ke.clearSeedSelection?.()}catch{}ie()},m.onclick=async()=>{let{totalQty:G}=ee(),Z=Wi,j=G*(Z+Ja);v=j>0?Date.now()+j:null,le();let Y=Ke.deleteSelectedSeeds({delayMs:Z});ie(),await Y,v=null,ie()};let fe=e.card("Seed deleter",{tone:"muted",align:"center"});return fe.root.style.maxWidth="440px",fe.body.append(l),fe.root.__cleanup__=()=>{le(),k()},fe.root})(),a=(()=>{let l=e.formGrid({columnGap:6,rowGap:6});l.style.gridTemplateColumns="1fr";let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="flex-start",c.style.gap="8px",c.style.gridColumn="1 / -1";let d=e.label("Selected");d.style.fontSize="13px",d.style.margin="0";let u=document.createElement("div");u.id="misc.decorDeleter.summary",u.style.fontSize="13px",u.style.opacity="0.9",u.textContent="0 decor - 0 items",c.append(d,u),l.append(c);let y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.gap="8px",y.style.justifyContent="flex-start",y.style.gridColumn="1 / -1";let h=e.label("Actions");h.style.fontSize="13px",h.style.margin="0";let f=e.flexRow({gap:6}),p=e.btn("Select decor",{variant:"primary",size:"sm"}),m=e.btn("Delete",{variant:"danger",size:"sm",disabled:!0}),g=e.btn("Clear",{size:"sm",disabled:!0});f.append(p,m,g),y.append(h,f),l.append(y);let S=e.label("Status");S.style.fontSize="13px",S.style.margin="0",S.style.justifySelf="start";let w=document.createElement("div");w.style.fontSize="13px",w.style.fontWeight="600",w.style.color="#f9f9f9",w.style.whiteSpace="nowrap",w.textContent="Idle";let x=e.flexRow({gap:6}),E=e.btn("Pause",{size:"sm"}),T=e.btn("Play",{size:"sm"}),A=e.btn("Stop",{size:"sm",variant:"ghost"});E.onclick=()=>{Ke.pauseDecorDeletion(),L()},T.onclick=()=>{Ke.resumeDecorDeletion(),L()},A.onclick=()=>{Ke.cancelDecorDeletion(),L()},x.append(E,T,A);let N={name:"\u2014",done:0,total:0,remaining:0},H=()=>{let G=Ke.isDecorDeletionRunning(),Z=Ke.isDecorDeletionPaused(),Y=`${N.name||"\u2014"} (${N.done}/${N.total})`;return G?Z?`Paused \xB7 ${Y}`:Y:"Idle"},C=()=>{w.textContent=H()},L=()=>{let G=Ke.isDecorDeletionRunning(),Z=Ke.isDecorDeletionPaused();E.disabled=!G||Z,T.disabled=!G||!Z,A.disabled=!G,C()},v=G=>{let Z=G.detail;N.name=Z.decorId,N.done=Z.done,N.total=Z.total,N.remaining=Z.remainingForDecor,C(),L()},B=()=>{N.name="\u2014",N.done=0,N.total=0,N.remaining=0,C(),L()},le=()=>L(),X=()=>L();window.addEventListener("qws:decordeleter:progress",v),window.addEventListener("qws:decordeleter:done",B),window.addEventListener("qws:decordeleter:error",B),window.addEventListener("qws:decordeleter:paused",le),window.addEventListener("qws:decordeleter:resumed",X);let de=()=>{window.removeEventListener("qws:decordeleter:progress",v),window.removeEventListener("qws:decordeleter:done",B),window.removeEventListener("qws:decordeleter:error",B),window.removeEventListener("qws:decordeleter:paused",le),window.removeEventListener("qws:decordeleter:resumed",X)};C(),L();let _=null,re=null,R=()=>{re!==null&&(clearTimeout(re),re=null)},k=()=>{R(),re=window.setTimeout(()=>ie(),1e3)},V=document.createElement("div");V.style.display="flex",V.style.alignItems="center",V.style.gap="8px",V.style.gridColumn="1 / -1",V.append(S,x,w),l.append(V);function ee(){let G=Ke.getCurrentDecorSelection?.()||[],Z=G.length,j=0;for(let Y of G)j+=Math.max(0,Math.floor(Y?.qty||0));return{sel:G,decorCount:Z,totalQty:j}}function ie(){let{decorCount:G,totalQty:Z}=ee(),j=Ds*2,Y=Z*(j+Ja),ne=Ke.isDecorDeletionRunning(),q=ne?_:Y>0?Date.now()+Y:null,W=kx(Z,j,q);u.textContent=G+" decor - "+Ix(Z)+" items"+W;let b=G>0&&Z>0;e.setButtonEnabled(m,b),e.setButtonEnabled(g,b),!ne&&Z>0?k():R()}p.onclick=async()=>{await Ke.openDecorSelectorFlow(e.setWindowVisible.bind(e)),ie()},m.onclick=async()=>{let{totalQty:G}=ee(),Z=Ds*2,j=G*(Z+Ja);_=j>0?Date.now()+j:null,R();let Y=Ke.deleteSelectedDecor?.({delayMs:Ds});ie(),Y&&await Y,_=null,ie()},g.onclick=()=>{try{Ke.clearDecorSelection?.()}catch{}ie()};let fe=e.card("Decor deleter",{tone:"muted",align:"center"});return fe.root.style.maxWidth="440px",fe.body.append(l),fe.root.__cleanup__=()=>{R(),de()},fe.root})(),i=document.createElement("div");i.style.display="grid",i.style.gap="8px",i.style.justifyItems="center",i.append(r,o,s,a),n.appendChild(i),n.__cleanup__=()=>{try{o.__cleanup__?.()}catch{}try{s.__cleanup__?.()}catch{}try{a.__cleanup__?.()}catch{}}}var id=[{id:"wiki",title:"Magic Garden Wiki",description:"Community-curated documentation for plants, mechanics, weather, and more.",url:"https://magicgarden.fandom.com/wiki/MagicCircle_Wiki",icon:"\u{1F4DA}",tags:["guide"]},{id:"calculator",title:"Magic Garden Calculator",description:"Numerous optimisation statistics at your fingertips.",url:"https://daserix.github.io/magic-garden-calculator/",icon:"\u{1F9EE}",tags:["calculator"]},{id:"mgtools",title:"MGTools",description:"Utility scripts designed to streamline your time in Magic Garden.",url:"https://github.com/Myke247/MGTools/",icon:"\u{1F6E0}\uFE0F",tags:["utility"]},{id:"pet-revenue",title:"Pet Revenue Planner",description:"Forecast the extra income your pets generate, showing $/min and per-boost gains so you can decide which pets and crops to prioritize.",url:"https://docs.google.com/spreadsheets/d/1tG1LIEsXQlNRxaN2pySkwwN688_eCLgGIil_xRaPnBo/edit?gid=1430710045#gid=1430710045",icon:"\u{1F43E}",tags:["calculator"]},{id:"dollar-hour",title:"$ per Hour Calculators",description:"Estimate your gold per hour: select a crop, apply weather and friend/pet boosts, set the duration, and get an instant $/h result.",url:"https://docs.google.com/spreadsheets/d/1ZYikURs-vBMfTQCU_fFbl25CITBrjsEZePxWc-DqOm8/edit?gid=689506777#gid=689506777",icon:"\u{1F4B8}",tags:["calculator"]},{id:"should-i-invest",title:"Should I Invest?",description:"Instant ROI calculator, select crop, weather, mutation, size, and boost to see if it\u2019s worth it.",url:"https://docs.google.com/spreadsheets/d/1PyKd9NG3GsocFmCgwQ01ZQ783ADzcim5LS5XLSLJtqI/edit",icon:"\u{1F914}",tags:["calculator"]},{id:"matrixes",title:"Matrixes Reference",description:"A reference matrix that compares and ranks each plant\u2019s $/h across all buffs and combos, with quick pick/freeze/gold suggestions.",url:"https://docs.google.com/spreadsheets/d/1gUdu8LBFbkN7CJzqX_nDwLW9nxdIks-0jRJTrUI19U4/edit?gid=1450892699#gid=1450892699",icon:"\u{1F9E9}",tags:["reference"]},{id:"beginners-guide",title:"Beginner's Guide Snapshot",description:"A concise visual cheat sheet to get new gardeners up to speed quickly.",url:"https://i.imgur.com/7IHU0RJ.png",icon:"\u{1F331}",tags:["guide","beginner"]}],AN=Array.from(new Set(id.flatMap(t=>t.tags??[]))).sort((t,e)=>t.localeCompare(e));function ld(t){return{...t,tags:t.tags?[...t.tags]:void 0}}function TN(t){if(typeof t=="string"){let e=id.find(n=>n.id===t);return e?ld(e):null}return ld(t)}function IN(t){if(typeof GM_openInTab=="function")return GM_openInTab(t,{active:!0,insert:!0}),!0;if(typeof window>"u")return!1;try{let e=document.createElement("a");return e.href=t,e.target="_blank",e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),e.remove(),!0}catch{return!1}}var cd={list(){return id.map(ld)},tags(){return AN.map(t=>t)},get(t){let e=id.find(r=>r.id===t);return e?ld(e):null},open(t){let e=TN(t);return e?IN(e.url):!1}};function kN(t){let e=document.createElement("span");return e.textContent=t,e.style.display="inline-flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="2px 8px",e.style.borderRadius="999px",e.style.background="#ffffff11",e.style.border="1px solid #ffffff22",e.style.fontSize="11px",e.style.letterSpacing="0.02em",e.style.textTransform="uppercase",e.style.opacity="0.8",e}function PN(t,e){let n=`${e.icon?`${e.icon} `:""}${e.title}`,r=t.card(n,{tone:"muted",align:"stretch"});r.root.style.width="100%";let o=r.body;o.style.display="grid",o.style.gap="10px",o.style.justifyItems="stretch";let s=document.createElement("p");if(s.textContent=e.description,s.style.margin="0",s.style.fontSize="13px",s.style.lineHeight="1.45",s.style.opacity="0.9",s.style.textAlign="left",o.appendChild(s),e.tags?.length){let l=document.createElement("div");l.style.display="flex",l.style.flexWrap="wrap",l.style.gap="6px",l.style.opacity="0.85",e.tags.forEach(c=>l.appendChild(kN(c))),o.appendChild(l)}let a=t.flexRow({gap:8,justify:"end",fullWidth:!0});a.style.marginTop="4px";let i=t.btn("Open tool",{variant:"primary",icon:"\u{1F517}",fullWidth:!0,title:"Open the tool in a new tab"});return i.style.flex="1 1 auto",i.style.minWidth="0",i.onclick=()=>{cd.open(e)||be("Unable to open link","Please open the address manually.","error")},a.append(i),o.appendChild(a),r.root}async function Lx(t){let e=new Qe({id:"tools",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px",n.style.alignItems="center",n.style.padding="8px",n.style.width="100%",n.style.maxHeight="54vh",n.style.overflowY="auto",n.style.overflowX="auto";let r=720,o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="12px",o.style.width=`${r}px`,o.style.minWidth=`${r}px`,o.style.maxWidth=`${r}px`,o.style.boxSizing="border-box",o.style.alignSelf="center";let s=e.card("\u{1F9F0} Community tools",{tone:"muted",align:"stretch"}),a=document.createElement("p");a.textContent="Discover community-made helpers to plan, calculate, and simplify your Magic Garden adventures.",a.style.margin="0",a.style.fontSize="13px",a.style.lineHeight="1.5",a.style.opacity="0.9",a.style.textAlign="left",s.body.appendChild(a),o.appendChild(s.root);let i=cd.list(),l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.gap="8px",l.style.background="#ffffff08",l.style.border="1px solid #ffffff11",l.style.borderRadius="12px",l.style.padding="12px";let c=document.createElement("span");c.textContent="Filter by tags",c.style.fontSize="12px",c.style.letterSpacing="0.05em",c.style.textTransform="uppercase",c.style.opacity="0.75",c.style.fontWeight="600";let d=document.createElement("div");d.style.display="flex",d.style.flexWrap="wrap",d.style.gap="8px";let u=new Set,y=new Map,h,f,p=x=>{x.type="button",x.style.display="inline-flex",x.style.alignItems="center",x.style.justifyContent="center",x.style.padding="4px 10px",x.style.borderRadius="999px",x.style.border="1px solid",x.style.background="#ffffff11",x.style.borderColor="#ffffff22",x.style.fontSize="11px",x.style.fontWeight="600",x.style.letterSpacing="0.03em",x.style.textTransform="uppercase",x.style.color="inherit",x.style.opacity="0.85",x.style.cursor="pointer",x.style.transition="background 120ms ease, border-color 120ms ease, opacity 120ms ease"},m=(x,E)=>{E?(x.style.background="#2d8cff33",x.style.borderColor="#2d8cff66",x.style.opacity="1"):(x.style.background="#ffffff11",x.style.borderColor="#ffffff22",x.style.opacity="0.85")},g=()=>{f.innerHTML="";let x=u.size?i.filter(E=>E.tags?.some(T=>u.has(T))):i;if(x.length===0){let E=document.createElement("p");E.textContent="No tools match the selected tags yet.",E.style.margin="12px 0 0",E.style.fontSize="13px",E.style.opacity="0.75",E.style.textAlign="center",f.appendChild(E);return}x.forEach(E=>{f.appendChild(PN(e,E))})},S=()=>{y.forEach((x,E)=>{m(x,u.has(E))}),m(h,u.size===0)},w=x=>{u.has(x)?u.delete(x):u.add(x),S(),g()};h=document.createElement("button"),h.textContent="All",p(h),h.onclick=()=>{u.size!==0&&(u.clear(),S(),g())},d.appendChild(h),cd.tags().forEach(x=>{let E=document.createElement("button");E.textContent=x,p(E),E.onclick=()=>w(x),d.appendChild(E),y.set(x,E)}),l.appendChild(c),l.appendChild(d),o.appendChild(l),f=document.createElement("div"),f.style.display="flex",f.style.flexDirection="column",f.style.gap="12px",g(),S(),o.appendChild(f),n.appendChild(o)}function Rx(t){let e=new Qe({id:"editor",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gap="8px",n.style.justifyItems="center";let r=e.card("Editor mode",{tone:"muted",align:"center"});r.header.style.display="none",r.root.style.maxWidth="420px",r.body.style.display="grid",r.body.style.gap="10px";let o=e.flexRow({align:"center",justify:"between",fullWidth:!0}),s=e.label("Editor mode");s.style.margin="0";let a=e.switch(In.isEnabled());a.setAttribute("aria-label","Toggle editor mode"),a.addEventListener("change",()=>{let L=!!a.checked;In.setEnabled(L)}),o.append(s,a),r.body.append(o);let i=document.createElement("div");i.textContent="Sandbox garden editor with every plants and decors unlocked. Build, experiment, and customize without limits",i.style.fontSize="12px",i.style.opacity="0.7",i.style.textAlign="left",i.style.lineHeight="1.4",i.style.width="100%",r.body.append(i);let l=document.createElement("div");l.textContent="Place/Remove uses your action key. Toggle overlays with U.",l.style.fontSize="11px",l.style.opacity="0.65",l.style.textAlign="center",l.style.lineHeight="1.3",l.style.width="100%",r.body.append(l);let c=document.createElement("div");c.textContent="Remove selected item from inventory with Delete.",c.style.fontSize="11px",c.style.opacity="0.65",c.style.textAlign="center",c.style.lineHeight="1.3",c.style.width="100%",r.body.append(c);let d=document.createElement("div");d.textContent="Keys are editable in Keybinds > Editor.",d.style.fontSize="11px",d.style.opacity="0.65",d.style.textAlign="center",d.style.lineHeight="1.3",d.style.width="100%",r.body.append(d);let u=In.onChange(L=>{a.checked=L,A()});n.__cleanup__=()=>{try{u()}catch{}};let y=(L,v)=>{let B=e.card(L,{tone:"muted",align:"center"});return B.root.style.maxWidth="520px",B.body.style.display="grid",B.body.style.gap="8px",B.body.append(v),B},h=document.createElement("div");h.style.fontSize="12px",h.style.opacity="0.7",h.style.minHeight="18px";let f=document.createElement("div");f.style.display="grid",f.style.gap="6px";let p=e.inputText("Garden name","");p.placeholder="Garden name",p.style.width="100%";let m=document.createElement("div");m.style.display="grid",m.style.gridTemplateColumns="1fr 1fr",m.style.gap="8px";let g=e.btn("Save current garden",{variant:"primary",fullWidth:!0,onClick:async()=>{let L=window.qwsEditorSaveGarden;if(typeof L!="function")return;let v=await L(p.value);if(!v){h.textContent="Save failed (no garden state found).";return}h.textContent=`Saved "${v.name}".`,A()}}),S=e.btn("Clear garden",{variant:"secondary",fullWidth:!0,onClick:async()=>{let L=window.qwsEditorClearGarden;if(typeof L!="function")return;let v=await L();h.textContent=v?"Garden cleared.":"Clear failed."}});m.append(g,S),f.append(p,m);let w=document.createElement("div");w.style.display="grid",w.style.gap="6px";let x=document.createElement("textarea");x.placeholder="Paste garden JSON here...",x.style.width="100%",x.style.minHeight="80px",x.style.borderRadius="8px",x.style.border="1px solid #2b3441",x.style.background="rgba(16,21,28,0.9)",x.style.color="#e7eef7",x.style.padding="8px",x.style.fontSize="12px",x.style.fontFamily="monospace";let E=e.btn("Import to saved gardens",{variant:"secondary",fullWidth:!0,onClick:async()=>{let L=window.qwsEditorImportGarden;if(typeof L!="function")return;let v=await L(p.value||"Imported garden",x.value);if(!v){h.textContent="Import failed (invalid JSON).";return}h.textContent=`Imported "${v.name}".`,A()}});E.style.width="100%",w.append(x,E);let T=document.createElement("div");T.style.display="grid",T.style.gap="8px";let A=()=>{let L=window.qwsEditorListSavedGardens,v=window.qwsEditorLoadGarden,B=window.qwsEditorDeleteGarden,le=window.qwsEditorExportGarden;T.innerHTML="";let X=typeof L=="function"?L():[];if(!X||!X.length){let _=document.createElement("div");_.textContent="No saved gardens yet.",_.style.opacity="0.7",_.style.fontSize="12px",T.appendChild(_);return}let de=In.isEnabled();for(let _ of X){let re=document.createElement("div");re.style.display="grid",re.style.gridTemplateColumns="1fr auto auto auto",re.style.gap="6px",re.style.alignItems="center",re.style.padding="8px",re.style.borderRadius="8px",re.style.border="1px solid #2b3441",re.style.background="rgba(16,21,28,0.9)";let R=document.createElement("div");R.textContent=_.name||"Untitled",R.style.fontWeight="700",R.style.fontSize="13px",R.style.overflow="hidden",R.style.textOverflow="ellipsis",R.style.whiteSpace="nowrap";let k=e.btn("Load",{size:"sm",onClick:async()=>{if(!In.isEnabled()){h.textContent="Enable editor mode to load a garden.";return}if(typeof v!="function")return;await v(_.id)?h.textContent=`Loaded "${_.name}".`:h.textContent="Load failed."}});k.disabled=!de,de||(k.title="Enable editor mode to load");let V=e.btn("Export",{size:"sm",variant:"secondary",onClick:async()=>{if(typeof le!="function")return;let ie=le(_.id);if(!ie){h.textContent="Export failed.";return}try{await navigator.clipboard.writeText(ie),h.textContent=`Exported "${_.name}" to clipboard.`,await be("Editor",`Copied "${_.name}" to clipboard`,"success")}catch{h.textContent=`Exported "${_.name}". Copy manually.`,window.prompt("Garden JSON",ie)}}}),ee=e.btn("Delete",{size:"sm",variant:"danger",onClick:()=>{if(typeof B!="function")return;B(_.id)&&(h.textContent=`Deleted "${_.name}".`,A())}});re.append(R,k,V,ee),T.appendChild(re)}};A();let N=y("\u{1F331} Current garden",f),H=y("\u{1F4E5} Import",w),C=y("\u{1F4BE} Saved gardens",T);C.body.append(h),n.append(r.root,N.root,H.root,C.root)}function LN(t,e){let n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.flexWrap="nowrap",n.style.gap="8px";let r=t.hotkeyButton(Et(e.id),f=>$s(e.id,f),{emptyLabel:"Unassigned",listeningLabel:"Press a key\u2026",clearable:!0,allowModifierOnly:e.allowModifierOnly});r.style.flexShrink="0",n.appendChild(r);let o=null;if(e.holdDetection)if(e.id==="game.action"){let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="column",f.style.alignItems="center",f.style.gap="4px",f.style.flex="0 1 160px",f.style.alignSelf="center";let p=t.btn("Hold",{size:"sm",variant:"secondary"});p.style.display="inline-flex",p.style.alignItems="center",p.style.gap="6px",p.setAttribute("aria-label",e.holdDetection.label),p.title=e.holdDetection.label;let m=document.createElement("span");m.textContent="\u25CF",m.style.fontSize="10px",m.style.lineHeight="1",m.setAttribute("aria-hidden","true");let g=document.createElement("span");g.textContent="Hold",p.replaceChildren(m,g);let S=Zs(e.id),w=x=>{S=x,p.setAttribute("aria-pressed",x?"true":"false"),m.style.color=x?"#34c759":"#ff3b30"};if(w(S),p.addEventListener("click",()=>{_u(e.id,!S)}),o=yl(e.id,x=>{w(x)}),f.appendChild(p),e.holdDetection.description){let x=document.createElement("div");x.textContent=e.holdDetection.description,x.style.fontSize="11px",x.style.opacity="0.65",x.style.maxWidth="100%",x.style.textAlign="center",f.appendChild(x)}n.appendChild(f)}else{let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="column",f.style.alignItems="flex-start",f.style.gap="2px",f.style.padding="2px 4px",f.style.borderRadius="8px",f.style.background="rgba(255, 255, 255, 0.04)",f.style.flex="0 1 180px",f.style.maxWidth="180px";let p=document.createElement("label");p.style.display="inline-flex",p.style.alignItems="center",p.style.gap="6px",p.style.fontSize="12px",p.style.cursor="pointer";let m=t.switch(Zs(e.id));m.style.margin="0",m.setAttribute("aria-label",e.holdDetection.label);let g=document.createElement("span");if(g.textContent=e.holdDetection.label,g.style.opacity="0.85",p.append(m,g),f.appendChild(p),e.holdDetection.description){let S=document.createElement("div");S.textContent=e.holdDetection.description,S.style.fontSize="11px",S.style.opacity="0.65",S.style.maxWidth="100%",f.appendChild(S)}m.addEventListener("change",()=>{_u(e.id,m.checked)}),o=yl(e.id,S=>{m.checked=S}),n.appendChild(f)}let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="4px",s.style.marginLeft="auto";let a=e.sectionId==="game"?null:t.btn("",{icon:"\u{1F5D1}\uFE0F",variant:"danger",size:"sm",tooltip:"Remove this shortcut",ariaLabel:"Remove keybind"});a&&s.appendChild(a);let i=Hg(e.id),l=nn(i),c=null;i&&(c=t.btn("",{icon:"\u{1F504}",variant:"primary",size:"sm",tooltip:"Restore default shortcut",ariaLabel:"Reset keybind to default"}),s.appendChild(c));let d=(f,p)=>{if(!f)return;let m=f.setEnabled;m?m(p):(f.disabled=!p,f.classList.toggle("is-disabled",!p),f.setAttribute("aria-disabled",(!p).toString()))},u=f=>{let p=nn(f).length>0;if(a&&d(a,p),c){let m=nn(f)===l;d(c,!m)}};a&&a.addEventListener("click",()=>{$s(e.id,null);let f=Et(e.id);r.refreshHotkey(f),u(f)}),c&&c.addEventListener("click",()=>{Wg(e.id);let f=Et(e.id);r.refreshHotkey(f),u(f)}),n.appendChild(s),u(Et(e.id));let y=Mn(e.id,f=>{r.refreshHotkey(f),u(f)});t.on("unmounted",y),o&&t.on("unmounted",o);let h=t.formRow(e.label,n,{labelWidth:"180px"});if(h.label.style.fontSize="13px",h.label.style.opacity="0.92",e.hint){let f=document.createElement("div");f.textContent=e.hint,f.style.fontSize="11px",f.style.opacity="0.7",f.style.marginTop="2px",f.style.gridColumn="2 / 3",h.root.appendChild(f)}return h.root}async function _x(t){let e=new Qe({id:"keybinds",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px",n.style.padding="8px",n.style.maxHeight="60vh",n.style.overflowY="auto";let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="720px",r.style.margin="0 auto";for(let o of jg()){let s=e.card(`${o.icon} ${o.title}`,{tone:"muted",align:"stretch"});s.root.dataset.section=o.id,s.body.style.display="flex",s.body.style.flexDirection="column",s.body.style.gap="10px";let a=document.createElement("p");a.textContent=o.description,a.style.margin="0",a.style.fontSize="12px",a.style.opacity="0.78",s.body.appendChild(a);for(let i of o.actions){let l=LN(e,i);s.body.appendChild(l)}r.appendChild(s.root)}n.appendChild(r)}function RN(t){if(!t||typeof t!="object")return[];let e=[],n=new Set,r=[t];for(;r.length;){let s=r.pop();if(!(!s||typeof s!="object"||n.has(s))){n.add(s);for(let a of Object.keys(s)){let i=s[a];Array.isArray(i)&&i.length&&i.every(l=>l&&typeof l=="object")&&i.some(c=>"id"in c&&"name"in c)&&/player/i.test(a)&&e.push(...i),i&&typeof i=="object"&&r.push(i)}}}let o=new Map;for(let s of e)s?.id&&o.set(String(s.id),s);return[...o.values()]}function Nx(t){let e=t?.fullState?.data?.players??t?.data?.players??t?.players;return Array.isArray(e)?e:RN(t)}function of(t){let e=t?.child?.data?.userSlots??t?.fullState?.child?.data?.userSlots??t?.data?.userSlots;if(Array.isArray(e))return e;if(e&&typeof e=="object"){let n=Object.entries(e);return n.sort((r,o)=>{let s=Number(r[0]),a=Number(o[0]);return Number.isFinite(s)&&Number.isFinite(a)?s-a:r[0].localeCompare(o[0])}),n.map(([,r])=>r)}return[]}function Fx(t){let e=t?.data?.position??t?.position??t?.data?.coords??t?.coords,n=Number(e?.x),r=Number(e?.y);return Number.isFinite(n)&&Number.isFinite(r)?{x:n,y:r}:null}function Bx(t){let e=t?.data?.inventory;if(!e||typeof e!="object")return null;let n=Array.isArray(e.items)?e.items:[],r=Array.isArray(e.favoritedItemIds)?e.favoritedItemIds:[];return{items:n,favoritedItemIds:r}}function _N(t){let e=t?.data?.journal??t?.journal;if(!e||typeof e!="object")return null;let n=e.produce&&typeof e.produce=="object"?e.produce:void 0,r=e.pets&&typeof e.pets=="object"?e.pets:void 0,o=n?Object.fromEntries(Object.entries(n).map(([a,i])=>[String(a),{variantsLogged:Array.isArray(i?.variantsLogged)?i.variantsLogged:[]}])):void 0,s=r?Object.fromEntries(Object.entries(r).map(([a,i])=>[String(a),{variantsLogged:Array.isArray(i?.variantsLogged)?i.variantsLogged:[],abilitiesLogged:Array.isArray(i?.abilitiesLogged)?i.abilitiesLogged:[]}])):void 0;return{produce:o,pets:s}}function NN(t){let e=t?.data?.stats??t?.stats;return!e||typeof e!="object"?null:e}function DN(t){let e=t?.data?.activityLogs??t?.activityLogs;return Array.isArray(e)?e:null}function qN(t){let e=t?.data?.garden??t?.garden;if(!e||typeof e!="object")return null;let n=e.tileObjects,r=e.boardwalkTileObjects;return{tileObjects:n&&typeof n=="object"?n:{},boardwalkTileObjects:r&&typeof r=="object"?r:{}}}function cs(t,e){for(let n of of(t))if(String(n?.playerId??"")===String(e))return n;return null}function ON(t,e){let n=new Map;for(let r of of(e)){if(!r||typeof r!="object")continue;let o=r.playerId!=null?String(r.playerId):"";if(!o)continue;let s=Fx(r),a=Bx(r);n.set(o,{x:s?.x,y:s?.y,inventory:a??null})}return t.map(r=>{let o=n.get(String(r.id));return o?{...r,...o}:{...r,inventory:null}})}function FN(t,e){let n=of(e),r=new Map;for(let a of t)r.set(String(a.id),a);let o=[],s=new Set;for(let a of n){let i=a?.playerId!=null?String(a.playerId):"";if(!i||s.has(i))continue;let l=r.get(i);l&&(o.push(l),s.add(i))}for(let a of t){let i=String(a.id);s.has(i)||(o.push(a),s.add(i))}return o}function BN(t){let e=Math.floor(Number(t));return Number.isFinite(e)?Math.max(1,Math.min(6,e)):1}async function Dx(){try{let t=await ce.server.numPlayers.get();return BN(t)}catch{return 1}}var kr=null,$a=null;async function HN(){if(Array.isArray(kr))return kr;if($a)return $a;$a=(async()=>{try{let n=(await ce.root.map.get())?.spawnTiles;if(Array.isArray(n)&&n.every(r=>Number.isFinite(r)))return kr=[...n].sort((r,o)=>r-o),kr}catch{}try{let e=await ce.root.state.get(),n=new Set,r=[e];for(;r.length;){let o=r.pop();if(!o||typeof o!="object"||n.has(o))continue;n.add(o);let s=o?.spawnTiles;if(Array.isArray(s)&&s.every(a=>Number.isFinite(a)))return kr=[...s].sort((a,i)=>a-i),kr;for(let a of Object.keys(o)){let i=o[a];i&&typeof i=="object"&&r.push(i)}}}catch{}return kr=[],kr})();let t=await $a;return $a=null,t}async function WN(){try{let t=await ce.root.map.get(),e=Number(t?.cols);if(Number.isFinite(e)&&e>0)return e}catch{}try{let t=await ce.root.state.get(),e=Number(t?.map?.cols??t?.child?.data?.map?.cols??t?.fullState?.map?.cols);if(Number.isFinite(e)&&e>0)return e}catch{}return 81}function zN(t,e){if(!t.length||!e.length)return t.map(r=>({...r,gardenPosition:null}));let n=[];for(let r=0;r<t.length;r++)n.push({...t[r],gardenPosition:e[r]??null});return n}function rf(){return Date.now()}function GN(t){if(!t||typeof t!="object")return{};let e={};return t.produce&&typeof t.produce=="object"&&(e.produce=t.produce),t.pets&&typeof t.pets=="object"&&(e.pets=t.pets),e}function jN(t){if(!t)return!1;let e=!!t.produce&&Object.values(t.produce).some(r=>(r.variantsLogged?.length??0)>0),n=!!t.pets&&Object.values(t.pets).some(r=>(r.variantsLogged?.length??0)>0||(r.abilitiesLogged?.length??0)>0);return e||n}var rt={currentTargetId:null,unsub:null,lastPos:null,prevPos:null,steps:0},KN=20,UN=3,qx=1,Ue={targetId:null,unsub:null,timer:null,pets:[],history:[],historyCap:0};function VN(){Ue.timer&&(clearInterval(Ue.timer),Ue.timer=null)}async function YN(){if(Ue.unsub){let t=Ue.unsub;Ue.unsub=null;try{await t()}catch{}}else Ue.unsub=null;VN(),Ue.targetId=null,Ue.pets=[],Ue.history=[],Ue.historyCap=0}function Ox(t,e=!1){let n=Ue.history[0];if(!e&&n&&n.x===t.x&&n.y===t.y)return;Ue.history.unshift({x:t.x,y:t.y});let r=Ue.historyCap||Ue.history.length;Ue.history.length>r&&(Ue.history.length=r)}var St={async list(){let t=await ce.root.state.get();if(!t)return[];let e=ON(Nx(t),t),n=FN(e,t),r=await HN();return zN(n,r)},async onChange(t){return ce.root.state.onChange(async()=>{try{t(await this.list())}catch{}})},async getPosition(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t);return Fx(n)},async getInventory(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t);return Bx(n)},async getJournal(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t),r=_N(n);return r?GN(r):null},async getGarden(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t);return qN(n)},async getGardenPosition(t){return(await this.list()).find(r=>String(r.id)===String(t))?.gardenPosition??null},async getPlayerNameById(t){try{let e=await ce.root.state.get();if(e){let r=Nx(e).find(o=>String(o?.id)===String(t));if(r&&typeof r.name=="string"&&r.name)return r.name}}catch{}try{return(await this.list()).find(r=>String(r.id)===String(t))?.name??null}catch{return null}},async teleportToPlayer(t){let e=await this.getPosition(t);if(!e)throw new Error("Unknown position for this player");we.teleport(e.x,e.y),be("Teleport",`Teleported to ${await this.getPlayerNameById(t)}`,"success")},async teleportToGarden(t){let e=await this.getGardenPosition(t);if(e==null){await be("Teleport","No garden position for this player.","error");return}let n=await WN(),r=e%n,o=Math.floor(e/n);await we.teleport(r,o),await be("Teleport",`Teleported to ${await this.getPlayerNameById(t)}'s garden`,"success")},async getInventoryValue(t,e){try{let n=await Dx(),r=await this.getInventory(t),o=Array.isArray(r?.items)?r.items:[];return o.length?ES(o,e,n):0}catch{return 0}},async getGardenValue(t,e){try{let n=await Dx(),r=await this.getGarden(t);return r?CS(r.tileObjects??{},e,n):0}catch{return 0}},async openInventoryPreview(t,e){try{let n=await this.getInventory(t);if(!n){await be("Inventory","No inventory object found for this player.","error");return}let r=Array.isArray(n.items)?n.items:[];if(r.length===0){await be("Inventory","Inventory is empty for this player.","info");return}try{await Dt({...n,items:r},{open:!0})}catch(o){await be("Inventory",o?.message||"Failed to open inventory","error");return}e&&await be("Inventory",`${e}'s inventory displayed.`,"info")}catch(n){await be("Inventory",n?.message||"Failed to open inventory.","error")}},async openJournalLog(t,e){try{let n=await this.getJournal(t);if(!jN(n)){await be("Journal","No journal data for this player.","error");return}let r=n??{};try{await Or(r,{open:!0})}catch(o){await be("Journal",o?.message||"Failed to open journal.","error");return}e&&await be("Journal",`${e}'s journal displayed.`,"info")}catch(n){await be("Journal",n?.message||"Failed to open journal.","error")}},async getStats(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t);return NN(n)},async getActivityLogs(t){let e=await ce.root.state.get();if(!e)return null;let n=cs(e,t);return DN(n)},async openStatsModal(t,e){try{let n=await this.getStats(t);if(!n){await be("Stats","No stats found for this player.","error");return}await Pi(n,{open:!0}),e&&await be("Stats",`${e}'s stats displayed.`,"info")}catch(n){await be("Stats",n?.message||"Failed to open stats modal.","error")}},async openActivityLogModal(t,e){try{let n=await this.getActivityLogs(t);if(!n||n.length===0){await be("Activity log","No activity logs for this player.","info");return}await bo(n,{open:!0}),e&&await be("Activity log",`${e}'s activity log displayed.`,"info")}catch(n){await be("Activity log",n?.message||"Failed to open activity log.","error")}},async addProduceVariant(t,e,n,r=rf()){if(!e||!n){await be("Journal","Missing species or variant.","error");return}try{await Or({produce:{[String(e)]:{variantsLogged:[{variant:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await be("Journal",`Added produce variant "${n}" for ${o??t}.`,"success")}catch(o){await be("Journal",o?.message||"Failed to add produce variant.","error")}},async addPetVariant(t,e,n,r=rf()){if(!e||!n){await be("Journal","Missing pet species or variant.","error");return}try{await Or({pets:{[String(e)]:{variantsLogged:[{variant:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await be("Journal",`Added pet variant "${n}" for ${o??t}.`,"success")}catch(o){await be("Journal",o?.message||"Failed to add pet variant.","error")}},async addPetAbility(t,e,n,r=rf()){if(!e||!n){await be("Journal","Missing pet species or ability.","error");return}try{await Or({pets:{[String(e)]:{abilitiesLogged:[{ability:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await be("Journal",`Added pet ability "${n}" for ${o??t}.`,"success")}catch(o){await be("Journal",o?.message||"Failed to add pet ability.","error")}},async stopFollowing(){if(rt.unsub)try{await rt.unsub()}catch{}rt.unsub=null,rt.currentTargetId=null,rt.lastPos=null,rt.prevPos=null,rt.steps=0},isFollowing(t){return rt.currentTargetId===t},async startFollowing(t){if(rt.unsub){try{await rt.unsub()}catch{}rt.unsub=null}rt.currentTargetId=t,rt.lastPos=null,rt.prevPos=null,rt.steps=0;let e=await this.getPosition(t);if(!e){await be("Follow","Unable to retrieve player position.","error"),rt.currentTargetId=null;return}await we.teleport(e.x,e.y),rt.lastPos={x:e.x,y:e.y},rt.prevPos=null,rt.steps=0,rt.unsub=await this.onChange(async n=>{if(rt.currentTargetId!==t)return;let r=n.find(a=>a.id===t);if(!r||typeof r.x!="number"||typeof r.y!="number"){await this.stopFollowing(),await be("Follow","The target is no longer trackable (disconnected?).","error");return}let o={x:r.x,y:r.y},s=rt.lastPos;if(!s){rt.lastPos=o;return}(o.x!==s.x||o.y!==s.y)&&(rt.steps+=1,rt.steps>=2&&s&&we.move(s.x,s.y),rt.prevPos=rt.lastPos,rt.lastPos=o)}),await be("Follow","Follow enabled","success")},async stopPetFollowing(t){await YN(),t?.silent||await be("Pet follow",t?.message??"Disabled.",t?.tone??"info")},isPetFollowing(t){return Ue.targetId===t},async startPetFollowing(t){await this.stopPetFollowing({silent:!0});let e=await ce.pets.myPetInfos.get(),n=Array.isArray(e)?e.map(a=>a?.slot?.id).filter(a=>typeof a=="string"&&!!a):[];if(!n.length){await be("Pet follow","You don't have any active pets.","error");return}let r=await this.getPosition(t);if(!r){await be("Pet follow","Unable to retrieve player position.","error");return}Ue.targetId=t,Ue.pets=n,Ue.historyCap=Math.max(n.length*UN,n.length+qx+1),Ue.history=[];for(let a=0;a<Ue.historyCap;a+=1)Ox(r,!0);let o=async()=>{if(Ue.targetId!==t||!Ue.pets.length||!Ue.history.length)return;let a={};for(let i=0;i<Ue.pets.length;i+=1){let l=Ue.pets[i],c=Math.min(Ue.history.length-1,(i+1)*qx),d=Ue.history[c]??Ue.history[Ue.history.length-1];d&&(a[l]={x:d.x,y:d.y})}if(Object.keys(a).length!==0)try{await we.petPositions(a)}catch{}};Ue.timer=setInterval(()=>{o().catch(()=>{})},KN);let s=o();Ue.unsub=await this.onChange(async a=>{if(Ue.targetId!==t)return;let i=a.find(l=>l.id===t);if(!i||typeof i.x!="number"||typeof i.y!="number"){await this.stopPetFollowing({silent:!1,message:"Target is no longer trackable.",tone:"error"});return}Ox({x:i.x,y:i.y})}),await s,await be("Pet follow","Pets are now following the target.","success")}};var Hx="mc-room-menu-loading-style";function Gx(){if(document.getElementById(Hx))return;let t=document.createElement("style");t.id=Hx,t.textContent=`
@keyframes room-menu-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.qmm.qmm-room-menu .qmm-tab[data-id="public-rooms"],
.qmm.qmm-room-menu .qmm-tab[data-id="search-player"],
.qmm.qmm-room-menu .qmm-tab[data-id="players"] {
  flex: 0 1 auto;
  min-width: 160px;
}
`,document.head.appendChild(t)}var QN="public-rooms";var JN="search-player",$N="players";async function jx(t){let e=new Qe({id:"room",compact:!0,windowSelector:".qws-win",classes:"qmm-room-menu"});e.addTab(QN,"Public Rooms",n=>ZN(n,e)),e.addTab(JN,"Search Player",n=>nD(n,e)),e.addTab($N,"Players",n=>{lD(n).catch(()=>{})}),e.mount(t)}function ZN(t,e){t.innerHTML="",Gx();let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.padding="12px",n.style.boxSizing="border-box",n.style.height="100%",n.style.minHeight="0",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="640px",r.style.height="100%",r.style.gridTemplateRows="max-content max-content 1fr max-content",n.appendChild(r);let o=document.createElement("div");if(o.textContent="Select a public room to quickly join a game.",o.style.fontSize="14px",o.style.opacity="0.9",Zn.isDiscordActivity()){let R=document.createElement("div");R.textContent="You are using Discord: direct join is disabled. Open the official website to join a room.",R.style.fontSize="13px",R.style.lineHeight="1.4",R.style.padding="10px 12px",R.style.borderRadius="8px",R.style.background="#2e1f1f",R.style.color="#ffb4a2",R.style.border="1px solid rgba(255, 140, 105, 0.35)",r.appendChild(R)}let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="12px",s.style.width="100%",s.style.margin="12px 0 6px",s.appendChild(o),r.appendChild(s);let a=document.createElement("div");a.style.height="54vh",a.style.maxHeight="54vh",a.style.overflowY="auto",a.style.padding="6px 2px",a.style.borderRadius="10px",a.style.background="rgba(12, 13, 20, 0.65)",a.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.04)",a.style.width="100%",a.style.boxSizing="border-box",a.style.position="relative";let i=document.createElement("div");i.style.position="absolute",i.style.top="14px",i.style.right="14px",i.style.width="28px",i.style.height="28px",i.style.borderRadius="999px",i.style.display="flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.background="rgba(14, 16, 25, 0.9)",i.style.border="1px solid rgba(255, 255, 255, 0.08)",i.style.boxShadow="0 10px 24px rgba(0, 0, 0, 0.45)",i.style.opacity="0",i.style.visibility="hidden",i.style.pointerEvents="none",i.style.transition="opacity 160ms ease, transform 160ms ease",i.style.zIndex="3";let l=document.createElement("div");l.style.width="16px",l.style.height="16px",l.style.borderRadius="999px",l.style.border="2px solid rgba(248, 250, 252, 0.16)",l.style.borderTopColor="#f8fafc",l.style.animation="room-menu-spin 1s linear infinite",i.appendChild(l);let c=document.createElement("div");c.style.display="grid",c.style.gap="10px",c.style.padding="4px",a.appendChild(c),a.appendChild(i),r.appendChild(a);let d=()=>{i.style.transform=`translateY(${a.scrollTop}px)`},u=!1,y=R=>{R?(u=!0,d(),i.style.visibility="visible",i.style.opacity="1"):(u=!1,i.style.opacity="0",i.addEventListener("transitionend",()=>{u||(i.style.visibility="hidden")},{once:!0}),window.setTimeout(()=>{u||(i.style.visibility="hidden")},220))},h=0;a.addEventListener("scroll",()=>{h=a.scrollTop,u&&d()});let f=!1,p=0,m=!0,g="any",S=[],w=e.btn("Refresh rooms",{size:"sm",icon:"\u{1F504}"});w.style.flexShrink="0",w.setAttribute("aria-label","Refresh public rooms list");let x=document.createElement("div");x.style.fontSize="12px",x.style.opacity="0.75",x.style.marginLeft="auto",x.style.textAlign="right",x.textContent="Loading rooms\u2026";let E=document.createElement("div");E.style.display="flex",E.style.alignItems="center",E.style.gap="12px",E.style.marginTop="8px",E.style.width="100%",E.appendChild(w),E.appendChild(x),r.appendChild(E);let T=!1,A=()=>{let R=!f&&!T;e.setButtonEnabled(w,R),w.setAttribute("aria-busy",T?"true":"false")},N=R=>{switch(g){case"any":return!0;case"empty":return R.players===0;case"few":return R.players>0&&R.players<=3;case"crowded":return!R.isFull&&R.players>=4;case"full":return R.isFull;default:return!0}},H=R=>{S=R,c.innerHTML="";let k=R.filter(V=>N(V));if(k.length)for(let V of k)c.appendChild(Ux(V,e));else{let V=document.createElement("div");V.textContent=R.length?"No rooms match the selected filter.":"No public rooms available.",V.style.padding="16px",V.style.textAlign="center",V.style.opacity="0.7",c.appendChild(V)}requestAnimationFrame(()=>{let V=Math.max(0,a.scrollHeight-a.clientHeight),ee=Math.min(h,V);a.scrollTop=ee,h=ee})},C=document.createElement("div");C.style.display="flex",C.style.alignItems="center",C.style.gap="6px",C.style.padding="4px 6px",C.style.background="rgba(24, 26, 36, 0.85)",C.style.borderRadius="10px",C.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.05)";let L=document.createElement("span");L.textContent="Players",L.style.fontSize="12px",L.style.opacity="0.75",L.style.paddingLeft="2px",C.appendChild(L);let v=document.createElement("select");v.style.background="rgba(17, 18, 27, 0.95)",v.style.border="1px solid rgba(255, 255, 255, 0.08)",v.style.color="#f8fafc",v.style.borderRadius="8px",v.style.padding="4px 10px",v.style.fontSize="12px",v.style.fontWeight="500",v.style.outline="none",v.style.cursor="pointer",v.style.minWidth="130px";let B=[{value:"any",label:"Any players"},{value:"empty",label:"Empty rooms"},{value:"few",label:"1 - 3 players"},{value:"crowded",label:"4 - 5 players"},{value:"full",label:"Full rooms"}];for(let R of B){let k=document.createElement("option");k.value=R.value,k.textContent=R.label,v.appendChild(k)}v.value=g,v.addEventListener("change",()=>{g=v.value,h=0,H(S)}),C.appendChild(v),C.style.marginLeft="auto",s.appendChild(C);let le=async()=>{if(f)return;let R=++p;T=!0,A(),y(!0),x.textContent=m?"Loading rooms...":"Refreshing rooms...";try{let k=await Cd(100);if(f||R!==p)return;let V=k.filter(ie=>!ie.isPrivate).map(Kx).sort((ie,fe)=>fe.players===ie.players?fe.lastUpdatedAt-ie.lastUpdatedAt:fe.players-ie.players);H(V);let ee=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});x.textContent=`Last update: ${ee}`}catch(k){if(f||R!==p)return;x.textContent=`Failed to load rooms: ${String(k?.message||k)}`}finally{!f&&R===p&&y(!1),R===p&&(T=!1),A(),m=!1}};w.addEventListener("click",()=>{le()}),A(),le();let X=t.closest(".qws-win"),de=R=>!R.classList.contains("is-hidden")&&getComputedStyle(R).display!=="none",_=null;if(X){let R=de(X);_=new MutationObserver(()=>{if(f)return;let k=de(X);k&&!R&&le(),R=k}),_.observe(X,{attributes:!0,attributeFilter:["class","style"]})}let re=t.__cleanup__;t.__cleanup__=()=>{if(f=!0,_?.disconnect(),A(),typeof re=="function")try{re.call(t)}catch{}}}var XN=6,eD=/^I-\d{17,19}-[A-Z]{2,3}-\d{17,19}(?:-\d{17,19})?$/;function tD(t){return eD.test(t)?"Discord":"Web"}function Kx(t){let e=Number.isFinite(t.playersCount)?Math.floor(t.playersCount):0,n=Math.max(0,e),r=XN,o=Number.isFinite(Date.parse(t.lastUpdatedAt))?Date.parse(t.lastUpdatedAt):Date.now(),s=(t.userSlots??[]).map((a,i)=>{let l=a?.name?.trim();return{name:l&&l.length?l:"Unknown player",isConnected:!0,discordAvatarUrl:a?.avatarUrl??void 0,isHost:i===0}});return{name:t.id,idRoom:t.id,category:tD(t.id),players:Math.min(n,r),capacity:r,isFull:n>=r,lastUpdatedAt:o,hostPlayerId:t.lastUpdatedByPlayerId??void 0,playerDetails:s}}function nD(t,e){t.innerHTML="",Gx();let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.padding="12px",n.style.boxSizing="border-box",n.style.height="100%",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="640px",r.style.gridTemplateRows="max-content max-content max-content 1fr",r.style.height="100%",n.appendChild(r);let o=document.createElement("div");o.textContent="Search for a player across all available rooms.",o.style.fontSize="14px",o.style.opacity="0.9",r.appendChild(o);let s=document.createElement("div");s.textContent="Enter at least three characters to look for matching player names.",s.style.fontSize="12px",s.style.opacity="0.72",s.style.lineHeight="1.45",r.appendChild(s);let a=document.createElement("form");a.style.display="flex",a.style.flexWrap="wrap",a.style.alignItems="center",a.style.gap="8px",r.appendChild(a);let i=document.createElement("input");i.type="search",i.placeholder="Player name\u2026",i.autocomplete="off",i.spellcheck=!1,i.style.flex="1",i.style.minWidth="200px",i.style.padding="10px 12px",i.style.borderRadius="10px",i.style.border="1px solid rgba(255, 255, 255, 0.08)",i.style.background="rgba(17, 18, 27, 0.95)",i.style.color="#f8fafc",i.style.fontSize="13px",i.style.fontWeight="500",i.style.outline="none",i.style.boxShadow="0 6px 16px rgba(15, 23, 42, 0.45)",a.appendChild(i);let l=e.btn("Search",{size:"sm",icon:"search",variant:"primary"});l.type="submit",l.style.flexShrink="0",l.title="Search for a player across rooms",a.appendChild(l);let c=document.createElement("div");c.style.fontSize="12px",c.style.opacity="0.75",c.style.minHeight="18px",c.textContent="Enter a player name to search across rooms.",r.appendChild(c);let d=document.createElement("div");d.style.height="54vh",d.style.maxHeight="54vh",d.style.overflowY="auto",d.style.padding="6px 2px",d.style.borderRadius="10px",d.style.background="rgba(12, 13, 20, 0.65)",d.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.04)",d.style.width="100%",d.style.boxSizing="border-box",d.style.position="relative";let u=document.createElement("div");u.style.position="absolute",u.style.top="14px",u.style.right="14px",u.style.width="28px",u.style.height="28px",u.style.borderRadius="999px",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center",u.style.background="rgba(14, 16, 25, 0.9)",u.style.border="1px solid rgba(255, 255, 255, 0.08)",u.style.boxShadow="0 10px 24px rgba(0, 0, 0, 0.45)",u.style.opacity="0",u.style.visibility="hidden",u.style.pointerEvents="none",u.style.transition="opacity 160ms ease, transform 160ms ease",u.style.zIndex="3";let y=document.createElement("div");y.style.width="16px",y.style.height="16px",y.style.borderRadius="999px",y.style.border="2px solid rgba(248, 250, 252, 0.16)",y.style.borderTopColor="#f8fafc",y.style.animation="room-menu-spin 1s linear infinite",u.appendChild(y);let h=document.createElement("div");h.style.display="grid",h.style.gap="10px",h.style.padding="4px",d.appendChild(h),d.appendChild(u),r.appendChild(d);let f=C=>{h.innerHTML="";let L=document.createElement("div");L.textContent=C,L.style.padding="16px",L.style.textAlign="center",L.style.opacity="0.7",L.style.fontSize="13px",h.appendChild(L)};f("Search results will appear here.");let p=()=>{u.style.transform=`translateY(${d.scrollTop}px)`},m=!1,g=C=>{C?(m=!0,p(),u.style.visibility="visible",u.style.opacity="1"):(m=!1,u.style.opacity="0",u.addEventListener("transitionend",()=>{m||(u.style.visibility="hidden")},{once:!0}),window.setTimeout(()=>{m||(u.style.visibility="hidden")},220))};d.addEventListener("scroll",()=>{m&&p()});let S=!1,w=!1,x=0,E="",T=()=>{let C=i.value.trim().length>=3;e.setButtonEnabled(l,C&&!S),l.setAttribute("aria-busy",S?"true":"false")},A=C=>{let L=C.trim();if(!L)return"";try{return L.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}catch{return L.toLowerCase()}},N=C=>{let L=new Set,v=new Set,B=new Set;for(let le of C)le.id&&L.add(le.id),le.databaseUserId&&v.add(le.databaseUserId),B.add(A(le.name));return le=>le.id&&L.has(le.id)||le.databaseUserId&&v.has(le.databaseUserId)?!0:B.has(A(le.name))},H=async C=>{let L=C.trim();if(!A(L)){c.textContent="Enter a player name to search across rooms.",f("Search results will appear here."),E="";return}if(L.length<3){c.textContent="Please enter at least three characters.",f("Type a longer name to search for players."),E="";return}let B=++x;S=!0,T(),g(!0),c.textContent="Searching players...";try{let le=await Af(L,{limitRooms:200,minQueryLength:3});if(w||B!==x)return;if(!le.length){c.textContent=`No players found matching "${L}".`,f("No rooms contain a player with this name."),E=L;return}let X=le.map(k=>{let V=Kx(k.room),ee=k.matchedSlots?.map(ie=>({name:ie.name?.trim()||"Unknown player",isConnected:!0,isHost:!1,discordAvatarUrl:ie.avatarUrl??void 0}))??[];return{room:V,players:ee}}).filter(k=>k.players.length>0);if(!X.length){c.textContent=`No players found matching "${L}".`,f("No rooms contain a player with this name."),E=L;return}X.sort((k,V)=>{let ee=V.room.players-k.room.players;return ee!==0?ee:V.players.length!==k.players.length?V.players.length-k.players.length:k.room.name.localeCompare(V.room.name)});let de=X.reduce((k,V)=>k+V.players.length,0),_=X.length===1?"room":"rooms",re=de===1?"player":"players";c.textContent=`Found ${de} ${re} in ${X.length} ${_}.`,h.innerHTML="";let R=!0;for(let k of X){let V=N(k.players),ee=Ux(k.room,e,{highlightPlayers:V,defaultDetailsOpen:!0,scrollHighlightedPlayersIntoView:R});h.appendChild(ee),R=!1}E=L}catch(le){if(w||B!==x)return;let X=le?.message||String(le);c.textContent=`Search failed: ${X}`,f("Unable to complete the search. Please try again.")}finally{!w&&B===x&&(S=!1,g(!1),T())}};a.addEventListener("submit",C=>{C.preventDefault(),H(i.value)}),i.addEventListener("input",()=>{T();let C=i.value.trim();!C&&E?(c.textContent="Enter a player name to search across rooms.",f("Search results will appear here."),E=""):!S&&C.length>0&&C.length<3&&(c.textContent="Type at least three characters to start a search.")}),T(),t.__cleanup__=()=>{w=!0}}function rD(){let t=/^\/r\/([^/]+)/.exec(location.pathname);if(!t)return null;try{return decodeURIComponent(t[1])}catch{return t[1]}}var Wx=12;function oD(t){return t.category==="Discord"&&t.name.length>Wx?`${t.name.slice(0,Wx)}\u2026`:t.name}function Ux(t,e,n){let r=Zn.isDiscordActivity(),s=rD()===t.idRoom,a=Array.isArray(t.playerDetails)?t.playerDetails:[],i=document.createElement("div");i.style.display="grid",i.style.gap="8px",i.style.padding="14px 16px",i.style.borderRadius="14px",i.style.background="linear-gradient(135deg, rgba(30, 33, 46, 0.95), rgba(18, 19, 28, 0.95))",i.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.35)",i.style.position="relative";let l=document.createElement("div");l.style.overflow="hidden",l.style.maxHeight="0",l.style.opacity="0",l.style.transition="max-height 0.25s ease, opacity 0.2s ease, margin-top 0.2s ease",l.style.marginTop="0";let c=document.createElement("div");c.style.display="grid",c.style.gap="10px",c.style.paddingTop="12px",c.style.paddingLeft="6px",c.style.paddingRight="6px",c.style.paddingBottom="4px",c.style.borderTop="1px solid rgba(148, 163, 184, 0.16)",l.appendChild(c);let d=document.createElement("div");d.textContent="Players",d.style.fontSize="13px",d.style.fontWeight="600",d.style.letterSpacing="0.02em",d.style.color="#e2e8f0",c.appendChild(d);let u=[];if(a.length){let _=document.createElement("ul");_.style.listStyle="none",_.style.margin="0",_.style.padding="0",_.style.display="grid",_.style.gap="10px",_.style.gridTemplateColumns="repeat(2, minmax(0, 1fr))";for(let re of a){let R=document.createElement("li");R.style.display="flex",R.style.alignItems="center",R.style.gap="12px",R.style.padding="6px 0";let k=document.createElement("div");if(k.style.width="36px",k.style.height="36px",k.style.borderRadius="999px",k.style.overflow="hidden",k.style.flexShrink="0",k.style.display="grid",k.style.placeItems="center",k.style.border="1px solid rgba(148, 163, 184, 0.25)",k.style.background="linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(14, 165, 233, 0.2))",re.discordAvatarUrl){let j=document.createElement("img");j.src=re.discordAvatarUrl,j.alt=`${re.name}'s avatar`,j.loading="lazy",j.style.width="100%",j.style.height="100%",j.style.objectFit="cover",k.appendChild(j)}else{let j=document.createElement("span");j.textContent=re.name.charAt(0)?.toUpperCase()||"?",j.style.fontWeight="600",j.style.fontSize="14px",j.style.color="#e2e8f0",k.appendChild(j)}let V=document.createElement("div");V.style.display="grid",V.style.gap="4px";let ee=document.createElement("div");ee.style.display="flex",ee.style.alignItems="center",ee.style.gap="8px";let ie=document.createElement("div");ie.textContent=re.name,ie.style.fontWeight="600",ie.style.fontSize="14px",ie.style.color="#f8fafc",ee.appendChild(ie);let fe=document.createElement("div");fe.style.display="flex",fe.style.alignItems="center",fe.style.gap="10px",fe.style.fontSize="11px",fe.style.color="rgba(226, 232, 240, 0.75)";let G=document.createElement("span");G.style.display="inline-flex",G.style.alignItems="center",G.style.gap="6px";let Z=document.createElement("span");Z.style.width="8px",Z.style.height="8px",Z.style.borderRadius="999px",Z.style.background=re.isConnected?"#34d399":"#f97316",G.appendChild(Z),G.append(re.isConnected?"Online":"Offline"),fe.appendChild(G),V.append(ee,fe),R.append(k,V),n?.highlightPlayers?.(re)&&(R.style.background="rgba(34, 197, 94, 0.12)",R.style.borderRadius="12px",R.style.padding="10px",R.style.margin="-2px",R.style.boxShadow="inset 0 0 0 1px rgba(34, 197, 94, 0.35)",k.style.border="1px solid rgba(74, 222, 128, 0.65)",ie.style.color="#bbf7d0",fe.style.color="rgba(190, 242, 100, 0.85)",Z.style.background="#4ade80",R.dataset.highlightedPlayer="true",u.push(R)),_.appendChild(R)}c.appendChild(_)}else{let _=document.createElement("div");_.textContent=t.error?"Player details unavailable.":"No player details available.",_.style.fontSize="12px",_.style.color="rgba(226, 232, 240, 0.7)",c.appendChild(_)}let y=t.error?"rgba(248, 180, 127, 0.9)":t.isFull?"rgba(248, 113, 113, 0.85)":t.players<=5?"rgba(74, 222, 128, 0.75)":"rgba(96, 165, 250, 0.45)";i.style.setProperty("--accent-color",y),i.style.outline="2px solid transparent",i.style.outlineOffset="0",i.style.border="1px solid rgba(255, 255, 255, 0.05)",i.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.35), inset 0 0 0 1px rgba(255, 255, 255, 0.04), 0 0 0 2px var(--accent-color)";let h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.alignItems="center",h.style.justifyContent="space-between",h.style.gap="12px";let f=document.createElement("div");f.style.display="grid",f.style.gap="6px";let p=document.createElement("div");p.style.display="flex",p.style.alignItems="center",p.style.gap="10px";let m=document.createElement("div");m.textContent=oD(t),m.title=t.name,m.style.fontWeight="600",m.style.fontSize="16px",m.style.letterSpacing="0.01em",m.style.color="#f8fafc";let g=document.createElement("span");if(g.textContent=t.category,g.style.fontSize="11px",g.style.letterSpacing="0.08em",g.style.textTransform="uppercase",g.style.padding="4px 8px",g.style.borderRadius="999px",g.style.background="rgba(148, 163, 184, 0.12)",g.style.border="1px solid rgba(148, 163, 184, 0.22)",g.style.color="#cbd5f5",p.append(m,g),f.appendChild(p),t.currentGame&&t.currentGame.toLowerCase()!=="quinoa"){let _=document.createElement("div");_.textContent=t.currentGame,_.style.fontSize="12px",_.style.opacity="0.7",_.style.color="#e0f2fe",f.appendChild(_)}let S=document.createElement("div");S.style.display="grid",S.style.gap="6px",S.style.minWidth="120px";let w=document.createElement("div");w.style.position="relative",w.style.height="20px",w.style.borderRadius="999px",w.style.background="rgba(255, 255, 255, 0.08)",w.style.overflow="hidden",w.style.display="flex",w.style.alignItems="center",w.style.justifyContent="center",w.style.fontWeight="600",w.style.fontSize="12px",w.style.color="#f8fafc",w.style.fontVariantNumeric="tabular-nums",w.style.textShadow="0 1px 2px rgba(0, 0, 0, 0.55)";let x=document.createElement("div");x.style.position="absolute",x.style.left="0",x.style.top="0",x.style.bottom="0",x.style.height="100%",x.style.width=`${Math.min(100,t.players/t.capacity*100)}%`,x.style.background=t.isFull?"linear-gradient(90deg, #ef4444, #f87171)":"linear-gradient(90deg, #34d399, #2dd4bf)",x.style.borderRadius="inherit",w.appendChild(x);let E=document.createElement("span");E.textContent=`${t.players} / ${t.capacity} players`,E.style.position="relative",E.style.zIndex="1",w.appendChild(E),S.appendChild(w);let T=document.createElement("div");T.style.display="grid",T.style.justifyItems="end",T.style.gap="6px";let A=document.createElement("span");A.textContent="\u25BE",A.style.display="inline-block",A.style.transition="transform 0.2s ease",A.style.transform="rotate(-90deg)";let N=e.btn("Details",{size:"sm",variant:"ghost",icon:A});N.style.minWidth="86px",N.style.justifyContent="center",N.title=a.length?"Show the players currently in this room.":t.error?"Player details unavailable.":"No player details available.",T.appendChild(N);let H=e.btn("Join",{size:"sm",variant:"primary"});if(H.style.minWidth="86px",H.style.boxShadow="0 4px 10px rgba(56, 189, 248, 0.35)",T.appendChild(H),n?.onRemove){let _=e.btn("Remove",{size:"sm",variant:"danger"});_.style.minWidth="86px",_.addEventListener("click",re=>{re.stopPropagation(),n.onRemove?.()}),_.title=`Remove ${t.name} from custom rooms`,T.appendChild(_)}let C=[];t.error&&C.push("Status unavailable"),t.isFull&&C.push("Room is full"),r&&C.push("Join is blocked on Discord"),s&&C.push("Already in this room");let L=!s&&Zn.canJoinPublicRoom(t);e.setButtonEnabled(H,L),H.title=L?`Join ${t.name}`:C.join(" \xB7 "),H.addEventListener("click",()=>{s||Zn.canJoinPublicRoom(t)&&Zn.joinPublicRoom(t)});let v=N.querySelector(".label"),B=n?.defaultDetailsOpen??!1,le=()=>{if(B){let _=`${c.scrollHeight}px`;l.style.maxHeight=_,l.style.opacity="1",l.style.marginTop="8px",N.setAttribute("aria-expanded","true"),v&&(v.textContent="Hide details"),A.style.transform="rotate(0deg)"}else l.style.maxHeight="0",l.style.opacity="0",l.style.marginTop="0",N.setAttribute("aria-expanded","false"),v&&(v.textContent="Details"),A.style.transform="rotate(-90deg)"};N.addEventListener("click",()=>{B=!B,le()}),h.append(f,S,T),i.appendChild(h);let X=document.createElement("div");X.style.display="flex",X.style.flexWrap="wrap",X.style.gap="6px";let de=(_,re,R)=>{let k=document.createElement("span");k.textContent=_,k.style.fontSize="11px",k.style.padding="4px 8px",k.style.borderRadius="999px",k.style.fontWeight="600",k.style.letterSpacing="0.04em",k.style.textTransform="uppercase",k.style.color=re,k.style.background=R,k.style.border=`1px solid ${re}33`,X.appendChild(k)};return s&&de("Current room","#86efac","rgba(34, 197, 94, 0.12)"),t.error&&de("Status unavailable","#fbbf24","rgba(250, 204, 21, 0.1)"),r&&de("Discord activity","#facc15","rgba(251, 191, 36, 0.12)"),X.childElementCount>0&&i.appendChild(X),i.appendChild(l),le(),(B||n?.scrollHighlightedPlayersIntoView)&&window.requestAnimationFrame(()=>{if(B&&(le(),n?.scrollHighlightedPlayersIntoView&&u.length)){let _=u[0];window.requestAnimationFrame(()=>{_.scrollIntoView({block:"nearest",behavior:"smooth"})})}}),i}async function sD(){return St.list()}var zx=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function aD(t,e=22){return t?t.length<=e?t:t.slice(0,e-1)+"\u2026":""}var iD=t=>({id:t.id,title:aD(t.name||t.id,9),subtitle:t.isConnected?"Online":"Offline",avatarUrl:t.discordAvatarUrl||"",statusColor:t.isConnected?"#48d170":"#999a"});async function lD(t){let e=new Qe({id:"players",compact:!0,windowSelector:".qws-win"});e.mount(t);let n=e.root.querySelector(".qmm-views"),{root:r,left:o,right:s}=e.split2("260px");n.appendChild(r),r.style.height="100%",r.style.minHeight="0",o.style.display="flex",o.style.flexDirection="column",o.style.minHeight="0",s.style.minHeight="0",s.style.overflow="auto";let a=e.vtabs({filterPlaceholder:"Find player\u2026",onSelect:(h,f)=>l(f?.id||null),fillAvailableHeight:!0});a.root.style.display="flex",a.root.style.flexDirection="column",a.root.style.flex="1 1 auto",a.root.style.minHeight="0",o.appendChild(a.root);let i=a.root.querySelector(".filter");i&&i.remove();async function l(h){s.innerHTML="";let f=h&&c.find(te=>te.id===h)||null;if(!f){let te=document.createElement("div");te.style.opacity="0.75",te.textContent="Select a player on the left.",s.appendChild(te);return}let p=document.createElement("div");p.style.display="grid",p.style.gridAutoRows="min-content",p.style.justifyItems="center",p.style.gap="10px",p.style.overflow="auto",s.appendChild(p);let m=document.createElement("div");m.style.display="grid",m.style.gap="8px",m.style.justifyItems="center";let g=document.createElement("div");g.style.display="flex",g.style.alignItems="center",g.style.gap="12px";let S=document.createElement("img");S.src=f.discordAvatarUrl||"",S.alt=f.name,S.width=48,S.height=48,S.style.borderRadius="50%",S.style.objectFit="cover",S.style.border="1px solid #4446";let w=document.createElement("div"),x=document.createElement("div");x.textContent=f.name||f.id,x.style.fontWeight="600",x.style.fontSize="16px";let E=document.createElement("div");E.style.opacity="0.8",E.style.fontSize="12px",E.textContent=f.isConnected?"Online":"Offline",w.append(x,E),g.append(S,w);let T=document.createElement("div");T.style.opacity="0.9",m.append(g,T),p.appendChild(m);let A=document.createElement("div");A.style.display="grid",A.style.gap="6px",A.style.justifySelf="stretch",A.style.width="100%";let N=e.flexRow({justify:"start",fullWidth:!0,gap:6}),H=document.createElement("div");H.textContent="Inventory: ",H.style.fontSize="14px",H.style.opacity="0.85";let C=document.createElement("div");C.textContent="\u2026",C.style.fontSize="15px",C.style.fontWeight="700",C.style.color="#FFD84D",N.append(H,C);let L=e.flexRow({justify:"start",fullWidth:!0,gap:6}),v=document.createElement("div");v.textContent="Garden: ",v.style.fontSize="14px",v.style.opacity="0.85";let B=document.createElement("div");B.textContent="\u2026",B.style.fontWeight="700",B.style.fontSize="15px",B.style.color="#FFD84D",L.append(v,B),A.append(N,L);let le=e.card("\u{1F331} Crops values",{tone:"muted",align:"center"});le.body.append(A),p.appendChild(le.root);let X=e.card("\u270F\uFE0F Editor",{tone:"muted",align:"center"});X.body.style.display="grid",X.body.style.gap="8px";let de=e.btn("Save player garden",{fullWidth:!0,onClick:async()=>{try{let te=window.qwsEditorSaveGardenForPlayer||Re?.qwsEditorSaveGardenForPlayer;if(typeof te!="function"){await be("Save garden","Editor save unavailable","error");return}let z=`${f.name||f.id||"Player"}'s garden`,M=await te(f.id,z);if(!M){await be("Save garden","Save failed (no garden state)","error");return}await be(`Saved "${M.name}".`,"success")}catch{await be("Save failed","error")}}});X.body.append(de),p.appendChild(X.root);let _=e.flexRow({justify:"center"}),re=e.btn("To player",{size:"sm"});re.style.minWidth="120px";let R=e.btn("To garden",{size:"sm"});R.style.minWidth="120px",re.onclick=async()=>{try{await(St.teleportToPlayer??St.teleportTo).call(St,f.id)}catch(te){await be("Teleport",te?.message||"Error during teleport.","error")}},R.onclick=async()=>{try{await(St.teleportToGarden??St.tptogarden).call(St,f.id)}catch(te){await be("Teleport",te?.message||"Error during teleport.","error")}},_.append(re,R);let k=e.card("\u{1F30C} Teleport",{tone:"muted",align:"center"});k.body.append(_),p.appendChild(k.root);let V=e.flexRow({justify:"center"}),ee=e.btn("Inventory",{size:"sm"});ee.style.minWidth="120px";let ie=e.btn("Journal",{size:"sm"});ie.style.minWidth="120px";let fe=e.btn("Stats",{size:"sm"});fe.style.minWidth="120px";let G=e.btn("Activity log",{size:"sm"});G.style.minWidth="120px",ee.onclick=async()=>{try{e.setWindowVisible(!1),await St.openInventoryPreview(f.id,f.name),await Is()&&await ks()}finally{e.setWindowVisible(!0)}},ie.onclick=async()=>{try{e.setWindowVisible(!1),await St.openJournalLog(f.id,f.name),await Ey()&&await Cy()}finally{e.setWindowVisible(!0)}},fe.onclick=async()=>{try{e.setWindowVisible(!1),await St.openStatsModal(f.id,f.name),await My()&&await Ay()}finally{e.setWindowVisible(!0)}},G.onclick=async()=>{try{e.setWindowVisible(!1),await St.openActivityLogModal(f.id,f.name),await Ty()&&await Iy()}finally{e.setWindowVisible(!0)}};let Z=document.createElement("div");Z.style.display="grid",Z.style.gap="6px";let j=e.flexRow({justify:"center"});V.append(ee,ie),j.append(fe,G),Z.append(V,j);let Y=e.card("\u{1F50D} Inspect",{tone:"muted",align:"center"});Y.body.append(Z),p.appendChild(Y.root);let ne=document.createElement("div");ne.style.display="grid",ne.style.gap="10px";let q=e.flexRow({justify:"center"});q.style.gap="16px";let W=document.createElement("div");W.style.display="flex",W.style.alignItems="center",W.style.gap="8px";let b=document.createElement("div");b.textContent="Follow player",b.style.fontSize="14px",b.style.opacity="0.85";let D=e.switch(St.isFollowing(f.id));D.addEventListener("change",async()=>{try{D.checked?(await St.startFollowing(f.id),await be("Follow","Enabled.","success")):(St.stopFollowing(),await be("Follow","Disable.","info"))}catch(te){await be("Follow",te?.message||"Error","error"),D.checked=!D.checked}}),W.append(b,D);let F=document.createElement("div");F.style.display="flex",F.style.alignItems="center",F.style.gap="4px";let P=document.createElement("div");P.textContent="Pet follow",P.style.fontSize="14px",P.style.opacity="0.85";let I=e.switch(St.isPetFollowing(f.id));I.addEventListener("change",async()=>{try{I.checked?await St.startPetFollowing(f.id):await St.stopPetFollowing()}catch(te){await be("Pet follow",te?.message||"Error","error"),I.checked=!I.checked}}),F.append(P,I),q.append(W,F),ne.append(q);let J=e.card("\u{1F389} Fun",{tone:"muted",align:"center"});J.body.append(ne),p.appendChild(J.root),(async()=>{try{let te=await St.getInventoryValue(f.id);C.textContent=`${zx.format(Math.round(te))}`,C.title="Total inventory value"}catch{C.textContent="\u2014"}try{let te=await St.getGardenValue(f.id);B.textContent=`${zx.format(Math.round(te))}`,B.title="Total garden value"}catch{B.textContent="\u2014"}})()}let c=[],d="";function u(h){return h.map(f=>`${f.id}|${f.name??""}|${f.isConnected?1:0}|${f.inventory?.items?.length??0}`).join(";")}async function y(h=!0){let f=a.getSelected()?.id??null,p=await sD(),m=u(p);if(m===d)return;d=m,c=p,a.setItems(c.map(iD));let g=h&&f&&c.some(S=>S.id===f)?f:c[0]?.id??null;g!==null?a.select(g):l(null)}await St.onChange(()=>{y(!0).catch(()=>{})}),await y(!0)}var dd="aries_backups",cD=25,dD=1;function uD(){return typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now().toString(36)}-${Math.random().toString(36).slice(2)}`}function sf(t){let e={...t};return Number.isFinite(e.version)||(e.version=dD),e}function pD(){try{if(typeof GM_getValue=="function")return GM_getValue(dd,"[]")??"[]";if(typeof window<"u"&&typeof window.localStorage<"u")return window.localStorage.getItem(dd)??"[]"}catch{}return"[]"}function mD(t){try{if(typeof GM_setValue=="function"){GM_setValue(dd,t);return}typeof window<"u"&&typeof window.localStorage<"u"&&window.localStorage.setItem(dd,t)}catch{}}function Za(){let t=pD();try{let e=JSON.parse(t);if(Array.isArray(e))return e}catch{}return[]}function Vx(t){mD(JSON.stringify(t))}function Yx(){return[...Za()].sort((e,n)=>n.timestamp-e.timestamp)}function Qx(t){let e=t.trim()||`Backup ${new Date().toLocaleString()}`,n=sf(Id()),r={id:uD(),name:e,timestamp:Date.now(),data:n},o=[r,...Za()].slice(0,cD);return Vx(o),{success:!0,message:"Backup saved.",backup:r}}function Jx(t){let e=Za().find(n=>n.id===t);if(!e)return{success:!1,message:"Backup not found."};try{return kd(e.data),{success:!0,message:"Backup loaded. Reload the game to apply the changes."}}catch(n){return{success:!1,message:`Failed to load backup (${n instanceof Error?n.message:"unknown error"}).`}}}function $x(t){let e=Za().filter(n=>n.id!==t);return e.length===Za().length?{success:!1,message:"Backup not found."}:(Vx(e),{success:!0,message:"Backup deleted."})}function Zx(){let t=sf(Id());return JSON.stringify(t,null,2)}function Xx(t){let e=t.trim();if(!e)return{success:!1,message:"Payload is empty."};let n;try{n=JSON.parse(e)}catch(r){return{success:!1,message:`Invalid JSON (${r instanceof Error?r.message:"unknown error"}).`}}if(!n||typeof n!="object")return{success:!1,message:"JSON payload must be an object."};try{let r=sf(n);return kd(r),{success:!0,message:"Settings applied. Reload the game to apply the changes."}}catch(r){return{success:!1,message:`Failed to import settings (${r instanceof Error?r.message:"unknown error"}).`}}}function Xa(t){let e=document.createElement("button");return e.type="button",e.textContent=t,e.style.borderRadius="6px",e.style.border="1px solid rgba(255,255,255,0.2)",e.style.background="rgba(255,255,255,0.04)",e.style.color="inherit",e.style.fontWeight="600",e.style.fontSize="13px",e.style.padding="6px 12px",e.style.cursor="pointer",e.addEventListener("mouseenter",()=>e.style.background="rgba(255,255,255,0.08)"),e.addEventListener("mouseleave",()=>e.style.background="rgba(255,255,255,0.04)"),e}function e1(){let t=document.createElement("div");return t.style.fontSize="13px",t.style.minHeight="18px",t.style.opacity="0.9",t}function so(t,e){t.textContent=e.message,t.style.color=e.success?"#8bf1b5":"#ff9c9c"}function fD(t){return new Date(t).toLocaleDateString()}function yD(t){if(navigator.clipboard?.writeText){navigator.clipboard.writeText(t);return}let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}function t1(t,e){if(typeof GM_download=="function")try{let i=`data:application/json;charset=utf-8,${encodeURIComponent(e)}`;GM_download({name:t,url:i,saveAs:!0});return}catch{}let n=Re||window,r=JSON.stringify(e),o=JSON.stringify(t),s=`(function(){try{const data=${r};const name=${o};const blob=new Blob([data],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=name;a.style.display="none";const parent=document.body||document.documentElement||document;parent.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url);}catch(e){console.error("[settings] download:",e)}})();`;try{n.eval(s);return}catch{}try{let a=n.document||document,i=a.body||a.documentElement||document.body,l=new Blob([e],{type:"application/json"}),c=(n.URL||URL).createObjectURL(l),d=a.createElement("a");d.href=c,d.download=t,d.style.display="none",i&&i.appendChild(d),d.click(),i&&i.removeChild(d),(n.URL||URL).revokeObjectURL(c)}catch{yD(e)}}function gD(t){let e=JSON.stringify(t.data,null,2),n=`${t.name||"aries-backup"}-${t.id}.json`;t1(n,e)}function hD(t,e,n){let r=document.createElement("div");r.style.display="flex",r.style.flexDirection="column",r.style.gap="6px",r.style.padding="10px",r.style.borderRadius="8px",r.style.border="1px solid rgba(255,255,255,0.08)",r.style.background="rgba(255,255,255,0.01)";let o=document.createElement("div");o.style.display="flex",o.style.justifyContent="space-between",o.style.alignItems="baseline",o.style.flexWrap="wrap",o.style.gap="8px";let s=document.createElement("div");s.textContent=t.name,s.style.fontWeight="600",s.style.fontSize="13px";let a=document.createElement("div");a.innerHTML=`<strong>Created:</strong> ${fD(t.timestamp)}`,a.style.fontSize="11px",a.style.opacity="0.65",o.append(s,a);let i=document.createElement("div");i.style.display="flex",i.style.gap="6px",i.style.flexWrap="wrap";let l=Xa("Load");l.addEventListener("click",()=>{let u=Jx(t.id);so(e,u)});let c=Xa("Delete");c.addEventListener("click",()=>{let u=$x(t.id);so(e,u),af(e,n)});let d=Xa("Export");return d.addEventListener("click",()=>{gD(t),so(e,{success:!0,message:"Backup exported."})}),i.append(l,c),i.append(d),r.append(o,i),r}function af(t,e){let n=Yx();if(e.innerHTML="",!n.length){let r=document.createElement("div");r.textContent="No backups saved yet.",r.style.opacity="0.6",e.appendChild(r);return}n.forEach(r=>{let o=hD(r,t,e);e.appendChild(o)})}function bD(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px";let r=e.card("Import / Export",{description:"Import or export the mod settings directly through JSON files."}),o=e.card("Backup",{description:"Save our settings directly inside the mod storage for easy restores."});r.body.style.display="flex",r.body.style.flexDirection="column",r.body.style.gap="10px",o.body.style.display="flex",o.body.style.flexDirection="column",o.body.style.gap="10px";let s=e1(),a=Xa("Export Settings");a.style.width="100%",a.style.boxSizing="border-box",a.addEventListener("click",()=>{let T=Zx(),A=`aries-settings-${Date.now()}.json`;t1(A,T),so(s,{success:!0,message:"Settings exported as JSON file."})});let i=document.createElement("div");i.style.display="flex",i.style.flexDirection="column",i.style.gap="8px";let l=document.createElement("input");l.type="file",l.accept=".json,application/json,text/plain",l.style.display="none";let c=document.createElement("div");Object.assign(c.style,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px",padding:"18px 22px",width:"100%",minHeight:"110px",borderRadius:"14px",border:"1px dashed #5d6a7d",background:"linear-gradient(180deg, #0b141c, #091018)",transition:"border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease",cursor:"pointer",textAlign:"center"}),c.tabIndex=0,c.setAttribute("role","button"),c.setAttribute("aria-label","Import settings JSON");let d=document.createElement("div");d.textContent="Import settings",Object.assign(d.style,{fontWeight:"600",fontSize:"14px",letterSpacing:"0.02em"});let u=document.createElement("div"),y="Drop a JSON file or click to browse.";u.textContent=y,Object.assign(u.style,{fontSize:"12px",opacity:"0.75"}),c.append(d,u);let h=T=>{T?(c.style.borderColor="#6fc3ff",c.style.boxShadow="0 0 0 3px #6fc3ff22",c.style.background="linear-gradient(180deg, #102030, #0b1826)"):(c.style.borderColor="#5d6a7d",c.style.boxShadow="none",c.style.background="linear-gradient(180deg, #0b141c, #091018)")},f=()=>l.click();c.addEventListener("mouseenter",()=>h(!0)),c.addEventListener("mouseleave",()=>h(document.activeElement===c)),c.addEventListener("focus",()=>h(!0)),c.addEventListener("blur",()=>h(!1)),c.addEventListener("click",f),c.addEventListener("keydown",T=>{(T.key==="Enter"||T.key===" ")&&(T.preventDefault(),f())}),c.addEventListener("dragover",T=>{T.preventDefault(),h(!0),T.dataTransfer&&(T.dataTransfer.dropEffect="copy")}),c.addEventListener("dragleave",()=>h(document.activeElement===c));let p=T=>{if(!T||!T.length){u.textContent=y;return}u.textContent=T.length===1?T[0].name:`${T.length} files selected`},m=async T=>{if(!T||!T.length)return;let A=T[0];try{let N=await A.text(),H=Xx(N);so(s,H)}catch(N){so(s,{success:!1,message:`Failed to read file (${N instanceof Error?N.message:"unknown error"}).`})}finally{l.value=""}};c.addEventListener("drop",async T=>{T.preventDefault();let A=T.dataTransfer?.files||null;p(A),await m(A),p(null),h(document.activeElement===c)}),l.onchange=async()=>{let T=l.files;p(T),await m(T),p(null),h(document.activeElement===c)},i.append(l,c),r.body.append(i,s,a),n.appendChild(r.root);let g=document.createElement("div");g.style.display="flex",g.style.gap="8px",g.style.alignItems="center";let S=document.createElement("input");S.type="text",S.placeholder="Backup name",S.style.flex="1",S.style.borderRadius="6px",S.style.border="1px solid rgba(255,255,255,0.08)",S.style.background="rgba(255,255,255,0.02)",S.style.color="inherit",S.style.padding="8px 10px",S.style.fontSize="13px";let w=Xa("Save"),x=e1(),E=document.createElement("div");E.style.display="flex",E.style.flexDirection="column",E.style.gap="10px",w.addEventListener("click",()=>{let T=Qx(S.value);so(x,T),T.success&&(S.value="",af(x,E))}),g.append(S,w),o.body.append(g,x,E),n.appendChild(o.root),t.appendChild(n),af(x,E)}function SD(t,e,n){let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateColumns="1fr auto",r.style.alignItems="baseline",r.style.gap="12px";let o=t.label(e);o.style.fontSize="12px",o.style.opacity="0.8";let s=document.createElement("div");return s.style.textAlign="right",s.style.fontSize="13px",s.style.fontWeight="600",s.style.wordBreak="break-word",s.textContent=n,r.append(o,s),r}function vD(t){if(!t)return"n/a";let e=typeof t.innerWidth=="number"?Math.floor(t.innerWidth):null,n=typeof t.innerHeight=="number"?Math.floor(t.innerHeight):null;return e===null||n===null?"unknown":`${e} x ${n}`}function wD(t){return t?t.surface==="discord"?"Discord":"Web":"n/a"}function xD(t,e){if(!t)return"n/a";if(t.platform==="desktop")return"Desktop";if(t.platform==="mobile"){let n=e?.userAgent??"";return/tablet|ipad|playbook|silk|kindle/i.test(n)?"Mobile (Tablet)":/mobile|iphone|ipod|android/i.test(n)?"Mobile (Phone)":"Mobile"}return t.platform}function ED(t){let e=t?.platform??"",n=t?.userAgent??"",r=`${e} ${n}`.toLowerCase();return r.trim()?/windows/.test(r)?"Windows":/mac os|macintosh|darwin/.test(r)?"macOS":/android/.test(r)&&!/windows/.test(r)?"Android":/iphone|ipad|ipod/.test(r)?"iOS":/linux/.test(r)&&!/android/.test(r)?"Linux":/cros/.test(r)?"Chrome OS":/freebsd/.test(r)?"FreeBSD":/sunos|solaris/.test(r)?"Solaris":t?.platform||t?.userAgent||"Unknown":"n/a"}function CD(t,e){t.innerHTML="";let n=typeof window<"u"?window:null,r=typeof navigator<"u"?navigator:null,o=typeof location<"u"?location:null,s=n?yo():null,a=zn??"unknown",i=ic()??"unknown",l=e.card("Runtime infos");l.body.style.display="flex",l.body.style.flexDirection="column",l.body.style.gap="10px",[{label:"Mod version",value:i},{label:"Game version",value:a},{label:"Window size",value:vD(n)},{label:"Host",value:s?.host??o?.hostname??"n/a"},{label:"Surface",value:wD(s)},{label:"Platform",value:xD(s,r)},{label:"OS",value:ED(r)}].forEach(d=>{l.body.appendChild(SD(e,d.label,d.value))}),t.appendChild(l.root)}function n1(t){let e=new Qe({id:"settings",compact:!0});e.mount(t),e.addTabs([{id:"settings-data",title:"Settings",render:n=>bD(n,e)},{id:"settings-infos",title:"Infos",render:n=>CD(n,e)}]),e.switchTo("settings-data")}function r1(t){let e=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume"],n=[];function r(){let T=(A,N)=>{let H=C=>{C.stopImmediatePropagation(),C.preventDefault?.()};A.addEventListener(N,H,{capture:!0}),n.push({t:N,h:H,target:A})};e.forEach(A=>{T(document,A),T(window,A)})}function o(){for(let{t:T,h:A,target:N}of n)try{N.removeEventListener(T,A,{capture:!0})}catch{}n.length=0}let s=Object.getPrototypeOf(document),a={hidden:Object.getOwnPropertyDescriptor(s,"hidden"),visibilityState:Object.getOwnPropertyDescriptor(s,"visibilityState"),hasFocus:document.hasFocus?document.hasFocus.bind(document):null};function i(){try{Object.defineProperty(s,"hidden",{configurable:!0,get(){return!1}})}catch{}try{Object.defineProperty(s,"visibilityState",{configurable:!0,get(){return"visible"}})}catch{}try{document.hasFocus=()=>!0}catch{}}function l(){try{a.hidden&&Object.defineProperty(s,"hidden",a.hidden)}catch{}try{a.visibilityState&&Object.defineProperty(s,"visibilityState",a.visibilityState)}catch{}try{a.hasFocus&&(document.hasFocus=a.hasFocus)}catch{}}let c=null,d=null,u=null,y=()=>{c&&c.state!=="running"&&c.resume?.().catch(()=>{})};function h(){try{c=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),u=c.createGain(),u.gain.value=1e-5,d=c.createOscillator(),d.frequency.value=1,d.connect(u).connect(c.destination),d.start(),document.addEventListener("visibilitychange",y,{capture:!0}),window.addEventListener("focus",y,{capture:!0})}catch{f()}}function f(){try{d?.stop()}catch{}try{d?.disconnect(),u?.disconnect()}catch{}try{c?.close?.()}catch{}document.removeEventListener("visibilitychange",y,{capture:!0}),window.removeEventListener("focus",y,{capture:!0}),d=null,u=null,c=null}let p=null;function m(){let T=document.querySelector("canvas")||document.body||document.documentElement;p=window.setInterval(()=>{try{T.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}))}catch{}},25e3)}function g(){p!==null&&(clearInterval(p),p=null)}let S=null;async function w(){try{let T=await t.getPosition();if(!T)return;await t.move(Math.round(T.x),Math.round(T.y))}catch{}}function x(){S=window.setInterval(w,6e4),w()}function E(){S!==null&&(clearInterval(S),S=null)}return{start(){i(),r(),h(),m(),x()},stop(){E(),g(),f(),o(),l()}}}var MD=["plants","mutations","pets","animations","items","decor"];async function AD(){let t=MD.map(async e=>await kt(e));await Promise.all(t)}(async function(){"use strict";gh(),Xy(),Fs({registerSprites:!0,waitForVersionMs:4e3}),iu({config:{blackBelow:10,skipAlphaBelow:1,tolerance:.005},onAsset:e=>{sg(e),Fs({registerSprites:!0})}}),await Pt(),await AD(),await wg(),In.init(),Im({onRegister(e){e("players","\u{1F465} Friends",Mx),e("room","\u{1F3E0} Room",jx),e("garden","\u{1F331} Garden",bb),e("editor","\u{1F4DD} Editor",Rx),e("locker","\u{1F512} Locker",uw),e("calculator","\u{1F913} Calculator",Iw),e("pets","\u{1F43E} Pets",Ax),e("shops","\u{1F6D2} Shops",pb),e("stats","\u{1F4CA} Stats",Jm),e("tools","\u{1F6E0}\uFE0F Tools",Lx),e("keybinds","\u2328\uFE0F Keybinds",_x),e("alerts","\u{1F514} Alerts",_w),e("misc","\u{1F9E9} Misc",Px),e("settings","\u2699\uFE0F Settings",n1),e("debug-data","\u{1F41E} Debug",gx)}}),Gv(),r1({getPosition:()=>we.getPosition(),move:(e,n)=>we.move(e,n)}).start(),Zf()})();})();
