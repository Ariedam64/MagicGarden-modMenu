// ==UserScript==
// @name         test
// @namespace    Quinoa
// @version      1.8.6
// @match        https://1227719606223765687.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @run-at       document-start
// @inject-into  page
// @grant        GM_xmlhttpRequest
// @grant        GM_info
// @grant        GM_openInTab 
// @grant        GM_registerMenuCommand
// @connect      *.supabase.co
// @connect      *.supabase.in
// @connect      raw.githubusercontent.com
// @connect      api.github.com
// @downloadURL  https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// @updateURL    https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// ==/UserScript==
(()=>{var gw=Object.create;var qo=Object.defineProperty;var yw=Object.getOwnPropertyDescriptor;var bw=Object.getOwnPropertyNames;var vw=Object.getPrototypeOf,ww=Object.prototype.hasOwnProperty;var Sw=(t,e,n)=>e in t?qo(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var Do=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof require<"u"?require:e)[n]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var xw=(t,e)=>()=>(t&&(e=t(t=0)),e);var Tn=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ew=(t,e)=>{for(var n in e)qo(t,n,{get:e[n],enumerable:!0})},Zp=(t,e,n,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of bw(e))!ww.call(t,o)&&o!==n&&qo(t,o,{get:()=>e[o],enumerable:!(r=yw(e,o))||r.enumerable});return t};var Xp=(t,e,n)=>(n=t!=null?gw(vw(t)):{},Zp(e||!t||!t.__esModule?qo(n,"default",{value:t,enumerable:!0}):n,t)),Cw=t=>Zp(qo({},"__esModule",{value:!0}),t);var ce=(t,e,n)=>Sw(t,typeof e!="symbol"?e+"":e,n);var Gm=Tn((Um,gd)=>{(function(t){typeof Um=="object"&&typeof gd<"u"?gd.exports=t():typeof define=="function"&&define.amd?define([],t):(typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:this).JSZip=t()})(function(){return function t(e,n,r){function o(a,l){if(!n[a]){if(!e[a]){var c=typeof Do=="function"&&Do;if(!l&&c)return c(a,!0);if(s)return s(a,!0);var d=new Error("Cannot find module '"+a+"'");throw d.code="MODULE_NOT_FOUND",d}var u=n[a]={exports:{}};e[a][0].call(u.exports,function(p){var f=e[a][1][p];return o(f||p)},u,u.exports,t,e,n,r)}return n[a].exports}for(var s=typeof Do=="function"&&Do,i=0;i<r.length;i++)o(r[i]);return o}({1:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./support"),s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(i){for(var a,l,c,d,u,p,f,h=[],m=0,g=i.length,y=g,v=r.getTypeOf(i)!=="string";m<i.length;)y=g-m,c=v?(a=i[m++],l=m<g?i[m++]:0,m<g?i[m++]:0):(a=i.charCodeAt(m++),l=m<g?i.charCodeAt(m++):0,m<g?i.charCodeAt(m++):0),d=a>>2,u=(3&a)<<4|l>>4,p=1<y?(15&l)<<2|c>>6:64,f=2<y?63&c:64,h.push(s.charAt(d)+s.charAt(u)+s.charAt(p)+s.charAt(f));return h.join("")},n.decode=function(i){var a,l,c,d,u,p,f=0,h=0,m="data:";if(i.substr(0,m.length)===m)throw new Error("Invalid base64 input, it looks like a data url.");var g,y=3*(i=i.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(i.charAt(i.length-1)===s.charAt(64)&&y--,i.charAt(i.length-2)===s.charAt(64)&&y--,y%1!=0)throw new Error("Invalid base64 input, bad content length.");for(g=o.uint8array?new Uint8Array(0|y):new Array(0|y);f<i.length;)a=s.indexOf(i.charAt(f++))<<2|(d=s.indexOf(i.charAt(f++)))>>4,l=(15&d)<<4|(u=s.indexOf(i.charAt(f++)))>>2,c=(3&u)<<6|(p=s.indexOf(i.charAt(f++))),g[h++]=a,u!==64&&(g[h++]=l),p!==64&&(g[h++]=c);return g}},{"./support":30,"./utils":32}],2:[function(t,e,n){"use strict";var r=t("./external"),o=t("./stream/DataWorker"),s=t("./stream/Crc32Probe"),i=t("./stream/DataLengthProbe");function a(l,c,d,u,p){this.compressedSize=l,this.uncompressedSize=c,this.crc32=d,this.compression=u,this.compressedContent=p}a.prototype={getContentWorker:function(){var l=new o(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new i("data_length")),c=this;return l.on("end",function(){if(this.streamInfo.data_length!==c.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),l},getCompressedWorker:function(){return new o(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},a.createWorkerFrom=function(l,c,d){return l.pipe(new s).pipe(new i("uncompressedSize")).pipe(c.compressWorker(d)).pipe(new i("compressedSize")).withStreamInfo("compression",c)},e.exports=a},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,e,n){"use strict";var r=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,e,n){"use strict";var r=t("./utils"),o=function(){for(var s,i=[],a=0;a<256;a++){s=a;for(var l=0;l<8;l++)s=1&s?3988292384^s>>>1:s>>>1;i[a]=s}return i}();e.exports=function(s,i){return s!==void 0&&s.length?r.getTypeOf(s)!=="string"?function(a,l,c,d){var u=o,p=d+c;a^=-1;for(var f=d;f<p;f++)a=a>>>8^u[255&(a^l[f])];return-1^a}(0|i,s,s.length,0):function(a,l,c,d){var u=o,p=d+c;a^=-1;for(var f=d;f<p;f++)a=a>>>8^u[255&(a^l.charCodeAt(f))];return-1^a}(0|i,s,s.length,0):0}},{"./utils":32}],5:[function(t,e,n){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,e,n){"use strict";var r=null;r=typeof Promise<"u"?Promise:t("lie"),e.exports={Promise:r}},{lie:37}],7:[function(t,e,n){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",o=t("pako"),s=t("./utils"),i=t("./stream/GenericWorker"),a=r?"uint8array":"array";function l(c,d){i.call(this,"FlateWorker/"+c),this._pako=null,this._pakoAction=c,this._pakoOptions=d,this.meta={}}n.magic="\b\0",s.inherits(l,i),l.prototype.processChunk=function(c){this.meta=c.meta,this._pako===null&&this._createPako(),this._pako.push(s.transformTo(a,c.data),!1)},l.prototype.flush=function(){i.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},l.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this._pako=null},l.prototype._createPako=function(){this._pako=new o[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var c=this;this._pako.onData=function(d){c.push({data:d,meta:c.meta})}},n.compressWorker=function(c){return new l("Deflate",c)},n.uncompressWorker=function(){return new l("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,e,n){"use strict";function r(u,p){var f,h="";for(f=0;f<p;f++)h+=String.fromCharCode(255&u),u>>>=8;return h}function o(u,p,f,h,m,g){var y,v,w=u.file,x=u.compression,E=g!==a.utf8encode,L=s.transformTo("string",g(w.name)),P=s.transformTo("string",a.utf8encode(w.name)),V=w.comment,z=s.transformTo("string",g(V)),C=s.transformTo("string",a.utf8encode(V)),D=P.length!==w.name.length,S=C.length!==V.length,G="",se="",X="",ue=w.dir,N=w.date,ee={crc32:0,compressedSize:0,uncompressedSize:0};p&&!f||(ee.crc32=u.crc32,ee.compressedSize=u.compressedSize,ee.uncompressedSize=u.uncompressedSize);var q=0;p&&(q|=8),E||!D&&!S||(q|=2048);var A=0,te=0;ue&&(A|=16),m==="UNIX"?(te=798,A|=function(Z,me){var Q=Z;return Z||(Q=me?16893:33204),(65535&Q)<<16}(w.unixPermissions,ue)):(te=20,A|=function(Z){return 63&(Z||0)}(w.dosPermissions)),y=N.getUTCHours(),y<<=6,y|=N.getUTCMinutes(),y<<=5,y|=N.getUTCSeconds()/2,v=N.getUTCFullYear()-1980,v<<=4,v|=N.getUTCMonth()+1,v<<=5,v|=N.getUTCDate(),D&&(se=r(1,1)+r(l(L),4)+P,G+="up"+r(se.length,2)+se),S&&(X=r(1,1)+r(l(z),4)+C,G+="uc"+r(X.length,2)+X);var ne="";return ne+=`
\0`,ne+=r(q,2),ne+=x.magic,ne+=r(y,2),ne+=r(v,2),ne+=r(ee.crc32,4),ne+=r(ee.compressedSize,4),ne+=r(ee.uncompressedSize,4),ne+=r(L.length,2),ne+=r(G.length,2),{fileRecord:c.LOCAL_FILE_HEADER+ne+L+G,dirRecord:c.CENTRAL_FILE_HEADER+r(te,2)+ne+r(z.length,2)+"\0\0\0\0"+r(A,4)+r(h,4)+L+G+z}}var s=t("../utils"),i=t("../stream/GenericWorker"),a=t("../utf8"),l=t("../crc32"),c=t("../signature");function d(u,p,f,h){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=p,this.zipPlatform=f,this.encodeFileName=h,this.streamFiles=u,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}s.inherits(d,i),d.prototype.push=function(u){var p=u.meta.percent||0,f=this.entriesCount,h=this._sources.length;this.accumulate?this.contentBuffer.push(u):(this.bytesWritten+=u.data.length,i.prototype.push.call(this,{data:u.data,meta:{currentFile:this.currentFile,percent:f?(p+100*(f-h-1))/f:100}}))},d.prototype.openedSource=function(u){this.currentSourceOffset=this.bytesWritten,this.currentFile=u.file.name;var p=this.streamFiles&&!u.file.dir;if(p){var f=o(u,p,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:f.fileRecord,meta:{percent:0}})}else this.accumulate=!0},d.prototype.closedSource=function(u){this.accumulate=!1;var p=this.streamFiles&&!u.file.dir,f=o(u,p,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(f.dirRecord),p)this.push({data:function(h){return c.DATA_DESCRIPTOR+r(h.crc32,4)+r(h.compressedSize,4)+r(h.uncompressedSize,4)}(u),meta:{percent:100}});else for(this.push({data:f.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},d.prototype.flush=function(){for(var u=this.bytesWritten,p=0;p<this.dirRecords.length;p++)this.push({data:this.dirRecords[p],meta:{percent:100}});var f=this.bytesWritten-u,h=function(m,g,y,v,w){var x=s.transformTo("string",w(v));return c.CENTRAL_DIRECTORY_END+"\0\0\0\0"+r(m,2)+r(m,2)+r(g,4)+r(y,4)+r(x.length,2)+x}(this.dirRecords.length,f,u,this.zipComment,this.encodeFileName);this.push({data:h,meta:{percent:100}})},d.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},d.prototype.registerPrevious=function(u){this._sources.push(u);var p=this;return u.on("data",function(f){p.processChunk(f)}),u.on("end",function(){p.closedSource(p.previous.streamInfo),p._sources.length?p.prepareNextSource():p.end()}),u.on("error",function(f){p.error(f)}),this},d.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},d.prototype.error=function(u){var p=this._sources;if(!i.prototype.error.call(this,u))return!1;for(var f=0;f<p.length;f++)try{p[f].error(u)}catch{}return!0},d.prototype.lock=function(){i.prototype.lock.call(this);for(var u=this._sources,p=0;p<u.length;p++)u[p].lock()},e.exports=d},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,e,n){"use strict";var r=t("../compressions"),o=t("./ZipFileWorker");n.generateWorker=function(s,i,a){var l=new o(i.streamFiles,a,i.platform,i.encodeFileName),c=0;try{s.forEach(function(d,u){c++;var p=function(g,y){var v=g||y,w=r[v];if(!w)throw new Error(v+" is not a valid compression method !");return w}(u.options.compression,i.compression),f=u.options.compressionOptions||i.compressionOptions||{},h=u.dir,m=u.date;u._compressWorker(p,f).withStreamInfo("file",{name:d,dir:h,date:m,comment:u.comment||"",unixPermissions:u.unixPermissions,dosPermissions:u.dosPermissions}).pipe(l)}),l.entriesCount=c}catch(d){l.error(d)}return l}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,e,n){"use strict";function r(){if(!(this instanceof r))return new r;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var o=new r;for(var s in this)typeof this[s]!="function"&&(o[s]=this[s]);return o}}(r.prototype=t("./object")).loadAsync=t("./load"),r.support=t("./support"),r.defaults=t("./defaults"),r.version="3.10.1",r.loadAsync=function(o,s){return new r().loadAsync(o,s)},r.external=t("./external"),e.exports=r},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,e,n){"use strict";var r=t("./utils"),o=t("./external"),s=t("./utf8"),i=t("./zipEntries"),a=t("./stream/Crc32Probe"),l=t("./nodejsUtils");function c(d){return new o.Promise(function(u,p){var f=d.decompressed.getContentWorker().pipe(new a);f.on("error",function(h){p(h)}).on("end",function(){f.streamInfo.crc32!==d.decompressed.crc32?p(new Error("Corrupted zip : CRC32 mismatch")):u()}).resume()})}e.exports=function(d,u){var p=this;return u=r.extend(u||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:s.utf8decode}),l.isNode&&l.isStream(d)?o.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",d,!0,u.optimizedBinaryString,u.base64).then(function(f){var h=new i(u);return h.load(f),h}).then(function(f){var h=[o.Promise.resolve(f)],m=f.files;if(u.checkCRC32)for(var g=0;g<m.length;g++)h.push(c(m[g]));return o.Promise.all(h)}).then(function(f){for(var h=f.shift(),m=h.files,g=0;g<m.length;g++){var y=m[g],v=y.fileNameStr,w=r.resolve(y.fileNameStr);p.file(w,y.decompressed,{binary:!0,optimizedBinaryString:!0,date:y.date,dir:y.dir,comment:y.fileCommentStr.length?y.fileCommentStr:null,unixPermissions:y.unixPermissions,dosPermissions:y.dosPermissions,createFolders:u.createFolders}),y.dir||(p.file(w).unsafeOriginalName=v)}return h.zipComment.length&&(p.comment=h.zipComment),p})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../stream/GenericWorker");function s(i,a){o.call(this,"Nodejs stream input adapter for "+i),this._upstreamEnded=!1,this._bindStream(a)}r.inherits(s,o),s.prototype._bindStream=function(i){var a=this;(this._stream=i).pause(),i.on("data",function(l){a.push({data:l,meta:{percent:0}})}).on("error",function(l){a.isPaused?this.generatedError=l:a.error(l)}).on("end",function(){a.isPaused?a._upstreamEnded=!0:a.end()})},s.prototype.pause=function(){return!!o.prototype.pause.call(this)&&(this._stream.pause(),!0)},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},e.exports=s},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,e,n){"use strict";var r=t("readable-stream").Readable;function o(s,i,a){r.call(this,i),this._helper=s;var l=this;s.on("data",function(c,d){l.push(c)||l._helper.pause(),a&&a(d)}).on("error",function(c){l.emit("error",c)}).on("end",function(){l.push(null)})}t("../utils").inherits(o,r),o.prototype._read=function(){this._helper.resume()},e.exports=o},{"../utils":32,"readable-stream":16}],14:[function(t,e,n){"use strict";e.exports={isNode:typeof Buffer<"u",newBufferFrom:function(r,o){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(r,o);if(typeof r=="number")throw new Error('The "data" argument must not be a number');return new Buffer(r,o)},allocBuffer:function(r){if(Buffer.alloc)return Buffer.alloc(r);var o=new Buffer(r);return o.fill(0),o},isBuffer:function(r){return Buffer.isBuffer(r)},isStream:function(r){return r&&typeof r.on=="function"&&typeof r.pause=="function"&&typeof r.resume=="function"}}},{}],15:[function(t,e,n){"use strict";function r(w,x,E){var L,P=s.getTypeOf(x),V=s.extend(E||{},l);V.date=V.date||new Date,V.compression!==null&&(V.compression=V.compression.toUpperCase()),typeof V.unixPermissions=="string"&&(V.unixPermissions=parseInt(V.unixPermissions,8)),V.unixPermissions&&16384&V.unixPermissions&&(V.dir=!0),V.dosPermissions&&16&V.dosPermissions&&(V.dir=!0),V.dir&&(w=m(w)),V.createFolders&&(L=h(w))&&g.call(this,L,!0);var z=P==="string"&&V.binary===!1&&V.base64===!1;E&&E.binary!==void 0||(V.binary=!z),(x instanceof c&&x.uncompressedSize===0||V.dir||!x||x.length===0)&&(V.base64=!1,V.binary=!0,x="",V.compression="STORE",P="string");var C=null;C=x instanceof c||x instanceof i?x:p.isNode&&p.isStream(x)?new f(w,x):s.prepareContent(w,x,V.binary,V.optimizedBinaryString,V.base64);var D=new d(w,C,V);this.files[w]=D}var o=t("./utf8"),s=t("./utils"),i=t("./stream/GenericWorker"),a=t("./stream/StreamHelper"),l=t("./defaults"),c=t("./compressedObject"),d=t("./zipObject"),u=t("./generate"),p=t("./nodejsUtils"),f=t("./nodejs/NodejsStreamInputAdapter"),h=function(w){w.slice(-1)==="/"&&(w=w.substring(0,w.length-1));var x=w.lastIndexOf("/");return 0<x?w.substring(0,x):""},m=function(w){return w.slice(-1)!=="/"&&(w+="/"),w},g=function(w,x){return x=x!==void 0?x:l.createFolders,w=m(w),this.files[w]||r.call(this,w,null,{dir:!0,createFolders:x}),this.files[w]};function y(w){return Object.prototype.toString.call(w)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(w){var x,E,L;for(x in this.files)L=this.files[x],(E=x.slice(this.root.length,x.length))&&x.slice(0,this.root.length)===this.root&&w(E,L)},filter:function(w){var x=[];return this.forEach(function(E,L){w(E,L)&&x.push(L)}),x},file:function(w,x,E){if(arguments.length!==1)return w=this.root+w,r.call(this,w,x,E),this;if(y(w)){var L=w;return this.filter(function(V,z){return!z.dir&&L.test(V)})}var P=this.files[this.root+w];return P&&!P.dir?P:null},folder:function(w){if(!w)return this;if(y(w))return this.filter(function(P,V){return V.dir&&w.test(P)});var x=this.root+w,E=g.call(this,x),L=this.clone();return L.root=E.name,L},remove:function(w){w=this.root+w;var x=this.files[w];if(x||(w.slice(-1)!=="/"&&(w+="/"),x=this.files[w]),x&&!x.dir)delete this.files[w];else for(var E=this.filter(function(P,V){return V.name.slice(0,w.length)===w}),L=0;L<E.length;L++)delete this.files[E[L].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(w){var x,E={};try{if((E=s.extend(w||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=E.type.toLowerCase(),E.compression=E.compression.toUpperCase(),E.type==="binarystring"&&(E.type="string"),!E.type)throw new Error("No output type specified.");s.checkSupport(E.type),E.platform!=="darwin"&&E.platform!=="freebsd"&&E.platform!=="linux"&&E.platform!=="sunos"||(E.platform="UNIX"),E.platform==="win32"&&(E.platform="DOS");var L=E.comment||this.comment||"";x=u.generateWorker(this,E,L)}catch(P){(x=new i("error")).error(P)}return new a(x,E.type||"string",E.mimeType)},generateAsync:function(w,x){return this.generateInternalStream(w).accumulate(x)},generateNodeStream:function(w,x){return(w=w||{}).type||(w.type="nodebuffer"),this.generateInternalStream(w).toNodejsStream(x)}};e.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,e,n){"use strict";e.exports=t("stream")},{stream:void 0}],17:[function(t,e,n){"use strict";var r=t("./DataReader");function o(s){r.call(this,s);for(var i=0;i<this.data.length;i++)s[i]=255&s[i]}t("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data[this.zero+s]},o.prototype.lastIndexOfSignature=function(s){for(var i=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),d=this.length-4;0<=d;--d)if(this.data[d]===i&&this.data[d+1]===a&&this.data[d+2]===l&&this.data[d+3]===c)return d-this.zero;return-1},o.prototype.readAndCheckSignature=function(s){var i=s.charCodeAt(0),a=s.charCodeAt(1),l=s.charCodeAt(2),c=s.charCodeAt(3),d=this.readData(4);return i===d[0]&&a===d[1]&&l===d[2]&&c===d[3]},o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return[];var i=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,i},e.exports=o},{"../utils":32,"./DataReader":18}],18:[function(t,e,n){"use strict";var r=t("../utils");function o(s){this.data=s,this.length=s.length,this.index=0,this.zero=0}o.prototype={checkOffset:function(s){this.checkIndex(this.index+s)},checkIndex:function(s){if(this.length<this.zero+s||s<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+s+"). Corrupted zip ?")},setIndex:function(s){this.checkIndex(s),this.index=s},skip:function(s){this.setIndex(this.index+s)},byteAt:function(){},readInt:function(s){var i,a=0;for(this.checkOffset(s),i=this.index+s-1;i>=this.index;i--)a=(a<<8)+this.byteAt(i);return this.index+=s,a},readString:function(s){return r.transformTo("string",this.readData(s))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var s=this.readInt(4);return new Date(Date.UTC(1980+(s>>25&127),(s>>21&15)-1,s>>16&31,s>>11&31,s>>5&63,(31&s)<<1))}},e.exports=o},{"../utils":32}],19:[function(t,e,n){"use strict";var r=t("./Uint8ArrayReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.readData=function(s){this.checkOffset(s);var i=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,i},e.exports=o},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,e,n){"use strict";var r=t("./DataReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.byteAt=function(s){return this.data.charCodeAt(this.zero+s)},o.prototype.lastIndexOfSignature=function(s){return this.data.lastIndexOf(s)-this.zero},o.prototype.readAndCheckSignature=function(s){return s===this.readData(4)},o.prototype.readData=function(s){this.checkOffset(s);var i=this.data.slice(this.zero+this.index,this.zero+this.index+s);return this.index+=s,i},e.exports=o},{"../utils":32,"./DataReader":18}],21:[function(t,e,n){"use strict";var r=t("./ArrayReader");function o(s){r.call(this,s)}t("../utils").inherits(o,r),o.prototype.readData=function(s){if(this.checkOffset(s),s===0)return new Uint8Array(0);var i=this.data.subarray(this.zero+this.index,this.zero+this.index+s);return this.index+=s,i},e.exports=o},{"../utils":32,"./ArrayReader":17}],22:[function(t,e,n){"use strict";var r=t("../utils"),o=t("../support"),s=t("./ArrayReader"),i=t("./StringReader"),a=t("./NodeBufferReader"),l=t("./Uint8ArrayReader");e.exports=function(c){var d=r.getTypeOf(c);return r.checkSupport(d),d!=="string"||o.uint8array?d==="nodebuffer"?new a(c):o.uint8array?new l(r.transformTo("uint8array",c)):new s(r.transformTo("array",c)):new i(c)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,e,n){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../utils");function s(i){r.call(this,"ConvertWorker to "+i),this.destType=i}o.inherits(s,r),s.prototype.processChunk=function(i){this.push({data:o.transformTo(this.destType,i.data),meta:i.meta})},e.exports=s},{"../utils":32,"./GenericWorker":28}],25:[function(t,e,n){"use strict";var r=t("./GenericWorker"),o=t("../crc32");function s(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(s,r),s.prototype.processChunk=function(i){this.streamInfo.crc32=o(i.data,this.streamInfo.crc32||0),this.push(i)},e.exports=s},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function s(i){o.call(this,"DataLengthProbe for "+i),this.propName=i,this.withStreamInfo(i,0)}r.inherits(s,o),s.prototype.processChunk=function(i){if(i){var a=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=a+i.data.length}o.prototype.processChunk.call(this,i)},e.exports=s},{"../utils":32,"./GenericWorker":28}],27:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./GenericWorker");function s(i){o.call(this,"DataWorker");var a=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,i.then(function(l){a.dataIsReady=!0,a.data=l,a.max=l&&l.length||0,a.type=r.getTypeOf(l),a.isPaused||a._tickAndRepeat()},function(l){a.error(l)})}r.inherits(s,o),s.prototype.cleanUp=function(){o.prototype.cleanUp.call(this),this.data=null},s.prototype.resume=function(){return!!o.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},s.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},s.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var i=null,a=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":i=this.data.substring(this.index,a);break;case"uint8array":i=this.data.subarray(this.index,a);break;case"array":case"nodebuffer":i=this.data.slice(this.index,a)}return this.index=a,this.push({data:i,meta:{percent:this.max?this.index/this.max*100:0}})},e.exports=s},{"../utils":32,"./GenericWorker":28}],28:[function(t,e,n){"use strict";function r(o){this.name=o||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}r.prototype={push:function(o){this.emit("data",o)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(o){this.emit("error",o)}return!0},error:function(o){return!this.isFinished&&(this.isPaused?this.generatedError=o:(this.isFinished=!0,this.emit("error",o),this.previous&&this.previous.error(o),this.cleanUp()),!0)},on:function(o,s){return this._listeners[o].push(s),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(o,s){if(this._listeners[o])for(var i=0;i<this._listeners[o].length;i++)this._listeners[o][i].call(this,s)},pipe:function(o){return o.registerPrevious(this)},registerPrevious:function(o){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=o.streamInfo,this.mergeStreamInfo(),this.previous=o;var s=this;return o.on("data",function(i){s.processChunk(i)}),o.on("end",function(){s.end()}),o.on("error",function(i){s.error(i)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var o=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),o=!0),this.previous&&this.previous.resume(),!o},flush:function(){},processChunk:function(o){this.push(o)},withStreamInfo:function(o,s){return this.extraStreamInfo[o]=s,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var o in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,o)&&(this.streamInfo[o]=this.extraStreamInfo[o])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var o="Worker "+this.name;return this.previous?this.previous+" -> "+o:o}},e.exports=r},{}],29:[function(t,e,n){"use strict";var r=t("../utils"),o=t("./ConvertWorker"),s=t("./GenericWorker"),i=t("../base64"),a=t("../support"),l=t("../external"),c=null;if(a.nodestream)try{c=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function d(p,f){return new l.Promise(function(h,m){var g=[],y=p._internalType,v=p._outputType,w=p._mimeType;p.on("data",function(x,E){g.push(x),f&&f(E)}).on("error",function(x){g=[],m(x)}).on("end",function(){try{var x=function(E,L,P){switch(E){case"blob":return r.newBlob(r.transformTo("arraybuffer",L),P);case"base64":return i.encode(L);default:return r.transformTo(E,L)}}(v,function(E,L){var P,V=0,z=null,C=0;for(P=0;P<L.length;P++)C+=L[P].length;switch(E){case"string":return L.join("");case"array":return Array.prototype.concat.apply([],L);case"uint8array":for(z=new Uint8Array(C),P=0;P<L.length;P++)z.set(L[P],V),V+=L[P].length;return z;case"nodebuffer":return Buffer.concat(L);default:throw new Error("concat : unsupported type '"+E+"'")}}(y,g),w);h(x)}catch(E){m(E)}g=[]}).resume()})}function u(p,f,h){var m=f;switch(f){case"blob":case"arraybuffer":m="uint8array";break;case"base64":m="string"}try{this._internalType=m,this._outputType=f,this._mimeType=h,r.checkSupport(m),this._worker=p.pipe(new o(m)),p.lock()}catch(g){this._worker=new s("error"),this._worker.error(g)}}u.prototype={accumulate:function(p){return d(this,p)},on:function(p,f){var h=this;return p==="data"?this._worker.on(p,function(m){f.call(h,m.data,m.meta)}):this._worker.on(p,function(){r.delay(f,arguments,h)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(p){if(r.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new c(this,{objectMode:this._outputType!=="nodebuffer"},p)}},e.exports=u},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,e,n){"use strict";if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var r=new ArrayBuffer(0);try{n.blob=new Blob([r],{type:"application/zip"}).size===0}catch{try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);o.append(r),n.blob=o.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,e,n){"use strict";for(var r=t("./utils"),o=t("./support"),s=t("./nodejsUtils"),i=t("./stream/GenericWorker"),a=new Array(256),l=0;l<256;l++)a[l]=252<=l?6:248<=l?5:240<=l?4:224<=l?3:192<=l?2:1;a[254]=a[254]=1;function c(){i.call(this,"utf-8 decode"),this.leftOver=null}function d(){i.call(this,"utf-8 encode")}n.utf8encode=function(u){return o.nodebuffer?s.newBufferFrom(u,"utf-8"):function(p){var f,h,m,g,y,v=p.length,w=0;for(g=0;g<v;g++)(64512&(h=p.charCodeAt(g)))==55296&&g+1<v&&(64512&(m=p.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),g++),w+=h<128?1:h<2048?2:h<65536?3:4;for(f=o.uint8array?new Uint8Array(w):new Array(w),g=y=0;y<w;g++)(64512&(h=p.charCodeAt(g)))==55296&&g+1<v&&(64512&(m=p.charCodeAt(g+1)))==56320&&(h=65536+(h-55296<<10)+(m-56320),g++),h<128?f[y++]=h:(h<2048?f[y++]=192|h>>>6:(h<65536?f[y++]=224|h>>>12:(f[y++]=240|h>>>18,f[y++]=128|h>>>12&63),f[y++]=128|h>>>6&63),f[y++]=128|63&h);return f}(u)},n.utf8decode=function(u){return o.nodebuffer?r.transformTo("nodebuffer",u).toString("utf-8"):function(p){var f,h,m,g,y=p.length,v=new Array(2*y);for(f=h=0;f<y;)if((m=p[f++])<128)v[h++]=m;else if(4<(g=a[m]))v[h++]=65533,f+=g-1;else{for(m&=g===2?31:g===3?15:7;1<g&&f<y;)m=m<<6|63&p[f++],g--;1<g?v[h++]=65533:m<65536?v[h++]=m:(m-=65536,v[h++]=55296|m>>10&1023,v[h++]=56320|1023&m)}return v.length!==h&&(v.subarray?v=v.subarray(0,h):v.length=h),r.applyFromCharCode(v)}(u=r.transformTo(o.uint8array?"uint8array":"array",u))},r.inherits(c,i),c.prototype.processChunk=function(u){var p=r.transformTo(o.uint8array?"uint8array":"array",u.data);if(this.leftOver&&this.leftOver.length){if(o.uint8array){var f=p;(p=new Uint8Array(f.length+this.leftOver.length)).set(this.leftOver,0),p.set(f,this.leftOver.length)}else p=this.leftOver.concat(p);this.leftOver=null}var h=function(g,y){var v;for((y=y||g.length)>g.length&&(y=g.length),v=y-1;0<=v&&(192&g[v])==128;)v--;return v<0||v===0?y:v+a[g[v]]>y?v:y}(p),m=p;h!==p.length&&(o.uint8array?(m=p.subarray(0,h),this.leftOver=p.subarray(h,p.length)):(m=p.slice(0,h),this.leftOver=p.slice(h,p.length))),this.push({data:n.utf8decode(m),meta:u.meta})},c.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=c,r.inherits(d,i),d.prototype.processChunk=function(u){this.push({data:n.utf8encode(u.data),meta:u.meta})},n.Utf8EncodeWorker=d},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,e,n){"use strict";var r=t("./support"),o=t("./base64"),s=t("./nodejsUtils"),i=t("./external");function a(f){return f}function l(f,h){for(var m=0;m<f.length;++m)h[m]=255&f.charCodeAt(m);return h}t("setimmediate"),n.newBlob=function(f,h){n.checkSupport("blob");try{return new Blob([f],{type:h})}catch{try{var m=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return m.append(f),m.getBlob(h)}catch{throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(f,h,m){var g=[],y=0,v=f.length;if(v<=m)return String.fromCharCode.apply(null,f);for(;y<v;)h==="array"||h==="nodebuffer"?g.push(String.fromCharCode.apply(null,f.slice(y,Math.min(y+m,v)))):g.push(String.fromCharCode.apply(null,f.subarray(y,Math.min(y+m,v)))),y+=m;return g.join("")},stringifyByChar:function(f){for(var h="",m=0;m<f.length;m++)h+=String.fromCharCode(f[m]);return h},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&String.fromCharCode.apply(null,s.allocBuffer(1)).length===1}catch{return!1}}()}};function d(f){var h=65536,m=n.getTypeOf(f),g=!0;if(m==="uint8array"?g=c.applyCanBeUsed.uint8array:m==="nodebuffer"&&(g=c.applyCanBeUsed.nodebuffer),g)for(;1<h;)try{return c.stringifyByChunk(f,m,h)}catch{h=Math.floor(h/2)}return c.stringifyByChar(f)}function u(f,h){for(var m=0;m<f.length;m++)h[m]=f[m];return h}n.applyFromCharCode=d;var p={};p.string={string:a,array:function(f){return l(f,new Array(f.length))},arraybuffer:function(f){return p.string.uint8array(f).buffer},uint8array:function(f){return l(f,new Uint8Array(f.length))},nodebuffer:function(f){return l(f,s.allocBuffer(f.length))}},p.array={string:d,array:a,arraybuffer:function(f){return new Uint8Array(f).buffer},uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return s.newBufferFrom(f)}},p.arraybuffer={string:function(f){return d(new Uint8Array(f))},array:function(f){return u(new Uint8Array(f),new Array(f.byteLength))},arraybuffer:a,uint8array:function(f){return new Uint8Array(f)},nodebuffer:function(f){return s.newBufferFrom(new Uint8Array(f))}},p.uint8array={string:d,array:function(f){return u(f,new Array(f.length))},arraybuffer:function(f){return f.buffer},uint8array:a,nodebuffer:function(f){return s.newBufferFrom(f)}},p.nodebuffer={string:d,array:function(f){return u(f,new Array(f.length))},arraybuffer:function(f){return p.nodebuffer.uint8array(f).buffer},uint8array:function(f){return u(f,new Uint8Array(f.length))},nodebuffer:a},n.transformTo=function(f,h){if(h=h||"",!f)return h;n.checkSupport(f);var m=n.getTypeOf(h);return p[m][f](h)},n.resolve=function(f){for(var h=f.split("/"),m=[],g=0;g<h.length;g++){var y=h[g];y==="."||y===""&&g!==0&&g!==h.length-1||(y===".."?m.pop():m.push(y))}return m.join("/")},n.getTypeOf=function(f){return typeof f=="string"?"string":Object.prototype.toString.call(f)==="[object Array]"?"array":r.nodebuffer&&s.isBuffer(f)?"nodebuffer":r.uint8array&&f instanceof Uint8Array?"uint8array":r.arraybuffer&&f instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(f){if(!r[f.toLowerCase()])throw new Error(f+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(f){var h,m,g="";for(m=0;m<(f||"").length;m++)g+="\\x"+((h=f.charCodeAt(m))<16?"0":"")+h.toString(16).toUpperCase();return g},n.delay=function(f,h,m){setImmediate(function(){f.apply(m||null,h||[])})},n.inherits=function(f,h){function m(){}m.prototype=h.prototype,f.prototype=new m},n.extend=function(){var f,h,m={};for(f=0;f<arguments.length;f++)for(h in arguments[f])Object.prototype.hasOwnProperty.call(arguments[f],h)&&m[h]===void 0&&(m[h]=arguments[f][h]);return m},n.prepareContent=function(f,h,m,g,y){return i.Promise.resolve(h).then(function(v){return r.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new i.Promise(function(w,x){var E=new FileReader;E.onload=function(L){w(L.target.result)},E.onerror=function(L){x(L.target.error)},E.readAsArrayBuffer(v)}):v}).then(function(v){var w=n.getTypeOf(v);return w?(w==="arraybuffer"?v=n.transformTo("uint8array",v):w==="string"&&(y?v=o.decode(v):m&&g!==!0&&(v=function(x){return l(x,r.uint8array?new Uint8Array(x.length):new Array(x.length))}(v))),v):i.Promise.reject(new Error("Can't read the data of '"+f+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),s=t("./signature"),i=t("./zipEntry"),a=t("./support");function l(c){this.files=[],this.loadOptions=c}l.prototype={checkSignature:function(c){if(!this.reader.readAndCheckSignature(c)){this.reader.index-=4;var d=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+o.pretty(d)+", expected "+o.pretty(c)+")")}},isSignature:function(c,d){var u=this.reader.index;this.reader.setIndex(c);var p=this.reader.readString(4)===d;return this.reader.setIndex(u),p},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var c=this.reader.readData(this.zipCommentLength),d=a.uint8array?"uint8array":"array",u=o.transformTo(d,c);this.zipComment=this.loadOptions.decodeFileName(u)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var c,d,u,p=this.zip64EndOfCentralSize-44;0<p;)c=this.reader.readInt(2),d=this.reader.readInt(4),u=this.reader.readData(d),this.zip64ExtensibleData[c]={id:c,length:d,value:u}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var c,d;for(c=0;c<this.files.length;c++)d=this.files[c],this.reader.setIndex(d.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),d.readLocalPart(this.reader),d.handleUTF8(),d.processAttributes()},readCentralDir:function(){var c;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(s.CENTRAL_FILE_HEADER);)(c=new i({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(c);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var c=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(c<0)throw this.isSignature(0,s.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(c);var d=c;if(this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===o.MAX_VALUE_16BITS||this.diskWithCentralDirStart===o.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===o.MAX_VALUE_16BITS||this.centralDirRecords===o.MAX_VALUE_16BITS||this.centralDirSize===o.MAX_VALUE_32BITS||this.centralDirOffset===o.MAX_VALUE_32BITS){if(this.zip64=!0,(c=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(c),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,s.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var u=this.centralDirOffset+this.centralDirSize;this.zip64&&(u+=20,u+=12+this.zip64EndOfCentralSize);var p=d-u;if(0<p)this.isSignature(d,s.CENTRAL_FILE_HEADER)||(this.reader.zero=p);else if(p<0)throw new Error("Corrupted zip: missing "+Math.abs(p)+" bytes.")},prepareReader:function(c){this.reader=r(c)},load:function(c){this.prepareReader(c),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},e.exports=l},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,e,n){"use strict";var r=t("./reader/readerFor"),o=t("./utils"),s=t("./compressedObject"),i=t("./crc32"),a=t("./utf8"),l=t("./compressions"),c=t("./support");function d(u,p){this.options=u,this.loadOptions=p}d.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(u){var p,f;if(u.skip(22),this.fileNameLength=u.readInt(2),f=u.readInt(2),this.fileName=u.readData(this.fileNameLength),u.skip(f),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((p=function(h){for(var m in l)if(Object.prototype.hasOwnProperty.call(l,m)&&l[m].magic===h)return l[m];return null}(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+o.pretty(this.compressionMethod)+" unknown (inner file : "+o.transformTo("string",this.fileName)+")");this.decompressed=new s(this.compressedSize,this.uncompressedSize,this.crc32,p,u.readData(this.compressedSize))},readCentralPart:function(u){this.versionMadeBy=u.readInt(2),u.skip(2),this.bitFlag=u.readInt(2),this.compressionMethod=u.readString(2),this.date=u.readDate(),this.crc32=u.readInt(4),this.compressedSize=u.readInt(4),this.uncompressedSize=u.readInt(4);var p=u.readInt(2);if(this.extraFieldsLength=u.readInt(2),this.fileCommentLength=u.readInt(2),this.diskNumberStart=u.readInt(2),this.internalFileAttributes=u.readInt(2),this.externalFileAttributes=u.readInt(4),this.localHeaderOffset=u.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");u.skip(p),this.readExtraFields(u),this.parseZIP64ExtraField(u),this.fileComment=u.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var u=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),u==0&&(this.dosPermissions=63&this.externalFileAttributes),u==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var u=r(this.extraFields[1].value);this.uncompressedSize===o.MAX_VALUE_32BITS&&(this.uncompressedSize=u.readInt(8)),this.compressedSize===o.MAX_VALUE_32BITS&&(this.compressedSize=u.readInt(8)),this.localHeaderOffset===o.MAX_VALUE_32BITS&&(this.localHeaderOffset=u.readInt(8)),this.diskNumberStart===o.MAX_VALUE_32BITS&&(this.diskNumberStart=u.readInt(4))}},readExtraFields:function(u){var p,f,h,m=u.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});u.index+4<m;)p=u.readInt(2),f=u.readInt(2),h=u.readData(f),this.extraFields[p]={id:p,length:f,value:h};u.setIndex(m)},handleUTF8:function(){var u=c.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=a.utf8decode(this.fileName),this.fileCommentStr=a.utf8decode(this.fileComment);else{var p=this.findExtraFieldUnicodePath();if(p!==null)this.fileNameStr=p;else{var f=o.transformTo(u,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(f)}var h=this.findExtraFieldUnicodeComment();if(h!==null)this.fileCommentStr=h;else{var m=o.transformTo(u,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(m)}}},findExtraFieldUnicodePath:function(){var u=this.extraFields[28789];if(u){var p=r(u.value);return p.readInt(1)!==1||i(this.fileName)!==p.readInt(4)?null:a.utf8decode(p.readData(u.length-5))}return null},findExtraFieldUnicodeComment:function(){var u=this.extraFields[25461];if(u){var p=r(u.value);return p.readInt(1)!==1||i(this.fileComment)!==p.readInt(4)?null:a.utf8decode(p.readData(u.length-5))}return null}},e.exports=d},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,e,n){"use strict";function r(p,f,h){this.name=p,this.dir=h.dir,this.date=h.date,this.comment=h.comment,this.unixPermissions=h.unixPermissions,this.dosPermissions=h.dosPermissions,this._data=f,this._dataBinary=h.binary,this.options={compression:h.compression,compressionOptions:h.compressionOptions}}var o=t("./stream/StreamHelper"),s=t("./stream/DataWorker"),i=t("./utf8"),a=t("./compressedObject"),l=t("./stream/GenericWorker");r.prototype={internalStream:function(p){var f=null,h="string";try{if(!p)throw new Error("No output type specified.");var m=(h=p.toLowerCase())==="string"||h==="text";h!=="binarystring"&&h!=="text"||(h="string"),f=this._decompressWorker();var g=!this._dataBinary;g&&!m&&(f=f.pipe(new i.Utf8EncodeWorker)),!g&&m&&(f=f.pipe(new i.Utf8DecodeWorker))}catch(y){(f=new l("error")).error(y)}return new o(f,h,"")},async:function(p,f){return this.internalStream(p).accumulate(f)},nodeStream:function(p,f){return this.internalStream(p||"nodebuffer").toNodejsStream(f)},_compressWorker:function(p,f){if(this._data instanceof a&&this._data.compression.magic===p.magic)return this._data.getCompressedWorker();var h=this._decompressWorker();return this._dataBinary||(h=h.pipe(new i.Utf8EncodeWorker)),a.createWorkerFrom(h,p,f)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof l?this._data:new s(this._data)}};for(var c=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],d=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},u=0;u<c.length;u++)r.prototype[c[u]]=d;e.exports=r},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,e,n){(function(r){"use strict";var o,s,i=r.MutationObserver||r.WebKitMutationObserver;if(i){var a=0,l=new i(p),c=r.document.createTextNode("");l.observe(c,{characterData:!0}),o=function(){c.data=a=++a%2}}else if(r.setImmediate||r.MessageChannel===void 0)o="document"in r&&"onreadystatechange"in r.document.createElement("script")?function(){var f=r.document.createElement("script");f.onreadystatechange=function(){p(),f.onreadystatechange=null,f.parentNode.removeChild(f),f=null},r.document.documentElement.appendChild(f)}:function(){setTimeout(p,0)};else{var d=new r.MessageChannel;d.port1.onmessage=p,o=function(){d.port2.postMessage(0)}}var u=[];function p(){var f,h;s=!0;for(var m=u.length;m;){for(h=u,u=[],f=-1;++f<m;)h[f]();m=u.length}s=!1}e.exports=function(f){u.push(f)!==1||s||o()}}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,e,n){"use strict";var r=t("immediate");function o(){}var s={},i=["REJECTED"],a=["FULFILLED"],l=["PENDING"];function c(m){if(typeof m!="function")throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,m!==o&&f(this,m)}function d(m,g,y){this.promise=m,typeof g=="function"&&(this.onFulfilled=g,this.callFulfilled=this.otherCallFulfilled),typeof y=="function"&&(this.onRejected=y,this.callRejected=this.otherCallRejected)}function u(m,g,y){r(function(){var v;try{v=g(y)}catch(w){return s.reject(m,w)}v===m?s.reject(m,new TypeError("Cannot resolve promise with itself")):s.resolve(m,v)})}function p(m){var g=m&&m.then;if(m&&(typeof m=="object"||typeof m=="function")&&typeof g=="function")return function(){g.apply(m,arguments)}}function f(m,g){var y=!1;function v(E){y||(y=!0,s.reject(m,E))}function w(E){y||(y=!0,s.resolve(m,E))}var x=h(function(){g(w,v)});x.status==="error"&&v(x.value)}function h(m,g){var y={};try{y.value=m(g),y.status="success"}catch(v){y.status="error",y.value=v}return y}(e.exports=c).prototype.finally=function(m){if(typeof m!="function")return this;var g=this.constructor;return this.then(function(y){return g.resolve(m()).then(function(){return y})},function(y){return g.resolve(m()).then(function(){throw y})})},c.prototype.catch=function(m){return this.then(null,m)},c.prototype.then=function(m,g){if(typeof m!="function"&&this.state===a||typeof g!="function"&&this.state===i)return this;var y=new this.constructor(o);return this.state!==l?u(y,this.state===a?m:g,this.outcome):this.queue.push(new d(y,m,g)),y},d.prototype.callFulfilled=function(m){s.resolve(this.promise,m)},d.prototype.otherCallFulfilled=function(m){u(this.promise,this.onFulfilled,m)},d.prototype.callRejected=function(m){s.reject(this.promise,m)},d.prototype.otherCallRejected=function(m){u(this.promise,this.onRejected,m)},s.resolve=function(m,g){var y=h(p,g);if(y.status==="error")return s.reject(m,y.value);var v=y.value;if(v)f(m,v);else{m.state=a,m.outcome=g;for(var w=-1,x=m.queue.length;++w<x;)m.queue[w].callFulfilled(g)}return m},s.reject=function(m,g){m.state=i,m.outcome=g;for(var y=-1,v=m.queue.length;++y<v;)m.queue[y].callRejected(g);return m},c.resolve=function(m){return m instanceof this?m:s.resolve(new this(o),m)},c.reject=function(m){var g=new this(o);return s.reject(g,m)},c.all=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=m.length,v=!1;if(!y)return this.resolve([]);for(var w=new Array(y),x=0,E=-1,L=new this(o);++E<y;)P(m[E],E);return L;function P(V,z){g.resolve(V).then(function(C){w[z]=C,++x!==y||v||(v=!0,s.resolve(L,w))},function(C){v||(v=!0,s.reject(L,C))})}},c.race=function(m){var g=this;if(Object.prototype.toString.call(m)!=="[object Array]")return this.reject(new TypeError("must be an array"));var y=m.length,v=!1;if(!y)return this.resolve([]);for(var w=-1,x=new this(o);++w<y;)E=m[w],g.resolve(E).then(function(L){v||(v=!0,s.resolve(x,L))},function(L){v||(v=!0,s.reject(x,L))});var E;return x}},{immediate:36}],38:[function(t,e,n){"use strict";var r={};(0,t("./lib/utils/common").assign)(r,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=r},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,e,n){"use strict";var r=t("./zlib/deflate"),o=t("./utils/common"),s=t("./utils/strings"),i=t("./zlib/messages"),a=t("./zlib/zstream"),l=Object.prototype.toString,c=0,d=-1,u=0,p=8;function f(m){if(!(this instanceof f))return new f(m);this.options=o.assign({level:d,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:u,to:""},m||{});var g=this.options;g.raw&&0<g.windowBits?g.windowBits=-g.windowBits:g.gzip&&0<g.windowBits&&g.windowBits<16&&(g.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var y=r.deflateInit2(this.strm,g.level,g.method,g.windowBits,g.memLevel,g.strategy);if(y!==c)throw new Error(i[y]);if(g.header&&r.deflateSetHeader(this.strm,g.header),g.dictionary){var v;if(v=typeof g.dictionary=="string"?s.string2buf(g.dictionary):l.call(g.dictionary)==="[object ArrayBuffer]"?new Uint8Array(g.dictionary):g.dictionary,(y=r.deflateSetDictionary(this.strm,v))!==c)throw new Error(i[y]);this._dict_set=!0}}function h(m,g){var y=new f(g);if(y.push(m,!0),y.err)throw y.msg||i[y.err];return y.result}f.prototype.push=function(m,g){var y,v,w=this.strm,x=this.options.chunkSize;if(this.ended)return!1;v=g===~~g?g:g===!0?4:0,typeof m=="string"?w.input=s.string2buf(m):l.call(m)==="[object ArrayBuffer]"?w.input=new Uint8Array(m):w.input=m,w.next_in=0,w.avail_in=w.input.length;do{if(w.avail_out===0&&(w.output=new o.Buf8(x),w.next_out=0,w.avail_out=x),(y=r.deflate(w,v))!==1&&y!==c)return this.onEnd(y),!(this.ended=!0);w.avail_out!==0&&(w.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(s.buf2binstring(o.shrinkBuf(w.output,w.next_out))):this.onData(o.shrinkBuf(w.output,w.next_out)))}while((0<w.avail_in||w.avail_out===0)&&y!==1);return v===4?(y=r.deflateEnd(this.strm),this.onEnd(y),this.ended=!0,y===c):v!==2||(this.onEnd(c),!(w.avail_out=0))},f.prototype.onData=function(m){this.chunks.push(m)},f.prototype.onEnd=function(m){m===c&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Deflate=f,n.deflate=h,n.deflateRaw=function(m,g){return(g=g||{}).raw=!0,h(m,g)},n.gzip=function(m,g){return(g=g||{}).gzip=!0,h(m,g)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,e,n){"use strict";var r=t("./zlib/inflate"),o=t("./utils/common"),s=t("./utils/strings"),i=t("./zlib/constants"),a=t("./zlib/messages"),l=t("./zlib/zstream"),c=t("./zlib/gzheader"),d=Object.prototype.toString;function u(f){if(!(this instanceof u))return new u(f);this.options=o.assign({chunkSize:16384,windowBits:0,to:""},f||{});var h=this.options;h.raw&&0<=h.windowBits&&h.windowBits<16&&(h.windowBits=-h.windowBits,h.windowBits===0&&(h.windowBits=-15)),!(0<=h.windowBits&&h.windowBits<16)||f&&f.windowBits||(h.windowBits+=32),15<h.windowBits&&h.windowBits<48&&!(15&h.windowBits)&&(h.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var m=r.inflateInit2(this.strm,h.windowBits);if(m!==i.Z_OK)throw new Error(a[m]);this.header=new c,r.inflateGetHeader(this.strm,this.header)}function p(f,h){var m=new u(h);if(m.push(f,!0),m.err)throw m.msg||a[m.err];return m.result}u.prototype.push=function(f,h){var m,g,y,v,w,x,E=this.strm,L=this.options.chunkSize,P=this.options.dictionary,V=!1;if(this.ended)return!1;g=h===~~h?h:h===!0?i.Z_FINISH:i.Z_NO_FLUSH,typeof f=="string"?E.input=s.binstring2buf(f):d.call(f)==="[object ArrayBuffer]"?E.input=new Uint8Array(f):E.input=f,E.next_in=0,E.avail_in=E.input.length;do{if(E.avail_out===0&&(E.output=new o.Buf8(L),E.next_out=0,E.avail_out=L),(m=r.inflate(E,i.Z_NO_FLUSH))===i.Z_NEED_DICT&&P&&(x=typeof P=="string"?s.string2buf(P):d.call(P)==="[object ArrayBuffer]"?new Uint8Array(P):P,m=r.inflateSetDictionary(this.strm,x)),m===i.Z_BUF_ERROR&&V===!0&&(m=i.Z_OK,V=!1),m!==i.Z_STREAM_END&&m!==i.Z_OK)return this.onEnd(m),!(this.ended=!0);E.next_out&&(E.avail_out!==0&&m!==i.Z_STREAM_END&&(E.avail_in!==0||g!==i.Z_FINISH&&g!==i.Z_SYNC_FLUSH)||(this.options.to==="string"?(y=s.utf8border(E.output,E.next_out),v=E.next_out-y,w=s.buf2string(E.output,y),E.next_out=v,E.avail_out=L-v,v&&o.arraySet(E.output,E.output,y,v,0),this.onData(w)):this.onData(o.shrinkBuf(E.output,E.next_out)))),E.avail_in===0&&E.avail_out===0&&(V=!0)}while((0<E.avail_in||E.avail_out===0)&&m!==i.Z_STREAM_END);return m===i.Z_STREAM_END&&(g=i.Z_FINISH),g===i.Z_FINISH?(m=r.inflateEnd(this.strm),this.onEnd(m),this.ended=!0,m===i.Z_OK):g!==i.Z_SYNC_FLUSH||(this.onEnd(i.Z_OK),!(E.avail_out=0))},u.prototype.onData=function(f){this.chunks.push(f)},u.prototype.onEnd=function(f){f===i.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=o.flattenChunks(this.chunks)),this.chunks=[],this.err=f,this.msg=this.strm.msg},n.Inflate=u,n.inflate=p,n.inflateRaw=function(f,h){return(h=h||{}).raw=!0,p(f,h)},n.ungzip=p},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,e,n){"use strict";var r=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(i){for(var a=Array.prototype.slice.call(arguments,1);a.length;){var l=a.shift();if(l){if(typeof l!="object")throw new TypeError(l+"must be non-object");for(var c in l)l.hasOwnProperty(c)&&(i[c]=l[c])}}return i},n.shrinkBuf=function(i,a){return i.length===a?i:i.subarray?i.subarray(0,a):(i.length=a,i)};var o={arraySet:function(i,a,l,c,d){if(a.subarray&&i.subarray)i.set(a.subarray(l,l+c),d);else for(var u=0;u<c;u++)i[d+u]=a[l+u]},flattenChunks:function(i){var a,l,c,d,u,p;for(a=c=0,l=i.length;a<l;a++)c+=i[a].length;for(p=new Uint8Array(c),a=d=0,l=i.length;a<l;a++)u=i[a],p.set(u,d),d+=u.length;return p}},s={arraySet:function(i,a,l,c,d){for(var u=0;u<c;u++)i[d+u]=a[l+u]},flattenChunks:function(i){return[].concat.apply([],i)}};n.setTyped=function(i){i?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,o)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,s))},n.setTyped(r)},{}],42:[function(t,e,n){"use strict";var r=t("./common"),o=!0,s=!0;try{String.fromCharCode.apply(null,[0])}catch{o=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{s=!1}for(var i=new r.Buf8(256),a=0;a<256;a++)i[a]=252<=a?6:248<=a?5:240<=a?4:224<=a?3:192<=a?2:1;function l(c,d){if(d<65537&&(c.subarray&&s||!c.subarray&&o))return String.fromCharCode.apply(null,r.shrinkBuf(c,d));for(var u="",p=0;p<d;p++)u+=String.fromCharCode(c[p]);return u}i[254]=i[254]=1,n.string2buf=function(c){var d,u,p,f,h,m=c.length,g=0;for(f=0;f<m;f++)(64512&(u=c.charCodeAt(f)))==55296&&f+1<m&&(64512&(p=c.charCodeAt(f+1)))==56320&&(u=65536+(u-55296<<10)+(p-56320),f++),g+=u<128?1:u<2048?2:u<65536?3:4;for(d=new r.Buf8(g),f=h=0;h<g;f++)(64512&(u=c.charCodeAt(f)))==55296&&f+1<m&&(64512&(p=c.charCodeAt(f+1)))==56320&&(u=65536+(u-55296<<10)+(p-56320),f++),u<128?d[h++]=u:(u<2048?d[h++]=192|u>>>6:(u<65536?d[h++]=224|u>>>12:(d[h++]=240|u>>>18,d[h++]=128|u>>>12&63),d[h++]=128|u>>>6&63),d[h++]=128|63&u);return d},n.buf2binstring=function(c){return l(c,c.length)},n.binstring2buf=function(c){for(var d=new r.Buf8(c.length),u=0,p=d.length;u<p;u++)d[u]=c.charCodeAt(u);return d},n.buf2string=function(c,d){var u,p,f,h,m=d||c.length,g=new Array(2*m);for(u=p=0;u<m;)if((f=c[u++])<128)g[p++]=f;else if(4<(h=i[f]))g[p++]=65533,u+=h-1;else{for(f&=h===2?31:h===3?15:7;1<h&&u<m;)f=f<<6|63&c[u++],h--;1<h?g[p++]=65533:f<65536?g[p++]=f:(f-=65536,g[p++]=55296|f>>10&1023,g[p++]=56320|1023&f)}return l(g,p)},n.utf8border=function(c,d){var u;for((d=d||c.length)>c.length&&(d=c.length),u=d-1;0<=u&&(192&c[u])==128;)u--;return u<0||u===0?d:u+i[c[u]]>d?u:d}},{"./common":41}],43:[function(t,e,n){"use strict";e.exports=function(r,o,s,i){for(var a=65535&r|0,l=r>>>16&65535|0,c=0;s!==0;){for(s-=c=2e3<s?2e3:s;l=l+(a=a+o[i++]|0)|0,--c;);a%=65521,l%=65521}return a|l<<16|0}},{}],44:[function(t,e,n){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,e,n){"use strict";var r=function(){for(var o,s=[],i=0;i<256;i++){o=i;for(var a=0;a<8;a++)o=1&o?3988292384^o>>>1:o>>>1;s[i]=o}return s}();e.exports=function(o,s,i,a){var l=r,c=a+i;o^=-1;for(var d=a;d<c;d++)o=o>>>8^l[255&(o^s[d])];return-1^o}},{}],46:[function(t,e,n){"use strict";var r,o=t("../utils/common"),s=t("./trees"),i=t("./adler32"),a=t("./crc32"),l=t("./messages"),c=0,d=4,u=0,p=-2,f=-1,h=4,m=2,g=8,y=9,v=286,w=30,x=19,E=2*v+1,L=15,P=3,V=258,z=V+P+1,C=42,D=113,S=1,G=2,se=3,X=4;function ue(b,M){return b.msg=l[M],M}function N(b){return(b<<1)-(4<b?9:0)}function ee(b){for(var M=b.length;0<=--M;)b[M]=0}function q(b){var M=b.state,_=M.pending;_>b.avail_out&&(_=b.avail_out),_!==0&&(o.arraySet(b.output,M.pending_buf,M.pending_out,_,b.next_out),b.next_out+=_,M.pending_out+=_,b.total_out+=_,b.avail_out-=_,M.pending-=_,M.pending===0&&(M.pending_out=0))}function A(b,M){s._tr_flush_block(b,0<=b.block_start?b.block_start:-1,b.strstart-b.block_start,M),b.block_start=b.strstart,q(b.strm)}function te(b,M){b.pending_buf[b.pending++]=M}function ne(b,M){b.pending_buf[b.pending++]=M>>>8&255,b.pending_buf[b.pending++]=255&M}function Z(b,M){var _,k,T=b.max_chain_length,F=b.strstart,$=b.prev_length,K=b.nice_match,R=b.strstart>b.w_size-z?b.strstart-(b.w_size-z):0,Y=b.window,re=b.w_mask,I=b.prev,j=b.strstart+V,de=Y[F+$-1],ie=Y[F+$];b.prev_length>=b.good_match&&(T>>=2),K>b.lookahead&&(K=b.lookahead);do if(Y[(_=M)+$]===ie&&Y[_+$-1]===de&&Y[_]===Y[F]&&Y[++_]===Y[F+1]){F+=2,_++;do;while(Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&Y[++F]===Y[++_]&&F<j);if(k=V-(j-F),F=j-V,$<k){if(b.match_start=M,K<=($=k))break;de=Y[F+$-1],ie=Y[F+$]}}while((M=I[M&re])>R&&--T!=0);return $<=b.lookahead?$:b.lookahead}function me(b){var M,_,k,T,F,$,K,R,Y,re,I=b.w_size;do{if(T=b.window_size-b.lookahead-b.strstart,b.strstart>=I+(I-z)){for(o.arraySet(b.window,b.window,I,I,0),b.match_start-=I,b.strstart-=I,b.block_start-=I,M=_=b.hash_size;k=b.head[--M],b.head[M]=I<=k?k-I:0,--_;);for(M=_=I;k=b.prev[--M],b.prev[M]=I<=k?k-I:0,--_;);T+=I}if(b.strm.avail_in===0)break;if($=b.strm,K=b.window,R=b.strstart+b.lookahead,Y=T,re=void 0,re=$.avail_in,Y<re&&(re=Y),_=re===0?0:($.avail_in-=re,o.arraySet(K,$.input,$.next_in,re,R),$.state.wrap===1?$.adler=i($.adler,K,re,R):$.state.wrap===2&&($.adler=a($.adler,K,re,R)),$.next_in+=re,$.total_in+=re,re),b.lookahead+=_,b.lookahead+b.insert>=P)for(F=b.strstart-b.insert,b.ins_h=b.window[F],b.ins_h=(b.ins_h<<b.hash_shift^b.window[F+1])&b.hash_mask;b.insert&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[F+P-1])&b.hash_mask,b.prev[F&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=F,F++,b.insert--,!(b.lookahead+b.insert<P)););}while(b.lookahead<z&&b.strm.avail_in!==0)}function Q(b,M){for(var _,k;;){if(b.lookahead<z){if(me(b),b.lookahead<z&&M===c)return S;if(b.lookahead===0)break}if(_=0,b.lookahead>=P&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,_=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),_!==0&&b.strstart-_<=b.w_size-z&&(b.match_length=Z(b,_)),b.match_length>=P)if(k=s._tr_tally(b,b.strstart-b.match_start,b.match_length-P),b.lookahead-=b.match_length,b.match_length<=b.max_lazy_match&&b.lookahead>=P){for(b.match_length--;b.strstart++,b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,_=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart,--b.match_length!=0;);b.strstart++}else b.strstart+=b.match_length,b.match_length=0,b.ins_h=b.window[b.strstart],b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+1])&b.hash_mask;else k=s._tr_tally(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++;if(k&&(A(b,!1),b.strm.avail_out===0))return S}return b.insert=b.strstart<P-1?b.strstart:P-1,M===d?(A(b,!0),b.strm.avail_out===0?se:X):b.last_lit&&(A(b,!1),b.strm.avail_out===0)?S:G}function oe(b,M){for(var _,k,T;;){if(b.lookahead<z){if(me(b),b.lookahead<z&&M===c)return S;if(b.lookahead===0)break}if(_=0,b.lookahead>=P&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,_=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),b.prev_length=b.match_length,b.prev_match=b.match_start,b.match_length=P-1,_!==0&&b.prev_length<b.max_lazy_match&&b.strstart-_<=b.w_size-z&&(b.match_length=Z(b,_),b.match_length<=5&&(b.strategy===1||b.match_length===P&&4096<b.strstart-b.match_start)&&(b.match_length=P-1)),b.prev_length>=P&&b.match_length<=b.prev_length){for(T=b.strstart+b.lookahead-P,k=s._tr_tally(b,b.strstart-1-b.prev_match,b.prev_length-P),b.lookahead-=b.prev_length-1,b.prev_length-=2;++b.strstart<=T&&(b.ins_h=(b.ins_h<<b.hash_shift^b.window[b.strstart+P-1])&b.hash_mask,_=b.prev[b.strstart&b.w_mask]=b.head[b.ins_h],b.head[b.ins_h]=b.strstart),--b.prev_length!=0;);if(b.match_available=0,b.match_length=P-1,b.strstart++,k&&(A(b,!1),b.strm.avail_out===0))return S}else if(b.match_available){if((k=s._tr_tally(b,0,b.window[b.strstart-1]))&&A(b,!1),b.strstart++,b.lookahead--,b.strm.avail_out===0)return S}else b.match_available=1,b.strstart++,b.lookahead--}return b.match_available&&(k=s._tr_tally(b,0,b.window[b.strstart-1]),b.match_available=0),b.insert=b.strstart<P-1?b.strstart:P-1,M===d?(A(b,!0),b.strm.avail_out===0?se:X):b.last_lit&&(A(b,!1),b.strm.avail_out===0)?S:G}function W(b,M,_,k,T){this.good_length=b,this.max_lazy=M,this.nice_length=_,this.max_chain=k,this.func=T}function U(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=g,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new o.Buf16(2*E),this.dyn_dtree=new o.Buf16(2*(2*w+1)),this.bl_tree=new o.Buf16(2*(2*x+1)),ee(this.dyn_ltree),ee(this.dyn_dtree),ee(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new o.Buf16(L+1),this.heap=new o.Buf16(2*v+1),ee(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new o.Buf16(2*v+1),ee(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function J(b){var M;return b&&b.state?(b.total_in=b.total_out=0,b.data_type=m,(M=b.state).pending=0,M.pending_out=0,M.wrap<0&&(M.wrap=-M.wrap),M.status=M.wrap?C:D,b.adler=M.wrap===2?0:1,M.last_flush=c,s._tr_init(M),u):ue(b,p)}function B(b){var M=J(b);return M===u&&function(_){_.window_size=2*_.w_size,ee(_.head),_.max_lazy_match=r[_.level].max_lazy,_.good_match=r[_.level].good_length,_.nice_match=r[_.level].nice_length,_.max_chain_length=r[_.level].max_chain,_.strstart=0,_.block_start=0,_.lookahead=0,_.insert=0,_.match_length=_.prev_length=P-1,_.match_available=0,_.ins_h=0}(b.state),M}function O(b,M,_,k,T,F){if(!b)return p;var $=1;if(M===f&&(M=6),k<0?($=0,k=-k):15<k&&($=2,k-=16),T<1||y<T||_!==g||k<8||15<k||M<0||9<M||F<0||h<F)return ue(b,p);k===8&&(k=9);var K=new U;return(b.state=K).strm=b,K.wrap=$,K.gzhead=null,K.w_bits=k,K.w_size=1<<K.w_bits,K.w_mask=K.w_size-1,K.hash_bits=T+7,K.hash_size=1<<K.hash_bits,K.hash_mask=K.hash_size-1,K.hash_shift=~~((K.hash_bits+P-1)/P),K.window=new o.Buf8(2*K.w_size),K.head=new o.Buf16(K.hash_size),K.prev=new o.Buf16(K.w_size),K.lit_bufsize=1<<T+6,K.pending_buf_size=4*K.lit_bufsize,K.pending_buf=new o.Buf8(K.pending_buf_size),K.d_buf=1*K.lit_bufsize,K.l_buf=3*K.lit_bufsize,K.level=M,K.strategy=F,K.method=_,B(b)}r=[new W(0,0,0,0,function(b,M){var _=65535;for(_>b.pending_buf_size-5&&(_=b.pending_buf_size-5);;){if(b.lookahead<=1){if(me(b),b.lookahead===0&&M===c)return S;if(b.lookahead===0)break}b.strstart+=b.lookahead,b.lookahead=0;var k=b.block_start+_;if((b.strstart===0||b.strstart>=k)&&(b.lookahead=b.strstart-k,b.strstart=k,A(b,!1),b.strm.avail_out===0)||b.strstart-b.block_start>=b.w_size-z&&(A(b,!1),b.strm.avail_out===0))return S}return b.insert=0,M===d?(A(b,!0),b.strm.avail_out===0?se:X):(b.strstart>b.block_start&&(A(b,!1),b.strm.avail_out),S)}),new W(4,4,8,4,Q),new W(4,5,16,8,Q),new W(4,6,32,32,Q),new W(4,4,16,16,oe),new W(8,16,32,32,oe),new W(8,16,128,128,oe),new W(8,32,128,256,oe),new W(32,128,258,1024,oe),new W(32,258,258,4096,oe)],n.deflateInit=function(b,M){return O(b,M,g,15,8,0)},n.deflateInit2=O,n.deflateReset=B,n.deflateResetKeep=J,n.deflateSetHeader=function(b,M){return b&&b.state?b.state.wrap!==2?p:(b.state.gzhead=M,u):p},n.deflate=function(b,M){var _,k,T,F;if(!b||!b.state||5<M||M<0)return b?ue(b,p):p;if(k=b.state,!b.output||!b.input&&b.avail_in!==0||k.status===666&&M!==d)return ue(b,b.avail_out===0?-5:p);if(k.strm=b,_=k.last_flush,k.last_flush=M,k.status===C)if(k.wrap===2)b.adler=0,te(k,31),te(k,139),te(k,8),k.gzhead?(te(k,(k.gzhead.text?1:0)+(k.gzhead.hcrc?2:0)+(k.gzhead.extra?4:0)+(k.gzhead.name?8:0)+(k.gzhead.comment?16:0)),te(k,255&k.gzhead.time),te(k,k.gzhead.time>>8&255),te(k,k.gzhead.time>>16&255),te(k,k.gzhead.time>>24&255),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,255&k.gzhead.os),k.gzhead.extra&&k.gzhead.extra.length&&(te(k,255&k.gzhead.extra.length),te(k,k.gzhead.extra.length>>8&255)),k.gzhead.hcrc&&(b.adler=a(b.adler,k.pending_buf,k.pending,0)),k.gzindex=0,k.status=69):(te(k,0),te(k,0),te(k,0),te(k,0),te(k,0),te(k,k.level===9?2:2<=k.strategy||k.level<2?4:0),te(k,3),k.status=D);else{var $=g+(k.w_bits-8<<4)<<8;$|=(2<=k.strategy||k.level<2?0:k.level<6?1:k.level===6?2:3)<<6,k.strstart!==0&&($|=32),$+=31-$%31,k.status=D,ne(k,$),k.strstart!==0&&(ne(k,b.adler>>>16),ne(k,65535&b.adler)),b.adler=1}if(k.status===69)if(k.gzhead.extra){for(T=k.pending;k.gzindex<(65535&k.gzhead.extra.length)&&(k.pending!==k.pending_buf_size||(k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),q(b),T=k.pending,k.pending!==k.pending_buf_size));)te(k,255&k.gzhead.extra[k.gzindex]),k.gzindex++;k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),k.gzindex===k.gzhead.extra.length&&(k.gzindex=0,k.status=73)}else k.status=73;if(k.status===73)if(k.gzhead.name){T=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),q(b),T=k.pending,k.pending===k.pending_buf_size)){F=1;break}F=k.gzindex<k.gzhead.name.length?255&k.gzhead.name.charCodeAt(k.gzindex++):0,te(k,F)}while(F!==0);k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),F===0&&(k.gzindex=0,k.status=91)}else k.status=91;if(k.status===91)if(k.gzhead.comment){T=k.pending;do{if(k.pending===k.pending_buf_size&&(k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),q(b),T=k.pending,k.pending===k.pending_buf_size)){F=1;break}F=k.gzindex<k.gzhead.comment.length?255&k.gzhead.comment.charCodeAt(k.gzindex++):0,te(k,F)}while(F!==0);k.gzhead.hcrc&&k.pending>T&&(b.adler=a(b.adler,k.pending_buf,k.pending-T,T)),F===0&&(k.status=103)}else k.status=103;if(k.status===103&&(k.gzhead.hcrc?(k.pending+2>k.pending_buf_size&&q(b),k.pending+2<=k.pending_buf_size&&(te(k,255&b.adler),te(k,b.adler>>8&255),b.adler=0,k.status=D)):k.status=D),k.pending!==0){if(q(b),b.avail_out===0)return k.last_flush=-1,u}else if(b.avail_in===0&&N(M)<=N(_)&&M!==d)return ue(b,-5);if(k.status===666&&b.avail_in!==0)return ue(b,-5);if(b.avail_in!==0||k.lookahead!==0||M!==c&&k.status!==666){var K=k.strategy===2?function(R,Y){for(var re;;){if(R.lookahead===0&&(me(R),R.lookahead===0)){if(Y===c)return S;break}if(R.match_length=0,re=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++,re&&(A(R,!1),R.strm.avail_out===0))return S}return R.insert=0,Y===d?(A(R,!0),R.strm.avail_out===0?se:X):R.last_lit&&(A(R,!1),R.strm.avail_out===0)?S:G}(k,M):k.strategy===3?function(R,Y){for(var re,I,j,de,ie=R.window;;){if(R.lookahead<=V){if(me(R),R.lookahead<=V&&Y===c)return S;if(R.lookahead===0)break}if(R.match_length=0,R.lookahead>=P&&0<R.strstart&&(I=ie[j=R.strstart-1])===ie[++j]&&I===ie[++j]&&I===ie[++j]){de=R.strstart+V;do;while(I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&I===ie[++j]&&j<de);R.match_length=V-(de-j),R.match_length>R.lookahead&&(R.match_length=R.lookahead)}if(R.match_length>=P?(re=s._tr_tally(R,1,R.match_length-P),R.lookahead-=R.match_length,R.strstart+=R.match_length,R.match_length=0):(re=s._tr_tally(R,0,R.window[R.strstart]),R.lookahead--,R.strstart++),re&&(A(R,!1),R.strm.avail_out===0))return S}return R.insert=0,Y===d?(A(R,!0),R.strm.avail_out===0?se:X):R.last_lit&&(A(R,!1),R.strm.avail_out===0)?S:G}(k,M):r[k.level].func(k,M);if(K!==se&&K!==X||(k.status=666),K===S||K===se)return b.avail_out===0&&(k.last_flush=-1),u;if(K===G&&(M===1?s._tr_align(k):M!==5&&(s._tr_stored_block(k,0,0,!1),M===3&&(ee(k.head),k.lookahead===0&&(k.strstart=0,k.block_start=0,k.insert=0))),q(b),b.avail_out===0))return k.last_flush=-1,u}return M!==d?u:k.wrap<=0?1:(k.wrap===2?(te(k,255&b.adler),te(k,b.adler>>8&255),te(k,b.adler>>16&255),te(k,b.adler>>24&255),te(k,255&b.total_in),te(k,b.total_in>>8&255),te(k,b.total_in>>16&255),te(k,b.total_in>>24&255)):(ne(k,b.adler>>>16),ne(k,65535&b.adler)),q(b),0<k.wrap&&(k.wrap=-k.wrap),k.pending!==0?u:1)},n.deflateEnd=function(b){var M;return b&&b.state?(M=b.state.status)!==C&&M!==69&&M!==73&&M!==91&&M!==103&&M!==D&&M!==666?ue(b,p):(b.state=null,M===D?ue(b,-3):u):p},n.deflateSetDictionary=function(b,M){var _,k,T,F,$,K,R,Y,re=M.length;if(!b||!b.state||(F=(_=b.state).wrap)===2||F===1&&_.status!==C||_.lookahead)return p;for(F===1&&(b.adler=i(b.adler,M,re,0)),_.wrap=0,re>=_.w_size&&(F===0&&(ee(_.head),_.strstart=0,_.block_start=0,_.insert=0),Y=new o.Buf8(_.w_size),o.arraySet(Y,M,re-_.w_size,_.w_size,0),M=Y,re=_.w_size),$=b.avail_in,K=b.next_in,R=b.input,b.avail_in=re,b.next_in=0,b.input=M,me(_);_.lookahead>=P;){for(k=_.strstart,T=_.lookahead-(P-1);_.ins_h=(_.ins_h<<_.hash_shift^_.window[k+P-1])&_.hash_mask,_.prev[k&_.w_mask]=_.head[_.ins_h],_.head[_.ins_h]=k,k++,--T;);_.strstart=k,_.lookahead=P-1,me(_)}return _.strstart+=_.lookahead,_.block_start=_.strstart,_.insert=_.lookahead,_.lookahead=0,_.match_length=_.prev_length=P-1,_.match_available=0,b.next_in=K,b.input=R,b.avail_in=$,_.wrap=F,u},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,e,n){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,e,n){"use strict";e.exports=function(r,o){var s,i,a,l,c,d,u,p,f,h,m,g,y,v,w,x,E,L,P,V,z,C,D,S,G;s=r.state,i=r.next_in,S=r.input,a=i+(r.avail_in-5),l=r.next_out,G=r.output,c=l-(o-r.avail_out),d=l+(r.avail_out-257),u=s.dmax,p=s.wsize,f=s.whave,h=s.wnext,m=s.window,g=s.hold,y=s.bits,v=s.lencode,w=s.distcode,x=(1<<s.lenbits)-1,E=(1<<s.distbits)-1;e:do{y<15&&(g+=S[i++]<<y,y+=8,g+=S[i++]<<y,y+=8),L=v[g&x];t:for(;;){if(g>>>=P=L>>>24,y-=P,(P=L>>>16&255)===0)G[l++]=65535&L;else{if(!(16&P)){if(!(64&P)){L=v[(65535&L)+(g&(1<<P)-1)];continue t}if(32&P){s.mode=12;break e}r.msg="invalid literal/length code",s.mode=30;break e}V=65535&L,(P&=15)&&(y<P&&(g+=S[i++]<<y,y+=8),V+=g&(1<<P)-1,g>>>=P,y-=P),y<15&&(g+=S[i++]<<y,y+=8,g+=S[i++]<<y,y+=8),L=w[g&E];n:for(;;){if(g>>>=P=L>>>24,y-=P,!(16&(P=L>>>16&255))){if(!(64&P)){L=w[(65535&L)+(g&(1<<P)-1)];continue n}r.msg="invalid distance code",s.mode=30;break e}if(z=65535&L,y<(P&=15)&&(g+=S[i++]<<y,(y+=8)<P&&(g+=S[i++]<<y,y+=8)),u<(z+=g&(1<<P)-1)){r.msg="invalid distance too far back",s.mode=30;break e}if(g>>>=P,y-=P,(P=l-c)<z){if(f<(P=z-P)&&s.sane){r.msg="invalid distance too far back",s.mode=30;break e}if(D=m,(C=0)===h){if(C+=p-P,P<V){for(V-=P;G[l++]=m[C++],--P;);C=l-z,D=G}}else if(h<P){if(C+=p+h-P,(P-=h)<V){for(V-=P;G[l++]=m[C++],--P;);if(C=0,h<V){for(V-=P=h;G[l++]=m[C++],--P;);C=l-z,D=G}}}else if(C+=h-P,P<V){for(V-=P;G[l++]=m[C++],--P;);C=l-z,D=G}for(;2<V;)G[l++]=D[C++],G[l++]=D[C++],G[l++]=D[C++],V-=3;V&&(G[l++]=D[C++],1<V&&(G[l++]=D[C++]))}else{for(C=l-z;G[l++]=G[C++],G[l++]=G[C++],G[l++]=G[C++],2<(V-=3););V&&(G[l++]=G[C++],1<V&&(G[l++]=G[C++]))}break}}break}}while(i<a&&l<d);i-=V=y>>3,g&=(1<<(y-=V<<3))-1,r.next_in=i,r.next_out=l,r.avail_in=i<a?a-i+5:5-(i-a),r.avail_out=l<d?d-l+257:257-(l-d),s.hold=g,s.bits=y}},{}],49:[function(t,e,n){"use strict";var r=t("../utils/common"),o=t("./adler32"),s=t("./crc32"),i=t("./inffast"),a=t("./inftrees"),l=1,c=2,d=0,u=-2,p=1,f=852,h=592;function m(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function g(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function y(C){var D;return C&&C.state?(D=C.state,C.total_in=C.total_out=D.total=0,C.msg="",D.wrap&&(C.adler=1&D.wrap),D.mode=p,D.last=0,D.havedict=0,D.dmax=32768,D.head=null,D.hold=0,D.bits=0,D.lencode=D.lendyn=new r.Buf32(f),D.distcode=D.distdyn=new r.Buf32(h),D.sane=1,D.back=-1,d):u}function v(C){var D;return C&&C.state?((D=C.state).wsize=0,D.whave=0,D.wnext=0,y(C)):u}function w(C,D){var S,G;return C&&C.state?(G=C.state,D<0?(S=0,D=-D):(S=1+(D>>4),D<48&&(D&=15)),D&&(D<8||15<D)?u:(G.window!==null&&G.wbits!==D&&(G.window=null),G.wrap=S,G.wbits=D,v(C))):u}function x(C,D){var S,G;return C?(G=new g,(C.state=G).window=null,(S=w(C,D))!==d&&(C.state=null),S):u}var E,L,P=!0;function V(C){if(P){var D;for(E=new r.Buf32(512),L=new r.Buf32(32),D=0;D<144;)C.lens[D++]=8;for(;D<256;)C.lens[D++]=9;for(;D<280;)C.lens[D++]=7;for(;D<288;)C.lens[D++]=8;for(a(l,C.lens,0,288,E,0,C.work,{bits:9}),D=0;D<32;)C.lens[D++]=5;a(c,C.lens,0,32,L,0,C.work,{bits:5}),P=!1}C.lencode=E,C.lenbits=9,C.distcode=L,C.distbits=5}function z(C,D,S,G){var se,X=C.state;return X.window===null&&(X.wsize=1<<X.wbits,X.wnext=0,X.whave=0,X.window=new r.Buf8(X.wsize)),G>=X.wsize?(r.arraySet(X.window,D,S-X.wsize,X.wsize,0),X.wnext=0,X.whave=X.wsize):(G<(se=X.wsize-X.wnext)&&(se=G),r.arraySet(X.window,D,S-G,se,X.wnext),(G-=se)?(r.arraySet(X.window,D,S-G,G,0),X.wnext=G,X.whave=X.wsize):(X.wnext+=se,X.wnext===X.wsize&&(X.wnext=0),X.whave<X.wsize&&(X.whave+=se))),0}n.inflateReset=v,n.inflateReset2=w,n.inflateResetKeep=y,n.inflateInit=function(C){return x(C,15)},n.inflateInit2=x,n.inflate=function(C,D){var S,G,se,X,ue,N,ee,q,A,te,ne,Z,me,Q,oe,W,U,J,B,O,b,M,_,k,T=0,F=new r.Buf8(4),$=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return u;(S=C.state).mode===12&&(S.mode=13),ue=C.next_out,se=C.output,ee=C.avail_out,X=C.next_in,G=C.input,N=C.avail_in,q=S.hold,A=S.bits,te=N,ne=ee,M=d;e:for(;;)switch(S.mode){case p:if(S.wrap===0){S.mode=13;break}for(;A<16;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(2&S.wrap&&q===35615){F[S.check=0]=255&q,F[1]=q>>>8&255,S.check=s(S.check,F,2,0),A=q=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&q)<<8)+(q>>8))%31){C.msg="incorrect header check",S.mode=30;break}if((15&q)!=8){C.msg="unknown compression method",S.mode=30;break}if(A-=4,b=8+(15&(q>>>=4)),S.wbits===0)S.wbits=b;else if(b>S.wbits){C.msg="invalid window size",S.mode=30;break}S.dmax=1<<b,C.adler=S.check=1,S.mode=512&q?10:12,A=q=0;break;case 2:for(;A<16;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(S.flags=q,(255&S.flags)!=8){C.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){C.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=q>>8&1),512&S.flags&&(F[0]=255&q,F[1]=q>>>8&255,S.check=s(S.check,F,2,0)),A=q=0,S.mode=3;case 3:for(;A<32;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.head&&(S.head.time=q),512&S.flags&&(F[0]=255&q,F[1]=q>>>8&255,F[2]=q>>>16&255,F[3]=q>>>24&255,S.check=s(S.check,F,4,0)),A=q=0,S.mode=4;case 4:for(;A<16;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.head&&(S.head.xflags=255&q,S.head.os=q>>8),512&S.flags&&(F[0]=255&q,F[1]=q>>>8&255,S.check=s(S.check,F,2,0)),A=q=0,S.mode=5;case 5:if(1024&S.flags){for(;A<16;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.length=q,S.head&&(S.head.extra_len=q),512&S.flags&&(F[0]=255&q,F[1]=q>>>8&255,S.check=s(S.check,F,2,0)),A=q=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(N<(Z=S.length)&&(Z=N),Z&&(S.head&&(b=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),r.arraySet(S.head.extra,G,X,Z,b)),512&S.flags&&(S.check=s(S.check,G,Z,X)),N-=Z,X+=Z,S.length-=Z),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(N===0)break e;for(Z=0;b=G[X+Z++],S.head&&b&&S.length<65536&&(S.head.name+=String.fromCharCode(b)),b&&Z<N;);if(512&S.flags&&(S.check=s(S.check,G,Z,X)),N-=Z,X+=Z,b)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(N===0)break e;for(Z=0;b=G[X+Z++],S.head&&b&&S.length<65536&&(S.head.comment+=String.fromCharCode(b)),b&&Z<N;);if(512&S.flags&&(S.check=s(S.check,G,Z,X)),N-=Z,X+=Z,b)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;A<16;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(q!==(65535&S.check)){C.msg="header crc mismatch",S.mode=30;break}A=q=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),C.adler=S.check=0,S.mode=12;break;case 10:for(;A<32;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}C.adler=S.check=m(q),A=q=0,S.mode=11;case 11:if(S.havedict===0)return C.next_out=ue,C.avail_out=ee,C.next_in=X,C.avail_in=N,S.hold=q,S.bits=A,2;C.adler=S.check=1,S.mode=12;case 12:if(D===5||D===6)break e;case 13:if(S.last){q>>>=7&A,A-=7&A,S.mode=27;break}for(;A<3;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}switch(S.last=1&q,A-=1,3&(q>>>=1)){case 0:S.mode=14;break;case 1:if(V(S),S.mode=20,D!==6)break;q>>>=2,A-=2;break e;case 2:S.mode=17;break;case 3:C.msg="invalid block type",S.mode=30}q>>>=2,A-=2;break;case 14:for(q>>>=7&A,A-=7&A;A<32;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if((65535&q)!=(q>>>16^65535)){C.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&q,A=q=0,S.mode=15,D===6)break e;case 15:S.mode=16;case 16:if(Z=S.length){if(N<Z&&(Z=N),ee<Z&&(Z=ee),Z===0)break e;r.arraySet(se,G,X,Z,ue),N-=Z,X+=Z,ee-=Z,ue+=Z,S.length-=Z;break}S.mode=12;break;case 17:for(;A<14;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(S.nlen=257+(31&q),q>>>=5,A-=5,S.ndist=1+(31&q),q>>>=5,A-=5,S.ncode=4+(15&q),q>>>=4,A-=4,286<S.nlen||30<S.ndist){C.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;A<3;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.lens[$[S.have++]]=7&q,q>>>=3,A-=3}for(;S.have<19;)S.lens[$[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,_={bits:S.lenbits},M=a(0,S.lens,0,19,S.lencode,0,S.work,_),S.lenbits=_.bits,M){C.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;W=(T=S.lencode[q&(1<<S.lenbits)-1])>>>16&255,U=65535&T,!((oe=T>>>24)<=A);){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(U<16)q>>>=oe,A-=oe,S.lens[S.have++]=U;else{if(U===16){for(k=oe+2;A<k;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(q>>>=oe,A-=oe,S.have===0){C.msg="invalid bit length repeat",S.mode=30;break}b=S.lens[S.have-1],Z=3+(3&q),q>>>=2,A-=2}else if(U===17){for(k=oe+3;A<k;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}A-=oe,b=0,Z=3+(7&(q>>>=oe)),q>>>=3,A-=3}else{for(k=oe+7;A<k;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}A-=oe,b=0,Z=11+(127&(q>>>=oe)),q>>>=7,A-=7}if(S.have+Z>S.nlen+S.ndist){C.msg="invalid bit length repeat",S.mode=30;break}for(;Z--;)S.lens[S.have++]=b}}if(S.mode===30)break;if(S.lens[256]===0){C.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,_={bits:S.lenbits},M=a(l,S.lens,0,S.nlen,S.lencode,0,S.work,_),S.lenbits=_.bits,M){C.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,_={bits:S.distbits},M=a(c,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,_),S.distbits=_.bits,M){C.msg="invalid distances set",S.mode=30;break}if(S.mode=20,D===6)break e;case 20:S.mode=21;case 21:if(6<=N&&258<=ee){C.next_out=ue,C.avail_out=ee,C.next_in=X,C.avail_in=N,S.hold=q,S.bits=A,i(C,ne),ue=C.next_out,se=C.output,ee=C.avail_out,X=C.next_in,G=C.input,N=C.avail_in,q=S.hold,A=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;W=(T=S.lencode[q&(1<<S.lenbits)-1])>>>16&255,U=65535&T,!((oe=T>>>24)<=A);){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(W&&!(240&W)){for(J=oe,B=W,O=U;W=(T=S.lencode[O+((q&(1<<J+B)-1)>>J)])>>>16&255,U=65535&T,!(J+(oe=T>>>24)<=A);){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}q>>>=J,A-=J,S.back+=J}if(q>>>=oe,A-=oe,S.back+=oe,S.length=U,W===0){S.mode=26;break}if(32&W){S.back=-1,S.mode=12;break}if(64&W){C.msg="invalid literal/length code",S.mode=30;break}S.extra=15&W,S.mode=22;case 22:if(S.extra){for(k=S.extra;A<k;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.length+=q&(1<<S.extra)-1,q>>>=S.extra,A-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;W=(T=S.distcode[q&(1<<S.distbits)-1])>>>16&255,U=65535&T,!((oe=T>>>24)<=A);){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(!(240&W)){for(J=oe,B=W,O=U;W=(T=S.distcode[O+((q&(1<<J+B)-1)>>J)])>>>16&255,U=65535&T,!(J+(oe=T>>>24)<=A);){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}q>>>=J,A-=J,S.back+=J}if(q>>>=oe,A-=oe,S.back+=oe,64&W){C.msg="invalid distance code",S.mode=30;break}S.offset=U,S.extra=15&W,S.mode=24;case 24:if(S.extra){for(k=S.extra;A<k;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}S.offset+=q&(1<<S.extra)-1,q>>>=S.extra,A-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){C.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if(ee===0)break e;if(Z=ne-ee,S.offset>Z){if((Z=S.offset-Z)>S.whave&&S.sane){C.msg="invalid distance too far back",S.mode=30;break}me=Z>S.wnext?(Z-=S.wnext,S.wsize-Z):S.wnext-Z,Z>S.length&&(Z=S.length),Q=S.window}else Q=se,me=ue-S.offset,Z=S.length;for(ee<Z&&(Z=ee),ee-=Z,S.length-=Z;se[ue++]=Q[me++],--Z;);S.length===0&&(S.mode=21);break;case 26:if(ee===0)break e;se[ue++]=S.length,ee--,S.mode=21;break;case 27:if(S.wrap){for(;A<32;){if(N===0)break e;N--,q|=G[X++]<<A,A+=8}if(ne-=ee,C.total_out+=ne,S.total+=ne,ne&&(C.adler=S.check=S.flags?s(S.check,se,ne,ue-ne):o(S.check,se,ne,ue-ne)),ne=ee,(S.flags?q:m(q))!==S.check){C.msg="incorrect data check",S.mode=30;break}A=q=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;A<32;){if(N===0)break e;N--,q+=G[X++]<<A,A+=8}if(q!==(4294967295&S.total)){C.msg="incorrect length check",S.mode=30;break}A=q=0}S.mode=29;case 29:M=1;break e;case 30:M=-3;break e;case 31:return-4;case 32:default:return u}return C.next_out=ue,C.avail_out=ee,C.next_in=X,C.avail_in=N,S.hold=q,S.bits=A,(S.wsize||ne!==C.avail_out&&S.mode<30&&(S.mode<27||D!==4))&&z(C,C.output,C.next_out,ne-C.avail_out)?(S.mode=31,-4):(te-=C.avail_in,ne-=C.avail_out,C.total_in+=te,C.total_out+=ne,S.total+=ne,S.wrap&&ne&&(C.adler=S.check=S.flags?s(S.check,se,ne,C.next_out-ne):o(S.check,se,ne,C.next_out-ne)),C.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(te==0&&ne===0||D===4)&&M===d&&(M=-5),M)},n.inflateEnd=function(C){if(!C||!C.state)return u;var D=C.state;return D.window&&(D.window=null),C.state=null,d},n.inflateGetHeader=function(C,D){var S;return C&&C.state&&2&(S=C.state).wrap?((S.head=D).done=!1,d):u},n.inflateSetDictionary=function(C,D){var S,G=D.length;return C&&C.state?(S=C.state).wrap!==0&&S.mode!==11?u:S.mode===11&&o(1,D,G,0)!==S.check?-3:z(C,D,G,G)?(S.mode=31,-4):(S.havedict=1,d):u},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,e,n){"use strict";var r=t("../utils/common"),o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],s=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],i=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],a=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(l,c,d,u,p,f,h,m){var g,y,v,w,x,E,L,P,V,z=m.bits,C=0,D=0,S=0,G=0,se=0,X=0,ue=0,N=0,ee=0,q=0,A=null,te=0,ne=new r.Buf16(16),Z=new r.Buf16(16),me=null,Q=0;for(C=0;C<=15;C++)ne[C]=0;for(D=0;D<u;D++)ne[c[d+D]]++;for(se=z,G=15;1<=G&&ne[G]===0;G--);if(G<se&&(se=G),G===0)return p[f++]=20971520,p[f++]=20971520,m.bits=1,0;for(S=1;S<G&&ne[S]===0;S++);for(se<S&&(se=S),C=N=1;C<=15;C++)if(N<<=1,(N-=ne[C])<0)return-1;if(0<N&&(l===0||G!==1))return-1;for(Z[1]=0,C=1;C<15;C++)Z[C+1]=Z[C]+ne[C];for(D=0;D<u;D++)c[d+D]!==0&&(h[Z[c[d+D]]++]=D);if(E=l===0?(A=me=h,19):l===1?(A=o,te-=257,me=s,Q-=257,256):(A=i,me=a,-1),C=S,x=f,ue=D=q=0,v=-1,w=(ee=1<<(X=se))-1,l===1&&852<ee||l===2&&592<ee)return 1;for(;;){for(L=C-ue,V=h[D]<E?(P=0,h[D]):h[D]>E?(P=me[Q+h[D]],A[te+h[D]]):(P=96,0),g=1<<C-ue,S=y=1<<X;p[x+(q>>ue)+(y-=g)]=L<<24|P<<16|V|0,y!==0;);for(g=1<<C-1;q&g;)g>>=1;if(g!==0?(q&=g-1,q+=g):q=0,D++,--ne[C]==0){if(C===G)break;C=c[d+h[D]]}if(se<C&&(q&w)!==v){for(ue===0&&(ue=se),x+=S,N=1<<(X=C-ue);X+ue<G&&!((N-=ne[X+ue])<=0);)X++,N<<=1;if(ee+=1<<X,l===1&&852<ee||l===2&&592<ee)return 1;p[v=q&w]=se<<24|X<<16|x-f|0}}return q!==0&&(p[x+q]=C-ue<<24|64<<16|0),m.bits=se,0}},{"../utils/common":41}],51:[function(t,e,n){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,e,n){"use strict";var r=t("../utils/common"),o=0,s=1;function i(T){for(var F=T.length;0<=--F;)T[F]=0}var a=0,l=29,c=256,d=c+1+l,u=30,p=19,f=2*d+1,h=15,m=16,g=7,y=256,v=16,w=17,x=18,E=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],L=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],P=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=new Array(2*(d+2));i(z);var C=new Array(2*u);i(C);var D=new Array(512);i(D);var S=new Array(256);i(S);var G=new Array(l);i(G);var se,X,ue,N=new Array(u);function ee(T,F,$,K,R){this.static_tree=T,this.extra_bits=F,this.extra_base=$,this.elems=K,this.max_length=R,this.has_stree=T&&T.length}function q(T,F){this.dyn_tree=T,this.max_code=0,this.stat_desc=F}function A(T){return T<256?D[T]:D[256+(T>>>7)]}function te(T,F){T.pending_buf[T.pending++]=255&F,T.pending_buf[T.pending++]=F>>>8&255}function ne(T,F,$){T.bi_valid>m-$?(T.bi_buf|=F<<T.bi_valid&65535,te(T,T.bi_buf),T.bi_buf=F>>m-T.bi_valid,T.bi_valid+=$-m):(T.bi_buf|=F<<T.bi_valid&65535,T.bi_valid+=$)}function Z(T,F,$){ne(T,$[2*F],$[2*F+1])}function me(T,F){for(var $=0;$|=1&T,T>>>=1,$<<=1,0<--F;);return $>>>1}function Q(T,F,$){var K,R,Y=new Array(h+1),re=0;for(K=1;K<=h;K++)Y[K]=re=re+$[K-1]<<1;for(R=0;R<=F;R++){var I=T[2*R+1];I!==0&&(T[2*R]=me(Y[I]++,I))}}function oe(T){var F;for(F=0;F<d;F++)T.dyn_ltree[2*F]=0;for(F=0;F<u;F++)T.dyn_dtree[2*F]=0;for(F=0;F<p;F++)T.bl_tree[2*F]=0;T.dyn_ltree[2*y]=1,T.opt_len=T.static_len=0,T.last_lit=T.matches=0}function W(T){8<T.bi_valid?te(T,T.bi_buf):0<T.bi_valid&&(T.pending_buf[T.pending++]=T.bi_buf),T.bi_buf=0,T.bi_valid=0}function U(T,F,$,K){var R=2*F,Y=2*$;return T[R]<T[Y]||T[R]===T[Y]&&K[F]<=K[$]}function J(T,F,$){for(var K=T.heap[$],R=$<<1;R<=T.heap_len&&(R<T.heap_len&&U(F,T.heap[R+1],T.heap[R],T.depth)&&R++,!U(F,K,T.heap[R],T.depth));)T.heap[$]=T.heap[R],$=R,R<<=1;T.heap[$]=K}function B(T,F,$){var K,R,Y,re,I=0;if(T.last_lit!==0)for(;K=T.pending_buf[T.d_buf+2*I]<<8|T.pending_buf[T.d_buf+2*I+1],R=T.pending_buf[T.l_buf+I],I++,K===0?Z(T,R,F):(Z(T,(Y=S[R])+c+1,F),(re=E[Y])!==0&&ne(T,R-=G[Y],re),Z(T,Y=A(--K),$),(re=L[Y])!==0&&ne(T,K-=N[Y],re)),I<T.last_lit;);Z(T,y,F)}function O(T,F){var $,K,R,Y=F.dyn_tree,re=F.stat_desc.static_tree,I=F.stat_desc.has_stree,j=F.stat_desc.elems,de=-1;for(T.heap_len=0,T.heap_max=f,$=0;$<j;$++)Y[2*$]!==0?(T.heap[++T.heap_len]=de=$,T.depth[$]=0):Y[2*$+1]=0;for(;T.heap_len<2;)Y[2*(R=T.heap[++T.heap_len]=de<2?++de:0)]=1,T.depth[R]=0,T.opt_len--,I&&(T.static_len-=re[2*R+1]);for(F.max_code=de,$=T.heap_len>>1;1<=$;$--)J(T,Y,$);for(R=j;$=T.heap[1],T.heap[1]=T.heap[T.heap_len--],J(T,Y,1),K=T.heap[1],T.heap[--T.heap_max]=$,T.heap[--T.heap_max]=K,Y[2*R]=Y[2*$]+Y[2*K],T.depth[R]=(T.depth[$]>=T.depth[K]?T.depth[$]:T.depth[K])+1,Y[2*$+1]=Y[2*K+1]=R,T.heap[1]=R++,J(T,Y,1),2<=T.heap_len;);T.heap[--T.heap_max]=T.heap[1],function(ie,ge){var be,ve,le,H,fe,ae,ye=ge.dyn_tree,Ee=ge.max_code,Ie=ge.stat_desc.static_tree,Oe=ge.stat_desc.has_stree,je=ge.stat_desc.extra_bits,Ne=ge.stat_desc.extra_base,Qe=ge.stat_desc.max_length,$e=0;for(H=0;H<=h;H++)ie.bl_count[H]=0;for(ye[2*ie.heap[ie.heap_max]+1]=0,be=ie.heap_max+1;be<f;be++)Qe<(H=ye[2*ye[2*(ve=ie.heap[be])+1]+1]+1)&&(H=Qe,$e++),ye[2*ve+1]=H,Ee<ve||(ie.bl_count[H]++,fe=0,Ne<=ve&&(fe=je[ve-Ne]),ae=ye[2*ve],ie.opt_len+=ae*(H+fe),Oe&&(ie.static_len+=ae*(Ie[2*ve+1]+fe)));if($e!==0){do{for(H=Qe-1;ie.bl_count[H]===0;)H--;ie.bl_count[H]--,ie.bl_count[H+1]+=2,ie.bl_count[Qe]--,$e-=2}while(0<$e);for(H=Qe;H!==0;H--)for(ve=ie.bl_count[H];ve!==0;)Ee<(le=ie.heap[--be])||(ye[2*le+1]!==H&&(ie.opt_len+=(H-ye[2*le+1])*ye[2*le],ye[2*le+1]=H),ve--)}}(T,F),Q(Y,de,T.bl_count)}function b(T,F,$){var K,R,Y=-1,re=F[1],I=0,j=7,de=4;for(re===0&&(j=138,de=3),F[2*($+1)+1]=65535,K=0;K<=$;K++)R=re,re=F[2*(K+1)+1],++I<j&&R===re||(I<de?T.bl_tree[2*R]+=I:R!==0?(R!==Y&&T.bl_tree[2*R]++,T.bl_tree[2*v]++):I<=10?T.bl_tree[2*w]++:T.bl_tree[2*x]++,Y=R,de=(I=0)===re?(j=138,3):R===re?(j=6,3):(j=7,4))}function M(T,F,$){var K,R,Y=-1,re=F[1],I=0,j=7,de=4;for(re===0&&(j=138,de=3),K=0;K<=$;K++)if(R=re,re=F[2*(K+1)+1],!(++I<j&&R===re)){if(I<de)for(;Z(T,R,T.bl_tree),--I!=0;);else R!==0?(R!==Y&&(Z(T,R,T.bl_tree),I--),Z(T,v,T.bl_tree),ne(T,I-3,2)):I<=10?(Z(T,w,T.bl_tree),ne(T,I-3,3)):(Z(T,x,T.bl_tree),ne(T,I-11,7));Y=R,de=(I=0)===re?(j=138,3):R===re?(j=6,3):(j=7,4)}}i(N);var _=!1;function k(T,F,$,K){ne(T,(a<<1)+(K?1:0),3),function(R,Y,re,I){W(R),I&&(te(R,re),te(R,~re)),r.arraySet(R.pending_buf,R.window,Y,re,R.pending),R.pending+=re}(T,F,$,!0)}n._tr_init=function(T){_||(function(){var F,$,K,R,Y,re=new Array(h+1);for(R=K=0;R<l-1;R++)for(G[R]=K,F=0;F<1<<E[R];F++)S[K++]=R;for(S[K-1]=R,R=Y=0;R<16;R++)for(N[R]=Y,F=0;F<1<<L[R];F++)D[Y++]=R;for(Y>>=7;R<u;R++)for(N[R]=Y<<7,F=0;F<1<<L[R]-7;F++)D[256+Y++]=R;for($=0;$<=h;$++)re[$]=0;for(F=0;F<=143;)z[2*F+1]=8,F++,re[8]++;for(;F<=255;)z[2*F+1]=9,F++,re[9]++;for(;F<=279;)z[2*F+1]=7,F++,re[7]++;for(;F<=287;)z[2*F+1]=8,F++,re[8]++;for(Q(z,d+1,re),F=0;F<u;F++)C[2*F+1]=5,C[2*F]=me(F,5);se=new ee(z,E,c+1,d,h),X=new ee(C,L,0,u,h),ue=new ee(new Array(0),P,0,p,g)}(),_=!0),T.l_desc=new q(T.dyn_ltree,se),T.d_desc=new q(T.dyn_dtree,X),T.bl_desc=new q(T.bl_tree,ue),T.bi_buf=0,T.bi_valid=0,oe(T)},n._tr_stored_block=k,n._tr_flush_block=function(T,F,$,K){var R,Y,re=0;0<T.level?(T.strm.data_type===2&&(T.strm.data_type=function(I){var j,de=4093624447;for(j=0;j<=31;j++,de>>>=1)if(1&de&&I.dyn_ltree[2*j]!==0)return o;if(I.dyn_ltree[18]!==0||I.dyn_ltree[20]!==0||I.dyn_ltree[26]!==0)return s;for(j=32;j<c;j++)if(I.dyn_ltree[2*j]!==0)return s;return o}(T)),O(T,T.l_desc),O(T,T.d_desc),re=function(I){var j;for(b(I,I.dyn_ltree,I.l_desc.max_code),b(I,I.dyn_dtree,I.d_desc.max_code),O(I,I.bl_desc),j=p-1;3<=j&&I.bl_tree[2*V[j]+1]===0;j--);return I.opt_len+=3*(j+1)+5+5+4,j}(T),R=T.opt_len+3+7>>>3,(Y=T.static_len+3+7>>>3)<=R&&(R=Y)):R=Y=$+5,$+4<=R&&F!==-1?k(T,F,$,K):T.strategy===4||Y===R?(ne(T,2+(K?1:0),3),B(T,z,C)):(ne(T,4+(K?1:0),3),function(I,j,de,ie){var ge;for(ne(I,j-257,5),ne(I,de-1,5),ne(I,ie-4,4),ge=0;ge<ie;ge++)ne(I,I.bl_tree[2*V[ge]+1],3);M(I,I.dyn_ltree,j-1),M(I,I.dyn_dtree,de-1)}(T,T.l_desc.max_code+1,T.d_desc.max_code+1,re+1),B(T,T.dyn_ltree,T.dyn_dtree)),oe(T),K&&W(T)},n._tr_tally=function(T,F,$){return T.pending_buf[T.d_buf+2*T.last_lit]=F>>>8&255,T.pending_buf[T.d_buf+2*T.last_lit+1]=255&F,T.pending_buf[T.l_buf+T.last_lit]=255&$,T.last_lit++,F===0?T.dyn_ltree[2*$]++:(T.matches++,F--,T.dyn_ltree[2*(S[$]+c+1)]++,T.dyn_dtree[2*A(F)]++),T.last_lit===T.lit_bufsize-1},n._tr_align=function(T){ne(T,2,3),Z(T,y,z),function(F){F.bi_valid===16?(te(F,F.bi_buf),F.bi_buf=0,F.bi_valid=0):8<=F.bi_valid&&(F.pending_buf[F.pending++]=255&F.bi_buf,F.bi_buf>>=8,F.bi_valid-=8)}(T)}},{"../utils/common":41}],53:[function(t,e,n){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,e,n){(function(r){(function(o,s){"use strict";if(!o.setImmediate){var i,a,l,c,d=1,u={},p=!1,f=o.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(o);h=h&&h.setTimeout?h:o,i={}.toString.call(o.process)==="[object process]"?function(v){process.nextTick(function(){g(v)})}:function(){if(o.postMessage&&!o.importScripts){var v=!0,w=o.onmessage;return o.onmessage=function(){v=!1},o.postMessage("","*"),o.onmessage=w,v}}()?(c="setImmediate$"+Math.random()+"$",o.addEventListener?o.addEventListener("message",y,!1):o.attachEvent("onmessage",y),function(v){o.postMessage(c+v,"*")}):o.MessageChannel?((l=new MessageChannel).port1.onmessage=function(v){g(v.data)},function(v){l.port2.postMessage(v)}):f&&"onreadystatechange"in f.createElement("script")?(a=f.documentElement,function(v){var w=f.createElement("script");w.onreadystatechange=function(){g(v),w.onreadystatechange=null,a.removeChild(w),w=null},a.appendChild(w)}):function(v){setTimeout(g,0,v)},h.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var w=new Array(arguments.length-1),x=0;x<w.length;x++)w[x]=arguments[x+1];var E={callback:v,args:w};return u[d]=E,i(d),d++},h.clearImmediate=m}function m(v){delete u[v]}function g(v){if(p)setTimeout(g,0,v);else{var w=u[v];if(w){p=!0;try{(function(x){var E=x.callback,L=x.args;switch(L.length){case 0:E();break;case 1:E(L[0]);break;case 2:E(L[0],L[1]);break;case 3:E(L[0],L[1],L[2]);break;default:E.apply(s,L)}})(w)}finally{m(v),p=!1}}}}function y(v){v.source===o&&typeof v.data=="string"&&v.data.indexOf(c)===0&&g(+v.data.slice(c.length))}})(typeof self>"u"?r===void 0?this:r:self)}).call(this,typeof global<"u"?global:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})});var wr={};Ew(wr,{Headers:()=>Ep,Request:()=>JP,Response:()=>QP,default:()=>xp,fetch:()=>$P});var YP,wo,$P,xp,Ep,JP,QP,Kn=xw(()=>{"use strict";YP=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},wo=YP(),$P=wo.fetch,xp=wo.fetch.bind(wo),Ep=wo.Headers,JP=wo.Request,QP=wo.Response});var kp=Tn(Tp=>{"use strict";Object.defineProperty(Tp,"__esModule",{value:!0});var Cp=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Tp.default=Cp});var Ap=Tn(ai=>{"use strict";var tv=ai&&ai.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ai,"__esModule",{value:!0});var XP=tv((Kn(),Cw(wr))),eR=tv(kp()),Ip=class{constructor(e){var n,r;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(n=e.shouldThrowOnError)!==null&&n!==void 0?n:!1,this.signal=e.signal,this.isMaybeSingle=(r=e.isMaybeSingle)!==null&&r!==void 0?r:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=XP.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,n){return this.headers=new Headers(this.headers),this.headers.set(e,n),this}then(e,n){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{var i,a,l,c;let d=null,u=null,p=null,f=s.status,h=s.statusText;if(s.ok){if(this.method!=="HEAD"){let v=await s.text();v===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((i=this.headers.get("Accept"))===null||i===void 0)&&i.includes("application/vnd.pgrst.plan+text"))?u=v:u=JSON.parse(v))}let g=(a=this.headers.get("Prefer"))===null||a===void 0?void 0:a.match(/count=(exact|planned|estimated)/),y=(l=s.headers.get("content-range"))===null||l===void 0?void 0:l.split("/");g&&y&&y.length>1&&(p=parseInt(y[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(d={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,p=null,f=406,h="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let g=await s.text();try{d=JSON.parse(g),Array.isArray(d)&&s.status===404&&(u=[],d=null,f=200,h="OK")}catch{s.status===404&&g===""?(f=204,h="No Content"):d={message:g}}if(d&&this.isMaybeSingle&&(!((c=d?.details)===null||c===void 0)&&c.includes("0 rows"))&&(d=null,f=200,h="OK"),d&&this.shouldThrowOnError)throw new eR.default(d)}return{error:d,data:u,count:p,status:f,statusText:h}});return this.shouldThrowOnError||(o=o.catch(s=>{var i,a,l;return{error:{message:`${(i=s?.name)!==null&&i!==void 0?i:"FetchError"}: ${s?.message}`,details:`${(a=s?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=s?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(e,n)}returns(){return this}overrideTypes(){return this}};ai.default=Ip});var Pp=Tn(li=>{"use strict";var tR=li&&li.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(li,"__esModule",{value:!0});var nR=tR(Ap()),Mp=class extends nR.default{select(e){let n=!1,r=(e??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",r),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:n=!0,nullsFirst:r,foreignTable:o,referencedTable:s=o}={}){let i=s?`${s}.order`:"order",a=this.url.searchParams.get(i);return this.url.searchParams.set(i,`${a?`${a},`:""}${e}.${n?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:n,referencedTable:r=n}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${e}`),this}range(e,n,{foreignTable:r,referencedTable:o=r}={}){let s=typeof o>"u"?"offset":`${o}.offset`,i=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(s,`${e}`),this.url.searchParams.set(i,`${n-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:n=!1,settings:r=!1,buffers:o=!1,wal:s=!1,format:i="text"}={}){var a;let l=[e?"analyze":null,n?"verbose":null,r?"settings":null,o?"buffers":null,s?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.get("Accept"))!==null&&a!==void 0?a:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${i}; for="${c}"; options=${l};`),i==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};li.default=Mp});var Ql=Tn(ci=>{"use strict";var rR=ci&&ci.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ci,"__esModule",{value:!0});var oR=rR(Pp()),Rp=class extends oR.default{eq(e,n){return this.url.searchParams.append(e,`eq.${n}`),this}neq(e,n){return this.url.searchParams.append(e,`neq.${n}`),this}gt(e,n){return this.url.searchParams.append(e,`gt.${n}`),this}gte(e,n){return this.url.searchParams.append(e,`gte.${n}`),this}lt(e,n){return this.url.searchParams.append(e,`lt.${n}`),this}lte(e,n){return this.url.searchParams.append(e,`lte.${n}`),this}like(e,n){return this.url.searchParams.append(e,`like.${n}`),this}likeAllOf(e,n){return this.url.searchParams.append(e,`like(all).{${n.join(",")}}`),this}likeAnyOf(e,n){return this.url.searchParams.append(e,`like(any).{${n.join(",")}}`),this}ilike(e,n){return this.url.searchParams.append(e,`ilike.${n}`),this}ilikeAllOf(e,n){return this.url.searchParams.append(e,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(e,n){return this.url.searchParams.append(e,`ilike(any).{${n.join(",")}}`),this}is(e,n){return this.url.searchParams.append(e,`is.${n}`),this}in(e,n){let r=Array.from(new Set(n)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(e,`in.(${r})`),this}contains(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cs.{${n.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(n)}`),this}containedBy(e,n){return typeof n=="string"?this.url.searchParams.append(e,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(e,`cd.{${n.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(n)}`),this}rangeGt(e,n){return this.url.searchParams.append(e,`sr.${n}`),this}rangeGte(e,n){return this.url.searchParams.append(e,`nxl.${n}`),this}rangeLt(e,n){return this.url.searchParams.append(e,`sl.${n}`),this}rangeLte(e,n){return this.url.searchParams.append(e,`nxr.${n}`),this}rangeAdjacent(e,n){return this.url.searchParams.append(e,`adj.${n}`),this}overlaps(e,n){return typeof n=="string"?this.url.searchParams.append(e,`ov.${n}`):this.url.searchParams.append(e,`ov.{${n.join(",")}}`),this}textSearch(e,n,{config:r,type:o}={}){let s="";o==="plain"?s="pl":o==="phrase"?s="ph":o==="websearch"&&(s="w");let i=r===void 0?"":`(${r})`;return this.url.searchParams.append(e,`${s}fts${i}.${n}`),this}match(e){return Object.entries(e).forEach(([n,r])=>{this.url.searchParams.append(n,`eq.${r}`)}),this}not(e,n,r){return this.url.searchParams.append(e,`not.${n}.${r}`),this}or(e,{foreignTable:n,referencedTable:r=n}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${e})`),this}filter(e,n,r){return this.url.searchParams.append(e,`${n}.${r}`),this}};ci.default=Rp});var Lp=Tn(ui=>{"use strict";var sR=ui&&ui.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ui,"__esModule",{value:!0});var di=sR(Ql()),_p=class{constructor(e,{headers:n={},schema:r,fetch:o}){this.url=e,this.headers=new Headers(n),this.schema=r,this.fetch=o}select(e,{head:n=!1,count:r}={}){let o=n?"HEAD":"GET",s=!1,i=(e??"*").split("").map(a=>/\s/.test(a)&&!s?"":(a==='"'&&(s=!s),a)).join("");return this.url.searchParams.set("select",i),r&&this.headers.append("Prefer",`count=${r}`),new di.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:n,defaultToNull:r=!0}={}){var o;let s="POST";if(n&&this.headers.append("Prefer",`count=${n}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let i=e.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(i.length>0){let a=[...new Set(i)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new di.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}upsert(e,{onConflict:n,ignoreDuplicates:r=!1,count:o,defaultToNull:s=!0}={}){var i;let a="POST";if(this.headers.append("Prefer",`resolution=${r?"ignore":"merge"}-duplicates`),n!==void 0&&this.url.searchParams.set("on_conflict",n),o&&this.headers.append("Prefer",`count=${o}`),s||this.headers.append("Prefer","missing=default"),Array.isArray(e)){let l=e.reduce((c,d)=>c.concat(Object.keys(d)),[]);if(l.length>0){let c=[...new Set(l)].map(d=>`"${d}"`);this.url.searchParams.set("columns",c.join(","))}}return new di.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}update(e,{count:n}={}){var r;let o="PATCH";return n&&this.headers.append("Prefer",`count=${n}`),new di.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}delete({count:e}={}){var n;let r="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new di.default({method:r,url:this.url,headers:this.headers,schema:this.schema,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}};ui.default=_p});var rv=Tn(pi=>{"use strict";var nv=pi&&pi.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(pi,"__esModule",{value:!0});var iR=nv(Lp()),aR=nv(Ql()),Np=class t{constructor(e,{headers:n={},schema:r,fetch:o}={}){this.url=e,this.headers=new Headers(n),this.schemaName=r,this.fetch=o}from(e){let n=new URL(`${this.url}/${e}`);return new iR.default(n,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new t(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,n={},{head:r=!1,get:o=!1,count:s}={}){var i;let a,l=new URL(`${this.url}/rpc/${e}`),c;r||o?(a=r?"HEAD":"GET",Object.entries(n).filter(([u,p])=>p!==void 0).map(([u,p])=>[u,Array.isArray(p)?`{${p.join(",")}}`:`${p}`]).forEach(([u,p])=>{l.searchParams.append(u,p)})):(a="POST",c=n);let d=new Headers(this.headers);return s&&d.set("Prefer",`count=${s}`),new aR.default({method:a,url:l,headers:d,schema:this.schemaName,body:c,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}};pi.default=Np});var dv=Tn(mt=>{"use strict";var So=mt&&mt.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(mt,"__esModule",{value:!0});mt.PostgrestError=mt.PostgrestBuilder=mt.PostgrestTransformBuilder=mt.PostgrestFilterBuilder=mt.PostgrestQueryBuilder=mt.PostgrestClient=void 0;var ov=So(rv());mt.PostgrestClient=ov.default;var sv=So(Lp());mt.PostgrestQueryBuilder=sv.default;var iv=So(Ql());mt.PostgrestFilterBuilder=iv.default;var av=So(Pp());mt.PostgrestTransformBuilder=av.default;var lv=So(Ap());mt.PostgrestBuilder=lv.default;var cv=So(kp());mt.PostgrestError=cv.default;mt.default={PostgrestClient:ov.default,PostgrestQueryBuilder:sv.default,PostgrestFilterBuilder:iv.default,PostgrestTransformBuilder:av.default,PostgrestBuilder:lv.default,PostgrestError:cv.default}});var Ri=window,_i=typeof unsafeWindow<"u"&&unsafeWindow?unsafeWindow:Ri,Re=_i,ef=_i!==Ri;function Mt(t,e){try{_i[t]=e}catch{}if(ef)try{Ri[t]=e}catch{}}function Bo(t){if(ef){let e=Ri[t];if(e!==void 0)return e}return _i[t]}var ht=Re.WebSocket,u_=Re.Worker,pt=[],yn=null;function Qn(t,e){if(!yn){yn=t,Mt("quinoaWS",t);try{console.log("[QuinoaWS] selected ->",e)}catch{}}}var Li=!1;var Ni=typeof Set<"u"?new Set:{_a:[],add(t){this._a.push(t)},delete(t){let e=this._a.indexOf(t);e>=0&&this._a.splice(e,1)},forEach(t){for(let e=0;e<this._a.length;e++)t(this._a[e])}};function Oi(t){return["CONNECTING","OPEN","CLOSING","CLOSED"][t??-1]||"none"}async function tf(t){try{if(typeof t=="string")return JSON.parse(t);if(t instanceof Blob)return JSON.parse(await t.text());if(t instanceof ArrayBuffer)return JSON.parse(new TextDecoder().decode(t))}catch{}return null}var Tt=null,vc=!1,nf=null,qi=null,rf=()=>Re.jotaiAtomCache?.cache;function Tw(){let t=Re.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;for(let[e]of t.renderers){let n=t.getFiberRoots?.(e);if(n)for(let r of n){let o=new Set,s=[r.current];for(;s.length;){let i=s.pop();if(!i||o.has(i))continue;o.add(i);let a=i?.pendingProps?.value;if(a&&typeof a.get=="function"&&typeof a.set=="function"&&typeof a.sub=="function")return qi="fiber",a;i.child&&s.push(i.child),i.sibling&&s.push(i.sibling),i.alternate&&s.push(i.alternate)}}}return null}async function kw(t=5e3){let e=rf();if(!e)throw console.warn("[jotai-bridge] jotaiAtomCache.cache introuvable"),new Error("jotaiAtomCache.cache introuvable");let n=null,r=null,o=[],s=()=>{for(let l of o)try{l.__origWrite&&(l.write=l.__origWrite,delete l.__origWrite)}catch{}};for(let l of e.values()){if(!l||typeof l.write!="function"||l.__origWrite)continue;let c=l.write;l.__origWrite=c,l.write=function(d,u,...p){return r||(n=d,r=u,s()),c.call(this,d,u,...p)},o.push(l)}let i=l=>new Promise(c=>setTimeout(c,l)),a=Date.now();try{Re.dispatchEvent?.(new Re.Event("visibilitychange"))}catch{}for(;!r&&Date.now()-a<t;)await i(50);return r?(qi="write",{get:l=>n(l),set:(l,c)=>r(l,c),sub:(l,c)=>{let d;try{d=n(l)}catch{}let u=setInterval(()=>{let p;try{p=n(l)}catch{return}if(p!==d){d=p;try{c()}catch{}}},100);return()=>clearInterval(u)}}):(s(),qi="polyfill",console.warn("[jotai-bridge] write-once: timeout \u2192 polyfill"),{get:()=>{throw new Error("Store non captur\xE9: get indisponible")},set:()=>{throw new Error("Store non captur\xE9: set indisponible")},sub:()=>()=>{},__polyfill:!0})}async function St(){if(Tt&&!Tt.__polyfill)return Tt;if(vc){let t=Date.now(),e=5500;for(;!Tt&&Date.now()-t<e;)await new Promise(n=>setTimeout(n,25));if(Tt&&!Tt.__polyfill)return Tt}vc=!0;try{let t=Tw();return t?(Tt=t,Tt):(Tt=await kw(),Tt)}catch(t){throw nf=t,t}finally{vc=!1}}function Fo(){return!!Tt&&!Tt.__polyfill}function of(){return{via:qi,polyfill:!!Tt?.__polyfill,error:nf}}async function Ht(t){return(await St()).get(t)}async function Zn(t,e){await(await St()).set(t,e)}async function Xn(t,e){return(await St()).sub(t,e)}function Br(t){let e=rf();if(!e)return[];let n=[];for(let r of e.values()){let o=r?.debugLabel||r?.label||"";t.test(String(o))&&n.push(r)}return n}function kt(t){let e=n=>n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return Br(new RegExp("^"+e(t)+"$"))[0]||null}async function Di(){try{await St()}catch{}}async function sf(t,e){await Di();let n=kt(t);if(!n)return e;try{return await Ht(n)}catch{return e}}async function af(t,e){await Di();let n=kt(t);return n?await Xn(n,async()=>{try{e(await Ht(n))}catch{}}):()=>{}}async function Iw(t,e){let n=await sf(t);return n!==void 0&&e(n),af(t,e)}async function Aw(t,e){await Di();let n=kt(t);n&&await Zn(n,e)}var rn={ensure:Di,select:sf,subscribe:af,subscribeImmediate:Iw,set:Aw};function wc(t){return t?Array.isArray(t)?t.slice():t.split(".").map(e=>e.match(/^\d+$/)?Number(e):e):[]}function Fr(t,e){let n=wc(e),r=t;for(let o of n){if(r==null)return;r=r[o]}return r}function Mw(t,e,n){let r=wc(e);if(!r.length)return n;let o=Array.isArray(t)?t.slice():{...t??{}},s=o;for(let i=0;i<r.length-1;i++){let a=r[i],l=s[a],c=typeof l=="object"&&l!==null?Array.isArray(l)?l.slice():{...l}:{};s[a]=c,s=c}return s[r[r.length-1]]=n,o}var Pw={shallow(t,e){if(Object.is(t,e))return!0;if(!t||!e||typeof t!="object"||typeof e!="object")return!1;let n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(let o of n)if(!Object.is(t[o],e[o]))return!1;return!0},idSet(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;let n=new Set(t);for(let r of e)if(!n.has(r))return!1;return!0}};function gt(t,e={}){let{path:n,write:r="replace"}=e;async function o(){let d=await rn.select(t);return n?Fr(d,n):d}async function s(d){if(typeof r=="function"){let f=await rn.select(t),h=r(d,f);return rn.set(t,h)}let u=await rn.select(t),p=n?Mw(u,n,d):d;return r==="merge-shallow"&&!n&&u&&typeof u=="object"&&typeof d=="object"?rn.set(t,{...u,...d}):rn.set(t,p)}async function i(d){let u=await o(),p=d(u);return await s(p),p}async function a(d,u=Object.is){let p;return rn.subscribe(t,f=>{let h=n?Fr(f,n):f;if(typeof p>"u"||!u(p,h)){let m=p;p=h,d(h,m)}})}async function l(d,u=Object.is){let p;return rn.subscribeImmediate(t,f=>{let h=n?Fr(f,n):f;if(typeof p>"u"||!u(p,h)){let m=p;p=h,d(h,m)}})}function c(d){return Rw(t,n,d)}return{label:t+(n?":"+wc(n).join("."):""),get:o,set:s,update:i,onChange:a,onChangeNow:l,asSignature:c}}function lf(t,e){let n={};for(let r of e){let o=Fr(t,r.includes(".")?r:[r]);n[r]=o}try{return JSON.stringify(n)}catch{return String(n)}}function Rw(t,e,n){let r=n.mode??"auto";function o(c){let d=c,u=e?Fr(d,e):d,p=new Map;if(u==null)return{sig:p,keys:[]};if((r==="array"||r==="auto"&&Array.isArray(u))&&Array.isArray(u))for(let f=0;f<u.length;f++){let h=u[f],m=n.key?n.key(h,f,c):f,g=n.sig?n.sig(h,f,c):n.fields?lf(h,n.fields):(()=>{try{return JSON.stringify(h)}catch{return String(h)}})();p.set(m,g)}else for(let[f,h]of Object.entries(u)){let m=n.key?n.key(h,f,c):f,g=n.sig?n.sig(h,f,c):n.fields?lf(h,n.fields):(()=>{try{return JSON.stringify(h)}catch{return String(h)}})();p.set(m,g)}return{sig:p,keys:Array.from(p.keys())}}function s(c,d){if(c===d)return!0;if(!c||!d||c.size!==d.size)return!1;for(let[u,p]of c)if(d.get(u)!==p)return!1;return!0}async function i(c){let d=null;return rn.subscribeImmediate(t,u=>{let p=e?Fr(u,e):u,{sig:f}=o(p);if(!s(d,f)){let h=new Set([...d?Array.from(d.keys()):[],...Array.from(f.keys())]),m=[];for(let g of h)(d?.get(g)??"__NONE__")!==(f.get(g)??"__NONE__")&&m.push(g);d=f,c({value:p,changedKeys:m})}})}async function a(c,d){let u="__INIT__";return i(({value:p,changedKeys:f})=>{f.includes(c)&&d({value:p})})}async function l(c,d){let u=new Set(c);return i(({value:p,changedKeys:f})=>{let h=f.filter(m=>u.has(m));h.length&&d({value:p,changedKeys:h})})}return{sub:i,subKey:a,subKeys:l}}var cf=Pw;function He(t){return gt(t)}var _w=He("positionAtom"),Lw=He("stateAtom"),Nw=He("mapAtom"),Ow=He("playerAtom"),qw=He("actionAtom"),Dw=He("myDataAtom"),Sc=He("myInventoryAtom"),Bw=He("myCropInventoryAtom"),xc=He("mySeedInventoryAtom"),Ec=He("myToolInventoryAtom"),Cc=He("myEggInventoryAtom"),Tc=He("myDecorInventoryAtom"),er=He("myPetInfosAtom"),Fw=He("myPetSlotInfosAtom"),Hw=He("totalPetSellPriceAtom"),Ww=He("expandedPetSlotIdAtom"),jw=He("myCropItemsToSellAtom"),zw=He("shopsAtom"),Uw=He("myShopPurchasesAtom"),Bi=He("numPlayersAtom"),Gw=He("totalCropSellPriceAtom"),Kw=He("myValidatedSelectedItemIndexAtom"),Vw=He("setSelectedIndexToEndAtom"),Yw=He("mySelectedItemNameAtom"),$w=He("myPossiblyNoLongerValidSelectedItemIndexAtom"),In=He("myCurrentGardenObjectAtom"),An=He("myCurrentSortedGrowSlotIndicesAtom"),kn=He("myCurrentGrowSlotIndexAtom"),Jw=He("myOwnCurrentGardenObjectAtom"),Qw=He("isCurrentGrowSlotMatureAtom"),Zw=He("myOwnCurrentDirtTileIndexAtom"),Xw=He("weatherAtom"),eS=He("activeModalAtom"),tS=He("avatarTriggerAnimationAtom"),Fi=gt("myDataAtom",{path:"garden"}),df=gt("myDataAtom",{path:"garden.tileObjects"}),Hr=gt("myInventoryAtom",{path:"favoritedItemIds"}),nS=gt("playerAtom",{path:"id"}),rS=gt("myOwnCurrentGardenObjectAtom",{path:"objectType"}),x_=gt("stateAtom",{path:"child"}),E_=gt("stateAtom",{path:"child.data"}),C_=gt("stateAtom",{path:"child.data.shops"}),T_=gt("stateAtom",{path:"child.data.userSlots"}),k_=gt("stateAtom",{path:"data.players"}),oS=gt("shopsAtom",{path:"seed"}),sS=gt("shopsAtom",{path:"tool"}),iS=gt("shopsAtom",{path:"egg"}),aS=gt("shopsAtom",{path:"decor"});function lS(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}var I_=df.asSignature({mode:"record",key:(t,e)=>Number(e),sig:t=>lS(t)});function cS(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",i=Number.isFinite(e.xp)?Math.round(e.xp):0,a=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,l=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,c=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,d=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${o}|xp:${i}|hg:${a}|sc:${l}|m:${n}|a:${r}|pos:${c},${d}`}function uf(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",i=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0;return`${s}|${o}|sc:${i}|m:${n}|a:${r}`}var A_=er.asSignature({mode:"array",key:t=>String(t?.slot?.id??""),sig:t=>cS(t)}),M_=er.asSignature({mode:"array",key:t=>String(t?.slot?.id??""),sig:t=>uf(t)}),P_=Hr.asSignature({mode:"array",key:t=>String(t),sig:()=>"1"});var pe={ui:{activeModal:eS},server:{numPlayers:Bi},player:{position:_w,avatarTriggerAnimationAtom:tS,player:Ow,action:qw,playerId:nS},garden:{myOwnCurrentGardenObject:Jw,isCurrentGrowSlotMature:Qw,myOwnCurrentGardenObjectType:rS,myOwnCurrentDirtTileIndex:Zw,myCurrentGrowSlotIndex:kn},root:{state:Lw,map:Nw},data:{myData:Dw,garden:Fi,gardenTileObjects:df,myCurrentGardenObject:In,myCurrentSortedGrowSlotIndices:An,myCurrentGrowSlotIndex:kn,weather:Xw},inventory:{myInventory:Sc,myCropInventory:Bw,mySeedInventory:xc,myToolInventory:Ec,myEggInventory:Cc,myDecorInventory:Tc,favoriteIds:Hr,mySelectedItemName:Yw,myPossiblyNoLongerValidSelectedItemIndex:$w,myValidatedSelectedItemIndex:Kw,setSelectedIndexToEnd:Vw,myCropItemsToSell:jw},pets:{myPetInfos:er,myPetSlotInfos:Fw,totalPetSellPrice:Hw,expandedPetSlotId:Ww},shop:{shops:zw,myShopPurchases:Uw,totalCropSellPrice:Gw,seedShop:oS,toolShop:sS,eggShop:iS,decorShop:aS}};function Ho(t){return Hr.onChange(e=>t(Array.isArray(e)?e:[]),cf.idSet)}async function pf(t){return t(Array.isArray(await Hr.get())?await Hr.get():[]),Ho(t)}function dS(t,e){let n=s=>{let i=new Map,a=Array.isArray(s)?s:[];for(let l of a){let c=String(l?.slot?.id??"");c&&i.set(c,uf(l))}return i},r=n(t),o=n(e);if(r.size!==o.size)return!1;for(let[s,i]of r)if(o.get(s)!==i)return!1;return!0}async function ff(t){return t(await er.get()),er.onChange(t,dS)}async function Wo(){let t=await Hr.get();return new Set(Array.isArray(t)?t:[])}var uS=t=>String(t).endsWith("1"),mf=t=>String(t).endsWith("2"),pS=t=>{let e=parseInt(String(t).slice(-1),10);return Number.isInteger(e)&&e%2===0},he={Common:"Common",Uncommon:"Uncommon",Rare:"Rare",Legendary:"Legendary",Mythic:"Mythical",Divine:"Divine",Celestial:"Celestial"},Ue={Single:"Single",Multiple:"Multiple"},hf={Dirt1:6,Dirt2:7,Dirt3:8,Sky0:24,Sky1:25,Sky2:26,Sky3:27,Bush1:28,Sky4:35,Sky5:36,Sky6:37,Bush2:38,Sky7:45,Sky8:46,Sky9:47,BushHomer:48},Pe={DirtPatch:1,SproutFlower:2,SproutVegetable:3,SproutFruit:4,SproutVine:5,StemFlower:6,Trellis:7,Daffodil:11,Tulip:12,Sunflower:13,Lily:14,Starweaver:15,AloePlant:17,Aloe:18,Blueberry:21,Banana:22,Strawberry:23,Mango:24,Grape:25,Watermelon:26,Lemon:27,Apple:28,Pear:29,Pineapple:30,Pepper:31,Tomato:32,BabyCarrot:33,Carrot:34,Pumpkin:35,Corn:36,Peach:37,BroadBean:38,PalmTreeTop:39,BushyTree:40,Coconut:41,MushroomPlant:42,PassionFruit:43,DragonFruit:44,Lychee:45,Mushroom:46,BurrosTail:47,Cacao:48,Echeveria:49,Delphinium:50,DawnCelestialCrop:51,MoonCelestialCrop:52,Squash:60},at={Bamboo:1,PalmTree:2,DawnCelestialPlatform:3,DawnCelestialPlant:4,DawnCelestialPlantActive:5,DawnCelestialPlatformTopmostLayer:6,Cactus:7,Tree:8,MoonCelestialPlatform:9,MoonCelestialPlant:10,MoonCelestialPlantActive:11,StarweaverPlatform:13,StarweaverPlant:14},Ge={Daffodil:1,Tulip:2,Sunflower:3,Starweaver:6,DawnCelestial:7,MoonCelestial:8,Blueberry:11,Banana:12,Strawberry:13,Mango:14,Grape:15,Watermelon:16,Lemon:17,Apple:18,Pear:19,Lily:20,Pepper:21,Tomato:22,Carrot:23,Pumpkin:25,Corn:26,Peach:27,BroadBean:28,Delphinium:30,Coconut:31,Mushroom:32,PassionFruit:33,DragonFruit:34,Lychee:35,BurrosTail:37,Cacao:38,Aloe:39,Echeveria:40,Bamboo:41,Cactus:42,Squash:50},Wr={Coin:1,Shovel:2,Seeds:3,PlanterPot:5,InventoryBag:6,RainbowPotion:9,GoldPotion:10,WateringCan:14,Fertilizer:15,WetPotion:16,ChilledPotion:17,FrozenPotion:18,DawnlitPotion:19,AmberlitPotion:20,ArrowKeys:41,Touchpad:42},Hi={Rain:10,Frost:20,Sunny:30,AmberMoon:40,Dawn:50,MoonCelestialActivationTile:91,DawnCelestialActivationTile:92},nt={Bee:1,Chicken:2,Bunny:3,Turtle:4,Capybara:5,Cow:6,Pig:7,Butterfly:8,Snail:9,Worm:10,CommonEgg:11,UncommonEgg:12,RareEgg:13,LegendaryEgg:14,MythicalEgg:15,DivineEgg:16,CelestialEgg:17,Squirrel:18,Goat:19,Dragonfly:20,Peacock:30},Kt={Wet:1,Chilled:2,Frozen:3,Puddle:5,Dawnlit:11,Ambershine:12,Dawncharged:13,Ambercharged:14},jo={Wet:"Wet",Chilled:"Chilled",Frozen:"Frozen",Puddle:"Puddle",Dawnlit:"Dawnlit",Ambershine:"Amberlit",Dawncharged:"Dawnbound",Ambercharged:"Amberbound"},xe={WoodPedestal:4,StonePedestal:6,MarblePedestal:8,SmallRock:11,WoodBench:13,WoodBenchBackwards:14,StoneBench:15,StoneBucketPedestal:16,MarbleBench:17,MarbleBenchBackwards:18,MediumRock:21,WoodLampPost:23,WoodBenchSideways:24,StoneLampPost:25,StoneBenchSideways:26,StoneColumn:26,MarbleLampPost:27,MarbleBenchSideways:28,HayBale:29,LargeRock:31,WoodArch:33,WoodBucketPedestal:34,WoodBridge:34,StoneArch:35,StoneBridge:36,MarbleArch:37,MarbleBridge:38,HayBaleSideways:39,MiniFairyForge:40,WoodArchSide:43,WoodBridgeSideways:44,StoneArchSideways:45,StoneBridgeSideways:46,MarbleArchSideways:47,MarbleBridgeSideways:48,StrawScarecrow:49,MiniFairyCottage:50,WoodOwl:53,Birdhouse:54,StoneGnome:55,StoneBirdBath:56,MarbleBlobling:57,MarbleBucketPedestal:58,Cauldron:59,MiniFairyKeep:60,WoodStool:63,StoneGardenBox:66,MarbleColumn:68,SmallGravestone:69,SmallGravestoneSideways:70,WoodenWindmill:73,WoodGardenBox:74,MarbleGardenBox:78,MediumGravestone:79,MediumGravestoneSideways:80,LargeGravestone:89,LargeGravestoneSideways:90},Be={Carrot:{seed:{tileRef:Ge.Carrot,name:"Carrot Seed",coinPrice:10,creditPrice:7,rarity:he.Common},plant:{tileRef:Pe.BabyCarrot,name:"Carrot Plant",harvestType:Ue.Single,baseTileScale:.7},crop:{tileRef:Pe.Carrot,name:"Carrot",baseSellPrice:20,baseWeight:.1,baseTileScale:.6,maxScale:3}},Strawberry:{seed:{tileRef:Ge.Strawberry,name:"Strawberry Seed",coinPrice:50,creditPrice:21,rarity:he.Common},plant:{tileRef:Pe.SproutFruit,name:"Strawberry Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.2,y:-.1,rotation:0},{x:.175,y:-.2,rotation:0},{x:-.18,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:.01,rotation:0}],secondsToMature:70,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Strawberry,name:"Strawberry",baseSellPrice:14,baseWeight:.05,baseTileScale:.25,maxScale:2}},Aloe:{seed:{tileRef:Ge.Aloe,name:"Aloe Seed",coinPrice:135,creditPrice:18,rarity:he.Common},plant:{tileRef:Pe.AloePlant,name:"Aloe Plant",harvestType:Ue.Single,baseTileScale:.9},crop:{tileRef:Pe.Aloe,name:"Aloe",baseSellPrice:310,baseWeight:1.5,baseTileScale:.7,maxScale:2.5}},Delphinium:{seed:{tileRef:Ge.Delphinium,name:"Delphinium Seed",coinPrice:300,creditPrice:12,rarity:he.Uncommon},plant:{tileRef:Pe.Delphinium,name:"Delphinium Plant",harvestType:Ue.Single,baseTileScale:.8,tileTransformOrigin:"bottom",nudgeY:-.43,nudgeYMultiplier:.05},crop:{tileRef:Pe.Delphinium,name:"Delphinium",baseSellPrice:530,baseWeight:.02,baseTileScale:.8,maxScale:3}},Blueberry:{seed:{tileRef:Ge.Blueberry,name:"Blueberry Seed",coinPrice:400,creditPrice:49,rarity:he.Uncommon},plant:{tileRef:Pe.SproutFruit,name:"Blueberry Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.2,y:-.1,rotation:0},{x:.175,y:-.2,rotation:0},{x:-.18,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:.01,rotation:0}],secondsToMature:105,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Blueberry,name:"Blueberry",baseSellPrice:23,baseWeight:.01,baseTileScale:.25,maxScale:2}},Apple:{seed:{tileRef:Ge.Apple,name:"Apple Seed",coinPrice:500,creditPrice:67,rarity:he.Uncommon,unavailableSurfaces:["discord"]},plant:{tileRef:at.Tree,name:"Apple Tree",harvestType:Ue.Multiple,slotOffsets:[{x:-.35,y:-2.4,rotation:0},{x:-.5,y:-2,rotation:0},{x:.1,y:-2.2,rotation:0},{x:-.2,y:-1.65,rotation:0},{x:.55,y:-1.9,rotation:0},{x:.3,y:-1.7,rotation:0},{x:.4,y:.1,rotation:0}],secondsToMature:360*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.25},crop:{tileRef:Pe.Apple,name:"Apple",baseSellPrice:73,baseWeight:.18,baseTileScale:.5,maxScale:2}},OrangeTulip:{seed:{tileRef:Ge.Tulip,name:"Tulip Seed",coinPrice:600,creditPrice:14,rarity:he.Uncommon},plant:{tileRef:Pe.Tulip,name:"Tulip Plant",harvestType:Ue.Single,baseTileScale:.5},crop:{tileRef:Pe.Tulip,name:"Tulip",baseSellPrice:767,baseWeight:.01,baseTileScale:.5,maxScale:3}},Tomato:{seed:{tileRef:Ge.Tomato,name:"Tomato Seed",coinPrice:800,creditPrice:79,rarity:he.Uncommon},plant:{tileRef:Pe.SproutVine,name:"Tomato Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.3,y:-.3,rotation:0},{x:.3,y:.3,rotation:0}],secondsToMature:1100,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Pe.Tomato,name:"Tomato",baseSellPrice:27,baseWeight:.3,baseTileScale:.33,maxScale:2}},Daffodil:{seed:{tileRef:Ge.Daffodil,name:"Daffodil Seed",coinPrice:1e3,creditPrice:19,rarity:he.Rare},plant:{tileRef:Pe.Daffodil,name:"Daffodil Plant",harvestType:Ue.Single,baseTileScale:.5},crop:{tileRef:Pe.Daffodil,name:"Daffodil",baseSellPrice:1090,baseWeight:.01,baseTileScale:.5,maxScale:3}},Corn:{seed:{tileRef:Ge.Corn,name:"Corn Kernel",coinPrice:1300,creditPrice:135,rarity:he.Rare},plant:{tileRef:Pe.SproutVegetable,name:"Corn Plant",harvestType:Ue.Multiple,slotOffsets:[{x:0,y:-.1,rotation:0}],secondsToMature:130,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Pe.Corn,name:"Corn",baseSellPrice:36,baseWeight:1.2,baseTileScale:.7,maxScale:2}},Watermelon:{seed:{tileRef:Ge.Watermelon,name:"Watermelon Seed",coinPrice:2500,creditPrice:195,rarity:he.Rare},plant:{tileRef:Pe.Watermelon,name:"Watermelon Plant",harvestType:Ue.Single,baseTileScale:.8},crop:{tileRef:Pe.Watermelon,name:"Watermelon",baseSellPrice:2708,baseWeight:4.5,baseTileScale:.8,maxScale:3}},Pumpkin:{seed:{tileRef:Ge.Pumpkin,name:"Pumpkin Seed",coinPrice:3e3,creditPrice:210,rarity:he.Rare},plant:{tileRef:Pe.Pumpkin,name:"Pumpkin Plant",harvestType:Ue.Single,baseTileScale:.8},crop:{tileRef:Pe.Pumpkin,name:"Pumpkin",baseSellPrice:3700,baseWeight:6,baseTileScale:.8,maxScale:3}},Echeveria:{seed:{tileRef:Ge.Echeveria,name:"Echeveria Cutting",coinPrice:4200,creditPrice:113,rarity:he.Legendary},plant:{tileRef:Pe.Echeveria,name:"Echeveria Plant",harvestType:Ue.Single,baseTileScale:.8},crop:{tileRef:Pe.Echeveria,name:"Echeveria",baseSellPrice:4600,baseWeight:.8,baseTileScale:.8,maxScale:2.75}},Coconut:{seed:{tileRef:Ge.Coconut,name:"Coconut Seed",coinPrice:6e3,creditPrice:235,rarity:he.Legendary},plant:{tileRef:at.PalmTree,name:"Coconut Tree",harvestType:Ue.Multiple,slotOffsets:[{x:-.2,y:-2.6,rotation:0},{x:-.3,y:-2.4,rotation:0},{x:.2,y:-2.5,rotation:0},{x:-.25,y:-2.1,rotation:0},{x:0,y:-2.3,rotation:0},{x:.3,y:-2.2,rotation:0},{x:.05,y:-2,rotation:0}],secondsToMature:720*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.35},crop:{tileRef:Pe.Coconut,name:"Coconut",baseSellPrice:302,baseWeight:5,baseTileScale:.25,maxScale:3}},Banana:{seed:{tileRef:Ge.Banana,name:"Banana Seed",coinPrice:7500,creditPrice:199,rarity:he.Legendary,getCanSpawnInGuild:t=>pS(t)},plant:{tileRef:at.PalmTree,name:"Banana Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.3,y:-1.7,rotation:10},{x:-.2,y:-1.7,rotation:-10},{x:-.1,y:-1.7,rotation:-30},{x:0,y:-1.7,rotation:-50},{x:.1,y:-1.7,rotation:-70}],secondsToMature:14400,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.4},crop:{tileRef:Pe.Banana,name:"Banana",baseSellPrice:1750,baseWeight:.12,baseTileScale:.5,maxScale:1.7}},Lily:{seed:{tileRef:Ge.Lily,name:"Lily Seed",coinPrice:2e4,creditPrice:34,rarity:he.Legendary},plant:{tileRef:Pe.Lily,name:"Lily Plant",harvestType:Ue.Single,baseTileScale:.75,nudgeY:-.1},crop:{tileRef:Pe.Lily,name:"Lily",baseSellPrice:20123,baseWeight:.02,baseTileScale:.5,maxScale:2.75}},Squash:{seed:{tileRef:Ge.Squash,name:"Squash Seed",coinPrice:55e3,creditPrice:199,rarity:he.Legendary},plant:{tileRef:Pe.SproutFlower,name:"Squash Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.08,y:.2,rotation:35},{x:.2,y:0,rotation:35},{x:-.2,y:-.1,rotation:35}],secondsToMature:1500,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Squash,name:"Squash",baseSellPrice:3500,baseWeight:.3,baseTileScale:.4,maxScale:2.5}},BurrosTail:{seed:{tileRef:Ge.BurrosTail,name:"Burro's Tail Cutting",coinPrice:93e3,creditPrice:338,rarity:he.Legendary},plant:{tileRef:Pe.Trellis,name:"Burro's Tail Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.13,y:-.1,rotation:0},{x:.17,y:.13,rotation:0}],secondsToMature:1800,baseTileScale:.8,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Pe.BurrosTail,name:"Burro's Tail",baseSellPrice:6e3,baseWeight:.4,baseTileScale:.4,maxScale:2.5}},Mushroom:{seed:{tileRef:Ge.Mushroom,name:"Mushroom Spore",coinPrice:15e4,creditPrice:249,rarity:he.Mythic},plant:{tileRef:Pe.MushroomPlant,name:"Mushroom Plant",harvestType:Ue.Single,baseTileScale:.8},crop:{tileRef:Pe.Mushroom,name:"Mushroom",baseSellPrice:16e4,baseWeight:25,baseTileScale:.65,maxScale:3.5}},Cactus:{seed:{tileRef:Ge.Cactus,name:"Cactus Seed",coinPrice:25e4,creditPrice:250,rarity:he.Mythic},plant:{tileRef:at.Cactus,name:"Cactus Plant",harvestType:Ue.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:-.4,nudgeYMultiplier:.3},crop:{tileRef:at.Cactus,name:"Cactus",baseSellPrice:261e3,baseWeight:1500,baseTileScale:2.5,maxScale:1.8}},Bamboo:{seed:{tileRef:Ge.Bamboo,name:"Bamboo Seed",coinPrice:4e5,creditPrice:300,rarity:he.Mythic},plant:{tileRef:at.Bamboo,name:"Bamboo Plant",harvestType:Ue.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:-.45,nudgeYMultiplier:.3},crop:{tileRef:at.Bamboo,name:"Bamboo Shoot",baseSellPrice:5e5,baseWeight:1,baseTileScale:2.5,maxScale:2}},Grape:{seed:{tileRef:Ge.Grape,name:"Grape Seed",coinPrice:85e4,creditPrice:599,rarity:he.Mythic,getCanSpawnInGuild:t=>uS(t)},plant:{tileRef:Pe.SproutVine,name:"Grape Plant",harvestType:Ue.Multiple,slotOffsets:[{x:0,y:0,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Grape,name:"Grape",baseSellPrice:7085,baseWeight:3,baseTileScale:.5,maxScale:2}},Pepper:{seed:{tileRef:Ge.Pepper,name:"Pepper Seed",coinPrice:1e6,creditPrice:629,rarity:he.Divine},plant:{tileRef:Pe.SproutVine,name:"Pepper Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.02,y:.219,rotation:0},{x:.172,y:.172,rotation:0},{x:-.172,y:.137,rotation:0},{x:.168,y:-.035,rotation:0},{x:-.082,y:-.047,rotation:0},{x:-.207,y:-.074,rotation:0},{x:.18,y:-.176,rotation:0},{x:-.273,y:-.195,rotation:0},{x:-.074,y:-.25,rotation:0}],secondsToMature:560,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Pepper,name:"Pepper",baseSellPrice:7220,baseWeight:.5,baseTileScale:.3,maxScale:2}},Lemon:{seed:{tileRef:Ge.Lemon,name:"Lemon Seed",coinPrice:2e6,creditPrice:500,rarity:he.Divine,getCanSpawnInGuild:t=>mf(t)},plant:{tileRef:at.Tree,name:"Lemon Tree",harvestType:Ue.Multiple,slotOffsets:[{x:-.5,y:-1.5,rotation:0},{x:.4,y:-1.6,rotation:0},{x:-.3,y:-1.18,rotation:0},{x:.2,y:-1.2,rotation:0},{x:.01,y:-1.5,rotation:0},{x:-.05,y:-1.8,rotation:0}],secondsToMature:720*60,baseTileScale:2.3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:-.25},crop:{tileRef:Pe.Lemon,name:"Lemon",baseSellPrice:1e4,baseWeight:.5,baseTileScale:.25,maxScale:3}},PassionFruit:{seed:{tileRef:Ge.PassionFruit,name:"Passion Fruit Seed",coinPrice:275e4,creditPrice:679,rarity:he.Divine},plant:{tileRef:Pe.SproutVine,name:"Passion Fruit Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.3,y:-.3,rotation:0},{x:.3,y:.3,rotation:0}],secondsToMature:1440*60,baseTileScale:1.1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:Pe.PassionFruit,name:"Passion Fruit",baseSellPrice:24500,baseWeight:9.5,baseTileScale:.35,maxScale:2}},DragonFruit:{seed:{tileRef:Ge.DragonFruit,name:"Dragon Fruit Seed",coinPrice:5e6,creditPrice:715,rarity:he.Divine},plant:{tileRef:Pe.PalmTreeTop,name:"Dragon Fruit Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.3,y:-.4,rotation:0},{x:-.4,y:-.05,rotation:0},{x:.36,y:-.3,rotation:0},{x:-.25,y:.3,rotation:0},{x:0,y:-.1,rotation:0},{x:.4,y:.1,rotation:0},{x:.1,y:.2,rotation:0}],secondsToMature:600,baseTileScale:1.6,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.DragonFruit,name:"Dragon Fruit",baseSellPrice:24500,baseWeight:8.4,baseTileScale:.4,maxScale:2}},Lychee:{seed:{tileRef:Ge.Lychee,name:"Lychee Pit",coinPrice:25e6,creditPrice:819,rarity:he.Divine,getCanSpawnInGuild:t=>mf(t)},plant:{tileRef:Pe.BushyTree,name:"Lychee Plant",harvestType:Ue.Multiple,slotOffsets:[{x:-.4,y:-.1,rotation:0},{x:.3,y:-.2,rotation:0},{x:-.3,y:.22,rotation:0},{x:.2,y:.2,rotation:0},{x:.01,y:-.1,rotation:0},{x:-.2,y:-.3,rotation:0}],secondsToMature:1440*60,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:Pe.Lychee,name:"Lychee Fruit",baseSellPrice:5e4,baseWeight:9,baseTileScale:.2,maxScale:2}},Sunflower:{seed:{tileRef:Ge.Sunflower,name:"Sunflower Seed",coinPrice:1e8,creditPrice:900,rarity:he.Divine},plant:{tileRef:Pe.StemFlower,name:"Sunflower Plant",harvestType:Ue.Multiple,slotOffsets:[{x:.01,y:-.6,rotation:0}],secondsToMature:1440*60,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",baseTileScale:.8,nudgeY:-.35},crop:{tileRef:Pe.Sunflower,name:"Sunflower",baseSellPrice:75e4,baseWeight:10,baseTileScale:.5,maxScale:2.5}},Starweaver:{seed:{tileRef:Ge.Starweaver,name:"Starweaver Pod",coinPrice:1e9,creditPrice:1e3,rarity:he.Celestial},plant:{tileRef:at.StarweaverPlant,name:"Starweaver Plant",harvestType:Ue.Multiple,immatureTileRef:at.StarweaverPlatform,baseTileScale:1.5,tileTransformOrigin:"bottom",nudgeY:-.27,isFixedScale:!0,rotateSlotOffsetsRandomly:!1,secondsToMature:1440*60,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2},slotOffsets:[{x:0,y:-.918,rotation:0}]},crop:{tileRef:Pe.Starweaver,name:"Starweaver Fruit",baseSellPrice:1e7,baseWeight:10,baseTileScale:.6,maxScale:2}},DawnCelestial:{seed:{tileRef:Ge.DawnCelestial,name:"Dawnbinder Pod",coinPrice:1e10,creditPrice:1129,rarity:he.Celestial},plant:{tileRef:at.DawnCelestialPlant,name:"Dawnbinder",harvestType:Ue.Multiple,secondsToMature:1440*60,slotOffsets:[{x:-.015,y:-.95,rotation:0}],baseTileScale:2.3,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.2,isFixedScale:!0,abilities:["DawnKisser"],activeState:{tileRef:at.DawnCelestialPlantActive,requiredWeather:"Dawn",activeAnimationTiles:{frames:10,row:6,fps:20,nudgeY:-.1}},topmostLayerTileRef:at.DawnCelestialPlatformTopmostLayer,immatureTileRef:at.DawnCelestialPlatform,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2}},crop:{tileRef:Pe.DawnCelestialCrop,name:"Dawnbinder Bulb",baseSellPrice:11e6,baseWeight:6,baseTileScale:.4,maxScale:2.5,transformOrigin:"top"}},MoonCelestial:{seed:{tileRef:Ge.MoonCelestial,name:"Moonbinder Pod",coinPrice:5e10,creditPrice:1249,rarity:he.Celestial},plant:{tileRef:at.MoonCelestialPlant,name:"Moonbinder",harvestType:Ue.Multiple,secondsToMature:1440*60,slotOffsets:[{x:.01,y:-1.81,rotation:0},{x:-.26,y:-.82,rotation:-20},{x:.23,y:-1,rotation:20}],baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:-.2,isFixedScale:!0,abilities:["MoonKisser"],activeState:{tileRef:at.MoonCelestialPlantActive,requiredWeather:"AmberMoon",activeAnimationTiles:{frames:10,row:6,fps:20,nudgeY:-.1}},immatureTileRef:at.MoonCelestialPlatform,growingAnimationTiles:{frames:10,row:8,fps:20,nudgeY:-.2}},crop:{tileRef:Pe.MoonCelestialCrop,name:"Moonbinder Bulb",baseSellPrice:11e6,baseWeight:2,baseTileScale:.4,maxScale:2,transformOrigin:"bottom"}}},Wi={Gold:{name:"Gold",baseChance:.01,coinMultiplier:25},Rainbow:{name:"Rainbow",baseChance:.001,coinMultiplier:50},Wet:{name:"Wet",baseChance:0,coinMultiplier:2,tileRef:Kt.Wet},Chilled:{name:"Chilled",baseChance:0,coinMultiplier:2,tileRef:Kt.Chilled},Frozen:{name:"Frozen",baseChance:0,coinMultiplier:10,tileRef:Kt.Frozen},Dawnlit:{name:"Dawnlit",baseChance:0,coinMultiplier:2,tileRef:Kt.Dawnlit},Ambershine:{name:"Amberlit",baseChance:0,coinMultiplier:5,tileRef:Kt.Ambershine},Dawncharged:{name:"Dawnbound",baseChance:0,coinMultiplier:3,tileRef:Kt.Dawncharged},Ambercharged:{name:"Amberbound",baseChance:0,coinMultiplier:6,tileRef:Kt.Ambercharged}},Pt={CommonEgg:{tileRef:nt.CommonEgg,name:"Common Egg",coinPrice:1e5,creditPrice:19,rarity:he.Common,initialTileScale:.3,baseTileScale:.8,secondsToHatch:600,faunaSpawnWeights:{Worm:60,Snail:35,Bee:5}},UncommonEgg:{tileRef:nt.UncommonEgg,name:"Uncommon Egg",coinPrice:1e6,creditPrice:48,rarity:he.Uncommon,initialTileScale:.3,baseTileScale:.8,secondsToHatch:3600,faunaSpawnWeights:{Chicken:65,Bunny:25,Dragonfly:10}},RareEgg:{tileRef:nt.RareEgg,name:"Rare Egg",coinPrice:1e7,creditPrice:99,rarity:he.Rare,initialTileScale:.3,baseTileScale:.8,secondsToHatch:21600,faunaSpawnWeights:{Pig:90,Cow:10}},LegendaryEgg:{tileRef:nt.LegendaryEgg,name:"Legendary Egg",coinPrice:1e8,creditPrice:249,rarity:he.Legendary,initialTileScale:.3,baseTileScale:.8,secondsToHatch:43200,faunaSpawnWeights:{Squirrel:60,Turtle:30,Goat:10}},MythicalEgg:{tileRef:nt.MythicalEgg,name:"Mythical Egg",coinPrice:1e9,creditPrice:599,rarity:he.Mythic,initialTileScale:.3,baseTileScale:.8,secondsToHatch:86400,faunaSpawnWeights:{Butterfly:75,Capybara:5,Peacock:20}}},ot={Worm:{tileRef:nt.Worm,name:"Worm",description:"",coinsToFullyReplenishHunger:500,innateAbilityWeights:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.1,moveProbability:.1,hoursToMature:12,rarity:he.Common,tileTransformOrigin:"bottom",nudgeY:.25,diet:["Carrot","Strawberry","Aloe","Tomato","Apple"]},Snail:{tileRef:nt.Snail,name:"Snail",description:"",coinsToFullyReplenishHunger:1e3,innateAbilityWeights:{CoinFinderI:100},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.15,moveProbability:.01,hoursToMature:12,rarity:he.Common,tileTransformOrigin:"bottom",nudgeY:-.25,diet:["Blueberry","Tomato","Corn","Daffodil"]},Bee:{tileRef:nt.Bee,name:"Bee",coinsToFullyReplenishHunger:1500,innateAbilityWeights:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,maturitySellPrice:3e4,matureWeight:.2,moveProbability:.5,hoursToMature:12,rarity:he.Common,diet:["Strawberry","Blueberry","OrangeTulip","Daffodil","Lily"]},Chicken:{tileRef:nt.Chicken,name:"Chicken",coinsToFullyReplenishHunger:3e3,innateAbilityWeights:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,maturitySellPrice:5e4,matureWeight:3,moveProbability:.2,hoursToMature:24,rarity:he.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Aloe","Corn","Watermelon","Pumpkin"]},Bunny:{tileRef:nt.Bunny,name:"Bunny",coinsToFullyReplenishHunger:750,innateAbilityWeights:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,maturitySellPrice:75e3,matureWeight:2,moveProbability:.3,hoursToMature:24,rarity:he.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Carrot","Strawberry","Blueberry","Echeveria"]},Dragonfly:{tileRef:nt.Dragonfly,name:"Dragonfly",coinsToFullyReplenishHunger:250,innateAbilityWeights:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,maturitySellPrice:15e4,matureWeight:.2,moveProbability:.7,hoursToMature:24,rarity:he.Uncommon,tileTransformOrigin:"center",diet:["Apple","OrangeTulip","Echeveria"]},Pig:{tileRef:nt.Pig,name:"Pig",coinsToFullyReplenishHunger:5e4,innateAbilityWeights:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,maturitySellPrice:5e5,matureWeight:200,moveProbability:.2,hoursToMature:72,rarity:he.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","Pumpkin","Mushroom","Bamboo"]},Cow:{tileRef:nt.Cow,name:"Cow",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,maturitySellPrice:1e6,matureWeight:600,moveProbability:.1,hoursToMature:72,rarity:he.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Coconut","Banana","BurrosTail","Mushroom"]},Squirrel:{tileRef:nt.Squirrel,name:"Squirrel",coinsToFullyReplenishHunger:15e3,innateAbilityWeights:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,maturitySellPrice:5e6,matureWeight:.5,moveProbability:.4,hoursToMature:100,rarity:he.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Banana","Grape"]},Turtle:{tileRef:nt.Turtle,name:"Turtle",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,maturitySellPrice:1e7,matureWeight:150,moveProbability:.05,hoursToMature:100,rarity:he.Legendary,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","BurrosTail","Bamboo","Pepper"]},Goat:{tileRef:nt.Goat,name:"Goat",coinsToFullyReplenishHunger:2e4,innateAbilityWeights:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,maturitySellPrice:2e7,matureWeight:100,moveProbability:.2,hoursToMature:100,rarity:he.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Coconut","Cactus","Pepper"]},Butterfly:{tileRef:nt.Butterfly,name:"Butterfly",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,maturitySellPrice:5e7,matureWeight:.2,moveProbability:.6,hoursToMature:144,rarity:he.Mythic,tileTransformOrigin:"center",diet:["Daffodil","Lily","Grape","Lemon","Sunflower"]},Capybara:{tileRef:nt.Capybara,name:"Capybara",coinsToFullyReplenishHunger:15e4,innateAbilityWeights:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,maturitySellPrice:2e8,matureWeight:50,moveProbability:.2,hoursToMature:144,rarity:he.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Lemon","PassionFruit","DragonFruit","Lychee"]},Peacock:{tileRef:nt.Peacock,name:"Peacock",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,maturitySellPrice:1e8,matureWeight:5,moveProbability:.2,hoursToMature:144,rarity:he.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Cactus","Sunflower","Lychee"]}},xt={ProduceScaleBoost:{name:"Crop Size Boost I",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.3,baseParameters:{cropScaleIncreasePercentage:6}},ProduceScaleBoostII:{name:"Crop Size Boost II",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.4,baseParameters:{cropScaleIncreasePercentage:10}},DoubleHarvest:{name:"Double Harvest",description:"Chance to duplicate harvested crops",trigger:"harvest",baseProbability:5,baseParameters:{}},ProduceEater:{name:"Crop Eater",description:"Harvests non-mutated crops and sells them",trigger:"continuous",baseProbability:60,baseParameters:{cropSellPriceIncreasePercentage:150}},SellBoostI:{name:"Sell Boost I",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:10,baseParameters:{cropSellPriceIncreasePercentage:20}},SellBoostII:{name:"Sell Boost II",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:12,baseParameters:{cropSellPriceIncreasePercentage:30}},SellBoostIII:{name:"Sell Boost III",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:14,baseParameters:{cropSellPriceIncreasePercentage:40}},SellBoostIV:{name:"Sell Boost IV",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:16,baseParameters:{cropSellPriceIncreasePercentage:50}},ProduceRefund:{name:"Crop Refund",description:"Chance to get crops back when selling",trigger:"sellAllCrops",baseProbability:20,baseParameters:{}},PlantGrowthBoost:{name:"Plant Growth Boost I",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:24,baseParameters:{plantGrowthReductionMinutes:3}},PlantGrowthBoostII:{name:"Plant Growth Boost II",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:27,baseParameters:{plantGrowthReductionMinutes:5}},ProduceMutationBoost:{name:"Crop Mutation Boost I",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:10}},ProduceMutationBoostII:{name:"Crop Mutation Boost II",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:15}},PetMutationBoost:{name:"Pet Mutation Boost I",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:7}},PetMutationBoostII:{name:"Pet Mutation Boost II",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:10}},GoldGranter:{name:"Gold Granter",description:"Grants the Gold mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Gold"]}},RainbowGranter:{name:"Rainbow Granter",description:"Grants the Rainbow mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Rainbow"]}},EggGrowthBoost:{name:"Egg Growth Boost I",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:21,baseParameters:{eggGrowthTimeReductionMinutes:7}},EggGrowthBoostII:{name:"Egg Growth Boost II",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:24,baseParameters:{eggGrowthTimeReductionMinutes:10}},EggGrowthBoostIII:{name:"Egg Growth Boost III",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:27,baseParameters:{eggGrowthTimeReductionMinutes:13}},PetAgeBoost:{name:"Hatch XP Boost I",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:50,baseParameters:{bonusXp:8e3}},PetAgeBoostII:{name:"Hatch XP Boost II",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:60,baseParameters:{bonusXp:12e3}},PetHatchSizeBoost:{name:"Max Strength Boost I",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:12,baseParameters:{maxStrengthIncreasePercentage:2.4}},PetHatchSizeBoostII:{name:"Max Strength Boost II",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:14,baseParameters:{maxStrengthIncreasePercentage:3.5}},PetXpBoost:{name:"XP Boost I",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:30,baseParameters:{bonusXp:300}},PetXpBoostII:{name:"XP Boost II",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:35,baseParameters:{bonusXp:400}},HungerRestore:{name:"Hunger Restore I",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:12,baseParameters:{hungerRestorePercentage:30}},HungerRestoreII:{name:"Hunger Restore II",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:14,baseParameters:{hungerRestorePercentage:35}},HungerBoost:{name:"Hunger Boost I",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:12}},HungerBoostII:{name:"Hunger Boost II",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:16}},PetRefund:{name:"Pet Refund I",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:5,baseParameters:{}},PetRefundII:{name:"Pet Refund II",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:7,baseParameters:{}},Copycat:{name:"Copycat",description:"Chance to copy the ability of another active pet",trigger:"continuous",baseProbability:1,baseParameters:{}},CoinFinderI:{name:"Coin Finder I",description:"Finds coins in your garden",trigger:"continuous",baseProbability:35,baseParameters:{baseMaxCoinsFindable:12e4}},CoinFinderII:{name:"Coin Finder II",description:"Finds coins in your garden",trigger:"continuous",baseProbability:13,baseParameters:{baseMaxCoinsFindable:12e5}},CoinFinderIII:{name:"Coin Finder III",description:"Finds coins in your garden",trigger:"continuous",baseProbability:6,baseParameters:{baseMaxCoinsFindable:1e7}},SeedFinderI:{name:"Seed Finder I",description:"Finds common and uncommon seeds in your garden",trigger:"continuous",baseProbability:40,baseParameters:{}},SeedFinderII:{name:"Seed Finder II",description:"Finds rare and legendary seeds in your garden",trigger:"continuous",baseProbability:16,baseParameters:{}},SeedFinderIII:{name:"Seed Finder III",description:"Finds mythical seeds in your garden",trigger:"continuous",baseProbability:9,baseParameters:{}},SeedFinderIV:{name:"Seed Finder IV",description:"Finds divine and celestial seeds in your garden",trigger:"continuous",baseProbability:.01,baseParameters:{}}},Rt={WateringCan:{tileRef:Wr.WateringCan,name:"Watering Can",coinPrice:5e3,creditPrice:2,rarity:he.Common,description:"Speeds up growth of plant by 5 minutes. SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.6,maxInventoryQuantity:99},PlanterPot:{tileRef:Wr.PlanterPot,name:"Planter Pot",coinPrice:25e3,creditPrice:5,rarity:he.Common,description:"Extract a plant to your inventory (can be replanted). SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.8},Shovel:{tileRef:Wr.Shovel,name:"Garden Shovel",coinPrice:1e6,creditPrice:100,rarity:he.Uncommon,description:"Remove plants from your garden. UNLIMITED USES.",isOneTimePurchase:!0,baseTileScale:.7},RainbowPotion:{tileRef:Wr.RainbowPotion,name:"Rainbow Potion",coinPrice:1/0,creditPrice:1/0,rarity:he.Celestial,description:"Adds the Rainbow mutation to a crop in your garden. SINGLE USE.",isOneTimePurchase:!0,baseTileScale:1}},_t={SmallRock:{tileRef:xe.SmallRock,name:"Small Garden Rock",coinPrice:1e3,creditPrice:2,rarity:he.Common,baseTileScale:1,isOneTimePurchase:!1},MediumRock:{tileRef:xe.MediumRock,name:"Medium Garden Rock",coinPrice:2500,creditPrice:5,rarity:he.Common,baseTileScale:1,isOneTimePurchase:!1},LargeRock:{tileRef:xe.LargeRock,name:"Large Garden Rock",coinPrice:5e3,creditPrice:10,rarity:he.Common,baseTileScale:1,isOneTimePurchase:!1},WoodBench:{tileRef:xe.WoodBench,rotationVariants:{90:{tileRef:xe.WoodBenchSideways,flipH:!0,baseTileScale:1.46,nudgeY:-.3},180:{tileRef:xe.WoodBenchBackwards},270:{tileRef:xe.WoodBenchSideways,baseTileScale:1.46,nudgeY:-.3}},name:"Wood Bench",coinPrice:1e4,creditPrice:15,rarity:he.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},WoodArch:{tileRef:xe.WoodArch,rotationVariants:{90:{tileRef:xe.WoodArchSide,flipH:!0,baseTileScale:2.1,nudgeY:-.48},180:{tileRef:xe.WoodArch,flipH:!0},270:{tileRef:xe.WoodArchSide,baseTileScale:2.1,nudgeY:-.48}},name:"Wood Arch",coinPrice:2e4,creditPrice:25,rarity:he.Common,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},WoodBridge:{tileRef:xe.WoodBridge,rotationVariants:{90:{tileRef:xe.WoodBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.WoodBridge,flipH:!0},270:{tileRef:xe.WoodBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Wood Bridge",coinPrice:4e4,creditPrice:35,rarity:he.Common,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},WoodLampPost:{tileRef:xe.WoodLampPost,name:"Wood Lamp Post",coinPrice:8e4,creditPrice:49,rarity:he.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodOwl:{tileRef:xe.WoodOwl,name:"Wood Owl",coinPrice:9e4,creditPrice:59,rarity:he.Common,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},WoodBirdhouse:{tileRef:xe.Birdhouse,name:"Wood Birdhouse",coinPrice:1e5,creditPrice:69,rarity:he.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneBench:{tileRef:xe.StoneBench,rotationVariants:{90:{tileRef:xe.StoneBenchSideways,flipH:!0,baseTileScale:1.47,nudgeY:-.3},180:{tileRef:xe.StoneBench,flipH:!0},270:{tileRef:xe.StoneBenchSideways,baseTileScale:1.47,nudgeY:-.3}},name:"Stone Bench",coinPrice:1e6,creditPrice:75,rarity:he.Uncommon,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},StoneArch:{tileRef:xe.StoneArch,rotationVariants:{90:{tileRef:xe.StoneArchSideways,flipH:!0,baseTileScale:2.1,nudgeY:-.44},180:{tileRef:xe.StoneArch,flipH:!0},270:{tileRef:xe.StoneArchSideways,baseTileScale:2.1,nudgeY:-.44}},name:"Stone Arch",coinPrice:4e6,creditPrice:124,rarity:he.Uncommon,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},StoneBridge:{tileRef:xe.StoneBridge,rotationVariants:{90:{tileRef:xe.StoneBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.StoneBridge,flipH:!0},270:{tileRef:xe.StoneBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Stone Bridge",coinPrice:5e6,creditPrice:179,rarity:he.Uncommon,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},StoneLampPost:{tileRef:xe.StoneLampPost,name:"Stone Lamp Post",coinPrice:8e6,creditPrice:199,rarity:he.Uncommon,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneGnome:{tileRef:xe.StoneGnome,name:"Stone Gnome",coinPrice:9e6,creditPrice:219,rarity:he.Uncommon,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},StoneBirdbath:{tileRef:xe.StoneBirdBath,name:"Stone Birdbath",coinPrice:1e7,creditPrice:249,rarity:he.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.46},MarbleBench:{tileRef:xe.MarbleBench,rotationVariants:{90:{tileRef:xe.MarbleBenchSideways,flipH:!0,baseTileScale:1.55,nudgeY:-.35},180:{tileRef:xe.MarbleBenchBackwards},270:{tileRef:xe.MarbleBenchSideways,baseTileScale:1.55,nudgeY:-.35}},name:"Marble Bench",coinPrice:75e6,creditPrice:349,rarity:he.Rare,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},MarbleArch:{tileRef:xe.MarbleArch,rotationVariants:{90:{tileRef:xe.MarbleArchSideways,flipH:!0,baseTileScale:2.38,nudgeY:-.57},180:{tileRef:xe.MarbleArch,flipH:!0},270:{tileRef:xe.MarbleArchSideways,baseTileScale:2.38,nudgeY:-.57}},name:"Marble Arch",coinPrice:1e8,creditPrice:399,rarity:he.Rare,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},MarbleBridge:{tileRef:xe.MarbleBridge,rotationVariants:{90:{tileRef:xe.MarbleBridgeSideways,flipH:!0,baseTileScale:1.7,nudgeY:-.28},180:{tileRef:xe.MarbleBridge,flipH:!0},270:{tileRef:xe.MarbleBridgeSideways,baseTileScale:1.7,nudgeY:-.28}},name:"Marble Bridge",coinPrice:15e7,creditPrice:429,rarity:he.Rare,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},MarbleLampPost:{tileRef:xe.MarbleLampPost,name:"Marble Lamp Post",coinPrice:2e8,creditPrice:449,rarity:he.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},MarbleBlobling:{tileRef:xe.MarbleBlobling,name:"Marble Blobling",coinPrice:3e8,creditPrice:499,rarity:he.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.56},MiniFairyCottage:{tileRef:xe.MiniFairyCottage,name:"Mini Fairy Cottage",coinPrice:5e8,creditPrice:549,rarity:he.Rare,baseTileScale:1.1,isOneTimePurchase:!1,nudgeY:-.37},Cauldron:{tileRef:xe.Cauldron,name:"Cauldron",coinPrice:666e6,creditPrice:666,rarity:he.Legendary,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.25,expiryDate:new Date("2025-11-07T01:00:00.000Z")},StrawScarecrow:{tileRef:xe.StrawScarecrow,name:"Straw Scarecrow",coinPrice:1e9,creditPrice:599,rarity:he.Legendary,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.65},MiniFairyForge:{tileRef:xe.MiniFairyForge,name:"Mini Fairy Forge",coinPrice:5e9,creditPrice:979,rarity:he.Legendary,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyKeep:{tileRef:xe.MiniFairyKeep,name:"Mini Fairy Keep",coinPrice:25e9,creditPrice:1249,rarity:he.Mythic,baseTileScale:1.05,isOneTimePurchase:!1,nudgeY:-.33},HayBale:{tileRef:xe.HayBale,rotationVariants:{90:{tileRef:xe.HayBaleSideways,flipH:!0},180:{tileRef:xe.HayBale,flipH:!0},270:{tileRef:xe.HayBaleSideways}},name:"Hay Bale",coinPrice:7e3,creditPrice:12,rarity:he.Common,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.42,expiryDate:new Date("2025-11-07T01:00:00.000Z")},SmallGravestone:{tileRef:xe.SmallGravestone,rotationVariants:{90:{tileRef:xe.SmallGravestoneSideways,flipH:!0,baseTileScale:1.12,nudgeY:-.32},180:{tileRef:xe.SmallGravestone,flipH:!0},270:{tileRef:xe.SmallGravestoneSideways,baseTileScale:1.12,nudgeY:-.32}},name:"Small Gravestone",coinPrice:8e3,creditPrice:12,rarity:he.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.38,expiryDate:new Date("2025-11-07T01:00:00.000Z")},MediumGravestone:{tileRef:xe.MediumGravestone,rotationVariants:{90:{tileRef:xe.MediumGravestoneSideways,flipH:!0,baseTileScale:1.32,nudgeY:-.33},180:{tileRef:xe.MediumGravestone,flipH:!0},270:{tileRef:xe.MediumGravestoneSideways,baseTileScale:1.32,nudgeY:-.33}},name:"Medium Gravestone",coinPrice:5e5,creditPrice:72,rarity:he.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.45,expiryDate:new Date("2025-11-07T01:00:00.000Z")},LargeGravestone:{tileRef:xe.LargeGravestone,rotationVariants:{90:{tileRef:xe.LargeGravestoneSideways,flipH:!0,baseTileScale:1.5,nudgeY:-.39},180:{tileRef:xe.LargeGravestone,flipH:!0},270:{tileRef:xe.LargeGravestoneSideways,baseTileScale:1.5,nudgeY:-.39}},name:"Large Gravestone",coinPrice:5e7,creditPrice:299,rarity:he.Rare,baseTileScale:1.4,isOneTimePurchase:!1,nudgeY:-.51,expiryDate:new Date("2025-11-07T01:00:00.000Z")}},tr={Rain:{atomValue:"Rain",description:"Gives the Wet mutation to mature garden crops",type:"weather",cycle:{kind:"weather",startWindowMin:20,startWindowMax:35,durationMinutes:5},weightInCycle:.75,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Wet",multiplier:2},{name:"Frozen",multiplier:10,conditional:"applies if crop already has Chilled"}],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:["Wet","Chilled","Frozen"]},screenEffect:"Rain on screen",notes:["Primary vs Snow (75%)","Affecte une culture applicable au hasard"]},Frost:{atomValue:"Frost",description:"Gives the Frozen mutation to mature garden crops",type:"weather",displayName:"Snow",cycle:{kind:"weather",startWindowMin:20,startWindowMax:35,durationMinutes:5},weightInCycle:.25,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Chilled",multiplier:2},{name:"Frozen",multiplier:10,conditional:"applies if crop already has Wet"}],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:["Wet","Chilled","Frozen"]},screenEffect:"Snow on screen",notes:["Secondary vs Rain (25%)","Frozen recommand\xE9 pour champignon/cactus/bambou"]},Sunny:{atomValue:null,description:"No special effects",type:"base",cycle:{kind:"base"},appliesRandomCropPercent:0,conditions:{requiresMature:!1,requiresNoExistingModifier:!1},mutations:[],stacking:{compatible:["Golden","Rainbow","Giant"],incompatible:[]},screenEffect:"Blue skies",notes:["\xC9tat par d\xE9faut, aucun effet"]},AmberMoon:{atomValue:"Amber Moon",description:"Gives the Amberglow mutation to mature garden crops",type:"lunar",displayName:"Harvest Moon",cycle:{kind:"lunar",periodMinutes:240,durationMinutes:10},weightInCycle:.33,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Amberglow",multiplier:5}],stacking:{compatible:["Gold","Rainbow"],incompatible:["Dawnlit","Amberlit"]},screenEffect:"Nightfall glow (orange)",notes:["1 fois / 4h","Ne se cumule pas avec Dawnlit"]},Dawn:{atomValue:"Dawn",description:"Gives the Dawnlit mutation to mature garden crops",type:"lunar",cycle:{kind:"lunar",periodMinutes:240,durationMinutes:10},weightInCycle:.67,appliesRandomCropPercent:30,conditions:{requiresMature:!0,requiresNoExistingModifier:!0},mutations:[{name:"Dawnlit",multiplier:2}],stacking:{compatible:["Gold","Rainbow"],incompatible:["Amberlit","Dawnlit"]},screenEffect:"Sunrise glow (purple)",notes:["1 fois / 4h","Ne se cumule pas avec Amberglow"]}},nr={img64:"data:image/png;base64,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"};var fS=new Set(["Gold","Rainbow"]),kc="NoWeatherEffect",wf=t=>t.toLowerCase().replace(/['’`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),mS=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=wf(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(Be)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})(),Mn=()=>({isPlant:!1,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:null,sizePercent:null,mutations:[]}),hS=()=>typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),gS=(t,e)=>{if(t===e)return!0;if(!t||!e)return(t?.length??0)===(e?.length??0);if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0},yS=(t,e)=>t.isPlant===e.isPlant&&t.originalIndex===e.originalIndex&&t.orderedIndex===e.orderedIndex&&t.totalSlots===e.totalSlots&&t.availableSlotCount===e.availableSlotCount&&t.slot===e.slot&&t.seedKey===e.seedKey&&t.sizePercent===e.sizePercent&&gS(t.mutations,e.mutations),Sf=t=>!!t&&t.objectType==="plant",bS=t=>{if(!t)return"\u2205";let e=t.species??"",n=Number.isFinite(t.startTime)?t.startTime:0,r=Number.isFinite(t.endTime)?t.endTime:0,o=Number.isFinite(t.targetScale)?t.targetScale:0,s=Array.isArray(t.mutations)?t.mutations.join(","):"";return`${e}|${n}|${r}|${o}|${s}`},Ic=t=>{if(!t)return"\u2205";if(!Sf(t))return!t||typeof t!="object"?String(t):`other|${Object.keys(t).sort().map(o=>`${o}:${JSON.stringify(t[o])}`).join(";")}`;let e=`${t.objectType}|${t.species??""}|${t.plantedAt??0}|${t.maturedAt??0}`,n=Array.isArray(t.slots)?t.slots.map(r=>bS(r)).join("||"):"";return`${e}|slots:${n}`},Ac=t=>Array.isArray(t)?t.join(","):"\u2205",vS=t=>Array.from({length:t},(e,n)=>n),gf=(t,e,n)=>Math.max(e,Math.min(n,t)),xf=t=>{if(!t||typeof t!="object")return null;if(typeof t.seedKey=="string")return t.seedKey;if(typeof t.species=="string"&&t.species)return t.species;let e=t,n=["seedSpecies","plantSpecies","cropSpecies","speciesId"];for(let r of n){let o=e[r];if(typeof o=="string"&&o)return o}return null},ji=(t,e,n)=>Math.max(e,Math.min(n,t)),wS=t=>{if(typeof t!="string")return null;let e=wf(t.trim());if(!e)return null;let n=mS.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null},SS=t=>{if(!t||typeof t!="object")return null;let e=new Set,n=xf(t);n&&e.add(n);let r=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"];for(let o of r){let s=t[o];typeof s=="string"&&s&&e.add(s)}for(let o of e){let s=wS(o);if(typeof s=="number"&&Number.isFinite(s)&&s>0)return s}return null},Ef=t=>{if(!t||typeof t!="object")return 100;let e=Number(t.sizePercent??t.sizePct??t.size??t.percent??t.progressPercent);if(Number.isFinite(e))return ji(Math.round(e),0,100);let n=Number(t.targetScale??t.scale);if(Number.isFinite(n)){let r=SS(t);if(typeof r=="number"&&Number.isFinite(r)&&r>1){let i=50+(Math.max(1,Math.min(r,n))-1)/(r-1)*50;return ji(Math.round(i),50,100)}if(n>1&&n<=2){let s=50+(n-1)/1*50;return ji(Math.round(s),50,100)}let o=Math.round(n*100);return ji(o,0,100)}return 100};function xS(){if(typeof window>"u")return{get:()=>Mn(),onChange:()=>()=>{},stop(){},recompute(){}};let t=null,e=null,n=Ac(e),r=null,o=Mn(),s=Ic(t),i=new Set,a=()=>{for(let y of i)try{y(o)}catch{}},l=!1,c=()=>{if(g(),l)return;l=!0;let y=()=>{l=!1,g()};typeof globalThis<"u"&&typeof globalThis.queueMicrotask=="function"?globalThis.queueMicrotask(y):typeof Promise<"u"?Promise.resolve().then(y):typeof window<"u"&&typeof window.setTimeout=="function"?window.setTimeout(y,0):y()};function d(y){return y?Array.isArray(e)&&e.length===y?e.slice():vS(y):[]}function u(y,v){if(!v||!y.length)return 0;let w=Number.isFinite(r)?r:0,x=gf(w,0,v-1),E=y.indexOf(x);return E>=0?E:0}function p(y){if(!Array.isArray(y))return[];let v=[];for(let w=0;w<y.length;w++){let x=y[w];if(typeof x=="string")x&&v.push(x);else if(x!=null){let E=String(x);E&&v.push(E)}}return v}function f(){let y=xf(t);if(!Sf(t))return{isPlant:!1,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:y,sizePercent:null,mutations:[]};let v=Array.isArray(t.slots)?t.slots:[],w=v.length;if(!w)return{isPlant:!0,originalIndex:null,orderedIndex:null,totalSlots:0,availableSlotCount:0,slot:null,seedKey:y,sizePercent:null,mutations:[]};let x=d(w),E=[];for(let G of x)Number.isInteger(G)&&G>=0&&G<w&&v[G]!=null&&E.push(G);let L=E.length;if(!L)return{isPlant:!0,originalIndex:null,orderedIndex:null,totalSlots:w,availableSlotCount:0,slot:null,seedKey:y,sizePercent:null,mutations:[]};let P=u(x,w),V=gf(P,0,L-1),z=E[V]??null,C=typeof z=="number"?v[z]??null:null,D=C?Ef(C):null,S=C?p(C.mutations):[];return{isPlant:!0,originalIndex:typeof z=="number"?z:null,orderedIndex:V,totalSlots:w,availableSlotCount:L,slot:C??null,seedKey:y,sizePercent:D,mutations:S}}function h(y,v){if(y.length!==v.length)return!1;for(let w=0;w<y.length;w++)if(y[w]!==v[w])return!1;return!0}function m(y,v){return y.isPlant===v.isPlant&&y.originalIndex===v.originalIndex&&y.orderedIndex===v.orderedIndex&&y.totalSlots===v.totalSlots&&y.availableSlotCount===v.availableSlotCount&&y.slot===v.slot&&y.seedKey===v.seedKey&&y.sizePercent===v.sizePercent&&h(y.mutations,v.mutations)}function g(){let y=f();m(y,o)||(o=y,a())}return(async()=>{try{r=await kn.get()}catch{}try{let P=await An.get();e=Array.isArray(P)?P.slice():null,n=Ac(e)}catch{}try{t=await In.get(),s=Ic(t)}catch{}let y=P=>{let V=Array.isArray(P)?P.slice():null,z=Ac(V);return z===n?!1:(e=V,n=z,!0)},v=P=>{let V=Ic(P??null);return V===s?!1:(t=P,s=V,!0)},w=!1,x=null,E=()=>{if(x!=null){if(typeof globalThis<"u"){let P=globalThis.clearTimeout;typeof P=="function"&&P.call(globalThis,x)}x=null}},L=()=>{if(w=!0,x!=null)return;let P=()=>{x=null,w&&(w=!1,c())};if(typeof globalThis<"u"){let V=globalThis.setTimeout;if(typeof V=="function"){x=V.call(globalThis,P,0);return}}P()};An.onChange(P=>{y(P)&&L()}),In.onChange(P=>{v(P)&&L()}),kn.onChange(P=>{r=Number.isFinite(P)?P:0,(async()=>{try{y(await An.get())}catch{}try{v(await In.get())}catch{}w&&(w=!1,E()),c()})()}),g()})(),{get(){return o},onChange(y){return i.add(y),()=>i.delete(y)},stop(){i.clear()},recompute(){g()}}}function Cf(){return{minScalePct:50,maxScalePct:100,scaleLockMode:"RANGE",minInventory:91,avoidNormal:!1,includeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[]}}function zo(){return{enabled:!1,settings:Cf(),overrides:{}}}var yf="garden.locker.state.v2",Pn=(t,e,n)=>Math.max(e,Math.min(n,t));function zi(t){let e=Cf(),n=t?.scaleLockMode==="MINIMUM"?"MINIMUM":t?.scaleLockMode==="NONE"?"NONE":"RANGE";e.scaleLockMode=n;let r=n==="MINIMUM"?100:99,o=Number(t?.minScalePct),s=Number.isFinite(o)?Pn(Math.round(o),50,r):50,i=Number(t?.maxScalePct),a=Number.isFinite(i)?Pn(Math.round(i),50,100):100;(n==="RANGE"||n==="NONE")&&(a=Pn(a,51,100),a<=s&&(s>=99?(s=99,a=100):a=Pn(s+1,51,100))),e.minScalePct=s,e.maxScalePct=a;let l=Number(t?.minInventory);e.minInventory=Number.isFinite(l)?Pn(Math.round(l),0,999):91,typeof t?.avoidNormal=="boolean"?e.avoidNormal=t.avoidNormal:e.avoidNormal=t?.includeNormal===!1,e.includeNormal=!e.avoidNormal,e.visualMutations=Array.isArray(t?.visualMutations)?Array.from(new Set(t.visualMutations.filter(d=>fS.has(d)))):[];let c=t?.weatherMode;return e.weatherMode=c==="ALL"||c==="RECIPES"?c:"ANY",e.weatherSelected=Array.isArray(t?.weatherSelected)?Array.from(new Set(t.weatherSelected.map(d=>String(d||"")).filter(Boolean))):[],e.weatherRecipes=Array.isArray(t?.weatherRecipes)?t.weatherRecipes.map(d=>Array.isArray(d)?Array.from(new Set(d.map(u=>String(u||"")).filter(Boolean))):[]).filter(d=>d.length>0):[],e}function ES(t){let e=zo();if(!t||typeof t!="object")return e;if(e.enabled=t.enabled===!0,e.settings=zi(t.settings),e.overrides={},t.overrides&&typeof t.overrides=="object")for(let[n,r]of Object.entries(t.overrides))n&&(e.overrides[n]={enabled:r?.enabled===!0,settings:zi(r?.settings)});return e}function bf(t){return{minScalePct:t.minScalePct,maxScalePct:t.maxScalePct,scaleLockMode:t.scaleLockMode,minInventory:t.minInventory,avoidNormal:t.avoidNormal,includeNormal:t.includeNormal,visualMutations:t.visualMutations.slice(),weatherMode:t.weatherMode,weatherSelected:t.weatherSelected.slice(),weatherRecipes:t.weatherRecipes.map(e=>e.slice())}}function CS(t){let e={};for(let[n,r]of Object.entries(t.overrides))e[n]={enabled:r.enabled,settings:bf(r.settings)};return{enabled:t.enabled,settings:bf(t.settings),overrides:e}}function vf(t){return{isPlant:t.isPlant,originalIndex:t.originalIndex,orderedIndex:t.orderedIndex,totalSlots:t.totalSlots,availableSlotCount:t.availableSlotCount,slot:t.slot,seedKey:t.seedKey,sizePercent:t.sizePercent,mutations:t.mutations.slice()}}function TS(t){let e=!1,n=!1,r=[];if(!Array.isArray(t))return{hasGold:e,hasRainbow:n,weather:r};for(let o=0;o<t.length;o++){let s=String(t[o]||"");s&&(s==="Gold"?e=!0:s==="Rainbow"?n=!0:r.push(s))}return{hasGold:e,hasRainbow:n,weather:r}}var Mc=class{constructor(){ce(this,"state",zo());ce(this,"listeners",new Set);ce(this,"slotInfoListeners",new Set);ce(this,"slotWatcher",null);ce(this,"slotWatcherUnsub",null);ce(this,"currentSlotInfo",Mn());ce(this,"currentSlotHarvestAllowed",null);ce(this,"lastSlotChangeDetectedAt",null);this.load(),this.updateSlotWatcher()}load(){if(typeof window>"u"||typeof localStorage>"u"){this.state=zo();return}try{let e=localStorage.getItem(yf);if(!e){this.state=zo();return}let n=JSON.parse(e);this.state=ES(n)}catch{this.state=zo()}}save(){if(!(typeof window>"u"||typeof localStorage>"u"))try{localStorage.setItem(yf,JSON.stringify(this.state))}catch{}}emit(){if(!this.listeners.size)return;let n={type:"locker-state-changed",state:this.getState()};for(let r of this.listeners)try{r(n)}catch{}}setState(e){this.state=e,this.updateSlotWatcher(),this.save(),this.emit(),this.requestSlotWatcherRecompute(),this.reapplyCurrentSlotInfo()}updateSlotWatcher(){if(this.state.enabled){if(this.slotWatcher||(this.slotWatcher=xS()),this.slotWatcher&&!this.slotWatcherUnsub)try{this.slotWatcherUnsub=this.slotWatcher.onChange(n=>this.handleSlotInfo(n))}catch{this.slotWatcherUnsub=null}try{let n=this.slotWatcher?this.slotWatcher.get():Mn();this.handleSlotInfo(n,{silent:!0})}catch{this.handleSlotInfo(Mn(),{silent:!0})}return}this.detachSlotWatcher()}getState(){return CS(this.state)}setGlobalState(e){let n=this.state,r=zi(e.settings),o={enabled:!!e.enabled,settings:r,overrides:{...n.overrides}};this.setState(o)}setOverride(e,n){if(!e)return;let r={enabled:!!n?.enabled,settings:zi(n?.settings)},o={...this.state.overrides,[e]:r};this.setState({...this.state,overrides:o})}removeOverride(e){if(!e||!(e in this.state.overrides))return;let n={...this.state.overrides};delete n[e],this.setState({...this.state,overrides:n})}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}onSlotInfoChange(e){return this.slotInfoListeners.add(e),()=>this.slotInfoListeners.delete(e)}getCurrentSlotSnapshot(){return{info:vf(this.currentSlotInfo),harvestAllowed:this.currentSlotHarvestAllowed,detectedAt:this.lastSlotChangeDetectedAt}}requestSlotWatcherRecompute(){if(this.slotWatcher)try{this.slotWatcher.recompute()}catch{}}detachSlotWatcher(){if(this.slotWatcherUnsub){try{this.slotWatcherUnsub()}catch{}this.slotWatcherUnsub=null}if(this.slotWatcher){try{this.slotWatcher.stop()}catch{}this.slotWatcher=null}this.handleSlotInfo(Mn(),{silent:!0})}handleSlotInfo(e,n={}){let{silent:r=!1}=n,o=this.currentSlotInfo,s=this.currentSlotHarvestAllowed,i=Array.isArray(e.mutations)?e.mutations.slice():[],a={...e,mutations:i},l=null,c=null,d=null;if(a.isPlant&&a.slot){typeof a.sizePercent=="number"&&Number.isFinite(a.sizePercent)?l=a.sizePercent:l=Ef(a.slot);try{c=this.allowsHarvest({seedKey:a.seedKey??null,sizePercent:l??0,mutations:i})}catch{c=null}}else l=typeof a.sizePercent=="number"&&Number.isFinite(a.sizePercent)?a.sizePercent:null,c=null;typeof l=="number"&&(d=Math.max(50,Math.min(100,l))),this.currentSlotInfo=a,this.currentSlotHarvestAllowed=c,r||(a.isPlant?a.slot?console.log("[Locker] Slot selection",{seedKey:a.seedKey??null,slotIndex:a.originalIndex,orderedIndex:a.orderedIndex,sizePercent:l,displaySizePercent:d,harvestAllowed:c,mutations:i,slot:a.slot}):console.log("[Locker] Slot selection",{isPlant:!0,slotIndex:a.originalIndex,orderedIndex:a.orderedIndex,totalSlots:a.totalSlots,availableSlotCount:a.availableSlotCount,seedKey:a.seedKey??null,displaySizePercent:d,slot:a.slot}):console.log("[Locker] Slot selection",{isPlant:!1,slot:a.slot}),(!yS(o,a)||(s??null)!==(c??null))&&(this.lastSlotChangeDetectedAt=hS())),this.emitSlotInfoChange()}reapplyCurrentSlotInfo(){try{let e=this.slotWatcher?this.slotWatcher.get():Mn();this.handleSlotInfo(e,{silent:!0})}catch{this.handleSlotInfo(Mn(),{silent:!0})}}recomputeCurrentSlot(){this.requestSlotWatcherRecompute(),this.reapplyCurrentSlotInfo()}effectiveSettings(e){if(!this.state.enabled)return{enabled:!1,settings:this.state.settings};if(e){let n=this.state.overrides[e];if(n?.enabled)return{enabled:!0,settings:n.settings}}return{enabled:!0,settings:this.state.settings}}slotShouldBeBlocked(e,n){let r=e.scaleLockMode==="MINIMUM"?"MINIMUM":e.scaleLockMode==="NONE"?"NONE":"RANGE",o=r==="MINIMUM"?100:99,s=Pn(Math.round(e.minScalePct??50),50,o),i=Pn(Math.round(e.maxScalePct??100),50,100);if(r==="MINIMUM"){if(n.sizePercent<s)return!0}else if(r==="RANGE"){let f=Pn(i,51,100),h=f<=s?Math.min(100,Math.max(51,s+1)):f;if(n.sizePercent>=s&&n.sizePercent<=h)return!0}let{hasGold:a,hasRainbow:l,weather:c}=TS(n.mutations);if(!a&&!l){if(e.avoidNormal)return!0}else{let f=e.visualMutations.includes("Gold"),h=e.visualMutations.includes("Rainbow");if(f&&a||h&&l)return!0}let u=e.weatherSelected??[],p=e.weatherMode??"ANY";if(p==="RECIPES"){let f=e.weatherRecipes??[];if(!f.length)return!1;for(let h=0;h<f.length;h++){let m=f[h];if(!Array.isArray(m)||m.length===0)continue;let g=!0;for(let y=0;y<m.length;y++){let v=m[y];if(v===kc){if(c.length!==0){g=!1;break}continue}if(!c.includes(v)){g=!1;break}}if(g)return!0}return!1}if(!u.length)return!1;if(p==="ALL"){let f=!1;for(let h=0;h<u.length;h++){let m=u[h];if(m===kc){if(f=!0,c.length!==0)return!1;continue}if(f=!0,!c.includes(m))return!1}return f}for(let f=0;f<u.length;f++){let h=u[f];if(h===kc){if(c.length===0)return!0;continue}if(c.includes(h))return!0}return!1}emitSlotInfoChange(){if(!this.slotInfoListeners.size)return;let e={type:"locker-slot-info-changed",info:vf(this.currentSlotInfo),harvestAllowed:this.currentSlotHarvestAllowed,detectedAt:this.lastSlotChangeDetectedAt};for(let n of this.slotInfoListeners)try{n(e)}catch{}}allowsHarvest(e){let n=this.effectiveSettings(e.seedKey);return n.enabled?!this.slotShouldBeBlocked(n.settings,e):!0}},dt=new Mc;var Lc="qws:stats:v1",kS={totalPlanted:!0,totalHarvested:!0,totalDestroyed:!0,watercanUsed:!0,waterTimeSavedMs:!0},IS={seedsBought:!0,decorBought:!0,eggsBought:!0,toolsBought:!0,cropsSoldCount:!0,cropsSoldValue:!1,petsSoldCount:!0,petsSoldValue:!1},AS={triggers:!0,totalValue:!1},MS={triggers:!0},rr=null,Pc=new Set,on=t=>typeof t=="object"&&t!==null,PS=(t,e=0)=>{let n=Number(t);return Number.isFinite(n)?n:e},Ui=(t,e=0)=>{let n=PS(t,e);return Math.max(0,n)},yt=(t,e=0)=>{let n=Ui(t,e);return Math.floor(n)},RS=(t,e)=>{let n=Number(t);return!Number.isFinite(n)||n<=0?e:Math.floor(n)},or=t=>({createdAt:t.createdAt,garden:{...t.garden},shops:{...t.shops},pets:{hatchedByType:Object.fromEntries(Object.entries(t.pets.hatchedByType).map(([e,n])=>[e,{...n}]))},abilities:Object.fromEntries(Object.entries(t.abilities).map(([e,n])=>[e,{...n}])),weather:Object.fromEntries(Object.entries(t.weather).map(([e,n])=>[e,{...n}]))});function Tf(){if(typeof window>"u")return null;try{return typeof window.localStorage>"u"?null:window.localStorage}catch{return null}}function zr(t=Date.now()){let e={};for(let o of Object.keys(ot))e[o.toLowerCase()]={normal:0,gold:0,rainbow:0};let n={};for(let o of Object.keys(xt))n[o]={triggers:0,totalValue:0};let r={};for(let o of Object.keys(tr))r[o.toLowerCase()]={triggers:0};return{createdAt:t,garden:{totalPlanted:0,totalHarvested:0,totalDestroyed:0,watercanUsed:0,waterTimeSavedMs:0},shops:{seedsBought:0,decorBought:0,eggsBought:0,toolsBought:0,cropsSoldCount:0,cropsSoldValue:0,petsSoldCount:0,petsSoldValue:0},pets:{hatchedByType:e},abilities:n,weather:r}}function _S(t,e){return on(t)?{normal:yt(t.normal,e.normal),gold:yt(t.gold,e.gold),rainbow:yt(t.rainbow,e.rainbow)}:{...e}}function kf(t){let e=Date.now(),n=zr(e);if(!on(t))return n;if(Object.prototype.hasOwnProperty.call(t,"createdAt")&&(n.createdAt=RS(t.createdAt,e)),on(t.garden)&&(n.garden={totalPlanted:yt(t.garden.totalPlanted,n.garden.totalPlanted),totalHarvested:yt(t.garden.totalHarvested,n.garden.totalHarvested),totalDestroyed:yt(t.garden.totalDestroyed,n.garden.totalDestroyed),watercanUsed:yt(t.garden.watercanUsed,n.garden.watercanUsed),waterTimeSavedMs:yt(t.garden.waterTimeSavedMs,n.garden.waterTimeSavedMs)}),on(t.shops)&&(n.shops={seedsBought:yt(t.shops.seedsBought,n.shops.seedsBought),decorBought:yt(t.shops.decorBought,n.shops.decorBought),eggsBought:yt(t.shops.eggsBought,n.shops.eggsBought),toolsBought:yt(t.shops.toolsBought,n.shops.toolsBought),cropsSoldCount:yt(t.shops.cropsSoldCount,n.shops.cropsSoldCount),cropsSoldValue:Ui(t.shops.cropsSoldValue,n.shops.cropsSoldValue),petsSoldCount:yt(t.shops.petsSoldCount,n.shops.petsSoldCount),petsSoldValue:Ui(t.shops.petsSoldValue,n.shops.petsSoldValue)}),on(t.pets)&&on(t.pets.hatchedByType))for(let[r,o]of Object.entries(t.pets.hatchedByType)){if(typeof r!="string")continue;let s=r.toLowerCase(),i=n.pets.hatchedByType[s]??{normal:0,gold:0,rainbow:0};n.pets.hatchedByType[s]=_S(o,i)}if(on(t.abilities))for(let[r,o]of Object.entries(t.abilities))typeof r!="string"||!on(o)||(n.abilities[r]={triggers:yt(o.triggers,n.abilities[r]?.triggers??0),totalValue:Ui(o.totalValue,n.abilities[r]?.totalValue??0)});if(on(t.weather))for(let[r,o]of Object.entries(t.weather)){if(typeof r!="string"||!on(o))continue;let s=r.toLowerCase(),i=n.weather[s]??{triggers:0};n.weather[s]={triggers:yt(o.triggers,i.triggers)}}return n}function If(){let t=Tf();if(!t)return rr||(rr=zr()),or(rr);try{let e=t.getItem(Lc);if(!e){let o=zr();return rr=or(o),o}let n=JSON.parse(e),r=kf(n);return rr=or(r),r}catch{let e=zr();return rr=or(e),e}}function Rc(t){let e=or(t);for(let n of Pc)try{n(e)}catch(r){console.error("[StatsService] Listener error",r)}}function _c(t){let e=or(t),n=Tf();if(rr=e,n)try{n.setItem(Lc,JSON.stringify(e))}catch{}return e}function Uo(t,e,n){let r=Number(t),o=Number(e),i=(Number.isFinite(r)?r:0)+(Number.isFinite(o)?o:0),a=Math.max(0,i);return n?Math.floor(a):a}function jr(t){let e=If(),n=or(e);t(n);let r=_c(n);return Rc(r),r}function LS(t,e){return t.abilities[e]||(t.abilities[e]={triggers:0,totalValue:0}),t.abilities[e]}function NS(t,e){let n=e.toLowerCase();return t.weather[n]||(t.weather[n]={triggers:0}),t.weather[n]}function OS(t,e){let n=e.toLowerCase();return t.pets.hatchedByType[n]||(t.pets.hatchedByType[n]={normal:0,gold:0,rainbow:0}),t.pets.hatchedByType[n]}var _e={storageKey:Lc,getSnapshot(){return If()},setSnapshot(t){let e=kf(t),n=_c(e);return Rc(n),n},reset(){let t=zr(),e=_c(t);return Rc(e),e},update(t){return jr(t)},incrementGardenStat(t,e=1){return jr(n=>{n.garden[t]=Uo(n.garden[t],e,kS[t])})},incrementShopStat(t,e=1){return jr(n=>{n.shops[t]=Uo(n.shops[t],e,IS[t])})},incrementPetHatched(t,e="normal",n=1){return jr(r=>{let o=OS(r,t);o[e]=Uo(o[e],n,!0)})},incrementAbilityStat(t,e,n=1){return jr(r=>{let o=LS(r,t);o[e]=Uo(o[e],n,AS[e])})},incrementWeatherStat(t,e="triggers",n=1){return jr(r=>{let o=NS(r,t);o[e]=Uo(o[e],n,MS[e])})},subscribe(t){return Pc.add(t),()=>{Pc.delete(t)}}},B_={rarityOrder:[he.Common,he.Uncommon,he.Rare,he.Legendary,he.Mythic,he.Divine,he.Celestial],createEmpty(){return zr()}};function Af(){if(!Re||!ht)return;function t(n,r){let o=r!==void 0?new ht(n,r):new ht(n);return pt.push(o),o.addEventListener("open",()=>{setTimeout(()=>{o.readyState===ht.OPEN&&Qn(o,"open-fallback")},800)}),o.addEventListener("message",async s=>{let i=await tf(s.data);i&&!e()&&(i.type==="Welcome"||i.type==="Config"||i.fullState||i.config)&&Qn(o,"message:"+(i.type||"state"))}),o}t.prototype=ht.prototype;try{t.OPEN=ht.OPEN}catch{}try{t.CLOSED=ht.CLOSED}catch{}try{t.CLOSING=ht.CLOSING}catch{}try{t.CONNECTING=ht.CONNECTING}catch{}if(Re.WebSocket=t,Re!==window)try{window.WebSocket=t}catch{}function e(){return!!Bo("quinoaWS")}BS()}var Gr=new Map,Ur=Bo("__tmMessageHookInstalled")?"installed":"idle",sn=null,Go=null;function Vt(t,e){let n=Gr.get(t);return n?n.push(e):Gr.set(t,[e]),qS(),()=>{let r=Gr.get(t);if(!r)return;let o=r.indexOf(e);o!==-1&&r.splice(o,1),r.length===0&&Gr.delete(t)}}function qS(){if(Ur==="installed"||Ur==="installing")return;Ur="installing";let t=()=>{let e=Re.MagicCircle_RoomConnection||Bo("MagicCircle_RoomConnection");if(!e)return!1;let n=QS(e);if(!n)return!1;let r=function(o,...s){let i=o;try{let a=i?.type;if(a&&Gr.size>0){let c=DS(a,i,{thisArg:this,args:s});if(c.drop)return;i=c.message}}catch(a){console.error("[MG-mod] Erreur dans le hook WS :",a)}return n.fn.call(this,i,...s)};return n.kind==="static"?e.sendMessage=r:e.prototype.sendMessage=r,Ur="installed",Mt("__tmMessageHookInstalled",!0),sn!==null&&(clearInterval(sn),sn=null),Go!==null&&(clearTimeout(Go),Go=null),!0};t()||(sn=window.setInterval(()=>{t()&&sn!==null&&(clearInterval(sn),sn=null)},200),Go=window.setTimeout(()=>{sn!==null&&(clearInterval(sn),sn=null),Ur!=="installed"&&(Ur="idle"),Go=null},2e4))}function DS(t,e,n){let r=Gr.get(t);if(!r||r.length===0)return{message:e,drop:!1};let o=e;for(let s of[...r])try{let i=s(o,n);if(!i)continue;if(i.kind==="drop")return{message:o,drop:!0};i.kind==="replace"&&(o=i.message)}catch{}return{message:o,drop:!1}}function BS(){if(Bo("__tmHarvestHookInstalled"))return;let t=null;(async()=>{try{t=await pe.data.garden.get()??null}catch{}try{await pe.data.garden.onChange(e=>{t=e??null})}catch{}})(),Vt("HarvestCrop",e=>{let n=e.slot,r=e.slotsIndex;if(!Number.isInteger(n)||!Number.isInteger(r))return;let s=t?.tileObjects,i=s?s[String(n)]:void 0;if(!i||typeof i!="object"||i.objectType!=="plant")return;let l=(Array.isArray(i.slots)?i.slots:[])[r];if(!l||typeof l!="object")return;let c=Mf(i),d=jS(l),u=Rf(l?.mutations);if((()=>{try{return dt.getState().enabled}catch{return!1}})()){let f=!0;try{f=dt.allowsHarvest({seedKey:c,sizePercent:d,mutations:u})}catch{f=!0}if(!f)return console.log("[HarvestCrop] Blocked by locker",{slot:n,slotsIndex:r,seedKey:c,sizePercent:d,mutations:u}),{kind:"drop"}}_e.incrementGardenStat("totalHarvested"),(async()=>{try{let h=(await pe.data.garden.get())?.tileObjects??null,m=h?h[String(n)]:void 0,g=Array.isArray(m?.slots)?m.slots?.[r]:void 0;console.log("[HarvestCrop]",{slot:n,slotsIndex:r,cropSlot:g})}catch(f){console.error("[HarvestCrop] Unable to log crop slot",f)}})()}),Vt("RemoveGardenObject",e=>{_e.incrementGardenStat("totalDestroyed")}),Vt("WaterPlant",e=>{_e.incrementGardenStat("watercanUsed"),_e.incrementGardenStat("waterTimeSavedMs",5*60*1e3)}),Vt("PlantSeed",e=>{_e.incrementGardenStat("totalPlanted")}),Vt("PurchaseDecor",e=>{_e.incrementShopStat("decorBought")}),Vt("PurchaseSeed",e=>{_e.incrementShopStat("seedsBought")}),Vt("PurchaseEgg",e=>{_e.incrementShopStat("eggsBought")}),Vt("PurchaseTool",e=>{_e.incrementShopStat("toolsBought")}),Vt("HatchEgg",()=>{(async()=>{let e=await Oc(),n=KS(e),r=await $S(n);if(!r)return;let o=VS(r,n);if(o.length)for(let s of o){let i=YS(s.mutations);s.species&&_e.incrementPetHatched(s.species,i)}})()}),Vt("SellAllCrops",e=>{(async()=>{try{let n=await pe.inventory.myCropItemsToSell.get(),r=Array.isArray(n)?n.length:0;r>0&&_e.incrementShopStat("cropsSoldCount",r)}catch(n){console.error("[SellAllCrops] Unable to read crop items",n)}try{let n=await pe.shop.totalCropSellPrice.get(),r=Number(n);Number.isFinite(r)&&r>0&&_e.incrementShopStat("cropsSoldValue",r)}catch(n){console.error("[SellAllCrops] Unable to read crop sell price",n)}})()}),Vt("SellPet",e=>{_e.incrementShopStat("petsSoldCount"),(async()=>{try{let n=await pe.pets.totalPetSellPrice.get(),r=Number(n);Number.isFinite(r)&&r>0&&_e.incrementShopStat("petsSoldValue",r)}catch(n){console.error("[SellPet] Unable to read pet sell price",n)}})()}),Mt("__tmHarvestHookInstalled",!0)}function Mf(t){if(!t||typeof t!="object")return null;if(typeof t.seedKey=="string"&&t.seedKey)return t.seedKey;if(typeof t.species=="string"&&t.species)return t.species;let e=["seedSpecies","plantSpecies","cropSpecies","speciesId"];for(let n of e){let r=t[n];if(typeof r=="string"&&r)return r}return null}var Pf=t=>t.toLowerCase().replace(/['’`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),FS=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=Pf(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(Be)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})();function HS(t){if(typeof t!="string")return null;let e=Pf(t.trim());if(!e)return null;let n=FS.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null}function WS(t){if(!t||typeof t!="object")return null;let e=new Set,n=Mf(t);n&&e.add(n);let r=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"];for(let o of r){let s=t[o];typeof s=="string"&&s&&e.add(s)}for(let o of e){let s=HS(o);if(typeof s=="number"&&Number.isFinite(s)&&s>0)return s}return null}function jS(t){if(!t||typeof t!="object")return 100;let e=Number(t.sizePercent??t.sizePct??t.size??t.percent??t.progressPercent);if(Number.isFinite(e))return Gi(Math.round(e),0,100);let n=Number(t.targetScale??t.scale);if(Number.isFinite(n)){let r=WS(t);if(typeof r=="number"&&Number.isFinite(r)&&r>1){let i=50+(Math.max(1,Math.min(r,n))-1)/(r-1)*50;return Gi(Math.round(i),50,100)}if(n>1&&n<=2){let s=50+(n-1)/1*50;return Gi(Math.round(s),50,100)}let o=Math.round(n*100);return Gi(o,0,100)}return 100}function Rf(t){if(!Array.isArray(t))return[];let e=[];for(let n=0;n<t.length;n++){let r=t[n];if(typeof r=="string")r&&e.push(r);else if(r!=null){let o=String(r);o&&e.push(o)}}return e}function Gi(t,e,n){return Math.max(e,Math.min(n,t))}var zS=5e3;async function Oc(){try{let t=await pe.inventory.myInventory.get();return _f(t)}catch(t){return console.error("[HatchEgg] Unable to read inventory",t),[]}}function _f(t){let e=US(t),n=[];for(let r of e){let o=GS(r);o&&n.push(o)}return n}function US(t){return t?Array.isArray(t)?t:Array.isArray(t.items)?t.items:Array.isArray(t.inventory)?t.inventory:Array.isArray(t.inventory?.items)?t.inventory.items:[]:[]}function GS(t){if(!t||typeof t!="object")return null;let e=t.item&&typeof t.item=="object"?t.item:t;if(!e||typeof e!="object")return null;let n=e.itemType??e.data?.itemType??"";if(String(n).toLowerCase()!=="pet")return null;let r=e.id??e.data?.id,o=e.petSpecies??e.data?.petSpecies;if(!r||!o)return null;let s=Rf(e.mutations??e.data?.mutations);return{id:String(r),species:String(o),mutations:s}}function KS(t){let e=new Map;for(let n of t)e.set(n.id,n);return e}function VS(t,e){return t.filter(n=>!e.has(n.id))}function YS(t){if(!Array.isArray(t)||t.length===0)return"normal";let e=new Set(t.map(n=>String(n).toLowerCase()));return e.has("rainbow")?"rainbow":e.has("gold")||e.has("golden")?"gold":"normal"}async function $S(t,e=zS){await JS(0);let n=await Oc();return Nc(n,t)?n:new Promise(async r=>{let o=!1,s=null,i=null,a=c=>{if(!o){if(o=!0,i!==null&&clearTimeout(i),s)try{s()}catch{}r(c)}},l=c=>{let d=_f(c);Nc(d,t)&&a(d)};try{s=await pe.inventory.myInventory.onChange(c=>{l(c)})}catch(c){console.error("[HatchEgg] Unable to observe inventory",c),a(null);return}i=setTimeout(()=>{(async()=>{let c=await Oc();Nc(c,t)?a(c):a(null)})()},e)})}function Nc(t,e){return t.some(n=>!e.has(n.id))}function JS(t){return new Promise(e=>setTimeout(e,t))}function QS(t){let e=n=>typeof n=="function";return e(t.sendMessage)?{kind:"static",fn:t.sendMessage.bind(t)}:t.prototype&&e(t.prototype.sendMessage)?{kind:"proto",fn:t.prototype.sendMessage}:null}function ZS(t){if(Ni.forEach)Ni.forEach(e=>{try{e.postMessage(t)}catch{}});else for(let e of Ni._a)try{e.postMessage(t)}catch{}}function XS(){if(yn&&yn.readyState===ht.OPEN)return yn;let t=null;if(pt.find&&(t=pt.find(e=>e.readyState===ht.OPEN)||null),!t){for(let e=0;e<pt.length;e++)if(pt[e].readyState===ht.OPEN){t=pt[e];break}}if(t)return Qn(t,"getPageWS"),t;throw new Error("No page WebSocket open")}function Ve(t){let e={scopePath:["Room","Quinoa"],...t};try{return XS().send(JSON.stringify(e)),!0}catch{return ZS({__QWS_CMD:"send",payload:JSON.stringify(e)}),!0}}function Lf(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}function qc(t,e){let n=t?.tileObjects??{},r=e?.tileObjects??{},o=[],s=[],i=[],a=[],l=new Set;for(let c of Object.keys(r))l.add(c),c in n?Lf(n[c])!==Lf(r[c])&&(s.push(+c),a.push({kind:"updated",slot:+c,prev:n[c],next:r[c]})):(o.push(+c),a.push({kind:"added",slot:+c,next:r[c]}));for(let c of Object.keys(n))l.has(c)||(i.push(+c),a.push({kind:"removed",slot:+c,prev:n[c]}));return{added:o,updated:s,removed:i,changes:a}}function ex(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",o=e.name??"",s=e.petSpecies??"",i=Number.isFinite(e.xp)?Math.round(e.xp):0,a=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,l=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,c=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,d=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${o}|xp:${i}|hg:${a}|sc:${l}|m:${n}|a:${r}|pos:${c},${d}`}function Ko(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=String(r?.slot?.id??"");o&&e.set(o,ex(r))}return e}function Dc(t,e){let n=[],r=[],o=[],s=[];for(let[i,a]of e)t.has(i)?t.get(i)!==a&&(r.push(i),s.push({kind:"updated",id:i})):(n.push(i),s.push({kind:"added",id:i}));for(let i of t.keys())e.has(i)||(o.push(i),s.push({kind:"removed",id:i}));return{added:n,updated:r,removed:o,changes:s}}function tx(t){let e=Array.isArray(t.mutations)?t.mutations.slice().sort().join(","):"",n=Number.isFinite(t.scale)?Math.round(t.scale*1e3):0;return`${t.species??""}|${t.itemType??""}|${n}|${e}`}function Vo(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=String(r?.id??"");o&&e.set(o,tx(r))}return e}function Bc(t,e){let n=[],r=[],o=[],s=[];for(let[i,a]of e)t.has(i)?t.get(i)!==a&&(r.push(i),s.push({kind:"updated",key:i})):(n.push(i),s.push({kind:"added",key:i}));for(let i of t.keys())e.has(i)||(o.push(i),s.push({kind:"removed",key:i}));return{added:n,updated:r,removed:o,changes:s}}var Se={getPosition(){return pe.player.position.get()},onPosition(t){return pe.player.position.onChange(t)},onPositionNow(t){return pe.player.position.onChangeNow(t)},async setPosition(t,e){await pe.player.position.set({x:t,y:e})},async teleport(t,e){try{await this.setPosition(t,e)}catch{}try{Ve({type:"Teleport",position:{x:t,y:e}})}catch{}},async move(t,e){try{await this.setPosition(t,e)}catch{}try{Ve({type:"PlayerPosition",position:{x:t,y:e}})}catch{}},async plantSeed(t,e){try{Ve({type:"PlantSeed",slot:t,species:e})}catch{}},async sellAllCrops(){try{Ve({type:"SellAllCrops"})}catch{}},async sellPet(t){try{Ve({type:"SellPet",itemId:t})}catch{}},async removeGardenObject(t,e){try{Ve({type:"RemoveGardenObject",slot:t,slotType:e})}catch{}},async waterPlant(t){try{Ve({type:"WaterPlant",slot:t})}catch{}},async setSelectedItem(t){try{Ve({type:"SetSelectedItem",itemIndex:t})}catch{}},async pickupObject(){try{Ve({type:"PickupObject"})}catch{}},async dropObject(){try{Ve({type:"DropObject"})}catch{}},async harvestCrop(t,e){try{Ve({type:"HarvestCrop",slot:t,slotsIndex:e})}catch{}},async feedPet(t,e){try{Ve({type:"FeedPet",petItemId:t,cropItemId:e})}catch{}},async hatchEgg(t){try{Ve({type:"HatchEgg",slot:t})}catch{}},async placeDecor(t,e,n){try{Ve({type:"PlaceDecor",tileType:t,localTileIndex:e,decorId:n})}catch{}},async swapPet(t,e){try{Ve({type:"SwapPet",petSlotId:t,petInventoryId:e})}catch{}},async placePet(t,e,n,r){try{Ve({type:"PlacePet",itemId:t,position:e,tileType:n,localTileIndex:r})}catch{}},async petPositions(t){let e=Object.entries(t??{});if(!e.length)return;let n={};for(let[o,s]of e){let i=Number(s?.x),a=Number(s?.y);!Number.isFinite(i)||!Number.isFinite(a)||(n[String(o)]={x:i,y:a})}if(Object.keys(n).length)try{Ve({type:"PetPositions",petPositions:n})}catch{}},async storePet(t){try{Ve({type:"StorePet",itemId:t})}catch{}},async wish(t){try{Ve({type:"Wish",itemId:t})}catch{}},async purchaseSeed(t){try{Ve({type:"PurchaseSeed",species:t})}catch{}},async purchaseDecor(t){try{Ve({type:"PurchaseDecor",decorId:t})}catch{}},async purchaseEgg(t){try{Ve({type:"PurchaseEgg",eggId:t})}catch{}},async purchaseTool(t){try{Ve({type:"PurchaseTool",toolId:t})}catch{}},async triggerAnimation(t,e){pe.player.avatarTriggerAnimationAtom.set({playerId:t,animation:e})},async toggleFavoriteItem(t){try{Ve({type:"ToggleFavoriteItem",itemId:t})}catch{}},async getFavoriteIds(){let t=await pe.inventory.favoriteIds.get();return Array.isArray(t)?t.slice():[]},async getFavoriteIdSet(){return Wo()},async isFavoriteItem(t){return(await Wo()).has(t)},async ensureFavoriteItem(t,e){let n=await this.isFavoriteItem(t);return n!==e?(await this.toggleFavoriteItem(t),e):n},async ensureFavorites(t,e){let n=await Wo();for(let r of t)if(n.has(r)!==e)try{await this.toggleFavoriteItem(r)}catch{}},onFavoriteIdsChange(t){return Ho(e=>t(Array.isArray(e)?e:[]))},async onFavoriteIdsChangeNow(t){return pf(e=>t(Array.isArray(e)?e:[]))},onFavoriteSetChange(t){return Ho(e=>t(new Set(Array.isArray(e)?e:[])))},async onFavoriteSetChangeNow(t){let e=await Wo();return t(e),Ho(n=>t(new Set(Array.isArray(n)?n:[])))},async getGardenState(){return await pe.data.garden.get()??null},onGardenChange(t){return pe.data.garden.onChange(t)},onGardenChangeNow(t){return pe.data.garden.onChangeNow(t)},onGardenDiff(t){let e=null;return pe.data.garden.onChange(n=>{let r=qc(e,n);(r.added.length||r.updated.length||r.removed.length||n!==e)&&(e=n,t(n,r))})},async onGardenDiffNow(t){let e=await pe.data.garden.get()??null;return t(e,qc(null,e)),pe.data.garden.onChange(n=>{let r=qc(e,n);(r.added.length||r.updated.length||r.removed.length)&&(e=n,t(n,r))})},async getPets(){let t=await pe.pets.myPetInfos.get();return Array.isArray(t)?t:null},onPetsChange(t){let e=null;return pe.pets.myPetInfos.onChange(n=>{n!==e&&(e=n,t(e))})},async onPetsChangeNow(t){let e=await this.getPets();return t(e),pe.pets.myPetInfos.onChange(n=>{n!==e&&(e=n,t(e))})},onPetsDiff(t){let e=Ko(null);return pe.pets.myPetInfos.onChange(n=>{let r=Ko(n),o=Dc(e,r);(o.added.length||o.updated.length||o.removed.length)&&(t(n,o),e=r)})},async onPetsDiffNow(t){let e=await this.getPets(),n=Ko(null),r=Ko(e),o=Dc(n,r);return t(e,o),n=r,pe.pets.myPetInfos.onChange(s=>{r=Ko(s);let i=Dc(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getCropInventoryState(){return pe.inventory.myCropInventory.get()},onCropInventoryChange(t){let e=null;return pe.inventory.myCropInventory.onChange(n=>{n!==e&&(e=n,t(n))})},async onCropInventoryChangeNow(t){let e=await pe.inventory.myCropInventory.get();return t(e),pe.inventory.myCropInventory.onChange(n=>{n!==e&&(e=n,t(n))})},onCropInventoryDiff(t){let e=Vo(null);return pe.inventory.myCropInventory.onChange(n=>{let r=Vo(n),o=Bc(e,r);(o.added.length||o.updated.length||o.removed.length)&&(t(n,o),e=r)})},async onCropInventoryDiffNow(t){let e=await pe.inventory.myCropInventory.get(),n=Vo(null),r=Vo(e),o=Bc(n,r);return t(e,o),n=r,pe.inventory.myCropInventory.onChange(s=>{r=Vo(s);let i=Bc(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getNumPlayers(){let t=await pe.server.numPlayers.get();return typeof t=="number"?t:0},onNumPlayersChange(t){let e;return pe.server.numPlayers.onChange(n=>{n!==e&&(e=n,t(n))})},async onNumPlayersChangeNow(t){let e=await this.getNumPlayers();return t(e),pe.server.numPlayers.onChange(n=>{n!==e&&(e=n,t(n))})}};var Fc=new Map;function nx(t){try{return Br(new RegExp("^"+t+"$"))}catch{return[]}}function rx(t){if(t&&typeof t.read=="function")return"read";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="write"&&e!=="onMount"&&e!=="toString"){let r=n.length;if(r===1||r===2)return e}}throw new Error("Impossible de localiser la fonction read() de l'atom")}function ox(t){return Fc.get(t)||null}async function sx(t){!t?.closeAction||!t?.openAction||(await t.closeAction(),await new Promise(e=>setTimeout(e,0)),await t.openAction())}async function ix(t){let e=t.label,n=Fc.get(e);if(n?.installed)return n;let r=nx(t.label);if(!r.length)throw new Error(`${t.label} introuvable`);let o=n??{config:t,enabled:!1,payload:null,patched:new Map,installed:!1},s=null;t.gate?.label&&(s=kt(t.gate.label));for(let i of r){let a=rx(i),l=i[a];i[a]=c=>{try{s&&c(s)}catch{}for(let u of t.extraDeps||[])try{let p=kt(u);p&&c(p)}catch{}let d=l(c);return!o.enabled||o.payload==null?d:t.merge?t.merge(d,o.payload):o.payload},o.patched.set(i,{readKey:a,orig:l})}return s&&t.gate?.autoDisableOnClose&&(o.unsubGate=await Xn(s,async()=>{let i;try{i=await Ht(s)}catch{i=null}!(t.gate?.isOpen?t.gate.isOpen(i):!!i)&&o.enabled&&(o.enabled=!1)})),o.installed=!0,Fc.set(e,o),o}async function Ki(t,e,n){await St();let r=await ix(t);r.payload=e,r.enabled=!0,n?.merge&&!t.merge&&(t.merge=(o,s)=>s),n?.openGate&&t.gate?.openAction&&await t.gate.openAction(),r.autoTimer&&(clearTimeout(r.autoTimer),r.autoTimer=null),n?.autoRestoreMs&&n.autoRestoreMs>0&&(r.autoTimer=setTimeout(()=>{Yo(t.label)},n.autoRestoreMs))}async function Yo(t){let e=ox(t);e&&(e.enabled=!1,e.payload=null,e.autoTimer&&(clearTimeout(e.autoTimer),e.autoTimer=null),await sx(e.config.gate))}async function Nf(t){try{await pe.ui.activeModal.set(t)}catch{}}async function ax(t){try{await pe.ui.activeModal.set(null)}catch{}}function Hc(t,e){return t===e}async function Of(t){try{let e=await pe.ui.activeModal.get();return Hc(e,t)}catch{return!1}}async function qf(t,e=12e4){let n=performance.now();for(;performance.now()-n<e;){try{let r=await pe.ui.activeModal.get();if(!Hc(r,t))return!0}catch{return!0}await new Promise(r=>setTimeout(r,80))}return!1}var Wc={label:pe.data.myData.label,merge:(t,e)=>({...t&&typeof t=="object"?t:{},...e&&typeof e=="object"?e:{}}),gate:{label:pe.ui.activeModal.label,isOpen:t=>t==="inventory"||t==="journal",autoDisableOnClose:!0}},jc={label:pe.inventory.myInventory.label,merge:(t,e)=>e,gate:{label:pe.ui.activeModal.label,isOpen:t=>t==="inventory",autoDisableOnClose:!0}},$o="inventory";async function lx(){return Nf($o)}async function Rn(){return ax($o)}function Vi(t){return Hc(t,$o)}async function Yi(){return Of($o)}async function $i(t=12e4){return qf($o,t)}async function Wt(t,e){let n=e?.open!==!1;await Ki(Wc,{inventory:t},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),await Ki(jc,t,{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await lx()}async function Df(){await Yo(jc.label),await Yo(Wc.label),await Rn()}var zc="journal";async function cx(){return Nf(zc)}async function Bf(){return Of(zc)}async function Ff(t=12e4){return qf(zc,t)}async function Jo(t,e){let n=e?.open!==!1;await Yo(jc.label),await Ki(Wc,{journal:t??{}},{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await cx()}var Ye=class{constructor(e={}){this.opts=e;ce(this,"root");ce(this,"tabBar");ce(this,"views");ce(this,"tabs",new Map);ce(this,"events",new Map);ce(this,"currentId",null);ce(this,"lsKeyActive");ce(this,"_altDown",!1);ce(this,"_insertDown",!1);ce(this,"_hovering",!1);ce(this,"_onKey",e=>{(e.code==="Insert"||e.key==="Insert")&&(this._insertDown=e.type==="keydown");let n=e.altKey||this._insertDown;n!==this._altDown&&(this._altDown=n,this._updateAltCursor())});ce(this,"_onBlur",()=>{this._altDown=!1,this._insertDown=!1,this._updateAltCursor()});ce(this,"_onEnter",()=>{this._hovering=!0,this._updateAltCursor()});ce(this,"_onLeave",()=>{this._hovering=!1,this._updateAltCursor()});this.lsKeyActive=`menu:${e.id||"default"}:activeTab`}mount(e){if(this.ensureStyles(),e.innerHTML="",this.root=Ke("div",`qmm ${this.opts.classes||""} ${this.opts.compact?"qmm-compact":""}`),this.opts.startHidden&&(this.root.style.display="none"),this.tabBar=Ke("div","qmm-tabs"),this.views=Ke("div","qmm-views"),this.root.appendChild(this.tabBar),this.root.appendChild(this.views),e.appendChild(this.root),this.tabs.size){for(let[n,r]of this.tabs)this.createTabView(n,r);this.restoreActive()}this.updateTabsBarVisibility(),this.root.addEventListener("pointerenter",this._onEnter),this.root.addEventListener("pointerleave",this._onLeave),window.addEventListener("keydown",this._onKey,!0),window.addEventListener("keyup",this._onKey,!0),window.addEventListener("blur",this._onBlur),document.addEventListener("visibilitychange",this._onBlur),this.opts.startWindowHidden&&this.setWindowVisible(!1),this.emit("mounted")}unmount(){this.root?.removeEventListener("pointerenter",this._onEnter),this.root?.removeEventListener("pointerleave",this._onLeave),window.removeEventListener("keydown",this._onKey,!0),window.removeEventListener("keyup",this._onKey,!0),window.removeEventListener("blur",this._onBlur),document.removeEventListener("visibilitychange",this._onBlur),this.root?.parentElement&&this.root.parentElement.removeChild(this.root),this.emit("unmounted")}getWindowEl(){if(!this.root)return null;let e=this.opts.windowSelector||".qws-win";return this.root.closest(e)}setWindowVisible(e){let n=this.getWindowEl();n&&(n.classList.toggle("is-hidden",!e),this.emit(e?"window:show":"window:hide"))}toggleWindow(){let e=this.getWindowEl();if(!e)return!1;let n=e.classList.contains("is-hidden");return this.setWindowVisible(n),n}isWindowVisible(){let e=this.getWindowEl();return e?!e.classList.contains("is-hidden")&&getComputedStyle(e).display!=="none":!0}setVisible(e){this.root&&(this.root.style.display=e?"":"none",this.emit(e?"show":"hide"))}toggle(){if(!this.root)return!1;let e=this.root.style.display==="none";return this.setVisible(e),e}addTab(e,n,r){return this.tabs.set(e,{title:n,render:r,badge:null}),this.root&&(this.createTabView(e,this.tabs.get(e)),this.updateTabsBarVisibility()),this}addTabs(e){return e.forEach(n=>this.addTab(n.id,n.title,n.render)),this}setTabTitle(e,n){let r=this.tabs.get(e);if(r&&(r.title=n,r.btn)){let o=r.btn.querySelector(".label");o&&(o.textContent=n)}}setTabBadge(e,n){let r=this.tabs.get(e);!r||!r.btn||(r.badge||(r.badge=document.createElement("span"),r.badge.className="badge",r.btn.appendChild(r.badge)),n==null||n===""?r.badge.style.display="none":(r.badge.textContent=n,r.badge.style.display=""))}refreshTab(e){let n=this.tabs.get(e);if(!n?.view)return;let r=this.findScrollableAncestor(n.view),o=r?r.scrollTop:null,s=r?r.scrollLeft:null,i=document.activeElement?.id||null;n.view.innerHTML="";try{n.render(n.view,this)}catch(a){n.view.textContent=String(a)}this.currentId===e&&this.switchTo(e),this.emit("tab:render",e),r&&o!=null&&requestAnimationFrame(()=>{try{r.scrollTop=o,r.scrollLeft=s??0}catch{}if(i){let a=document.getElementById(i);if(a&&a.focus)try{a.focus()}catch{}}})}findScrollableAncestor(e){function n(o){let s=getComputedStyle(o),i=s.overflowY||s.overflow;return/(auto|scroll)/.test(i)&&o.scrollHeight>o.clientHeight}let r=e;for(;r;){if(n(r))return r;r=r.parentElement}return document.querySelector(".qws-win")}firstTabId(){let e=this.tabs.keys().next();return e.done?null:e.value??null}_updateAltCursor(){this.root&&this.root.classList.toggle("qmm-alt-drag",this._altDown&&this._hovering)}getTabView(e){return this.tabs.get(e)?.view??null}removeTab(e){let n=this.tabs.get(e);if(!n)return;this.tabs.delete(e);let r=this.tabBar?.querySelector(`button[data-id="${Wf(e)}"]`);if(r&&r.parentElement&&r.parentElement.removeChild(r),n.view&&n.view.parentElement&&n.view.parentElement.removeChild(n.view),this.currentId===e){let o=this.tabs.keys().next().value||null;this.switchTo(o)}this.updateTabsBarVisibility()}switchTo(e){this.currentId=e,[...this.tabBar.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),[...this.views.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),this.persistActive(),this.emit("tab:change",e)}on(e,n){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(n),()=>this.off(e,n)}off(e,n){this.events.get(e)?.delete(n)}emit(e,...n){this.events.get(e)?.forEach(r=>{try{r(...n)}catch{}})}btn(e,n){let r=typeof n=="function"?{onClick:n}:{...n||{}},o=Ke("button","qmm-btn");o.type="button";let s=null;r.icon&&(s=typeof r.icon=="string"?document.createElement("span"):r.icon,typeof r.icon=="string"&&s&&(s.textContent=r.icon),s&&s.classList.add("qmm-btn__icon"));let i=(e??"").trim(),l=!s||i.length>0?document.createElement("span"):null;l&&(l.className="label",l.textContent=e),s?(i.length===0&&o.classList.add("qmm-btn--icon"),r.iconPosition==="right"?(s.classList.add("is-right"),l&&o.append(l),o.append(s)):(s.classList.add("is-left"),o.append(s),l&&o.append(l))):l&&o.append(l);let c=r.variant&&r.variant!=="default"?r.variant:null;return c&&o.classList.add(`qmm-btn--${c}`),r.fullWidth&&o.classList.add("qmm-btn--full"),r.size==="sm"&&o.classList.add("qmm-btn--sm"),r.active&&o.classList.add("active"),(r.tooltip||r.title)&&(o.title=r.tooltip||r.title||""),r.ariaLabel&&o.setAttribute("aria-label",r.ariaLabel),r.onClick&&o.addEventListener("click",r.onClick),r.disabled&&this.setButtonEnabled(o,!1),o.setEnabled=d=>this.setButtonEnabled(o,d),o.setActive=d=>o.classList.toggle("active",!!d),o}setButtonEnabled(e,n){e.disabled=!n,e.classList.toggle("is-disabled",!n),e.setAttribute("aria-disabled",(!n).toString())}flexRow(e={}){let n=document.createElement("div");return n.className=["qmm-flex",e.className||""].filter(Boolean).join(" ").trim(),n.style.display="flex",n.style.alignItems=this.mapAlign(e.align??"center"),n.style.justifyContent=this.mapJustify(e.justify??"start"),n.style.gap=`${e.gap??8}px`,n.style.flexWrap=e.wrap===!1?"nowrap":"wrap",e.fullWidth&&(n.style.width="100%"),n}formGrid(e={}){let n=document.createElement("div");return n.className="qmm-form-grid",n.style.display="grid",n.style.gridTemplateColumns=e.columns||"max-content 1fr",n.style.columnGap=`${e.columnGap??8}px`,n.style.rowGap=`${e.rowGap??8}px`,n.style.alignItems=e.align?e.align:"center",n}formRow(e,n,r={}){let o=document.createElement("div");o.className="qmm-form-row",o.style.display="grid",o.style.gridTemplateColumns=`${r.labelWidth||"160px"} 1fr`,o.style.columnGap=`${r.gap??10}px`,o.style.alignItems=r.alignTop?"start":"center",r.wrap&&o.classList.add("is-wrap");let s=this.label(e);return s.classList.add("qmm-form-row__label"),s.style.margin="0",s.style.justifySelf="start",r.alignTop&&(s.style.alignSelf="start"),o.append(s,n),{root:o,label:s}}card(e,n={}){let r=document.createElement("div");if(r.className="qmm-card",r.dataset.tone=n.tone||"default",n.align==="center"&&r.classList.add("is-center"),n.align==="stretch"&&r.classList.add("is-stretch"),n.padding&&(r.style.padding=n.padding),n.gap!=null&&(r.style.gap=`${n.gap}px`),n.maxWidth){let a=typeof n.maxWidth=="number"?`${n.maxWidth}px`:n.maxWidth;r.style.width=`min(${a}, 100%)`}let o=document.createElement("div");o.className="qmm-card__header",n.compactHeader&&o.classList.add("is-compact");let s=document.createElement("div");if(s.className="qmm-card__title",s.textContent=e,n.icon){let a=typeof n.icon=="string"?document.createElement("span"):n.icon;typeof n.icon=="string"&&a&&(a.textContent=n.icon),a&&(a.classList.add("qmm-card__icon"),o.appendChild(a))}if(o.appendChild(s),n.subtitle||n.description){let a=document.createElement("div");a.className="qmm-card__subtitle",a.textContent=n.subtitle||n.description||"",o.appendChild(a)}if(n.actions?.length){let a=document.createElement("div");a.className="qmm-card__actions",n.actions.forEach(l=>a.appendChild(l)),o.appendChild(a)}let i=document.createElement("div");return i.className="qmm-card__body",r.append(o,i),{root:r,header:o,body:i,setTitle(a){s.textContent=a}}}toggleChip(e,n={}){let r=document.createElement("label");r.className="qmm-chip-toggle",n.tooltip&&(r.title=n.tooltip);let o=document.createElement("input");o.type=n.type||"checkbox",n.name&&(o.name=n.name),n.value&&(o.value=n.value),o.checked=!!n.checked;let s=document.createElement("div");if(s.className="qmm-chip-toggle__face",n.icon){let a=typeof n.icon=="string"?document.createElement("span"):n.icon;typeof n.icon=="string"&&a&&(a.textContent=n.icon),a&&(a.classList.add("qmm-chip-toggle__icon"),s.appendChild(a))}let i=document.createElement("span");if(i.className="qmm-chip-toggle__label",i.textContent=e,s.appendChild(i),n.description){let a=document.createElement("span");a.className="qmm-chip-toggle__desc",a.textContent=n.description,s.appendChild(a)}if(n.badge){let a=document.createElement("span");a.className="qmm-chip-toggle__badge",a.textContent=n.badge,s.appendChild(a)}return r.append(o,s),{root:r,input:o,label:i}}select(e={}){let n=document.createElement("select");if(n.className="qmm-input qmm-select",e.id&&(n.id=e.id),e.width&&(n.style.minWidth=e.width),e.placeholder){let r=document.createElement("option");r.value="",r.textContent=e.placeholder,r.disabled=!0,r.selected=!0,n.appendChild(r)}return n}errorBar(){let e=document.createElement("div");return e.className="qmm-error",e.style.display="none",{el:e,show(n){e.textContent=n,e.style.display="block"},clear(){e.textContent="",e.style.display="none"}}}mapAlign(e){return e==="start"?"flex-start":e==="end"?"flex-end":e==="stretch"?"stretch":"center"}mapJustify(e){return e==="center"?"center":e==="end"?"flex-end":e==="between"?"space-between":e==="around"?"space-around":"flex-start"}label(e){let n=Ke("label","qmm-label");return n.textContent=e,n}row(...e){let n=Ke("div","qmm-row");return e.forEach(r=>n.appendChild(r)),n}section(e){let n=Ke("div","qmm-section");return n.appendChild(Ke("div","qmm-section-title",Gc(e))),n}inputNumber(e=0,n=9999,r=1,o=0){let s=Ke("div","qmm-input-number"),i=Ke("input","qmm-input qmm-input-number-input");i.type="number",i.min=String(e),i.max=String(n),i.step=String(r),i.value=String(o),i.inputMode="numeric";let a=Ke("div","qmm-spin"),l=Ke("button","qmm-step qmm-step--up","\u25B2"),c=Ke("button","qmm-step qmm-step--down","\u25BC");l.type=c.type="button";let d=()=>{let f=Number(i.value);if(Number.isFinite(f)){let h=Number(i.min),m=Number(i.max),g=Math.max(h,Math.min(m,f));g!==f&&(i.value=String(g))}},u=f=>{f<0?i.stepDown():i.stepUp(),d(),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))},p=(f,h)=>{let m=null,g=null,y=!1,v=x=>{y=!1,m=window.setTimeout(()=>{y=!0,u(h),g=window.setInterval(()=>u(h),60)},300),f.setPointerCapture?.(x.pointerId)},w=()=>{m!=null&&(clearTimeout(m),m=null),g!=null&&(clearInterval(g),g=null)};f.addEventListener("pointerdown",v),["pointerup","pointercancel","pointerleave","blur"].forEach(x=>f.addEventListener(x,w)),f.addEventListener("click",x=>{if(y){x.preventDefault(),x.stopPropagation(),y=!1;return}u(h)})};return p(l,1),p(c,-1),i.addEventListener("change",d),a.append(l,c),s.append(i,a),i.wrap=s,i}inputText(e="",n=""){let r=Ke("input","qmm-input");return r.type="text",r.placeholder=e,r.value=n,r}checkbox(e=!1){let n=Ke("input","qmm-check");return n.type="checkbox",n.checked=e,n}radio(e,n,r=!1){let o=Ke("input","qmm-radio");return o.type="radio",o.name=e,o.value=n,o.checked=r,o}slider(e=0,n=100,r=1,o=0){let s=Ke("input","qmm-range");return s.type="range",s.min=String(e),s.max=String(n),s.step=String(r),s.value=String(o),s}rangeDual(e=0,n=100,r=1,o=e,s=n){let i=Ke("div","qmm-range-dual"),a=Ke("div","qmm-range-dual-track"),l=Ke("div","qmm-range-dual-fill");a.appendChild(l),i.appendChild(a);let c=(h,m)=>{let g=this.slider(e,n,r,h);return g.classList.add("qmm-range-dual-input",m),i.appendChild(g),g},d=c(o,"qmm-range-dual-input--min"),u=c(s,"qmm-range-dual-input--max"),p=()=>{let h=Number(d.value),m=Number(u.value),g=n-e;if(!Number.isFinite(g)||g<=0){l.style.left="0%",l.style.right="100%";return}let y=x=>Math.max(0,Math.min(100,x)),v=(Math.min(h,m)-e)/g*100,w=(Math.max(h,m)-e)/g*100;l.style.left=`${y(v)}%`,l.style.right=`${y(100-w)}%`};d.addEventListener("input",p),u.addEventListener("input",p);let f={root:i,min:d,max:u,setValues(h,m){d.value=String(h),u.value=String(m),p()},refresh:p};return f.refresh(),f}switch(e=!1){let n=this.checkbox(e);return n.classList.add("qmm-switch"),n}table(e,n){let r=document.createElement("div");r.className="qmm-table-wrap",n?.minimal&&r.classList.add("qmm-table-wrap--minimal");let o=document.createElement("div");o.className="qmm-table-scroll",n?.maxHeight&&(o.style.maxHeight=n.maxHeight),r.appendChild(o);let s=document.createElement("table");s.className="qmm-table",n?.minimal&&s.classList.add("qmm-table--minimal"),n?.compact&&s.classList.add("qmm-table--compact"),n?.fixed&&(s.style.tableLayout="fixed");let i=document.createElement("thead"),a=document.createElement("tr");e.forEach(c=>{let d=document.createElement("th");typeof c=="string"?d.textContent=c:(d.textContent=c.label??"",c.align&&d.classList.add(`is-${c.align}`),c.width&&(d.style.width=c.width)),a.appendChild(d)}),i.appendChild(a);let l=document.createElement("tbody");return s.append(i,l),o.appendChild(s),{root:r,tbody:l}}segmented(e,n,r,o){let s=document.createElement("div");s.className="qmm-seg",o?.fullWidth&&s.classList.add("qmm-seg--full"),o?.id&&(s.id=o.id),s.setAttribute("role","radiogroup"),o?.ariaLabel&&s.setAttribute("aria-label",o.ariaLabel);let i=document.createElement("div");i.className="qmm-seg__indicator",s.appendChild(i);let a=typeof window<"u"&&"matchMedia"in window?window.matchMedia("(prefers-reduced-motion: reduce)"):null,l=typeof i.animate=="function";l&&(i.style.transition="none");let c=null,d=null,u=(v,w)=>{i.style.transform=`translate3d(${v}px,0,0)`,i.style.width=`${w}px`},p=()=>{d&&(d.cancel(),d=null)},f=n,h=[],m=(v,w=!1)=>{if(v===f){w&&h.find(E=>E.dataset.value===v)?.focus(),r?.(f);return}f=v;for(let x of h){let E=x.dataset.value===v;x.setAttribute("aria-checked",E?"true":"false"),x.tabIndex=E?0:-1,x.classList.toggle("active",E),E&&w&&x.focus()}g(!0),r?.(f)},g=(v=!1)=>{let w=h.find(Z=>Z.dataset.value===f);if(!w)return;let x=h.indexOf(w),E=h.length,L=getComputedStyle(s),P=parseFloat(L.gap||L.columnGap||"0")||0,V=parseFloat(L.borderLeftWidth||"0")||0,z=parseFloat(L.borderRightWidth||"0")||0,C=s.getBoundingClientRect(),D=w.getBoundingClientRect(),S=D.left-C.left-V,G=D.width,se=C.width-V-z;if(E===1)S=0,G=se;else if(x===0){let Z=S+G+P/2;S=0,G=Z-S}else x===E-1?(S=S-P/2,G=se-S):(S=S-P/2,G=G+P);let X=window.devicePixelRatio||1,ue=Z=>Math.round(Z*X)/X,N=ue(S),ee=ue(G),q=c;c={left:N,width:ee};let A=()=>u(N,ee);if(!(v&&l&&!a?.matches&&q!=null&&q.width>0&&Number.isFinite(q.width)&&ee>0&&Number.isFinite(ee))){p(),A();return}p(),u(q.left,q.width),d=i.animate([{transform:`translate3d(${q.left}px,0,0)`,width:`${q.width}px`,opacity:.92,offset:0},{transform:`translate3d(${N}px,0,0)`,width:`${ee}px`,opacity:1,offset:1}],{duration:260,easing:"cubic-bezier(.22,.7,.28,1)",fill:"forwards"});let ne=()=>{A(),d=null};d.addEventListener("finish",ne,{once:!0}),d.addEventListener("cancel",ne,{once:!0})};e.forEach(({value:v,label:w,disabled:x})=>{let E=document.createElement("button");E.type="button",E.className="qmm-seg__btn",E.dataset.value=String(v),E.setAttribute("role","radio"),E.setAttribute("aria-checked",v===n?"true":"false"),E.tabIndex=v===n?0:-1,E.disabled=!!x;let L=document.createElement("span");L.className="qmm-seg__btn-label",L.textContent=w,E.appendChild(L),E.addEventListener("click",()=>{E.disabled||m(v,!1)}),E.addEventListener("keydown",P=>{if(!["ArrowRight","ArrowLeft","Home","End"].includes(P.key))return;P.preventDefault();let V=e.findIndex(D=>D.value===f);if(P.key==="Home"){m(e[0].value,!0);return}if(P.key==="End"){m(e[e.length-1].value,!0);return}let z=P.key==="ArrowRight"?1:-1,C=V;for(let D=0;D<e.length;D++)if(C=(C+z+e.length)%e.length,!e[C].disabled){m(e[C].value,!0);break}}),h.push(E),s.appendChild(E)});let y=window.ResizeObserver?new ResizeObserver(()=>g(!1)):null;return y&&y.observe(s),window.addEventListener("resize",()=>g(!1)),queueMicrotask(()=>g(!1)),s.get=()=>f,s.set=v=>m(v,!1),s}radioGroup(e,n,r,o){let s=Ke("div","qmm-radio-group");for(let{value:i,label:a}of n){let l=this.radio(e,i,r===i),c=document.createElement("label");c.className="qmm-radio-label",c.appendChild(l),c.appendChild(document.createTextNode(a)),l.onchange=()=>{l.checked&&o(i)},s.appendChild(c)}return s}bindLS(e,n,r,o,s){try{let i=localStorage.getItem(e);i!=null&&r(o(i))}catch{}return{save:()=>{try{localStorage.setItem(e,s(n()))}catch{}}}}split2(e="260px"){let n=Ke("div","qmm-split");n.style.gridTemplateColumns="minmax(160px, max-content) 1fr";let r=Ke("div","qmm-split-left"),o=Ke("div","qmm-split-right");return n.appendChild(r),n.appendChild(o),{root:n,left:r,right:o}}vtabs(e={}){return new Uc(this,e)}hotkeyButton(e,n,r){let o=r?.emptyLabel??"None",s=r?.listeningLabel??"Press a key\u2026",i=r?.clearable??!0,a=e??null,l=!1;if(r?.storageKey)try{a=Qo(localStorage.getItem(r.storageKey)||"")??e??null}catch{}let c=document.createElement("button");c.type="button",c.className="qmm-hotkey",c.setAttribute("aria-live","polite");let d=()=>{c.classList.toggle("is-recording",l),c.classList.toggle("is-empty",!a),c.classList.toggle("is-assigned",!l&&!!a),l?(c.textContent=s,c.title="Listening\u2026 press a key (Esc to cancel, Backspace to clear)"):a?(c.textContent=hx(a),c.title="Click to rebind \u2022 Right-click to clear"):(c.textContent=o,c.title="No key assigned")},u=(m,g=!1)=>{a=m?{...m}:null,g||d()};c.refreshHotkey=m=>{u(m)};let p=m=>{if(l=!1,!m){d();return}d()},f=()=>{if(r?.storageKey){let m=Lt(a);try{m?localStorage.setItem(r.storageKey,m):localStorage.removeItem(r.storageKey)}catch{}}n?.(a,r?.storageKey?Lt(a):void 0)},h=m=>{if(!l)return;if(m.preventDefault(),m.stopPropagation(),m.key==="Escape"){p(!1),window.removeEventListener("keydown",h,!0);return}if((m.key==="Backspace"||m.key==="Delete")&&i){u(null,!0),f(),p(!0),window.removeEventListener("keydown",h,!0);return}let g=px(m,r?.allowModifierOnly??!1);g&&(u(g,!0),f(),p(!0),window.removeEventListener("keydown",h,!0))};return c.addEventListener("click",m=>{m.preventDefault(),l||(l=!0,d(),window.addEventListener("keydown",h,!0),c.focus())}),i&&c.addEventListener("contextmenu",m=>{m.preventDefault(),a&&(u(null,!0),f(),d())}),d(),c}createTabView(e,n){let r=document.createElement("button");r.className="qmm-tab",r.dataset.id=e,r.innerHTML=`<span class="label">${Gc(n.title)}</span><span class="badge" style="display:none"></span>`;let o=r.querySelector(".badge");n.btn=r,n.badge=o,r.onclick=()=>this.switchTo(e),this.tabBar.appendChild(r);let s=Ke("div","qmm-view");s.dataset.id=e,n.view=s,this.views.appendChild(s);try{n.render(s,this)}catch(i){s.textContent=String(i)}this.currentId||this.switchTo(e)}persistActive(){if(this.currentId)try{localStorage.setItem(this.lsKeyActive,this.currentId)}catch{}}restoreActive(){let e=null;try{e=localStorage.getItem(this.lsKeyActive)}catch{}e&&this.tabs.has(e)?this.switchTo(e):this.tabs.size&&this.switchTo(this.firstTabId())}updateTabsBarVisibility(){if(!this.tabBar||!this.root)return;this.tabs.size>0?(this.tabBar.parentElement||this.root.insertBefore(this.tabBar,this.views),this.tabBar.style.display="flex",this.root.classList.remove("qmm-no-tabs")):(this.tabBar.parentElement&&this.tabBar.parentElement.removeChild(this.tabBar),this.root.classList.add("qmm-no-tabs"))}ensureStyles(){if(document.getElementById("__qmm_css__"))return;let e=`
    /* ================= Modern UI for qmm ================= */
.qmm{
  --qmm-bg:        #0f1318;
  --qmm-bg-soft:   #0b0f13;
  --qmm-panel:     #111823cc;
  --qmm-border:    #ffffff22;
  --qmm-border-2:  #ffffff14;
  --qmm-accent:    #7aa2ff;
  --qmm-accent-2:  #92b2ff;
  --qmm-text:      #e7eef7;
  --qmm-text-dim:  #b9c3cf;
  --qmm-shadow:    0 6px 20px rgba(0,0,0,.35);
  --qmm-blur:      8px;

  display:flex; flex-direction:column; gap:10px; color:var(--qmm-text);
}
.qmm-compact{ gap:6px }

/* ---------- Tabs (pill + underline) ---------- */
.qmm-tabs{
  display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end;
  padding:0 6px 2px 6px; position:relative; isolation:isolate;
  border-bottom:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  border-top-left-radius:10px; border-top-right-radius:10px;
}
.qmm-no-tabs .qmm-views{ margin-top:0 }

.qmm-tab{
  flex:1 1 0; min-width:0; cursor:pointer;
  display:inline-flex; justify-content:center; align-items:center; gap:8px;
  padding:8px 12px; color:var(--qmm-text);
  background:transparent; border:1px solid transparent; border-bottom:none;
  border-top-left-radius:10px; border-top-right-radius:10px;
  position:relative; margin:0; margin-bottom:-1px;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;
}
.qmm-compact .qmm-tab{ padding:6px 10px }
.qmm-tab:hover{ background:rgba(255,255,255,.06) }
.qmm-tab:active{ transform:translateY(1px) }
.qmm-tab:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; border-radius:10px }

.qmm-tab .badge{
  font-size:11px; line-height:1; padding:2px 6px; border-radius:999px;
  background:#ffffff1a; border:1px solid #ffffff22;
}

.qmm-tab.active{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff; box-shadow:inset 0 -1px 0 #0007;
}
.qmm-tab.active::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-1px; height:2px;
  background:linear-gradient(90deg, transparent, var(--qmm-accent), transparent);
  border-radius:2px; box-shadow:0 0 12px var(--qmm-accent-2);
}

/* ---------- Views panel ---------- */
.qmm-views{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  display:flex; flex-direction:column;
  min-width:0; min-height:0; overflow:auto; box-shadow:var(--qmm-shadow);
}
.qmm-compact .qmm-views{ padding:8px }
.qmm-tabs + .qmm-views{ margin-top:-1px }

.qmm-view{ display:none; min-width:0; min-height:0; }
.qmm-view.active{ display:block; }

/* ---------- Basic controls ---------- */
.qmm-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.qmm-section{ margin-top:8px }
.qmm-section-title{ font-weight:650; margin:2px 0 8px 0; color:var(--qmm-text) }

.qmm-label{ opacity:.9 }
.qmm-val{ min-width:24px; text-align:center }

/* Buttons */
.qmm-btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:8px 14px;
  border-radius:10px;
  border:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
  color:var(--qmm-text);
  font-weight:600;
  font-size:13px;
  line-height:1.2;
  cursor:pointer;
  user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .1s ease, box-shadow .18s ease, color .18s ease;
}
.qmm-compact .qmm-btn{ padding:6px 10px }
.qmm-btn:hover{ background:linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.04)); border-color:#ffffff3d }
.qmm-btn:active{ transform:translateY(1px) }
.qmm-btn:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; }
.qmm-btn:disabled,
.qmm-btn.is-disabled{
  opacity:.55;
  cursor:not-allowed;
  filter:saturate(.6);
  box-shadow:none;
}
.qmm-btn--full{ width:100%; justify-content:center; }
.qmm-btn--sm{ padding:6px 10px; font-size:12px; border-radius:8px; }
.qmm-btn--icon{ padding:6px; width:34px; height:34px; border-radius:50%; gap:0; }
.qmm-btn__icon{ display:inline-flex; align-items:center; justify-content:center; font-size:1.1em; }
.qmm-btn__icon.is-right{ order:2; }
.qmm-btn__icon.is-left{ order:0; }

/* Button variants */
.qmm-btn--primary,
.qmm-btn.qmm-primary{
  background:linear-gradient(180deg, rgba(122,162,255,.38), rgba(122,162,255,.16));
  border-color:#9db7ff55;
  box-shadow:0 4px 14px rgba(122,162,255,.26);
}
.qmm-btn--primary:hover,
.qmm-btn.qmm-primary:hover{ border-color:#afc5ff77; }
.qmm-btn--secondary{
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.01));
}
.qmm-btn--danger,
.qmm-btn.qmm-danger{
  background:linear-gradient(180deg, rgba(255,86,86,.32), rgba(255,86,86,.14));
  border-color:#ff6a6a55;
  box-shadow:0 4px 14px rgba(255,86,86,.25);
}
.qmm-btn--ghost{ background:transparent; border-color:transparent; }
.qmm-btn--ghost:hover{ background:rgba(255,255,255,.06); border-color:#ffffff2a; }
.qmm-btn.active{
  background:#79a6ff22;
  border-color:#79a6ff66;
  box-shadow: inset 0 0 0 1px #79a6ff33;
}

.qmm-flex{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }

.qmm-form-grid{ width:100%; }

.qmm-form-row{ width:100%; }
.qmm-form-row.is-wrap{ grid-template-columns:1fr; }
.qmm-form-row__label{ font-weight:600; opacity:.9; }

.qmm-card{
  display:grid;
  gap:12px;
  border:1px solid var(--qmm-border);
  border-radius:12px;
  padding:14px;
  background:var(--qmm-panel);
  backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
  width:100%;
}
.qmm-card.is-center{ text-align:center; align-items:center; }
.qmm-card.is-stretch{ align-items:stretch; }
.qmm-card__header{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;
  justify-content:space-between;
}
.qmm-card__header.is-compact{ gap:6px; }
.qmm-card__icon{ font-size:18px; }
.qmm-card__title{ font-weight:700; font-size:14px; letter-spacing:.01em; }
.qmm-card__subtitle{ font-size:12px; opacity:.75; flex-basis:100%; }
.qmm-card__actions{ display:flex; gap:6px; margin-left:auto; }
.qmm-card__body{ display:grid; gap:10px; }
.qmm-card[data-tone="muted"]{
  background:rgba(15,17,22,.88);
  border-color:#ffffff1a;
  box-shadow:none;
}
.qmm-card[data-tone="accent"]{
  border-color:#7aa2ff99;
  box-shadow:0 10px 26px rgba(122,162,255,.25);
}

.qmm .stats-collapse-toggle{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  padding:6px 12px;
  min-height:32px;
  border-radius:999px;
  border:1px solid rgba(122,162,255,.45);
  background:linear-gradient(135deg, rgba(122,162,255,.18), rgba(33,59,121,.18));
  color:rgba(220,230,255,.92);
  font-size:12px;
  font-weight:600;
  letter-spacing:.01em;
  text-transform:uppercase;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12), 0 10px 24px rgba(9,13,27,.28);
  transition:background .26s ease, border-color .26s ease, box-shadow .26s ease, color .26s ease, transform .16s ease;
}
.qmm .stats-collapse-toggle:hover{
  background:linear-gradient(135deg, rgba(122,162,255,.28), rgba(53,94,182,.24));
  border-color:rgba(122,162,255,.62);
  color:#fff;
  box-shadow:0 14px 30px rgba(66,106,201,.32), inset 0 1px 0 rgba(255,255,255,.18);
}
.qmm .stats-collapse-toggle:active{
  transform:translateY(1px) scale(.99);
}
.qmm-card--collapsible[data-collapsed="true"] .stats-collapse-toggle{
  background:linear-gradient(135deg, rgba(122,162,255,.12), rgba(23,36,78,.12));
  border-color:rgba(122,162,255,.32);
  color:rgba(208,219,255,.82);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.1), 0 6px 18px rgba(9,13,27,.22);
}
.qmm-card--collapsible[data-collapsed="false"] .stats-collapse-toggle{
  background:linear-gradient(135deg, rgba(122,162,255,.36), rgba(83,124,255,.28));
  border-color:rgba(122,162,255,.78);
  color:#fff;
  box-shadow:0 16px 32px rgba(72,112,214,.35), inset 0 1px 0 rgba(255,255,255,.22);
}
.qmm .stats-collapse-toggle__icon{
  width:16px;
  height:16px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  position:relative;
  color:inherit;
  transition:transform .24s ease;
}
.qmm .stats-collapse-toggle__icon::before{
  content:"";
  position:absolute;
  width:8px;
  height:8px;
  border-right:2px solid currentColor;
  border-bottom:2px solid currentColor;
  transform:rotate(45deg);
  transition:transform .24s ease;
}
.qmm .stats-collapse-toggle__label{
  color:inherit;
  font-size:11px;
  letter-spacing:.08em;
  font-weight:700;
}
.qmm-card--collapsible[data-collapsed="false"] .stats-collapse-toggle__icon::before{
  transform:rotate(-135deg);
}
.qmm-card--collapsible[data-collapsed="true"] .stats-collapse-toggle__icon::before{
  transform:rotate(45deg);
}

.qmm-chip-toggle{
  display:inline-flex;
  align-items:stretch;
  border-radius:999px;
  border:1px solid #ffffff1f;
  background:rgba(255,255,255,.05);
  cursor:pointer;
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease, transform .1s ease;
}
.qmm-chip-toggle input{ display:none; }
.qmm-chip-toggle__face{
  display:flex;
  align-items:center;
  gap:8px;
  padding:6px 12px;
  border-radius:999px;
}
.qmm-chip-toggle__icon{ font-size:14px; }
.qmm-chip-toggle__label{ font-weight:600; }
.qmm-chip-toggle__desc{ font-size:12px; opacity:.75; }
.qmm-chip-toggle__badge{ font-size:11px; padding:2px 6px; border-radius:999px; background:#ffffff1a; border:1px solid #ffffff22; }
.qmm-chip-toggle:hover{ border-color:#7aa2ff55; background:rgba(122,162,255,.12); }
.qmm-chip-toggle input:checked + .qmm-chip-toggle__face{
  background:linear-gradient(180deg, rgba(122,162,255,.25), rgba(122,162,255,.10));
  box-shadow:0 0 0 1px #7aa2ff55 inset, 0 6px 18px rgba(122,162,255,.22);
}

.qmm .stats-metric-grid{
  display:grid;
  gap:10px;
  grid-template-columns:repeat(auto-fit, minmax(160px, 1fr));
}
.qmm .stats-metric{
  border-radius:12px;
  padding:12px 14px;
  background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  display:flex;
  flex-direction:column;
  gap:6px;
  transition:border-color .18s ease, background .18s ease, transform .14s ease;
}
.qmm .stats-metric:hover{
  border-color:#7aa2ff55;
  background:linear-gradient(180deg, rgba(122,162,255,.22), rgba(122,162,255,.10));
  transform:translateY(-1px);
}
.qmm .stats-metric__label{
  font-size:12px;
  letter-spacing:.02em;
  text-transform:uppercase;
  color:var(--qmm-text-dim);
}
.qmm .stats-metric__value{
  font-size:20px;
  font-weight:700;
  color:#fff;
}

.qmm .stats-list{
  display:flex;
  flex-direction:column;
  gap:6px;
}
.qmm .stats-list__row{
  display:grid;
  align-items:center;
  gap:10px;
  padding:10px 12px;
  border-radius:10px;
  background:rgba(255,255,255,.035);
  border:1px solid rgba(255,255,255,.08);
  transition:border-color .18s ease, background .18s ease;
}
.qmm .stats-list__row:not(.stats-list__row--header):hover{
  background:rgba(122,162,255,.12);
  border-color:#7aa2ff55;
}
.qmm .stats-list__row--header{
  background:transparent;
  border:none;
  padding:0 6px 2px 6px;
  font-size:11px;
  letter-spacing:.05em;
  text-transform:uppercase;
  color:var(--qmm-text-dim);
}
.qmm .stats-list__row--header .stats-list__cell{
  font-weight:600;
}
.qmm .stats-list__header-label--gold,
.qmm .stats-list__header-label--rainbow{
  display:inline-block;
}
.qmm .stats-list__header-label--gold{
  color:#f7d774;
  background:linear-gradient(135deg,#fff5c0 0%,#f3c76a 55%,#f5b84f 100%);
  background-clip:text;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 1px 4px rgba(0,0,0,.35);
}
.qmm .stats-list__header-label--rainbow{
  color:#ffd6ff;
  background:linear-gradient(90deg,#ff6b6b 0%,#ffd86f 25%,#6bff8f 50%,#6bc7ff 75%,#b86bff 100%);
  background-clip:text;
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 1px 4px rgba(0,0,0,.35);
}
.qmm .stats-list__cell{
  min-width:0;
  font-size:13px;
}
.qmm .stats-pet__species{
  display:inline-flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.qmm .stats-pet__label{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.qmm .stats-pet__total-value{
  font-weight:700;
}
.qmm .stats-pet__sprite-icon{
  --stats-pet-sprite-size:28px;
  width:var(--stats-pet-sprite-size);
  height:var(--stats-pet-sprite-size);
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  background:rgba(255,255,255,.08);
  padding:2px;
  flex-shrink:0;
}
.qmm .stats-pet__sprite-icon img{
  width:100%;
  height:100%;
  object-fit:contain;
  image-rendering:pixelated;
}
.qmm .stats-weather__name{
  display:inline-flex;
  align-items:center;
  gap:8px;
  min-width:0;
}
.qmm .stats-weather__icon{
  width:32px;
  height:32px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border-radius:6px;
  background:rgba(255,255,255,.08);
  overflow:hidden;
  flex-shrink:0;
}
.qmm .stats-weather__icon img{
  width:100%;
  height:100%;
  object-fit:contain;
  image-rendering:pixelated;
}
.qmm .stats-weather__label{
  overflow:hidden;
  text-overflow:ellipsis;
  white-space:nowrap;
}
.qmm .stats-list__cell--align-right{ text-align:right; }
.qmm .stats-list__cell--align-center{ text-align:center; }

.qmm .stats-pet-group{
  border:1px solid var(--stats-pet-group-border-color, rgba(255,255,255,.09));
  border-radius:12px;
  padding:10px 12px;
  background:rgba(255,255,255,.05);
  transition:border-color .18s ease, background .18s ease;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  width:100%;
}
.qmm .stats-pet-group + .stats-pet-group{
  margin-top:8px;
}
.qmm .stats-pet-group__summary{
  display:flex;
  align-items:center;
  gap:6px;
  font-weight:650;
  font-size:13px;
  color:var(--qmm-text);
  margin:0;
  user-select:none;
  justify-content:center;
  text-align:center;
}
.qmm .stats-pet-group__content{
  margin-top:8px;
  display:flex;
  flex-direction:column;
  align-items:stretch;
  gap:8px;
}

.qmm-error{
  border:1px solid #ff6a6a55;
  background:rgba(120,20,20,.35);
  border-radius:10px;
  color:#ffdada;
  padding:10px;
  font-size:13px;
  line-height:1.4;
}

.qmm-select{
  background-image:linear-gradient(45deg, transparent 50%, #ffffff80 50%), linear-gradient(135deg, #ffffff80 50%, transparent 50%), linear-gradient(90deg, transparent 50%, rgba(255,255,255,.1) 50%);
  background-position:calc(100% - 18px) 50%, calc(100% - 13px) 50%, 100% 0;
  background-size:5px 5px, 5px 5px, 2.5rem 2.5rem;
  background-repeat:no-repeat;
  padding-right:34px;
}

.qmm-vlist-wrap{ display:flex; flex-direction:column; width:100%; }

/* Inputs */
.qmm-input{
  min-width:90px; background:rgba(0,0,0,.42); color:#fff;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.qmm-input::placeholder{ color:#cbd6e780 }
.qmm-input:focus{ outline:none; border-color:var(--qmm-accent); background:#0f1521; box-shadow:0 0 0 2px #7aa2ff33 }

/* Number input + spinner (unchanged API) */
.qmm-input-number{ display:inline-flex; align-items:center; gap:6px }
.qmm-input-number-input{ width:70px; text-align:center; padding-right:8px }
.qmm-spin{ display:inline-flex; flex-direction:column; gap:2px }
.qmm-step{
  width:22px; height:16px; font-size:11px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:6px; border:1px solid var(--qmm-border);
  background:rgba(255,255,255,.08); color:#fff; cursor:pointer; user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-step:hover{ background:#ffffff18; border-color:#ffffff40 }
.qmm-step:active{ transform:translateY(1px) }

/* Switch (checkbox) */
.qmm-switch{
  appearance:none; width:42px; height:24px; background:#6c7488aa; border-radius:999px;
  position:relative; outline:none; cursor:pointer; transition:background .18s ease, box-shadow .18s ease;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12);
}
.qmm-switch::before{
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px;
  background:#fff; border-radius:50%; transition:transform .2s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
}
.qmm-switch:checked{ background:linear-gradient(180deg, rgba(122,162,255,.9), rgba(122,162,255,.6)) }
.qmm-switch:checked::before{ transform:translateX(18px) }
.qmm-switch:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px }

/* Checkbox & radio (native inputs skinned lightly) */
.qmm-check, .qmm-radio{ transform:scale(1.1); accent-color: var(--qmm-accent) }

/* Slider */
.qmm-range{
  width:180px; appearance:none; background:transparent; height:22px;
}
.qmm-range:focus{ outline:none }
.qmm-range::-webkit-slider-runnable-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-moz-range-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-webkit-slider-thumb{
  appearance:none; width:16px; height:16px; border-radius:50%; margin-top:-5px;
  background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
  transition:transform .1s ease;
}
.qmm-range:active::-webkit-slider-thumb{ transform:scale(1.04) }
.qmm-range::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:#fff; border:none;
  box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
}

.qmm-range-dual{
  position:relative;
  width:100%;
  padding:18px 0 10px;
}
.qmm-range-dual-track{
  position:absolute;
  left:0;
  right:0;
  top:50%;
  transform:translateY(-50%);
  height:8px;
  border-radius:999px;
  background:linear-gradient(90deg, rgba(8,19,33,.8), rgba(27,43,68,.9));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.08), inset 0 0 0 1px rgba(118,156,255,.08);
}
.qmm-range-dual-fill{
  position:absolute;
  top:50%;
  transform:translateY(-50%);
  height:8px;
  border-radius:999px;
  background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff99);
  box-shadow:0 4px 14px rgba(37,92,255,.3);
  transition:left .12s ease, right .12s ease;
}
.qmm-range-dual-input{
  position:absolute;
  left:0;
  right:0;
  top:50%;
  transform:translateY(-50%);
  width:100%;
  height:28px;
  margin:0;
  background:transparent;
  pointer-events:none;
}
.qmm-range-dual-input::-webkit-slider-runnable-track{ background:none; }
.qmm-range-dual-input::-moz-range-track{ background:none; }
.qmm-range-dual-input::-webkit-slider-thumb{
  pointer-events:auto;
  width:18px;
  height:18px;
  border-radius:50%;
  background:linear-gradient(145deg, #fff, #dce6ff);
  border:2px solid rgba(122,162,255,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.35);
  transition:transform .12s ease, box-shadow .12s ease;
}
.qmm-range-dual-input:active::-webkit-slider-thumb,
.qmm-range-dual-input:focus-visible::-webkit-slider-thumb{
  transform:scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}
.qmm-range-dual-input::-moz-range-thumb{
  pointer-events:auto;
  width:18px;
  height:18px;
  border-radius:50%;
  background:linear-gradient(145deg, #fff, #dce6ff);
  border:2px solid rgba(122,162,255,.8);
  box-shadow:0 4px 12px rgba(0,0,0,.35);
  transition:transform .12s ease, box-shadow .12s ease;
}
.qmm-range-dual-input:active::-moz-range-thumb,
.qmm-range-dual-input:focus-visible::-moz-range-thumb{
  transform:scale(1.05);
  box-shadow:0 6px 16px rgba(0,0,0,.4);
}
.qmm-range-dual-input--min{ z-index:2; }
.qmm-range-dual-input--max{ z-index:3; }
.qmm-range-dual-bubble{
  position:absolute;
  top:14px;
  transform:translate(-50%, -100%);
  padding:4px 8px;
  border-radius:6px;
  font-size:11px;
  line-height:1;
  font-weight:600;
  color:#dbe6ff;
  background:rgba(17,28,46,.9);
  box-shadow:0 4px 14px rgba(0,0,0,.35);
  pointer-events:none;
  transition:opacity .12s ease, transform .12s ease;
  opacity:.85;
}
.qmm-range-dual-bubble::after{
  content:"";
  position:absolute;
  left:50%;
  bottom:-4px;
  width:8px;
  height:8px;
  background:inherit;
  transform:translateX(-50%) rotate(45deg);
  border-radius:2px;
  box-shadow:0 4px 14px rgba(0,0,0,.35);
}
.qmm-range-dual-input--min:focus-visible + .qmm-range-dual-bubble--min,
.qmm-range-dual-input--max:focus-visible + .qmm-range-dual-bubble--max,
.qmm-range-dual-input--min:active + .qmm-range-dual-bubble--min,
.qmm-range-dual-input--max:active + .qmm-range-dual-bubble--max{
  opacity:1;
  transform:translate(-50%, -110%) scale(1.02);
}

/* ---------- Minimal table ---------- */
/* container */
.qmm-table-wrap--minimal{
  border:1px solid #263040; border-radius:8px; background:#0b0f14; box-shadow:none;
}
/* scroller (height cap) */
.qmm-table-scroll{
  overflow:auto; max-height:44vh; /* override via opts.maxHeight */
}

/* base */
.qmm-table--minimal{
  width:100%;
  border-collapse:collapse;
  background:transparent;
  font-size:13px; line-height:1.35; color:var(--qmm-text, #cdd6e3);
}

/* header */
.qmm-table--minimal thead th{
  position:sticky; top:0; z-index:1;
  text-align:left; font-weight:600;
  padding:8px 10px;
  color:#cbd5e1; background:#0f1318;
  border-bottom:1px solid #263040;
  text-transform:none; letter-spacing:0;
}
.qmm-table--minimal thead th.is-center { text-align: center; }
.qmm-table--minimal thead th.is-left   { text-align: left; }   /* d\xE9j\xE0 pr\xE9sent, ok */
.qmm-table--minimal thead th.is-right  { text-align: right; }
.qmm-table--minimal thead th,
.qmm-table--minimal td { vertical-align: middle; }

/* cells */
.qmm-table--minimal td{
  padding:8px 10px; border-bottom:1px solid #1f2937; vertical-align:middle;
}
.qmm-table--minimal tbody tr:hover{ background:#0f1824; }

/* compact variant */
.qmm-table--compact thead th,
.qmm-table--compact td{ padding:6px 8px; font-size:12px }

/* utils */
.qmm-table--minimal td.is-num{ text-align:right; font-variant-numeric:tabular-nums }
.qmm-table--minimal td.is-center{ text-align:center }
.qmm-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.qmm-prewrap{ white-space:pre-wrap; word-break:break-word }


/* ---------- Split panels ---------- */
.qmm-split{
  display:grid; gap:12px;
  grid-template-columns:minmax(180px,260px) minmax(0,1fr);
  align-items:start;
}
.qmm-split-left{ display:flex; flex-direction:column; gap:10px }
.qmm-split-right{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
}

/* ---------- VTabs (vertical list + filter) ---------- */
.qmm-vtabs{ display:flex; flex-direction:column; gap:8px; min-width:0 }
.qmm-vtabs .filter{ display:block }
.qmm-vtabs .filter input{ width:100% }

.qmm-vlist{
  flex:0 0 auto; overflow:visible;
  border:1px solid var(--qmm-border); border-radius:12px; padding:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
}

.qmm-vtab{
  width:100%; text-align:left; cursor:pointer;
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:8px 10px; border-radius:10px; border:1px solid #ffffff18;
  background:rgba(255,255,255,.03); color:inherit;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-vtab:hover{ background:rgba(255,255,255,.07); border-color:#ffffff34 }
.qmm-vtab:active{ transform:translateY(1px) }
.qmm-vtab.active{
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.08));
  border-color:#9db7ff55;
  box-shadow:0 1px 14px rgba(122,162,255,.18) inset;
}

.qmm-dot{ width:10px; height:10px; border-radius:50%; justify-self:center; box-shadow:0 0 0 1px #0006 inset }
.qmm-chip{ display:flex; align-items:center; gap:8px; min-width:0 }
.qmm-chip img{
  width:20px; height:20px; border-radius:50%; object-fit:cover; border:1px solid #4446;
  box-shadow:0 1px 0 rgba(255,255,255,.08) inset;
}
.qmm-chip .t{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.qmm-tag{
  font-size:11px; line-height:1; padding:3px 7px; border-radius:999px;
  background:#ffffff14; border:1px solid #ffffff26;
}

/* ---------- Small helpers (optional) ---------- */
.qmm .qmm-card{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur)); box-shadow:var(--qmm-shadow);
}
  .qmm .qmm-help{ font-size:12px; color:var(--qmm-text-dim) }
  .qmm .qmm-sep{ height:1px; background:var(--qmm-border); width:100%; opacity:.6; }

/* ta poign\xE9e, inchang\xE9 */
.qmm-grab { margin-left:auto; opacity:.8; cursor:grab; user-select:none; }
.qmm-grab:active { cursor:grabbing; }
.qmm-dragging { opacity:.6; }

/* items animables */
.qmm-team-item {
  will-change: transform;
  transition: transform 160ms ease;
}
.qmm-team-item.drag-ghost {
  opacity: .4;
}

.qmm.qmm-alt-drag { cursor: grab; }
.qmm.qmm-alt-drag:active { cursor: grabbing; }

.qws-win.is-hidden { display: none !important; }

.qmm-hotkey{
  cursor:pointer; user-select:none;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 12px;
  background:linear-gradient(180deg, #ffffff10, #ffffff06);
  color:var(--qmm-text);
  box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.18);
  transition:
    background .18s ease,
    border-color .18s ease,
    box-shadow .18s ease,
    transform .08s ease,
    color .18s ease;
}
.qmm-hotkey{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  white-space:nowrap;
  width: var(--qmm-hotkey-w, 180px); 
}
.qmm-hotkey:hover{ background:linear-gradient(180deg, #ffffff16, #ffffff08); border-color:#ffffff40 }
.qmm-hotkey:active{ transform:translateY(1px) }

.qmm-hotkey:focus-visible{ outline:none }

.qmm-hotkey.is-empty{
  color:var(--qmm-text-dim);
  font-style:italic;
}

.qmm-hotkey.is-assigned{
  border-color: rgba(122,162,255,.45);
  box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.18), 0 0 0 2px rgba(122,162,255,.24);
}

.qmm-hotkey.is-recording{
  outline:2px solid var(--qmm-accent);
  outline-offset:2px;
  border-color: var(--qmm-accent);
  background:linear-gradient(180deg, rgba(122,162,255,.25), rgba(122,162,255,.10));
  animation: qmm-hotkey-breathe 1.2s ease-in-out infinite;
}
  
@keyframes qmm-hotkey-breathe{
  0%   { box-shadow: 0 0 0 0 rgba(122,162,255,.55), 0 1px 16px rgba(0,0,0,.25); }
  60%  { box-shadow: 0 0 0 12px rgba(122,162,255,0), 0 1px 16px rgba(0,0,0,.25); }
  100% { box-shadow: 0 0 0 0 rgba(122,162,255,0),  0 1px 16px rgba(0,0,0,.25); }
}

/* ---------- Segmented (minimal, modern) ---------- */
.qmm-seg{
  --seg-pad: 8px;
  --seg-radius: 999px;
  --seg-stroke: 1.2px;      /* \xE9paisseur du trait */
  --seg-nudge-x: 0px;       /* micro-ajustements optionnels */
  --seg-nudge-w: 0px;
  --seg-fill: rgba(122,162,255,.05);           
  --seg-stroke-color: rgba(122,162,255,.60);

  position: relative;
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: var(--seg-pad);
  border-radius: var(--seg-radius);
  background: var(--qmm-bg-soft);
  border: 1px solid var(--qmm-border-2);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
  overflow: hidden;
  background-clip: padding-box; /* important pour que le fond ne passe pas sous la bordure */
}

.qmm-seg--full{ display:flex; width:100% }

.qmm-seg__btn{
  position: relative;
  z-index: 1;
  appearance: none; background: transparent; border: 0; cursor: pointer;
  padding: 8px 14px;
  border-radius: 999px;
  color: var(--qmm-text-dim);
  font: inherit; line-height: 1; white-space: nowrap;
  transition: color .15s ease, transform .06s ease;
}
.qmm-seg__btn-label{
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: inherit;
}
.qmm-compact .qmm-seg__btn{ padding: 6px 10px }
.qmm-seg__btn:hover{ color: var(--qmm-text); }
.qmm-seg__btn.active{ color:#fff; font-weight:600; }
.qmm-seg__btn:active{ transform: translateY(1px); }
.qmm-seg__btn[disabled]{ opacity:.5; cursor:not-allowed; }

.qmm-seg__indicator{
  position: absolute;
  top: 0; left: 0;
  height: 100%;
  width: 40px;                      /* maj en JS */
  border-radius: inherit;
  background: var(--seg-fill);              /* \u2B05\uFE0F applique la couleur */
  outline: var(--seg-stroke,1.2px) solid var(--seg-stroke-color);
  outline-offset: calc(-1 * var(--seg-stroke));

  box-shadow: 0 1px 4px rgba(122,162,255,.10);
  transform-origin: left center;
  will-change: transform, width, opacity;
  transition: transform .18s cubic-bezier(.2,.8,.2,1),
              width .18s cubic-bezier(.2,.8,.2,1),
              opacity .18s ease-out;
  pointer-events: none;
}

/* Accessibilit\xE9 */
@media (prefers-reduced-motion: reduce){
  .qmm-seg__indicator, .qmm-seg__btn { transition: none; }
}  /* \u2190 manquait cette accolade */

    `,n=document.createElement("style");n.id="__qmm_css__",n.textContent=e,(document.documentElement||document.body).appendChild(n)}},Uc=class{constructor(e,n={}){this.api=e;this.opts=n;ce(this,"root");ce(this,"filterWrap",null);ce(this,"filterInput",null);ce(this,"list");ce(this,"listWrap",null);ce(this,"items",[]);ce(this,"selectedId",null);ce(this,"onSelectCb");ce(this,"renderItemCustom");ce(this,"emptyText");this.root=Ke("div","qmm-vtabs"),this.root.style.minWidth="0",this.emptyText=n.emptyText||"Aucun \xE9l\xE9ment.",this.renderItemCustom=n.renderItem,n.filterPlaceholder&&(this.filterWrap=Ke("div","filter"),this.filterInput=document.createElement("input"),this.filterInput.type="search",this.filterInput.placeholder=n.filterPlaceholder,this.filterInput.className="qmm-input",this.filterInput.oninput=()=>this.renderList(),this.filterWrap.appendChild(this.filterInput),this.root.appendChild(this.filterWrap)),this.list=Ke("div","qmm-vlist"),this.list.style.minWidth="0",n.maxHeightPx&&(this.list.style.maxHeight=`${n.maxHeightPx}px`,this.list.style.overflow="auto",this.list.style.flex="1 1 auto"),n.fillAvailableHeight?(this.listWrap=document.createElement("div"),this.listWrap.className="qmm-vlist-wrap",Object.assign(this.listWrap.style,{flex:"1 1 auto",minHeight:"0",display:"flex",flexDirection:"column"}),this.list.style.flex="1 1 auto",n.maxHeightPx||(this.list.style.overflow="auto"),this.listWrap.appendChild(this.list),this.root.appendChild(this.listWrap)):this.root.appendChild(this.list),this.selectedId=n.initialId??null,this.onSelectCb=n.onSelect}setItems(e){this.items=Array.isArray(e)?e.slice():[],this.selectedId&&!this.items.some(n=>n.id===this.selectedId)&&(this.selectedId=this.items[0]?.id??null),this.renderList()}getSelected(){return this.items.find(e=>e.id===this.selectedId)??null}select(e){this.selectedId=e,this.renderList(),this.onSelectCb?.(this.selectedId,this.getSelected())}onSelect(e){this.onSelectCb=e}setBadge(e,n){let r=this.list.querySelector(`button[data-id="${Wf(e)}"]`);if(!r)return;let o=r.querySelector(".qmm-tag");!o&&n!=null&&(o=Ke("span","qmm-tag"),r.appendChild(o)),o&&(n==null||n===""?o.style.display="none":(o.textContent=n,o.style.display=""))}getFilter(){return(this.filterInput?.value||"").trim().toLowerCase()}renderList(){let e=this.list.scrollTop;this.list.innerHTML="";let n=this.getFilter(),r=n?this.items.filter(s=>(s.title||"").toLowerCase().includes(n)||(s.subtitle||"").toLowerCase().includes(n)):this.items;if(!r.length){let s=document.createElement("div");s.style.opacity="0.75",s.textContent=this.emptyText,this.list.appendChild(s);return}let o=document.createElement("ul");o.style.listStyle="none",o.style.margin="0",o.style.padding="0",o.style.display="flex",o.style.flexDirection="column",o.style.gap="4px";for(let s of r){let i=document.createElement("li"),a=document.createElement("button");if(a.className="qmm-vtab",a.dataset.id=s.id,a.disabled=!!s.disabled,this.renderItemCustom)this.renderItemCustom(s,a);else{let l=Ke("div","qmm-dot");l.style.background=s.statusColor||"#999a";let c=Ke("div","qmm-chip"),d=document.createElement("img");d.src=s.avatarUrl||"",d.alt=s.title;let u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.gap="2px";let p=Ke("div","t");p.textContent=s.title;let f=document.createElement("div");if(f.textContent=s.subtitle||"",f.style.opacity="0.7",f.style.fontSize="12px",s.subtitle||(f.style.display="none"),u.appendChild(p),u.appendChild(f),c.appendChild(d),c.appendChild(u),a.appendChild(l),a.appendChild(c),s.badge!=null){let h=Ke("span","qmm-tag",Gc(String(s.badge)));a.appendChild(h)}else{let h=document.createElement("div");h.style.width="0",a.appendChild(h)}}a.classList.toggle("active",s.id===this.selectedId),a.onclick=()=>this.select(s.id),i.appendChild(a),o.appendChild(i)}this.list.appendChild(o),this.list.scrollTop=e}};function Ke(t,e,n){let r=document.createElement(t);return e&&(r.className=e),n!=null&&(r.innerHTML=n),r}function Wf(t){return t.replace(/"/g,'\\"')}function Gc(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}var dx=new Set(["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"]);function ux(t,e){if(t===e)return!0;let n=t==="AltLeft"||t==="AltRight",r=t==="ControlLeft"||t==="ControlRight",o=t==="ShiftLeft"||t==="ShiftRight",s=t==="MetaLeft"||t==="MetaRight";return!!(n&&(e==="AltLeft"||e==="AltRight")||r&&(e==="ControlLeft"||e==="ControlRight")||o&&(e==="ShiftLeft"||e==="ShiftRight")||s&&(e==="MetaLeft"||e==="MetaRight"))}function jf(){return navigator.platform?.toLowerCase().includes("mac")||/mac|iphone|ipad|ipod/i.test(navigator.userAgent)}function px(t,e=!1){return(dx.has(t.code)||t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta")&&!e?null:{code:t.code,ctrl:t.ctrlKey,alt:t.altKey,shift:t.shiftKey,meta:t.metaKey}}function Kr(t,e){return!e||!!e.ctrl!==t.ctrlKey||!!e.shift!==t.shiftKey||!!e.alt!==t.altKey||!!e.meta!==t.metaKey?!1:ux(e.code,t.code)}function Lt(t){if(!t)return"";let e=[];return t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push("Meta"),t.code&&e.push(t.code),e.join("+")}function Qo(t){if(!t)return null;let e=t.split("+").map(o=>o.trim()).filter(Boolean);if(!e.length)return null;let r={code:fx(e.pop()||"")};for(let o of e){let s=o.toLowerCase();s==="ctrl"||s==="control"?r.ctrl=!0:s==="shift"?r.shift=!0:s==="alt"?r.alt=!0:(s==="meta"||s==="cmd"||s==="command")&&(r.meta=!0)}return r.code?r:null}var Ji={space:"Space",enter:"Enter",escape:"Escape",tab:"Tab",backspace:"Backspace",delete:"Delete",insert:"Insert",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",arrowup:"ArrowUp",arrowdown:"ArrowDown",arrowleft:"ArrowLeft",arrowright:"ArrowRight",bracketleft:"BracketLeft",bracketright:"BracketRight",backslash:"Backslash",slash:"Slash",minus:"Minus",equal:"Equal",semicolon:"Semicolon",quote:"Quote",backquote:"Backquote",comma:"Comma",period:"Period",dot:"Period",capslock:"CapsLock",numlock:"NumLock",scrolllock:"ScrollLock",pause:"Pause",contextmenu:"ContextMenu",printscreen:"PrintScreen",metaleft:"MetaLeft",metaright:"MetaRight",altleft:"AltLeft",altright:"AltRight",controlleft:"ControlLeft",controlright:"ControlRight",shiftleft:"ShiftLeft",shiftright:"ShiftRight"};function fx(t){let e=t.trim();if(!e)return"";let n=e.toLowerCase(),r=n.match(/^key([a-z])$/);if(r)return`Key${r[1].toUpperCase()}`;let o=n.match(/^digit([0-9])$/);if(o)return`Digit${o[1]}`;let s=n.match(/^numpad([0-9])$/);if(s)return`Numpad${s[1]}`;if(n.startsWith("numpad")){let l=n.slice(6);return l?`Numpad${Ji[l]??Hf(l)}`:"Numpad"}let i=n.match(/^f([0-9]{1,2})$/);if(i)return`F${i[1]}`;let a=n.match(/^arrow([a-z]+)$/);if(a){let l=a[1];return`Arrow${Ji[l]??Hf(l)}`}return Ji[n]?Ji[n]:e[0].toUpperCase()+e.slice(1)}function Hf(t){return t?t[0].toUpperCase()+t.slice(1):""}function mx(t){if(t==="AltLeft"||t==="AltRight")return"Alt";if(t==="ControlLeft"||t==="ControlRight")return"Ctrl";if(t==="ShiftLeft"||t==="ShiftRight")return"Shift";if(t==="MetaLeft"||t==="MetaRight")return jf()?"\u2318":"Meta";if(t.startsWith("Key"))return t.slice(3);if(t.startsWith("Digit"))return t.slice(5);if(t.startsWith("Numpad"))return"Numpad "+t.slice(6);let e={ArrowUp:"\u2191",ArrowDown:"\u2193",ArrowLeft:"\u2190",ArrowRight:"\u2192"};return e[t]?e[t]:t}function hx(t){if(!t)return"\u2014";let e=jf(),n=[];e?(t.ctrl&&n.push("\u2303"),t.alt&&n.push("\u2325"),t.shift&&n.push("\u21E7"),t.meta&&n.push("\u2318")):(t.ctrl&&n.push("Ctrl"),t.alt&&n.push("Alt"),t.shift&&n.push("Shift"),t.meta&&n.push("Meta"));let r=t.alt&&(t.code==="AltLeft"||t.code==="AltRight")||t.ctrl&&(t.code==="ControlLeft"||t.code==="ControlRight")||t.shift&&(t.code==="ShiftLeft"||t.code==="ShiftRight")||t.meta&&(t.code==="MetaLeft"||t.code==="MetaRight"),o=n.slice(),s=mx(t.code);return(!r||o.length===0)&&o.push(s),o.length?o.join(e?"":" + "):s}var Yf=t=>{if(t)return t;let e=Re??window,n=e.document??document;return{window:e,document:n}},zf={KeyA:65,KeyB:66,KeyC:67,KeyD:68,KeyE:69,KeyF:70,KeyG:71,KeyH:72,KeyI:73,KeyJ:74,KeyK:75,KeyL:76,KeyM:77,KeyN:78,KeyO:79,KeyP:80,KeyQ:81,KeyR:82,KeyS:83,KeyT:84,KeyU:85,KeyV:86,KeyW:87,KeyX:88,KeyY:89,KeyZ:90,Digit0:48,Digit1:49,Digit2:50,Digit3:51,Digit4:52,Digit5:53,Digit6:54,Digit7:55,Digit8:56,Digit9:57,Space:32,Enter:13,Escape:27,Tab:9,Backspace:8,Delete:46,Insert:45,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40},Kc=(t,e=!1)=>t?/^Key[A-Z]$/.test(t)?e?t.slice(3).toUpperCase():t.slice(3).toLowerCase():/^Digit[0-9]$/.test(t)?t.slice(5):t==="Space"?" ":t:"",Uf=t=>{let e=t;if(!e||!e.tagName)return!1;let n=e.tagName.toLowerCase();if(n==="input"||n==="textarea")return!0;let r=e.getAttribute&&e.getAttribute("contenteditable");return!!(r&&r!=="false")},Et=t=>{let e=String(t).split("+").map(o=>o.trim()).filter(Boolean),n=[],r="";for(let o of e){let s=o.toLowerCase();s==="ctrl"||s==="control"?n.push("ctrl"):s==="shift"?n.push("shift"):s==="alt"?n.push("alt"):s==="meta"||s==="cmd"||s==="command"||s==="win"?n.push("meta"):r=o}return n.sort((o,s)=>["ctrl","shift","alt","meta"].indexOf(o)-["ctrl","shift","alt","meta"].indexOf(s)),(n.length?n.join("+")+"+":"")+r},Zo=t=>{let e=String(t).split("+").map(r=>r.trim()).filter(Boolean),n={};for(let r of e){let o=r.toLowerCase();o==="ctrl"||o==="control"?n.ctrl=!0:o==="shift"?n.shift=!0:o==="alt"?n.alt=!0:o==="meta"||o==="cmd"||o==="command"||o==="win"?n.meta=!0:n.code=r}return n.code&&n.key===void 0&&(n.key=Kc(n.code,!!n.shift)),n},gx=t=>{let e=[];return t.ctrlKey&&e.push("ctrl"),t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.metaKey&&e.push("meta"),e.sort((n,r)=>["ctrl","shift","alt","meta"].indexOf(n)-["ctrl","shift","alt","meta"].indexOf(r)),(e.length?e.join("+")+"+":"")+(t.code||"")},Gf="__inGameHotkeysRemapped__",Kf="__inGameHotkeysRapidSynthetic__",Vc=class{constructor(e=!0,n){ce(this,"win");ce(this,"doc");ce(this,"enabled",!0);ce(this,"map",new Map);ce(this,"blockedSet",new Set);ce(this,"eventBlockers",new Set);ce(this,"attachedDocs",new WeakSet);ce(this,"observers",[]);ce(this,"handlers",new Map);ce(this,"passthrough",new Set(["F5","F12"]));ce(this,"sessions",new Map);let r=Yf(n);if(this.win=r.window,this.doc=r.document,e&&(this.attachDoc(this.doc),this.attachAllFrames(),this.win.MutationObserver)){let o=new this.win.MutationObserver(()=>this.attachAllFrames());o.observe(this.doc.documentElement||this.doc,{childList:!0,subtree:!0}),this.observers.push(o)}}enable(e=!0){this.enabled=!!e}disable(){this.enabled=!1}isEnabled(){return this.enabled}setMap(e){this.map.clear();for(let[n,r]of Object.entries(e||{}))this.map.set(Et(n),Zo(r))}add(e,n){this.map.set(Et(e),Zo(n))}remove(e){this.map.delete(Et(e))}clear(){this.map.clear()}current(){let e={};for(let[n,r]of this.map.entries()){let o=[];r.ctrl&&o.push("Ctrl"),r.shift&&o.push("Shift"),r.alt&&o.push("Alt"),r.meta&&o.push("Meta"),e[n]=(o.length?o.join("+")+"+":"")+(r.code||"")}return e}block(e){this.blockedSet.add(Et(e))}unblock(e){this.blockedSet.delete(Et(e))}blocked(){return Array.from(this.blockedSet)}addEventBlocker(e){return typeof e!="function"?()=>{}:(this.eventBlockers.add(e),()=>{this.eventBlockers.delete(e)})}replace(e,n){let r=Et(e),o=Et(n);this.blockedSet.add(r),this.map.set(o,Zo(r))}swap(e,n){let r=Et(e),o=Et(n);this.map.set(r,Zo(o)),this.map.set(o,Zo(r))}attachAllFrames(){this.doc.querySelectorAll("iframe").forEach(e=>{try{let n=e.contentDocument,r=n?.location?.origin;n&&r&&r===this.win.location.origin&&this.attachDoc(n)}catch{}})}destroy(){for(let[e,n]of this.handlers.entries())try{let r=e.defaultView||this.win;r.removeEventListener("keydown",n,!0),r.removeEventListener("keypress",n,!0),r.removeEventListener("keyup",n,!0)}catch{}this.handlers.clear(),this.attachedDocs=new WeakSet;for(let e of this.observers)e.disconnect();this.observers=[],this.stopAllRapidFires(),this.eventBlockers.clear()}startRapidFire(e){let n=Et(e.trigger),r=Et(e.emit??e.trigger),o=1e3/Math.max(1,e.rateHz??12),s=e.mode??"tap",i=e.keyupDelayMs??20;this.sessions.set(n,{trigger:Vf(n),emit:Vf(r),rateMs:o,mode:s,keyupDelayMs:i,pressed:!1,lastTarget:null,tickTimer:null,upTimer:null})}stopRapidFire(e){if(!e){this.stopAllRapidFires();return}let n=Et(e),r=this.sessions.get(n);r&&(this.endSession(r),this.sessions.delete(n))}stopAllRapidFires(){for(let e of this.sessions.values())this.endSession(e);this.sessions.clear()}isRapidFireActive(e){let n=this.sessions.get(Et(e));return!!(n&&n.pressed)}setRapidFireRate(e,n){let r=this.sessions.get(Et(e));r&&(r.rateMs=1e3/Math.max(1,n),r.pressed&&this.restartLoop(r))}setRapidFireMode(e,n){let r=this.sessions.get(Et(e));r&&(r.mode=n)}listRapidFires(){let e=[];for(let[n,r]of this.sessions.entries())e.push({trigger:n,emit:yx(r.emit),rateHz:Math.round(1e3/r.rateMs),mode:r.mode});return e}attachDoc(e){if(!e||this.attachedDocs.has(e))return;let n=this.makeHandler(e),r=e.defaultView||this.win;r.addEventListener("keydown",n,!0),r.addEventListener("keypress",n,!0),r.addEventListener("keyup",n,!0),this.handlers.set(e,n),this.attachedDocs.add(e)}makeHandler(e){return n=>{let r=n;if(r[Gf])return;let o=!!r[Kf];if(o||this.handleRapidFireInput(e,r),!o&&this.eventBlockers.size)for(let y of Array.from(this.eventBlockers)){let v=!1;try{v=y(r)}catch{v=!1}if(v){r.stopImmediatePropagation(),r.preventDefault();return}}if(!this.enabled||Uf(r.target)||this.passthrough.has(r.code))return;let s=gx(r);if(this.blockedSet.has(s)){r.stopImmediatePropagation(),r.preventDefault();return}let i=this.map.get(s);if(!i)return;r.stopImmediatePropagation(),r.preventDefault();let a=i.code||"",l=i.key!==void 0?i.key:Kc(a,r.shiftKey),c=i.ctrl??r.ctrlKey,d=i.shift??r.shiftKey,u=i.alt??r.altKey,p=i.meta??r.metaKey,f=zf[a]??(l&&l.length===1?l.toUpperCase().charCodeAt(0):0),h=e.defaultView||this.win,m=new h.KeyboardEvent(r.type,{bubbles:!0,cancelable:!0,composed:!0,key:l,code:a,ctrlKey:c,shiftKey:d,altKey:u,metaKey:p,repeat:r.repeat,location:r.location});Object.defineProperties(m,{keyCode:{get:()=>f},which:{get:()=>f},charCode:{get:()=>f},[Gf]:{value:!0}}),(r.target||e).dispatchEvent(m)}}handleRapidFireInput(e,n){if(!Uf(n.target)){if(n.type==="keydown"&&!n.repeat)for(let r of this.sessions.values())this.matches(n,r.trigger)&&(r.pressed=!0,r.lastTarget=n.target||e,this.startLoop(e,r));else if(n.type==="keyup")for(let r of this.sessions.values())this.matches(n,r.trigger)&&(r.pressed=!1,this.stopLoop(e,r))}}matches(e,n){return e.code===n.code&&!!e.ctrlKey==!!n.ctrl&&!!e.shiftKey==!!n.shift&&!!e.altKey==!!n.alt&&!!e.metaKey==!!n.meta}startLoop(e,n){this.stopLoop(e,n);let r=()=>{n.pressed&&(this.dispatchKey(e,n.lastTarget||e,"keydown",n.emit,!0),n.mode==="tap"&&(n.upTimer&&this.win.clearTimeout(n.upTimer),n.upTimer=this.win.setTimeout(()=>{this.dispatchKey(e,n.lastTarget||e,"keyup",n.emit,!1)},n.keyupDelayMs)))};r(),n.tickTimer=this.win.setInterval(r,n.rateMs)}stopLoop(e,n){n.tickTimer&&(this.win.clearInterval(n.tickTimer),n.tickTimer=null),n.upTimer&&(this.win.clearTimeout(n.upTimer),n.upTimer=null),n.mode==="hold"&&n.lastTarget&&this.dispatchKey(e,n.lastTarget,"keyup",n.emit,!1)}restartLoop(e){if(!e.pressed)return;let n=this.doc;this.startLoop(n,e)}endSession(e){this.stopLoop(this.doc,e),e.pressed=!1,e.lastTarget=null}dispatchKey(e,n,r,o,s){let i=o.code,a=Kc(i,o.shift),l=zf[i]??(a&&a.length===1?a.toUpperCase().charCodeAt(0):0),c=e.defaultView||this.win,d=new c.KeyboardEvent(r,{bubbles:!0,cancelable:!0,composed:!0,key:a,code:i,ctrlKey:o.ctrl,shiftKey:o.shift,altKey:o.alt,metaKey:o.meta,repeat:s});Object.defineProperties(d,{keyCode:{get:()=>l},which:{get:()=>l},charCode:{get:()=>l},[Kf]:{value:!0}});try{n.dispatchEvent(d)}catch{e.dispatchEvent(d)}}};function Vf(t){let e=String(t).split("+").map(a=>a.trim()).filter(Boolean),n="",r=!1,o=!1,s=!1,i=!1;for(let a of e){let l=a.toLowerCase();l==="ctrl"||l==="control"?r=!0:l==="shift"?o=!0:l==="alt"?s=!0:l==="meta"||l==="cmd"||l==="command"||l==="win"?i=!0:n=a}return{code:n,ctrl:r,shift:o,alt:s,meta:i}}function yx(t){let e=[];return t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push("Meta"),e.push(t.code),e.join("+")}var bx=Yf(),Yt=new Vc(!0,bx);Mt("inGameHotkeys",Yt);try{window.inGameHotkeys=Yt}catch{}var vx=[{id:"gui",title:"GUI",icon:"\u{1F5A5}\uFE0F",description:"Choose how you open and move the overlay.",actions:[{id:"gui.toggle",label:"\u{1F441}\uFE0F Toggle menu visibility",hint:"Opens or closes the Arie's Mod overlay.",defaultHotkey:{alt:!0,code:"KeyX"}},{id:"gui.drag",label:"\u270B Drag HUD",hint:"Hold to drag menus interfaces around the screen.",defaultHotkey:{alt:!0,code:"AltLeft"},allowModifierOnly:!0}]},{id:"shops",title:"Shops",icon:"\u{1F6D2}",description:"Quick shortcuts to every shop tab.",actions:[{id:"shops.seeds",label:"\u{1F330} Seeds shop",defaultHotkey:{alt:!0,code:"KeyS"}},{id:"shops.eggs",label:"\u{1F95A} Eggs shop",defaultHotkey:{alt:!0,code:"KeyE"}},{id:"shops.decors",label:"\u{1FA91} Decors shop",defaultHotkey:{alt:!0,code:"KeyD"}},{id:"shops.tools",label:"\u{1F9FA} Tools shop",defaultHotkey:{alt:!0,code:"KeyT"}}]},{id:"game",title:"Game",icon:"\u{1F3AE}",description:"Remap the in-game actions",actions:[{id:"game.action",label:"\u26A1 Action",defaultHotkey:{code:"Space"},holdDetection:{label:"Hold to repeat",defaultEnabled:!1}},{id:"game.inventory",label:"\u{1F392} Inventory",defaultHotkey:{code:"KeyE"}},{id:"game.move-up",label:"\u2B06 Move up",defaultHotkey:{code:"KeyW"}},{id:"game.move-down",label:"\u2B07 Move down",defaultHotkey:{code:"KeyS"}},{id:"game.move-left",label:"\u2B05 Move left",defaultHotkey:{code:"KeyA"}},{id:"game.move-right",label:"\u27A1 Move right",defaultHotkey:{code:"KeyD"}}]},{id:"sell",title:"Sell",icon:"\u{1F4B0}",description:"Streamline selling actions.",actions:[{id:"sell.sell-all",label:"\u{1F33E} All crops",hint:"Trigger the sell-all flow for harvested crops.",defaultHotkey:null},{id:"sell.sell-all-pets",label:"\u{1F43E} All pets",hint:"Sell every non-favorited pet in your inventory.",defaultHotkey:null}]}],Jc="qws:keybind:",Qc="qws:keybind-hold:",Zf="__none__",es=new Map,ts=new Map,_n=new Map,Vr=new Map,sr=new Map,$r=new Map,Yr=new Map,Xf=vx.map(t=>{let e=t.actions.map(n=>{let r={id:n.id,sectionId:t.id,label:n.label,hint:n.hint,allowModifierOnly:n.allowModifierOnly,defaultHotkey:jt(n.defaultHotkey),holdDetection:n.holdDetection?{label:n.holdDetection.label,description:n.holdDetection.description,defaultEnabled:n.holdDetection.defaultEnabled}:void 0};return es.set(r.id,r),ts.set(r.id,jt(n.defaultHotkey)),n.holdDetection&&sr.set(r.id,!!n.holdDetection.defaultEnabled),r});return{id:t.id,title:t.title,description:t.description,icon:t.icon,actions:e}}),Xo="pets",wx="pets.team.",ta="pets.team.next",na="pets.team.prev",ed={id:Xo,title:"Pets",icon:"\u{1F437}",description:"Assign shortcuts to your pet teams and cycle through them instantly.",actions:[]};Xf.push(ed);var Zc=new Set;function ns(t){return`${wx}${t}`}function Sx(t){es.delete(t),ts.delete(t),_n.delete(t),Vr.delete(t),sr.delete(t),$r.delete(t),Yr.delete(t)}function Yc(t,e){let n={id:t.id,sectionId:Xo,label:t.label,hint:t.hint,allowModifierOnly:t.allowModifierOnly,defaultHotkey:jt(e),holdDetection:t.holdDetection?{label:t.holdDetection.label,description:t.holdDetection.description,defaultEnabled:t.holdDetection.defaultEnabled}:void 0};es.set(n.id,n),ts.set(n.id,jt(e)),Zc.add(n.id),ed.actions.push(n)}function td(t){for(let e of Zc)Sx(e);Zc.clear(),ed.actions=[],Yc({id:na,sectionId:Xo,label:"\u25C0\uFE0F Previous team",defaultHotkey:null},null),Yc({id:ta,sectionId:Xo,label:"\u25B6\uFE0F Next team",defaultHotkey:null},null),t.forEach((e,n)=>{let r=String(e?.name||"").trim(),o=r.length?r:`Team ${n+1}`;Yc({id:ns(e.id),sectionId:Xo,label:`Use team \u2014 ${o}`,defaultHotkey:null},null)})}td([]);var xx={"game.action":"Space","game.inventory":"KeyE","game.move-up":"KeyW","game.move-down":"KeyS","game.move-left":"KeyA","game.move-right":"KeyD"},Ex=["game.action","game.inventory","game.move-up","game.move-down","game.move-left","game.move-right"],Zi=new Map,$f=!1,Xc="game.action",Cx=new Set,Qi=new Set;function Tx(){let t=Zi.get(Xc);if(!t)return[];let e=t.combo;return typeof e=="string"&&e.length?[e]:[]}function Jf(){let t=Cx.size>0,e=new Set;if(t)for(let n of Tx())n&&e.add(n);for(let n of Qi)if(!e.has(n))try{Yt.unblock(n)}catch{}if(t){for(let n of e)if(!Qi.has(n))try{Yt.block(n)}catch{}}if(Qi.clear(),t)for(let n of e)Qi.add(n)}function kx(t){if(!t)return null;let e=Lt(t);return e.length?e:null}function Ix(t){try{Yt.unblock(t)}catch{}try{let e=Yt.current();for(let[n,r]of Object.entries(e))if(String(r).split("+").pop()===t)try{Yt.remove(n)}catch{}}catch{}}function em(){return typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(navigator.platform||"")}function Ax(t){if(!t)return"";let e=t.match(/^Key([A-Z])$/);if(e)return e[1];let n=t.match(/^Digit([0-9])$/);return n?n[1]:t==="ControlLeft"||t==="ControlRight"?"Ctrl":t==="AltLeft"||t==="AltRight"?"Alt":t==="ShiftLeft"||t==="ShiftRight"?"Shift":t==="MetaLeft"||t==="MetaRight"?em()?"\u2318":"Win":t==="Space"?"Space":t==="Enter"?"Enter":t==="Escape"?"Esc":t==="Tab"?"Tab":t==="Backspace"?"Backspace":t==="Delete"?"Del":t==="Insert"?"Ins":t==="ArrowUp"?"\u2191":t==="ArrowDown"?"\u2193":t==="ArrowLeft"?"\u2190":t==="ArrowRight"?"\u2192":t}function Mx(t){if(!t)return"\u2014";let e=[];t.ctrl&&e.push("Ctrl"),t.shift&&e.push("Shift"),t.alt&&e.push("Alt"),t.meta&&e.push(em()?"\u2318":"Win");let n="",r=t.key;return typeof r=="string"&&r.length===1?n=r.toUpperCase():n=Ax(t.code),(n&&["Ctrl","Shift","Alt","\u2318","Win"].includes(n)?e:e.concat(n?[n]:[])).join(" + ")}function $c(t){if(typeof window>"u")return;let e=xx[t];Ix(e);let n=Zi.get(t);if(n){if(n.rapidFire)try{Yt.stopRapidFire(n.combo)}catch{}Zi.delete(t)}let r=kx(lt(t));if(!r){t===Xc&&Jf();return}let o=os(t),s=!1;if(r!==e)try{Yt.replace(e,r),s=!0}catch{}let i=!1;if(o)try{Yt.startRapidFire({trigger:r,emit:r,mode:"tap",rateHz:10}),i=!0}catch{}Zi.set(t,{combo:r,replaced:s,rapidFire:i}),t===Xc&&Jf()}function jt(t){return t?{...t}:null}function Px(t,e){return!t&&!e?!0:!t||!e?!1:Lt(t)===Lt(e)}function Xi(t){return`${Jc}${t}`}function tm(t){return`${Qc}${t}`}function Rx(t){if(typeof window>"u")return;let e=null;try{e=window.localStorage.getItem(Xi(t))}catch{return}return e==null?void 0:e===Zf?null:Qo(e)??null}function Qf(t,e){if(!(typeof window>"u"))try{e?window.localStorage.setItem(Xi(t),Lt(e)):window.localStorage.setItem(Xi(t),Zf)}catch{}}function _x(t){if(!(typeof window>"u"))try{window.localStorage.removeItem(Xi(t))}catch{}}function Lx(t){if(typeof window>"u")return;let e=null;try{e=window.localStorage.getItem(tm(t))}catch{return}if(e!=null)return e==="1"}function Nx(t,e){if(!(typeof window>"u"))try{window.localStorage.setItem(tm(t),e?"1":"0")}catch{}}function nm(t){let e=Yr.get(t);if(!e||e.size===0)return;let n=os(t);for(let r of e)r(n)}function ea(t){let e=Vr.get(t);if(!e||e.size===0)return;let n=jt(lt(t));for(let r of e)r(n)}function Ox(t){if(_n.has(t))return jt(_n.get(t)??null);let e=Rx(t),n=jt(e===void 0?ts.get(t)??null:e);return _n.set(t,n),jt(n)}function rm(t){if(!sr.has(t))return!1;if($r.has(t))return $r.get(t)??!1;let e=Lx(t),n=e===void 0?!!sr.get(t):e;return $r.set(t,n),n}function lt(t){return Ox(t)}function om(t){return jt(ts.get(t)??null)}function rs(t,e){let n=lt(t);if(Px(n,e))return;let r=jt(e);if(r){let o=Lt(r);for(let s of es.keys()){if(s===t)continue;let i=lt(s);i&&Lt(i)===o&&(_n.set(s,null),Qf(s,null),ea(s))}}_n.set(t,r),Qf(t,r),ea(t)}function sm(t){_n.delete(t),_x(t),ea(t)}function os(t){return rm(t)}function nd(t,e){!sr.has(t)||rm(t)===e||($r.set(t,e),Nx(t,e),nm(t))}function ra(t,e){if(!sr.has(t))return()=>{};let n=Yr.get(t)??new Set;return Yr.has(t)||Yr.set(t,n),n.add(e),()=>{n.delete(e),n.size===0&&Yr.delete(t)}}function an(t,e){let n=Vr.get(t)??new Set;return Vr.has(t)||Vr.set(t,n),n.add(e),()=>{n.delete(e),n.size===0&&Vr.delete(t)}}function ss(t,e){return Kr(e,lt(t))}function im(){if(!($f||typeof window>"u")){$f=!0;for(let t of Ex)$c(t),an(t,()=>$c(t)),ra(t,()=>$c(t))}}function am(t){return Mx(lt(t))}function lm(){return Xf.map(t=>({...t,actions:t.actions.map(e=>({...e,defaultHotkey:jt(e.defaultHotkey),holdDetection:e.holdDetection?{label:e.holdDetection.label,description:e.holdDetection.description,defaultEnabled:e.holdDetection.defaultEnabled}:void 0}))}))}typeof window<"u"&&(window.addEventListener("storage",t=>{if(!t.key||!t.key.startsWith(Jc))return;let e=t.key.slice(Jc.length);es.has(e)&&(_n.delete(e),ea(e))}),window.addEventListener("storage",t=>{if(!t.key||!t.key.startsWith(Qc))return;let e=t.key.slice(Qc.length);sr.has(e)&&($r.delete(e),nm(e))}));function Jr(t){let e=t.target;return e?e.isContentEditable||e.tagName==="INPUT"||e.tagName==="TEXTAREA"||e.tagName==="SELECT":!1}var vm="qws:pets:overrides:v1",wm="qws:pets:ui:v1",Sm="qws:pets:teams:v1",xm="qws:pets:teamSearch:v1",qx="qws:hk:petteam:use:",ls=new Map,rd=new Map,cd=null,dd=null,oa=null,sa=null,vt=[],Ln=null,cm=t=>`${qx}${t}`;function dm(t){let e=lt(ns(t));e?ls.set(t,e):ls.delete(t)}function um(){cd=lt(ta)}function pm(){dd=lt(na)}function Dx(t){if(!(typeof window>"u"))try{let e=localStorage.getItem(cm(t));if(!e)return;let n=ns(t);if(!lt(n)){let o=Qo(e);o&&rs(n,o)}localStorage.removeItem(cm(t))}catch{}}function Bx(t){return Array.isArray(t)?t.map(e=>({id:String(e?.id??""),name:e?.name??null})).filter(e=>e.id.length>0):[]}function Fx(){if(!vt.length){Ln=null;return}(!Ln||!vt.includes(Ln))&&(Ln=vt[0]??null)}function fm(t){if(!vt.length)return null;if(!Ln||!vt.includes(Ln))return t===1?vt[0]??null:vt[vt.length-1]??null;if(vt.length===1)return vt[0]??null;let n=vt.indexOf(Ln)+t;return n<0&&(n=vt.length-1),n>=vt.length&&(n=0),vt[n]??null}function Em(t){Ln=t?String(t):null}function ps(t){for(let r of rd.values())try{r()}catch{}if(rd.clear(),oa){try{oa()}catch{}oa=null}if(sa){try{sa()}catch{}sa=null}let e=Bx(t);td(e),vt=e.map(r=>r.id),Fx();let n=new Set(vt);for(let r of Array.from(ls.keys()))n.has(r)||ls.delete(r);e.forEach(r=>{Dx(r.id),dm(r.id);let o=an(ns(r.id),()=>dm(r.id));rd.set(r.id,o)}),um(),pm(),oa=an(ta,()=>um()),sa=an(na,()=>pm())}function ma(t){let e="__qws_pet_team_hk_installed";window[e]||(window.addEventListener("keydown",n=>{if(Jr(n))return;let r=o=>{o&&(Em(o),t(o))};if(dd&&Kr(n,dd)){let o=fm(-1);if(o){n.preventDefault(),n.stopPropagation(),r(o);return}}if(cd&&Kr(n,cd)){let o=fm(1);if(o){n.preventDefault(),n.stopPropagation(),r(o);return}}for(let[o,s]of ls)if(Kr(n,s)){n.preventDefault(),n.stopPropagation(),r(o);break}},!0),window[e]=!0)}var Qr=xt??{};function od(t){let e=String(t??""),n=typeof Qr?.[e]?.name=="string"&&Qr[e].name.trim()?Qr[e].name:e;return String(n)}function Cm(t){let e=String(t??""),n=typeof Qr?.[e]?.name=="string"&&Qr[e].name.trim()?Qr[e].name:e;return String(n).replace(/(?:\s+|-)?(?:I|II|III|IV|V|VI|VII|VIII|IX|X)\s*$/,"").trim()}function Hx(t){let e=String(t||"").trim(),n=e.match(/^(ab|sp):\s*(.*)$/i);return n?{mode:n[1].toLowerCase()==="ab"?"ability":"species",value:(n[2]||"").trim()}:{mode:"text",value:e}}async function Wx(t){await as();let e=String(t||"").toLowerCase().trim().replace(/(?:\s+|-)?(?:i|ii|iii|iv|v|vi|vii|viii|ix|x)\s*$/i,""),n=new Set;if(!e)return n;for(let r of ds){let o=Array.isArray(r.abilities)?r.abilities:[];for(let s of o)Cm(s).toLowerCase()===e&&n.add(s)}return n}var bt=t=>(t??"").toLowerCase(),Tm=t=>typeof t=="string"?t:null,da=t=>Number.isFinite(t)?t:0,ua=t=>Array.isArray(t)?t.filter(e=>typeof e=="string"):[];function jx(t){if(!t||ot[t])return t;let e=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return ot[e]?e:t}function mm(t){return{id:t.id,itemType:"Pet",petSpecies:jx(t.petSpecies),name:t.name??null,xp:t.xp,hunger:t.hunger,mutations:Array.isArray(t.mutations)?t.mutations.slice():[],targetScale:t.targetScale,abilities:Array.isArray(t.abilities)?t.abilities.slice():[]}}function km(){try{let t=localStorage.getItem(Sm);if(!t)return[];let e=JSON.parse(t);return Array.isArray(e)?e.map(n=>({id:String(n?.id||""),name:String(n?.name||"Team"),slots:Array.isArray(n?.slots)?n.slots.slice(0,3).map(r=>r?String(r):null):[null,null,null]})).filter(n=>n.id):[]}catch{return[]}}function ia(t){try{localStorage.setItem(Sm,JSON.stringify(t))}catch{}}function zx(){try{return crypto.randomUUID()}catch{return`t_${Date.now().toString(36)}_${Math.random().toString(16).slice(2)}`}}function Ux(){try{let t=localStorage.getItem(xm),e=t?JSON.parse(t):{};return e&&typeof e=="object"?e:{}}catch{return{}}}function Gx(t){try{localStorage.setItem(xm,JSON.stringify(t))}catch{}}var EL=km();var sd=Ux(),ir=null,cs=[],ds=[],Im=null,Am=null,aa=null,la=null;function pa(t){if(!t||t.itemType!=="Pet")return null;let e=bt(t.id);return e?{id:e,itemType:"Pet",petSpecies:bt(t.petSpecies??t.data?.petSpecies),name:Tm(t.name??t.data?.name??null),xp:da(t.xp??t.data?.xp),hunger:da(t.hunger??t.data?.hunger),mutations:ua(t.mutations??t.data?.mutations),targetScale:Number.isFinite(t.targetScale??t.data?.targetScale)?Number(t.targetScale??t.data?.targetScale):void 0,abilities:ua(t.abilities??t.data?.abilities)}:null}function Mm(t){let e=t?.slot;if(!e||typeof e!="object")return null;let n=bt(e.id);return n?{id:n,itemType:"Pet",petSpecies:bt(e.petSpecies),name:Tm(e.name??null),xp:da(e.xp),hunger:da(e.hunger),mutations:ua(e.mutations),targetScale:Number.isFinite(e.targetScale)?Number(e.targetScale):void 0,abilities:ua(e.abilities)}:null}function Pm(t){return JSON.stringify({id:t.id,itemType:"Pet",petSpecies:t.petSpecies,name:t.name??null,mutations:Array.isArray(t.mutations)?t.mutations:[],targetScale:Number.isFinite(t.targetScale)?t.targetScale:null,abilities:Array.isArray(t.abilities)?t.abilities:[]})}function ud(t){let e=new Map,n=Array.isArray(t?.items)?t.items:Array.isArray(t)?t:[];for(let r of n){let o=pa(r);o&&e.set(o.id,Pm(o))}return e}function pd(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let o=Mm(r);o&&e.set(o.id,Pm(o))}return e}function Rm(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}function us(){let t=new Map,e=Array.isArray(ir?.items)?ir.items:Array.isArray(ir)?ir:[];for(let r of e){let o=pa(r);o&&o.id&&t.set(o.id,o)}let n=Array.isArray(cs)?cs:[];for(let r of n){let o=Mm(r);o&&o.id&&t.set(o.id,o)}ds=Array.from(t.values())}async function Kx(){let t=await(async()=>{try{let e=await pe.inventory.myInventory.get();aa=ud(e),ir=e,us()}catch{}return pe.inventory.myInventory.onChange(e=>{let n=ud(e);Rm(aa,n)||(aa=n,ir=e,us())})})();Im=()=>{try{t()}catch{}}}async function Vx(){let t=await(async()=>{try{let e=await pe.pets.myPetInfos.get();la=pd(e),cs=Array.isArray(e)?e:[],us()}catch{}return pe.pets.myPetInfos.onChange(e=>{let n=pd(e);Rm(la,n)||(la=n,cs=Array.isArray(e)?e:[],us())})})();Am=()=>{try{t()}catch{}}}async function as(){if(Im||await Kx(),Am||await Vx(),!ds.length)try{let[t,e]=await Promise.all([pe.inventory.myInventory.get(),pe.pets.myPetInfos.get()]);aa=ud(t),la=pd(e),ir=t,cs=Array.isArray(e)?e:[],us()}catch{}}async function bn(){try{await pe.inventory.setSelectedIndexToEnd.set(null)}catch{}try{await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(null)}catch{}try{await Se.setSelectedItem(null)}catch{}try{await Se.dropObject()}catch{}}async function hm(t=2e4){await bn();let e=performance.now();for(;performance.now()-e<t;){try{let n=await pe.ui.activeModal.get();if(!Vi(n))return null}catch{return null}try{let n=await pe.inventory.myValidatedSelectedItemIndex.get();if(typeof n=="number"&&Number.isInteger(n)&&n>=0)return n}catch{}await new Promise(n=>setTimeout(n,80))}return null}var ca=new Map,gm={enabled:!1,thresholdPct:10,crops:{}},id={selectedPetId:null},fa=[],fd=null;function ym(t){try{localStorage.setItem(vm,JSON.stringify(t))}catch{}}function ad(){try{let t=localStorage.getItem(vm);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch{return{}}}function Yx(t){try{localStorage.setItem(wm,JSON.stringify(t))}catch{}}function bm(){try{let t=localStorage.getItem(wm);if(!t)return{...id};let e=JSON.parse(t);return{...id,...e||{}}}catch{return{...id}}}function is(t){let e=t??gm;return{enabled:!!e.enabled,thresholdPct:Math.min(100,Math.max(1,Number(e.thresholdPct)||gm.thresholdPct)),crops:{...e.crops||{}}}}function $x(t){return Math.max(0,Math.min(100,t))}function Jx(t){let n=ot?.[t],r=n?.diet??n?.compatibleCrops??n?.crops??[];return(Array.isArray(r)?r:[]).filter(s=>typeof s=="string"&&s.length>0)}function Qx(t){let e=ot?.[t]?.coinsToFullyReplenishHunger;return typeof e=="number"&&Number.isFinite(e)&&e>0?e:3e3}async function Zx(t){try{let e=await Se.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===String(t))??null}catch{return null}}function Xx(t,e){let n=Array.isArray(e)?e:[];for(let r of n){let o=String(r?.species||"");if(o&&t.has(o))return r}return null}function eE(t){try{fd?.(t)}catch{}}async function tE(t){let e=String(t?.slot?.id||"");if(!e)return;let n=Te.getOverride(e);if(!n.enabled){ca.set(e,!1);return}let r=Te.getHungerPctFor(t),o=Math.max(1,Math.min(100,n.thresholdPct|0||10)),s=ca.get(e)===!0,i=r<o;if(i&&!s){let a;try{a=await Te.getPetAllowedCrops(e)}catch{let u=String(t?.slot?.petSpecies||"");a=new Set(Te.getCompatibleCropsForSpecies(u))}let l=Array.from(a),c=null,d=!1;try{let[u,p]=await Promise.all([Se.getCropInventoryState(),Se.getFavoriteIds?.()??[]]),f=Array.isArray(u)?u:[],h=new Set(Array.isArray(p)?p:[]),m=f.filter(g=>!h.has(String(g?.id)));if(c=Xx(a,m),c?.id&&Se.feedPet)try{await Se.feedPet(e,c.id)}catch{}}catch{}eE({pet:t,petId:e,species:String(t?.slot?.petSpecies||""),hungerPct:r,thresholdPct:o,allowedCrops:l,chosenItem:c,didUnfavorite:d})}ca.set(e,i)}async function ld(){let t=Array.isArray(fa)?fa:[];for(let e of t)try{await tE(e)}catch{}}var Te={getPets(){return Se.getPets()},onPetsChange(t){return Se.onPetsChange(t)},onPetsChangeNow(t){return Se.onPetsChangeNow(t)},getAbilityName(t){return od(t)},getAbilityNameWithoutLevel(t){return Cm(t)},setUIState(t){let n={...bm(),...t||{}};return Yx(n),n},setSelectedPet(t){return this.setUIState({selectedPetId:t})},getSelectedPetId(){return bm().selectedPetId??null},getOverride(t){let e=ad();return is(e[t])},setOverride(t,e){let n=ad(),r=is(n[t]),o={enabled:e.enabled??r.enabled,thresholdPct:Number.isFinite(e.thresholdPct)?Math.min(100,Math.max(1,Number(e.thresholdPct))):r.thresholdPct,crops:{...r.crops,...e.crops||{}}};return n[t]=o,ym(n),ld(),o},updateOverride(t,e){let n=ad(),r=is(n[t]),o=is(e(r));return n[t]=o,ym(n),ld(),o},async setPetAutofeedEnabled(t,e){return this.setOverride(t,{enabled:!!e})},getPetAutofeedEnabled(t){return this.getOverride(t).enabled},async setPetAutofeedThresholdPct(t,e){let n=Math.min(100,Math.max(1,Math.floor(Number(e)||10)));return this.setOverride(t,{thresholdPct:n})},getPetAutofeedThresholdPct(t){return this.getOverride(t).thresholdPct},async setPetAllowedCrop(t,e,n){return this.updateOverride(t,r=>{let o=is(r),s=o.crops[e]??{allowed:!0};return o.crops[e]={allowed:n??s.allowed},o})},async getPetAllowedCrops(t){let e=this.getOverride(t),r=(await Zx(t))?.slot?.petSpecies||"",o=this.getCompatibleCropsForSpecies(r),s=new Set;for(let i of o){let a=e.crops[i];(!a||a.allowed)&&s.add(i)}return s},getCompatibleCropsForSpecies(t){return Jx(t)},getMaxHungerForSpecies(t){return Qx(t)},getHungerPctFor(t){let e=Number(t?.slot?.hunger)||0,n=String(t?.slot?.petSpecies||""),r=this.getMaxHungerForSpecies(n),o=e/r*100;return+$x(o).toFixed(1)},async startAutofeedWatcher(t){fd=t??null;let e=await Se.onPetsChangeNow(n=>{fa=Array.isArray(n)?n.slice():[],ld()});return()=>{try{e()}catch{}fa=[],ca.clear(),fd=null}},_teams:km(),_teamSubs:new Set,_notifyTeamSubs(){let t=this.getTeams();this._teamSubs.forEach(e=>{try{e(t)}catch{}})},getTeams(){return Array.isArray(this._teams)?this._teams.map(t=>({...t,slots:t.slots.slice(0,3)})):[]},onTeamsChange(t){this._teamSubs.add(t);try{t(this.getTeams())}catch{}return()=>{this._teamSubs.delete(t)}},async onTeamsChangeNow(t){let e=this.onTeamsChange(t);try{t(this.getTeams())}catch{}return e},createTeam(t){let e={id:zx(),name:t?.trim()||`Team ${this._teams.length+1}`,slots:[null,null,null]};return this._teams.push(e),ia(this._teams),this._notifyTeamSubs(),e},deleteTeam(t){let e=this._teams.findIndex(n=>n.id===t);return e<0?!1:(this._teams.splice(e,1),ia(this._teams),this._notifyTeamSubs(),!0)},saveTeam(t){let e=this._teams.findIndex(o=>o.id===t.id);if(e<0)return null;let n=this._teams[e],r={id:n.id,name:typeof t.name=="string"?t.name:n.name,slots:Array.isArray(t.slots)?t.slots.slice(0,3):n.slots};return this._teams[e]=r,ia(this._teams),this._notifyTeamSubs(),r},setTeamsOrder(t){let e=new Map(this._teams.map(r=>[r.id,r])),n=[];for(let r of t){let o=e.get(r);o&&(n.push(o),e.delete(r))}for(let r of e.values())n.push(r);this._teams=n,ia(this._teams),this._notifyTeamSubs()},getTeamById(t){let e=this._teams.find(n=>n.id===t)||null;return e?{...e,slots:e.slots.slice(0,3)}:null},getTeamSearch(t){return sd[t]||""},setTeamSearch(t,e){sd[t]=(e||"").trim(),Gx(sd)},async getInventoryPets(){return await as(),ds.slice()},async buildFilteredInventoryForTeam(t,e){await as();let{mode:n,value:r}=Hx(this.getTeamSearch(t)||""),o=await this.getInventoryPets();if(n==="ability"&&r){let a=await Wx(r);o=a.size?o.filter(l=>Array.isArray(l.abilities)&&l.abilities.some(c=>a.has(c))):[]}else if(n==="species"&&r){let a=r.toLowerCase();o=o.filter(l=>(l.petSpecies||"").toLowerCase()===a)}else if(r){let a=r.toLowerCase();o=o.filter(l=>bt(l.id).includes(a)||bt(l.petSpecies).includes(a)||bt(l.name).includes(a)||Array.isArray(l.abilities)&&l.abilities.some(c=>bt(c).includes(a)||bt(od(c)).includes(a))||Array.isArray(l.mutations)&&l.mutations.some(c=>bt(c).includes(a)))}if(e?.excludeIds?.size){let a=e.excludeIds;o=o.filter(l=>!a.has(l.id))}let s=o.map(mm),i=[];try{let a=await pe.inventory.favoriteIds.get().catch(()=>[]),l=new Set(o.map(c=>c.id));i=(a||[]).filter(c=>l.has(c))}catch{}return{items:s,favoritedItemIds:i}},async buildFilteredInventoryByQuery(t,e){await as();let n=(t||"").toLowerCase().trim(),r=await this.getInventoryPets();if(n&&(r=r.filter(i=>bt(i.id).includes(n)||bt(i.petSpecies).includes(n)||bt(i.name).includes(n)||Array.isArray(i.abilities)&&i.abilities.some(a=>bt(a).includes(n)||bt(od(a)).includes(n))||Array.isArray(i.mutations)&&i.mutations.some(a=>bt(a).includes(n)))),e?.excludeIds?.size){let i=e.excludeIds;r=r.filter(a=>!i.has(a.id))}let o=r.map(mm),s=[];try{let i=await pe.inventory.favoriteIds.get().catch(()=>[]),a=new Set(r.map(l=>l.id));s=(i||[]).filter(l=>a.has(l))}catch{}return{items:o,favoritedItemIds:s}},async chooseSlotPet(t,e,n){let r=Math.max(0,Math.min(2,Math.floor(e||0))),o=this.getTeamById(t);if(!o)return null;let s=new Set;o.slots.forEach((u,p)=>{p!==r&&u&&s.add(String(u))});let i=n&&n.trim().length?await this.buildFilteredInventoryByQuery(n,{excludeIds:s}):await this.buildFilteredInventoryForTeam(t,{excludeIds:s}),a=Array.isArray(i?.items)?i.items:[];if(!a.length)return null;await Wt(i,{open:!0});let l=await hm(2e4);if(await Rn(),l==null||l<0||l>=a.length)return null;let c=pa(a[l]);if(!c)return null;let d=o.slots.slice(0,3);d[r]=String(c.id),this.saveTeam({id:o.id,slots:d});try{await bn()}catch{}return c},async pickPetViaFakeInventory(t){let e=await this.buildFilteredInventoryByQuery(t||""),n=Array.isArray(e?.items)?e.items:[];if(!n.length)return null;await Wt(e,{open:!0});let r=await hm(2e4);return await Rn(),r==null||r<0||r>=n.length?null:(await bn(),pa(n[r]))},async useTeam(t){let e=this.getTeams().find(o=>o.id===t)||null;if(!e)throw new Error("Team not found");let n=(e.slots||[]).filter(o=>typeof o=="string"&&o.length>0).slice(0,3),r=await rE(n);return Em(t),r},_logs:[],_logsMax:500,_seenPerfByPet:new Map,_logSubs:new Set,_logsCutoffMs:0,_logsCutoffSkewMs:1500,_logsStorageKey:"qws:pets:abilityLogs:v1",_logsSessionStart:Date.now(),_extractAbilityValue(t,e){let n=s=>{let i=Number(s);return Number.isFinite(i)?Math.max(0,i):0},r=e??{},o=xt[t]?.baseParameters??{};switch(t){case"CoinFinderI":case"CoinFinderII":case"CoinFinderIII":{let s=r.coinsFound??r.coins??0;return n(s)}case"SellBoostI":case"SellBoostII":case"SellBoostIII":case"SellBoostIV":{let s=r.bonusCoins??r.coinsEarned??0;return n(s)}case"ProduceEater":return n(r.sellPrice??0);case"EggGrowthBoost":case"EggGrowthBoostII":case"EggGrowthBoostIII":{let s=r.eggGrowthTimeReductionMinutes??r.reductionMinutes??o.eggGrowthTimeReductionMinutes??0;return n(s)*60*1e3}case"PlantGrowthBoost":case"PlantGrowthBoostII":{let s=r.reductionMinutes??r.plantGrowthReductionMinutes??o.plantGrowthReductionMinutes??0;return n(s)*60*1e3}case"PetXpBoost":case"PetXpBoostII":{let s=r.bonusXp??o.bonusXp??0;return n(s)}case"PetHatchSizeBoost":case"PetHatchSizeBoostII":{let s=r.strengthIncrease??0;return n(s)}case"HungerRestore":case"HungerRestoreII":{let s=r.hungerRestoredPercentage??o.hungerRestorePercentage??0;return n(s)}default:return 0}},async startAbilityLogsWatcher(){await as();let t=s=>{let i={},a=Array.isArray(s)?s:[];for(let l of a){let c=String(l?.slot?.id??l?.id??"");c&&(i[c]=l)}return i},e={};try{e=t(await pe.pets.myPetInfos.get())}catch{}let n=null;try{n=await pe.pets.myPetInfos.onChange(s=>{try{e=t(s)}catch{}})}catch{}let r=s=>{let i={};if(!s||typeof s!="object")return i;let a=s;for(let l of Object.keys(a)){let c=a[l]??{},d=c.lastAbilityTrigger??null,u=c.hungerPct??c.hunger_percentage??c.hunger??c.stats?.hungerPct??c.stats?.hunger?.pct??c.stats?.hunger?.percent??null;if(u==null){let f=e[l];u=f?.hungerPct??f?.hunger_percentage??f?.hunger??f?.slot?.hungerPct??f?.slot?.hunger??f?.stats?.hungerPct??f?.stats?.hunger?.pct??f?.stats?.hunger?.percent??null}let p=Number.isFinite(Number(u))?Number(u):null;p!=null&&p>0&&p<=1&&(p*=100),i[l]={petId:l,abilityId:d?.abilityId??null,performedAt:Number.isFinite(d?.performedAt)?d.performedAt:null,data:d?.data??null,position:c.position??null,hungerPct:p}}return i};try{this._ingestAbilityMap(r(await pe.pets.myPetSlotInfos.get()))}catch{}let o=await pe.pets.myPetSlotInfos.onChange(s=>{try{this._ingestAbilityMap(r(s))}catch{}});return()=>{try{o()}catch{}try{n?.()}catch{}}},getAbilityLogs(t){let e=t?.abilityIds&&t.abilityIds.length?new Set(t.abilityIds):null,n=Number.isFinite(t?.since)?t.since:0,r=Math.max(0,Math.floor(t?.limit??0)),o=this._logs.filter(s=>(n?s.performedAt>=n:!0)&&(e?e.has(s.abilityId):!0));return o=o.sort((s,i)=>i.performedAt-s.performedAt),r?o.slice(0,r):o},getAbilityLogsSessionStart(){return this._logsSessionStart},onAbilityLogs(t){this._logSubs.add(t);try{t(this.getAbilityLogs())}catch{}return()=>{this._logSubs.delete(t)}},getSeenAbilityIds(){let t=new Set;for(let e of this._logs)t.add(e.abilityId);return Array.from(t).sort()},clearAbilityLogs(){this._logs.length=0,this._seenPerfByPet.clear(),this._logsCutoffMs=Date.now(),this._notifyLogSubs(),this._persistAbilityLogs()},_notifyLogSubs(){let t=this.getAbilityLogs();this._logSubs.forEach(e=>{try{e(t)}catch{}})},_pushLog(t){this._logs.push(t),this._logs.length>this._logsMax&&this._logs.splice(0,this._logs.length-this._logsMax),this._notifyLogSubs(),this._persistAbilityLogs()},_getLogsStorage(){if(typeof window>"u")return null;try{return typeof window.localStorage>"u"?null:window.localStorage}catch{return null}},_persistAbilityLogs(){let t=this._getLogsStorage();if(t)try{let e={version:1,cutoff:this._logsCutoffMs,logs:this._logs.map(n=>({petId:n.petId,species:n.species??null,name:n.name??null,abilityId:n.abilityId,abilityName:n.abilityName,data:n.data,performedAt:n.performedAt,time12:n.time12}))};t.setItem(this._logsStorageKey,JSON.stringify(e))}catch{}},_restoreAbilityLogsFromStorage(){let t=this._getLogsStorage();if(t)try{let e=t.getItem(this._logsStorageKey);if(!e)return;let n=JSON.parse(e);if(!n||typeof n!="object")return;let r=Array.isArray(n.logs)?n.logs:[],o=[];for(let i of r){if(!i||typeof i!="object")continue;let a=typeof i.abilityId=="string"?String(i.abilityId):"",l=Number(i.performedAt)||0;!a||!l||o.push({petId:typeof i.petId=="string"?String(i.petId):"",species:typeof i.species=="string"&&i.species?String(i.species):void 0,name:typeof i.name=="string"&&i.name?String(i.name):void 0,abilityId:a,abilityName:typeof i.abilityName=="string"&&i.abilityName?String(i.abilityName):a,data:typeof i.data=="string"?String(i.data):i.data,performedAt:l,time12:typeof i.time12=="string"&&i.time12?String(i.time12):new Date(l).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0})})}o.sort((i,a)=>i.performedAt-a.performedAt),this._logs=o.slice(-this._logsMax),this._seenPerfByPet.clear();for(let i of this._logs){let a=this._seenPerfByPet.get(i.petId)||0;i.performedAt>a&&this._seenPerfByPet.set(i.petId,i.performedAt)}let s=Number(n.cutoff);Number.isFinite(s)&&s>0&&(this._logsCutoffMs=s)}catch{}},_ingestAbilityMap(t){if(!t||typeof t!="object")return;let e=l=>{let c=xt[l];return c?.name&&c.name.trim()||l},n=l=>new Date(l).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}),r=l=>Number.isFinite(Number(l))?Math.round(Number(l)).toLocaleString("en-US"):"0",o=l=>`${Number.isFinite(Number(l))?Number(l).toFixed(0):"0"}%`,s=l=>`${Number.isFinite(Number(l))?Number(l).toFixed(1):"0.0"} min`,i=(l,c)=>{let d=c??{},u=xt[l]?.baseParameters??{};switch(l){case"CoinFinderI":case"CoinFinderII":case"CoinFinderIII":{let p=d.coinsFound??u.baseMaxCoinsFindable;return`+ ${r(p)} coins`}case"SeedFinderI":case"SeedFinderII":case"SeedFinderIII":case"SeedFinderIV":return`x1 ${d.seedName??"\u2014"}`;case"SellBoostI":case"SellBoostII":case"SellBoostIII":case"SellBoostIV":{if(d.bonusCoins!=null)return`Sale bonus: +${r(d.bonusCoins)} coins`;let p=u.cropSellPriceIncreasePercentage;return p!=null?`+ ${o(p)}`:"Sale bonus"}case"ProduceRefund":{let p=d.numItemsRefunded;return p!=null?`+ ${r(p)} item(s)`:"Crops refunded"}case"ProduceScaleBoost":case"ProduceScaleBoostII":{if(d.cropScaleIncreasePercentage!=null)return`+ ${o(d.cropScaleIncreasePercentage)}`;let p=u.cropScaleIncreasePercentage;return p!=null?`+ ${o(p)}`:"Produce bigger"}case"DoubleHarvest":return"+1 item";case"ProduceEater":{let p=d.cropName??"\u2014";if(d.sellPrice!=null)return`Eaten: ${p} (value ${r(d.sellPrice)})`;let f=u.cropSellPriceIncreasePercentage;return f!=null?`Eaten: ${p} (+ ${o(f)} price)`:`Eaten: ${p}`}case"EggGrowthBoost":case"EggGrowthBoostII":case"EggGrowthBoostIII":{let p=d.eggGrowthTimeReductionMinutes??u.eggGrowthTimeReductionMinutes;return`- ${s(p)}`}case"PlantGrowthBoost":case"PlantGrowthBoostII":{let p=d.reductionMinutes??u.plantGrowthReductionMinutes;return`- ${s(p)}`}case"GoldGranter":return`${d.cropName??"\u2014"}`;case"RainbowGranter":return`${d.cropName??"\u2014"}`;case"ProduceMutationBoost":case"ProduceMutationBoostII":case"PetMutationBoost":case"PetMutationBoostII":return"\u2014";case"PetXpBoost":case"PetXpBoostII":{let p=d.bonusXp??u.bonusXp;return`+ ${r(p)} XP`}case"PetAgeBoost":case"PetAgeBoostII":{let p=d.bonusXp??u.bonusXp,f=d.petName??"pet";return`+ ${r(p)} XP (${f})`}case"PetHatchSizeBoost":case"PetHatchSizeBoostII":{let p=d.petName??"pet";if(d.strengthIncrease!=null)return`+${r(d.strengthIncrease)} strength (${p})`;let f=u.maxStrengthIncreasePercentage;return f!=null?`+ ${o(f)} (${p})`:`Strength increased (${p})`}case"HungerRestore":case"HungerRestoreII":{let p=d.hungerRestoredPercentage??u.hungerRestorePercentage;return`(${d.petName??"pet"}): ${o(p)}`}case"HungerBoost":case"HungerBoostII":{let p=u.hungerDepletionRateDecreasePercentage;return p!=null?`- ${o(p)}`:"Hunger reduced"}case"PetRefund":case"PetRefundII":{let p=d.eggName??null;return p?`x1 ${p}`:"Pet refunded as egg"}case"Copycat":return"\u2014";default:{let p=xt[l];return d&&typeof d=="object"&&Object.keys(d).length?JSON.stringify(d):p?.description||"\u2014"}}},a=1e-6;for(let l of Object.keys(t)){let c=t[l];if(!c||typeof c!="object")continue;let d=c.abilityId??null,u=Number(c.performedAt)||0;if(!d||!u)continue;let p=this._seenPerfByPet.get(l)||0;if(u<=p)continue;if(this._logsCutoffMs&&u<this._logsCutoffMs-this._logsCutoffSkewMs){this._seenPerfByPet.set(l,u);continue}let f=Number.isFinite(Number(c.hungerPct))?Number(c.hungerPct):null;if(f!=null&&f>0&&f<=1&&(f*=100),f!=null&&f<=a){this._seenPerfByPet.set(l,u);continue}let h=ds.find(y=>String(y.id)===String(l))||null,m=String(d),g={petId:l,species:h?.petSpecies||void 0,name:h?.name??void 0,abilityId:m,abilityName:e(d),data:i(m,c.data),performedAt:u,time12:n(u)};this._seenPerfByPet.set(l,u);try{_e.incrementAbilityStat(m,"triggers");let y=this._extractAbilityValue(m,c.data);y>0&&_e.incrementAbilityStat(m,"totalValue",y)}catch{}this._pushLog(g)}}};try{Te._restoreAbilityLogsFromStorage()}catch{}async function nE(){try{let t=await Se.getPets();return(Array.isArray(t)?t:[]).map(n=>String(n?.slot?.id||"")).filter(n=>!!n).slice(0,3)}catch{return[]}}async function rE(t){let e=await nE(),n=new Set(t),r=e.filter(d=>!n.has(d)),o=Math.max(0,e.length-t.length);if(o>0){let d=r.slice(0,o);for(let u of d)try{await Se.storePet(u),e=e.filter(p=>p!==u)}catch{}}let s=new Set;for(let d of t)e.includes(d)&&s.add(d);let i=0,a=0,l=0;s.size&&(e=e.filter(d=>!s.has(d)),l=s.size);let c=t.filter(d=>!s.has(d));for(let d of c){let u=e.shift();try{u?(await Se.swapPet(u,d),i++):(await Se.placePet(d,{x:0,y:0},"Boardwalk",64),a++)}catch{}}return{swapped:i,placed:a,skipped:l}}var oE=[{id:"shops.seeds",modal:"seedShop"},{id:"shops.eggs",modal:"eggShop"},{id:"shops.decors",modal:"decorShop"},{id:"shops.tools",modal:"toolShop"}],_m=!1;function Nm(){_m||typeof window>"u"||(_m=!0,window.addEventListener("keydown",t=>{if(!Jr(t)){for(let{id:e,modal:n}of oE)if(ss(e,t)){t.preventDefault(),t.stopPropagation(),pe.ui.activeModal.set(n);break}}},!0))}function Lm(t,e){let n=Number.isFinite(t)?Math.max(0,t):0,r=Number.isFinite(e)?Math.max(0,e):0;if(r<n){let o=n;n=r,r=o}return n===r?Math.max(0,n):Math.random()*(r-n)+n}function md(t,e=[0,0]){if(!t||t.length!==2)return e;let[n,r]=t,o=Number.isFinite(n)?Math.max(0,n):e[0],s=Number.isFinite(r)?Math.max(0,r):e[1];return o<=s?[o,s]:[s,o]}function sE(t){return t&&typeof t=="object"&&"species"in t}function iE(t){return t&&typeof t=="object"&&"toolId"in t}function aE(t){return t&&typeof t=="object"&&"eggId"in t}function lE(t){return t&&typeof t=="object"&&"decorId"in t}function cE(t){if(!t||typeof t!="object")return null;if(typeof t.secondsUntilRestock=="number")return t.secondsUntilRestock;for(let e of Object.keys(t)){let n=t[e];if(typeof n=="number"&&e.toLowerCase().includes("secondsuntilrestock"))return n}return null}function dE(t,e){let n=new Set,r=[t];for(;r.length;){let o=r.pop();if(!(!o||typeof o!="object")&&!n.has(o)){n.add(o);for(let s of Object.keys(o)){let i=o[s];if(Array.isArray(i)&&i.length&&i.every(a=>typeof a=="object")&&i.some(e)){let a=cE(o);return{items:i,sec:a}}}for(let s of Object.keys(o)){let i=o[s];i&&typeof i=="object"&&r.push(i)}}}return{items:[],sec:null}}function uE(t){return t==="seeds"?sE:t==="tools"?iE:t==="eggs"?aE:lE}var Xe={async readRawData(){try{return await pe.shop.shops.get()}catch{return{}}},async read(t){let e=await this.readRawData();return dE(e,uE(t))},identityFor(t,e){if(typeof e?.name=="string"&&e.name.trim())return e.name.trim();let n={seeds:Be,tools:Rt,eggs:Pt,decor:_t},r={seeds:[String(e.species??e.id??"")],tools:[String(e.toolId??e.id??"")],eggs:[String(e.eggId??e.id??"")],decor:[String(e.decorId??e.id??"")]},o=n[t];for(let s of r[t]){if(!s)continue;let i=o[s];if(i){if(t==="seeds"&&i.seed?.name)return i.seed.name;if(i.name)return i.name}}return String(e.species??e.toolId??e.eggId??e.decorId??e.id??"?")},getQty(t){let e=t.initialStock??0,n=Number(e);return Number.isFinite(n)?n:0},priceFromCatalog(t,e){let n=t==="seeds"?Be:t==="tools"?Rt:t==="eggs"?Pt:_t,r=[e.species,e.toolId,e.eggId,e.decorId].filter(Boolean).map(String);for(let o of r){let s=n[o];if(s)if(t==="seeds"){let i=Number(s?.seed?.coinPrice);if(Number.isFinite(i))return i}else{let i=Number(s?.coinPrice);if(Number.isFinite(i))return i}}},keyForAuto(t,e){return`${t}:${this.identityFor(t,e)}`},keyForOffer(t,e){let n=this.priceFromCatalog(t,e)??0;return`${this.keyForAuto(t,e)}@${n}`},invKeyFromAutoKey(t,e){let n=e.indexOf(":");return n>=0?e.slice(n+1):e},buyOne(t,e){if(t==="seeds"){let n=e.species??e.name;if(n)try{Ve({type:"PurchaseSeed",species:n}),_e.incrementShopStat("seedsBought")}catch{}return}if(t==="tools"){let n=e.toolId??e.id;if(n)try{Ve({type:"PurchaseTool",toolId:n}),_e.incrementShopStat("toolsBought")}catch{}return}if(t==="eggs"){let n=e.eggId??e.id;if(n)try{Ve({type:"PurchaseEgg",eggId:n}),_e.incrementShopStat("eggsBought")}catch{}return}if(t==="decor"){let n=e.decorId??e.id;if(n)try{Ve({type:"PurchaseDecor",decorId:n}),_e.incrementShopStat("decorBought")}catch{}return}},sleep(t){return new Promise(e=>setTimeout(e,t))},async buyAllInStock(t,e,n){let r=Math.max(0,this.getQty(e));if(r===0)return;let o=typeof n?.limitPerTick=="number"&&isFinite(n.limitPerTick)?Math.max(0,n.limitPerTick):r,s=[140,220],i=[1e4,18e4],a=md(n?.initialDelayRangeMs,i),l=typeof n?.delayMs=="number"&&isFinite(n.delayMs)?Math.max(0,n.delayMs):void 0,c=n?.clickDelayRangeMs?md(n.clickDelayRangeMs,s):l!==void 0?md([l*.75,l*1.25],s):s,d=Math.min(r,o),u=Math.round(Lm(a[0],a[1]));u>0&&await this.sleep(u);for(let p=0;p<d;p++){try{await this.buyOne(t,e)}catch{break}let f=Math.round(Lm(c[0],c[1]));f>0&&await this.sleep(f)}},async readMyInventory(){try{return await pe.inventory.myInventory.get()}catch{return null}},async readInventoryMaps(){let t=await this.readMyInventory(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};for(let n of t?.items||[]){if(!n||typeof n!="object")continue;let r=Number.isFinite(+n.quantity)?+n.quantity:1;n.itemType==="Seed"&&n.species&&e.seeds.set(String(n.species),(e.seeds.get(String(n.species))??0)+r),n.itemType==="Tool"&&n.toolId&&e.tools.set(String(n.toolId),(e.tools.get(String(n.toolId))??0)+r),n.itemType==="Egg"&&n.eggId&&e.eggs.set(String(n.eggId),(e.eggs.get(String(n.eggId))??0)+r),n.itemType==="Decor"&&n.decorId&&e.decor.set(String(n.decorId),(e.decor.get(String(n.decorId))??0)+r)}return e},async onInventoryChange(t){let e=await pe.inventory.myInventory.onChange(async()=>{try{t(await this.readInventoryMaps())}catch{}});try{t(await this.readInventoryMaps())}catch{}return e},async onQuantityChange(t,e){let n="",r=async()=>{try{let s=await this.read(t),i=this.signatureFor(t,s);i!==n&&(n=i,e())}catch{}},o=await pe.shop.shops.onChange(r);return await r(),o},signatureFor(t,e){let n=e.items.map(r=>{let o=this.keyForOffer(t,r),s=this.getQty(r);return`${o}#${s}`});return n.sort(),`${t}:${n.join("|")}`},async readMyPurchases(){try{return await pe.shop.myShopPurchases.get()}catch{return null}},async readPurchasesMaps(){let t=await this.readMyPurchases(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};if(!t)return e;let n=t.seed?.purchases??{};for(let[i,a]of Object.entries(n))e.seeds.set(i,Number(a)||0);let r=t.tool?.purchases??{};for(let[i,a]of Object.entries(r))e.tools.set(i,Number(a)||0);let o=t.egg?.purchases??{};for(let[i,a]of Object.entries(o))e.eggs.set(i,Number(a)||0);let s=t.decor?.purchases??{};for(let[i,a]of Object.entries(s))e.decor.set(i,Number(a)||0);return e},async onPurchasesChange(t){let e=await pe.shop.myShopPurchases.onChange(async()=>{try{t(await this.readPurchasesMaps())}catch{}});try{t(await this.readPurchasesMaps())}catch{}return e}};async function pE(t){let e=kt("sendQuinoaToastAtom");if(e){await Zn(e,t);return}let n=kt("quinoaToastsAtom");if(!n)throw new Error("Aucun atom de toast trouv\xE9");let r=await Ht(n).catch(()=>[]),o={isClosable:!0,duration:1e4,...t};"toastType"in o&&o.toastType==="board"?o.id=o.id??(o.isStackable?`quinoa-stackable-${Date.now()}-${Math.random()}`:"quinoa-game-toast"):o.id=o.id??"quinoa-game-toast",await Zn(n,[...r,o])}async function we(t,e,n="info",r=3500){await pE({title:t,description:e,variant:n,duration:r})}var hd=class{constructor(e={}){ce(this,"found",new Set);ce(this,"meta",new Map);ce(this,"groupsMap",new Map);ce(this,"atomKey");ce(this,"min");ce(this,"max");ce(this,"gainFactor");ce(this,"howler",null);ce(this,"minVariantsPerAutoGroup");this.atomKey=e.atomKey??"soundEffectsVolumeAtom",this.min=e.min??.001,this.max=e.max??.2000000000000001,this.gainFactor=e.gainFactor??1,this.minVariantsPerAutoGroup=e.minVariantsPerAutoGroup??2,e.autoScan&&this.init()}async init(){await this.scanAll()}abs(e){try{return new URL(e,location.href).href}catch{return e}}isMP3(e){return/\.mp3(?:[\?#][^\s'"]*)?$/i.test(e)}fileName(e){try{return new URL(e,location.href).pathname.split("/").pop()||e}catch{return String(e)}}logicalName(e){return e.replace(/-[A-Za-z0-9_=-]{6,}(?=\.mp3$)/i,"")}clamp(e,n,r){return Math.max(n,Math.min(r,e))}choose(e){return e&&e.length?e[Math.random()*e.length|0]:void 0}toKey(e){return String(e||"").trim().toLowerCase()}add(e,n){if(!e||!this.isMP3(e))return;let r=this.abs(e);if(this.found.has(r))this.meta.get(r)?.from.add(n);else{this.found.add(r);let o=this.fileName(r);this.meta.set(r,{from:new Set([n]),name:o,logicalName:this.logicalName(o)})}}refreshHowler(){return this.howler=window.Howler&&Array.isArray(window.Howler._howls)?window.Howler:null,this.howler}sameAsset(e,n){try{let r=new URL(e,location.href).href,o=new URL(n,location.href).href;if(r===o)return!0;let s=l=>new URL(l,location.href).pathname.split("/").pop(),i=this.logicalName(s(r)),a=this.logicalName(s(o));return i===a}catch{return e===n}}readAtomRaw(){let e=localStorage.getItem(this.atomKey);if(e==null)return null;try{let n=JSON.parse(e);if(typeof n=="number")return n;let r=JSON.stringify(n).match(/-?\d+(?:\.\d+)?/);return r?parseFloat(r[0]):null}catch{let n=String(e).match(/-?\d+(?:\.\d+)?/);return n?parseFloat(n[0]):null}}howlerMaster(){try{return window.Howler&&typeof window.Howler.volume=="function"?window.Howler.volume():1}catch{return 1}}finalVolumeObj(){let e=this.readAtomRaw();e==null&&(e=this.max);let n=this.clamp(e,this.min,this.max),o=(Math.abs(n-this.min)<1e-6?0:n)*this.howlerMaster()*this.gainFactor;return{raw:e,clamped:n,vol:o}}async scanPerformance(){performance.getEntriesByType("resource").map(e=>e.name).filter(Boolean).forEach(e=>this.add(e,"perf"))}async scanHowler(){this.refreshHowler(),this.howler&&this.howler._howls.forEach(e=>{let n=e&&(e._src||e._urls&&e._urls[0]);n&&this.add(n,"howler")})}async scanCaches(){if("caches"in window)try{let e=await caches.keys();for(let n of e){let o=await(await caches.open(n)).keys();for(let s of o){let i=s.url;this.isMP3(i)&&this.add(i,`cache:${n}`)}}}catch{}}async fetchText(e){try{let n=await fetch(e,{mode:"same-origin",credentials:"same-origin"});if(!n.ok)return"";let r=n.headers.get("content-type")||"";return/javascript|ecmascript|css|html/i.test(r)?await n.text():""}catch{return""}}extractMp3s(e){if(!e)return[];let n=/["'`](\/?[^"'`)\s]+?\.mp3(?:\?[^"'`\s]*)?)["'`]/ig,r=[],o;for(;o=n.exec(e);)r.push(o[1]);return r}async scanResourcesForRefs(){let e=new Set;document.querySelectorAll('script[src],link[rel="stylesheet"][href]').forEach(r=>{let o=r.src||r.href;try{let s=new URL(o,location.href);s.origin===location.origin&&e.add(s.href)}catch{}}),e.add(location.href),(await Promise.all([...e].map(r=>this.fetchText(r)))).forEach((r,o)=>{for(let s of this.extractMp3s(r))this.add(s,`ref:${[...e][o]}`)})}async scanDOM(){document.querySelectorAll("audio[src]").forEach(n=>this.add(n.getAttribute("src")||"","dom")),document.querySelectorAll("source[src]").forEach(n=>this.add(n.getAttribute("src")||"","dom"));let e=document.documentElement?.outerHTML||"";for(let n of this.extractMp3s(e))this.add(n,"html")}async scanAll(){return this.found.clear(),this.meta.clear(),await Promise.all([this.scanPerformance(),this.scanHowler(),this.scanCaches(),this.scanDOM()]),await this.scanResourcesForRefs(),this.autoGroups({overwrite:!0}),this.urls()}inferGroupKey(e){let n=String(e||"").replace(/\.mp3$/i,""),r=n.match(/^([A-Za-z]+)[_\-]/);return r||(r=n.match(/^([A-Za-z]+)\d+$/),r)?r[1].toLowerCase():(r=n.match(/^([A-Za-z]+)/),r?r[1].toLowerCase():n.toLowerCase())}defineGroup(e,n){let r=this.toKey(e),o=new Set,s=this.urls().map(a=>[a,this.meta.get(a)]),i=(a,l)=>{if(!n)return!1;if(typeof n=="function")return!!n(a,l);let c=l?.logicalName||l?.name||a;if(n instanceof RegExp)return n.test(c)||n.test(a);let d=String(n).toLowerCase();return c.toLowerCase().startsWith(d)||a.toLowerCase().includes("/"+d)};for(let[a,l]of s)i(a,l&&{name:l.name,logicalName:l.logicalName})&&o.add(a);return this.groupsMap.set(r,o),[...o]}undefineGroup(e){this.groupsMap.delete(this.toKey(e))}autoGroups({overwrite:e=!1,minVariants:n=this.minVariantsPerAutoGroup}={}){return this.rebuildAutoGroups(e,n),this.groups()}rebuildAutoGroups(e,n){let r=new Map;for(let[o,s]of this.meta.entries()){let i=this.inferGroupKey(s?.logicalName||s?.name||o);r.has(i)||r.set(i,new Set),r.get(i).add(o)}for(let[o,s]of r.entries())s.size<n||(e||!this.groupsMap.has(o))&&this.groupsMap.set(o,s)}groups(){let e={};for(let[n,r]of this.groupsMap.entries())e[n]=[...r];return e}getGroup(e){let n=this.groupsMap.get(this.toKey(e));return n?[...n]:[]}pick(e){let n=this.getGroup(e);return this.choose(n)}findExistingHowlByUrl(e){if(this.refreshHowler(),!this.howler)return null;for(let n of this.howler._howls){let r=n&&(n._src||n._urls&&n._urls[0]);if(r&&this.sameAsset(r,e))return n}return null}getGameSfxVolume(){return this.finalVolumeObj()}setGainFactor(e=1){this.gainFactor=+e||1}setAtomConfig(e="soundEffectsVolumeAtom",n=.001,r=.2000000000000001){this.atomKey=e,this.min=n,this.max=r}playUrl(e){let{vol:n}=this.finalVolumeObj(),r=this.findExistingHowlByUrl(e);if(r)try{return r.play(),r}catch{}let o=window.Howl&&window.Howler?window.Howl:null;if(o)try{let s=new o({src:[e],volume:n});return s.play(),s}catch{}try{let s=new Audio(e);return s.volume=Math.max(0,Math.min(1,n)),s.play().catch(()=>{}),s}catch{return null}}playBy(e){let n=this.urls(),r=e instanceof RegExp?e:new RegExp(String(e).replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"i"),o=n.find(s=>r.test(s));return o?this.playUrl(o):null}play(e){if(typeof e=="string"){let n=this.map();if(n[e]?.[0])return this.playUrl(n[e][0])}return this.playBy(e)}playGroup(e,n={}){let{index:r,random:o=!0,filter:s}=n,i=this.getGroup(e);if(!i.length||typeof s=="function"&&(i=i.filter(l=>{let c=this.meta.get(l);return s(l,c&&{name:c.name,logicalName:c.logicalName})}),!i.length))return null;let a=typeof r=="number"?i[(r%i.length+i.length)%i.length]:o?this.choose(i):i[0];return this.playUrl(a)}playRandom(e){return this.playGroup(e,{random:!0})}urls(){return[...this.found]}map(){let e={};for(let[n,r]of this.meta.entries()){let o=r.logicalName||r.name;(e[o]||(e[o]=[])).push(n)}return e}info(){return this.urls().map(e=>{let n=this.meta.get(e);return{url:e,name:n?.name,logicalName:n?.logicalName,sources:[...n?.from||[]].join(",")}})}exportJSON(){return JSON.stringify({urls:this.info(),groups:this.groups()},null,2)}async scan(){return this.scanAll()}playHarvest(){return this.playGroup("harvest")}playPlantSeed(){return this.playGroup("plantseed")}playWaterPlant(){return this.playBy("water")}playDestroyPlant(){return this.playBy("Break_Dirt")}playDestroyStone(){return this.playBy("Break_Stone")}playSellNotification(){return this.playBy("Score_PlusOne")}playInfoNotification(){return this.playBy("Keyboard_Enter_01")}playBuy(){return this.playGroup("coinbuy")}},$t=new hd({autoScan:!0});window.__audioPlayer=$t;var fE="sell-all-pets:list",mE={text:"var(--chakra-colors-Neutral-TrueWhite, #FFFFFF)",bg:"var(--chakra-colors-Blue-Magic, #0067B4)",border:"var(--chakra-colors-Blue-Light, #48ADF4)",hoverBg:"var(--chakra-colors-Blue-Light, #48ADF4)",hoverBorder:"var(--chakra-colors-Blue-Baby, #25AAE2)",activeBg:"var(--chakra-colors-Blue-Dark, #264093)",ring:"var(--chakra-ring-color, rgba(66,153,225,0.6))"},Nn={rootSelector:".McFlex.css-1wu1jyg",checkSelector:".McFlex.css-bvyqr8",buttonSelectorWide:"button.chakra-button.css-1rizn4y, button.chakra-button, button.css-1rizn4y",buttonSelectorStrict:"button.chakra-button.css-1rizn4y",targetText:"Sell Pet",injectText:"Sell all Pets",injectedClass:"tm-injected-sell-all",styleId:"tm-injected-sell-all-style"};function Bm(t={}){if(!kE())return IE();let e=t.rootSelector??Nn.rootSelector,n=t.checkSelector??Nn.checkSelector,r=t.buttonSelectorWide??Nn.buttonSelectorWide,o=t.buttonSelectorStrict??Nn.buttonSelectorStrict,s=t.targetText??Nn.targetText,i=t.injectText??Nn.injectText,a=t.injectedClass??Nn.injectedClass,l=t.theme??mE,c=t.observeHistory??!0,d=typeof t.log=="function"?t.log:t.log?(...v)=>console.debug("[injectSellAllPets]",...v):()=>{},u=t.onClick??gE(d);LE(a,l);let p=!0,f=!1,h=()=>{!p||f||(f=!0,requestAnimationFrame(()=>{try{document.querySelectorAll(e).forEach(v=>m(v))}finally{f=!1}}))};function m(v){if(!v.querySelector(n)){Dm(v,a);return}let x=RE(v,r,o,s);if(!x){Dm(v,a);return}_E(x,a,i,(E,L)=>{EE(u,E,L,d)})}let g=new MutationObserver(h);g.observe(document.documentElement,{childList:!0,subtree:!0}),h();let y=null;return c&&(y=NE(h)),{stop(){p&&(p=!1,g.disconnect(),y?.(),d("stopped"))},runOnce(){h()},isRunning(){return p}}}async function Fm(t=()=>{}){let e=await Hm(t);e.length!==0&&await Wm(e,t)}async function hE(){try{await St()}catch{}let[t,e]=await Promise.all([pe.inventory.myInventory.get().catch(()=>null),pe.inventory.favoriteIds.get().catch(()=>[])]),n=new Set(Array.isArray(e)?e.filter(s=>typeof s=="string"):[]),r=Array.isArray(t?.items)?t.items:[],o=[];return r.forEach((s,i)=>{TE(s)&&(n.has(s.id)||(console.log("[sellAllPets] inventory index",i,s),o.push({...s,inventoryIndex:i})))}),o}function gE(t){return async()=>{let e=await Hm(t);e.length!==0&&await Wm(e,t)}}async function Hm(t){let e=await hE(),n={pets:e,count:e.length};globalThis.__sellAllPetsCandidates=e;try{t("collected-non-favorite-pets",n)}catch{}try{globalThis.dispatchEvent?.(new CustomEvent(fE,{detail:n}))}catch{}return e}async function Wm(t,e){let n=t.filter(i=>typeof i?.id=="string"&&i.id.trim().length>0);if(n.length===0){try{e("no-sellable-pets",{requested:t.length})}catch{}try{globalThis.__sellAllPetsResult={attempted:0,sold:0,failures:[]}}catch{}return}let r=[],o=0,s=await yE(n,e);try{e("sell-pets:total-value",{attempted:n.length,totalValue:s})}catch{}for(let i of n){try{e("sell-pet:start",{id:i.id,pet:i})}catch{}try{await Se.sellPet(i.id),o+=1,_e.incrementShopStat("petsSoldCount"),(async()=>{try{let a=await pe.pets.totalPetSellPrice.get(),l=Number(a);Number.isFinite(l)&&l>0&&_e.incrementShopStat("petsSoldValue",l)}catch(a){console.error("[SellPet] Unable to read pet sell price",a)}})();try{e("sell-pet:success",{id:i.id,pet:i})}catch{}}catch(a){r.push({pet:i,error:a});try{e("sell-pet:error",{id:i.id,error:a,pet:i})}catch{}}}r.length===0&&we("Sell all Pets",`${o} pets have been sold for ${s} coins!`,"success");try{globalThis.__sellAllPetsResult={attempted:n.length,sold:o,failures:r}}catch{}$t.playSellNotification();try{e("sell-pets:complete",{attempted:n.length,sold:o,failures:r})}catch{}}async function yE(t,e){if(!t.length)return"";let n=await bE(),r=0;for(let o of t){let s=wE(o);if(s===null)continue;try{await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(s)}catch(a){try{e("sell-pet:selection-error",{id:o.id,index:s,error:a,pet:o})}catch{}continue}let i=await SE(s,o,e);i!==null&&(r+=i)}return await vE(n,e),r.toLocaleString("en-US")}async function bE(){try{let t=await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();if(typeof t=="number"&&Number.isInteger(t)&&t>=0)return{value:t,valid:!0};if(t===null)return{value:null,valid:!0}}catch{}return{value:null,valid:!1}}async function vE(t,e){if(t.valid)try{await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(t.value)}catch(n){try{e("sell-pet:selection-restore-error",n)}catch{}}}function wE(t){let e=t.inventoryIndex;return typeof e=="number"&&Number.isInteger(e)&&e>=0?e:null}async function SE(t,e,n,r=3,o=50){for(let s=0;s<r;s++){try{let i=await pe.pets.totalPetSellPrice.get(),a=Number(i);if(Number.isFinite(a))return a}catch(i){if(s===r-1)try{n("sell-pet:price-read-error",{id:e.id,index:t,error:i,pet:e})}catch{}}s<r-1&&await xE(o)}try{n("sell-pet:price-missing",{id:e.id,index:t,pet:e})}catch{}return null}function xE(t){return new Promise(e=>setTimeout(e,t))}function EE(t,e,n,r){try{let o=t(e,n);CE(o)&&o.catch(s=>Om(s,r))}catch(o){Om(o,r)}}function Om(t,e){try{e("sell-all-click-error",t)}catch{}}function CE(t){return!!t&&(typeof t=="object"||typeof t=="function")&&typeof t.then=="function"}function TE(t){return!!t&&t.itemType==="Pet"&&typeof t.id=="string"}function kE(){return typeof window<"u"&&typeof document<"u"}function IE(){return{stop(){},runOnce(){},isRunning:()=>!1}}function qm(t){return(t??"").replace(/\s+/g," ").trim()}function AE(t){let e=qm(t.textContent);return e||qm(t.getAttribute("aria-label"))}function ME(t){return t.trim().split(/\s+/).filter(Boolean)}function PE(t){let e=ME(t);return e.length===2&&/^sell$/i.test(e[0])}function RE(t,e,n,r){return Array.from(new Set([...Array.from(t.querySelectorAll(e)),...Array.from(t.querySelectorAll(n))])).filter(i=>i instanceof HTMLButtonElement).filter(i=>!i.classList.contains(Nn.injectedClass)).find(i=>PE(AE(i)))??null}function _E(t,e,n,r){let o=t.parentElement||t.closest(".McFlex, .css-0")||t.parentNode;if(!o)return;let s=o.querySelector(`.${e}`);if(s){t.nextElementSibling!==s&&o.insertBefore(s,t.nextSibling),s.textContent!==n&&(s.textContent=n);return}s=document.createElement("button"),s.type="button",s.className=`${e} chakra-button`,s.textContent=n,s.setAttribute("aria-label",n),s.title=n,s.style.marginLeft="8px",getComputedStyle(o).display!=="flex"&&(s.style.display="inline-flex",s.style.alignItems="center"),s.addEventListener("click",a=>r(a,{host:t.closest(".McFlex.css-1wu1jyg"),targetBtn:t,injectedBtn:s})),o.insertBefore(s,t.nextSibling)}function Dm(t,e){t.querySelectorAll(`.${e}`).forEach(n=>n.remove())}function LE(t,e){let n=`${t}-style`;if(document.getElementById(n))return;let r=`
.${t}{
  font-synthesis: none;
  -webkit-font-smoothing: antialiased;
  -webkit-text-size-adjust: 100%;
  cursor: pointer;
  display: inline-flex;
  appearance: none;
  align-items: center;
  justify-content: center;
  user-select: none;
  white-space: nowrap;
  vertical-align: middle;

  outline: transparent solid 2px;
  outline-offset: 2px;
  line-height: 1.2;

  border-radius: 15px;                        /* aligns with provided design */
  font-weight: 700;
  height: auto;
  min-width: var(--chakra-sizes-10, 2.5rem);
  box-shadow: rgba(0, 0, 0, 0.3) 0px 4px 12px;
  transform: translateY(0px);
  transition: 0.2s;

  border: 2px solid ${e.border};
  color: ${e.text};
  background: ${e.bg};

  text-transform: none;
  overflow: hidden;
  font-size: 20px;
  padding-inline-start: var(--chakra-space-4, 1rem);
  padding-inline-end: var(--chakra-space-4, 1rem);
  padding-top: var(--chakra-space-3, 0.75rem);
  padding-bottom: var(--chakra-space-3, 0.75rem);

  -webkit-tap-highlight-color: transparent;
}
.${t}:hover{
  transform: translateY(-1px);
  background: ${e.hoverBg};
  border-color: ${e.hoverBorder};
}
.${t}:active{
  transform: translateY(1px);
  background: ${e.activeBg};
}
.${t}:focus-visible{
  box-shadow: 0 0 0 3px ${e.ring};
}
`.trim(),o=document.createElement("style");o.id=n,o.textContent=r,document.head.appendChild(o)}function NE(t){let e=history.pushState?.bind(history),n=history.replaceState?.bind(history),r=s=>s&&function(...i){let a=s.apply(this,i);return t(),a};e&&(history.pushState=r(e)),n&&(history.replaceState=r(n));let o=()=>t();return window.addEventListener("popstate",o),()=>{e&&(history.pushState=e),n&&(history.replaceState=n),window.removeEventListener("popstate",o)}}var jm=!1;function zm(){jm||typeof window>"u"||(jm=!0,window.addEventListener("keydown",t=>{if(!Jr(t)){if(ss("sell.sell-all",t)){t.preventDefault(),t.stopPropagation(),Se.sellAllCrops();return}ss("sell.sell-all-pets",t)&&(t.preventDefault(),t.stopPropagation(),Fm())}},!0))}function Zr(t){let e=typeof t=="number"?t:Number(t);if(!Number.isFinite(e))return e===1/0?"\u221E":null;let n=Math.abs(e),r=o=>Number.isInteger(o)?String(o):o.toFixed(1);return n>=1e12?`${r(e/1e12)}T`:n>=1e9?`${r(e/1e9)}B`:n>=1e6?`${r(e/1e6)}M`:n>=1e3?`${r(e/1e3)}k`:String(e)}var ha=Xp(Gm(),1);function OE(t){try{return!t||t.startsWith("blob:")?!1:/\.(png|jpe?g|gif|webp|svg|avif|bmp|ico|ktx2|basis)$/i.test(t)}catch{return!1}}function qE(t){try{return new URL(t,location.href).href}catch{return String(t)}}function Xr(t){return decodeURIComponent(t.split("/").pop()||"").replace(/\.[a-z0-9]+$/i,"")}function DE(t){return/\/assets\/tiles\//i.test(t)||/(map|plants|allplants|items|seeds|pets|animations|mutations)\.(png|webp)$/i.test(t)}function BE(t){return/\/assets\/ui\//i.test(t)}var yd=class{constructor(e=!0){ce(this,"cfg",{skipAlphaBelow:1,blackBelow:8,tolerance:.005,ruleAllplants512:/allplants/i});ce(this,"initialized",!1);ce(this,"onAssetCb");ce(this,"onMessageListener");ce(this,"ui",new Set);ce(this,"tiles",new Set);ce(this,"all",new Set);ce(this,"tileCacheBitmap",new Map);ce(this,"tileCacheCanvas",new Map);ce(this,"tileCacheDataURL",new Map);ce(this,"uiCache",new Map);ce(this,"observers",[]);ce(this,"patched",{});ce(this,"blobText",new WeakMap);e&&this.init()}init(e){return e?.config&&Object.assign(this.cfg,e.config),e?.onAsset&&(this.onAssetCb=e.onAsset),this.initialized?(console.debug("[Sprites] SpritesCore d\xE9j\xE0 initialis\xE9",{totals:{all:this.all.size,ui:this.ui.size,tiles:this.tiles.size}}),this):(console.debug("[Sprites] Initialisation des sniffers de sprites",{config:this.cfg}),this.installMainSniffers(),this.installWorkerHooks(),this.onMessageListener=n=>{let r=n.data;r&&r.__awc&&r.url&&this.add(r.url,"worker")},Re.addEventListener("message",this.onMessageListener,!0),this.initialized=!0,console.debug("[Sprites] SpritesCore initialis\xE9",{globals:{hasWindowSprites:!!Re.Sprites}}),this)}destroy(){if(this.initialized){if(this.observers.forEach(e=>{try{e.disconnect()}catch{}}),this.observers=[],this.patched.imgDesc&&(Object.defineProperty(HTMLImageElement.prototype,"src",this.patched.imgDesc),this.patched.imgDesc=void 0),this.patched.setAttr&&(HTMLImageElement.prototype.setAttribute=this.patched.setAttr,this.patched.setAttr=void 0),this.patched.Worker&&(Re.Worker=this.patched.Worker,Re!==Re&&(Re.Worker=this.patched.Worker),this.patched.Worker=void 0),this.patched.Blob&&(Re.Blob=this.patched.Blob,Re!==Re&&(Re.Blob=this.patched.Blob),this.patched.Blob=void 0),this.patched.createObjectURL){let e=Re.URL??URL;e.createObjectURL=this.patched.createObjectURL,Re!==Re&&(URL.createObjectURL=this.patched.createObjectURL),this.patched.createObjectURL=void 0}this.onMessageListener&&(Re.removeEventListener("message",this.onMessageListener,!0),this.onMessageListener=void 0),this.initialized=!1}}lists(){return{all:[...this.all],ui:[...this.ui],tiles:[...this.tiles]}}listTilesByCategory(e){return[...this.tiles].filter(n=>e.test(n))}listPlants(){let e=new Set(this.listTilesByCategory(/plants/i));for(let n of this.listAllPlants())e.add(n);return[...e]}listAllPlants(){return this.listTilesByCategory(this.cfg.ruleAllplants512)}listItems(){return this.listTilesByCategory(/items/i)}listSeeds(){return this.listTilesByCategory(/seeds/i)}listPets(){return this.listTilesByCategory(/pets/i)}listMap(){return this.listTilesByCategory(/map\.(png|webp)$/i)}async loadUI(){let e=new Map;for(let n of this.ui){if(!this.uiCache.has(n)){let r=await this.loadImage(n);this.uiCache.set(n,r)}e.set(Xr(n),this.uiCache.get(n))}return e}async loadTiles(e={}){let{mode:n="bitmap",includeBlanks:r=!1,forceSize:o,onlySheets:s}=e,i=new Map,a=s?[...this.tiles].filter(l=>s.test(l)):[...this.tiles];for(let l of a){let c=Xr(l),d;if(n==="bitmap"?d=this.tileCacheBitmap.get(l):n==="canvas"?d=this.tileCacheCanvas.get(l):d=this.tileCacheDataURL.get(l),!d){let u=await this.sliceOne(l,{mode:n,includeBlanks:r,forceSize:o});n==="bitmap"?this.tileCacheBitmap.set(l,u):n==="canvas"?this.tileCacheCanvas.set(l,u):this.tileCacheDataURL.set(l,u),d=u}i.set(c,d)}return i}async loadTilesAuto(){return this.loadTiles({mode:"bitmap"})}async loadTiles256(){return this.loadTiles({mode:"bitmap",forceSize:256})}async loadTiles512(){return this.loadTiles({mode:"bitmap",forceSize:512})}async getTile(e,n,r="bitmap"){return[...this.tiles].find(l=>Xr(l)===e)?((await this.loadTiles({mode:r,onlySheets:new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")+"\\.(png|webp)$","i")})).get(e)||[]).find(l=>l.index===n)??null:null}async flatTiles(e={}){let n=await this.loadTiles(e),r=[];return n.forEach(o=>r.push(...o)),r}async zipUI(e="ui_assets.zip"){let n=new ha.default,r=[...this.ui],o=0;for(let s of r){try{let i=await this.fetchBlob(s),a=decodeURIComponent(s.split("/").pop()||"").replace(/\?.*$/,"");n.file(a,i)}catch{}++o%10===0&&console.log(`[zipUI] ${o}/${r.length}`)}await this.saveZip(n,e)}async zipTilesAuto(e="tiles_auto.zip"){await this.zipTiles({name:e,mode:"bitmap"})}async zipTiles256(e="tiles_256.zip"){await this.zipTiles({name:e,mode:"bitmap",forceSize:256})}async zipTiles512(e="tiles_512.zip"){await this.zipTiles({name:e,mode:"bitmap",forceSize:512})}async zipAllSprites(e="sprites_all.zip"){let n=new ha.default,r=n.folder("tiles"),o=n.folder("ui");if(r)for(let s of this.tiles)try{let i=await this.sliceOne(s,{mode:"canvas",includeBlanks:!1});if(!i.length)continue;let a=Xr(s),l=r.folder(a)??r,c=0;for(let d of i){let u=d.data,p=++c,f=`tile_${String(p).padStart(4,"0")}`,h=async(m,g,y)=>{try{let v=y(),w=await new Promise((x,E)=>{v.toBlob(L=>{if(!L){E(new Error("toBlob returned null"));return}x(L)},"image/png")});l.file(`${f}${m}.png`,w)}catch(v){console.warn("[Sprites] Failed to export tile",{url:s,label:g,error:v})}};await h("","base",()=>u),await h("_gold","gold",()=>this.effectGold(d)),await h("_rainbow","rainbow",()=>this.effectRainbow(d))}}catch(i){console.warn("[Sprites] Failed to export sheet",{url:s,error:i})}if(o){let s=0;for(let i of this.ui)try{let a=await this.fetchBlob(i),c=decodeURIComponent(i.split("/").pop()||"").replace(/\?.*$/,"")||`asset_${String(++s).padStart(4,"0")}.png`;o.file(c,a)}catch(a){console.warn("[Sprites] Failed to export UI asset",{url:i,error:a})}}await this.saveZip(n,e)}clearCaches(){this.tileCacheBitmap.forEach(e=>e.forEach(n=>n.data.close?.())),this.tileCacheBitmap.clear(),this.tileCacheCanvas.clear(),this.tileCacheDataURL.clear(),this.uiCache.clear()}effectGold(e,n){let r=this.tileToCanvas(e),o=r.width,s=r.height,i=document.createElement("canvas");i.width=o,i.height=s;let a=i.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(r,0,0);let l=n?.alpha??.7,c=n?.color??"rgb(255, 215, 0)";return a.save(),a.globalCompositeOperation="source-atop",a.globalAlpha=l,a.fillStyle=c,a.fillRect(0,0,o,s),a.restore(),i}effectRainbow(e,n){let r=this.tileToCanvas(e),o=r.width,s=r.height,i=document.createElement("canvas");i.width=o,i.height=s;let a=i.getContext("2d");a.imageSmoothingEnabled=!1,a.drawImage(r,0,0);let l=n?.angle??130,c=n?.colors??["#FF1744","#FF9100","#FFEA00","#00E676","#2979FF","#D500F9"],d=document.createElement("canvas");d.width=o,d.height=s;let u=d.getContext("2d");u.imageSmoothingEnabled=!1;let p=o,f=(l-90)*Math.PI/180,h=o/2,m=s/2,g=h-Math.cos(f)*(p/2),y=m-Math.sin(f)*(p/2),v=h+Math.cos(f)*(p/2),w=m+Math.sin(f)*(p/2),x=u.createLinearGradient(g,y,v,w);if(c.length<=1){let E=c[0]??"#ffffff";x.addColorStop(0,E),x.addColorStop(1,E)}else c.forEach((E,L)=>x.addColorStop(L/(c.length-1),E));return u.fillStyle=x,u.fillRect(0,0,o,s),u.globalCompositeOperation="destination-in",u.drawImage(r,0,0),u.globalCompositeOperation="source-over",a.save(),a.globalCompositeOperation="color",a.drawImage(d,0,0),a.restore(),i}effectApply(e,n,r){return e==="Gold"?this.effectGold(n,r):this.effectRainbow(n,r)}async loadImage(e){return await new Promise((n,r)=>{let o=new Image;o.crossOrigin="anonymous",o.onload=()=>n(o),o.onerror=r,o.src=e})}guessSize(e,n,r){return r||(this.cfg.ruleAllplants512.test(e)?512:n.width%256===0&&n.height%256===0?256:n.width%512===0&&n.height%512===0?512:256)}isBlankOrBlack(e){let n=this.cfg.skipAlphaBelow,r=this.cfg.blackBelow,o=this.cfg.tolerance,s=e.data,i=Math.ceil(s.length/4*o),a=0;for(let l=0;l<s.length;l+=4)if(s[l+3]>n){let d=s[l],u=s[l+1],p=s[l+2];if((d>r||u>r||p>r)&&++a>i)return!1}return!0}async sliceOne(e,n){let r=await this.loadImage(e),o=this.guessSize(e,r,n.forceSize),s=Math.floor(r.width/o),i=Math.floor(r.height/o),a=Xr(e),l=document.createElement("canvas");l.width=o,l.height=o;let c=l.getContext("2d",{willReadFrequently:!0});c.imageSmoothingEnabled=!1;let d=[],u=0;for(let p=0;p<i;p++)for(let f=0;f<s;f++){c.clearRect(0,0,o,o),c.drawImage(r,f*o,p*o,o,o,0,0,o,o);let h=!1;try{let m=c.getImageData(0,0,o,o);h=this.isBlankOrBlack(m)}catch{h=!1}if(!n.includeBlanks&&h){u++;continue}if(n.mode==="bitmap"){let m=await createImageBitmap(l);d.push({sheet:a,url:e,index:u,col:f,row:p,size:o,data:m})}else if(n.mode==="canvas"){let m=document.createElement("canvas");m.width=o,m.height=o,m.getContext("2d").drawImage(l,0,0),d.push({sheet:a,url:e,index:u,col:f,row:p,size:o,data:m})}else{let m=await new Promise((g,y)=>{l.toBlob(v=>{if(!v){y(new Error("toBlob returned null"));return}let w=new FileReader;w.onerror=y,w.onload=()=>g(w.result),w.readAsDataURL(v)},"image/png")});d.push({sheet:a,url:e,index:u,col:f,row:p,size:o,data:m})}u++}return d}async zipTiles(e){let n=new ha.default;for(let r of this.tiles){let o=await this.sliceOne(r,{mode:"canvas",includeBlanks:!1,forceSize:e.forceSize}),s=Xr(r),i=0;for(let a of o){let l=a.data,c=await new Promise(d=>l.toBlob(u=>d(u),"image/png"));n.file(`${s}/tile_${String(++i).padStart(4,"0")}.png`,c)}}await this.saveZip(n,e.name)}supportsBlend(e){try{let n=document.createElement("canvas");n.width=n.height=1;let r=n.getContext("2d"),o=r.globalCompositeOperation;r.globalCompositeOperation=e;let s=r.globalCompositeOperation===e;return r.globalCompositeOperation=o,s}catch{return!1}}tileToCanvas(e){let n=e.data,r=e.size,o=e.size,s=document.createElement("canvas");s.width=r,s.height=o;let i=s.getContext("2d");if(i.imageSmoothingEnabled=!1,n instanceof HTMLCanvasElement)r=n.width,o=n.height,s.width=r,s.height=o,i.drawImage(n,0,0);else if(typeof ImageBitmap<"u"&&n instanceof ImageBitmap)r=n.width,o=n.height,s.width=r,s.height=o,i.drawImage(n,0,0);else{if(typeof n=="string")throw new Error("Sprites: tile.data est un dataURL (string). Recharge la tuile en mode 'canvas' ou 'bitmap'.");i.drawImage(n,0,0)}return s}makeAngleGradient(e,n,r,o){let s=o*Math.PI/180,i=n/2,a=r/2,l=Math.hypot(n,r),c=i-Math.cos(s)*l,d=a-Math.sin(s)*l,u=i+Math.cos(s)*l,p=a+Math.sin(s)*l;return e.createLinearGradient(c,d,u,p)}add(e,n=""){let r=qE(e);!OE(r)||this.all.has(r)||(BE(r)?(this.ui.add(r),this.all.add(r),console.debug("[Sprites] Asset UI d\xE9tect\xE9",{url:r,totals:this.ui.size}),this.onAssetCb?.(r,"ui")):DE(r)&&(this.tiles.add(r),this.all.add(r),console.debug("[Sprites] Tilesheet d\xE9tect\xE9",{url:r,totals:this.tiles.size}),this.onAssetCb?.(r,"tiles")))}installMainSniffers(){try{let e=Object.getOwnPropertyDescriptor(HTMLImageElement.prototype,"src");if(e&&!this.patched.imgDesc){this.patched.imgDesc=e,Object.defineProperty(HTMLImageElement.prototype,"src",{set:function(s){return Re.Sprites?.add?.(s,"img"),e.set.call(this,s)},get:e.get,configurable:!0,enumerable:e.enumerable});let n=HTMLImageElement.prototype,r=n.setAttribute;this.patched.setAttr=r;let o=this;n.setAttribute=function(s,i){try{String(s).toLowerCase()==="src"&&typeof i=="string"&&o.add(i,"img-attr")}catch{}return r.call(this,s,i)}}}catch{}try{if("PerformanceObserver"in Re){let e=new PerformanceObserver(n=>{n.getEntries().forEach(r=>this.add(r.name,"po"))});e.observe({entryTypes:["resource"]}),this.observers.push(e)}}catch{}}workerPreludeSource(){return`
      (function(){
        const IMG=/\\.(png|jpe?g|gif|webp|svg|avif|bmp|ico|ktx2|basis)$/i;
        const isImg=(u)=>{ try{return IMG.test(u)&&!String(u).startsWith('blob:')}catch{return false} };
        const post=(o)=>{ try{ self.postMessage(Object.assign({__awc:1}, o)); }catch{} };

        const F=self.fetch;
        if(F){
          self.fetch=async function(...a){
            let u=a[0]; try{ u=typeof u==='string'?u:(u&&u.url)||u; }catch{}
            const r=await F.apply(this,a);
            try{
              const ct=(r.headers&&r.headers.get&&r.headers.get('content-type'))||'';
              if((u&&isImg(u)) || /^image\\//i.test(ct)) post({ url:(typeof u==='string'?u:(u&&u.url)||String(u)), src:'worker:fetch', ct });
            }catch{}
            return r;
          };
        }

        const CIB=self.createImageBitmap;
        if(CIB){
          self.createImageBitmap=async function(b,...rest){
            try{ if(b&&/^image\\//i.test(b.type)) post({ url:'blob://imagebitmap', src:'worker:cib', ct:b.type }); }catch{}
            return CIB.call(this,b,...rest);
          };
        }

        const IS=self.importScripts;
        if(IS){
          self.importScripts=function(...urls){
            try{ urls.forEach(u=>post({ url:u, src:'worker:importScripts' })); }catch{}
            return IS.apply(this,urls);
          };
        }
      })();
    `}installWorkerHooks(){let e=Re,n=Re,r=Re!==Re,o=e.Worker,s=e.Blob,i=e.URL??URL,a=i.createObjectURL.bind(i);if(!(!s||!o)){if(!this.patched.Blob){this.patched.Blob=s;let l=this.patched.Blob,c=this,d=function(u=[],p={}){let f=new l(u,p),h=p&&p.type||"";if(/javascript|ecmascript/i.test(h)){let m=!0,g="";for(let y of u)if(typeof y=="string")g+=y;else{m=!1;break}m&&c.blobText.set(f,g)}return f};e.Blob=d,r&&(n.Blob=d),e.Blob.prototype=l.prototype,r&&(n.Blob.prototype=l.prototype)}if(!this.patched.createObjectURL){this.patched.createObjectURL=i.createObjectURL;let l=this.workerPreludeSource(),c=this,d=function(u){if(u instanceof e.Blob||u instanceof Blob){let p=(u.type||"").toLowerCase(),f=c.blobText.get(u)||"";if((/javascript/.test(p)||/onmessage|fetch\(|importScripts/.test(f))&&f){let m=new s([l+`
`+f+`
//# sourceURL=sprites-blob.js`],{type:p||"application/javascript"});return a(m)}}return a(u)};i.createObjectURL=d,r&&(URL.createObjectURL=d)}if(!this.patched.Worker){this.patched.Worker=e.Worker;let l=this.workerPreludeSource(),c=this,d=function(u,p){try{let h=new URL(String(u),location.href).href;if(!h.startsWith("blob:")){let m=p&&p.type==="module",g=m?`${l}
import "${h}";
//# sourceURL=sprites-wrapper-module.js`:`${l}
try{importScripts("${h}")}catch(e){}
//# sourceURL=sprites-wrapper-classic.js`,y=new s([g],{type:"text/javascript"}),v=a(y),w=new c.patched.Worker(v,m?{type:"module"}:{});return c.attachWorkerListener(w),w}}catch{}let f=new c.patched.Worker(u,p);return c.attachWorkerListener(f),f};e.Worker=d,r&&(n.Worker=d),e.Worker.toString=()=>this.patched.Worker.toString(),r&&(n.Worker.toString=()=>this.patched.Worker.toString())}}}attachWorkerListener(e){try{e.addEventListener("message",n=>{let r=n.data;r&&r.__awc&&r.url&&this.add(r.url,r.src||"worker")})}catch{}}async fetchBlob(e){let n=await fetch(e,{credentials:"include"});if(!n.ok)throw new Error(`HTTP ${n.status} for ${e}`);return n.blob()}async saveZip(e,n){let r=await e.generateAsync({type:"blob"}),o=document.createElement("a");o.href=URL.createObjectURL(r),o.download=n,document.body.appendChild(o),o.click(),o.remove(),setTimeout(()=>URL.revokeObjectURL(o.href),1e4)}},Km=new yd(!1);Mt("Sprites",Km);var ke=Km;function bd(t){let e=ke.init(t);return Mt("Sprites",e),console.debug("[Sprites] Instance globale disponible sur pageWindow.Sprites",{hasWindowProperty:"Sprites"in Re,lists:e.lists()}),e}Mt("initSprites",bd);var Sd=new WeakMap,eo=new Map,ms=new Map,fs=new Map,Vm=!1,ar=null,lr=null,cr=null,dr=null,On={Seed:["seeds","Seeds"],Egg:["pets","Pets","eggs","Eggs"],Tool:["items","Items"],Decor:["decor","Decor"]};function Ym(t,e){return`${t}::${e}`}function FE(t){let e=t.indexOf("::");if(e<=0)return null;let n=t.slice(0,e),r=t.slice(e+2);return!r||n!=="Seed"&&n!=="Egg"&&n!=="Tool"&&n!=="Decor"?null:{type:n,id:r}}function HE(t){switch(t){case"Seed":return"\u{1F331}";case"Egg":return"\u{1F95A}";case"Tool":return"\u{1F9F0}";default:return"\u{1F3E0}"}}function WE(t){let e=t.split(/[?#]/)[0]??t;return(e.split("/").pop()??e).replace(/\.[^.]+$/,"")}function ga(t,e){let n=new Set;for(let r of t)typeof r=="string"&&r.length&&n.add(WE(r));if(n.size===0)for(let r of e)n.add(r);return[...n]}function jE(){if(ar)return ar;try{if(typeof ke.listSeeds=="function")return ar=ga(ke.listSeeds(),On.Seed),ar}catch{}return ar=[...On.Seed],ar}function zE(){if(lr)return lr;try{if(typeof ke.listPets=="function")return lr=ga(ke.listPets(),On.Egg),lr}catch{}return lr=[...On.Egg],lr}function UE(){if(cr)return cr;try{if(typeof ke.listItems=="function")return cr=ga(ke.listItems(),On.Tool),cr}catch{}return cr=[...On.Tool],cr}function GE(){if(dr)return dr;try{if(typeof ke.listTilesByCategory=="function")return dr=ga(ke.listTilesByCategory(/decor/i),On.Decor),dr}catch{}return dr=[...On.Decor],dr}function KE(t){switch(t){case"Seed":return jE();case"Egg":return zE();case"Tool":return UE();case"Decor":return GE()}}function VE(t){if(t==null)return null;let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}function YE(t,e){switch(t){case"Seed":return Be?.[e]?.seed?.tileRef??null;case"Egg":return Pt?.[e]?.tileRef??null;case"Tool":return Rt?.[e]?.tileRef??null;case"Decor":return _t?.[e]?.tileRef??null}}function $E(t,e){let n=eo.get(t);n||(n=new Set,eo.set(t,n)),n.add(e)}function JE(t,e){let n=eo.get(t);n&&(e.isConnected||(n.delete(e),Sd.delete(e)),n.size===0&&eo.delete(t))}function wd(t,e){let n=Sd.get(t);if(!n)return;let{size:r,fallback:o,alt:s}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",t.setAttribute("role","img"),e){t.removeAttribute("aria-label"),t.style.fontSize="";let i=document.createElement("img");i.src=e,i.alt=s,i.decoding="async",i.loading="lazy",i.draggable=!1,i.style.width="100%",i.style.height="100%",i.style.objectFit="contain",t.appendChild(i)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.72))}px`,t.setAttribute("aria-label",s||o)}function vd(t,e){let n=eo.get(t);n&&n.forEach(r=>{if(!r.isConnected){JE(t,r);return}wd(r,e)})}function QE(){ar=null,lr=null,cr=null,dr=null}async function ZE(t,e){if(typeof window>"u"||typeof ke?.getTile!="function")return null;let n=YE(t,e),r=VE(n);if(r==null)return null;let o=KE(t);for(let s of o)try{let a=(await ke.getTile(s,r,"canvas"))?.data;if(!a||a.width<=0||a.height<=0)continue;let l=document.createElement("canvas");l.width=a.width,l.height=a.height;let c=l.getContext("2d");if(!c)continue;return c.imageSmoothingEnabled=!1,c.drawImage(a,0,0),l.toDataURL()}catch{}return null}function XE(){Vm||typeof window>"u"||(Vm=!0,window.addEventListener("mg:sprite-detected",()=>{ms.clear(),fs.clear(),QE(),Array.from(eo.keys()).forEach(e=>{let n=FE(e);n&&$m(n.type,n.id,e)})}))}function $m(t,e,n=Ym(t,e)){if(typeof window>"u")return ms.set(n,null),vd(n,null),Promise.resolve(null);let r=ms.get(n);if(r!==void 0)return vd(n,r),Promise.resolve(r);let o=fs.get(n);if(o)return o;let s=ZE(t,e).then(i=>(ms.set(n,i),fs.delete(n),vd(n,i),i)).catch(()=>(fs.delete(n),null));return fs.set(n,s),s}function to(t,e,n={}){let r=Math.max(12,n.size??36),o=String(n.fallback??HE(t)),s=typeof n.alt=="string"?n.alt:"",i=document.createElement("span");if(Sd.set(i,{size:r,fallback:o,alt:s}),typeof window>"u")return wd(i,null),i;let a=Ym(t,e);return $E(a,i),wd(i,ms.get(a)??null),XE(),$m(t,e,a),i}var va="menu:shops:auto",xd=`${va}:v1`;function hs(t){return async()=>{let e=await Xe.read(t),n=Ed(),r=[];for(let o of e.items??[]){if(!n.has(eh(t,o)))continue;Xe.getQty(o)>0&&r.push(Xe.buyAllInStock(t,o,{delayMs:10}))}r.length!==0&&(await Promise.allSettled(r),we("Auto-Buy","Activation success!","success"))}}function Ed(){let t=new Set;for(let e of t1())for(let n of Cd(e))n&&t.add(n);return t}function e1(t){let e=Array.from(t).filter(Boolean);n1(e)}function t1(){return[Jm(xd),Qm(xd),Jm(va),Qm(va)]}function Cd(t){if(!t)return[];if(Array.isArray(t))return t.map(e=>String(e).trim()).filter(Boolean);if(typeof t=="object"){let e=t?.items;return Array.isArray(e)?Cd(e):[]}if(typeof t=="string"){let e=t.trim();if(!e)return[];if(e.startsWith("{")||e.startsWith("[")||e==="null")try{let n=JSON.parse(e);return Cd(n)}catch{}return e.split(",").map(n=>n.trim()).filter(Boolean)}return[]}function n1(t){let e=Array.from(new Set(t.map(o=>String(o).trim()).filter(Boolean)));e.sort((o,s)=>o.localeCompare(s));let n=e.length?JSON.stringify({version:1,items:e}):"",r=e.join(",");Zm(xd,n),Zm(va,r)}function Jm(t){try{if(typeof GM_getValue=="function")return GM_getValue(t)}catch{}return null}function Qm(t){try{return typeof localStorage>"u"?null:localStorage.getItem(t)}catch{return null}}function Zm(t,e){try{typeof GM_setValue=="function"&&(e?GM_setValue(t,e):typeof GM_deleteValue=="function"?GM_deleteValue(t):GM_setValue(t,e))}catch{}try{typeof localStorage<"u"&&(e?localStorage.setItem(t,e):localStorage.removeItem(t))}catch{}}function eh(t,e){let n=Xe.identityFor(t,e);return`${t}:${n}`}function r1(t,e){let n=Xe.priceFromCatalog(t,e)??0,r=Xe.identityFor(t,e);return`${t}:${r}@${n}`}function o1(t,e){return e.map(n=>r1(t,n)).sort().join("|")}function s1(t,e){return String(t==="seeds"?e.species??e.id??e.name??"":t==="tools"?e.toolId??e.id??e.name??"":t==="eggs"?e.eggId??e.id??e.name??"":e.decorId??e.id??e.name??"")}var i1={seeds:"Seed",tools:"Tool",eggs:"Egg",decor:"Decor"};function a1(t,e){let n=i1[t];if(!n)return null;let r=t==="seeds"?e?.species??e?.id??e?.name??"":t==="tools"?e?.toolId??e?.id??e?.name??"":t==="eggs"?e?.eggId??e?.id??e?.name??"":e?.decorId??e?.id??e?.name??"",o=String(r??"").trim();return o?{type:n,id:o}:null}function th(t,e,n){return(t==="seeds"?n.seeds:t==="tools"?n.tools:t==="eggs"?n.eggs:n.decor).get(e)??0}function l1(t,e,n){for(let r of Array.from(t.querySelectorAll("tr"))){let o=r.dataset.pkey,s=r.dataset.stock;if(!o||!s)continue;let i=Number(s),a=th(e,o,n),l=r.children[3];l&&(l.textContent=nh(a,i))}}function nh(t,e){return t>=e&&e>0?`\u2714 ${e}/${e}`:`${t}/${e}`}function c1(t,e,n,r){let o=document.createElement("tr"),s=document.createElement("td"),i=Xe.identityFor(e,n),a=document.createElement("div");a.className="qmm-shop-row__name";let l=a1(e,n);if(l){let w=to(l.type,l.id,{size:34,alt:i});w.classList.add("qmm-shop-row__icon"),a.appendChild(w)}let c=document.createElement("span");c.textContent=i,c.className="qmm-shop-row__label",a.appendChild(c),s.appendChild(a),o.appendChild(s);let d=document.createElement("td"),u=Xe.priceFromCatalog(e,n);d.textContent=u==null?"\u2014":`${Zr(u)??String(u)} `,o.appendChild(d);let p=document.createElement("td"),f=eh(e,n),h=t.switch(Ed().has(f));h.addEventListener("change",async()=>{let w=Ed();if(h.checked){w.add(f);try{await Xe.buyAllInStock(e,n,{delayMs:10})}catch{}}else w.delete(f);e1(w)}),p.appendChild(h),o.appendChild(p);let m=document.createElement("td");m.className="qmm-num";let g=s1(e,n),y=th(e,g,r),v=Xe.getQty(n);return m.textContent=nh(y,v),o.appendChild(m),o.dataset.pkey=g,o.dataset.stock=String(v),o.dataset.pkey=g,o}async function Td(t,e,n,r){n.innerHTML="";let{items:o}=await Xe.read(e);o.sort((i,a)=>{let l=Xe.priceFromCatalog(e,i)??Number.POSITIVE_INFINITY,c=Xe.priceFromCatalog(e,a)??Number.POSITIVE_INFINITY;return(isFinite(l)?l:1/0)-(isFinite(c)?c:1/0)});let s=document.createDocumentFragment();for(let i of o)s.appendChild(c1(t,e,i,r));n.appendChild(s)}var Xm={};async function ya(t,e,n){let{items:r}=await Xe.read(e),o=await Xe.readPurchasesMaps(),s=o1(e,r);s!==Xm[e]&&(Xm[e]=s,await Td(t,e,n,o))}async function ba(t,e,n){let r=n.table(["Item","Price","Auto","Bought"],{minimal:!0,compact:!0,maxHeight:"44vh"});t.appendChild(r.root);let o=await Xe.readPurchasesMaps();await Td(n,e,r.tbody,o);try{await Xe.onQuantityChange(e,async()=>{try{o=await Xe.readPurchasesMaps(),await Td(n,e,r.tbody,o)}catch(s){console.error(s)}})}catch{}try{await Xe.onPurchasesChange(s=>{o=s,l1(r.tbody,e,o)})}catch{}}async function rh(t){let e=new Ye({id:"shops",compact:!0});e.mount(t);let n=document.createElement("style");n.textContent=`
    /* adapte les s\xE9lecteurs \xE0 ta lib si besoin */
    .qmm-tabs .qmm-tab, .qmm-tabs button, .qmm-tab {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      white-space: pre-line; /* respecte 
 */
      line-height: 1.1;
      gap: 2px;
      text-align: center;
      padding-block: 8px; /* un peu d'air vertical */
    }
    .qmm-shop-row__name {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .qmm-shop-row__icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.08);
      padding: 2px;
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.05);
    }
    .qmm-shop-row__icon img {
      image-rendering: pixelated;
    }
    .qmm-shop-row__label {
      display: inline-block;
    }
  `,document.head.appendChild(n),e.addTabs([{id:"seeds",title:`\u{1F330}
Seeds`,render:r=>ba(r,"seeds",e)},{id:"tools",title:`\u{1F9FA}
Tools`,render:r=>ba(r,"tools",e)},{id:"eggs",title:`\u{1F95A}
Eggs`,render:r=>ba(r,"eggs",e)},{id:"decor",title:`\u{1F380}
Decor`,render:r=>ba(r,"decor",e)}]);try{await ya(e,"seeds",e)}catch{}try{await ya(e,"tools",e)}catch{}try{await ya(e,"eggs",e)}catch{}try{await ya(e,"decor",e)}catch{}}function Nt(t){return t.toLowerCase().replace(/['’`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function kd(t){if(!t)return null;let e=String(t),n=e.split(".").pop()||e;return Nt(n)}function ih(t){let e=t?.crop?.name;return e?Nt(e):null}function d1(t){return t?t.charAt(0).toUpperCase()+t.slice(1):null}var oh=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728","\u{1F506}","\u{1F52E}"];function u1(){let t=[];for(let[e,n]of Object.entries(Be)){let r=n?.seed?.name,o=n?.crop?.name,s=n?.plant?.name;t.push({key:e,seedName:r,cropName:o,plantName:s})}return t}function p1(t){let e=new Map;return t.forEach((n,r)=>e.set(n.key,oh[r%oh.length])),e}function f1(){let t=new Map,e=new Map,n=new Map;for(let r of Object.values(Be)){let o=ih(r);if(!o)continue;t.has(o)||t.set(o,r);let s=[kd(r?.seed?.tileRef),kd(r?.plant?.tileRef),kd(r?.crop?.tileRef),r?.seed?.species?Nt(r.seed.species):null,r?.crop?.name?Nt(r.crop.name):null,r?.plant?.name?Nt(r.plant.name):null],i=!1,a=r?.plant?.harvestType??r?.seed?.harvestType??r?.grow?.harvestType??r?.harvestType;if(a&&typeof a=="string"){let l=Ue[a]??a;i=String(l).toLowerCase()!=="single"}if(!i&&r?.crop?.name){let l=String(r.crop.name).toLowerCase();/(fruit|berry|bush|tree)/.test(l)&&(i=!0)}for(let l of s)l&&e.set(l,d1(o));n.set(o,!!i)}return{byBase:t,speciesToBaseCap:e,baseIsMulti:n}}var ah=f1();function gs(t){if(!t)return null;let e=Nt(t);return ah.speciesToBaseCap.get(e)??null}function m1(t){if(!t)return!1;let e=gs(t);if(!e)return!1;let n=Nt(e);return ah.baseIsMulti.get(n)??!1}var Jt={selected:"garden.selectedSeed",assignments:"garden.assignments",autoPlant:"garden.autoPlantEnabled",harvestRules:"garden.harvest.rules.v1",autoSellRules:"garden.autosell.rules.v1"};function wa(t,e){let n;return function(...r){n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>t.apply(this,r),e)}}function h1(){try{let t=localStorage.getItem(Jt.harvestRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var sh=wa(t=>{try{localStorage.setItem(Jt.harvestRules,JSON.stringify(t))}catch{}},150);function g1(){try{let t=localStorage.getItem(Jt.autoSellRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var y1=wa(t=>{try{localStorage.setItem(Jt.autoSellRules,JSON.stringify(t))}catch{}},150),ze=class ze{constructor(){ce(this,"seedOptions",u1());ce(this,"_emojiByKey",p1(this.seedOptions));ce(this,"_speciesToKey",new Map);ce(this,"_baseToKeys",new Map);ce(this,"_basePrimary",new Map);ce(this,"_maxScaleByBase",new Map);ce(this,"_selectedSeed",this.seedOptions[0]?.key??"");ce(this,"listeners",new Set);ce(this,"_assign",new Map);ce(this,"_slotState",new Map);ce(this,"_autoTimer",null);ce(this,"_autoRunning",!1);ce(this,"_tickCount",0);ce(this,"_lastResyncErrorAt",0);ce(this,"_autoHarvestTimer",null);ce(this,"_isHarvestTicking",!1);ce(this,"_harvestRules",{});ce(this,"_compiledRules",new Map);ce(this,"_enabledBases",new Set);ce(this,"_autoSellRules",{});ce(this,"_invCountBySeedKey",new Map);ce(this,"_scratchMature",[]);ce(this,"_scratchPairs",[]);ce(this,"_boundTickPlant",()=>{this.tickAutoPlant().catch(()=>{})});ce(this,"_boundTickHarvest",()=>{this._tickAutoHarvest().catch(()=>{})});ce(this,"saveSelectedSeed",wa(()=>{try{localStorage.setItem(Jt.selected,this._selectedSeed)}catch{}},150));ce(this,"saveAssignments",wa(()=>{try{localStorage.setItem(Jt.assignments,JSON.stringify(Array.from(this._assign.entries())))}catch{}},200));ce(this,"_autoSellTimer",null);ce(this,"_autoSellPendingReason",null);ce(this,"_lastKnownPlayers",0);ce(this,"assignments",{get:e=>this._assign.get(e),set:(e,n)=>{this._assign.get(e)!==n&&(this._assign.set(e,n),this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},delete:e=>{this._assign.delete(e)&&(this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},clear:()=>{this._assign.size!==0&&(this._assign.clear(),this.saveAssignments(),this.emit({type:"assignments-changed"}))},invert:e=>{let n=new Map;for(let r=0;r<200;r++)this._assign.has(r)||n.set(r,e);this._assign=n,this.saveAssignments(),this.emit({type:"assignments-changed"})},entries:()=>this._assign.entries(),size:()=>this._assign.size});ce(this,"runtime",{getSlotState:e=>this._slotState.get(e)??"empty",setSlotState:(e,n)=>{this._slotState.get(e)!==n&&(this._slotState.set(e,n),this.emit({type:"runtime-changed",slots:[e]}))}});for(let e of this.seedOptions){let n=[e.cropName,e.plantName,e.seedName].filter(Boolean);for(let r of n)this._speciesToKey.set(Nt(r),e.key)}for(let[e,n]of Object.entries(Be)){let r=ih(n);if(!r)continue;let o=Nt(r),s=this._baseToKeys.get(o)??[];s.length===0&&this._basePrimary.set(o,e),s.push(e),this._baseToKeys.set(o,s);let i=Number(n?.crop?.maxScale)||1;this._maxScaleByBase.has(o)||this._maxScaleByBase.set(o,i)}this.loadSelectedSeed(),this.loadAssignments(),this.restoreAutoPlantState(),this._harvestRules=h1(),this._rebuildCompiledRulesAndEnabledBases(),Object.keys(this._harvestRules).length&&this.emit({type:"harvest-rules-replaced",rules:this.getAllHarvestRules()}),this._autoSellRules=g1(),Object.keys(this._autoSellRules).length&&this.emit({type:"auto-sell-rules-replaced",rules:this.getAllAutoSellRules()}),this._recomputeAutoHarvestLoop();try{Se.getCropInventoryState&&Se.getCropInventoryState().then(e=>this._rebuildInvCountsFromArray(e||[])).catch(()=>{}),Se.onCropInventoryDiffNow&&Se.onCropInventoryDiffNow((e,n)=>{Array.isArray(e)&&this._rebuildInvCountsFromArray(e),(n?.added?.length||n?.removed?.length||n?.updated?.length)&&this._scheduleAutoSell("inventory")})}catch{}try{Se.onNumPlayersChangeNow(e=>{this._lastKnownPlayers=e,this._scheduleAutoSell("players")}),Se.onFavoriteIdsChangeNow&&Se.onFavoriteIdsChangeNow(e=>{})}catch{}}_scheduleAutoSell(e){this._autoSellPendingReason=e,this._autoSellTimer===null&&(this._autoSellTimer=window.setTimeout(()=>{this._autoSellTimer=null;let n=this._autoSellPendingReason||"unknown";this._autoSellPendingReason=null,this._runAutoSell(n).catch(()=>{})},120))}loadSelectedSeed(){try{let e=localStorage.getItem(Jt.selected);if(!e)return;this.seedOptions.some(r=>r.key===e)&&(this._selectedSeed=e)}catch{}}loadAssignments(){try{let e=localStorage.getItem(Jt.assignments);if(!e)return;let n=JSON.parse(e),r=new Map;for(let[o,s]of n)r.set(o,s);this._assign=r}catch{}}restoreAutoPlantState(){try{localStorage.getItem(Jt.autoPlant)==="1"&&this.startAutoPlant(!0)}catch{}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(e){for(let n of this.listeners)try{n(e)}catch{}}getEmojiFor(e){let n=this.seedOptions.find(r=>r.seedName===e);return n?this._emojiByKey.get(n.key)??"\u2022":"\u2022"}getEmojiForKey(e){return this._emojiByKey.get(e)??"\u2022"}getSelectedSeed(){return this._selectedSeed}setSelectedSeed(e){this._selectedSeed!==e&&(this._selectedSeed=e,this.saveSelectedSeed(),this.emit({type:"selected-seed-changed"}))}getVisualState(e){if(!this._assign.has(e))return"unassigned";let n=this._slotState.get(e)??"empty";return n==="empty"?"ok":n==="single"?"waiting":"blocked"}getAutoPlantEnabled(){return this._autoRunning}async syncNow(){await this.refreshFromPlayerGarden()}async refreshFromPlayerGarden(){let e=performance.now();try{let n=await Se.getGardenState();if(!n||!n.tileObjects)return;let r=n.tileObjects,o=[];for(let[s,i]of Object.entries(r)){let a=Number(s),l=this.classifyTileObject(i??null);this._slotState.get(a)!==l&&(this._slotState.set(a,l),o.push(a))}for(let s of this._slotState.keys())String(s)in r||this._slotState.get(s)!=="empty"&&(this._slotState.set(s,"empty"),o.push(s));o.length&&this.emit({type:"runtime-changed",slots:o}),o.length}catch{this._lastResyncErrorAt=Date.now()}}classifyTileObject(e){if(!e)return"empty";let n=e?.species||e?.name||e?.title;if(n&&m1(n))return"multi";let r=(e.objectType||e.type||"").toString().toLowerCase();return r.includes("plant")||r.includes("crop")||r.includes("egg")||r.includes("decor")||r.includes("item")||r.includes("pet"),"single"}startAutoPlant(e){if(!this._autoRunning){this._autoRunning=!0,this.refreshFromPlayerGarden().catch(()=>{}),e||we("Garden","Auto plant enabled!","success");try{localStorage.setItem(Jt.autoPlant,"1")}catch{}this._autoTimer=window.setInterval(this._boundTickPlant,ze.TICK_MS)}}stopAutoPlant(){if(this._autoRunning){this._autoRunning=!1,this._autoTimer!==null&&(window.clearInterval(this._autoTimer),this._autoTimer=null);try{localStorage.setItem(Jt.autoPlant,"0")}catch{}we("Garden","Auto plant disabled.","info")}}async tickAutoPlant(){if(!this._autoRunning||(this._tickCount=(this._tickCount+1)%ze.RESYNC_EVERY_TICKS,this._tickCount===0&&await this.refreshFromPlayerGarden(),Date.now()-this._lastResyncErrorAt<1500))return;let e=!1;for(let[n,r]of this._assign){if(this.getVisualState(n)!=="ok"||this.runtime.getSlotState(n)!=="empty")continue;let o=gs(r);if(o)try{await Se.plantSeed(n,o),_e.incrementGardenStat("totalPlanted"),e=!0}catch{}}e&&await this.refreshFromPlayerGarden()}static defaultHarvestRule(){return{enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[],minInventory:91}}static defaultAutoSellRule(){return{enabled:!1,keepMin:0,minSizePct:50,keepVisual:["Normal"],keepWeather:[],minPlayers:0}}getHarvestRule(e){let n=this._harvestRules[e];return n?JSON.parse(JSON.stringify(n)):null}setHarvestRule(e,n){let r=(s,i,a)=>Math.max(i,Math.min(a,Math.floor(Number(s)||0))),o={enabled:!!n.enabled,minScalePct:r(n.minScalePct??50,50,100),visualIncludeNormal:!!n.visualIncludeNormal,visualMutations:Array.isArray(n.visualMutations)?[...n.visualMutations]:[],weatherMode:["ANY","ALL","RECIPES"].includes(n.weatherMode)?n.weatherMode:"ANY",weatherSelected:Array.isArray(n.weatherSelected)?[...n.weatherSelected]:[],weatherRecipes:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(s=>Array.isArray(s)?[...s]:[]):[],minInventory:r(n.minInventory??0,0,91)};this._harvestRules[e]=o,this._compileRule(e,o),this._rebuildEnabledBases(),sh(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(o))}),this._recomputeAutoHarvestLoop()}getAutoHarvestEnabledForSeed(e){return!!this._harvestRules[e]?.enabled}setAutoHarvestEnabledForSeed(e,n){let o={...this._harvestRules[e]??ze.defaultHarvestRule(),enabled:!!n};this._harvestRules[e]=o,this._compileRule(e,o),this._rebuildEnabledBases(),sh(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(o))}),this._recomputeAutoHarvestLoop()}getAllHarvestRules(){return JSON.parse(JSON.stringify(this._harvestRules))}_anyAutoHarvestEnabled(){return this._enabledBases.size>0}_recomputeAutoHarvestLoop(){let e=this._anyAutoHarvestEnabled();e&&this._autoHarvestTimer===null?this._autoHarvestTimer=window.setInterval(this._boundTickHarvest,ze.HARVEST_TICK_MS):!e&&this._autoHarvestTimer!==null&&(window.clearInterval(this._autoHarvestTimer),this._autoHarvestTimer=null)}_isPlantObject(e){return(e?.objectType||e?.type||"").toString().toLowerCase().includes("plant")}getSizeCrop(e,n){let r=gs(e)??e,o=Nt(r),s=this._maxScaleByBase.get(o)??1;if(!s||s<=1)return 100;let a=50+(Math.max(1,Math.min(s,Number(n)||1))-1)/(s-1)*50;return Math.max(50,Math.min(100,Math.round(a)))}_seedKeyEnabledForBase(e){return this._enabledBases.has(e)}getAutoSellRule(e){let n=this._autoSellRules[e];return n?JSON.parse(JSON.stringify(n)):null}getAllAutoSellRules(){return JSON.parse(JSON.stringify(this._autoSellRules))}getAutoSellEnabledForSeed(e){return!!this._autoSellRules[e]?.enabled}setAutoSellRule(e,n){let r=(a,l,c)=>Math.max(l,Math.min(c,Math.floor(Number(a)||0))),o=["Normal","Gold","Rainbow"],s=["Wet","Chilled","Frozen","Dawnlit","Amberglow"],i={enabled:!!n.enabled,keepMin:r(n.keepMin??0,0,91),minSizePct:r(n.minSizePct??50,50,100),keepVisual:Array.isArray(n.keepVisual)?[...new Set(n.keepVisual.filter(a=>o.includes(a)))]:["Normal"],keepWeather:Array.isArray(n.keepWeather)?[...new Set(n.keepWeather.filter(a=>s.includes(a)))]:[],minPlayers:r(n.minPlayers??0,0,6)};this._autoSellRules[e]=i,y1(this._autoSellRules),this.emit({type:"auto-sell-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(i))}),this._scheduleAutoSell("rules")}static toVisualMask(e){let n=0;for(let r of e)r==="Gold"?n|=ze.V_GOLD:r==="Rainbow"&&(n|=ze.V_RAINBOW);return n}static toWeatherMask(e){let n=0;for(let r of e)r==="Wet"?n|=ze.W_WET:r==="Chilled"?n|=ze.W_CHILLED:r==="Frozen"?n|=ze.W_FROZEN:r==="Dawnlit"?n|=ze.W_DAWNLIT:r==="Amberglow"&&(n|=ze.W_AMBER);return n}static mutsToMasks(e){let n=0,r=0;if(!Array.isArray(e))return[0,0];for(let o=0;o<e.length;o++)switch(e[o]){case"Gold":n|=ze.V_GOLD;break;case"Rainbow":n|=ze.V_RAINBOW;break;case"Wet":r|=ze.W_WET;break;case"Chilled":r|=ze.W_CHILLED;break;case"Frozen":r|=ze.W_FROZEN;break;case"Dawnlit":r|=ze.W_DAWNLIT;break;case"Amberglow":r|=ze.W_AMBER;break;default:break}return[n,r]}_compileRule(e,n){let r={enabled:!!n.enabled,minScalePct:Math.min(100,Math.max(50,Math.floor(n.minScalePct??50))),allowNormal:!!n.visualIncludeNormal,visualMaskWanted:ze.toVisualMask(n.visualMutations||[]),weatherMode:n.weatherMode,weatherMask:ze.toWeatherMask(n.weatherSelected||[]),recipeMasks:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(ze.toWeatherMask):[],minInventory:Math.max(0,Math.floor(n.minInventory??0))};this._compiledRules.set(e,r)}_rebuildCompiledRulesAndEnabledBases(){this._compiledRules.clear();for(let[e,n]of Object.entries(this._harvestRules))this._compileRule(e,n);this._rebuildEnabledBases()}_rebuildEnabledBases(){this._enabledBases.clear();for(let[e,n]of this._baseToKeys)n.some(r=>this._harvestRules[r]?.enabled)&&this._enabledBases.add(e)}_getPrimarySeedKeyForBase(e){return this._basePrimary.get(e)??null}_passesMutationRulesCompiled(e,n,r){if(!e.enabled)return!1;if(n===0){if(!e.allowNormal)return!1}else if(e.visualMaskWanted!==0&&!(n&e.visualMaskWanted))return!1;if(e.weatherMode==="ANY")return e.weatherMask===0?!0:(r&e.weatherMask)!==0;if(e.weatherMode==="ALL")return e.weatherMask===0?!0:(r&e.weatherMask)===e.weatherMask;if(!e.recipeMasks.length)return!0;for(let s=0;s<e.recipeMasks.length;s++){let i=e.recipeMasks[s];if((r&i)===i)return!0}return!1}_rebuildInvCountsFromArray(e){let n=new Map;for(let r of Array.isArray(e)?e:[]){let o=this.seedKeyFromSpecies(r?.species||"")||null;o&&n.set(o,(n.get(o)||0)+1)}this._invCountBySeedKey=n}_getStockForBase(e){let n=this._baseToKeys.get(e);if(!n||!n.length)return 0;let r=0;for(let o of n)r+=this._invCountBySeedKey.get(o)||0;return r}async _tickAutoHarvest(){if(!this._isHarvestTicking&&this._anyAutoHarvestEnabled()){if(this._isHarvestTicking=!0,this._invCountBySeedKey.size===0&&Se.getCropInventoryState)try{let e=await Se.getCropInventoryState();Array.isArray(e)&&this._rebuildInvCountsFromArray(e)}catch{}try{let e=await Se.getGardenState(),n=Date.now(),r=e?.tileObjects??{};this._scratchPairs.length=0;let o=new Map,s=10;e:for(let[l,c]of Object.entries(r)){let d=Number(l);if(!Number.isInteger(d)||!this._isPlantObject(c))continue;let u=c?.species||c?.name||c?.title;if(!u)continue;let p=gs(u)??u,f=Nt(p);if(!this._seedKeyEnabledForBase(f))continue;let h=this._getPrimarySeedKeyForBase(f);if(!h)continue;let m=this._compiledRules.get(h);if(!m||!m.enabled)continue;let g=o.get(f);if(g===void 0){let v=Math.max(0,m.minInventory||0);if(v>0){let w=this._getStockForBase(f),x=v-w;if(x<=0)continue;g=x}else g=1/0;o.set(f,g)}else if(g<=0)continue;this._scratchMature.length=0;let y=Array.isArray(c?.slots)?c.slots:[];for(let v=0;v<y.length;v++){let w=y[v]?.endTime;typeof w=="number"&&w<=n&&this._scratchMature.push(v)}if(this._scratchMature.length!==0)for(let v=0;v<this._scratchMature.length;v++){let w=this._scratchMature[v],x=c?.slots?.[w],E=x?.targetScale??1,L=this.getSizeCrop(u,E);if(L<(m.minScalePct||50)||!dt.allowsHarvest({seedKey:h,sizePercent:L,mutations:Array.isArray(x?.mutations)?x.mutations:[]}))continue;let[P,V]=ze.mutsToMasks(x?.mutations);if(this._passesMutationRulesCompiled(m,P,V)){if(g!==1/0&&g<=0||(this._scratchPairs.push({slot:d,sub:w}),g!==1/0&&(g-=1,o.set(f,g),g<=0)))break;if(this._scratchPairs.length>=s)break e}}}let i=!1,a=0;for(let l=0;l<this._scratchPairs.length;l++){let{slot:c,sub:d}=this._scratchPairs[l];try{await Se.harvestCrop(c,d),_e.incrementGardenStat("totalHarvested"),i=!0,a++}catch{}}i&&await this.refreshFromPlayerGarden()}catch{}finally{this._isHarvestTicking=!1}}}seedKeyFromSpecies(e){if(!e)return null;let n=Nt(e),r=this._speciesToKey.get(n);if(r)return r;let o=gs(e);if(!o)return null;let s=Nt(o);return this._basePrimary.get(s)??this._baseToKeys.get(s)?.[0]??null}sizePercent(e,n){return this.getSizeCrop(e,n)}_hasVisual(e,n){let r=Array.isArray(e?.mutations)?e.mutations:[];return n==="Normal"?!(r.includes("Gold")||r.includes("Rainbow")):r.includes(n)}_hasWeather(e,n){return(Array.isArray(e?.mutations)?e.mutations:[]).includes(n)}async _runAutoSell(e){let n=(()=>{try{return localStorage.getItem("qws:autoSell:dbg")==="1"}catch{return!1}})(),r=(s,...i)=>{if(n)try{console.debug("[AutoSell]",s,...i)}catch{}let a=i.length===0?void 0:i.length===1?i[0]:i},o=s=>new Intl.NumberFormat("fr-FR",{maximumFractionDigits:0}).format(s);try{let[s,i]=await Promise.all([Se.getCropInventoryState?.()??null,Se.getFavoriteIds?.()??[]]),a=Array.isArray(s)?s:[],l=new Set(Array.isArray(i)?i:[]),c=this._lastKnownPlayers;if(!a.length){r("skip: inventory empty");return}let d=new Map;for(let g of a){let y=this.seedKeyFromSpecies(g?.species||"")||"__unknown__";(d.get(y)??d.set(y,[]).get(y)).push(g)}let u=[];for(let[g,y]of d){let v=this._autoSellRules[g];if(!v?.enabled){r("seed skip: disabled",g);continue}if(c<(v.minPlayers||0)){r("seed skip: minPlayers",{seedKey:g,numPlayers:c,need:v.minPlayers||0});continue}let w=y.map(P=>({it:P,size:this.sizePercent(P?.species||"",Number(P?.scale)||1)})).sort((P,V)=>V.size-P.size),x=[];for(let{it:P,size:V}of w)[...v.keepVisual||[]].some(z=>this._hasVisual(P,z))||[...v.keepWeather||[]].some(z=>this._hasWeather(P,z))||V<(v.minSizePct||50)||x.push({it:P,size:V});let E=x.filter(P=>!l.has(P.it.id)),L=Math.max(0,v.keepMin|0);if(E.length<=L){r("seed keep all (pool <= keepMin)",{seedKey:g,pool:E.length,keepMin:L});continue}for(let P=L;P<E.length;P++)u.push(E[P].it.id);r("seed sell add",{seedKey:g,count:E.length-L})}if(u.length===0){r("no sell candidates");return}let p=new Set(u),f=[];for(let g of a){let y=String(g.id);p.has(y)||l.has(y)||f.push(y)}r("tempFavAdds",f.length);let h=0;try{h=Number(await pe.shop.totalCropSellPrice?.get?.())||0}catch{}for(let g of f)try{await Se.toggleFavoriteItem(g)}catch(y){r("tempFav add err",g,y)}try{let g=Number(await pe.shop.totalCropSellPrice?.get?.());Number.isFinite(g)&&g>=0&&(h=g)}catch{}let m=!1;try{Se.sellNow?await Se.sellNow("autosell"):((async()=>{try{let g=await pe.inventory.myCropItemsToSell.get(),y=Array.isArray(g)?g.length:0;y>0&&_e.incrementShopStat("cropsSoldCount",y)}catch(g){console.error("[SellAllCrops] Unable to read crop items",g)}try{let g=await pe.shop.totalCropSellPrice.get(),y=Number(g);Number.isFinite(y)&&y>0&&_e.incrementShopStat("cropsSoldValue",y)}catch(g){console.error("[SellAllCrops] Unable to read crop sell price",g)}})(),await Se.sellAllCrops()),m=!0,r("sell done",{sold:u.length})}catch(g){r("sell error",g)}try{let g="Auto-Sell";if(m){let y=o(Math.max(0,h));typeof we=="function"&&we(g,h>0?`Sold (~${y}\u{1F4B0})`:"Sold successfully","success")}else typeof we=="function"&&we(g,"Sell failed","error")}catch{}for(let g of f)try{await Se.toggleFavoriteItem(g)}catch(y){r("restore err",g,y)}}catch{}}};ce(ze,"TICK_MS",350),ce(ze,"RESYNC_EVERY_TICKS",10),ce(ze,"HARVEST_TICK_MS",1e3),ce(ze,"V_GOLD",1),ce(ze,"V_RAINBOW",2),ce(ze,"W_WET",1),ce(ze,"W_CHILLED",2),ce(ze,"W_FROZEN",4),ce(ze,"W_DAWNLIT",8),ce(ze,"W_AMBER",16);var Id=ze,Ae=new Id;function rt(t,e){let n=document.createElement("label");n.style.display="inline-flex",n.style.alignItems="center",n.style.gap="6px",n.style.padding="4px 8px",n.style.border="1px solid #4444",n.style.borderRadius="8px";let r=document.createElement("input");r.type="checkbox";let o=document.createElement("span");return o.textContent=e??t,n.append(r,o),{wrap:n,input:r,key:t}}function ft(t,e){t.checked=!!e}function qn(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function b1(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.flexDirection="row",s.style.alignItems="center",s.style.gap="8px",r.appendChild(s);function i(){o.innerHTML="";let y=Ae.getSelectedSeed(),v=new Set;for(let[,L]of Ae.assignments.entries())v.add(L);Ae.seedOptions.forEach(({key:L,seedName:P})=>{let V=Ae.getEmojiFor(P),z=document.createElement("button");z.className="qmm-vtab",z.style.display="grid",z.style.gridTemplateColumns="16px 1fr auto",z.style.alignItems="center",z.style.gap="8px",z.style.textAlign="left",z.style.padding="6px 8px",z.style.borderRadius="8px",z.style.border="1px solid #4445",z.style.background="#1f2328",z.style.color="#e7eef7";let C=L===Ae.getSelectedSeed();z.style.background=C?"#2b8a3e":"#1f2328";let D=document.createElement("span");D.className="qmm-dot",D.style.background=v.has(L)?"#2ecc71":"#7779";let S=document.createElement("span");S.className="label",S.textContent=P;let G=document.createElement("span");G.textContent=V,G.style.fontSize="14px",z.append(D,S,G),z.onmouseenter=()=>z.style.borderColor="#6aa1",z.onmouseleave=()=>z.style.borderColor="#4445",z.onclick=()=>Ae.setSelectedSeed(L),o.appendChild(z)}),s.innerHTML="";let w=document.createElement("button");qn(w,"Clear"),w.onclick=()=>Ae.assignments.clear();let x=document.createElement("button");qn(x,"Invert"),x.onclick=()=>Ae.assignments.invert(Ae.getSelectedSeed());let E=e.switch(!1);E.checked=Ae.getAutoPlantEnabled?.()??!1,E.addEventListener("change",()=>{E.checked?Ae.startAutoPlant?.():Ae.stopAutoPlant?.()}),E.style.marginLeft="auto",s.append(w,x,E)}let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="8px",n.appendChild(a);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateColumns="repeat(10, 1fr) 12px repeat(10, 1fr)",l.style.gridTemplateRows="repeat(10, 1fr)",l.style.gap="2px",l.style.height="53vh",l.style.aspectRatio="20 / 10",l.style.width="auto",l.style.padding="6px",l.style.border="1px solid #3335",l.style.borderRadius="8px",l.style.background="#0f1115",l.style.boxSizing="border-box",l.oncontextmenu=y=>y.preventDefault(),a.appendChild(l);let c=!1,d="assign";l.addEventListener("mousedown",y=>{c=!0,d=y.button===2?"erase":"assign"}),window.addEventListener("mouseup",()=>{c=!1});function u(y){y.style.border="1px solid #0002",y.style.borderRadius="4px",y.style.cursor="pointer",y.style.userSelect="none",y.style.display="flex",y.style.alignItems="center",y.style.justifyContent="center"}function p(y){return y==="unassigned"?"#9aa1a822":y==="ok"?"#28a74555":y==="waiting"?"#ffc10755":"#dc354555"}function f(y){let v=l.querySelector(`div[data-slot="${y}"]`);if(!v)return;v.style.background=p(Ae.getVisualState(y));let w=Ae.assignments.get(y),x=v.querySelector("span");if(w){let E=Ae.seedOptions.find(L=>L.key===w)?.seedName??w;x.textContent=Ae.getEmojiFor(E),x.style.opacity="1",x.style.fontSize="14px"}else x.textContent="",x.style.opacity="0.5"}function h(){for(let y=0;y<200;y++)f(y)}for(let y=0;y<10;y++){for(let w=0;w<10;w++)l.appendChild(m(y*20+w));let v=document.createElement("div");v.style.width="12px",v.style.height="100%",v.style.pointerEvents="none",v.style.background="transparent",l.appendChild(v);for(let w=10;w<20;w++)l.appendChild(m(y*20+w))}function m(y){let v=document.createElement("div");v.dataset.slot=String(y),u(v);let w=document.createElement("span");return w.style.pointerEvents="none",w.style.fontWeight="600",w.style.fontSize="10px",w.style.color="#e7eef7aa",v.appendChild(w),v.addEventListener("click",x=>{if(x.ctrlKey||x.metaKey){let E=Ae.runtime.getSlotState(y),L=E==="empty"?"single":E==="single"?"multi":"empty";Ae.runtime.setSlotState(y,L)}else Ae.assignments.set(y,Ae.getSelectedSeed())}),v.addEventListener("contextmenu",x=>{x.preventDefault(),Ae.assignments.delete(y)}),v.addEventListener("mouseover",()=>{c&&(d==="assign"?Ae.assignments.set(y,Ae.getSelectedSeed()):Ae.assignments.delete(y))}),v}let g=Ae.subscribe(y=>{y.type==="assignments-changed"||y.type==="runtime-changed"?(y.slots?.length?y.slots.forEach(f):h(),y.type==="assignments-changed"&&i()):(y.type==="seed-list-changed"||y.type==="selected-seed-changed")&&i()});i(),h()}var lh=new Map;function ln(t){let e=lh.get(t);if(!e){e={enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:new Set,weatherMode:"ANY",weatherSelected:new Set,weatherRecipes:[],minInventory:91};let n=Ae.getHarvestRule?.(t);n&&(e.enabled=!!n.enabled,e.minScalePct=n.minScalePct??50,e.visualIncludeNormal=!!n.visualIncludeNormal,e.visualMutations=new Set(n.visualMutations??[]),e.weatherMode=n.weatherMode??"ANY",e.weatherSelected=new Set(n.weatherSelected??[]),e.weatherRecipes=(n.weatherRecipes??[]).map(r=>new Set(r)),e.minInventory=Math.max(0,Math.floor(n.minInventory??91))),lh.set(t,e)}return e}function v1(t){return{enabled:t.enabled,minScalePct:t.minScalePct,visualIncludeNormal:t.visualIncludeNormal,visualMutations:[...t.visualMutations],weatherMode:t.weatherMode,weatherSelected:[...t.weatherSelected],weatherRecipes:t.weatherRecipes.map(e=>[...e]),minInventory:t.minInventory}}function w1(t,e){t.innerHTML="",t.__unsubHarvest?.();let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.gap="6px",r.appendChild(s);let i=document.createElement("button");qn(i,"Enable all"),i.onclick=()=>{Ae.seedOptions.forEach(R=>{let Y=ln(R.key);Y.enabled=!0,Ae.setAutoHarvestEnabledForSeed?.(R.key,!0)}),J(),U&&B(U)};let a=document.createElement("button");qn(a,"Disable all"),a.onclick=()=>{Ae.seedOptions.forEach(R=>{let Y=ln(R.key);Y.enabled=!1,Ae.setAutoHarvestEnabledForSeed?.(R.key,!1)}),J(),U&&B(U)},s.append(i,a);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.gap="10px",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=e.label("\u2014");d.style.fontWeight="700",d.style.fontSize="14px";let u=e.switch(!1);u.title="Enable auto-harvest for this seed",c.append(d,u);let p=document.createElement("div");p.style.border="1px solid #4445",p.style.borderRadius="10px",p.style.padding="12px",p.style.display="flex",p.style.flexDirection="column",p.style.gap="12px",p.style.alignItems="center",p.style.overflow="auto",p.style.minHeight="0";let f=(R,Y)=>{let re=document.createElement("div");re.style.display="grid",re.style.justifyItems="center",re.style.gap="8px",re.style.textAlign="center",re.style.border="1px solid #4446",re.style.borderRadius="10px",re.style.padding="10px",re.style.background="#1f2328",re.style.boxShadow="0 0 0 1px #0002 inset",re.style.width="min(720px, 100%)";let I=document.createElement("div");return I.textContent=R,I.style.fontWeight="600",I.style.opacity="0.95",re.append(I,Y),re},h=()=>{let R=document.createElement("div");return R.style.display="flex",R.style.flexWrap="wrap",R.style.justifyContent="center",R.style.alignItems="center",R.style.gap="8px",R},m=h(),g=e.slider(50,100,1,50);g.style.width="240px";let y=e.label("50%");m.append(g,y),g.addEventListener("input",()=>{y.textContent=`${g.value}%`});let v=h(),w=e.label("Harvest only if stock <"),x=e.inputNumber(0,91,1,91);x.style.width="72px",x.style.textAlign="center";let E=e.label("(stock: \u2014)");E.style.opacity="0.85",v.append(w,x.wrap??x,E);let L=h(),P=rt("Normal"),V=rt("Gold"),z=rt("Rainbow");L.append(P.wrap,V.wrap,z.wrap);let C=h(),D=rt("Wet"),S=rt("Chilled"),G=rt("Frozen"),se=rt("Dawnlit"),X=rt("Amberglow");C.append(D.wrap,S.wrap,G.wrap,se.wrap,X.wrap);let ue=h(),N=F("weather-mode","ANY","Any (OR)"),ee=F("weather-mode","ALL","All (AND)"),q=F("weather-mode","RECIPES","Recipes (AND within, OR across)");ue.append(N.wrap,ee.wrap,q.wrap);let A=document.createElement("div");A.style.display="grid",A.style.gap="8px",A.style.justifyItems="center",A.style.width="min(720px, 100%)";let te=h(),ne=document.createElement("div");ne.textContent="Recipes (OR between rows)",ne.style.fontWeight="600";let Z=document.createElement("button");qn(Z,"+ Recipe"),Z.style.maxWidth="140px",te.append(ne,Z);let me=document.createElement("div");me.style.display="grid",me.style.gap="8px",me.style.justifyItems="stretch",A.append(te,me);function Q(R,Y){let re=document.createElement("div");re.style.display="flex",re.style.flexWrap="wrap",re.style.justifyContent="center",re.style.alignItems="center",re.style.gap="8px",re.style.border="1px solid #4446",re.style.borderRadius="10px",re.style.padding="8px",re.style.background="#0f1318",re.style.boxShadow="0 0 0 1px #0002 inset";let I=rt("Wet"),j=rt("Chilled"),de=rt("Frozen"),ie=rt("Dawnlit"),ge=rt("Amberglow");[I,j,de,ie,ge].forEach(({input:ve,key:le,wrap:H})=>{ft(ve,Y.has(le)),ve.addEventListener("change",()=>{ve.checked?Y.add(le):Y.delete(le),k()}),re.append(H)});let be=document.createElement("button");return qn(be,"\xD7"),be.style.width="36px",be.onclick=()=>{ln(U).weatherRecipes.splice(R,1),W(),k()},re.append(be),re}let oe=(R,Y,re)=>{let I=parseInt(R||String(Y),10);return Math.max(Y,Math.min(re,Number.isFinite(I)?I:Y))};function W(){me.innerHTML="";let R=U?ln(U):null;R&&R.weatherRecipes.forEach((Y,re)=>me.appendChild(Q(re,Y)))}Z.onclick=()=>{ln(U).weatherRecipes.push(new Set),W(),k()},p.append(f("Minimum size",m),f("Inventory buffer",v),f("Color mutations",L),f("Weather mutations",C),f("Weather match mode",ue),f("Recipes",A)),l.append(c,p),n.append(r,l);let U=null;function J(){o.innerHTML="",Ae.seedOptions.forEach(R=>{let Y=ln(R.key),re=document.createElement("button");re.className="qmm-vtab",re.style.background=R.key===U?"#2b8a3e":"#1f2328",re.style.gridTemplateColumns="16px 1fr auto";let I=document.createElement("span");I.className="qmm-dot";let j=Ae.getAutoHarvestEnabledForSeed?.(R.key)??ln(R.key).enabled;I.style.background=j?"#2ecc71":"#7779";let de=document.createElement("span");de.className="label",de.textContent=R.cropName||R.key;let ie=document.createElement("span");ie.textContent=Ae.getEmojiFor?.(R.seedName||R.key)||"\u{1F331}",re.append(I,de,ie),re.onclick=()=>{U=R.key,B(R.key),J()},o.appendChild(re)})}function B(R){let Y=ln(R);u.checked=Ae.getAutoHarvestEnabledForSeed?.(R)??Y.enabled,d.textContent=`Settings \u2014 ${R}`,u.checked=Y.enabled,g.value=String(Y.minScalePct),g.dispatchEvent(new Event("input")),x.value=String(Math.max(0,Math.min(91,Y.minInventory??91))),ft(P.input,Y.visualIncludeNormal),ft(V.input,Y.visualMutations.has("Gold")),ft(z.input,Y.visualMutations.has("Rainbow")),ft(D.input,Y.weatherSelected.has("Wet")),ft(S.input,Y.weatherSelected.has("Chilled")),ft(G.input,Y.weatherSelected.has("Frozen")),ft(se.input,Y.weatherSelected.has("Dawnlit")),ft(X.input,Y.weatherSelected.has("Amberglow")),N.input.checked=Y.weatherMode==="ANY",ee.input.checked=Y.weatherMode==="ALL",q.input.checked=Y.weatherMode==="RECIPES",A.style.display=Y.weatherMode==="RECIPES"?"":"none",W(),M()}let O=[];function b(R){return R?O.reduce((Y,re)=>{let I=Ae.seedKeyFromSpecies?.(re?.species||"");return Y+(I===R?1:0)},0):0}function M(){if(!U){E.textContent="(stock: \u2014)";return}E.textContent=`(stock: ${b(U)})`}let _=null;Se.onCropInventoryChangeNow?.(R=>{O=Array.isArray(R)?R:[],M()}).then(R=>{_=R}).catch(()=>{});function k(){if(!U)return;let R=ln(U);R.enabled=!!u.checked,R.minScalePct=parseInt(g.value,10)||50,R.minInventory=oe(x.value,0,999),R.visualIncludeNormal=!!P.input.checked,T(R.visualMutations,[["Gold",V.input],["Rainbow",z.input]]),T(R.weatherSelected,[["Wet",D.input],["Chilled",S.input],["Frozen",G.input],["Dawnlit",se.input],["Amberglow",X.input]]),R.weatherMode=ee.input.checked?"ALL":q.input.checked?"RECIPES":"ANY",Ae.setHarvestRule?.(U,v1(R)),J()}function T(R,Y){R.clear(),Y.forEach(([re,I])=>{I.checked&&R.add(re)})}function F(R,Y,re){let I=document.createElement("label");I.style.display="inline-flex",I.style.alignItems="center",I.style.gap="6px";let j=document.createElement("input");j.type="radio",j.name=R,j.value=Y;let de=document.createElement("span");return de.textContent=re,I.append(j,de),j.addEventListener("change",()=>{A.style.display=Y==="RECIPES"&&j.checked?"":"none",k()}),{wrap:I,input:j,value:Y}}u.addEventListener("change",k),g.addEventListener("change",k),x.addEventListener("input",()=>{x.value=String(oe(x.value,0,999))}),x.addEventListener("change",k),[P.input,V.input,z.input,D.input,S.input,G.input,se.input,X.input].forEach(R=>R.addEventListener("change",k));let $=Ae.subscribe?.(R=>{if(R?.type==="harvest-rule-changed"){if(J(),R.seedKey===U){let Y=R.rule,re=ln(R.seedKey);re.minInventory=Math.max(0,Math.min(91,parseInt(x.value||"91",10))),B(U)}}else R?.type==="harvest-rules-replaced"&&(J(),U&&B(U))});t.__unsubHarvest=()=>{if($?.(),_)try{_()}catch{}},x.addEventListener("input",()=>{x.value=String(Math.max(0,Math.min(91,parseInt(x.value||"91",10))))});let K=Ae.seedOptions[0]?.key||null;K&&(U=K),J(),U&&B(U)}var Md=new Map;function no(t){let e=Md.get(t);if(!e){e={enabled:!1,keepMin:0,minSizePct:50,keepVisual:new Set,keepWeather:new Set,minPlayers:1};let n=Ae.getAutoSellRule?.(t);n&&(e.enabled=!!n.enabled,e.keepMin=n.keepMin??0,e.minSizePct=n.minSizePct??50,e.keepVisual=new Set(n.keepVisual??[]),e.keepWeather=new Set(n.keepWeather??[]),e.minPlayers=typeof n.minPlayers=="number"?n.minPlayers:1),Md.set(t,e)}return e}function Ad(t){return{enabled:t.enabled,keepMin:t.keepMin,minSizePct:t.minSizePct,keepVisual:[...t.keepVisual],keepWeather:[...t.keepWeather],minPlayers:t.minPlayers}}async function S1(t,e){t.innerHTML="",t.__unsubAutoSell?.();let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateRows="1fr auto",r.style.gap="8px",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="1fr",o.style.rowGap="6px",o.style.overflow="auto",o.style.paddingRight="2px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.padding="6px",r.appendChild(o);let s=document.createElement("div");s.style.display="flex",s.style.gap="6px",r.appendChild(s);let i=document.createElement("button");qn(i,"Enable all"),i.onclick=()=>{Ae.seedOptions.forEach(J=>{let B=no(J.key),O={...Ad(B),enabled:!0};Ae.setAutoSellRule?.(J.key,O),B.enabled=!0}),ne(),te&&Z(te)};let a=document.createElement("button");qn(a,"Disable all"),a.onclick=()=>{Ae.seedOptions.forEach(J=>{let B=no(J.key),O={...Ad(B),enabled:!1};Ae.setAutoSellRule?.(J.key,O),B.enabled=!1}),ne(),te&&Z(te)},s.append(i,a);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.gap="10px",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="flex",c.style.alignItems="center",c.style.gap="10px";let d=e.label("\u2014");d.style.fontWeight="700",d.style.fontSize="14px";let u=e.switch(!1);u.title="Enable auto-sell for this crop",c.append(d,u);let p=document.createElement("div");p.style.border="1px solid #4445",p.style.borderRadius="10px",p.style.padding="12px",p.style.display="flex",p.style.flexDirection="column",p.style.gap="12px",p.style.alignItems="center",p.style.overflow="auto",p.style.minHeight="0";let f=(J,B)=>{let O=document.createElement("div");O.style.display="grid",O.style.justifyItems="center",O.style.gap="8px",O.style.textAlign="center",O.style.border="1px solid #4446",O.style.borderRadius="10px",O.style.padding="10px",O.style.background="#1f2328",O.style.boxShadow="0 0 0 1px #0002 inset",O.style.width="min(720px, 100%)";let b=document.createElement("div");return b.textContent=J,b.style.fontWeight="600",b.style.opacity="0.95",O.append(b,B),O},h=()=>{let J=document.createElement("div");return J.style.display="flex",J.style.flexWrap="wrap",J.style.justifyContent="center",J.style.alignItems="center",J.style.gap="8px",J},m=h(),g=e.label("Sell only if players \u2265"),y=e.inputNumber(1,6,1,1);y.style.width="64px",y.style.textAlign="center";let v=e.label("(now: "+await Se.getNumPlayers()+")");v.style.opacity="0.85",m.append(g,y.wrap,v);let w=h(),x=e.label("Keep at least"),E=e.inputNumber(0,91,1,0);E.style.width="72px",E.style.textAlign="center";let L=e.label("items");w.append(x,E.wrap??E,L);let P=h(),V=e.slider(50,100,1,50);V.style.width="240px";let z=e.label("50%");P.append(V,z),V.addEventListener("input",()=>{z.textContent=`${V.value}%`});let C=h(),D=rt("Normal"),S=rt("Gold"),G=rt("Rainbow");C.append(D.wrap,S.wrap,G.wrap);let se=h(),X=rt("Wet"),ue=rt("Chilled"),N=rt("Frozen"),ee=rt("Dawnlit"),q=rt("Amberglow");se.append(X.wrap,ue.wrap,N.wrap,ee.wrap,q.wrap);let A=e.label("Favorites are never sold. Per-crop rules let you keep stock for pets.");A.style.opacity="0.9",A.style.fontSize="12px",p.append(f("Sell condition",m),f("Inventory buffer",w),f("Minimum size",P),f("Keep color mutations (never sell)",C),f("Keep weather mutations (never sell)",se),A),l.append(c,p),n.append(r,l);let te=null;function ne(){o.innerHTML="",Ae.seedOptions.forEach(J=>{let B=Ae.getAutoSellEnabledForSeed?.(J.key)??no(J.key).enabled,O=document.createElement("button");O.className="qmm-vtab",O.style.background=J.key===te?"#2b8a3e":"#1f2328",O.style.gridTemplateColumns="16px 1fr auto";let b=document.createElement("span");b.className="qmm-dot",b.style.background=B?"#2ecc71":"#7779";let M=document.createElement("span");M.className="label",M.textContent=J.cropName||J.key;let _=document.createElement("span");_.textContent=Ae.getEmojiFor?.(J.seedName||J.key)||"\u{1F331}",O.append(b,M,_),O.onclick=()=>{te=J.key,Z(J.key),ne()},o.appendChild(O)})}function Z(J){let B=no(J);d.textContent=`Auto-sell \u2014 ${J}`,u.checked=Ae.getAutoSellEnabledForSeed?.(J)??B.enabled,y.value=String(Math.max(1,Math.min(6,B.minPlayers||1))),E.value=String(Math.max(0,Math.min(91,B.keepMin||0))),V.value=String(B.minSizePct||50),V.dispatchEvent(new Event("input")),ft(D.input,B.keepVisual.has("Normal")),ft(S.input,B.keepVisual.has("Gold")),ft(G.input,B.keepVisual.has("Rainbow")),ft(X.input,B.keepWeather.has("Wet")),ft(ue.input,B.keepWeather.has("Chilled")),ft(N.input,B.keepWeather.has("Frozen")),ft(ee.input,B.keepWeather.has("Dawnlit")),ft(q.input,B.keepWeather.has("Amberglow"))}function me(){if(!te)return;let J=no(te);J.enabled=!!u.checked,J.minPlayers=Q(y.value,1,6),J.keepMin=Q(E.value,0,91),J.minSizePct=Q(V.value,50,100),J.keepVisual.clear(),D.input.checked&&J.keepVisual.add("Normal"),S.input.checked&&J.keepVisual.add("Gold"),G.input.checked&&J.keepVisual.add("Rainbow"),J.keepWeather.clear(),X.input.checked&&J.keepWeather.add("Wet"),ue.input.checked&&J.keepWeather.add("Chilled"),N.input.checked&&J.keepWeather.add("Frozen"),ee.input.checked&&J.keepWeather.add("Dawnlit"),q.input.checked&&J.keepWeather.add("Amberglow"),Ae.setAutoSellRule?.(te,Ad(J)),ne()}function Q(J,B,O){let b=parseInt(J||String(B),10);return Math.max(B,Math.min(O,Number.isFinite(b)?b:B))}u.addEventListener("change",me),y.addEventListener("input",()=>{y.value=String(Math.max(1,Math.min(6,parseInt(y.value||"1",10))))}),y.addEventListener("change",me),E.addEventListener("input",()=>{E.value=String(Q(E.value,0,91))}),E.addEventListener("change",me),V.addEventListener("change",me);let oe=Ae.subscribe?.(J=>{if(J?.type==="auto-sell-rule-changed"){let B=J.rule,O=no(J.seedKey);O.enabled=!!B.enabled,O.keepMin=B.keepMin,O.minSizePct=B.minSizePct,O.keepVisual=new Set(B.keepVisual??[]),O.keepWeather=new Set(B.keepWeather??[]),O.minPlayers=B.minPlayers,ne(),te===J.seedKey&&Z(te)}else J?.type==="auto-sell-rules-replaced"&&(Md.clear(),ne(),te&&Z(te))});[D.input,S.input,G.input,X.input,ue.input,N.input,ee.input,q.input].forEach(J=>J.addEventListener("change",me));let W=null;typeof Se.onNumPlayersNow=="function"&&Se.onNumPlayersNow(J=>{v.textContent=`(now: ${J})`}).then(J=>{W=J}).catch(()=>{}),t.__unsubAutoSell=()=>{if(oe?.(),W)try{W()}catch{}};let U=Ae.seedOptions[0]?.key||null;U&&(te=U),ne(),te&&Z(te)}async function ch(t){let e=new Ye({id:"garden",compact:!0});e.mount(t),e.addTabs([{id:"auto-plant",title:"Auto plant",render:n=>b1(n,e)},{id:"auto-harvest",title:"Auto harvest",render:n=>w1(n,e)},{id:"auto-sell",title:"Auto sell",render:n=>S1(n,e)}])}function dh(t){for(let e of t){let n=document.querySelector(`div[data-slot="${e}"]`);if(!n)continue;let r=n.style.background;n.style.outline="2px solid #88f",setTimeout(()=>{n.style.outline="",n.style.background=r},350)}}var Sa="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yWIx4QmQjniP/DFmXUHhpXgYKiwj0jItaDYoKCJwwYeA8MCCDGJuOoIQJFQEHjhJiW1NwKgKQTnbpNVZyKIIqeEtci87LqvPjrDXFvdx/v/r9eT//////////8X/O/34YjQv//nbVV62e+zRaNdv5k3Nlkv54MsiVZJ2XPNImgx6LJVuEpwRk5xtEkjOFydK6U44SZKtPgOpWFyUrA5KVwmCTAGQasapCi+pBXrShYhskHhSRHScOBoQjCMWFSqaA+hRJoD6EhSXc0qk25kNUMSzoQpY4x2EatYayUjWUjakatczs/X6ssMtcmvSZausPNb1Z7MvsZNtBRrR1vBf8Fl4/xpo2gYAPVqmZh3Zqv0o3AwpxomhWHeCsQjJYtDR7Oz09UeaGmZLiY9UBT1bvBXDXLaLg7lpUq79eJRnBoGZcjQTIU2QmlCpBRpZLpk6gKKER4ApYROtLHiXKhLWJYoV9Wv/+5RE9I8C3GLBgyFE8lsMeDBkI54KgY8CDATVwgApIWj0jpl1oLeWDtoUPes6hly6zueDsS8io9hriUNB3GPDCgoloBCgoCpRstUAnAQHUSTcAmVGcv2VV/9aWqqu212q5xjVZI4mG8LIwk8L0T/zXdc6WGAln0Kv8/jUBpZGq6nVUmNf89VL2oCVJjqk2qiS//YwrDQXEBQxI1VUaWqnglaJ0ZnIUsbjOFEozLLDhrJUFUmZpqv9Vv9mjF7HV2XZv9s/2Paeaw1JVh3NZ3alqp89m2L6vxi1jBjFS8S7FguQVjiwFeb/8O/5ZkxBTUUzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr/+5Rk3QDBygs8yCEYED0hV4IEJgwLEY7GIYR+QVyl2chTDDGqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqo=";function xa(t){return Math.max(0,Math.min(1,t))}function ys(t){return/^data:audio\/[a-z0-9.+-]+;base64,/i.test(t.trim())}function ur(t,e="audio/mpeg"){let n=(t||"").trim();return n?ys(n)?n:`data:${e};base64,${n}`:""}var uh="qws:alerts:audio:settings:v1",ph="qws:alerts:audio:library:v1",Pd=class{constructor(e){ce(this,"enabled",!0);ce(this,"volume",.7);ce(this,"minPlayGapMs",1200);ce(this,"lastPlayTs",0);ce(this,"library",new Map);ce(this,"defaultSoundName",null);ce(this,"defaultSoundDataUrl",null);ce(this,"mode","oneshot");ce(this,"stopConf",{mode:"manual"});ce(this,"loopIntervalMs",1500);ce(this,"weatherMode","oneshot");ce(this,"weatherStopConf",{mode:"manual"});ce(this,"weatherLoopIntervalMs",1500);ce(this,"loops",new Map);ce(this,"oneshotQueue",[]);ce(this,"oneshotQueueTimer",null);ce(this,"oneshotProcessing",!1);ce(this,"weatherVolume",.7);ce(this,"weatherDefaultSoundName",null);ce(this,"purchaseChecker");ce(this,"audioCtx",null);ce(this,"primed",!1);ce(this,"builtinDefault",null);ce(this,"suppressPersist",0);e?.minPlayGapMs!=null&&(this.minPlayGapMs=Math.max(0,e.minPlayGapMs|0)),e?.volume!=null&&(this.volume=xa(e.volume)),this.suppressPersist++;try{if(Sa&&Sa.trim()&&Sa.indexOf("TODO:")===-1){let n=ur(Sa);this.registerSound("Default",n),this.defaultSoundName="Default",this.builtinDefault={name:"Default",dataUrl:n}}if(e?.defaultSound){let n=ur(e.defaultSound);this.defaultSoundDataUrl=n,this.registerSound("LegacyDefault",n),this.defaultSoundName="LegacyDefault"}}finally{this.suppressPersist--}this.loadFromStorage(),this.ensureBuiltinPresent(),this.ensureDefaultSoundValidity()&&this.persistSettings()}ensureBuiltinPresent(){this.builtinDefault&&!this.library.has(this.builtinDefault.name)&&this.library.set(this.builtinDefault.name,this.builtinDefault.dataUrl)}ensureDefaultSoundValidity(){let e=!1,n=()=>{if(this.builtinDefault&&this.library.has(this.builtinDefault.name))return this.builtinDefault.name;let i=this.library.keys().next();return i.done?null:i.value},r=(i,a)=>i&&this.library.has(i)?i:a&&this.library.has(a)?a:n(),o=r(this.defaultSoundName);o!==this.defaultSoundName&&(this.defaultSoundName=o,e=!0);let s=r(this.weatherDefaultSoundName,o);return s!==this.weatherDefaultSoundName&&(this.weatherDefaultSoundName=s,e=!0),e}persistSettings(){if(!(this.suppressPersist>0))try{let e={enabled:this.enabled,volume:this.volume,minPlayGapMs:this.minPlayGapMs,mode:this.mode,stop:this.stopConf,loopIntervalMs:this.loopIntervalMs,defaultSoundName:this.defaultSoundName,contexts:{shops:{volume:this.volume,mode:this.mode,stop:this.stopConf,loopIntervalMs:this.loopIntervalMs,defaultSoundName:this.defaultSoundName},weather:{volume:this.weatherVolume,mode:this.weatherMode,stop:this.weatherStopConf,loopIntervalMs:this.weatherLoopIntervalMs,defaultSoundName:this.weatherDefaultSoundName}}};localStorage.setItem(uh,JSON.stringify(e))}catch{}}persistLibrary(){if(!(this.suppressPersist>0))try{let e=[];for(let[n,r]of this.library.entries())this.builtinDefault&&n===this.builtinDefault.name||e.push({name:n,data:r});localStorage.setItem(ph,JSON.stringify(e))}catch{}}loadFromStorage(){this.suppressPersist++;try{try{let e=localStorage.getItem(ph);if(e){let n=JSON.parse(e);if(Array.isArray(n)){this.library.clear(),this.ensureBuiltinPresent();for(let r of n){let o=String(r&&r.name||"").trim(),s=String(r&&r.data||"").trim();!o||!s||this.builtinDefault&&o===this.builtinDefault.name||this.library.set(o,ys(s)?s:ur(s))}}}}catch{}try{let e=localStorage.getItem(uh);if(e){let n=JSON.parse(e);if(n&&typeof n=="object"){if(typeof n.enabled=="boolean"&&(this.enabled=n.enabled),typeof n.minPlayGapMs=="number"&&(this.minPlayGapMs=Math.max(0,n.minPlayGapMs|0)),typeof n.volume=="number"&&(this.volume=xa(n.volume)),(n.mode==="loop"||n.mode==="oneshot")&&(this.mode=n.mode),n.stop&&typeof n.stop=="object"){let c=n.stop.mode;c==="purchase"?this.stopConf={mode:"purchase"}:c==="manual"?this.stopConf={mode:"manual"}:c==="repeat"&&(this.stopConf={mode:"manual"})}if(typeof n.loopIntervalMs=="number"&&(this.loopIntervalMs=Math.max(150,n.loopIntervalMs|0)),typeof n.defaultSoundName=="string"){let c=n.defaultSoundName.trim();this.defaultSoundName=c||null}let r=!1,o=!1,s=!1,i=!1,a=!1,l=(c,d)=>{if(!d||typeof d!="object")return;let u=g=>{if(typeof g!="number")return;let y=xa(g);c==="weather"?(this.weatherVolume=y,r=!0):this.volume=y},p=g=>{(g==="loop"||g==="oneshot")&&(c==="weather"?(this.weatherMode=g,o=!0):this.mode=g)},f=g=>{if(!g||typeof g!="object")return;let y=g.mode;y==="purchase"?c==="weather"?(this.weatherStopConf={mode:"purchase"},s=!0):this.stopConf={mode:"purchase"}:y==="manual"?c==="weather"?(this.weatherStopConf={mode:"manual"},s=!0):this.stopConf={mode:"manual"}:y==="repeat"&&(c==="weather"?(this.weatherStopConf={mode:"manual"},s=!0):this.stopConf={mode:"manual"})},h=g=>{if(typeof g!="number"||!Number.isFinite(g))return;let y=Math.max(150,Math.floor(g));c==="weather"?(this.weatherLoopIntervalMs=y,i=!0):this.loopIntervalMs=y},m=g=>{if(typeof g!="string")return;let y=g.trim();c==="weather"?(this.weatherDefaultSoundName=y||null,a=!0):this.defaultSoundName=y||null};u(d.volume),p(d.mode),f(d.stop),h(d.loopIntervalMs),m(d.defaultSoundName)};n.contexts&&typeof n.contexts=="object"&&(l("shops",n.contexts.shops),l("weather",n.contexts.weather)),r||(this.weatherVolume=this.volume),o||(this.weatherMode=this.mode),s||(this.weatherStopConf=this.stopConf.mode==="purchase"?{mode:"purchase"}:{mode:"manual"}),i||(this.weatherLoopIntervalMs=this.loopIntervalMs),a||(this.weatherDefaultSoundName=this.defaultSoundName)}}}catch{}}finally{this.suppressPersist--}}isProtectedSound(e){return!!(this.builtinDefault&&this.builtinDefault.name===e)}registerSound(e,n,r){let o=String(e||"").trim();if(!o)return;let s=ur(n,r||"audio/mpeg");this.library.set(o,s);let i=this.defaultSoundName,a=this.weatherDefaultSoundName;this.defaultSoundName||(this.defaultSoundName=o),this.weatherDefaultSoundName||(this.weatherDefaultSoundName=o),this.ensureBuiltinPresent(),this.persistLibrary(),(i!==this.defaultSoundName||a!==this.weatherDefaultSoundName)&&this.persistSettings()}unregisterSound(e){if(this.isProtectedSound(e)||!this.library.delete(e))return;let r=this.defaultSoundName,o=this.weatherDefaultSoundName;r===e&&(this.defaultSoundName=null),o===e&&(this.weatherDefaultSoundName=null);let s=r===e||o===e||this.ensureDefaultSoundValidity();this.persistLibrary(),s&&this.persistSettings()}listSounds(){return Array.from(this.library.keys())}setDefaultSoundByName(e,n="shops"){if(this.library.has(e)){if(n==="weather"){if(this.weatherDefaultSoundName===e)return;this.weatherDefaultSoundName=e}else{if(this.defaultSoundName===e)return;this.defaultSoundName=e}this.persistSettings()}}resetLibrary(e){let n=this.defaultSoundName,r=this.weatherDefaultSoundName;this.suppressPersist++;try{this.library.clear(),this.ensureBuiltinPresent();let s=[];for(let i of e){let a=String(i?.name||"").trim();if(!a||this.isProtectedSound(a))continue;let l=ys(i.data)?i.data:ur(i.data);this.library.set(a,l),s.push(a)}s.length&&(this.defaultSoundName=s[0],this.weatherDefaultSoundName=s[0])}finally{this.suppressPersist--}let o=this.ensureDefaultSoundValidity()||n!==this.defaultSoundName||r!==this.weatherDefaultSoundName;this.persistLibrary(),o&&this.persistSettings()}setNotificationBase64(e){let n=e&&e.trim()?ys(e)?e:ur(e):"";this.defaultSoundDataUrl=n||null,n&&(this.registerSound("LegacyDefault",n),this.defaultSoundName="LegacyDefault",this.weatherDefaultSoundName="LegacyDefault"),this.persistSettings()}getDefaultSoundName(e="shops"){return e==="weather"?this.weatherDefaultSoundName??this.defaultSoundName:this.defaultSoundName}resolveToDataUrl(e,n){if(!e){let o=n==="weather"?this.weatherDefaultSoundName??this.defaultSoundName:this.defaultSoundName;return o&&this.library.has(o)?this.library.get(o):this.defaultSoundDataUrl||null}let r=e.trim();return this.library.has(r)?this.library.get(r):ys(r)?r:/^[A-Za-z0-9+/=\s]+$/.test(r)&&r.length>100?ur(r):null}setEnabled(e){let n=!!e;this.enabled!==n&&(this.enabled=n,this.persistSettings())}isEnabled(){return this.enabled}setMute(e){this.setEnabled(!e)}isMuted(){return!this.enabled}setVolume(e,n="shops"){let r=xa(e);if(n==="weather"){if(this.weatherVolume===r)return;this.weatherVolume=r}else{if(this.volume===r)return;this.volume=r}this.forEachLoop(n,o=>{o.volume=r}),this.persistSettings()}getVolume(e="shops"){return e==="weather"?this.weatherVolume:this.volume}setMinPlayGap(e){let n=Math.max(0,e|0);this.minPlayGapMs!==n&&(this.minPlayGapMs=n,this.persistSettings())}getMinPlayGap(){return this.minPlayGapMs}setPlaybackMode(e,n="shops"){if(n==="weather"){if(this.weatherMode===e)return;this.weatherMode=e}else{if(this.mode===e)return;this.mode=e}this.persistSettings()}getPlaybackMode(e="shops"){return e==="weather"?this.weatherMode:this.mode}setStopRepeat(e,n="shops"){this.setStopManual(n)}setStopManual(e="shops"){if(e==="weather"){if(this.weatherStopConf.mode==="manual")return;this.weatherStopConf={mode:"manual"}}else{if(this.stopConf.mode==="manual")return;this.stopConf={mode:"manual"}}this.forEachLoop(e,n=>{n.baseStop={mode:"manual"}}),this.persistSettings()}setStopPurchase(e="shops"){if(e==="weather"){if(this.weatherStopConf.mode==="purchase")return;this.weatherStopConf={mode:"purchase"}}else{if(this.stopConf.mode==="purchase")return;this.stopConf={mode:"purchase"}}this.forEachLoop(e,n=>{n.baseStop={mode:"purchase"}}),this.persistSettings()}clearStopCondition(e="shops"){this.setStopManual(e)}setLoopInterval(e,n="shops"){let r=Math.max(150,e|0);if(n==="weather"){if(this.weatherLoopIntervalMs===r)return;this.weatherLoopIntervalMs=r}else{if(this.loopIntervalMs===r)return;this.loopIntervalMs=r}this.forEachLoop(n,o=>{o.baseLoopInterval=r}),this.persistSettings()}getLoopInterval(e="shops"){return e==="weather"?this.weatherLoopIntervalMs:this.loopIntervalMs}setPurchaseChecker(e){this.purchaseChecker=e}getPlaybackSettings(e="shops"){let n=this.getVolume(e),r=this.getPlaybackMode(e),s=(e==="weather"?this.weatherStopConf:this.stopConf).mode==="purchase"?{mode:"purchase"}:{mode:"manual"},i=this.getLoopInterval(e),a=this.getDefaultSoundName(e);return{enabled:this.enabled,volume:n,minPlayGapMs:this.minPlayGapMs,mode:r,stop:s,loopIntervalMs:i,primed:this.primed,defaultSoundName:a,hasLegacyDefault:!!this.defaultSoundDataUrl,librarySize:this.library.size,libraryNames:this.listSounds()}}async notify(e="shops"){let n=this.resolveToDataUrl(null,e);await this.playOnce(n,this.getVolume(e),e)}async playNotify(e="shops"){await this.notify(e)}async trigger(e="global",n={},r="shops"){let o=g=>{if(typeof g!="string")return;let y=g.trim();return y||void 0},s=g=>g?g.mode==="purchase"?{mode:"purchase"}:g.mode==="manual"?{mode:"manual"}:g.mode==="repeat"?{mode:"manual"}:{mode:"manual"}:null,i=o(n.sound??null),a=this.getPlaybackMode(r),l=n.mode==="oneshot"||n.mode==="loop"?n.mode:a,d=(r==="weather"?this.weatherStopConf:this.stopConf).mode==="purchase"?{mode:"purchase"}:{mode:"manual"},u=this.getLoopInterval(r),p=this.getVolume(r);if(l==="oneshot"){this.stopLoop(e);let g=this.resolveToDataUrl(i??null,r);this.enqueueOneshot({key:e,dataUrl:g,volume:p,context:r});return}this.stopLoop(e);let f=s(n.stop??null),h=n.loopIntervalMs!=null&&Number.isFinite(n.loopIntervalMs)?Math.max(150,Math.round(n.loopIntervalMs)):null,m={key:e,timer:null,plays:0,soundOverride:i,stopped:!1,stopOverride:f,loopIntervalOverride:h,context:r,baseStop:d,baseLoopInterval:u,volume:p};this.loops.set(e,m),this.scheduleNext(m,0)}forEachLoop(e,n){for(let r of this.loops.values())r.context===e&&n(r)}stopLoop(e="global"){let n=this.loops.get(e);n&&(n.stopped=!0,n.timer!=null&&(clearTimeout(n.timer),n.timer=null),this.loops.delete(e))}stopAllLoops(e){if(e){for(let[n,r]of this.loops)r.context===e&&this.stopLoop(n);return}for(let[n]of this.loops)this.stopLoop(n)}async prime(){try{this.audioCtx||(this.audioCtx=new(window.AudioContext||window.webkitAudioContext)),this.audioCtx.state==="suspended"&&await this.audioCtx.resume();let e=this.audioCtx.createOscillator(),n=this.audioCtx.createGain();n.gain.value=1e-4,e.connect(n).connect(this.audioCtx.destination),e.start(),e.stop(this.audioCtx.currentTime+.02),this.primed=!0}catch{this.primed=!0}}async importFileAsSound(e,n={}){let{name:r,maxBytes:o=200*1024,maxSeconds:s=10,bitrates:i=[48e3,32e3,2e4,12e3,8e3],maxInputBytes:a=8*1024*1024}=n,l=y=>{try{we("Audio import",y,"error").catch(()=>{})}catch{}},c=null,d=async()=>(c||(c=await this.decodeFileToBuffer(e)),c);if(!e||!(e instanceof File))throw new Error("No file provided.");let u=new Map([["mp3",new Set(["audio/mpeg","audio/mp3"])],["wav",new Set(["audio/wav","audio/x-wav","audio/wave"])],["ogg",new Set(["audio/ogg"])]]),p=(e.type||"").toLowerCase(),f=(e.name?.split(".").pop()||"").toLowerCase();if(!f||!u.has(f))throw l("Unsupported audio format. Allowed formats: MP3, WAV, OGG."),new Error(`Unsupported audio extension: ${f||"unknown"}`);let h=u.get(f);if(!p||!h.has(p))throw l("File extension and MIME type must match (MP3, WAV, OGG only)."),new Error(p?`MIME type ${p} is not valid for .${f} files.`:`Missing MIME type for .${f} files.`);if(e.size>a)throw new Error(`Input file too large (${Math.round(e.size/1024)}KB). Limit is ${Math.round(a/1024)}KB.`);if(e.size<=o){let y=await d();if(y.duration>s){let x=y.duration,E=s.toFixed(1).replace(/\.0$/,""),L=x.toFixed(1).replace(/\.0$/,"");throw l(`File duration is ${L}s (limit: ${E}s).`),new Error(`Audio duration ${L}s exceeds limit of ${E}s.`)}let v=await this.blobToDataURL(e),w=this.uniqueName(r||e.name);return this.registerSound(w,v),{name:w,dataUrl:v,bytes:e.size,wasCompressed:!1}}let m=this.chooseAudioMime();if(!(!!m&&typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(m)))throw new Error("Compression unavailable in this browser; file exceeds 200KB.");if(c=await d(),c.duration>s){let y=c.duration,v=s.toFixed(1).replace(/\.0$/,""),w=y.toFixed(1).replace(/\.0$/,"");throw l(`File duration is ${w}s (limit: ${v}s).`),new Error(`Audio duration ${w}s exceeds limit of ${v}s.`)}for(let y of i){let v=await this.recordBufferToBlob(c,m,y);if(v.size<=o){let w=await this.blobToDataURL(v),x=this.uniqueName(r||e.name);return this.registerSound(x,w),{name:x,dataUrl:w,bytes:v.size,wasCompressed:!0}}}throw l(`Unable to compress under ${Math.round(o/1024)}KB. Try a shorter clip.`),new Error(`Could not compress under ${Math.round(o/1024)}KB. Try a shorter clip.`)}async playOnce(e,n,r,o={}){if(!this.enabled)return!0;let s=Date.now();if(s-this.lastPlayTs<this.minPlayGapMs)return!1;if(this.lastPlayTs=s,!e){if(this.primed&&this.audioCtx)try{let i=this.audioCtx.createOscillator(),a=this.audioCtx.createGain();a.gain.value=n*.1,i.frequency.value=880,i.connect(a).connect(this.audioCtx.destination),i.start(),i.stop(this.audioCtx.currentTime+.06)}catch{}return!0}try{let i=new Audio;i.src=e,i.volume=n,i.muted=!this.enabled,i.crossOrigin="anonymous";let a=o?.awaitEnd===!0,l=null,c=null;a&&(l=new Promise(u=>{let p=()=>{i.removeEventListener("ended",p),i.removeEventListener("error",p),u()};c=p,i.addEventListener("ended",p),i.addEventListener("error",p)}));let d=i.play();d&&typeof d.then=="function"&&await d.catch(()=>{c?.()}),l&&await l}catch{}return!0}scheduleNext(e,n){let r=async()=>{if(e.stopped)return;let o=e.stopOverride??e.baseStop;if(o.mode==="purchase"&&this.purchaseChecker)try{if(this.purchaseChecker(e.key)){this.stopLoop(e.key);return}}catch{}let s=this.resolveToDataUrl(e.soundOverride,e.context);if(await this.playOnce(s,e.volume,e.context,{awaitEnd:!0})&&e.plays++,o.mode==="repeat"){let c=Math.max(1,o.repeats|0);if(e.plays>=c){this.stopLoop(e.key);return}}let a=e.loopIntervalOverride??e.baseLoopInterval,l=Math.max(150,a|0);e.timer=setTimeout(()=>this.scheduleNext(e,0),l)};n>0?e.timer=setTimeout(r,n):r().catch(()=>{})}enqueueOneshot(e){if(e.context==="weather"){let n=this.oneshotQueue.findIndex(r=>r.context!=="weather");n===-1?this.oneshotQueue.push(e):this.oneshotQueue.splice(n,0,e)}else this.oneshotQueue.push(e);this.scheduleOneshotProcessing()}scheduleOneshotProcessing(){if(!this.oneshotQueue.length||this.oneshotQueueTimer!=null)return;let e=Date.now()-this.lastPlayTs,n=Math.max(0,this.minPlayGapMs-e);this.oneshotQueueTimer=window.setTimeout(()=>{this.oneshotQueueTimer=null,!this.oneshotProcessing&&this.processOneshotQueue()},n)}processOneshotQueue(){if(this.oneshotProcessing||!this.oneshotQueue.length)return;let e=this.oneshotQueue.shift();this.oneshotProcessing=!0,(async()=>{let r=!1;try{r=!await this.playOnce(e.dataUrl,e.volume,e.context)}finally{this.oneshotProcessing=!1,r&&this.enqueueOneshot(e),this.scheduleOneshotProcessing()}})().catch(()=>{})}chooseAudioMime(){let e=["audio/webm;codecs=opus","audio/ogg;codecs=opus","audio/webm","audio/ogg","audio/mp4"];for(let n of e)try{if(typeof MediaRecorder<"u"&&MediaRecorder.isTypeSupported?.(n))return n}catch{}return null}uniqueName(e){let n=String(e||"Sound").replace(/\.[a-z0-9]+$/i,"").trim()||"Sound";if(!this.library.has(n))return n;let r=2;for(;this.library.has(`${n} (${r})`);)r++;return`${n} (${r})`}async blobToDataURL(e){return await new Promise((n,r)=>{let o=new FileReader;o.onload=()=>n(String(o.result)),o.onerror=r,o.readAsDataURL(e)})}async decodeFileToBuffer(e){let n=await e.arrayBuffer(),r=window.AudioContext||window.webkitAudioContext,o=new r;try{let s=await new Promise((i,a)=>{o.decodeAudioData(n.slice(0),i,a)});return await o.close().catch(()=>{}),s}catch{try{await o.close()}catch{}throw new Error("Failed to decode audio file.")}}async recordBufferToBlob(e,n,r){let o=window.AudioContext||window.webkitAudioContext,s=new o,i=s.createMediaStreamDestination(),a=s.createBufferSource();a.buffer=e;let l=s.createGain();l.gain.value=.9,a.connect(l).connect(i);let c=[],d=new MediaRecorder(i.stream,{mimeType:n,bitsPerSecond:r}),u=new Promise((f,h)=>{d.ondataavailable=m=>{m.data&&m.data.size&&c.push(m.data)},d.onerror=m=>h(m.error||new Error("MediaRecorder error")),d.onstop=()=>{try{f(new Blob(c,{type:n}))}catch(m){h(m)}}});d.start(),a.start(),await new Promise(f=>{a.onended=()=>f()}),d.stop();let p=await u;try{await s.close()}catch{}return p}},Me=new Pd({minPlayGapMs:1200,volume:.7});var Ca=new WeakMap,Ss=new Map,ws=new Map,bs=new Map,fh=!1,vs=null,mh=(()=>{let t=new Map;for(let[e,n]of Object.entries(Hi??{})){let r=hh(e),o=x1(n);r&&o!=null&&t.set(r,o)}return t})();function hh(t){return(typeof t=="string"?t:String(t??"")).trim().replace(/^Weather:/i,"").replace(/[^a-z0-9]+/gi,"").toLowerCase()}function x1(t){let e=typeof t=="number"?t:Number(t);return Number.isFinite(e)?e>0?Math.trunc(e)-1:Math.trunc(e):null}function gh(t){if(t==null)return null;let e=hh(t);return e&&mh.has(e)?e:null}function E1(){if(vs)return vs;let t=new Set;try{let e=ke?.listTilesByCategory;if(typeof e=="function")for(let n of e(/anim/i)){if(typeof n!="string"||!n.length)continue;let r=n.split(/[?#]/)[0]??n,o=r.split("/").pop()??r;t.add(o.replace(/\.[^.]+$/,""))}}catch{}return t.size===0&&["animations","Animations","animation","Animation"].forEach(e=>t.add(e)),vs=[...t],vs}function C1(t,e,n){let r=Ss.get(t);r||(r=new Set,Ss.set(t,r)),r.add(e),Ca.set(e,n)}function Rd(t,e){let n=Ss.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Ca.delete(r);return}Ea(r,e)}),n.size===0&&Ss.delete(t))}function T1(){fh||typeof window>"u"||(fh=!0,window.addEventListener("mg:sprite-detected",()=>{ws.clear(),bs.clear(),vs=null,Array.from(Ss.keys()).forEach(e=>{yh(e)})}))}function Ea(t,e){let n=Ca.get(t);if(!n)return;let{size:r,fallback:o,alt:s}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",t.setAttribute("role","img"),e){t.removeAttribute("aria-label"),t.style.fontSize="";let i=document.createElement("img");i.src=e,i.alt=s,i.decoding="async",i.loading="lazy",i.draggable=!1,i.style.width="100%",i.style.height="100%",i.style.objectFit="contain",t.appendChild(i)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.72))}px`,s?t.setAttribute("aria-label",s):t.removeAttribute("aria-label")}async function k1(t){let e=mh.get(t);if(e==null)return null;let n=E1();for(let r of n)try{let s=(await ke.getTile(r,e,"canvas"))?.data;if(!s||s.width<=0||s.height<=0)continue;let i=document.createElement("canvas");i.width=s.width,i.height=s.height;let a=i.getContext("2d");if(!a)continue;return a.imageSmoothingEnabled=!1,a.drawImage(s,0,0),i.toDataURL()}catch{}return null}function yh(t){if(typeof window>"u")return ws.set(t,null),Rd(t,null),Promise.resolve(null);let e=ws.get(t);if(e!==void 0)return Rd(t,e),Promise.resolve(e);let n=bs.get(t);if(n)return n;let r=k1(t).then(o=>(ws.set(t,o),bs.delete(t),Rd(t,o),o)).catch(()=>(bs.delete(t),null));return bs.set(t,r),r}function pr(t){return gh(t)}function Ta(t,e={}){let n=Math.max(12,e.size??36),r=String(e.fallback??"\u{1F326}"),o=typeof e.alt=="string"?e.alt:"",s=document.createElement("span");if(Ca.set(s,{size:n,fallback:r,alt:o}),typeof window>"u")return Ea(s,null),s;T1();let i=gh(t);return i?(C1(i,s,{size:n,fallback:r,alt:o}),Ea(s,ws.get(i)??null),yh(i),s):(Ea(s,null),s)}var Ih="qws:shop:notifs:v1",Ah="qws:shop:notifs:rules.v1",Mh="qws:weather:notifs:v1",Ph="qws:notifier:loopDefaults.v1",ka={[he.Common]:"Common",[he.Uncommon]:"Uncommon",[he.Rare]:"Rare",[he.Legendary]:"Legendary",[he.Mythic]:"Mythical",[he.Divine]:"Divine",[he.Celestial]:"Celestial"},I1=t=>String(t??"").toLowerCase();var Rh=t=>{if(!t)return"";let e=[];if(t.sound){let r=Me.listSounds().includes(t.sound)?t.sound:t.sound.length>32?`${t.sound.slice(0,29)}\u2026`:t.sound;e.push(`Sound: ${r}`)}if(t.playbackMode==="oneshot"?e.push("Mode: One-shot"):t.playbackMode==="loop"&&e.push("Mode: Loop"),t.stopMode==="purchase"?e.push("Stop: Until purchase"):t.stopMode==="manual"&&e.push("Stop: Manual"),t.loopIntervalMs!=null){let n=Number(t.loopIntervalMs);if(Number.isFinite(n)){let r=Math.max(1,Math.round(n)),o=r/1e3,s=o>=1?`${(o>=10?Math.round(o):Math.round(o*10)/10).toFixed(o>=10?0:1)} s`:`${r} ms`;e.push(`Interval: ${s}`)}}return e.join(" \u2022 ")},$d=(t,e)=>{if(e)return{label:"Now",title:t?new Date(t).toLocaleString():"Currently active"};if(!t)return{label:"Never",title:"Never seen"};let n=Date.now(),r=Math.max(0,n-t),o;if(r<45e3)o="Just now";else if(r<9e4)o="1 min ago";else if(r<60*60*1e3){let s=Math.round(r/6e4);o=`${s} min${s>1?"s":""} ago`}else if(r<36*60*60*1e3){let s=Math.round(r/36e5);o=`${s} hour${s>1?"s":""} ago`}else{let s=Math.round(r/864e5);o=`${s} day${s>1?"s":""} ago`}return{label:o,title:new Date(t).toLocaleString()}};var Jd=t=>JSON.stringify(t.map(e=>[e.id,e.notify?1:0,e.lastSeen||0,e.isCurrent?1:0])),_h=t=>{let e=[t.name];if(t.multiplier!=null){let n=Number(t.multiplier);if(Number.isFinite(n)){let r=Math.abs(n-Math.round(n))<.01?Math.round(n):Math.round(n*100)/100;e[0]=`${e[0]} \xD7${r}`}}return e.join(" ")},ro=t=>{let e=typeof t=="number"?t:Number(t);return Number.isFinite(e)?e:void 0},A1=t=>{if(!t||typeof t!="object")return null;let e=typeof t.kind=="string"?t.kind.trim():"",n=e.toLowerCase(),r="unknown";(n==="weather"||n==="lunar"||n==="base")&&(r=n);let o={kind:r,rawKind:e||void 0},s=ro(t.startWindowMin);s!==void 0&&(o.startWindowMin=s);let i=ro(t.startWindowMax);i!==void 0&&(o.startWindowMax=i);let a=ro(t.durationMinutes);a!==void 0&&(o.durationMinutes=a);let l=ro(t.periodMinutes);return l!==void 0&&(o.periodMinutes=l),o},M1=t=>{if(!Array.isArray(t))return[];let e=[];for(let n of t){if(!n||typeof n!="object")continue;let r=typeof n.name=="string"?n.name.trim():"";if(!r)continue;let o={name:r},s=ro(n.multiplier);s!==void 0&&(o.multiplier=s);let i=typeof n.conditional=="string"?n.conditional.trim():"";i&&(o.conditional=i),e.push(o)}return e},Lh=(()=>{let t=[];for(let[e,n]of Object.entries(tr??{})){let r=String(e||"").trim();if(!r)continue;let o=typeof n?.displayName=="string"?String(n.displayName).trim():"",s=(o||r).replace(/([a-z])([A-Z])/g,"$1 $2").replace(/_/g," ").replace(/\s+/g," ").trim(),i=typeof n?.atomValue=="string"?String(n.atomValue).trim():"",a=pr(r)??pr(o)??null,l=i||s,c=typeof n?.description=="string"?String(n.description).trim():null,d=ro(n?.weightInCycle),u=A1(n?.cycle),p=M1(n?.mutations);t.push({id:`Weather:${r}`,name:s||r,atomValue:i,spriteKey:a,type:l,description:c,cycle:u,weightInCycle:d??null,mutations:p})}return t})(),Nh=new Map,Oh=new Map,Ma=new Map;for(let t of Lh)Nh.set(t.id,t),Ma.set(t.name.toLowerCase(),t),Oh.set(t.atomValue.toLowerCase(),t),Ma.set(t.id.slice(8).toLowerCase(),t);var _d=null;function P1(){if(_d)return _d;let t=new Map;for(let[e,n]of Object.entries(Be))if(n?.seed){let r=`Seed:${e}`;t.set(r,{type:"Seed",name:n.seed.name,rarity:ka[n.seed.rarity]??n.seed.rarity})}for(let[e,n]of Object.entries(Pt)){let r=`Egg:${e}`;t.set(r,{type:"Egg",name:n.name,rarity:ka[n.rarity]??n.rarity})}for(let[e,n]of Object.entries(Rt)){let r=`Tool:${e}`;t.set(r,{type:"Tool",name:n.name,rarity:ka[n.rarity]??n.rarity})}for(let[e,n]of Object.entries(_t)){let r=`Decor:${e}`;t.set(r,{type:"Decor",name:n.name,rarity:ka[n.rarity]??n.rarity})}return _d=t,t}var ao=new Map,Fn=new Map,Nd=!1,io={},Od=!1,Qt=new Map,Pa=!1,qd=new Set,cn=Object.prototype.hasOwnProperty,Bn=null,bh=null,Dd=new Set,Zt=null,Bd=null,Fd=null;function oo(){if(!Pa){Pa=!0,Qt=new Map;try{let t=localStorage.getItem(Ah),e=t?JSON.parse(t):null;if(e&&typeof e=="object")for(let[n,r]of Object.entries(e)){let o=R1(r);o&&Qt.set(String(n),o)}}catch{Qt=new Map}}}function R1(t){let e={};return cn.call(t??{},"sound")&&(e.sound=t?.sound??null),cn.call(t??{},"playbackMode")&&(e.playbackMode=t?.playbackMode??null),cn.call(t??{},"stopMode")&&(e.stopMode=t?.stopMode??null),cn.call(t??{},"stopRepeats")&&(e.stopRepeats=t?.stopRepeats??null),cn.call(t??{},"loopIntervalMs")&&(e.loopIntervalMs=t?.loopIntervalMs??null),Fh(void 0,e)}function vh(){if(Pa)try{let t={};for(let[e,n]of Qt.entries())t[e]={...n};localStorage.setItem(Ah,JSON.stringify(t))}catch{}}function Qd(){if(!Nd){Nd=!0,Fn=new Map;try{let t=localStorage.getItem(Mh);if(!t)return;let e=JSON.parse(t);if(e&&typeof e=="object")for(let[n,r]of Object.entries(e)){if(!n)continue;let o={};typeof r?.notify=="boolean"&&(o.notify=!!r.notify),typeof r?.lastSeen=="number"&&Number.isFinite(r.lastSeen)&&(o.lastSeen=Number(r.lastSeen)),Fn.set(String(n),o)}}catch{Fn=new Map}}}function qh(){if(Nd)try{let t={};for(let[e,n]of Fn.entries()){let r={};n.notify&&(r.notify=!0),typeof n.lastSeen=="number"&&Number.isFinite(n.lastSeen)&&(r.lastSeen=n.lastSeen),(r.notify||r.lastSeen!=null)&&(t[e]=r)}localStorage.setItem(Mh,JSON.stringify(t))}catch{}}function Es(t){Qd();let e=Fn.get(t);if(e)return e;let n={};return Fn.set(t,n),n}function Dh(){if(!Od){Od=!0,io={};try{let t=localStorage.getItem(Ph);if(!t)return;let e=JSON.parse(t);if(e&&typeof e=="object")for(let[n,r]of Object.entries(e)){let o=n;if(o!=="shops"&&o!=="weather")continue;let i=r?.stopMode==="purchase"?"purchase":"manual",a=Number(r?.stopRepeats),l=Number.isFinite(a)?Math.max(1,Math.floor(a)):null,c=Number(r?.loopIntervalMs),d=Me.getPlaybackSettings(o),u=Number.isFinite(c)?c:d.loopIntervalMs,p=Math.max(150,Math.floor(u||0));io[o]={stopMode:i,stopRepeats:l,loopIntervalMs:p}}}catch{io={}}}}function _1(){if(Od)try{let t={};for(let[e,n]of Object.entries(io)){if(!n)continue;let r=Math.max(150,Math.floor(n.loopIntervalMs|0)),o=n.stopRepeats!=null?Math.max(1,Math.floor(n.stopRepeats|0)):null;t[e]={stopMode:n.stopMode,stopRepeats:o,loopIntervalMs:r}}localStorage.setItem(Ph,JSON.stringify(t))}catch{}}function wh(t){Dh();let e=io[t],n=Me.getPlaybackSettings(t),r=Math.max(150,Math.floor(n.loopIntervalMs||0)),o=e?.loopIntervalMs,s=Math.max(150,Math.floor(o??r)),i=e?.stopMode==="purchase"?"purchase":null,a=n.stop.mode==="purchase"?"purchase":null;return t==="shops"?{stopMode:i??a??"purchase",stopRepeats:null,loopIntervalMs:s}:{stopMode:"manual",stopRepeats:null,loopIntervalMs:s}}function L1(){Bn&&Dd.forEach(t=>{try{t(Bn)}catch{}})}function Ia(){Qd();let t=Lh.map(r=>{let o=Es(r.id),s=!!o.notify,i=typeof o.lastSeen=="number"&&Number.isFinite(o.lastSeen)?o.lastSeen:null;return{id:r.id,name:r.name,type:r.type,spriteKey:r.spriteKey,atomValue:r.atomValue,notify:s,lastSeen:i,isCurrent:r.id===Zt,description:r.description,cycle:r.cycle?{...r.cycle}:null,weightInCycle:r.weightInCycle,mutations:r.mutations.map(a=>({...a}))}}),e=JSON.stringify(t.map(r=>[r.id,r.notify?1:0,r.lastSeen||0,r.isCurrent?1:0])),n=e!==bh;bh=e,Bn={updatedAt:Date.now(),currentId:Zt,rows:t},n&&L1()}function N1(t){let e={},n=Qt.get(t);return n?.sound&&(e.sound=n.sound),e.mode="oneshot",e}function Bh(t){if(!Nh.get(t))return;let n=N1(t);Me.trigger(t,n,"weather").catch(()=>{})}function Sh(t,e={}){let r=(l=>l==null?"":typeof l=="string"?l.trim():String(l||"").trim())(t);if(!e.force&&Bd===r)return;let o=r.toLowerCase(),s=Oh.get(o)||Ma.get(o);if(!s&&o){let l=o.replace(/\s+/g,"");s=Ma.get(l)}let i=Zt,a=Date.now();if(s){let l=Es(s.id);l.lastSeen=a,Fn.set(s.id,l)}Zt=s?.id??null,Bd=r,Zt&&_e.incrementWeatherStat(Zt.replace("Weather:","")),i&&i!==Zt&&Me.stopLoop(i),s&&Es(s.id).notify&&Bh(s.id),s&&qh(),Ia()}function O1(t,e){return!t&&!e?!0:!t||!e?!1:t.sound===e.sound&&t.playbackMode===e.playbackMode&&t.stopMode===e.stopMode&&t.loopIntervalMs===e.loopIntervalMs}function q1(t){if(typeof t!="string")return;let e=t.trim();return e||void 0}function D1(t){if(t==null)return;let e=String(t);return e==="oneshot"||e==="loop"?e:void 0}function B1(t){if(t==null)return;if(String(t)==="purchase")return"purchase"}function F1(t){if(t==null)return;let e=Number(t);if(!Number.isFinite(e))return;let n=Math.max(150,Math.floor(e));return n>=150?n:void 0}function Fh(t,e){let n={...t??{}};if(cn.call(e,"sound")){let r=q1(e.sound);r?n.sound=r:delete n.sound}if(cn.call(e,"playbackMode")){let r=D1(e.playbackMode);r?n.playbackMode=r:delete n.playbackMode}if(cn.call(e,"stopMode")){let r=B1(e.stopMode);r?n.stopMode=r:delete n.stopMode,delete n.stopRepeats}if(cn.call(e,"stopRepeats")&&delete n.stopRepeats,cn.call(e,"loopIntervalMs")){let r=F1(e.loopIntervalMs);r!=null?n.loopIntervalMs=r:delete n.loopIntervalMs}return Object.keys(n).length?n:null}function Hd(){oo();let t={};for(let[e,n]of Qt.entries())t[e]={...n.sound?{sound:n.sound}:{},...n.playbackMode?{playbackMode:n.playbackMode}:{},...n.stopMode?{stopMode:n.stopMode}:{},...n.loopIntervalMs!=null?{loopIntervalMs:n.loopIntervalMs}:{}};return t}function xh(){if(!Pa)return;let t=Hd();qd.forEach(e=>{try{e(t)}catch{}})}function H1(){try{let t=localStorage.getItem(Ih),e=t?JSON.parse(t):{},n=new Map;if(e&&typeof e=="object")for(let[r,o]of Object.entries(e)){let i=(Number(o)|0)&1;r&&i!==void 0&&n.set(String(r),i)}ao=n}catch{ao=new Map}}function W1(){try{let t={};for(let[e,n]of ao)t[e]=n&1;localStorage.setItem(Ih,JSON.stringify(t))}catch{}}var xs=t=>(ao.get(t)??0)&1,Ld=(t,e)=>{if(!t)return;let n=e&1;n?ao.set(t,n):ao.delete(t),W1(),jh()},so=new Map,Eh="",Ot=null,Wd=null,jd=null,zd=new Set,Ud=new Map,Gd=null,j1={Shovel:1,WateringCan:99};function Aa(t){let e=j1[t];return e?(Ud.get(t)||0)>=e:!1}function Ch(t){try{let e=Array.isArray(t)?t:[];Ud=new Map(e.map(n=>[String(n.toolId),Number(n.quantity)||0]))}catch{Ud=new Map}jh()}function z1(){let t=pe;return t.inventory?.myToolInventory??t.shop?.myToolInventory??t.myToolInventoryAtom??null}function U1(t){return t.slice().sort().join("|")}var Kd=new Set;function Hh(t){let e=n=>({createdAt:Number(n?.createdAt)||0,purchases:n?.purchases&&typeof n.purchases=="object"?n.purchases:{}});return{seed:e(t?.seed),egg:e(t?.egg),tool:e(t?.tool),decor:e(t?.decor)}}function Th(t){let e=Hh(t);Kd.forEach(n=>{try{n(e)}catch{}})}var Vd=new Set;function Wh(t){let e=n=>({inventory:Array.isArray(n?.inventory)?n.inventory:[],secondsUntilRestock:Number(n?.secondsUntilRestock)||0});return{seed:e(t?.seed),egg:e(t?.egg),tool:e(t?.tool),decor:e(t?.decor)}}function kh(t){let e=Wh(t);Vd.forEach(n=>{try{n(e)}catch{}})}function Ra(t){let e=P1(),n=[{key:"seed",type:"Seed"},{key:"egg",type:"Egg"},{key:"tool",type:"Tool"},{key:"decor",type:"Decor"}],r=new Set;for(let{key:c,type:d}of n){let u=t?.[c]??{},p=Array.isArray(u?.inventory)?u.inventory:[];for(let f of p){let h=d==="Seed"?`Seed:${f.species}`:d==="Egg"?`Egg:${f.eggId}`:d==="Tool"?`Tool:${f.toolId}`:`Decor:${f.decorId}`;r.add(h);let m=e.get(h),y=!!(xs(h)&1),v={id:h,type:d,name:m?.name??h.split(":")[1]??h,rarity:m?.rarity,popup:y,followed:y};so.set(h,v)}}for(let c of Array.from(so.keys()))r.has(c)||so.delete(c);let o=Array.from(so.values()),s=o.reduce((c,d)=>c+(d.followed?1:0),0),i={updatedAt:Date.now(),rows:o,counts:{items:o.length,followed:s}},a=U1(o.map(c=>c.id)),l=a!==Eh;Ot=i,l&&(Eh=a,zh())}function jh(){if(!Ot)return;for(let[n,r]of so){let s=!!(xs(n)&1);if(n.startsWith("Tool:")){let i=n.slice(5);Aa(i)&&(s=!1)}r.popup=s,r.followed=s}let t=Array.from(so.values()),e=t.reduce((n,r)=>n+(r.followed?1:0),0);Ot={...Ot,updatedAt:Date.now(),rows:t,counts:{items:t.length,followed:e}},zh()}function zh(){if(!Ot)return;let t={...Ot,rows:Ot.rows.slice()};zd.forEach(e=>{try{e(t)}catch{}})}var Yd=!1;async function Dn(){if(!Yd){Yd=!0,H1(),oo();try{let t=await pe.shop.shops.get();Ra(t),kh(t)}catch{}try{Wd=await pe.shop.shops.onChange(t=>{try{Ra(t)}catch{}try{kh(t)}catch{}})}catch{}try{let t=await pe.shop.myShopPurchases.get();Th(t)}catch{}try{jd=await pe.shop.myShopPurchases.onChange(t=>{try{Th(t)}catch{}})}catch{}try{let t=z1();if(t){try{Ch(await t.get())}catch{}try{Gd=await t.onChange(e=>{try{Ch(e)}catch{}})}catch{}}}catch{}try{let t=pe.data?.weather;if(t){try{Sh(await t.get(),{force:!0})}catch{}try{Fd=await t.onChange(e=>{try{Sh(e)}catch{}})}catch{}}}catch{}}}function G1(){try{Wd?.()}catch{}Wd=null;try{jd?.()}catch{}jd=null;try{Gd?.()}catch{}Gd=null;try{Fd?.()}catch{}if(Fd=null,Zt)try{Me.stopLoop(Zt)}catch{}Zt=null,Bd=null,Yd=!1}var De={async start(){return await Dn(),()=>G1()},async get(){return await Dn(),Ot||Ra(await pe.shop.shops.get().catch(()=>null)),Ot},onChange(t){return zd.add(t),()=>{zd.delete(t)}},async onChangeNow(t){if(await Dn(),Ot)t(Ot);else{try{Ra(await pe.shop.shops.get())}catch{}Ot&&t(Ot)}return this.onChange(t)},onShopsChange(t){return Vd.add(t),()=>{Vd.delete(t)}},async onShopsChangeNow(t){await Dn();try{t(Wh(await pe.shop.shops.get()))}catch{}return this.onShopsChange(t)},onPurchasesChange(t){return Kd.add(t),()=>{Kd.delete(t)}},async onPurchasesChangeNow(t){await Dn();try{t(Hh(await pe.shop.myShopPurchases.get()))}catch{}return this.onPurchasesChange(t)},async getWeatherState(){return await Dn(),Bn||Ia(),Bn},onWeatherChange(t){return Dd.add(t),()=>{Dd.delete(t)}},async onWeatherChangeNow(t){return await Dn(),Bn||Ia(),Bn&&t(Bn),this.onWeatherChange(t)},getWeatherNotify(t){return t?!!Es(t).notify:!1},setWeatherNotify(t,e){if(!t)return;Qd();let n=Es(t),r=!!e;if(!!n.notify!==r){if(n.notify=r,Fn.set(t,n),qh(),r)Zt===t&&Bh(t);else try{Me.stopLoop(t)}catch{}Ia()}},getContextStopDefaults(t){return wh(t)},setContextStopDefaults(t,e){if(t!=="shops"&&t!=="weather")return;Dh();let n=wh(t),r=Number(e?.loopIntervalMs),o=Number.isFinite(r)?Math.max(150,Math.floor(r)):n.loopIntervalMs,s=e.stopMode==="purchase"?"purchase":"manual",i={stopMode:t==="weather"?"manual":s,stopRepeats:null,loopIntervalMs:o};io[t]=i,_1()},getPref(t){if(t.startsWith("Tool:")){let r=t.slice(5);if(Aa(r))return{popup:!1,followed:!1}}let n=!!(xs(t)&1);return{popup:n,followed:n}},setPopup(t,e){if(e&&t.startsWith("Tool:")&&Aa(t.slice(5)))return;let n=xs(t),r=e?n|1:n&-2;Ld(t,r)},setPrefs(t,e){let r=xs(t);typeof e.popup=="boolean"&&(r=e.popup?r|1:r&-2),Ld(t,r)},clearPrefs(t){Ld(t,0)},isIdCapped(t){return t.startsWith("Tool:")?Aa(t.slice(5)):!1},filterRows(t,e){let n=t.slice(),r=e.type??"all";r&&r!=="all"&&(n=n.filter(s=>s.type.toLowerCase()===r));let o=e.rarity??"all";return o!=="all"&&(n=n.filter(s=>I1(s.rarity)===o)),n},getRule(t){if(!t)return null;oo();let e=Qt.get(t);return e?{...e.sound?{sound:e.sound}:{},...e.playbackMode?{playbackMode:e.playbackMode}:{},...e.stopMode?{stopMode:e.stopMode}:{},...e.loopIntervalMs!=null?{loopIntervalMs:e.loopIntervalMs}:{}}:null},getAllRules(){return Hd()},setRule(t,e){if(!t||!e||typeof e!="object")return;oo();let n=Qt.get(t),r=Fh(n,e);O1(n,r)||(r?Qt.set(t,r):Qt.delete(t),vh(),xh())},clearRule(t){if(!t)return;oo(),Qt.delete(t)&&(vh(),xh())},onRulesChange(t){return oo(),qd.add(t),()=>{qd.delete(t)}},async onRulesChangeNow(t){return await Dn(),t(Hd()),this.onRulesChange(t)}};function Uh(t,e=Be){let n=e?.[t];return n?.seed?.name??n?.plant?.name??n?.crop?.name??void 0}function Gh(t,e=Pt){return e?.[t]?.name??void 0}function Kh(t,e=Rt){return e?.[t]?.name??void 0}function Vh(t,e=_t){return e?.[t]?.name??void 0}var Hn=(t,e)=>Object.assign(t.style,e),Zd=(t,e)=>{for(let[n,r]of Object.entries(e))t.style.setProperty(n,r)};function K1(t,e=24){let n=document.createElement("div");Object.assign(n.style,{width:`${e}px`,height:`${e}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",flex:`0 0 ${e}px`});let[r,o]=t.split(":"),s=r==="Seed"||r==="Egg"||r==="Tool"||r==="Decor"?r:null,i=s==="Seed"?"\u{1F331}":s==="Egg"?"\u{1F95A}":s==="Tool"?"\u{1F9F0}":s==="Decor"?"\u{1F3E0}":"\u{1F514}";if(s&&o){let a=to(s,o,{size:e,fallback:i,alt:$h(t)});n.appendChild(a)}else{let a=document.createElement("span");a.textContent=i,a.style.fontSize=`${Math.max(10,e-2)}px`,a.setAttribute("aria-hidden","true"),n.appendChild(a)}return n}function $h(t){let[e,n]=t.split(":");switch(e){case"Seed":return Uh(n)??n;case"Egg":return Gh(n)??n;case"Tool":return Kh(n)??n;case"Decor":return Vh(n)??n;default:return n}}function Yh(t,e){if(!e)return 0;let[n,r]=String(t).split(":"),o=n==="Seed"?e.seed:n==="Egg"?e.egg:n==="Tool"?e.tool:e.decor;if(!o||!o.purchases)return 0;let s=o.purchases[r];return typeof s=="number"&&s>0?s:0}var Xd=class{constructor(){ce(this,"slot",document.createElement("div"));ce(this,"btn",document.createElement("button"));ce(this,"badge",document.createElement("span"));ce(this,"panel",document.createElement("div"));ce(this,"lastShops",null);ce(this,"lastPurch",null);ce(this,"prevOverlayIds",new Set);ce(this,"currentOverlayIds",new Set);ce(this,"rulesById",new Map);ce(this,"shopUpdates",0);ce(this,"purchasesUpdates",0);ce(this,"bootArmed",!1);ce(this,"justRestocked",!1);ce(this,"mo",null);ce(this,"rows",[]);this.slot=this.createSlot(),this.btn=this.createButton(),this.ensureBellCSS(),this.badge=this.createBadge(),this.panel=this.createPanel(),this.installScrollGuards(this.panel);let e=!1;this.btn.onclick=async()=>{if(!e){e=!0;try{await Me.prime()}catch{}}let n=this.panel.style.display!=="block";this.panel.style.display=n?"block":"none",n&&this.renderPanel(),this.updateBellWiggle()},this.slot.append(this.btn,this.badge,this.panel),this.attachLeftOfTargetCanvas(),this.observeDomForRelocation(),window.addEventListener("pointerdown",n=>{if(this.panel.style.display!=="block")return;let r=n.target;this.slot.contains(r)||(this.panel.style.display="none")}),Me.setPurchaseChecker(n=>!n||this.currentOverlayIds.has(n)?!1:Yh(n,this.lastPurch)>0)}destroy(){try{this.mo?.disconnect()}catch{}try{this.slot.remove()}catch{}try{Me.stopAllLoops()}catch{}}ensureBellCSS(){if(document.getElementById("qws-bell-anim-css"))return;let e=document.createElement("style");e.id="qws-bell-anim-css",e.textContent=`
@keyframes qwsBellShake {
  0% { transform: rotate(0deg); }
  10% { transform: rotate(-16deg); }
  20% { transform: rotate(12deg); }
  30% { transform: rotate(-10deg); }
  40% { transform: rotate(8deg); }
  50% { transform: rotate(-6deg); }
  60% { transform: rotate(4deg); }
  70% { transform: rotate(-2deg); }
  80% { transform: rotate(1deg); }
  100% { transform: rotate(0deg); }
}

/* Classe appliqu\xE9e sur le span cloche quand il y a des items dans l'overlay */
.qws-bell--wiggle {
  animation: qwsBellShake 1.2s ease-in-out infinite;
  transform-origin: 50% 0%;
  display: inline-block;
}

/* Respecte l'accessibilit\xE9 */
@media (prefers-reduced-motion: reduce) {
  .qws-bell--wiggle { animation: none !important; }
}
`,document.head.appendChild(e)}setShops(e){let n=this.lastShops;this.lastShops=e,this.shopUpdates++,this.justRestocked=!!(n&&((n.seed?.secondsUntilRestock??0)<(e.seed?.secondsUntilRestock??0)||(n.tool?.secondsUntilRestock??0)<(e.tool?.secondsUntilRestock??0)||(n.egg?.secondsUntilRestock??0)<(e.egg?.secondsUntilRestock??0)||(n.decor?.secondsUntilRestock??0)<(e.decor?.secondsUntilRestock??0))),this.recompute()}setPurchases(e){this.lastPurch=e,this.purchasesUpdates++,this.recompute()}notifyStateUpdated(){this.recompute()}setRules(e){this.rulesById.clear();for(let[n,r]of Object.entries(e))!n||!r||this.rulesById.set(n,{...r});this.refreshActiveLoops()}buildTriggerOverrides(e){if(!e)return null;let n={};return e.sound&&(n.sound=e.sound),(e.playbackMode==="loop"||e.playbackMode==="oneshot")&&(n.mode=e.playbackMode),e.stopMode==="purchase"?n.stop={mode:"purchase"}:e.stopMode==="manual"&&(n.stop={mode:"manual"}),e.loopIntervalMs!=null&&Number.isFinite(e.loopIntervalMs)&&(n.loopIntervalMs=Math.max(150,Math.floor(Number(e.loopIntervalMs)))),Object.keys(n).length?n:null}triggerMany(e){let n=[];for(let o of e){let s=this.buildTriggerOverrides(this.rulesById.get(o))??{},i=this.resolvePlaybackMode(o),a=s.sound?`sound:${s.sound.trim().toLowerCase()}`:"sound:__default__";n.push({id:o,overrides:s,mode:i,soundKey:a})}if(!n.length)return;let r=new Map;for(let o of n){let s=r.get(o.soundKey)??{loops:[],oneshots:[]};o.mode==="loop"?s.loops.push(o):s.oneshots.push(o),r.set(o.soundKey,s)}for(let{loops:o,oneshots:s}of r.values()){if(o.length){for(let i of o)Me.trigger(i.id,i.overrides,"shops").catch(()=>{});continue}if(s.length){let i=s[0];Me.trigger(i.id,i.overrides,"shops").catch(()=>{})}}}triggerWithRule(e){this.triggerMany([e])}resolvePlaybackMode(e){let n=this.rulesById.get(e),r=Me.getPlaybackMode("shops");return n?n.playbackMode==="loop"?"loop":n.playbackMode==="oneshot"?"oneshot":(n.stopMode||n.loopIntervalMs!=null)&&r==="loop"?"loop":r:r}refreshActiveLoops(){if(!this.currentOverlayIds.size)return;let e=[];for(let n of this.currentOverlayIds)this.resolvePlaybackMode(n)==="loop"&&(Me.stopLoop(n),e.push(n));e.length&&this.triggerMany(e)}async recompute(){if(!this.lastShops||!this.lastPurch)return;let e=[],n=(a,l,c)=>{if(!c||!(De.getPref?.(a)||{}).popup)return;let u=Yh(a,this.lastPurch),p=Math.max(l-u,0);p>0&&e.push({id:a,qty:p})};for(let a of this.lastShops.seed.inventory)n(`Seed:${a.species}`,a.initialStock,a.canSpawnHere);for(let a of this.lastShops.tool.inventory)n(`Tool:${a.toolId}`,a.initialStock,a.canSpawnHere);for(let a of this.lastShops.egg.inventory)n(`Egg:${a.eggId}`,a.initialStock,a.canSpawnHere);for(let a of this.lastShops.decor.inventory)n(`Decor:${a.decorId}`,a.initialStock,a.canSpawnHere);this.rows=e,this.renderBadge(),this.panel.style.display==="block"&&this.renderPanel(),this.updateBellWiggle();let r=new Set(e.map(a=>a.id));this.currentOverlayIds=r;let o=(this.lastShops.seed?.inventory?.length??0)+(this.lastShops.tool?.inventory?.length??0)+(this.lastShops.egg?.inventory?.length??0)+(this.lastShops.decor?.inventory?.length??0)===0,s=this.shopUpdates>=3&&this.purchasesUpdates>=2&&!o;if(!this.bootArmed){if(!s){this.prevOverlayIds=r;return}this.bootArmed=!0,r.size>0&&this.triggerMany(r),this.prevOverlayIds=r,this.justRestocked=!1;return}if(r.size===0){Me.stopAllLoops(),this.prevOverlayIds=r,this.justRestocked=!1;return}if(this.justRestocked){this.triggerMany(r);for(let a of this.prevOverlayIds)r.has(a)||Me.stopLoop(a);this.prevOverlayIds=r,this.justRestocked=!1;return}let i=[];for(let a of r)this.prevOverlayIds.has(a)||i.push(a);i.length&&this.triggerMany(i);for(let a of this.prevOverlayIds)r.has(a)||Me.stopLoop(a);this.prevOverlayIds=r,this.justRestocked=!1}renderBadge(){let e=this.rows.length;this.badge.textContent=e?String(e):"",Hn(this.badge,{display:e?"inline-flex":"none"})}renderPanel(){this.panel.replaceChildren();let e=document.createElement("div");if(e.textContent="Tracked items available",Hn(e,{fontWeight:"700",opacity:"0.9",padding:"4px 2px",borderBottom:"1px solid var(--qws-border-2, #ffffff14)",marginBottom:"4px"}),this.panel.appendChild(e),!this.rows.length){let n=document.createElement("div");n.textContent="No tracked items are available.",Hn(n,{opacity:"0.75",padding:"8px 2px"}),this.panel.appendChild(n);return}for(let n of this.rows){let r=document.createElement("div");Object.assign(r.style,{display:"grid",gridTemplateColumns:"24px 1fr max-content",alignItems:"center",gap:"8px",padding:"6px 4px",borderBottom:"1px solid var(--qws-border-2, #ffffff14)"});let o=K1(n.id,24),s=document.createElement("div");s.textContent=$h(n.id),Object.assign(s.style,{fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"var(--qws-text, #e7eef7)"});let i=document.createElement("div");i.textContent=`\xD7${n.qty}`,Object.assign(i.style,{fontVariantNumeric:"tabular-nums",opacity:"0.9",color:"var(--qws-text-dim, #b9c3cf)"}),r.append(o,s,i),this.panel.appendChild(r)}}createSlot(){let e=document.createElement("div");return e.id="qws-notifier-slot",Hn(e,{position:"relative",display:"inline-flex",alignItems:"center",marginRight:"var(--chakra-space-2, 0.5rem)",pointerEvents:"auto",fontFamily:"var(--chakra-fonts-body, GreyCliff CF), system-ui, sans-serif",color:"var(--chakra-colors-chakra-body-text, #e7eef7)",userSelect:"none"}),Zd(e,{"-webkit-font-smoothing":"antialiased","-webkit-text-size-adjust":"100%","text-rendering":"optimizeLegibility"}),e}createButton(){let e=document.createElement("button");e.type="button",e.setAttribute("aria-label","Notifications");let n=document.createElement("span");return n.className="qws-bell",n.textContent="\u{1F514}",n.setAttribute("aria-hidden","true"),Hn(e,{display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",height:"36px",padding:"0 12px",borderRadius:"var(--chakra-radii-button, 50px)",border:"1px solid var(--chakra-colors-chakra-border-color, #ffffff33)",background:"var(--qws-panel, #111823cc)",backdropFilter:"blur(var(--qws-blur, 8px))",color:"var(--qws-text, #e7eef7)",boxShadow:"var(--qws-shadow, 0 10px 36px rgba(0,0,0,.45))",cursor:"pointer",transition:"border-color var(--chakra-transition-duration-fast,150ms) ease",outline:"none",position:"relative"}),Zd(e,{"-webkit-backdrop-filter":"blur(var(--qws-blur, 8px))","-webkit-tap-highlight-color":"transparent"}),e.appendChild(n),e.addEventListener("mouseenter",()=>{e.style.borderColor="var(--qws-accent, #7aa2ff)"}),e.addEventListener("mouseleave",()=>{e.style.borderColor="var(--chakra-colors-chakra-border-color, #ffffff33)"}),e}updateBellWiggle(){let e=this.btn.querySelector(".qws-bell");if(!e)return;let n=this.rows.length>0&&this.panel.style.display!=="block";e.classList.toggle("qws-bell--wiggle",n)}createBadge(){let e=document.createElement("span");return Hn(e,{position:"absolute",top:"-6px",right:"-6px",minWidth:"18px",height:"18px",padding:"0 6px",borderRadius:"999px",background:"var(--chakra-colors-Red-Magic, #D02128)",color:"var(--chakra-colors-Neutral-TrueWhite, #fff)",fontSize:"12px",fontWeight:"700",display:"none",alignItems:"center",justifyContent:"center",border:"1px solid rgba(0,0,0,.35)",lineHeight:"18px",pointerEvents:"none"}),e}createPanel(){let e=document.createElement("div");return e.setAttribute("role","dialog"),e.setAttribute("aria-label","Tracked items available"),Hn(e,{position:"absolute",top:"calc(100% + var(--chakra-space-2, 0.5rem))",right:"0",width:"min(280px, 70vw)",maxHeight:"50vh",overflow:"auto",overscrollBehavior:"contain",touchAction:"pan-y",borderRadius:"var(--chakra-radii-card, 12px)",border:"1px solid var(--qws-border, #ffffff22)",background:"var(--qws-panel, #111823cc)",backdropFilter:"blur(var(--qws-blur, 8px))",color:"var(--qws-text, #e7eef7)",boxShadow:"var(--qws-shadow, 0 10px 36px rgba(0,0,0,.45))",padding:"8px",display:"none",zIndex:"var(--chakra-zIndices-DialogModal, 7010)"}),Zd(e,{"-webkit-backdrop-filter":"blur(var(--qws-blur, 8px))"}),e}installScrollGuards(e){let n=r=>{r.stopPropagation()};e.addEventListener("wheel",n,{passive:!0,capture:!0}),e.addEventListener("mousewheel",n,{passive:!0,capture:!0}),e.addEventListener("DOMMouseScroll",n,{passive:!0,capture:!0}),e.addEventListener("touchmove",n,{passive:!0,capture:!0})}findTargetCanvas(){try{let e=document.querySelector("span[tabindex] canvas");return e||(Array.from(document.querySelectorAll("canvas")).map(o=>({c:o,r:o.getBoundingClientRect()})).filter(({r:o})=>o.width<=512&&o.height<=512&&o.top<300).sort((o,s)=>o.r.left-s.r.left||o.r.top-s.r.top)[0]?.c??null)}catch{return null}}findAnchorBlockFromCanvas(e){try{let n=e.closest("span[tabindex]");if(n&&n.parentElement)return n.parentElement;let r=e;for(;r&&r.parentElement;){let o=r.parentElement;if(getComputedStyle(o).display.includes("flex")&&o.children.length<=3)return o;r=o}return null}catch{return null}}insertLeftOf(e,n){let r=e.parentElement;if(!r||!e.isConnected||!r.isConnected)return;let o=getComputedStyle(r),s=o.display.includes("flex"),i=o.flexDirection||"row";try{s&&i.startsWith("row")&&i.endsWith("reverse")?n!==e.nextSibling&&r.insertBefore(n,e.nextSibling):r.insertBefore(n,e)}catch{}}attachLeftOfTargetCanvas(){try{let e=this.findTargetCanvas(),n=e?this.findAnchorBlockFromCanvas(e):null;if(!n||!n.parentElement||!n.isConnected){let r=document.getElementById("qws-notifier-fallback");r||(r=document.createElement("div"),r.id="qws-notifier-fallback",Hn(r,{position:"fixed",zIndex:"var(--chakra-zIndices-PresentableOverlay, 5100)",top:"calc(10px + var(--sait, 0px))",right:"calc(10px + var(--sair, 0px))"}),document.body.appendChild(r)),r.contains(this.slot)||r.appendChild(this.slot);return}(this.slot.parentElement!==n.parentElement||this.slot.nextElementSibling!==n&&n.previousElementSibling!==this.slot)&&this.insertLeftOf(n,this.slot)}catch{}}observeDomForRelocation(){try{this.mo?.disconnect(),this.mo=new MutationObserver(()=>this.attachLeftOfTargetCanvas()),this.mo.observe(document.body,{childList:!0,subtree:!0}),this.attachLeftOfTargetCanvas()}catch{}}};async function Jh(){let t=new Xd,e=await De.onPurchasesChangeNow(s=>t.setPurchases(s)),n=await De.onShopsChangeNow(s=>t.setShops(s)),r=await De.onChangeNow(()=>t.notifyStateUpdated()),o=await De.onRulesChangeNow(s=>t.setRules(s));window.__qws_cleanup_notifier=()=>{try{n()}catch{}try{e()}catch{}try{r()}catch{}try{o()}catch{}try{t.destroy()}catch{}}}var cu=["plant","egg","tool","decor"],It="romann-buyall-btn",Qh="tm-buyall-css",co="div.McFlex.css-1kkwxjt",eg="div.McFlex.css-1lfov12",tg="div.McFlex.css-b9riu6",su="data-tm-shop-index",V1=20,eu="data-tm-shop-type",tu=new WeakMap,Y1={plant:pe.shop.seedShop,egg:pe.shop.eggShop,tool:pe.shop.toolShop,decor:pe.shop.decorShop},ng={},rg={},Cs=!1,$1={};function J1(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function Q1(t){let e=J1(String(t||"").toLowerCase());return/\bdecor|decors|deco\b/.test(e)?"decor":/\bseed|seeds|graine|graines\b/.test(e)?"plant":/\begg|eggs|oeuf|oeufs\b/.test(e)?"egg":/\btool|tools|outil|outils\b/.test(e)?"tool":null}function Z1(t){let e=t.previousElementSibling?.querySelector?.(".chakra-text.css-1fq51pf");if(e?.innerText?.trim())return e.innerText.trim();let n=t.parentElement,r=n?.querySelector?.(":scope > .chakra-text.css-1fq51pf");if(r?.innerText?.trim())return r.innerText.trim();let o=n??t;for(let s=0;s<3&&o;s++){let i=o.querySelector(".chakra-text.css-1fq51pf");if(i?.innerText?.trim())return i.innerText.trim();o=o.parentElement}return null}function X1(t,e){return e?t==="plant"?e?.species?String(e.species):null:t==="egg"?e?.eggId?String(e.eggId):null:t==="tool"?e?.toolId?String(e.toolId):null:t==="decor"&&e?.decorId?String(e.decorId):null:null}function eC(t,e){return e?t==="plant"?e?.species?String(e.species):null:t==="egg"?e?.eggId?String(e.eggId):null:t==="tool"?e?.toolId?String(e.toolId):null:t==="decor"&&e?.decorId?String(e.decorId):null:null}function tC(t,e){let n=Array.isArray(e?.inventory)?e.inventory:[],r=[];for(let o of n){let s=X1(t,o);s&&r.push({id:s,name:eC(t,o),raw:o})}return r}function Zh(t,e){let n=tC(t,e);ng[t]=n,rg[t]=n.length}async function nC(){for(let t of cu){let e=Y1[t];if(console.log(await e.get()),!!e){if(!Cs)return;try{Zh(t,await e.get())}catch(n){console.warn(`[TM] buyAll failed to fetch ${t} inventory`,n)}if(!Cs)return;try{let n=await e.onChange(r=>{Zh(t,r)});if(!Cs){try{n()}catch(r){console.warn(`[TM] buyAll failed to cancel stale ${t} inventory watcher`,r)}return}$1[t]=()=>{try{n()}catch(r){console.warn(`[TM] buyAll failed to unsubscribe ${t} inventory`,r)}}}catch(n){console.warn(`[TM] buyAll failed to subscribe to ${t} inventory`,n)}}}}function rC(){Cs||(Cs=!0,nC().catch(t=>{console.warn("[TM] buyAll inventory init error",t)}))}function oC(t,e){let n=ng[t];return!n||e<0||e>=n.length?null:n[e]??null}var sC={tool:3},iC={plant:t=>Se.purchaseSeed(t),egg:t=>Se.purchaseEgg(t),tool:t=>Se.purchaseTool(t),decor:t=>Se.purchaseDecor(t)};function aC(t){switch(t){case"plant":_e.incrementShopStat("seedsBought");break;case"decor":_e.incrementShopStat("decorBought");break;case"egg":_e.incrementShopStat("eggsBought");break;case"tool":_e.incrementShopStat("toolsBought");break;default:break}}async function lC(t,e,n){if(!t||!e)return;let r=iC[t];if(!r)return;let o=typeof n=="number"?Math.max(0,Math.floor(n)):0;if(!(o<=0))for(let s=0;s<o;s+=1)try{await r(e),aC(t)}catch(i){console.warn("[TM] buyAll purchase failed",{shop:t,itemId:e,attempt:s+1,error:i});break}}function cC(){let t={...sC,...window.BuyAllConfig?.countOverride??{}},e={};for(let n of cu){let r=rg[n];console.log("cached: ",r),typeof r=="number"?e[n]=r:typeof t[n]=="number"&&(e[n]=t[n])}return console.log("sizes: ",e),e}function dC(t){let e=cC(),n=cu.filter(r=>typeof e[r]=="number"&&e[r]===t);return console.log(n),n.length===1?n[0]:null}function uC(t,e,n,r){let o=tu.get(t);if(o)return o;let s=t.getAttribute(eu);if(s)return s;let i=Z1(t);if(i){let l=Q1(i);if(l)return t.setAttribute(eu,l),tu.set(t,l),l}let a=dC(e);return a?(t.setAttribute(eu,a),tu.set(t,a),a):null}function pC(t){if(!t)return;let e=t.replace(/\u00A0|\u202F/g," ").trim(),n=/(\d{1,3}(?:[ \u00A0\u202F.,]\d{3})+|\d+(?:[.,]\d+)?)(\s*[kKmMbBtT])?/g,r,o=null,s=null;for(;r=n.exec(e);)o=r[1],s=(r[2]||"").trim().toUpperCase()||null;if(!o)return;if(s){let a=Number(o.replace(/[ \u00A0\u202F]/g,"").replace(",","."));return Number.isFinite(a)?Math.round(a*(s==="K"?1e3:s==="M"?1e6:s==="B"?1e9:s==="T"?1e12:1)):void 0}if(/[ \u00A0\u202F.,]\d{3}/.test(o)){let a=Number(o.replace(/[ \u00A0\u202F.,]/g,""));return Number.isFinite(a)?a:void 0}else{let a=Number(o.replace(",","."));return Number.isFinite(a)?Math.round(a):void 0}}var lo=null,og=null,nu=!1,ru=!1;function fC(t,e){if(!e)return 0;let[n,r]=String(t).split(":"),o=n==="Seed"?e.seed:n==="Egg"?e.egg:n==="Tool"?e.tool:e.decor;if(!o||!o.purchases)return 0;let s=o.purchases[r];return typeof s=="number"&&s>0?s:0}function mC(t,e){if(!t||!e)return null;let n=String(e);switch(t){case"plant":return`Seed:${n}`;case"egg":return`Egg:${n}`;case"tool":return`Tool:${n}`;case"decor":return`Decor:${n}`;default:return null}}function hC(){nu||(nu=!0,De.onShopsChangeNow(t=>{lo=t}).catch(t=>{nu=!1,console.warn("[TM] buyAll notifier shops subscription failed",t)})),ru||(ru=!0,De.onPurchasesChangeNow(t=>{og=t}).catch(t=>{ru=!1,console.warn("[TM] buyAll notifier purchases subscription failed",t)}))}function gC(t,e){if(!t||!e||!lo)return{initialStock:null,canSpawn:!1};let r=(t==="plant"?lo.seed?.inventory??[]:t==="egg"?lo.egg?.inventory??[]:t==="tool"?lo.tool?.inventory??[]:lo.decor?.inventory??[]).find(a=>a?t==="plant"?String(a.species)===e:t==="egg"?String(a.eggId)===e:t==="tool"?String(a.toolId)===e:String(a.decorId)===e:!1);if(!r)return{initialStock:null,canSpawn:!1};let o=Number(r.initialStock),s=Number.isFinite(o)?o:null,i=!!r.canSpawnHere;return{initialStock:s,canSpawn:i}}function yC(t,e){let n=mC(t,e);if(!n)return{notifierItemId:null,initialStock:null,purchased:null,remaining:null};let r=n.split(":")[1]??null,{initialStock:o,canSpawn:s}=gC(t,r);if(o==null)return{notifierItemId:n,initialStock:o,purchased:null,remaining:null};if(!s)return{notifierItemId:n,initialStock:o,purchased:null,remaining:0};let i=fC(n,og),a=Math.max(0,o-i);return{notifierItemId:n,initialStock:o,purchased:i,remaining:a}}function bC(t){return t?!!t.querySelector(".chakra-text.css-1ox18rb"):!1}function sg(t){let e=t.querySelectorAll(`:scope > ${co}`);return e.length?Array.from(e):Array.from(t.querySelectorAll(co))}function Xh(t){if(!t)return;let n=(t.querySelector(".css-1uduba2")?.innerText??t.textContent??"").trim();return pC(n)}function vC(t){let e=t.querySelector(tg);return e||(Array.from(t.querySelectorAll("div")).find(r=>r.querySelectorAll("button.chakra-button").length>=2)??null)}function wC(){if(document.getElementById(Qh))return;let t=`
    .${It}{
      background: var(--chakra-colors-Blue-Magic, #0067B4) !important;
      border-color: var(--chakra-colors-Blue-Dark, #264093) !important;
      color: #fff !important;
      border-width: 2px;
      border-radius: 5px;
      text-transform: uppercase;
      height: 40px;
      padding-inline: 24px;
      padding-top: 12px;
      padding-bottom: 12px;
      width: 100%;
    }
    .${It}:hover{
      background: var(--chakra-colors-Blue-Light, #48ADF4) !important;
      border-color: var(--chakra-colors-Blue-Magic, #0067B4) !important;
    }
    .${It}:focus-visible{
      outline: transparent solid 2px;
      outline-offset: 2px;
      box-shadow: var(--chakra-ring-offset-shadow, 0 0 #0000),
                  var(--chakra-ring-shadow, 0 0 #0000),
                  0 0 0 3px var(--chakra-ring-color, rgba(66,153,225,0.6));
    }
    /* \xC9tat disabled : couleurs/gris EXACTES demand\xE9es + blocage du hover */
    .${It}[disabled],
    .${It}[aria-disabled="true"]{
      background: var(--chakra-colors-Neutral-Grey) !important;
      border-color: var(--chakra-colors-Neutral-EarlGrey) !important;
      color: var(--chakra-colors-Neutral-EarlGrey) !important;
      opacity: 0.7 !important;
      cursor: not-allowed !important;
      box-shadow: none !important;
      pointer-events: none; /* pour l\u2019aria-disabled \xE9ventuel */
    }
    .${It}[disabled]:hover,
    .${It}[disabled]:focus,
    .${It}[aria-disabled="true"]:hover,
    .${It}[aria-disabled="true"]:focus{
      background: var(--chakra-colors-Neutral-Grey) !important;
      border-color: var(--chakra-colors-Neutral-EarlGrey) !important;
      color: var(--chakra-colors-Neutral-EarlGrey) !important;
      box-shadow: none !important;
    }
  `.trim(),e=document.createElement("style");e.id=Qh,e.textContent=t,document.head.appendChild(e)}function SC(t){let e=document.createElement("button");if(e.type="button",t?.className){let o=`${t.className} ${It}`.replace(new RegExp(`\\b${It}\\b`,"g"),"").trim();e.className=`${o} ${It}`.trim()}else e.className=`chakra-button ${It}`;let n=document.createElement("div");n.className="McFlex css-1fxg3mj";let r=document.createElement("span");return r.className="css-1uduba2",r.textContent="Buy all",n.appendChild(r),e.appendChild(n),e.addEventListener("click",o=>{if(console.log("test"),o.preventDefault(),o.stopPropagation(),e.disabled)return;let s=e.closest(co);console.log("itemEl ",s);let i=s?.closest(eg)||document.body;console.log("listRoot ",i);let a=sg(i);console.log("items ",a);let l=a.length;console.log("total ",l);let c=s?.getAttribute(su);console.log("attrIndex ",c);let d=c!=null&&c!==""?Number.parseInt(c,10):-1;(!Number.isFinite(d)||d<0)&&(d=s?a.indexOf(s):-1);let u=d>=0?d+1:-1;console.log("idx1 ",u);let p=uC(i,l,s,d);console.log("shop ",p);let f=null,h=null,m="none",g,y;if(console.log("shop: ",p," itemEl: ",s),p&&s&&vC(s)){let x=e,E=x.previousElementSibling,L=x.nextElementSibling;g=Xh(E),y=Xh(L);let P=d>=0?oC(p,d):null;P?(f=P.id,h=P.name??P.id,m="inventory"):d>=0&&typeof g=="number"&&typeof y=="number"&&(m="index")}let v=yC(p??null,f);lC(p,f,v.remaining),window.dispatchEvent(new CustomEvent("tm:buyAll",{detail:{index1:u,index0:d,total:l,shopType:p,itemId:f,itemName:h,reason:m,coin:g,credit:y,element:s,remaining:v.remaining,notifierItemId:v.notifierItemId}}))}),e}function iu(t){let e=t.closest(eg);if(e&&!t.hasAttribute(su)){let a=sg(e).indexOf(t);a>=0&&t.setAttribute(su,String(a))}let n=t.querySelector(tg)||Array.from(t.querySelectorAll("div")).find(i=>i.querySelectorAll("button.chakra-button").length>=2);if(!n)return;let r=n.querySelectorAll("button.chakra-button");if(r.length<2)return;let o=n.querySelector(`button.${It}`);o||(o=SC(r[0]),n.insertBefore(o,r[1]));let s=bC(t);o.disabled=s,o.setAttribute("aria-disabled",s?"true":"false")}function au(t=document){t.querySelectorAll(co).forEach(iu)}var lu=null,Ts=null;function ig(){wC(),hC(),rC(),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>au()):au(),lu=new MutationObserver(e=>{for(let n of e)for(let r of n.addedNodes)r instanceof Element&&(r.matches(co)&&iu(r),r.querySelectorAll?.(co).forEach(iu))});let t=()=>lu.observe(document.body,{childList:!0,subtree:!0});document.readyState==="loading"?document.addEventListener("DOMContentLoaded",t):t(),ag()}function ag(){Ts==null&&(Ts=window.setInterval(()=>au(),V1))}function xC(){Ts!=null&&(window.clearInterval(Ts),Ts=null)}document.addEventListener("visibilitychange",()=>{document.hidden?xC():lu&&ag()});var ou={containerSelector:".McFlex.css-1lfov12",itemSelector:".McFlex.css-1kkwxjt",flagSelector:".chakra-text.css-pyjzrq"};function lg(t={}){if(!EC())return{stop(){},runOnce(){},isRunning(){return!1}};let e=t.containerSelector??ou.containerSelector,n=t.itemSelector??ou.itemSelector,r=t.flagSelector??ou.flagSelector,o=t.root??document,s=t.observeHistory??!0,i=t.preferDirectChildren??!1,a=typeof t.log=="function"?t.log:t.log?(...m)=>console.debug("[ReorderObserver]",...m):()=>{},l=!0,c=!1;function d(){!l||c||(c=!0,requestAnimationFrame(()=>{try{let m=CC(o,e);for(let g of m)IC(g,n,r,i)}finally{c=!1}}))}let u=o.documentElement??o,p=new MutationObserver(d);p.observe(u,{childList:!0,subtree:!0}),d();let f=null;if(s){let{unhook:m}=AC(d);f=m}return{stop(){l&&(l=!1,p.disconnect(),f?.(),f=null,a("Stopped."))},runOnce(){d()},isRunning(){return l}}}function EC(){return typeof window<"u"&&typeof document<"u"}function CC(t,e){return Array.from(t.querySelectorAll(e))}function TC(){try{return document.querySelector(":scope"),!0}catch{return!1}}function kC(t,e){if(TC()){let n=Array.from(t.querySelectorAll(`:scope > ${e}`));if(n.length>0)return n}return Array.from(t.querySelectorAll(e))}function IC(t,e,n,r){let o=r?Array.from(t.children).filter(l=>l instanceof Element&&l.matches(e)):kC(t,e);if(o.length===0)return;let s=[],i=[];for(let l of o)(l.querySelector(n)?s:i).push(l);if(s.length===0)return;let a=!1;for(let l of o)if(!!!l.querySelector(n))a=!0;else if(a){let d=document.createDocumentFragment();for(let u of s)d.appendChild(u);for(let u of i)d.appendChild(u);t.appendChild(d);return}}function AC(t){let e=history.pushState?.bind(history),n=history.replaceState?.bind(history);function r(s){return s&&function(...a){let l=s.apply(this,a);return t(),l}}let o=()=>t();return e&&(history.pushState=r(e)),n&&(history.replaceState=r(n)),window.addEventListener("popstate",o),{unhook(){e&&(history.pushState=e),n&&(history.replaceState=n),window.removeEventListener("popstate",o)}}}var G2=new Promise(t=>{document.readyState!=="loading"?t():addEventListener("DOMContentLoaded",()=>t(),{once:!0})});function du(t){let e=document.createElement("style");return e.textContent=t,document.head.appendChild(e),e}function MC(t){if(typeof t=="function")return t;if(typeof t=="string")return e=>e.matches?.(t)??!1;throw new Error("Selector or predicate required")}function cg(t,e,{root:n=document,callForExisting:r=!0}={}){let o=MC(t),s=new WeakSet,i=l=>{s.has(l)||o(l)&&(s.add(l),e(l))};r&&"querySelectorAll"in n&&n.querySelectorAll("*").forEach(i);let a=new MutationObserver(l=>{for(let c of l)for(let d of Array.from(c.addedNodes)){if(d.nodeType!==1)continue;let u=d;i(u),u.querySelectorAll?.("*").forEach(i)}});return a.observe(n,{childList:!0,subtree:!0}),{disconnect:()=>a.disconnect()}}var PC=".css-ycloo9";var dg="tm-feed-from-inventory-btn",RC="tm-feed-from-inventory-row";var ug=!1;function mg(){ug||(ug=!0,!(typeof document>"u")&&cg(PC,t=>{t instanceof HTMLElement&&_C(t)}))}function _C(t){try{LC(t)}catch(e){console.warn("[PetPanel] Failed to inject feed button",e)}}function LC(t){if(t.querySelector(`.${dg}`))return;let e=t.querySelector("button.chakra-button"),n=pg(e,"INSTANT FEED");n.classList.add(dg),n.setAttribute("aria-label","Feed pet from inventory"),n.title="Feed pet from inventory",n.style.width="100%",n.style.minWidth="100%",n.style.alignContent="center",n.style.alignItems="center",n.style.padding="6px 14px",n.style.fontSize="13px",n.style.border="2px solid #FFC83D",n.style.color="rgb(205 200 193)",n.style.borderRadius="10px",n.style.height="40px",n.addEventListener("click",()=>{NC(n)});let r=document.createElement("div");r.classList.add("McFlex",RC),r.style.marginTop="8px",r.style.justifyContent="center",r.style.width="100%",r.style.flexDirection="column",r.style.alignItems="stretch",r.style.gap="8px",r.appendChild(n);let o=pg(e,"FEED FROM INVENTORY");o.style.width="100%",o.style.minWidth="100%",o.style.alignContent="center",o.style.alignItems="center",o.style.marginTop="8px",o.style.padding="6px 14px",o.style.fontSize="13px",o.style.border="2px solid #BA5E1E",o.style.color="rgb(205 200 193)",o.style.borderRadius="10px",o.style.height="40px",r.appendChild(o),o.addEventListener("click",()=>{OC(o)});let s=t.querySelector(".McFlex.css-cabebk"),i=t.querySelector(".McFlex.css-1hd05pq");s&&i&&i.parentElement===s.parentElement?i.parentElement.insertBefore(r,i):s?.parentElement?s.parentElement.insertBefore(r,s.nextSibling):t.appendChild(r)}function pg(t,e){let n=document.createElement("button");n.type="button",t?.className?n.className=t.className:n.className="chakra-button";let r=document.createElement("div");r.className=t?.firstElementChild instanceof HTMLElement?t.firstElementChild.className:"McFlex";let o=document.createElement("p"),s=t?.querySelector(".chakra-text");return o.className=s instanceof HTMLElement?s.className:"chakra-text",o.textContent=e,r.appendChild(o),n.appendChild(r),n}async function NC(t){let e=t.disabled;t.disabled=!0;try{let n=await hg();if(!n){await we("Feed from inventory","No expanded pet detected.","error");return}let r=await uu(n);if(!r){await we("Feed from inventory","Unable to resolve expanded pet.","error");return}let o=String(r?.slot?.petSpecies||""),s=Te.getCompatibleCropsForSpecies(o)??[],i=new Set(s.map(y=>String(y||"")));if(!i.size){await we("Feed from inventory","No compatible crops for this pet.","info");return}let a=await Se.getCropInventoryState(),l=Array.isArray(a)?a:[],c=await Se.getFavoriteIdSet().catch(()=>new Set),d=l.find(y=>{let v=String(y?.species||"");if(!v||!i.has(v))return!1;let w=String(y?.id||"");return w&&!c.has(w)}),u=String(d?.id||"");if(!u){await we("Feed from inventory","No compatible crops in inventory (excluding favorites).","info");return}let p=pu(r);await Se.feedPet(n,u);let f=await yg(n,p,{initialDelay:150}),h=f!=null?` Hunger: ${gg(f)}%.`:"",m=String(d?.species||"crop"),g=r?.slot?.name||o||n;await we("Feed from inventory",`Fed ${g} with ${m}.${h}`,"success")}catch(n){console.error("[Pet panel] Failed to feed pet from inventory",n),await we("Feed from inventory",n instanceof Error?n.message:"Failed to feed pet.","error")}finally{t.disabled=e}}async function OC(t){let e=t.disabled,n=!1;t.disabled=!0;try{let r=await hg();if(!r){await we("Feed from inventory","No expanded pet detected.","error");return}let o=await uu(r);if(!o){await we("Feed from inventory","Unable to resolve expanded pet.","error");return}let s=String(o?.slot?.petSpecies||""),i=pu(o),a=await qC(r,s);if(!a.size){await we("Feed from inventory","No compatible crops for this pet.","info");return}let l=await Se.getCropInventoryState(),c=Array.isArray(l)?l:[],d=await Se.getFavoriteIdSet().catch(()=>new Set),u=c.filter(g=>{let y=String(g?.species||"");if(!y||!a.has(y))return!1;let v=String(g?.id||"");return v&&!d.has(v)});if(!u.length){await we("Feed from inventory","No compatible crops in inventory.","info");return}let p=g=>{let y=new Set;for(let v of g){let w=String(v?.id||"");w&&y.add(w)}return Array.from(d).filter(v=>y.has(v))};await bn().catch(()=>{});let f=u.slice(),h=p(f);await Wt({items:f,favoritedItemIds:h},{open:!0});let m=o?.slot?.name||s||r;for(await we("Feed from inventory",`Showing ${f.length} compatible crop(s) for ${m}. Select a crop to feed it immediately.`,"info");;){let g=await jC(2e4);if(g==null){await we("Feed from inventory","No crop selected.","info");break}if(g<0||g>=f.length){await we("Feed from inventory","Invalid crop selection.","error"),await bn().catch(()=>{});continue}let y=f[g],v=String(y?.id||"");if(!v){await we("Feed from inventory","Invalid crop selection.","error"),await bn().catch(()=>{});continue}let w=i;await Se.feedPet(r,v);let x=await yg(r,w,{initialDelay:200});x!=null&&(i=x);let E=x!=null?` Hunger: ${gg(x)}%.`:"",L=String(y?.species||"crop"),P=o?.slot?.name||s||r;if(await we("Feed from inventory",`Fed ${P} with ${L}.${E}`,"success"),x!=null&&x>=99.9){n=!0;try{await Rn()}catch{}break}let z=null;try{let S=await Se.getCropInventoryState();z=Array.isArray(S)?S:null}catch{z=null}let C=z?.filter(S=>{let G=String(S?.species||"");if(!G||!a.has(G))return!1;let se=String(S?.id||"");return se&&!d.has(se)})??null,D=()=>f.filter(S=>String(S?.id||"")!==v);if(C?C.some(G=>String(G?.id||"")===v)&&(C=D()):C=D(),f=C,!f.length){await we("Feed from inventory","No compatible crops in inventory.","info"),n=!0;try{await Rn()}catch{}break}h=p(f),await Wt({items:f,favoritedItemIds:h},{open:!1}),await bn().catch(()=>{})}}catch(r){console.error("[Pet panel] Failed to handle inventory feed",r),await we("Feed from inventory",r instanceof Error?r.message:"Failed to feed pet from inventory.","error")}finally{try{await bn()}catch{}if(n)try{await Rn()}catch{}t.disabled=e}}async function hg(){try{let t=await pe.pets.expandedPetSlotId.get(),e=typeof t=="string"?t.trim():"";return e.length?e:null}catch{return null}}async function uu(t){try{let e=await Te.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===t)??null}catch(e){return console.warn("[Pet panel] Failed to fetch pets",e),null}}async function qC(t,e){let n=Te.getCompatibleCropsForSpecies(e)??[];return new Set(n)}function gg(t){if(!Number.isFinite(t))return"";let e=Math.max(0,Math.min(100,t)),n=Math.round(e*10)/10;return Number.isInteger(n)?String(n):n.toFixed(1)}var DC=.05,BC=4e3,FC=120;function HC(t){if(!t||typeof t!="object")return!1;let e=t.slot;return!!e&&typeof e=="object"}function pu(t){if(!HC(t))return null;try{let e=Te.getHungerPctFor(t);return typeof e=="number"&&Number.isFinite(e)?e:null}catch{return null}}async function WC(t){try{let e=await uu(t);return pu(e)}catch{return null}}async function yg(t,e,n={}){let{initialDelay:r=0,timeout:o=BC,interval:s=FC}=n;r>0&&await fg(r);let i=typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now(),a=null;for(;;){let l=await WC(t);if(l!=null&&(a=l,e==null||l>=Math.min(100,e+DC)||l>=99.9))return l;if((typeof performance<"u"&&typeof performance.now=="function"?performance.now():Date.now())-i>=o)return a;s>0&&await fg(s)}}function fg(t){return new Promise(e=>setTimeout(e,t))}async function jC(t=2e4){let e=performance.now();for(;performance.now()-e<t;){try{let n=await pe.ui.activeModal.get();if(!Vi(n))return null}catch{return null}try{let n=await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();if(typeof n=="number"&&Number.isInteger(n)&&n>=0)return n}catch{}await new Promise(n=>setTimeout(n,80))}return null}var bg=t=>String(t??"").trim();function zC(t){let e=bg(t).toLowerCase();if(!e)return null;for(let n of Object.keys(Be))if(n.toLowerCase()===e)return n;return null}function vg(t){if(!t||typeof t!="object")return null;if(typeof t.baseSellPrice=="number"&&Number.isFinite(t.baseSellPrice))return t.baseSellPrice;for(let e of["produce","crop","item","items","data"])if(t[e]){let n=vg(t[e]);if(n!=null)return n}try{let e=new Set,n=[t];for(;n.length;){let r=n.pop();if(!(!r||typeof r!="object"||e.has(r))){if(e.add(r),typeof r.baseSellPrice=="number"){let o=r.baseSellPrice;if(Number.isFinite(o))return o}for(let o of Object.values(r))o&&typeof o=="object"&&n.push(o)}}}catch{}return null}function wg(t){let e=zC(t);if(!e)return null;let n=Be[e],r=[n?.produce?.baseSellPrice,n?.crop?.baseSellPrice,n?.item?.baseSellPrice,n?.items?.Produce?.baseSellPrice].filter(o=>typeof o=="number"&&Number.isFinite(o));return r.length?r[0]:vg(n)}function UC(t,e="round"){switch(e){case"floor":return Math.floor(t);case"ceil":return Math.ceil(t);case"none":return t;case"round":default:return Math.round(t)}}function GC(t){return Number.isFinite(t)?1+(Math.max(1,Math.min(6,Math.floor(t)))-1)*.1:1}var KC={Gold:25,Rainbow:50},_a={Wet:2,Chilled:2,Frozen:10},La={Dawnlit:2,Dawnbound:3,Amberlit:5,Amberbound:6},VC={"Wet+Dawnlit":3,"Chilled+Dawnlit":3,"Wet+Dawnbound":4,"Chilled+Dawnbound":4,"Wet+Amberlit":6,"Chilled+Amberlit":6,"Wet+Amberbound":7,"Chilled+Amberbound":7,"Frozen+Dawnlit":11,"Frozen+Dawnbound":12,"Frozen+Amberlit":14,"Frozen+Amberbound":15};function YC(t){return t==="Gold"||t==="Rainbow"}function $C(t){return t==="Wet"||t==="Chilled"||t==="Frozen"}function JC(t){return t==="Dawnlit"||t==="Dawnbound"||t==="Amberlit"||t==="Amberbound"}function fu(t){let e=bg(t).toLowerCase();return e?e==="amberglow"||e==="ambershine"||e==="amberlight"?"Amberlit":e==="dawn"||e==="dawnlight"?"Dawnlit":e==="gold"?"Gold":e==="rainbow"?"Rainbow":e==="wet"?"Wet":e==="chilled"?"Chilled":e==="frozen"?"Frozen":e==="dawnlit"?"Dawnlit":e==="dawnbound"?"Dawnbound":e==="amberlit"?"Amberlit":e==="dawncharged"||e==="dawnradiant"||e==="dawn-radiant"||e==="dawn charged"?"Dawnbound":e==="amberbound"||e==="ambercharged"||e==="amberradiant"||e==="amber-radiant"||e==="amber charged"?"Amberbound":t:""}function QC(t){if(!Array.isArray(t))return 1;let e=1;for(let n of t){let r=fu(n);if(YC(r)){let o=KC[r];o>e&&(e=o)}}return e}function ZC(t){if(!Array.isArray(t))return null;let e=null;for(let n of t){let r=fu(n);if($C(r)){if(e==null){e=r;continue}_a[r]>_a[e]&&(e=r)}}return e}function XC(t){if(!Array.isArray(t))return null;let e=null;for(let n of t){let r=fu(n);if(JC(r)){if(e==null){e=r;continue}La[r]>La[e]&&(e=r)}}return e}function eT(t,e){if(!t&&!e)return 1;if(t&&!e)return _a[t];if(!t&&e)return La[e];let n=`${t}+${e}`,r=VC[n];return typeof r=="number"?r:Math.max(_a[t],La[e])}function tT(t){let e=QC(t),n=ZC(t),r=XC(t),o=eT(n,r);return e*o}function fr(t,e,n,r){let o=r?.getBasePrice??wg,s=r?.scaleTransform??((h,m)=>m),i=r?.rounding??"round",a=o(t);if(!(Number.isFinite(a)&&a>0))return 0;let l=Number(e);if(!Number.isFinite(l)||l<=0)return 0;let c=s(t,l);if(!Number.isFinite(c)||c<=0)return 0;let d=tT(n),u=GC(r?.friendPlayers),p=a*c*d*u;return Math.max(0,UC(p,i))}function Na(t,e,n){if(!t||t.itemType!=="Produce")return 0;let r=n==null?e:{...e,friendPlayers:n};return fr(t.species,t.scale,t.mutations,r)}function mu(t,e,n){if(!t)return 0;let r=n==null?e:{...e,friendPlayers:n};return fr(t.species,t.targetScale,t.mutations,r)}function hu(t,e,n){if(!t||t.objectType!=="plant"||!Array.isArray(t.slots))return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of t.slots)o+=mu(s,r);return o}function Sg(t,e,n){if(!Array.isArray(t))return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of t)s?.itemType==="Produce"&&(o+=Na(s,r));return o}function xg(t,e,n){if(!t||typeof t!="object")return 0;let r=n==null?e:{...e,friendPlayers:n},o=0;for(let s of Object.keys(t)){let i=t[s];i?.objectType==="plant"&&(o+=hu(i,r))}return o}var ks=Object.freeze({getBasePrice:wg,rounding:"round"});var Oa=t=>!!t&&t.objectType==="plant",nT=t=>Array.from({length:t},(e,n)=>n),Eg=(t,e,n)=>Math.max(e,Math.min(n,t));function Cg(){let t=null,e,n=null,r=null,o=null,s=new Set,i=()=>{for(let m of s)try{m()}catch{}},a=!1,l=()=>{a||(a=!0,requestAnimationFrame(()=>{a=!1,h()}))};function c(){let m=Array.isArray(t?.slots)?t.slots.length:0;return m?Array.isArray(n)&&n.length===m?n:nT(m):[]}function d(){if(!Oa(t))return 0;let m=t.slots??[],g=Array.isArray(m)?m.length:0;if(!g)return 0;let y=Number.isFinite(r)?r:0,v=Eg(y,0,g-1),x=c().indexOf(v);return x>=0?x:0}function u(){if(!Oa(t))return[];let m=Array.isArray(t.slots)?t.slots:[],g=c(),y=[];for(let v of g)m[v]!=null&&y.push(m[v]);return y}function p(){if(!Oa(t))return null;let m=u();if(!m.length)return null;let g=d(),y=m[Eg(g,0,m.length-1)],v=mu(y,ks,e);return Number.isFinite(v)&&v>0?v:null}function f(){if(!Oa(t))return null;let m=hu(t,ks,e);return Number.isFinite(m)&&m>0?m:null}function h(){let g=p()??f()??null;g!==o&&(o=g,i())}return(async()=>{try{t=await In.get()}catch{}try{e=await Bi.get()}catch{}try{let m=await An.get();n=Array.isArray(m)?m.slice():null}catch{}try{r=await kn.get()}catch{}Bi.onChange(m=>{e=m}),An.onChange(m=>{n=Array.isArray(m)?m.slice():null}),In.onChange(m=>{t=m,l()}),kn.onChange(m=>{r=Number.isFinite(m)?m:0,l()}),h()})(),{get(){return o},onChange(m){return s.add(m),()=>s.delete(m)},stop(){s.clear()}}}var gu={rootSelector:".McFlex.css-fsggty",innerSelector:".McFlex.css-1omaybc, .McFlex.css-1c3sifn",markerClass:"tm-crop-price"},rT=".McFlex.css-1omaybc",Tg="tm-crop-price-icon",kg="tm-crop-price-label",oT=":scope > .chakra-text.css-1uvlb8k",sT="css-115gc9o",Rg="\u{1F512}",iT="2px solid rgb(188, 53, 215)",aT="15px",bu="tm-locker-tooltip-lock-icon",lT="tmLockerOriginalColor",cT="tmLockerOriginalDisplay",dT="tmLockerOriginalAlign",Ig="tmLockerOriginalHtml",qa="tmLockerOriginalBorder",Da="tmLockerOriginalBorderRadius",Ba="tmLockerOriginalPosition",Fa="tmLockerOriginalOverflow",uT=new RegExp(`^${Rg}(?:\\u00A0|\\s|&nbsp;)*`);function _g(t={}){if(typeof window>"u"||typeof document>"u")return{stop(){},runOnce(){},isRunning:()=>!1};let e=t.rootSelector??gu.rootSelector,n=t.innerSelector??gu.innerSelector,r=t.markerClass??gu.markerClass,o=t.root??document,s=typeof t.log=="function"?t.log:t.log?(...m)=>console.debug("[AppendCropPrice/GO]",...m):()=>{},i=new Intl.NumberFormat("en-US"),a=m=>i.format(Math.max(0,Math.round(m))),l=!0,c=Cg(),d=null,u=null;try{d=dt.getCurrentSlotSnapshot().harvestAllowed??null}catch{d=null}let p=()=>{if(!l)return;let m=c.get(),g=m==null?"\u2014":a(m);Ag(o,e).forEach(y=>{Ag(y,n).forEach(v=>{if(pT(v,r)){mT(v,r),Mg(v,!1);return}Mg(v,d===!1),xT(v,g,r)})}),s("render",{value:m})};(()=>{try{u=dt.onSlotInfoChange(m=>{d=m.harvestAllowed??null,p()})}catch{u=null}})(),p();let h=c.onChange(()=>p());return{stop(){if(l){if(l=!1,h?.(),typeof u=="function")try{u()}catch{}c.stop(),s("stopped")}},runOnce(){p()},isRunning(){return l}}}function Ag(t,e){return Array.from(t.querySelectorAll(e))}function pT(t,e){return!(t instanceof Element)||!t.matches(rT)?!1:fT(t,e).length===1}function fT(t,e){return Array.from(t.children).filter(r=>!(r.tagName==="SPAN"&&r.classList.contains(e)))}function mT(t,e){t.querySelectorAll(`:scope > span.${CSS.escape(e)}`).forEach(r=>r.remove())}function Mg(t,e){if(!(t instanceof HTMLElement))return;t.querySelectorAll(":scope > span.tm-locker-lock-emoji").forEach(o=>o.remove());let n=t.querySelector(oT)??t.querySelector(":scope > .chakra-text"),r=t.closest(`.${sT}`);if(!e){n&&(Pg(n),hT(n)),r&&(bT(r),wT(r));return}n&&Pg(n),r&&(gT(r),yT(r),vT(r))}function hT(t){yu(t,lT,"color"),yu(t,cT,"display"),yu(t,dT,"align-items")}function Pg(t){let e=t.dataset[Ig];if(e!==void 0){t.innerHTML=e,delete t.dataset[Ig];return}let n=t.innerHTML,r=ST(n);r!==n&&(t.innerHTML=r)}function yu(t,e,n){let r=t.dataset,o=r[e];o!==void 0&&(o?t.style.setProperty(n,o):t.style.removeProperty(n),delete r[e])}function gT(t){t.dataset[qa]===void 0&&(t.dataset[qa]=t.style.border??""),t.dataset[Da]===void 0&&(t.dataset[Da]=t.style.borderRadius??""),t.dataset[Fa]===void 0&&(t.dataset[Fa]=t.style.overflow??"")}function yT(t){t.style.border=iT,t.style.borderRadius=aT,t.style.overflow="visible",(typeof window<"u"?window.getComputedStyle(t).position:t.style.position||"static")==="static"&&(t.dataset[Ba]===void 0&&(t.dataset[Ba]=t.style.position??""),t.style.position="relative")}function bT(t){let e=t.dataset[qa];e!==void 0?(e?t.style.border=e:t.style.removeProperty("border"),delete t.dataset[qa]):t.style.removeProperty("border");let n=t.dataset[Da];n!==void 0?(n?t.style.borderRadius=n:t.style.removeProperty("border-radius"),delete t.dataset[Da]):t.style.removeProperty("border-radius");let r=t.dataset[Fa];r!==void 0?(r?t.style.overflow=r:t.style.removeProperty("overflow"),delete t.dataset[Fa]):t.style.removeProperty("overflow");let o=t.dataset[Ba];o!==void 0?(o?t.style.position=o:t.style.removeProperty("position"),delete t.dataset[Ba]):t.style.position==="relative"&&t.style.removeProperty("position")}function vT(t){let e=t.querySelector(`:scope > span.${bu}`);e||(e=document.createElement("span"),e.className=bu,t.append(e)),e.textContent=Rg,e.style.position="absolute",e.style.top="0",e.style.right="0",e.style.left="",e.style.transform="translate(50%, -50%)",e.style.fontSize="18px",e.style.padding="2px 8px",e.style.borderRadius="999px",e.style.border="none",e.style.background="transparent",e.style.color="white",e.style.pointerEvents="none",e.style.userSelect="none",e.style.zIndex="1"}function wT(t){t.querySelectorAll(`:scope > span.${bu}`).forEach(e=>e.remove())}function ST(t){return t.replace(uT,"")}function xT(t,e,n){let r=Array.from(t.querySelectorAll(`:scope > span.${CSS.escape(n)}`)),o=r[0]??null;for(let a=1;a<r.length;a++)r[a].remove();o||(o=document.createElement("span"),o.className=n),o.style.display="block",o.style.marginTop="6px",o.style.fontWeight="700",o.style.color="#FFD84D",o.style.fontSize="14px";let s=o.querySelector(`:scope > img.${Tg}`);s||(s=document.createElement("img"),s.className=Tg,s.alt="",s.setAttribute("aria-hidden","true"),s.style.width="18px",s.style.height="18px",s.style.display="inline-block",s.style.verticalAlign="middle",s.style.marginRight="6px",s.style.userSelect="none",s.style.pointerEvents="none",o.insertBefore(s,o.firstChild)),s.src!==nr.img64&&(s.src=nr.img64);let i=o.querySelector(`:scope > span.${kg}`);i||(i=document.createElement("span"),i.className=kg,i.style.display="inline",o.appendChild(i)),i.textContent!==e&&(i.textContent=e),t.lastElementChild!==o&&t.appendChild(o)}function Ng(){let t=(()=>{try{return window.top!==window.self}catch{return!0}})(),e=TT(document.referrer),n=t&&!!e&&/(^|\.)discord(app)?\.com$/i.test(e),r=location.hostname,o=n?"discord":"web",s=/Android|iPhone|iPad|Mobile/i.test(navigator.userAgent)?"mobile":"desktop";return{surface:o,host:r,origin:location.origin,isInIframe:t,platform:s}}function Wn(){return Ng().surface==="discord"}function ET(t,e="info"){return`${location.origin}/api/rooms/${encodeURIComponent(t)}/${e}`}async function CT(t,e,n=1e4){let r=new AbortController,o=setTimeout(()=>r.abort(),n);try{let s=await fetch(t,{method:"GET",credentials:"include",headers:e,signal:r.signal}),i=await s.text();return{status:s.status,ok:s.ok,body:i}}finally{clearTimeout(o)}}function Lg(t,e,n=1e4){return new Promise((r,o)=>{if(typeof GM_xmlhttpRequest!="function"){o(new Error("GM_xmlhttpRequest is not available"));return}GM_xmlhttpRequest({method:"GET",url:t,headers:e,timeout:n,onload:s=>r({status:s.status,ok:s.status>=200&&s.status<300,body:s.responseText}),onerror:s=>o(s),ontimeout:()=>o(new Error("GM_xmlhttpRequest timed out"))})})}async function Og(t,e={}){let n=e.endpoint??"info",r=ET(t,n),o={};e.jwt&&(o.Authorization=`Bearer ${e.jwt}`);let s;if(e.preferGM&&typeof GM_xmlhttpRequest=="function")s=await Lg(r,o,e.timeoutMs);else try{s=await CT(r,o,e.timeoutMs)}catch(a){if(typeof GM_xmlhttpRequest=="function")s=await Lg(r,o,e.timeoutMs);else throw a}let i;try{i=JSON.parse(s.body)}catch{}return{url:r,...s,parsed:i}}function TT(t){if(!t)return null;try{return new URL(t).hostname}catch{return null}}function qg(t){let e=new URLSearchParams(location.search),n=new URL(location.href);return n.pathname=`/r/${encodeURIComponent(t)}`,n.search=e.toString(),n.toString()}function kT(t){return qg(t)}function Dg(t,e={}){let r=Ng().surface==="discord",o=e.preferSoft??!r,s=e.hardIfSoftFails??!0;if(r){if(e.siteFallbackOnDiscord){let l=`https://magiccircle.gg/r/${encodeURIComponent(t)}`;return e.openInNewTab?window.open(l,"_blank","noopener,noreferrer"):location.assign(l),{ok:!0,mode:"site-fallback",url:l,message:"Discord activity does not support room switching by code, redirecting to the official site."}}return{ok:!1,mode:"discord-unsupported",message:"Discord activity does not support joining a room by code. Open the website or use an activity invite."}}let i=qg(t);if(o){try{let l=new URL(i);if(l.origin===location.origin)return history.replaceState({},"",l.pathname+(l.search||"")+(l.hash||"")),window.dispatchEvent(new PopStateEvent("popstate",{state:{}})),console.log("[joinRoom] soft \u2192",l.toString()),{ok:!0,mode:"soft",url:l.toString()}}catch{}if(!s)return{ok:!1,mode:"noop",url:i,message:"Soft navigation failed because the origins differ."}}let a=kT(t);return console.log("[joinRoom] hard \u2192",a),location.assign(a),{ok:!0,mode:"hard",url:a}}var Wg="Ariedam64",jg="MagicGarden-modMenu",zg="main",Bg="quinoa-ws.min.user.js",Fg=`https://raw.githubusercontent.com/${Wg}/${jg}`,IT=`https://api.github.com/repos/${Wg}/${jg}/commits/${zg}`;async function AT(t,e){let n=await fetch(t,{cache:"no-store",...e});if(!n.ok)throw new Error(`Failed to load remote resource: ${n.status} ${n.statusText}`);return await n.text()}async function Hg(t,e){return new Promise((n,r)=>{let o=typeof GM_xmlhttpRequest=="function"?GM_xmlhttpRequest:typeof GM<"u"&&typeof GM.xmlHttpRequest=="function"?GM.xmlHttpRequest:null;if(!o)return r(new Error("GM_xmlhttpRequest not available"));o({method:"GET",url:t,headers:e?.headers,onload:s=>{s.status>=200&&s.status<300?n(s.responseText):r(new Error(`GM_xhr failed: ${s.status}`))},onerror:s=>r(s)})})}async function Ug(t,e){let n=Wn(),r=typeof GM_xmlhttpRequest=="function"||typeof GM<"u"&&typeof GM.xmlHttpRequest=="function";if(n&&r)return await Hg(t,e);try{return await AT(t,e)}catch(o){if(r)return await Hg(t,e);throw o}}async function MT(){try{let t=await Ug(IT,{headers:{Accept:"application/vnd.github+json"}}),e=JSON.parse(t);if(e&&typeof e.sha=="string"&&e.sha.trim().length>0)return e.sha.trim()}catch(t){console.warn("[MagicGarden] Failed to resolve latest commit SHA:",t)}return null}async function PT(){let t=await MT(),e=t?`${Fg}/${t}/${Bg}`:`${Fg}/refs/heads/${zg}/${Bg}?t=${Date.now()}`;return await Ug(e)}async function vu(){try{let t=await PT(),e=RT(t);if(!e)throw new Error("Metadata block not found in remote script");let n=e.get("version")?.[0],r=e.get("downloadurl")?.[0]??e.get("updateurl")?.[0];return{version:n,download:r}}catch(t){return console.error("Unable to retrieve remote version:",t),null}}function RT(t){let e=t.match(/\/\/ ==UserScript==([\s\S]*?)\/\/ ==\/UserScript==/);if(!e)return null;let r=e[1].matchAll(/^\/\/\s*@([^\s]+)\s+(.+)$/gm),o=new Map;for(let[,s,i]of r){let a=s.trim().toLowerCase(),l=i.trim();if(!a)continue;let c=o.get(a);c?c.push(l):o.set(a,[l])}return o}function wu(){if(typeof GM_info<"u"&&GM_info?.script?.version)return GM_info.script.version}async function Gg(){let t=await vu(),e=wu();console.log(e?`[MagicGarden] Local version: ${e}`:"[MagicGarden] Local version: unknown"),t?.version?console.log(`[MagicGarden] Remote version: ${t.version}`):console.log("[MagicGarden] Remote version: unavailable")}var Kg=!1,ja=[],mr=null,Wa,Eu=null,Su=null,Ha=null;function $g(){if(typeof document>"u")return null;let t=document.querySelector("button.chakra-button.css-1f6o5y1");return t||(Array.from(document.querySelectorAll("button.chakra-button.css-h3d7a8")).find(n=>(n.textContent??"").includes("Grow"))??null)}function Cu(t,e){let n=t.querySelector(".css-telpzl"),r=()=>{let l=t.cloneNode(!0);return l.querySelectorAll(".css-telpzl").forEach(c=>c.remove()),(l.textContent??"").replace(/\s+/g," ").trim()},o=()=>{let l=t.dataset.baseLabel??"",c=t.dataset.lastQuantity,d=r(),u=(()=>{if(!d)return"";if(c&&c.length>0){let p=` \xD7${c}`;if(d.endsWith(p))return d.slice(0,-p.length).replace(/\s+$/,"");let f=`\xD7${c}`;if(d.endsWith(f))return d.slice(0,-f.length).replace(/\s+$/,"")}return d})();return u&&u!==l||!l&&u?(t.dataset.baseLabel=u,u):l},s=l=>{let c=Array.from(t.childNodes).find(u=>n&&u===n?!1:(u.textContent??"").trim().length>0);if(c){c.textContent=l;return}let d=n??t.firstChild;t.insertBefore(document.createTextNode(l),d??null)},i=o();if(n&&(n.textContent="",n.style.marginLeft="",n.style.display="none"),e==null){t.dataset.lastQuantity="",s(i);return}let a=i?`${i} \xD7${e}`:`\xD7${e}`;t.dataset.lastQuantity=String(e),s(a)}function Jg(t){typeof IntersectionObserver>"u"||(Ha?Ha.disconnect():Ha=new IntersectionObserver(e=>{e.filter(n=>n.isIntersecting).forEach(n=>{Cu(n.target,Eu)})}),Ha.observe(t))}function _T(){if(typeof document>"u"||Su||typeof MutationObserver>"u")return;let t=document.body;t&&(Su=new MutationObserver(()=>{let e=$g();e&&(Jg(e),Cu(e,Eu))}),Su.observe(t,{childList:!0,subtree:!0}))}function Vg(t){if(typeof document>"u")return;Eu=t;let e=$g();if(!e){_T();return}Jg(e),Cu(e,t)}function Yg(t){return!t||!Array.isArray(t.items)?[]:t.items.slice()}function LT(t){if(t==null||t<0||t>=ja.length)return null;let e=ja[t];if(!e)return null;let n=Number(e.quantity);return Number.isFinite(n)?n:null}function xu(t=!1){if(mr==null){Vg(null),Wa=null;return}let e=LT(mr);!t&&e===Wa||(e==null?console.log(`[InventorySelection] Quantit\xE9 inconnue pour l'index ${mr}.`):console.log(`[InventorySelection] Quantit\xE9 de l'item s\xE9lectionn\xE9 (${mr}) : ${e}`),Vg(e),Wa=e)}async function NT(){try{return await pe.inventory.myInventory.get()}catch(t){return console.warn("[InventorySelection] Impossible de r\xE9cup\xE9rer l'inventaire",t),null}}async function OT(){try{let t=await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.get();return typeof t=="number"?t:null}catch(t){return console.warn("[InventorySelection] Impossible de r\xE9cup\xE9rer l'index s\xE9lectionn\xE9",t),null}}async function Qg(){if(!Kg){Kg=!0,ja=Yg(await NT()),mr=await OT(),xu(!0);try{await pe.inventory.myInventory.onChange(t=>{ja=Yg(t),xu()})}catch(t){console.warn("[InventorySelection] \xC9chec de l'abonnement \xE0 myInventory",t)}try{await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.onChange(t=>{typeof t=="number"?mr=t:mr=null,Wa=null,xu(!0)})}catch(t){console.warn("[InventorySelection] \xC9chec de l'abonnement \xE0 myPossiblyNoLongerValidSelectedItemIndex",t)}}}var qT=3600,Zg=30,DT=30,Tu=t=>t?ot[t]??null:null,BT=t=>t?Wi[t]??null:null,Xg=t=>{let e=t?.targetScale;return typeof e=="number"&&Number.isFinite(e)?e:1},FT=t=>{let e=t?.xp;return typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):0},ku=t=>{let e=Tu(t?.petSpecies??"");if(!e)return 0;let n=typeof e.maxScale=="number"&&e.maxScale>1?e.maxScale:1,r=Xg(t),s=(n>1?(r-1)/(n-1):0)*20+80,i=Math.floor(Number.isFinite(s)?s:0);return Math.max(i,0)},HT=t=>{let e=t-DT;return Math.max(e,0)},ey=t=>{let e=Tu(t?.petSpecies??"");if(!e)return 0;let n=typeof e.hoursToMature=="number"&&e.hoursToMature>0?e.hoursToMature:1,r=ku(t);if(r<=0)return 0;let o=FT(t)/(n*qT),s=Math.min(Math.floor(o*Zg),Zg),i=HT(r),a=Math.min(i+s,r);return Math.max(a,0)},ty=t=>(Array.isArray(t?.mutations)?t.mutations:[]).reduce((n,r)=>{let s=BT(r)?.coinMultiplier;return typeof s=="number"&&Number.isFinite(s)&&s>0?n*s:n},1),WT=t=>{let e=Tu(t?.petSpecies??"");if(!e)return 0;let n=typeof e.maturitySellPrice=="number"?e.maturitySellPrice:0,r=ku(t);if(r<=0)return 0;let o=ey(t),s=Xg(t),i=ty(t),a=n*(o/r)*s*i;return Number.isFinite(a)?Math.round(Math.max(a,0)):0},Iu=t=>({value:WT(t),strength:ey(t),maxStrength:ku(t),coinMultiplier:ty(t)});var ry=[{itemType:"Seed",identifierKey:"species",resolveCoinPrice:t=>{if(!t)return null;let n=Be[t]?.seed?.coinPrice;return uo(n)},logKey:"seeds",emptyLogMessage:"[InventorySorting] Aucune seed trouv\xE9e dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({species:t,quantity:e,coinPrice:n,value:r})},{itemType:"Tool",identifierKey:"toolId",resolveCoinPrice:t=>{if(!t)return null;let n=Rt[t]?.coinPrice;return uo(n)},logKey:"tools",emptyLogMessage:"[InventorySorting] Aucun tool trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({toolId:t,quantity:e,coinPrice:n,value:r})},{itemType:"Egg",identifierKey:"eggId",resolveCoinPrice:t=>{if(!t)return null;let n=Pt[t]?.coinPrice;return uo(n)},logKey:"eggs",emptyLogMessage:"[InventorySorting] Aucun egg trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({eggId:t,quantity:e,coinPrice:n,value:r})},{itemType:"Decor",identifierKey:"decorId",resolveCoinPrice:t=>{if(!t)return null;let n=_t[t]?.coinPrice;return uo(n)},logKey:"decors",emptyLogMessage:"[InventorySorting] Aucun decor trouv\xE9 dans l'inventaire pour le calcul de valeur.",createEntry:(t,e,n,r)=>({decorId:t,quantity:e,coinPrice:n,value:r})}],Is=null,za=null,jT=null,Au=0,Mu=new Set;function uo(t){if(typeof t=="number")return Number.isFinite(t)?t:null;if(typeof t=="string"&&t.trim()){let e=Number(t);return Number.isFinite(e)?e:null}return null}function zT(t){if(!t||typeof t!="object")return null;let e=t.items;return Array.isArray(e)?e:[]}function oy(t){if(typeof t=="string"){let e=t.trim();return e||null}return typeof t=="number"&&Number.isFinite(t)?String(t):null}function UT(t){return ry.find(e=>e.itemType===t)}function sy(t,e={}){if(!t||typeof t!="object")return null;let n=typeof t?.itemType=="string"?t.itemType.trim():"";if(!n)return null;switch(n){case"Pet":{let o=Iu(t).value;return typeof o=="number"&&Number.isFinite(o)?o:null}case"Plant":{let r=Array.isArray(t?.slots)?t.slots:[],o=e.playersInRoom??void 0,s=0;for(let i of r){let a=typeof i?.species=="string"?i.species:null,l=i?.targetScale,c=Number.isFinite(l)?l:Number(l),d=Number.isFinite(c)?c:null,u=Array.isArray(i?.mutations)?i.mutations.filter(f=>typeof f=="string"):[];if(!a||d==null)continue;let p=fr(a,d,u,{friendPlayers:o});typeof p=="number"&&Number.isFinite(p)&&(s+=p)}return s}case"Produce":{let r=e.playersInRoom??void 0,o=Na(t,void 0,r);return typeof o=="number"&&Number.isFinite(o)?o:null}default:{let r=UT(n);if(!r)return null;let o=oy(t?.[r.identifierKey]),s=uo(t?.quantity),i=r.resolveCoinPrice(o);if(s==null||i==null)return null;let a=i*s;return Number.isFinite(a)?a:null}}}function GT(t){let n=t.filter(o=>(typeof o?.itemType=="string"?o.itemType.trim():"")==="Pet").map(o=>{let s=Iu(o),i=typeof o?.id=="string"?o.id:null,a=typeof o?.name=="string"&&o.name.trim()?o.name:null,l=typeof o?.petSpecies=="string"?o.petSpecies:null;return{id:i,name:a,petSpecies:l,value:s.value,strength:s.strength,maxStrength:s.maxStrength,coinMultiplier:s.coinMultiplier}});return{totalValue:n.reduce((o,s)=>o+(Number.isFinite(s.value)?s.value:0),0),pets:n}}function KT(t,e){let r=t.filter(s=>(typeof s?.itemType=="string"?s.itemType.trim():"")==="Plant").map(s=>{let i=typeof s?.id=="string"?s.id:null,a=typeof s?.species=="string"?s.species:null,l=Number.isFinite(s?.plantedAt)?s.plantedAt:null,c=Number.isFinite(s?.maturedAt)?s.maturedAt:null,u=(Array.isArray(s?.slots)?s.slots:[]).map(f=>{let h=typeof f?.species=="string"?f.species:null,m=f?.targetScale,g=Number.isFinite(m)?m:Number(m),y=Number.isFinite(g)?g:null,v=Array.isArray(f?.mutations)?f.mutations.filter(x=>typeof x=="string"):[],w=h&&y!=null?fr(h,y,v,{friendPlayers:e}):0;return{species:h,targetScale:y,mutations:v,value:w}}),p=u.reduce((f,h)=>f+(Number.isFinite(h.value)?h.value:0),0);return{id:i,species:a,plantedAt:l,maturedAt:c,value:p,slots:u}});return{totalValue:r.reduce((s,i)=>s+(Number.isFinite(i.value)?i.value:0),0),playersInRoom:Number.isFinite(e)?e:null,plants:r}}function VT(t,e){let r=t.filter(s=>(typeof s?.itemType=="string"?s.itemType.trim():"")==="Produce").map(s=>{let i=typeof s?.id=="string"?s.id:null,a=typeof s?.species=="string"?s.species:null,l=s?.scale,c=Number.isFinite(l)?l:Number(l),d=Number.isFinite(c)?c:null,u=Array.isArray(s?.mutations)?s.mutations.filter(f=>typeof f=="string"):[],p=Na(s,void 0,e);return{id:i,species:a,scale:d,mutations:u,value:p}});return{totalValue:r.reduce((s,i)=>s+(Number.isFinite(i.value)?i.value:0),0),crops:r}}function YT(t){let e={seeds:{totalValue:0,items:[]},tools:{totalValue:0,items:[]},eggs:{totalValue:0,items:[]},decors:{totalValue:0,items:[]}};for(let n of ry){let o=t.filter(i=>(typeof i?.itemType=="string"?i.itemType.trim():"")===n.itemType).map(i=>{let a=i?.[n.identifierKey],l=oy(a),c=i?.quantity,d=uo(c),u=n.resolveCoinPrice(l),p=d!=null&&u!=null?u*d:null;return n.createEntry(l,d,u,p)}),s=o.reduce((i,a)=>{let l=a.value;return typeof l=="number"&&Number.isFinite(l)?i+l:i},0);e[n.logKey]={totalValue:s,items:o}}return e}async function $T(){try{let t=await pe.server.numPlayers.get();return Number.isFinite(t)?t:void 0}catch{return}}async function JT(t){let e=zT(t);if(e===null)return null;let n=e??[],r=await $T();return{pets:GT(n),plants:KT(n,r),crops:VT(n,r),misc:YT(n)}}function QT(t){for(let e of Mu)try{e(t)}catch(n){console.warn("[InventoryValue] Listener error",n)}}async function ny(t){let e=++Au;try{let n=await JT(t);if(e!==Au)return;Is=n,QT(Is)}catch(n){if(e!==Au)return;Is=null,console.warn("[InventoryValue] Impossible de calculer la valeur de l'inventaire",n)}}async function iy(){return za||(za=(async()=>{try{let t=await pe.inventory.myInventory.get();await ny(t)}catch(t){Is=null,console.warn("[InventoryValue] Impossible de r\xE9cup\xE9rer l'inventaire initial",t)}try{jT=await pe.inventory.myInventory.onChange(t=>{ny(t)})}catch(t){console.warn("[InventoryValue] Impossible de s'abonner \xE0 myInventory",t)}})(),za)}function ay(){return Is}function ly(t){return Mu.add(t),()=>{Mu.delete(t)}}var Ty={gridSelector:"div.McGrid.css-tqc83y",filtersBlockSelector:".McGrid.css-o1vp12",closeButtonSelector:"button.css-vuqwsg",checkboxSelector:"label.chakra-checkbox.css-1v6h4z7",checkboxLabelSelector:".chakra-checkbox__label",injectDarkStyles:!0},ky="input.chakra-input.css-8e1l1i";var Pu=["alpha","qty","rarity","value"],Iy=["none","alpha","qty","rarity","value","size","mutations","strength"],Ay="mg-mod.inventory.sortKey",ZT=new Set(Iy),My="mg-mod.inventory.sortDirection",XT=new Set(["asc","desc"]),Py="Order:",ek={asc:"Ascending",desc:"Descending"},cy=t=>{if(typeof t!="string")return null;let e=t.trim();if(!e)return null;let r=(xt[e]??null)?.name;if(typeof r!="string")return null;let o=r.trim();return o||null},Ry="mg-mod.inventory.showValues",tk=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(Ry)??null;return t==="1"?!0:t==="0"?!1:null}catch(t){return console.warn("[InventorySorting] Impossible de lire la pr\xE9f\xE9rence d'affichage des valeurs d'inventaire",t),null}},nk=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(Ry,t?"1":"0")}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder la pr\xE9f\xE9rence d'affichage des valeurs d'inventaire",e)}},_y=!0,As=t=>{_y=t},rk=()=>_y,po={none:"asc",alpha:"asc",qty:"desc",rarity:"asc",value:"desc",size:"desc",mutations:"desc",strength:"desc"},un=["asc","desc"],ok=t=>typeof t=="string"&&ZT.has(t),sk=t=>typeof t=="string"&&XT.has(t),ik=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(Ay)??null;return ok(t)?t:null}catch(t){return console.warn("[InventorySorting] Impossible de lire la valeur de tri persist\xE9e",t),null}},Ua=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(Ay,t)}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder la valeur de tri",e)}},ak=()=>{if(typeof window>"u")return null;try{let t=window.localStorage?.getItem(My)??null;return sk(t)?t:null}catch(t){return console.warn("[InventorySorting] Impossible de lire l'ordre de tri persist\xE9",t),null}},Ga=t=>{if(!(typeof window>"u"))try{window.localStorage?.setItem(My,t)}catch(e){console.warn("[InventorySorting] Impossible de sauvegarder l'ordre de tri",e)}},Ly={seed:[],tool:[],decor:[],crop:["size","mutations"],produce:["size","mutations"],plant:[],pet:["mutations","strength"]},Nu=new Map,Ou=new Set,lk=t=>(Ou.add(t),()=>{Ou.delete(t)}),ck=t=>{Ou.forEach(e=>{try{e(t)}catch(n){console.warn("[InventorySorting] Listener de contexte de filtre en erreur",n)}})},Ny={none:"None",alpha:"A\u2013Z",qty:"Quantity",rarity:"Rarity",value:"Values",size:"Size",mutations:"Mutations",strength:"Strength"},$a="tmInventoryBaseIndex",dk=".McFlex.css-ofw63c",uk=".McFlex.css-1p00rng",qu="tm-inventory-item-value",dy=`${qu}__text`,Ms="tmInventoryValue",Oy="\u2026",Ru="\u2014",uy="tm-value-toggle__summary-icon",py="tm-value-toggle__summary-text",Ka=(()=>{let t=nr?.img64??"";return typeof t!="string"||!t?"":t.startsWith("data:")?t:`data:image/png;base64,${t}`})();function fy(t){return t.map(e=>e.wrapper)}function pk(t,e){if(!t||t.length!==e.length)return!0;for(let n=0;n<e.length;n++)if(t[n]!==e[n].wrapper)return!0;return!1}var fk=(t,e=120)=>{let n;return(...r)=>{n&&window.clearTimeout(n),n=window.setTimeout(()=>t(...r),e)}};function mk(t){if(!t||!document.contains(t))return!1;let e=t.getBoundingClientRect(),n=getComputedStyle(t);return n.display==="none"||n.visibility==="hidden"||n.opacity==="0"?!1:e.width>0&&e.height>0}var hk=t=>t.matches("[data-checked]")||!!t.querySelector("[data-checked]"),wt=t=>(t??"").trim().toLowerCase(),Fu=(t,e)=>{let n=t.map(o=>wt(o)).filter(o=>o&&o!=="all");n.sort();let r=wt(e);return`${n.join("|")}::${r}`},gk=(t,e)=>{if(t===e)return!0;if(!t||!e||t.size!==e.size)return!1;for(let n of t)if(!e.has(n))return!1;return!0},yk=t=>Nu.get(t)??null,bk=(t,e)=>{let n=Fu(t,e);return yk(n)},vk=(t,e)=>{let n=new Set;e.forEach(o=>{let s=wt(o);s&&n.add(s)});let r=Nu.get(t)??null;r&&gk(r,n)||(Nu.set(t,n),ck(t))},wk=t=>t?t.querySelector(ky)??null:null,Sk=t=>{let e=wk(t);return typeof e?.value=="string"?e.value:""},vn=t=>wt(Sk(t)),xk=async(t,e,n)=>{if(t)try{let r=await pe.inventory.myInventory.get();if(!r||typeof r!="object"){console.log("[InventorySorting] Inventaire introuvable pour le log de recherche.");return}let o=Array.isArray(r.items)?r.items:[],{filteredItems:s}=tl(o,e,n),i=Qa(t),a=i?Za(i):[];console.log("[InventorySorting] R\xE9sultats filtr\xE9s (recherche) :",s),console.log("[InventorySorting] Nombre d'\xE9l\xE9ments DOM pour la recherche :",a.length)}catch(r){console.warn("[InventorySorting] Impossible de journaliser les r\xE9sultats filtr\xE9s de la recherche",r)}},Du=[he.Common,he.Uncommon,he.Rare,he.Legendary,he.Mythic,he.Divine,he.Celestial].filter(Boolean),Ek=(()=>{let t=new Map;Du.forEach((n,r)=>{let o=wt(n);o&&t.set(o,r)});let e=t.get(wt(he.Mythic));return typeof e=="number"&&t.set(wt("Mythic"),e),t})(),my=t=>{let e=wt(t);return e?Ek.get(e)??Du.length:Du.length},Ck=["species","seedSpecies","plantSpecies","cropSpecies","baseSpecies","seedKey"],el=t=>t.toLowerCase().replace(/['’`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,""),Tk=(()=>{let t=new Map,e=(n,r)=>{if(typeof n!="string")return;let o=el(n.trim());!o||t.has(o)||t.set(o,r)};for(let[n,r]of Object.entries(Be)){let o=Number(r?.crop?.maxScale);!Number.isFinite(o)||o<=0||(e(n,o),e(r?.seed?.name,o),e(r?.plant?.name,o),e(r?.crop?.name,o))}return t})(),kk=t=>{if(typeof t!="string")return null;let e=el(t.trim());if(!e)return null;let n=Tk.get(e);return typeof n=="number"&&Number.isFinite(n)&&n>0?n:null},Ja=(t,e,n)=>Math.max(e,Math.min(n,t)),Ik=(t,e)=>{if(!Number.isFinite(t))return 50;let n=50,r=100,o=1,s=Math.max(o,t);if(typeof e=="number"&&Number.isFinite(e)&&e>o){let u=(Math.min(e,s)-o)/(e-o),p=n+u*(r-n);return Ja(Math.round(p),n,r)}let i=2,l=(Math.min(i,s)-o)/(i-o),c=n+l*(r-n);return Ja(Math.round(c),n,r)},_u=(t,e)=>{if(!(!t||typeof t!="object"))for(let n of Ck){let r=t[n];if(typeof r=="string"){let o=r.trim();o&&e.add(o)}}},Ak=(t,e)=>{if(!Number.isFinite(e))return null;let n=null;for(let r of t)if(n=kk(r),n!=null)break;return Ik(e,n)},hy=t=>{if(!t||typeof t!="object")return null;let e=new Set;_u(t,e),_u(t.item,e),_u(t.data,e);let r=(typeof t.itemType=="string"?t.itemType:"").trim();if(r==="Crop"||r==="Produce"){let o=Number(t.scale);return Ak(e,o)}return null},Ya=(t,e)=>{if(!t||typeof t!="object")return;let n=t.mutations;if(Array.isArray(n))for(let o of n)typeof o=="string"&&o.trim()&&e.push(o.trim());let r=t.slots;if(Array.isArray(r))for(let o of r)Ya(o,e)},gy=t=>{if(!t||typeof t!="object")return[];let e=[];return Ya(t,e),Ya(t.item,e),Ya(t.data,e),e},qy={crop:["Produce"],crops:["Produce"],produce:["Produce"],seed:["Seed"],seeds:["Seed"],plant:["Plant"],plants:["Plant"],pet:["Pet"],pets:["Pet"],tool:["Tool"],tools:["Tool"],decor:["Decor"],decors:["Decor"],decoration:["Decor"],decorations:["Decor"],egg:["Egg"],eggs:["Egg"]},Mk=(()=>{let t=new Map;for(let[n,r]of Object.entries(qy))for(let o of r){let s=wt(o);if(!s)continue;let i=t.get(s)??new Set;i.add(n),t.set(s,i)}let e={};return t.forEach((n,r)=>{e[r]=Array.from(n)}),e})(),Pk=(t,e)=>{if(!t)return[];let n=e[t];if(Array.isArray(n)&&n.length)return n;if(t.endsWith("s")){let r=t.slice(0,-1);if(r){let o=e[r];if(Array.isArray(o)&&o.length)return o}}return[]},Rk=(t,e)=>{let n=wt(t);if(!n)return[];let r=new Set,o=e[n];Array.isArray(o)&&o.forEach(i=>r.add(i));let s=Mk[n]??[];for(let i of s){let a=e[i];Array.isArray(a)&&a.forEach(l=>r.add(l))}return Array.from(r)};function _k(t){let e=wt(t);if(!e||e==="all")return[];let n=qy[e];if(n)return n;let r=e.endsWith("s")?e.slice(0,-1):e;if(!r)return[];let o=r.charAt(0).toUpperCase()+r.slice(1);return o?[o]:[]}function Lk(t,e){if(!e)return!0;let n=new Set,r=i=>{if(i==null)return!1;if(typeof i=="string")return wt(i).includes(e);if(typeof i=="number"||typeof i=="boolean")return wt(String(i)).includes(e);if(Array.isArray(i)){for(let a of i)if(r(a))return!0;return!1}if(typeof i=="object"){if(n.has(i))return!1;n.add(i);for(let[a,l]of Object.entries(i))if(a!=="itemType"){if(a==="abilities"){if(Array.isArray(l))for(let c of l){let d=cy(c);if(d&&r(d))return!0}continue}if(r(l))return!0}}return!1},o=Array.isArray(t?.abilities)?t.abilities.map(i=>cy(i)).filter(i=>typeof i=="string"&&!!i):[],s=[Bu(t),typeof t?.species=="string"?t.species:null,typeof t?.seedSpecies=="string"?t.seedSpecies:null,typeof t?.plantSpecies=="string"?t.plantSpecies:null,typeof t?.petSpecies=="string"?t.petSpecies:null,typeof t?.eggId=="string"?t.eggId:null,typeof t?.decorId=="string"?t.decorId:null,typeof t?.toolId=="string"?t.toolId:null,typeof t?.id=="string"?t.id:null,...o];for(let i of s)if(r(i))return!0;return r(t)}function Nk(t){let n=ay()?.plants?.playersInRoom??null;for(let r of t){if(!r||typeof r!="object")continue;let o=sy(r,{playersInRoom:n});r.value=o??null}}function tl(t,e,n){let r=e.map(p=>wt(p)).filter(Boolean),o=new Set,s=!1;for(let p of r){let f=_k(p);if(f.length){s=!0;for(let h of f)h&&o.add(h)}}let i=!s,a=i?t.slice():t.filter(p=>{let f=typeof p?.itemType=="string"?p.itemType.trim():"";return f?o.has(f):!1}),l=wt(n),c=l?a.filter(p=>Lk(p,l)):a;Nk(c);let d=new Set;for(let p of c){let f=typeof p?.itemType=="string"?p.itemType.trim():"";f&&d.add(f)}let u=Fu(e,l);return vk(u,d),{filteredItems:c,keepAll:i,itemTypes:o,detectedItemTypes:d}}function Qa(t){return t.querySelector(dk)}function Za(t){let e=[],n=Array.from(t.children);for(let r of n){if(!(r instanceof HTMLElement))continue;if(r.matches(".css-vmnhaw")){e.push({wrapper:r,card:r});continue}let o=r.querySelector(".css-vmnhaw");o instanceof HTMLElement&&e.push({wrapper:r,card:o})}return e}var Ok=[{threshold:1e12,suffix:"T"},{threshold:1e9,suffix:"B"},{threshold:1e6,suffix:"M"},{threshold:1e3,suffix:"K"}],Xa=typeof Intl<"u"&&typeof Intl.NumberFormat=="function"?new Intl.NumberFormat(void 0,{maximumFractionDigits:2,minimumFractionDigits:0}):null,Dy=t=>{let e=Math.abs(t);for(let{threshold:n,suffix:r}of Ok)if(e>=n)return`${(t/n).toFixed(1).replace(/\.0$/,"")}${r}`;return Xa?Xa.format(t):String(t)},By=t=>Xa?Xa.format(t):String(t),Fy=t=>{if(!t||typeof t!="object")return null;let e=t.value;if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e=="string"&&e.trim()){let n=Number(e);return Number.isFinite(n)?n:null}return null},qk=t=>t?t.__valueSummary??null??t.querySelector(".tm-value-toggle__summary"):null,Dk=t=>{if(t.style.gap||(t.style.gap="0.25rem"),Ka){let n=t.querySelector(`.${uy}`);n?n.src!==Ka&&(n.src=Ka):(n=document.createElement("img"),n.className=uy,n.alt="",n.decoding="async",n.src=Ka,Object.assign(n.style,{width:"1.2rem",height:"1.2rem",flexShrink:"0",objectFit:"contain"}),t.insertBefore(n,t.firstChild))}let e=t.querySelector(`.${py}`);return e||(e=document.createElement("span"),e.className=py,e.style.fontWeight="700",e.style.color="inherit",t.appendChild(e)),e},gr=(t,e,n)=>{if(!t)return;let r=Dk(t);r.textContent=e,n?t.title=n:t.removeAttribute("title")};async function yy(t,e,n){if(!t)return;let r=qk(t);if(!r)return;let o=Symbol("value-summary");t.__valueSummaryToken=o,gr(r,Oy);try{let s=await pe.inventory.myInventory.get();if(t.__valueSummaryToken!==o)return;if(!s||typeof s!="object"){gr(r,Ru);return}let i=Array.isArray(s.items)?s.items:[],{filteredItems:a}=tl(i,e,n);if(!a.length){gr(r,"0","0");return}let l=0,c=!1;for(let p of a){let f=Fy(p);typeof f=="number"&&Number.isFinite(f)&&(l+=f,c=!0)}if(!c){gr(r,Ru);return}let d=Dy(l),u=By(l);gr(r,d,u)}catch(s){if(console.warn("[InventorySorting] Impossible de calculer la valeur filtr\xE9e",s),t.__valueSummaryToken!==o)return;gr(r,Ru)}}function Bk(t,e){let n=t.querySelector(uk),r=t.dataset[Ms];if(!n){r!=null&&delete t.dataset[Ms];return}let o=n.querySelector(`.${qu}`);if(!rk()){o?.parentElement&&o.parentElement.removeChild(o),r!=null&&delete t.dataset[Ms];return}if(typeof e!="number"||!Number.isFinite(e)){o?.parentElement&&o.parentElement.removeChild(o),r!=null&&delete t.dataset[Ms];return}let s=Dy(e),i=By(e),a=o;a||(a=document.createElement("div"),a.className=qu),Object.assign(a.style,{fontSynthesis:"none",WebkitFontSmoothing:"antialiased",WebkitTextSizeAdjust:"100%",display:"inline-flex",alignItems:"center",justifyContent:"flex-start",gap:"0.15rem",marginTop:"3px",fontFamily:'var(--chakra-fonts-body, "GreyCliff CF", sans-serif)',fontWeight:"700",fontSize:"0.65rem",lineHeight:"1",textTransform:"none",color:"var(--chakra-colors-Yellow-Magic, #F3D32B)"});let l=a.querySelector(`.${dy}`);l||(a.textContent="",l=document.createElement("span"),l.className=dy,l.style.display="inline-flex",l.style.alignItems="center",l.style.color="inherit",a.appendChild(l)),l.textContent=s,a.title=i,t.dataset[Ms]=String(e),(a.parentElement!==n||a!==n.lastElementChild)&&n.appendChild(a)}function Fk(t){t.forEach((e,n)=>{e.wrapper.dataset[$a]=String(n),e.card.dataset[$a]=String(n)})}function Lu(t){let e=t.wrapper.dataset[$a]??t.card.dataset[$a];if(e==null)return null;let n=Number(e);return Number.isFinite(n)?n:null}var Ps=t=>typeof t=="string"?t.trim():"",Hk=(t,e)=>{let n=t;for(let r of e){if(!n||typeof n!="object")return"";n=n[r]}return Ps(n)},Hy=(t,e)=>{for(let n of e){let r=Hk(t,n);if(r)return r}return""},Wk=t=>Be[t],jk=t=>ot[t],zk=t=>Pt[t],Uk=t=>Rt[t],Gk=t=>_t[t],Kk=[["seed","name"],["plant","name"],["crop","name"]],Vk=[["seed","rarity"],["crop","rarity"],["plant","rarity"]],by=[["crop","name"],["plant","name"],["seed","name"]],vy=[["crop","rarity"],["plant","rarity"],["seed","rarity"]],Yk=[["plant","name"],["crop","name"],["seed","name"]],$k=[["plant","rarity"],["crop","rarity"],["seed","rarity"]],Va=(t,e,n)=>({identifierField:t,getEntry:Wk,getNamePaths:e,getRarityPaths:n}),Jk={Seed:Va("species",Kk,Vk),Crop:Va("species",by,vy),Produce:Va("species",by,vy),Plant:Va("species",Yk,$k),Pet:{identifierField:"petSpecies",getEntry:jk,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Egg:{identifierField:"eggId",getEntry:zk,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Tool:{identifierField:"toolId",getEntry:Uk,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]},Decor:{identifierField:"decorId",getEntry:Gk,getNamePaths:[["name"]],getRarityPaths:[["rarity"]]}},Wy=t=>Jk[t]??null,Bu=t=>{if(!t||typeof t!="object")return"";let e=Ps(t.itemType),n=Wy(e);if(n){let s=Rs(t,n.identifierField)??"";if(s){let i=n.getEntry(s),a=n.getNamePaths?Hy(i,n.getNamePaths):"";return a||s}}let r=Ps(t.name);if(r)return r;let o=Ps(t.id);return o||e},Qk=new Set(["Produce","Crop","Plant","Pet"]),wy=t=>{if(!t||typeof t!="object")return 0;let n=(typeof t.itemType=="string"?t.itemType:"").trim();if(Qk.has(n))return 1;let r=t.quantity,o=Number(r);return Number.isFinite(o)&&o>=0?o:0},Sy=t=>{if(!t||typeof t!="object")return"";let e=Ps(t.itemType),n=Wy(e);if(!n||!n.getRarityPaths?.length)return"";let r=Rs(t,n.identifierField)??"";if(!r)return"";let o=n.getEntry(r);return Hy(o,n.getRarityPaths)},jy=(t,e,n)=>{if(!t||typeof t!="object")return null;let r=[t,t.item,t.data];for(let o of r){if(!o||typeof o!="object")continue;let s=o[e],i=n(s);if(i!=null)return i}return null},Rs=(t,e)=>jy(t,e,n=>{if(typeof n!="string")return null;let r=n.trim();return r||null}),xy=(t,e)=>jy(t,e,n=>{if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"&&n.trim()){let r=Number(n);return Number.isFinite(r)?r:null}return null}),Zk=(()=>{let t=new Map,e=(n,r,o)=>{if(typeof n!="string")return;let s=el(n);!s||t.has(s)||t.set(s,{maxScale:r,hoursToMature:o})};for(let[n,r]of Object.entries(ot)){let o=Number(r?.maxScale),s=Number(r?.hoursToMature);!Number.isFinite(o)||o<=1||!Number.isFinite(s)||s<=0||(e(n,o,s),e(r?.name,o,s))}return t})(),Xk=t=>{if(typeof t!="string")return null;let e=el(t);return e?Zk.get(e)??null:null},Ey=t=>{if(!t||typeof t!="object"||(typeof t.itemType=="string"?t.itemType:"").trim()!=="Pet")return null;let r=xy(t,"xp"),o=typeof r=="number"&&Number.isFinite(r)?r:0,s=xy(t,"targetScale"),i=typeof s=="number"&&Number.isFinite(s)?s:1,a=new Set,l=Rs(t,"petSpecies");l&&a.add(l);let c=Rs(t,"species");c&&a.add(c);let d=Rs(t,"name");d&&a.add(d);let u=null;for(let L of a)if(u=Xk(L),u)break;if(!u)return null;let{maxScale:p,hoursToMature:f}=u;if(!Number.isFinite(p)||p<=1||!Number.isFinite(f)||f<=0)return null;let h=Math.max(0,o),m=f*3600,g=m>0?Math.min(Math.floor(h/m*30),30):0,y=1,v=Ja(i,y,p),w=p-y,x=w>0?Math.floor((v-y)/w*20+80):80,E=g+x-30;return Ja(E,0,100)},hr=(t,e)=>{let n=Bu(t),r=Bu(e);if(n&&r){let c=n.localeCompare(r,void 0,{sensitivity:"base"});if(c!==0)return c}if(!n&&r)return 1;if(n&&!r)return-1;let o=typeof t?.itemType=="string"?t.itemType:"",s=typeof e?.itemType=="string"?e.itemType:"",i=o.localeCompare(s,void 0,{sensitivity:"base"});if(i!==0)return i;let a=typeof t.id=="string"?t.id:"",l=typeof e.id=="string"?e.id:"";return a.localeCompare(l,void 0,{sensitivity:"base"})};function zy(t,e,n){let r=t.slice(),o=n==="desc";switch(e){case"alpha":r.sort((s,i)=>{let a=hr(s,i);return o?-a:a});break;case"qty":r.sort((s,i)=>{let a=wy(s),l=wy(i);if(a!==l){let c=a-l;return o?-c:c}return hr(s,i)});break;case"rarity":r.sort((s,i)=>{let a=Sy(s),l=Sy(i),c=my(a),d=my(l);if(c!==d){let p=c-d;return o?-p:p}let u=a.localeCompare(l,void 0,{sensitivity:"base"});return u!==0?u:hr(s,i)});break;case"value":r.sort((s,i)=>{let a=s?.value,l=i?.value,c=typeof a=="number"&&Number.isFinite(a),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&a!==l){let u=a-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:hr(s,i)});break;case"size":r.sort((s,i)=>{let a=hy(s),l=hy(i),c=typeof a=="number"&&Number.isFinite(a),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&a!==l){let u=a-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:hr(s,i)});break;case"mutations":r.sort((s,i)=>{let a=gy(s),l=gy(i),c=a.length,d=l.length;if(c!==d){let u=c-d;return o?-u:u}if(c>0&&d>0){let u=a.slice().sort((h,m)=>h.localeCompare(m,void 0,{sensitivity:"base"})).join("\0"),p=l.slice().sort((h,m)=>h.localeCompare(m,void 0,{sensitivity:"base"})).join("\0"),f=u.localeCompare(p,void 0,{sensitivity:"base"});if(f!==0)return f}return hr(s,i)});break;case"strength":r.sort((s,i)=>{let a=Ey(s),l=Ey(i),c=typeof a=="number"&&Number.isFinite(a),d=typeof l=="number"&&Number.isFinite(l);if(c&&d&&a!==l){let u=a-l;return o?-u:u}return c&&!d?o?-1:1:!c&&d?o?1:-1:hr(s,i)});break;default:break}return r}async function _s(t,e,n,r){try{let o=await pe.inventory.myInventory.get();if(!o||typeof o!="object"){console.log("[InventorySorting] Inventaire introuvable pour le log des filtres.");return}let s=Array.isArray(o.items)?o.items:[],{filteredItems:i,keepAll:a,itemTypes:l}=tl(s,t,r),c=e?(n&&un.includes(n)?n:po[e])??"asc":n&&un.includes(n)?n:"asc",d=e?zy(i,e,c):i.slice(),u=a?"toutes cat\xE9gories":`types: ${Array.from(l).join(", ")||"(aucun)"}`,p=e?`tri: ${e} (${c})`:"tri: (non sp\xE9cifi\xE9)",f=r?`recherche: "${r}"`:"recherche: (vide)";console.log(`[InventorySorting] myInventory filtr\xE9 (${u}, ${p}, ${f}).`)}catch(o){console.warn("[InventorySorting] Impossible de r\xE9cup\xE9rer myInventory pour le log",o)}}function eI(t){let e=new WeakMap,n=async(r,o,s,i)=>{let a=JSON.stringify({filters:o}),l=e.get(r),c=s.every(m=>Lu(m)!=null),d=l?l.searchQuery!==i:!1,u=l?l.entryCount!==s.length:!1,p=l?l.filtersKey!==a:!1,f=l?l.baseItems.length!==s.length:!1;if(l&&!(!l||p||u||f||!c||d)){l.entryByBaseIndex.clear();for(let m of s){let g=Lu(m);g!=null&&l.entryByBaseIndex.set(g,m)}return l.filtersKey=a,l.searchQuery=i,l.entryCount=s.length,l}try{let m=await pe.inventory.myInventory.get();if(!m||typeof m!="object")return console.log("[InventorySorting] Inventaire introuvable pour le tri DOM."),null;let g=Array.isArray(m.items)?m.items:[],{filteredItems:y}=tl(g,o,i);if(y.length!==s.length)return console.warn(`[InventorySorting] Nombre d'\xE9l\xE9ments filtr\xE9s (${y.length}) diff\xE9rent du DOM (${s.length}). R\xE9organisation annul\xE9e.`),null;Fk(s);let v={filtersKey:a,searchQuery:i,entryCount:s.length,baseItems:y.slice(),entryByBaseIndex:new Map};return s.forEach((w,x)=>{v.entryByBaseIndex.set(x,w)}),e.set(r,v),v}catch(m){return console.warn("[InventorySorting] Impossible de r\xE9cup\xE9rer myInventory pour le tri DOM",m),null}};return async(r,o,s)=>{if(typeof document>"u")return;let i=Qa(r);if(!i)return;let a=Za(i);if(!a.length)return;let l=dn(r,t.checkboxSelector,t.checkboxLabelSelector),c=vn(r),d=await n(r,l,a,c);if(!d)return;let u=new Map;d.baseItems.forEach((y,v)=>{u.set(y,v)});let p=s&&un.includes(s)?s:po[o]??"asc",f=!o||o==="none"?d.baseItems.slice():zy(d.baseItems,o,p),h=[],m=new Set;for(let y of f){let v=u.get(y);if(v==null)continue;let w=d.entryByBaseIndex.get(v);if(!w||m.has(w))continue;let x=Fy(y);Bk(w.card,x),h.push(w),m.add(w)}if(h.length!==a.length){console.warn(`[InventorySorting] Impossible de r\xE9ordonner l'inventaire : correspondances insuffisantes (${h.length}/${a.length}).`);return}let g=document.createDocumentFragment();h.forEach(y=>{g.appendChild(y.wrapper)}),i.appendChild(g),d.entryByBaseIndex.clear(),h.forEach(y=>{let v=Lu(y);v!=null&&d.entryByBaseIndex.set(v,y)})}}function dn(t,e,n){return Array.from(t.querySelectorAll(e)).filter(hk).map(r=>(r.querySelector(n)?.textContent??"").trim()).filter(Boolean)}function Cy(t,e=Ny,n=Ly,r=""){let o=t.map(h=>(h??"").trim().toLowerCase()).filter(Boolean),s=wt(r),i=h=>{if(!h.length)return null;let m=new Set(h[0]);for(let g=1;g<h.length;g++){let y=h[g];m=new Set([...m].filter(v=>y.has(v)))}return m},a=o.map(h=>new Set([...Pu,...Pk(h,n)])),l=bk(t,s),c=[];l&&l.size&&l.forEach(h=>{let m=Rk(h,n);c.push(new Set([...Pu,...m]))});let d=i(a),u=i(c),p=null;return d&&u?p=new Set([...d].filter(h=>u.has(h))):d?p=new Set(d):u&&(p=new Set(u)),(!p||!p.size)&&(p=new Set(Pu)),Iy.filter(h=>h==="none"||p.has(h)).map(h=>({value:h,label:e[h]||h}))}function Uy(){if(typeof navigator>"u")return!1;let t=navigator,e=t.userAgentData?.platform||t.platform||"";if(e&&/mac/i.test(e))return!0;let n=typeof t.userAgent=="string"?t.userAgent:"";return/mac os x/i.test(n)}function tI(){return!Uy()}function nI(t="inv-sort-dark-styles"){if(document.getElementById(t))return;let e=`
    .tm-sort-select {
      color: #e7eef7 !important;
      background-color: rgba(17,17,17,0.98) !important;
      border: 1px solid rgba(255,255,255,0.25) !important;
      outline: none !important;
      -webkit-appearance: none;
      appearance: none;
      color-scheme: dark;
      padding-right: 28px !important;
    }
    .tm-sort-select:focus { box-shadow: 0 0 0 2px rgba(122,162,255,.35); }
    .tm-sort-select option { color: #e7eef7; background-color: #111; }
    .tm-sort-select option:checked { background-color: #222; }
    .tm-sort-select option:hover   { background-color: #1a1a1a; }
    .tm-select-wrap { position: relative; display: inline-flex; align-items: center; }
    .tm-select-arrow {
      position: absolute; right: 10px; top: 50%;
      transform: translateY(-50%);
      pointer-events: none; display: inline-flex; align-items: center; justify-content: center;
    }
    .tm-select-arrow svg { display: block; }
  `,n=document.createElement("style");n.id=t,n.textContent=e,document.head.appendChild(n)}function rI(t){let e=document.createElement("div");e.className="tm-sort-wrap",Object.assign(e.style,{display:"block",width:"100%",margin:"0",padding:"0",position:"relative",flex:"0 0 auto",minHeight:"0",contain:"layout style"});let n=document.createElement("div");n.className="tm-sorting-bar",Object.assign(n.style,{display:"flex",alignItems:"center",flexWrap:"wrap",gap:"8px",marginTop:"10px",paddingTop:"8px",borderTop:"1px solid rgba(255,255,255,0.12)",width:"100%",boxSizing:"border-box",position:"relative",flex:"0 0 auto",height:"auto",minHeight:"0",maxHeight:"none",alignSelf:"stretch"});let r=document.createElement("span");r.textContent="Sort by:",Object.assign(r.style,{font:"inherit",opacity:"0.8",flex:"0 0 auto"});let o=document.createElement("div");o.className="tm-select-wrap";let s=document.createElement("select");s.className="tm-sort-select tm-sort-select--key",t&&(Object.assign(s.style,{padding:"6px 10px",border:"1px solid rgba(255,255,255,0.25)",borderRadius:"6px",background:"rgba(17,17,17,0.98)",color:"#e7eef7",cursor:"pointer",flex:"0 0 auto",width:"auto",outline:"none",appearance:"none"}),s.style.setProperty("-webkit-appearance","none"));let i=document.createElement("span");i.className="tm-select-arrow",i.innerHTML=`
    <svg width="12" height="8" viewBox="0 0 12 8" aria-hidden="true">
      <path d="M1 1l5 5 5-5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `,t?o.append(s,i):o.append(s),n.append(r,o);let a=document.createElement("span");a.className="tm-direction-label",a.textContent=Py,Object.assign(a.style,{font:"inherit",opacity:"0.8",flex:"0 0 auto"});let l=document.createElement("div");l.className="tm-select-wrap";let c=document.createElement("select");c.className="tm-sort-select tm-direction-select";let d=t&&!Uy();d&&(Object.assign(c.style,{padding:"6px 10px",border:"1px solid rgba(255,255,255,0.25)",borderRadius:"6px",background:"rgba(17,17,17,0.98)",color:"#e7eef7",cursor:"pointer",flex:"0 0 auto",width:"auto",outline:"none",appearance:"none"}),c.style.setProperty("-webkit-appearance","none"));let u=document.createElement("span");u.className="tm-select-arrow",u.innerHTML=`
    <svg width="12" height="8" viewBox="0 0 12 8" aria-hidden="true">
      <path d="M1 1l5 5 5-5" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  `,d?l.append(c,u):l.append(c),n.append(a,l);let p=document.createElement("span");p.className="tm-value-toggle__divider",Object.assign(p.style,{alignSelf:"stretch",width:"1px",minHeight:"24px",background:"rgba(255,255,255,0.15)",flex:"0 0 auto",opacity:"0.5"});let f=document.createElement("label");f.className="tm-value-toggle",Object.assign(f.style,{display:"inline-flex",alignItems:"center",gap:"8px",font:"inherit",opacity:"0.9",cursor:"pointer",flex:"0 0 auto"});let h=document.createElement("span");h.className="tm-value-toggle__control",Object.assign(h.style,{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"center",width:"36px",height:"20px",flex:"0 0 auto"});let m=document.createElement("input");m.type="checkbox",m.className="tm-value-toggle__checkbox",Object.assign(m.style,{position:"absolute",inset:"0",margin:"0",opacity:"0",cursor:"pointer"});let g=document.createElement("span");g.className="tm-value-toggle__switch",Object.assign(g.style,{position:"relative",display:"inline-flex",alignItems:"center",justifyContent:"flex-start",width:"100%",height:"100%",borderRadius:"999px",background:"rgba(255,255,255,0.25)",transition:"background 120ms ease",padding:"2px",boxSizing:"border-box"});let y=document.createElement("span");y.className="tm-value-toggle__thumb",Object.assign(y.style,{width:"16px",height:"16px",borderRadius:"50%",background:"#111",boxShadow:"0 1px 3px rgba(0,0,0,0.35)",transform:"translateX(0)",transition:"transform 120ms ease, background 120ms ease"}),g.appendChild(y),h.append(m,g);let v=document.createElement("span");v.className="tm-value-toggle__label",v.textContent="Show values",Object.assign(v.style,{font:"inherit",color:"inherit"}),f.append(h,v);let w=document.createElement("span");w.className="tm-value-toggle__summary",Object.assign(w.style,{font:"inherit",color:"var(--chakra-colors-Yellow-Magic, #F3D32B)",display:"inline-flex",alignItems:"center",justifyContent:"flex-end",flex:"1 1 auto",whiteSpace:"nowrap",marginLeft:"auto",textAlign:"right",gap:"0.25rem"}),gr(w,Oy),n.append(p,f,w);let x=E=>{g.style.background=E?"var(--chakra-colors-Yellow-Magic, #F3D32B)":"rgba(255,255,255,0.25)",y.style.transform=E?"translateX(16px)":"translateX(0)",f.setAttribute("data-checked",E?"true":"false"),f.setAttribute("role","switch"),f.setAttribute("aria-checked",E?"true":"false")};return m.addEventListener("change",()=>{x(m.checked)}),e.__syncValueToggle=x,x(m.checked),e.appendChild(n),{wrap:e,bar:n,select:s,directionSelect:c,directionLabel:a,valueToggleInput:m,valueToggleLabel:f,valueSummary:w}}function oI(t,e,n,r,o,s,i,a){let l=t.querySelector(e.filtersBlockSelector);if(!l)return null;let d=l.querySelector(e.closeButtonSelector)||t.querySelector(e.closeButtonSelector),u=l.querySelector(":scope > .tm-sort-wrap"),p,f,h=null,m=null,g=null;if(u){let v=u.querySelector("select.tm-sort-select--key"),w=u.querySelector("select.tm-direction-select");if(!v||!w)return null;p=v,f=w,h=u.querySelector(".tm-direction-label"),m=u.querySelector('label.tm-value-toggle input[type="checkbox"]'),g=u.querySelector(".tm-value-toggle__summary"),u.__valueSummary=g??null,h&&(h.textContent=o),d&&d.parentElement&&d.nextElementSibling!==u?d.insertAdjacentElement("afterend",u):!d&&u.parentElement!==l&&l.appendChild(u)}else{let v=rI(n);u=v.wrap,p=v.select,f=v.directionSelect,h=v.directionLabel,m=v.valueToggleInput,g=v.valueSummary,u.__grid=t,u.__valueSummary=g??null,d&&d.parentElement?d.insertAdjacentElement("afterend",u):l.appendChild(u),h&&(h.textContent=o),m&&(m.checked=i,m.addEventListener("change",()=>{let w=m?m.checked:!1;u.__showValues=w,a(w)})),p.addEventListener("change",()=>{let w=p.value;u.__prevValue=w;let x=f?.value||"asc",E=u.__grid,L=E?dn(E,e.checkboxSelector,e.checkboxLabelSelector):[],P=vn(E);console.log("[InventorySorting] Tri s\xE9lectionn\xE9 :",w),_s(L,w,x,P),s(w,x,L,P)}),f.addEventListener("change",()=>{let w=f.value;u.__prevDirection=w;let x=p?.value||"none",E=u.__grid,L=E?dn(E,e.checkboxSelector,e.checkboxLabelSelector):[],P=vn(E);console.log("[InventorySorting] Ordre de tri s\xE9lectionn\xE9 :",w),_s(L,x,w,P),s(x,w,L,P)})}m&&(m.checked=i);let y=u.__syncValueToggle;return y&&y(m?.checked??i),u.__grid=t,u.__showValues=m?.checked??i,{wrap:u,select:p,directionSelect:f,valueToggleInput:m,valueSummary:g}}function sI(t,e,n){let r=n??t.value;t.innerHTML="";for(let o of e){let s=document.createElement("option");s.value=o.value,s.textContent=o.label,t.appendChild(s)}e.some(o=>o.value==="none")&&(t.value="none"),r&&e.some(o=>o.value===r)&&r!=="none"&&(t.value=r)}function iI(t,e,n){let r=n??t.value??null;t.innerHTML="";for(let o of un){let s=document.createElement("option");s.value=o,s.textContent=e[o]??o,t.appendChild(s)}r&&un.includes(r)?t.value=r:t.value=un[0]}function aI(t={}){let e={...Ty,...t},n={...Ly,...e.mapExtraByFilter||{}},r={...Ny,...e.labelByValue||{}},o=e.directionLabel??Py,s={...ek,...e.directionLabelByValue||{}},i={...po,...e.defaultDirectionBySortKey||{}},a=tI();e.injectDarkStyles&&a&&nI();let l=e.applySorting??eI(e),c=tk()??!0;As(c);let d=null,u=null,p=null,f=null,h=null,m=null,g=null,y=null,v=null,w=null,x=!0,E=null,L=null,P=null,V=null,z=A=>{if(!A){E=null;return}let te=Qa(A);if(!te){E=null;return}let ne=Za(te);E=fy(ne)},C=(A,te,ne)=>Promise.resolve(l(A,te,ne)).then(()=>{z(A)}),D=new MutationObserver(A=>{A.some(ne=>ne.type==="attributes"?["data-checked","style","class","hidden","aria-hidden"].includes(ne.attributeName||""):ne.type==="childList")&&N()}),S=A=>{d!==A&&(D.disconnect(),d=A,g=null,y=null,v=null,E=null,L=null,V=null,x=!0,!d&&m&&(m(),m=null),!d&&P&&(P(),P=null),d&&D.observe(d,{subtree:!0,childList:!0,attributes:!0,attributeFilter:["data-checked","style","class","hidden","aria-hidden"]}))},G=new MutationObserver(()=>{let A=!!(d&&document.contains(d));!A&&d&&S(null);let te=A?d:null,ne=document.querySelector(e.gridSelector);ne!==te&&(S(ne),ne&&ue())}),se=()=>{if(d&&document.contains(d))return d;let A=document.querySelector(e.gridSelector);return A!==d&&S(A),d&&document.contains(d)?d:null},X=()=>{let A=se();if(!A)return;let te=p?.value??"none",ne=i[te]??po[te]??"asc",Z=f?.value??ne;C(A,te,Z)},ue=()=>{let A=se();if(!A||!mk(A)){x=!0;return}As(c),x&&(x=!1,iy().catch(de=>{console.warn("[InventorySorting] Impossible d'initialiser la surveillance de la valeur de l'inventaire",de)}));let te=oI(A,e,a,r,o,(de,ie,ge,be)=>{v=de,w=ie,y=JSON.stringify({filters:ge??[],search:be??""}),Ua(de),Ga(ie),e.onSortChange?.(de,ie),C(A,de,ie)},c,de=>{c=de,As(de),nk(de),h&&(h.checked=de),X()});if(!te)return;u=te.wrap,p=te.select,f=te.directionSelect,h=te.valueToggleInput??null,m||(m=ly(()=>{let de=se();if(!de||!u)return;let ie=dn(de,e.checkboxSelector,e.checkboxLabelSelector),ge=vn(de);yy(u,ie,ge)}));let ne=dn(A,e.checkboxSelector,e.checkboxLabelSelector),Z=Qa(A),me=Z?Za(Z):[],Q=V===null||V!==me.length,oe=Q||!p?.options?.length,W=Q||!f?.options?.length,U=pk(E,me),J=fy(me),B=vn(A);L=Fu(ne,B),P||(P=lk(de=>{de===L&&setTimeout(N,0)})),yy(u,ne,B);let O=JSON.stringify({filters:ne,search:B}),b=O!==y;if(O!==g){g=O,console.log("[InventorySorting] Filtres actifs :",ne);let de=p?.value??void 0,ie=f?.value??void 0;_s(ne,de,ie,B)}let M=Cy(ne,r,n,B),_=typeof u.__prevValue=="string"?u.__prevValue:null,k=ik(),T=(_&&M.some(de=>de.value===_)?_:null)||(k&&M.some(de=>de.value===k)?k:null);oe&&(sI(p,M,T),V=me.length),u.__prevValue=p.value;let F=p.value,$=typeof u.__prevDirection=="string"?u.__prevDirection:null,K=ak(),R=i[F]??po[F]??"asc",Y=($&&un.includes($)?$:null)||(K&&un.includes(K)?K:null)||R,re;f?(W&&iI(f,s,Y),Y&&un.includes(Y)&&f.value!==Y&&(f.value=Y),re=f.value,un.includes(re)||(re=R,f.value=R),u.__prevDirection=re):re=R,F!==v||re!==w||b&&U?(v=F,w=re,y=O,Ua(F),Ga(re),e.onSortChange?.(F,re),C(A,F,re)):(b&&(y=O,console.log("[InventorySorting] Filtres modifi\xE9s mais la liste DOM est inchang\xE9e, tri non r\xE9appliqu\xE9.")),E=J)},N=fk(ue,120),ee=A=>{let te=A.target;if(!te)return;let ne=te.closest(e.gridSelector),Z=se();if(A.type==="input"&&te instanceof HTMLInputElement&&te.matches(ky)&&ne&&ne===Z){console.log("[InventorySorting] Texte de recherche modifi\xE9 :",te.value);let me=dn(Z,e.checkboxSelector,e.checkboxLabelSelector),Q=vn(Z);xk(Z,me,Q)}ne&&ne===Z&&setTimeout(N,0)};return(()=>{let A=document.body||document.documentElement;A&&G.observe(A,{childList:!0,subtree:!0}),S(document.querySelector(e.gridSelector)),document.addEventListener("change",ee,!0),document.addEventListener("input",ee,!0),ue()})(),{destroy(){D.disconnect(),G.disconnect(),document.removeEventListener("change",ee,!0),document.removeEventListener("input",ee,!0),m&&(m(),m=null),P&&(P(),P=null),u&&u.parentElement&&u.parentElement.removeChild(u),u=null,p=null,f=null,h=null,d=null,g=null,y=null,v=null,w=null,x=!0,E=null},update:ue,getActiveFilters(){let A=se();return A?dn(A,e.checkboxSelector,e.checkboxLabelSelector):[]},getCurrentSortKey(){return p?.value??null},getCurrentSortDirection(){return f?.value??null},setSortKey(A){if(!p)return;p.value=A,u.__prevValue=A;let te=se();if(te){let ne=dn(te,e.checkboxSelector,e.checkboxLabelSelector),Z=vn(te),me=JSON.stringify({filters:ne,search:Z});console.log("[InventorySorting] Tri s\xE9lectionn\xE9 (programmatique) :",A);let Q=f?.value??i[A]??po[A]??"asc";f&&(f.value=Q,u.__prevDirection=Q),_s(ne,A,Q,Z),y=me,v=A,w=Q,Ua(A),Ga(Q),e.onSortChange?.(A,Q),As(c),C(te,A,Q)}},setSortDirection(A){if(!f)return;f.value=A,u.__prevDirection=A;let te=se(),ne=p?.value??"none";if(te){let Z=dn(te,e.checkboxSelector,e.checkboxLabelSelector),me=vn(te),Q=JSON.stringify({filters:Z,search:me});console.log("[InventorySorting] Ordre de tri s\xE9lectionn\xE9 (programmatique) :",A),_s(Z,ne,A,me),y=Q,v=ne,w=A,Ua(ne),Ga(A),e.onSortChange?.(ne,A),As(c),C(te,ne,A)}},getSortOptions(){let A=se(),te=A?dn(A,e.checkboxSelector,e.checkboxLabelSelector):[],ne=vn(A);return Cy(te,r,n,ne)},getGrid(){return se()}}}function Gy(t={}){if(typeof window>"u"||typeof document>"u")return{stop(){},refresh(){},getController(){return null}};let{waitForGrid:e=!0,log:n,...r}=t,o=r,s=null,i=null,a=null,l=typeof n=="function"?n:n?(...p)=>console.debug("[InventorySorting]",...p):()=>{},c=()=>{if(s)return s;if(e){let p=o.gridSelector??Ty.gridSelector;if(!document.querySelector(p))return null}return s=aI(o),l("attached"),s},d=()=>{if(s||i||!e)return;let p=document.body||document.documentElement;p&&(i=new MutationObserver(()=>{c()&&(i?.disconnect(),i=null,l("attached via mutation"))}),i.observe(p,{childList:!0,subtree:!0}))},u=()=>{c()||d()};return document.readyState==="loading"?(a=()=>{a=null,u()},document.addEventListener("DOMContentLoaded",a,{once:!0})):u(),{stop(){a&&(document.removeEventListener("DOMContentLoaded",a),a=null),i?.disconnect(),i=null,s?.destroy(),s=null},refresh(){s?s.update():u()},getController(){return s}}}var Yy={intervalMs:6e4,log:!1},Hu=t=>(t||"").replace(/\s+/g," ").trim(),lI=/game\s*update\s+ava?ilab?le/i,cI=/your\s+daily\s+bread/i,Xt=(t,...e)=>{t&&console.log("[checkModal]",...e)},Ky=!1,dI=t=>{Ky||(Ky=!0,Xt(t,"Game Update: \u267B\uFE0F rechargement de la page dans un instant..."),Re.setTimeout(()=>{Xt(t,"Game Update: \u{1F504} rechargement maintenant."),Re.location.reload()},500))},uI=t=>{if(!t||!(t instanceof HTMLElement))return!1;let e=t.getBoundingClientRect();if(e.width<=0||e.height<=0)return!1;let n=getComputedStyle(t);if(n.display==="none"||n.visibility==="hidden"||parseFloat(n.opacity)===0)return!1;let r=t;for(;r;){let o=getComputedStyle(r);if(o.display==="none"||o.visibility==="hidden")return!1;r=r.parentElement}return!0};function $y(){let t=document.querySelectorAll('section.chakra-modal__content[role="dialog"], section.chakra-modal__content[role="alertdialog"]');for(let e of t){let n=e.querySelector("header.chakra-modal__header"),r=Hu(n?.textContent||e.textContent||"");if(lI.test(r))return e}return null}function Jy(){let t=document.querySelectorAll('section.chakra-modal__content[role="dialog"], section.chakra-modal__content[role="alertdialog"]');for(let e of t){let n=Hu(e.textContent||"");if(!cI.test(n))continue;let r=e.querySelector("button.chakra-button.css-1o32am8");if(!r){let o=e.querySelectorAll("button");r=Array.from(o).find(s=>/claim/i.test(Hu(s.textContent)))??null}if(r)return{section:e,button:r}}return null}var Vy=new WeakSet;function pI(t,e){if(Vy.has(t))return Xt(e,"Bread: bouton d\xE9j\xE0 cliqu\xE9 (guard)."),!1;let n=t.getAttribute("aria-disabled");return t.disabled||n==="true"?(Xt(e,"Bread: bouton d\xE9sactiv\xE9."),!1):uI(t)?(t.click(),Vy.add(t),Xt(e,"Bread: \u2705 click() envoy\xE9."),!0):(Xt(e,"Bread: bouton non visible."),!1)}function Qy(t){let{log:e}={...Yy,...t},n=$y(),r=!!n;r&&(Xt(e,"Game Update: \u2705 d\xE9tect\xE9.",n),dI(e));let o=Jy(),s=!!o,i=!1;return o&&(Xt(e,"Daily Bread: \u2705 d\xE9tect\xE9.",o.section),i=pI(o.button,e)),!r&&!s&&Xt(e,"Rien d\xE9tect\xE9 pour l\u2019instant."),{gameUpdateFound:r,breadFound:s,breadClicked:i}}function Wu(t){let{intervalMs:e,log:n}={...Yy,...t},r=!1,o=()=>r?{gameUpdateFound:!1,breadFound:!1,breadClicked:!1}:Qy({log:n});o();let s=Re.setInterval(o,e),i=()=>{r||(r=!0,Re.clearInterval(s),Xt(n,"\u23F9\uFE0F Observateur arr\xEAt\xE9."))};return Xt(n,`\u25B6\uFE0F Observateur d\xE9marr\xE9 (intervalle: ${e} ms).`),{stop:i,tick:o}}var fI={startModalObserver:Wu,checkOnce:Qy,findGameUpdateModal:$y,findBreadModal:Jy};Mt("CheckModal",fI);function ju(t){let e="qws:pos",n="qws:collapsed",r="qws:hidden";if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>ju(t),{once:!0});return}let s=`
  :root{
    --qws-bg:        #0f1318;
    --qws-panel:     #111823cc;
    --qws-border:    #ffffff22;
    --qws-border-2:  #ffffff14;
    --qws-accent:    #7aa2ff;
    --qws-text:      #e7eef7;
    --qws-text-dim:  #b9c3cf;
    --qws-blur:      8px;
    --qws-shadow:    0 10px 36px rgba(0,0,0,.45);
  }

  /* ---------- HUD floating box ---------- */
  .qws2{
    position:fixed; right:16px; bottom:16px; z-index:999998;
    font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color:var(--qws-text);
    background:var(--qws-panel);
    border:1px solid var(--qws-border);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:var(--qws-shadow);
    backdrop-filter:blur(var(--qws-blur));
    min-width:160px;
    display:flex; flex-direction:column; gap:8px;
  }
  .qws2.hidden{ display:none }
  .qws2 .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .qws2 .col{ display:flex; flex-direction:column; gap:4px }
  .qws2 .title{ font-weight:700; letter-spacing:.2px }
  .qws2 .sp{ flex:1 }

  .qws2 .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 8px; border-radius:999px;
    border:1px solid #ffffff26;
    background:rgba(255,255,255,.06);
    color:var(--qws-text);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  }
  .qws2 .ok{   background:rgba(36, 161, 72, .20);  border-color:#48d17066 }
  .qws2 .warn{ background:rgba(241, 194, 27, .18); border-color:#ffd65c66 }
  .qws2 .bad{  background:rgba(218, 30, 40, .20);  border-color:#ff7c8666 }

  .qws2 .btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:6px 10px;
    background:linear-gradient(180deg, #ffffff12, #ffffff06);
    color:#fff;
    transition:transform .1s ease, background .18s ease, border-color .18s ease;
  }
  .qws2 .btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws2 .btn:active{ transform:translateY(1px) }
  .qws2 .drag{ cursor:move; opacity:.9 }

  .qws2 .mini{ display:none }
  .qws2.min .mini{ display:inline-flex }
  .qws2.min .body{ display:none }

  /* Launcher always shown */
  .qws-launch{ margin-top:4px; border-top:1px solid var(--qws-border); padding-top:6px; display:block }
  .qws-launch .launch-item{ display:flex; align-items:center; gap:8px; margin:4px 0 }
  .qws-launch .launch-item .name{ flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .qws-launch .launch-item .btn.active{
    background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.12));
    border-color:#9db7ff66;
  }

  /* ---------- Windows ---------- */
  .qws-win{
    position:fixed; z-index:999999; min-width:260px; max-width:900px; max-height:90vh; overflow:auto;
    background:var(--qws-panel); color:var(--qws-text);
    border:1px solid var(--qws-border); border-radius:12px;
    box-shadow:var(--qws-shadow); backdrop-filter:blur(var(--qws-blur));
  }
  .qws-win .w-head{
    display:flex; align-items:center; gap:8px; padding:10px 12px;
    border-bottom:1px solid var(--qws-border); cursor:move;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .qws-win .w-title{ font-weight:700 }
  .qws-win .sp{ flex:1 }
  .qws-win .w-btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:4px 8px; background:linear-gradient(180deg, #ffffff12, #ffffff06); color:#fff;
  }
  .qws-win .w-btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws-win .w-body{ padding:12px }

  /* Inputs inside windows */
  .qws-win input[type="text"], .qws-win input[type="number"]{
    width:120px; padding:8px 10px; border-radius:10px;
    border:1px solid var(--qws-border); background:rgba(0,0,0,.42); color:#fff;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  }
  .qws-win .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
  `,i=document.createElement("style");i.textContent=s,(document.documentElement||document.body).appendChild(i);let a=document.createElement("div");a.className="qws2",a.innerHTML=`
    <div class="row drag">
      <div class="title">Arie's Mod</div>
      <div class="sp"></div>
      <span id="qws2-status-mini" class="pill warn mini">\u2026</span>
      <button id="qws2-min" class="btn" title="Minimize/Expand">\u2013</button>
      <button id="qws2-hide" class="btn" title="Hide">\u2715</button>
    </div>

    <!-- Status & store side-by-side (no mode label) -->
    <div class="row" style="margin:2px 0 2px 0;">
      <span id="qws2-status" class="pill warn">status</span>
      <span id="qws2-version" class="pill warn">\u2026</span>
    </div>

    <div class="body">
      <div id="qws-launch" class="qws-launch"></div>
    </div>
  `,(document.documentElement||document.body).appendChild(a);let l=I=>{a.classList.toggle("hidden",I);try{localStorage.setItem(r,I?"1":"0")}catch{}return I},c=()=>l(!a.classList.contains("hidden")),d=!1,u=!1,p="gui.toggle",f="gui.drag",h=new Set,m=lt(p),g=lt(f),y=!1,v=(I,j)=>I===j||(I==="AltLeft"||I==="AltRight")&&(j==="AltLeft"||j==="AltRight")||(I==="ControlLeft"||I==="ControlRight")&&(j==="ControlLeft"||j==="ControlRight")||(I==="ShiftLeft"||I==="ShiftRight")&&(j==="ShiftLeft"||j==="ShiftRight")||(I==="MetaLeft"||I==="MetaRight")&&(j==="MetaLeft"||j==="MetaRight"),w=I=>{for(let j of h)if(v(I,j))return!0;return!1},x=(I,j)=>!j||!!j.ctrl!==I.ctrlKey||!!j.shift!==I.shiftKey||!!j.alt!==I.altKey||!!j.meta!==I.metaKey?!1:v(j.code,I.code),E=()=>{if(!g){y=!1;return}let I=w("AltLeft"),j=w("ControlLeft"),de=w("ShiftLeft"),ie=w("MetaLeft");if(!!g.alt!==I){y=!1;return}if(!!g.ctrl!==j){y=!1;return}if(!!g.shift!==de){y=!1;return}if(!!g.meta!==ie){y=!1;return}y=w(g.code)};E();let L=I=>I.code==="Insert"||I.key==="Insert",P=I=>{if(g&&y)return!0;let j="altKey"in I&&I.altKey,de="ctrlKey"in I&&I.ctrlKey,ie="metaKey"in I&&I.metaKey,ge="shiftKey"in I&&I.shiftKey,be=d&&!j&&!de&&!ie;return be&&!ge&&(u=!0),be&&!ge},V=I=>{if(!L(I))return;if(I.type==="keydown"){d||(u=!1),d=!0;return}let j=I.target,de=!!j&&(j.isContentEditable||/^(input|textarea|select)$/i.test(j.tagName)),ie=u;d=!1,u=!1,!ie&&!de&&(I.preventDefault(),c())};window.addEventListener("keydown",V,!0),window.addEventListener("keyup",V,!0),window.addEventListener("blur",()=>{d=!1,u=!1,h.clear(),E()},!0),document.addEventListener("visibilitychange",()=>{document.visibilityState!=="visible"&&(d=!1,u=!1,h.clear(),E())});function z(I){let j=I.getBoundingClientRect(),de=window.innerWidth,ie=window.innerHeight,ge=parseFloat(getComputedStyle(I).right)||de-j.right,be=parseFloat(getComputedStyle(I).bottom)||ie-j.bottom,ve=Math.max(8,de-j.width-8),le=Math.max(8,ie-j.height-8);ge=Math.min(Math.max(ge,8),ve),be=Math.min(Math.max(be,8),le),I.style.right=ge+"px",I.style.bottom=be+"px"}function C(I){z(I);let j=I.getBoundingClientRect(),ie=I.querySelector(".w-head")?.getBoundingClientRect()||j,ge=window.innerWidth,be=window.innerHeight,ve=8,le=parseFloat(getComputedStyle(I).right);Number.isNaN(le)&&(le=ge-j.right);let H=parseFloat(getComputedStyle(I).bottom);Number.isNaN(H)&&(H=be-j.bottom);let fe=Math.max(ve,ge-j.width-ve),ae=Math.max(ve,be-j.height-ve);if(ie.top<ve){let ye=ve-ie.top;H=Math.max(ve,Math.min(ae,H-ye))}if(j.left<ve){let ye=ve-j.left;le=Math.max(ve,Math.min(fe,le-ye))}I.style.right=le+"px",I.style.bottom=H+"px"}function D(I){I.style.right="16px",I.style.bottom="16px",C(I)}function S(I,j){let de=I.getBoundingClientRect(),ie=window.innerHeight,ge=parseFloat(getComputedStyle(I).bottom);Number.isNaN(ge)&&(ge=ie-de.bottom),j(),requestAnimationFrame(()=>{let be=I.getBoundingClientRect(),ve=be.top-de.top,le=ge+ve,H=Math.max(8,ie-be.height-8);le=Math.min(Math.max(8,le),H),I.style.bottom=le+"px",C(I)})}function G(){try{let I=parseFloat(a.style.right)||16,j=parseFloat(a.style.bottom)||16;localStorage.setItem(e,JSON.stringify({r:I,b:j}))}catch{}}try{let I=JSON.parse(localStorage.getItem(e)||"null");if(I&&typeof I.r=="number"&&typeof I.b=="number"&&(a.style.right=I.r+"px",a.style.bottom=I.b+"px"),localStorage.getItem(n)==="1"){a.classList.add("min");let j=a.querySelector("#qws2-min");j&&(j.textContent="+")}localStorage.getItem(r)==="1"&&a.classList.add("hidden"),requestAnimationFrame(()=>z(a)),window.addEventListener("resize",()=>z(a))}catch{}let se=a.querySelector(".drag"),X=a.querySelector("#qws2-min"),ue=a.querySelector("#qws2-hide"),N=a.querySelector("#qws2-status-mini"),ee=a.querySelector("#qws2-status"),q=a.querySelector("#qws2-version"),A=a.querySelector("#qws-launch");if(!se||!X||!ue||!N||!ee||!q||!A){console.warn("[QuinoaWS] HUD elements missing, abort init");return}let te=A,ne=()=>{let I=[];if(m){let j=am(p);j&&j!=="\u2014"&&I.push(j)}I.push("Insert"),ue.title=I.length?`Hide (${I.join(" / ")})`:"Hide"};ne(),an(p,I=>{m=I,ne()}),an(f,I=>{g=I,E()}),function(){let j=0,de=0,ie=0,ge=0,be=!1;se.addEventListener("mousedown",ve=>{be=!0,j=ve.clientX,de=ve.clientY;let le=a.getBoundingClientRect();ie=parseFloat(getComputedStyle(a).right)||window.innerWidth-le.right,ge=parseFloat(getComputedStyle(a).bottom)||window.innerHeight-le.bottom,document.body.style.userSelect="none"}),window.addEventListener("mousemove",ve=>{if(!be)return;let le=ve.clientX-j,H=ve.clientY-de,fe=ie-le,ae=ge-H,ye=a.getBoundingClientRect(),Ee=window.innerWidth,Ie=window.innerHeight,Oe=Math.max(8,Ee-ye.width-8),je=Math.max(8,Ie-ye.height-8);fe=Math.min(Math.max(fe,8),Oe),ae=Math.min(Math.max(ae,8),je),a.style.right=fe+"px",a.style.bottom=ae+"px"}),window.addEventListener("mouseup",()=>{be&&(be=!1,document.body.style.userSelect="",G())})}(),X.onclick=()=>{S(a,()=>{a.classList.toggle("min"),X.textContent=a.classList.contains("min")?"+":"\u2013";try{localStorage.setItem(n,a.classList.contains("min")?"1":"0")}catch{}})},ue.onclick=()=>{l(!0)},window.addEventListener("keydown",I=>{h.add(I.code),E();let j=I.target;j&&(j.isContentEditable||/^(input|textarea|select)$/i.test(j.tagName))||I.repeat||x(I,m)&&(d&&!I.altKey&&!I.ctrlKey&&!I.metaKey&&!I.shiftKey&&(u=!0),I.preventDefault(),c())},!0),window.addEventListener("keyup",I=>{h.delete(I.code),E()},!0);let Z=new Map,me=0;function Q(I,j,de){if(Z.has(I)){let ae=Z.get(I);ae.el.style.display="",U(ae.el),k(I,!0);return}let ie=document.createElement("div");ie.className="qws-win",ie.innerHTML=`
      <div class="w-head">
        <div class="w-title"></div>
        <div class="sp"></div>
        <button class="w-btn" data-act="min" title="Minimize/Expand">\u2013</button>
        <button class="w-btn" data-act="close" title="Close">\u2715</button>
      </div>
      <div class="w-body"></div>
    `,(document.documentElement||document.body).appendChild(ie);let ge=ie.querySelector(".w-head"),be=ie.querySelector(".w-title"),ve=ie.querySelector('[data-act="min"]'),le=ie.querySelector('[data-act="close"]'),H=ie.querySelector(".w-body");be.textContent=j;let fe=me++%5*24;ie.style.right=16+fe+"px",ie.style.bottom=16+fe+"px",z(ie),U(ie),function(){let ye=0,Ee=0,Ie=0,Oe=0,je=!1;ge.addEventListener("mousedown",Ne=>{if(Ne.target.closest(".w-btn"))return;je=!0,ye=Ne.clientX,Ee=Ne.clientY;let $e=ie.getBoundingClientRect();Ie=parseFloat(getComputedStyle(ie).right)||window.innerWidth-$e.right,Oe=parseFloat(getComputedStyle(ie).bottom)||window.innerHeight-$e.bottom,document.body.style.userSelect="none",U(ie)}),window.addEventListener("mousemove",Ne=>{if(!je)return;let Qe=Ne.clientX-ye,$e=Ne.clientY-Ee,ut=Ie-Qe,Ft=Oe-$e,Cn=ie.getBoundingClientRect(),Lo=window.innerWidth,Pi=window.innerHeight,No=Math.max(8,Lo-Cn.width-8),Dr=Math.max(8,Pi-Cn.height-8);ut=Math.min(Math.max(ut,8),No),Ft=Math.min(Math.max(Ft,8),Dr),ie.style.right=ut+"px",ie.style.bottom=Ft+"px"}),window.addEventListener("mouseup",()=>{je=!1,document.body.style.userSelect="",J(I,ie)})}(),ve.onclick=()=>{S(ie,()=>{let ae=H.style.display==="none";H.style.display=ae?"":"none",ve.textContent=ae?"\u2013":"+"})},le.onclick=()=>{ie.style.display="none",k(I,!1)},b(ie);try{de(H)}catch(ae){H.textContent=String(ae)}J(I,ie),Z.set(I,{id:I,el:ie,head:ge,body:H}),k(I,!0)}function oe(I){return I.style.display!=="none"}function W(I,j,de){let ie=Z.get(I);return ie?oe(ie.el)?(ie.el.style.display="none",k(I,!1),!1):(ie.el.style.display="",U(ie.el),C(ie.el),k(I,!0),!0):(Q(I,j,ge=>{let be=ge.closest(".qws-win");be&&B(I,be),de(ge)}),!0)}function U(I){let j=999999;Z.forEach(de=>{let ie=parseInt(getComputedStyle(de.el).zIndex||"999999",10);ie>j&&(j=ie)}),I.style.zIndex=String(j+1)}function J(I,j){try{let de=parseFloat(j.style.right)||16,ie=parseFloat(j.style.bottom)||16;localStorage.setItem(`qws:win:${I}:pos`,JSON.stringify({r:de,b:ie}))}catch{}}function B(I,j){try{let de=localStorage.getItem(`qws:win:${I}:pos`);if(!de)return;let ie=JSON.parse(de);typeof ie.r=="number"&&(j.style.right=ie.r+"px"),typeof ie.b=="number"&&(j.style.bottom=ie.b+"px"),C(j)}catch{}}window.addEventListener("resize",()=>{Z.forEach(I=>C(I.el))});function O(){let I=null,j=le=>{let H=le;return H&&H.closest?.(".qws-win, .qws2")||null},de=le=>{if(!P(le)||le.button!==0)return;let H=j(le.target);if(!H||H.style.display==="none")return;let fe=H.getBoundingClientRect(),ae=window.innerWidth,ye=window.innerHeight,Ee=parseFloat(getComputedStyle(H).right),Ie=parseFloat(getComputedStyle(H).bottom);Number.isNaN(Ee)&&(Ee=ae-fe.right),Number.isNaN(Ie)&&(Ie=ye-fe.bottom),I={el:H,sx:le.clientX,sy:le.clientY,or:Ee,ob:Ie},document.body.style.userSelect="none",U(H),le.preventDefault(),le.stopPropagation()},ie=le=>{if(!I)return;let H=le.clientX-I.sx,fe=le.clientY-I.sy,ae=I.or-H,ye=I.ob-fe,Ee=I.el.getBoundingClientRect(),Ie=window.innerWidth,Oe=window.innerHeight,je=Math.max(8,Ie-Ee.width-8),Ne=Math.max(8,Oe-Ee.height-8);ae=Math.min(Math.max(ae,8),je),ye=Math.min(Math.max(ye,8),Ne),I.el.style.right=`${ae}px`,I.el.style.bottom=`${ye}px`},ge=()=>{if(!I)return;document.body.style.userSelect="",z(I.el);let le=I.el,H=!1;Z.forEach(fe=>{fe.el===le&&!H&&(J(fe.id,le),H=!0)}),!H&&le===a&&G(),I=null},be=()=>ge(),ve=le=>{if(!g){ge();return}(x(le,g)||!y)&&ge()};window.addEventListener("mousedown",de,!0),window.addEventListener("mousemove",ie,!0),window.addEventListener("mouseup",be,!0),window.addEventListener("keyup",ve,!0)}function b(I){let j=ge=>{if(!ge||!(ge instanceof HTMLElement))return!1;if(ge instanceof HTMLTextAreaElement)return!0;if(ge instanceof HTMLInputElement){let be=(ge.type||"").toLowerCase();return be==="text"||be==="number"||be==="search"}return ge.isContentEditable===!0},de=ge=>{let be=ge.target,ve=document.activeElement,le=H=>!!(H&&(I.contains(H)||H.closest?.(".qws-win")||H.closest?.(".qws2")));(le(be)&&j(be)||le(ve)&&j(ve))&&(ge.stopPropagation(),ge.stopImmediatePropagation?.())},ie=["keydown","keypress","keyup"];return ie.forEach(ge=>{window.addEventListener(ge,de,{capture:!0}),document.addEventListener(ge,de,{capture:!0}),I.addEventListener(ge,de,{capture:!0})}),()=>{ie.forEach(ge=>{window.removeEventListener(ge,de,{capture:!0}),document.removeEventListener(ge,de,{capture:!0}),I.removeEventListener(ge,de,{capture:!0})})}}let M=[],_=new Map;function k(I,j){let de=_.get(I);de&&(de.textContent=j?"Close":"Open",de.dataset.open=j?"1":"0",j?de.classList.add("active"):de.classList.remove("active"))}function T(I,j,de){M.push({id:I,title:j,render:de}),F(I,j,de)}function F(I,j,de){let ie=document.createElement("div");ie.className="launch-item",ie.innerHTML=`<div class="name">${re(j)}</div>`;let ge=document.createElement("button");ge.className="btn",ge.textContent="Open",ge.dataset.open="0",_.set(I,ge),ge.onclick=()=>{let be=Z.get(I);be&&be.el.style.display!=="none"?(be.el.style.display="none",k(I,!1)):(Q(I,j,ve=>{let le=ve.closest(".qws-win");le&&B(I,le),de(ve)}),k(I,!0))},ie.appendChild(ge),A.appendChild(ie)}try{t?.onRegister?.(T)}catch{}b(a),O(),function(){let j=(ge,be)=>{q.textContent=ge,Y(q,be)},de=ge=>{ge?(q.dataset.download=ge,q.style.cursor="pointer",q.title="Download the new version"):(delete q.dataset.download,q.style.removeProperty("cursor"),q.removeAttribute("title"))};j("checking\u2026","warn"),de(null);let ie=ge=>{let be=Wn(),ve=globalThis.GM,le=typeof GM_openInTab=="function"?GM_openInTab:typeof ve?.openInTab=="function"?ve.openInTab.bind(ve):null;if(be&&le)try{le(ge,{active:!0,setParent:!0});return}catch(H){console.warn("[MagicGarden] GM_openInTab failed, falling back to window.open",H)}window.open(ge,"_blank","noopener,noreferrer")};q.addEventListener("click",()=>{let ge=q.dataset.download;ge&&ie(ge)}),(async()=>{let ge=wu();try{let be=await vu(),ve=be?.version?.trim();if(!ve){j(ge||"version inconnue","warn");return}if(!ge){j(ve,"warn"),de(be?.download||null);return}if(ge===ve){j(ge,"ok"),de(null);return}j(`${ge} \u2192 ${ve}`,"warn"),de(be?.download||null)}catch(be){console.error("[MagicGarden] Failed to check version:",be),j(ge||"Unknown","warn")}})()}(),(async()=>{try{await St()}catch{}})(),setInterval(()=>{let I=K(),j=R(),de=j.message==="store none",ie=I.level==="bad",ge=de&&ie?"bad":I.level==="ok"&&j.level==="ok"?"ok":"warn",be=`${I.message}, ${j.message}`;ee.textContent="status",ee.title=be,Y(ee,ge);let ve=ge==="ok"?"OK":ge==="warn"?"WARN":"ISSUES";N.textContent=ve,N.title=be,Y(N,ge)},800);function $(){for(let I=0;I<pt.length;I++)if(pt[I].readyState===ht.OPEN)return pt[I];throw new Error("no page ws")}function K(){try{return $(),{level:"ok",message:"ws open"}}catch{return!!window.__QWS_workerFound||Li?{level:"ok",message:"ws via worker"}:{level:"bad",message:"ws none"}}}function R(){try{let I=Fo(),j=of();return I?{level:"ok",message:`store ${j.via||"ready"}`}:j.via==="polyfill"||j.polyfill?{level:"warn",message:"store polyfill"}:{level:"bad",message:"store none"}}catch{return{level:"bad",message:"store error"}}}function Y(I,j){I.classList.remove("ok","warn","bad"),j&&I.classList.add(j)}function re(I){return I.replace(/[&<>"']/g,j=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[j])}}function Zy(){Nm(),zm(),im(),(async()=>{await Te.startAutofeedWatcher(()=>{}),await Xe.onQuantityChange("seeds",hs("seeds")),await Xe.onQuantityChange("tools",hs("tools")),await Xe.onQuantityChange("eggs",hs("eggs")),await Xe.onQuantityChange("decor",hs("decor"));try{ps(Te.getTeams())}catch{}try{await Te.onTeamsChangeNow(t=>{try{ps(t)}catch{}})}catch{}try{ma(async t=>{try{await Te.useTeam(t)}catch(e){console.warn("[Pets] hotkey useTeam failed:",e)}})}catch{}await Ae.syncNow().catch(()=>{}),await Se.onGardenDiffNow(async(t,e)=>{await Ae.syncNow().catch(()=>{}),dh([...e.added,...e.updated,...e.removed])}),await Te.startAbilityLogsWatcher(),await Jh(),ig(),lg(),_g(),Bm(),mg(),Qg(),Gy(),Wu({intervalMs:6e4,log:!0})})()}var mI="NoWeatherEffect",Xy=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728","\u{1F506}","\u{1F52E}"],cb=Object.entries(Be).map(([t,e])=>({key:t,seedName:e?.seed?.name??"",cropName:e?.crop?.name??""})),db=new Map,ub=new Map;cb.forEach((t,e)=>{let n=Xy[e%Xy.length];db.set(t.key,n),t.seedName&&ub.set(t.seedName,n)});var ol=()=>cb,qs=t=>{if(t)return db.get(t)??"\u2022"},Ds=t=>{if(t)return ub.get(t)??"\u2022"};function hI(t){let e=t.replace(/_/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return e?e.charAt(0).toUpperCase()+e.slice(1):t}var gI=jo??{},jn=Object.entries(Kt).filter(t=>{let[e,n]=t;return e==="Puddle"?!1:typeof n=="number"&&Number.isFinite(n)}).map(([t,e])=>({key:t,label:gI[t]??hI(t),tileRef:e})),yI=t=>{let e=Math.max(24,t?.size??48),n=Fe(document.createElement("div"),{width:`${e}px`,height:`${e}px`,display:"grid",placeItems:"center"}),r=Fe(document.createElement("span"),{color:"#ff5c5c",fontSize:`${Math.round(e*.65)}px`,fontWeight:"700",textShadow:"0 1px 2px rgba(0, 0, 0, 0.6)",lineHeight:"1"});return r.textContent="\u2716",n.appendChild(r),n};jn.unshift({key:mI,label:"No weather effect",tileRef:null,iconFactory:yI});var zu=t=>jn.some(e=>e.key===t),pb={Wet:"condition",Chilled:"condition",Frozen:"condition",Dawnlit:"lighting",Ambershine:"lighting",Dawncharged:"lighting",Ambercharged:"lighting"},bI={condition:["Wet","Chilled","Frozen"],lighting:["Dawnlit","Ambershine","Dawncharged","Ambercharged"]};function fb(t){t.forEach(e=>{zu(e)||t.delete(e)})}function rl(t){fb(t);let e=new Set;jn.forEach(n=>{if(!t.has(n.key))return;let r=pb[n.key];r&&(e.has(r)?t.delete(n.key):e.add(r))})}var Fe=(t,e)=>(Object.entries(e).forEach(([n,r])=>{t.style[n]=r}),t),sl=new Map,Ls=new Map,Bs=new Map,Hs=new WeakMap,eb=!1,il=!1,nl=null,vI=0;function wI(){try{if(ke.listPlants().length||ke.listAllPlants().length)return!0}catch{}try{if(ke.listTilesByCategory(/mutations/i).length)return!0}catch{}return!1}function yr(t=0){il||typeof window>"u"||(nl!=null&&window.clearTimeout(nl),nl=window.setTimeout(()=>{nl=null,AI()},Math.max(0,t)))}function mb(){eb||(eb=!0,window.addEventListener("mg:sprite-detected",()=>{sl.clear(),Ls.clear(),Array.from(Bs.keys()).forEach(e=>{Gu(e)})}))}function SI(t,e,n){let r=Bs.get(t);r||(r=new Set,Bs.set(t,r)),r.add(e),Hs.set(e,n)}function tb(t,e){let n=Bs.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Hs.delete(r);return}cl(r,e)}),n.size===0&&Bs.delete(t))}var xI=new Set(["Bamboo","Cactus"]);function EI(t){let e=new Set;try{ke.listPlants().forEach(s=>e.add(s))}catch{}try{ke.listAllPlants().forEach(s=>e.add(s))}catch{}let n=Array.from(e,s=>{let i=s.split(/[?#]/)[0]??s;return(i.split("/").pop()??i).replace(/\.[^.]+$/,"")});if(!t)return n;let r=n.map(s=>s.toLowerCase()),o=s=>n.filter((i,a)=>s(i,r[a]??i.toLowerCase()));if(xI.has(t)){let s=o((a,l)=>l==="tallplants");if(s.length)return s;let i=o((a,l)=>/tall/.test(a)||/tall/.test(l));if(i.length)return i}else{let s=o((a,l)=>l==="plants");if(s.length)return s;let i=o((a,l)=>!/tall/.test(a)&&!/tall/.test(l));if(i.length)return i}return n}function hb(t,e=[]){let n=typeof t=="number"&&Number.isFinite(t)?t:Number(t);if(!Number.isFinite(n))return null;if(n<=0)return n;let r=e.map(o=>o.toLowerCase());return r.some(o=>o.includes("tall"))||r.some(o=>o.includes("plants")),n-1}async function CI(t){let e=Be[t];if(!e)return null;let n=e?.crop?.tileRef??e?.plant?.tileRef??e?.seed?.tileRef,r=EI(t),o=hb(n,r);if(o==null)return null;for(let s of r)try{let a=(await ke.getTile(s,o,"canvas"))?.data;if(a&&a.width>0&&a.height>0){let l=document.createElement("canvas");l.width=a.width,l.height=a.height;let c=l.getContext("2d");if(!c)continue;return c.imageSmoothingEnabled=!1,c.drawImage(a,0,0),l.toDataURL()}}catch{}return null}function cl(t,e){let n=Hs.get(t);if(!n)return;let{size:r,fallback:o}=n;if(t.innerHTML="",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.width=`${r}px`,t.style.height=`${r}px`,t.style.flexShrink="0",t.style.position="relative",e){let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,s.style.width="100%",s.style.height="100%",s.style.objectFit="contain",s.style.imageRendering="pixelated",t.appendChild(s)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.8))}px`}function Gu(t){let e=sl.get(t);if(e!==void 0)return tb(t,e),Promise.resolve(e);let n=Ls.get(t);if(n)return n;let r=CI(t).then(o=>(sl.set(t,o),Ls.delete(t),tb(t,o),o)).catch(()=>(Ls.delete(t),null));return Ls.set(t,r),r}function al(t,e={}){mb();let n=Math.max(12,e.size??24),r=e.fallback??"\u{1F331}",o=document.createElement("span");SI(t,o,{size:n,fallback:r});let s=sl.get(t);return cl(o,s??null),Gu(t),o}var ll=new Map,Ns=new Map,Fs=new Map,nb=!1,Os=null;function gb(){nb||(nb=!0,window.addEventListener("mg:sprite-detected",()=>{ll.clear(),Ns.clear(),Os=null,Array.from(Fs.keys()).forEach(e=>{Ku(e)})}))}function TI(){if(Os)return Os;let t=new Set;try{ke.listTilesByCategory(/mutations/i).forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return e.length||e.push("mutations"),Os=e,Os}function kI(t,e,n){let r=Fs.get(t);r||(r=new Set,Fs.set(t,r)),r.add(e),Hs.set(e,n)}function rb(t,e){let n=Fs.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),Hs.delete(r);return}cl(r,e)}),n.size===0&&Fs.delete(t))}async function II(t){let e=jn.find(o=>o.key===t);if(!e||e.tileRef==null)return null;let[n]=TI(),r=hb(e.tileRef,n?[n]:[]);if(r==null||!n)return null;try{let s=(await ke.getTile(n,r,"canvas"))?.data;if(s&&s.width>0&&s.height>0){let i=document.createElement("canvas");i.width=s.width,i.height=s.height;let a=i.getContext("2d");return a?(a.imageSmoothingEnabled=!1,a.drawImage(s,0,0),i.toDataURL()):null}}catch{}return null}function Ku(t){let e=ll.get(t);if(e!==void 0)return rb(t,e),Promise.resolve(e);let n=Ns.get(t);if(n)return n;let r=II(t).then(o=>(ll.set(t,o),Ns.delete(t),rb(t,o),o)).catch(()=>(Ns.delete(t),null));return Ns.set(t,r),r}function yb(t,e={}){gb();let n=Math.max(12,e.size??36),r=e.fallback??"?",o=document.createElement("span");kI(t,o,{size:n,fallback:r});let s=ll.get(t);return cl(o,s??null),Ku(t),o}function AI(){if(!(il||typeof window>"u")){if(!wI()){yr(200);return}il=!0,mb(),gb();try{Object.keys(Be).forEach(e=>{e&&Gu(e)})}catch{}jn.forEach(t=>{t.tileRef!=null&&Ku(t.key)})}}typeof window<"u"&&(yr(),window.addEventListener("mg:sprite-detected",()=>{il||yr(100)}));function ob(){return{minScalePct:50,maxScalePct:100,scaleLockMode:"RANGE",minInventory:91,avoidNormal:!1,visualMutations:new Set,weatherMode:"ANY",weatherSelected:new Set,weatherRecipes:[]}}function MI(t,e){t.minScalePct=e.minScalePct,t.maxScalePct=e.maxScalePct,t.scaleLockMode=e.scaleLockMode,t.minInventory=e.minInventory,t.avoidNormal=e.avoidNormal,t.visualMutations.clear(),e.visualMutations.forEach(n=>t.visualMutations.add(n)),t.weatherMode=e.weatherMode,t.weatherSelected.clear(),e.weatherSelected.forEach(n=>t.weatherSelected.add(n)),t.weatherRecipes.length=0,e.weatherRecipes.forEach(n=>t.weatherRecipes.push(new Set(n)))}function sb(t,e){let n=e??{},r=n.scaleLockMode==="MINIMUM"?"MINIMUM":n.scaleLockMode==="NONE"?"NONE":"RANGE",s=Math.max(50,Math.min(r==="MINIMUM"?100:99,Math.round(n.minScalePct??50))),i=Math.max(50,Math.min(100,Math.round(n.maxScalePct??100)));(r==="RANGE"||r==="NONE")&&(i=Math.max(51,Math.min(100,i)),i<=s&&(s>=99?(s=99,i=100):i=Math.min(100,Math.max(51,s+1)))),t.minScalePct=s,t.maxScalePct=i,t.scaleLockMode=r,t.minInventory=Math.max(0,Math.min(999,Math.round(n.minInventory??91))),t.avoidNormal=n.avoidNormal===!0||n.includeNormal===!1,t.visualMutations.clear(),(n.visualMutations??[]).forEach(a=>{(a==="Gold"||a==="Rainbow")&&t.visualMutations.add(a)}),t.weatherMode=n.weatherMode==="ALL"||n.weatherMode==="RECIPES"?n.weatherMode:"ANY",t.weatherSelected.clear(),(n.weatherSelected??[]).forEach(a=>{let l=a;zu(l)&&t.weatherSelected.add(l)}),t.weatherRecipes.length=0,(n.weatherRecipes??[]).forEach(a=>{let l=new Set;Array.isArray(a)&&a.forEach(c=>{let d=c;zu(d)&&l.add(d)}),t.weatherRecipes.push(l)})}function ib(t){fb(t.weatherSelected),t.weatherRecipes.forEach(s=>rl(s));let e=t.scaleLockMode==="MINIMUM"?"MINIMUM":t.scaleLockMode==="NONE"?"NONE":"RANGE",r=Math.max(50,Math.min(e==="MINIMUM"?100:99,Math.round(t.minScalePct||50))),o=Math.max(50,Math.min(100,Math.round(t.maxScalePct||100)));return(e==="RANGE"||e==="NONE")&&(o=Math.max(51,Math.min(100,o)),o<=r&&(r>=99?(r=99,o=100):o=Math.min(100,Math.max(51,r+1)))),{minScalePct:r,maxScalePct:o,scaleLockMode:e,minInventory:Math.max(0,Math.min(999,Math.round(t.minInventory||91))),avoidNormal:!!t.avoidNormal,includeNormal:!t.avoidNormal,visualMutations:Array.from(t.visualMutations),weatherMode:t.weatherMode,weatherSelected:Array.from(t.weatherSelected),weatherRecipes:t.weatherRecipes.map(s=>Array.from(s))}}var Uu=class{constructor(e){ce(this,"global");ce(this,"overrides",new Map);ce(this,"listeners",new Set);ce(this,"syncing",!1);this.global={enabled:!1,settings:ob(),hasPersistedSettings:!0},this.syncFromService(e)}applyPersisted(e){this.global.enabled=!!e.enabled,sb(this.global.settings,e.settings),this.global.hasPersistedSettings=!0;let n=new Set;Object.entries(e.overrides??{}).forEach(([r,o])=>{let s=this.ensureOverride(r,{silent:!0});s.enabled=!!o?.enabled,sb(s.settings,o?.settings),s.hasPersistedSettings=!0,n.add(r)});for(let r of Array.from(this.overrides.keys()))n.has(r)||this.overrides.delete(r)}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(){for(let e of this.listeners)try{e()}catch{}}syncFromService(e){this.syncing=!0,this.applyPersisted(e),this.emit(),this.syncing=!1}setGlobalEnabled(e){this.global.enabled=!!e,this.persistGlobal(),this.emit()}notifyGlobalSettingsChanged(){this.persistGlobal(),this.emit()}ensureOverride(e,n={}){let r=this.overrides.get(e);return r||(r={enabled:!1,settings:ob(),hasPersistedSettings:!1},this.overrides.set(e,r),n.silent||this.emit()),r}getOverride(e){return this.overrides.get(e)}setOverrideEnabled(e,n){let r=this.ensureOverride(e,{silent:!0});r.enabled=!!n,this.persistOverride(e),this.emit()}notifyOverrideSettingsChanged(e){let n=this.overrides.get(e);n&&(n.hasPersistedSettings=!0,this.persistOverride(e),this.emit())}removeOverride(e){this.overrides.has(e)&&(this.overrides.delete(e),this.syncing||(dt.removeOverride(e),dt.recomputeCurrentSlot()),this.emit())}persistGlobal(){this.syncing||(dt.setGlobalState({enabled:this.global.enabled,settings:ib(this.global.settings)}),dt.recomputeCurrentSlot())}persistOverride(e){if(this.syncing)return;let n=this.overrides.get(e);n?(dt.setOverride(e,{enabled:n.enabled,settings:ib(n.settings)}),n.hasPersistedSettings=!0):dt.removeOverride(e),dt.recomputeCurrentSlot()}};function bb(t,e){t.checked=!!e}function ab({key:t,label:e,spriteSize:n,dense:r,kind:o="main",iconFactory:s}){let i=o==="main"&&!r,d={position:"relative",display:"grid",justifyItems:"center",alignItems:"center",gap:r||i?"3px":"6px",padding:r?"4px 6px":i?"6px 8px":"10px 12px",border:"1px solid #4445",borderRadius:"10px",background:"#0f1318",cursor:"pointer",minWidth:r?"80px":i?"88px":"120px",transition:"border-color 120ms ease, box-shadow 120ms ease, background 120ms ease",boxShadow:"0 0 0 1px #0002 inset"};i&&(d.width="100%");let u=Fe(document.createElement("label"),d);u.title="Active filters influence harvest conditions";let p=document.createElement("input");p.type="checkbox",Fe(p,{position:"absolute",inset:"0",opacity:"0",pointerEvents:"none",margin:"0"}),p.dataset.weatherToggle=o,u.appendChild(p),u.dataset.weatherToggle=o;let f=Math.max(24,n??(r?36:i?52:72)),h=s?s({size:f,fallback:e.charAt(0)||"?"}):yb(t,{size:f,fallback:e.charAt(0)||"?"});Fe(h,{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.45))"}),u.appendChild(h);let m=Fe(document.createElement("div"),{fontSize:r?"11px":"11.5px",fontWeight:r?"500":"600",opacity:"0.85",textAlign:"center"});m.textContent=e,u.appendChild(m);let g=()=>{p.disabled?(u.style.cursor="default",u.style.opacity="0.55",u.style.pointerEvents="none"):(u.style.cursor="pointer",u.style.opacity="",u.style.pointerEvents="")},y=()=>{p.checked?Fe(u,{borderColor:"#6aa6",boxShadow:"0 0 0 1px #6aa4 inset, 0 2px 6px rgba(0, 0, 0, 0.45)",background:"#182029"}):Fe(u,{borderColor:"#4445",boxShadow:"0 0 0 1px #0002 inset",background:"#0f1318"}),g()},v=x=>{bb(p,x),y()},w=x=>{p.disabled=!!x,y()};return p.addEventListener("change",y),p.addEventListener("mg-weather-toggle-refresh",y),y(),{key:t,wrap:u,input:p,setChecked:v,setDisabled:w}}function fo(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function lb(t,e){t.textContent=e,t.style.margin="0",t.style.padding="4px 8px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.display="inline-flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.minWidth="36px",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function vb(t,e,n={}){let r=document.createElement("div");r.dataset.lockerSettingsCard="1",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="12px",r.style.display="flex",r.style.flexDirection="column",r.style.gap="12px",r.style.alignItems="center",r.style.overflow="auto",r.style.minHeight="0",r.style.width="min(760px, 100%)";let o=(H,fe)=>{let ae=document.createElement("div");ae.style.display="grid",ae.style.justifyItems="center",ae.style.gap="8px",ae.style.textAlign="center",ae.style.border="1px solid #4446",ae.style.borderRadius="10px",ae.style.padding="10px",ae.style.background="#1f2328",ae.style.boxShadow="0 0 0 1px #0002 inset",ae.style.width="min(720px, 100%)";let ye=document.createElement("div");return ye.textContent=H,ye.style.fontWeight="600",ye.style.opacity="0.95",ae.append(ye,fe),ae},s=()=>{let H=document.createElement("div");return H.style.display="flex",H.style.flexWrap="wrap",H.style.justifyContent="center",H.style.alignItems="center",H.style.gap="8px",H},i=s();i.style.flexDirection="column",i.style.alignItems="center",i.style.width="100%",i.style.gap="12px";let a=s();a.style.flexWrap="wrap",a.style.justifyContent="center",a.style.gap="12px";let l=H=>{switch(H){case"minimum":return"MINIMUM";case"ranged":return"RANGE";default:return"NONE"}},c=H=>{switch(H){case"MINIMUM":return"minimum";case"RANGE":return"ranged";default:return"none"}},d=!1,u=c(e.scaleLockMode),p=t.segmented([{value:"none",label:"None"},{value:"minimum",label:"Minimum size"},{value:"ranged",label:"Range size"}],u,H=>{d||S(l(H),!0)},{ariaLabel:"Scale lock mode"});a.append(p);let f=t.slider(50,100,1,e.minScalePct);Fe(f,{width:"min(420px, 100%)"});let h=t.rangeDual(50,100,1,e.minScalePct,e.maxScalePct);Fe(h.root,{width:"min(420px, 100%)",marginLeft:"auto",marginRight:"auto"});let m=h.min,g=h.max,y=t.label("50%"),v=t.label("50%"),w=t.label("100%");[y,v,w].forEach(H=>{H.style.margin="0",H.style.fontWeight="600"});let x=(H,fe)=>{let ae=Fe(document.createElement("div"),{display:"flex",alignItems:"center",gap:"6px"}),ye=t.label(H);return ye.style.margin="0",ye.style.opacity="0.9",ae.append(ye,fe),ae},E=Fe(document.createElement("div"),{display:"flex",justifyContent:"space-between",alignItems:"center",width:"min(420px, 100%)",gap:"16px"});E.append(x("Min",v),x("Max",w));let L=Fe(document.createElement("div"),{display:"flex",justifyContent:"center",alignItems:"center",width:"min(420px, 100%)",gap:"16px"});L.append(x("Minimum",y));let P=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%"});P.append(f,L);let V=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",alignItems:"center",gap:"12px",width:"100%"});V.append(h.root,E),i.append(a,P,V);let z=(H,fe=H)=>{let ae=parseInt(m.value,10),ye=parseInt(g.value,10);Number.isFinite(ae)||(ae=e.minScalePct),Number.isFinite(ye)||(ye=e.maxScalePct),ae=Math.max(50,Math.min(99,ae)),ye=Math.max(51,Math.min(100,ye)),ye<=ae&&(ae>=99?(ae=99,ye=100):ye=Math.min(100,Math.max(51,ae+1))),h.setValues(ae,ye),v.textContent=`${ae}%`,w.textContent=`${ye}%`,H&&(e.minScalePct=ae,e.maxScalePct=ye,fe&&n.onChange?.())},C=(H,fe=H)=>{let ae=parseInt(f.value,10);Number.isFinite(ae)||(ae=e.minScalePct),ae=Math.max(50,Math.min(100,ae)),f.value=String(ae),y.textContent=`${ae}%`,H&&(e.minScalePct=ae,fe&&n.onChange?.())},D=()=>{let H=e.scaleLockMode==="MINIMUM",fe=e.scaleLockMode==="RANGE";P.style.display=H?"":"none",V.style.display=fe?"":"none";let ae=c(e.scaleLockMode);if(p.get?.()!==ae){d=!0;try{p.set?.(ae)}finally{d=!1}}},S=(H,fe)=>{let ae=e.scaleLockMode;e.scaleLockMode=H,H==="MINIMUM"?(f.value=String(e.minScalePct),C(ae!==H,!1)):H==="RANGE"?(h.setValues(e.minScalePct,e.maxScalePct),z(ae!==H,!1)):(f.value=String(e.minScalePct),h.setValues(e.minScalePct,e.maxScalePct)),D(),fe&&ae!==H&&n.onChange?.()};f.addEventListener("input",()=>C(!1)),f.addEventListener("change",()=>C(!0)),m.addEventListener("input",()=>z(!1)),g.addEventListener("input",()=>z(!1)),m.addEventListener("change",()=>z(!0)),g.addEventListener("change",()=>z(!0)),z(!1),C(!1),S(e.scaleLockMode,!1);let G=s();G.style.flexWrap="wrap",G.style.gap="8px";let se=(H,fe)=>{let ae=document.createElement("button");ae.type="button",ae.title="Active filters influence harvest conditions",Fe(ae,{padding:"6px 12px",borderRadius:"8px",border:"1px solid #4445",background:"#1f2328",color:"#e7eef7",fontWeight:"600",letterSpacing:"0.3px",transition:"border-color 120ms ease, box-shadow 120ms ease, background 120ms ease, opacity 120ms ease",boxShadow:"0 0 0 1px #0002 inset",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"6px",minWidth:"92px",cursor:"pointer"});let ye=document.createElement("span");return ye.textContent=H,fe&&Fe(ye,{backgroundImage:fe,backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent",fontWeight:"700",textShadow:"0 0 6px rgba(0, 0, 0, 0.35)"}),ae.appendChild(ye),ae.addEventListener("mouseenter",()=>{ae.disabled||ae.dataset.active==="1"||(ae.style.borderColor="#6aa1")}),ae.addEventListener("mouseleave",()=>{ae.dataset.active!=="1"&&(ae.style.borderColor="#4445")}),ae},X=se("Normal"),ue=se("Gold","linear-gradient(120deg, #f5d76e, #c9932b, #f9e9b6)"),N=se("Rainbow","linear-gradient(90deg, #ff6b6b, #f7d35c, #3fd3ff, #9b6bff, #ff6b6b)"),ee=(H,fe)=>{H.dataset.active=fe?"1":"0",H.style.borderColor=fe?"#6aa6":"#4445",H.style.boxShadow=fe?"0 0 0 1px #6aa4 inset, 0 2px 6px rgba(0, 0, 0, 0.45)":"0 0 0 1px #0002 inset",H.style.background=fe?"#182029":"#1f2328",H.style.opacity=H.disabled?"0.55":"",H.style.cursor=H.disabled?"default":"pointer"},q=()=>{ee(X,e.avoidNormal),ee(ue,e.visualMutations.has("Gold")),ee(N,e.visualMutations.has("Rainbow"))};X.addEventListener("click",()=>{e.avoidNormal=!e.avoidNormal,q(),n.onChange?.()}),ue.addEventListener("click",()=>{e.visualMutations.has("Gold")?e.visualMutations.delete("Gold"):e.visualMutations.add("Gold"),q(),n.onChange?.()}),N.addEventListener("click",()=>{e.visualMutations.has("Rainbow")?e.visualMutations.delete("Rainbow"):e.visualMutations.add("Rainbow"),q(),n.onChange?.()}),G.append(X,ue,N);let A=Fe(document.createElement("div"),{display:"grid",gridTemplateColumns:"repeat(4, minmax(0, 1fr))",columnGap:"6px",rowGap:"6px",justifyItems:"stretch",width:"min(640px, 100%)",marginInline:"auto"}),ne=(H=>(fe,ae)=>{ae?H.add(fe):H.delete(fe),n.onChange?.()})(e.weatherSelected),Z=jn.map(H=>{let fe=ab({key:H.key,label:H.label,kind:"main",iconFactory:H.iconFactory});return fe.input.addEventListener("change",()=>ne(H.key,fe.input.checked)),A.appendChild(fe.wrap),fe}),me=()=>{let H=r.dataset.disabled==="1"||e.weatherMode==="RECIPES";A.style.opacity=H?"0.55":"",A.style.pointerEvents=H?"none":"",Z.forEach(fe=>fe.setDisabled(H))},Q=`locker-weather-mode-${++vI}`,oe=s(),W=(H,fe)=>{let ae=document.createElement("label");ae.style.display="inline-flex",ae.style.alignItems="center",ae.style.gap="6px";let ye=t.radio(Q,H),Ee=document.createElement("span");return Ee.textContent=fe,ae.append(ye,Ee),ye.addEventListener("change",()=>{ye.checked&&(e.weatherMode=H,O.style.display=H==="RECIPES"?"":"none",me(),n.onChange?.())}),{wrap:ae,input:ye}},U=W("ANY","Any match (OR)"),J=W("ALL","All match (AND)"),B=W("RECIPES","Recipes (match rows)");oe.append(U.wrap,J.wrap,B.wrap);let O=document.createElement("div");O.style.display="grid",O.style.gap="8px",O.style.justifyItems="center",O.style.width="min(720px, 100%)";let b=s();b.style.width="100%",b.style.justifyContent="space-between";let M=document.createElement("div");M.textContent="Lock when any recipe row matches (OR between rows)",M.style.fontWeight="600",M.style.opacity="0.9";let _=document.createElement("button");_.style.maxWidth="140px",fo(_,"+ Recipe"),b.append(M,_);let k=document.createElement("div");k.style.display="grid",k.style.gap="8px",k.style.gridTemplateColumns="repeat(auto-fit, minmax(320px, 1fr))",k.style.justifyItems="stretch";let T=null,F=new Set,$=document.createElement("div");$.textContent="No recipe rows yet.",$.style.fontSize="12px",$.style.opacity="0.7",$.style.textAlign="center";let K=()=>{let H=T!==null,fe=r.dataset.disabled==="1";_.disabled=H||fe,_.style.opacity=H?"0.7":"",_.style.pointerEvents=H?"none":""},R=(H,fe)=>{T=H,F=new Set(fe??[]),rl(F),be()},Y=()=>{T=null,F=new Set,be()},re=()=>{if(T===null)return;let H=new Set(F);rl(H),T===e.weatherRecipes.length?e.weatherRecipes.push(H):T>=0&&T<e.weatherRecipes.length&&(e.weatherRecipes[T]=H),T=null,F=new Set,be(),n.onChange?.()},I=H=>{H<0||(H<e.weatherRecipes.length&&e.weatherRecipes.splice(H,1),T!==null&&(H===T?(T=null,F=new Set):H<T&&(T-=1)),be(),n.onChange?.())},j=H=>{let{key:fe,label:ae}=H,ye=document.createElement("div");Fe(ye,{display:"inline-flex",alignItems:"center",gap:"6px",padding:"4px 10px",borderRadius:"999px",border:"1px solid #4445",background:"#11161c",color:"#e7eef7",fontSize:"12px",fontWeight:"600",letterSpacing:"0.2px"});let Ee=H.iconFactory?H.iconFactory({size:20,fallback:ae.charAt(0)||"?"}):yb(fe,{size:20,fallback:ae.charAt(0)||"?"});Fe(Ee,{filter:"drop-shadow(0 1px 1px rgba(0, 0, 0, 0.45))"});let Ie=document.createElement("span");return Ie.textContent=ae,ye.append(Ee,Ie),ye},de=(H,fe)=>{H.innerHTML="";let ae=document.createElement("div");Fe(ae,{display:"flex",flexWrap:"wrap",gap:"6px",justifyContent:"flex-start"});let ye=0;if(jn.forEach(Ee=>{fe.has(Ee.key)&&(ye+=1,ae.appendChild(j(Ee)))}),ye===0){let Ee=document.createElement("div");Ee.textContent="No weather mutation selected.",Ee.style.fontSize="12px",Ee.style.opacity="0.7",Ee.style.textAlign="left",ae.appendChild(Ee)}H.appendChild(ae)},ie=()=>{let H=r.dataset.disabled==="1";r.querySelectorAll("input,button,select,textarea").forEach(ae=>{ae.dataset.weatherToggle!=="main"&&(ae.disabled=H,ae.dispatchEvent(new Event("mg-weather-toggle-refresh")))}),me(),q(),r.style.opacity=H?"0.55":"",K()};function ge(H,fe){let ae=Fe(document.createElement("div"),{display:"grid",gridTemplateColumns:"repeat(4, minmax(80px, 1fr))",columnGap:"6px",rowGap:"6px",justifyItems:"center"}),ye=new Map;return jn.forEach(Ee=>{let Ie=ab({key:Ee.key,label:Ee.label,spriteSize:40,dense:!0,kind:"recipe",iconFactory:Ee.iconFactory});ye.set(Ee.key,Ie),Ie.setChecked(H.has(Ie.key)),Ie.input.addEventListener("change",()=>{let Oe=Ie.input.checked,je=pb[Ie.key];Oe&&je&&bI[je].forEach(Ne=>{Ne!==Ie.key&&H.has(Ne)&&(H.delete(Ne),ye.get(Ne)?.setChecked(!1))}),Oe?H.add(Ie.key):H.delete(Ie.key),fe()}),ae.appendChild(Ie.wrap)}),ae}function be(){k.innerHTML="";let H=T!==null&&T===e.weatherRecipes.length;if(e.weatherRecipes.length+(H?1:0)===0){k.appendChild($),ie();return}if(e.weatherRecipes.forEach((ae,ye)=>{rl(ae);let Ee=T===ye,Ie=Ee?F:ae,Oe=Fe(document.createElement("div"),{display:"flex",gap:Ee?"10px":"12px",border:"1px solid #4446",borderRadius:"10px",padding:Ee?"12px":"10px 12px",background:"#0f1318",boxShadow:"0 0 0 1px #0002 inset",width:"100%"});Ee?Oe.style.flexDirection="column":(Oe.style.flexDirection="row",Oe.style.alignItems="center",Oe.style.justifyContent="space-between",Oe.style.flexWrap="wrap");let je=document.createElement("div");if(de(je,Ie),Ee||(je.style.flex="1 1 auto",je.style.minWidth="220px"),Oe.appendChild(je),Ee){let Ne=ge(Ie,()=>de(je,Ie));Oe.appendChild(Ne);let Qe=Fe(document.createElement("div"),{display:"flex",gap:"8px",width:"100%"}),$e=document.createElement("button");fo($e,"\u274C"),$e.onclick=Y;let ut=document.createElement("button");if(fo(ut,"\u2714\uFE0F"),ut.onclick=re,Qe.append($e,ut),T!==null&&T<e.weatherRecipes.length){let Ft=document.createElement("button");fo(Ft,"\u{1F5D1}\uFE0F"),Ft.title="Delete",Ft.setAttribute("aria-label","Delete"),Ft.onclick=()=>I(ye),Qe.append(Ft)}Oe.appendChild(Qe)}else{let Ne=Fe(document.createElement("div"),{display:"flex",gap:"6px",alignItems:"center",justifyContent:"flex-end",flex:"0 0 auto"});Ne.style.flexWrap="nowrap";let Qe=document.createElement("button");lb(Qe,"\u270F\uFE0F"),Qe.title="Edit",Qe.setAttribute("aria-label","Edit"),Qe.onclick=()=>R(ye,ae);let $e=document.createElement("button");lb($e,"\u{1F5D1}\uFE0F"),$e.title="Delete",$e.setAttribute("aria-label","Delete"),$e.onclick=()=>I(ye),Ne.append(Qe,$e),Oe.appendChild(Ne)}k.appendChild(Oe)}),H&&T!==null){let ae=F,ye=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"10px",border:"1px solid #4446",borderRadius:"10px",padding:"12px",background:"#0f1318",boxShadow:"0 0 0 1px #0002 inset",width:"100%"}),Ee=document.createElement("div");de(Ee,ae),ye.appendChild(Ee);let Ie=ge(ae,()=>de(Ee,ae));ye.appendChild(Ie);let Oe=Fe(document.createElement("div"),{display:"flex",gap:"8px",width:"100%"}),je=document.createElement("button");fo(je,"\u274C"),je.onclick=Y;let Ne=document.createElement("button");fo(Ne,"\u2714\uFE0F"),Ne.onclick=re,Oe.append(je,Ne),ye.appendChild(Oe),k.appendChild(ye)}ie()}_.onclick=()=>{R(e.weatherRecipes.length)},O.append(b,k),r.append(o("Lock by size",i),o("Lock by color",G),o("Lock by weather",A),o("Weather lock mode",oe),o("Recipe lockers",O));let ve=()=>{h.setValues(e.minScalePct,e.maxScalePct),f.value=String(e.minScalePct),z(!1),C(!1),S(e.scaleLockMode,!1),q(),Z.forEach(H=>H.setChecked(e.weatherSelected.has(H.key))),U.input.checked=e.weatherMode==="ANY",J.input.checked=e.weatherMode==="ALL",B.input.checked=e.weatherMode==="RECIPES",O.style.display=e.weatherMode==="RECIPES"?"":"none",me(),be()},le=H=>{r.dataset.disabled=H?"1":"0",ie()};return ve(),{root:r,refresh:ve,setDisabled:le}}function PI(t,e){let n=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",alignItems:"center",width:"100%"}),r=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",alignItems:"center",width:"100%"}),o=Fe(document.createElement("div"),{display:"flex",alignItems:"center",gap:"10px",justifyContent:"space-between",border:"1px solid #4445",borderRadius:"10px",padding:"12px 16px",background:"#1f2328",boxShadow:"0 0 0 1px #0002 inset",width:"min(760px, 100%)"}),s=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"4px"}),i=document.createElement("div");i.textContent="Global locker",i.style.fontWeight="600",i.style.fontSize="15px";let a=document.createElement("div");a.textContent="Set the rules for locking harvests using the filters below.",a.style.opacity="0.8",a.style.fontSize="12px",s.append(i,a);let l=Fe(document.createElement("label"),{display:"flex",alignItems:"center",gap:"8px"}),c=t.label("Enabled");c.style.margin="0";let d=t.switch(e.global.enabled);l.append(c,d),o.append(s,l);let u=vb(t,e.global.settings,{onChange:()=>e.notifyGlobalSettingsChanged()});r.append(o,u.root),n.append(r);let p=()=>{bb(d,e.global.enabled),u.setDisabled(!e.global.enabled),u.refresh()};d.addEventListener("change",()=>{e.setGlobalEnabled(!!d.checked)});let f=e.subscribe(()=>{p()});return p(),{render:m=>{m.innerHTML="",m.style.maxHeight="54vh",m.style.overflow="auto",m.append(n),p()},destroy:()=>f()}}function RI(t,e){let n=Fe(document.createElement("div"),{display:"grid",gridTemplateColumns:"minmax(220px, 280px) minmax(0, 1fr)",gap:"10px",alignItems:"stretch",height:"54vh",overflow:"hidden"}),r=Fe(document.createElement("div"),{display:"grid",gridTemplateRows:"1fr",gap:"8px",minHeight:"0"});n.appendChild(r);let o=Fe(document.createElement("div"),{display:"grid",gridTemplateColumns:"1fr",rowGap:"6px",overflow:"auto",paddingRight:"2px",border:"1px solid #4445",borderRadius:"10px",padding:"6px"});r.appendChild(o);let s=Fe(document.createElement("div"),{display:"flex",flexDirection:"column",gap:"12px",minHeight:"0"});n.appendChild(s);let i=Fe(document.createElement("div"),{display:"grid",gap:"12px",justifyItems:"center",alignContent:"start",height:"100%",overflow:"auto"});s.appendChild(i);let a=null,l=null,c=new Map,d=v=>{let w=Math.max(0,v.scrollHeight-v.clientHeight);return Math.max(0,Math.min(v.scrollTop,w))},u=(v,w)=>{let x=Math.max(0,v.scrollHeight-v.clientHeight),E=Math.max(0,Math.min(w,x));return v.scrollTop=E,E},p=v=>{let w=c.get(v)??{detail:0,card:0};w.detail=d(i);let x=i.querySelector('[data-locker-settings-card="1"]');x&&(w.card=d(x)),c.set(v,w)};i.addEventListener("scroll",()=>{if(!l)return;let v=c.get(l)??{detail:0,card:0};v.detail=d(i),c.set(l,v)});let f=()=>{let v=d(o);o.innerHTML="";let w=ol();if(!w.length){let E=document.createElement("div");E.textContent="No crops available.",E.style.opacity="0.7",E.style.fontSize="12px",E.style.textAlign="center",E.style.padding="16px",o.appendChild(E),u(o,v),a=null;return}yr(),a&&!w.some(E=>E.key===a)&&(a=null);let x=document.createDocumentFragment();w.forEach(E=>{let L=document.createElement("button");L.className="qmm-vtab",L.style.display="grid",L.style.gridTemplateColumns="16px 1fr auto",L.style.alignItems="center",L.style.gap="8px",L.style.textAlign="left",L.style.padding="6px 8px",L.style.borderRadius="8px",L.style.border="1px solid #4445",L.style.background=a===E.key?"#2b8a3e":"#1f2328",L.style.color="#e7eef7";let P=document.createElement("span");P.className="qmm-dot",P.style.background=e.getOverride(E.key)?.enabled?"#2ecc71":"#e74c3c";let V=document.createElement("span");V.className="label",V.textContent=E.cropName||E.key;let z=qs(E.key)||Ds(E.seedName)||"\u{1F331}",C=al(E.key,{size:24,fallback:z});L.append(P,V,C),L.onmouseenter=()=>L.style.borderColor="#6aa1",L.onmouseleave=()=>L.style.borderColor="#4445",L.onclick=()=>{a!==E.key&&(a=E.key,f(),h())},x.appendChild(L)}),o.appendChild(x),u(o,v)},h=()=>{if(l&&p(l),i.innerHTML="",!a){let N=document.createElement("div");N.textContent="Select a crop on the left to customise its locker settings.",N.style.opacity="0.7",N.style.fontSize="13px",N.style.textAlign="center",N.style.padding="32px 24px",N.style.border="1px dashed #4445",N.style.borderRadius="10px",N.style.width="min(760px, 100%)",i.appendChild(N),l=null;return}let w=ol().find(N=>N.key===a);if(!w){a=null,l=null,h();return}let x=e.ensureOverride(a,{silent:!0}),E=t.flexRow({justify:"between",align:"center",fullWidth:!0});E.style.border="1px solid #4445",E.style.borderRadius="10px",E.style.padding="12px 16px",E.style.background="#1f2328",E.style.boxShadow="0 0 0 1px #0002 inset",E.style.width="min(760px, 100%)";let L=t.flexRow({gap:10,align:"center"});L.style.flexWrap="nowrap";let P=qs(w.key)||Ds(w.seedName)||"\u{1F331}",V=al(w.key,{size:32,fallback:P}),z=document.createElement("div");z.textContent=w.cropName||w.key,z.style.fontWeight="600",z.style.fontSize="15px",L.append(V,z);let C=t.flexRow({gap:8,align:"center"});C.style.flexWrap="nowrap";let D=t.label("Override");D.style.margin="0";let S=t.switch(x.enabled);C.append(D,S),E.append(L,C);let G=document.createElement("div");G.style.fontSize="12px",G.style.opacity="0.75",G.style.textAlign="center",G.style.width="min(760px, 100%)";let se=()=>{G.textContent=x.enabled?"This crop uses its own locker filters.":"Uses the global locker settings."},X=vb(t,x.settings,{onChange:()=>{a&&e.notifyOverrideSettingsChanged(a)}}),ue=()=>{X.setDisabled(!x.enabled),X.refresh(),se()};if(S.addEventListener("change",()=>{if(!a)return;let N=x.enabled,ee=!!S.checked;ee&&!N&&!x.hasPersistedSettings&&MI(x.settings,e.global.settings),ee&&(x.hasPersistedSettings=!0),e.setOverrideEnabled(a,ee)}),ue(),i.append(E,G,X.root),a){let N=c.get(a)??{detail:0,card:0};N.detail=u(i,N.detail),N.card=u(X.root,N.card),c.set(a,N);let ee=a;X.root.addEventListener("scroll",()=>{if(l!==ee)return;let q=c.get(ee)??{detail:d(i),card:0};q.card=d(X.root),c.set(ee,q)}),l=ee}},m=()=>{f(),h()},g=e.subscribe(m);return{render:v=>{v.innerHTML="",v.append(n),m()},destroy:()=>g()}}async function wb(t){let e=new Ye({id:"locker",compact:!0});e.mount(t);let n=new Uu(dt.getState()),r=PI(e,n),o=RI(e,n);e.addTabs([{id:"locker-general",title:"General",render:a=>r.render(a)},{id:"locker-overrides",title:"Overrides by species",render:a=>o.render(a)}]),e.switchTo("locker-general");let s=[];s.push(dt.subscribe(a=>n.syncFromService(a.state))),s.push(()=>r.destroy()),s.push(()=>o.destroy());let i=()=>{for(;s.length;){let a=s.pop();try{a?.()}catch{}}};e.on("unmounted",i)}var Ce="mg-crop-simulation",en=50,br=100,pn=1,_I=3,Vu=["None","Gold","Rainbow"],Yu=["None","Wet","Chilled","Frozen"],$u=["None","Dawnlit","Dawnbound","Amberlit","Amberbound"],mo=["+0%","+10%","+20%","+30%","+40%","+50%"],ho=1,Pb=mo.length,LI={None:{mgColor:"none"},Gold:{mgColor:"gold"},Rainbow:{mgColor:"rainbow"}},NI={None:{mgWeather:"none"},Wet:{mgWeather:"wet"},Chilled:{mgWeather:"chilled"},Frozen:{mgWeather:"frozen"}},OI={None:{mgLighting:"none"},Dawnlit:{mgLighting:"dawnlit"},Dawnbound:{mgLighting:"dawnbound"},Amberlit:{mgLighting:"amberlit"},Amberbound:{mgLighting:"amberbound"}},Xu=new Ye({compact:!0}),qI=Xu.ensureStyles;qI?.call(Xu);var DI=new Intl.NumberFormat("en-US"),BI=new Intl.NumberFormat("en-US",{minimumFractionDigits:3,maximumFractionDigits:3}),FI={sizePercent:en,color:"None",weatherCondition:"None",weatherLighting:"None",friendPlayers:ho},Sb=96;var xb=["wet","chilled","frozen"],HI=[["dawnlit"],["dawnbound","dawncharged","dawn radiant","dawnradiant","dawn-radiant"],["ambershine","amberlit"],["amberbound","ambercharged","amber radiant","amberradiant","amber-radiant"]],Rb={Wet:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.2},Chilled:{blendMode:"source-atop",colors:["rgb(183, 183, 236)"],alpha:.5},Frozen:{blendMode:"source-atop",colors:["rgb(128, 128, 255)"],alpha:.6},Dawnlit:{blendMode:"source-atop",colors:["rgb(120, 100, 180)"],alpha:.4},Ambershine:{blendMode:"source-atop",colors:["rgb(255, 140, 26)","rgb(230, 92, 26)","rgb(178, 58, 26)"],alpha:.5},Dawncharged:{blendMode:"source-atop",colors:["rgb(100, 80, 160)","rgb(110, 90, 170)","rgb(120, 100, 180)"],alpha:.5},Ambercharged:{blendMode:"source-atop",colors:["rgb(167, 50, 30)","rgb(177, 60, 40)","rgb(187, 70, 50)"],alpha:.5}},WI=(()=>{let t=new Map;xb.forEach((n,r)=>{t.set(n.toLowerCase(),r)});let e=xb.length;return HI.forEach(n=>{n.forEach(r=>{t.set(r.toLowerCase(),e)}),e+=1}),t})(),jI=new Set(["dawnlit","dawncharged","ambershine","ambercharged"]),zI=new Map([["wet","Wet"],["damp","Wet"],["moist","Wet"],["chilled","Chilled"],["cold","Chilled"],["frozen","Frozen"],["ice","Frozen"],["icy","Frozen"],["dawnlit","Dawnlit"],["dawn-lit","Dawnlit"],["dawnbound","Dawnlit"],["dawn-bound","Dawnlit"],["dawncharged","Dawncharged"],["dawn-charged","Dawncharged"],["dawn radiant","Dawncharged"],["dawnradiant","Dawncharged"],["dawn-radiant","Dawncharged"],["ambershine","Ambershine"],["amber-shine","Ambershine"],["amberlit","Ambershine"],["amber-lit","Ambershine"],["amberbound","Ambercharged"],["amber-bound","Ambercharged"],["ambercharged","Ambercharged"],["amber-charged","Ambercharged"],["amber radiant","Ambercharged"],["amberradiant","Ambercharged"],["amber-radiant","Ambercharged"]]),UI=(()=>{let t=new Map;return Object.keys(Rb).forEach(e=>{t.set(e.toLowerCase(),e)}),zI.forEach((e,n)=>{t.set(n,e)}),t})(),GI=(()=>{let t=new Map,e=jo;for(let[n,r]of Object.entries(e))typeof n!="string"||typeof r!="string"||(t.set(n.toLowerCase(),r),t.set(r.toLowerCase(),r));return t})(),KI=new Set(["Bamboo","Cactus"]),Eb=(()=>{let t=new Map,e=Wi;for(let[s,i]of Object.entries(e)){if(typeof s!="string"||!s.trim())continue;let a=typeof i?.name=="string"&&i.name.trim().length>0?i.name:s,l=typeof i?.tileRef=="number"?i.tileRef:null,c=l!=null?"weather":"color",d={id:s,label:a,tileRef:l,category:c};t.set(s.toLowerCase(),d),t.set(a.toLowerCase(),d)}let n=jo;for(let[s,i]of Object.entries(n)){if(typeof s!="string"||typeof i!="string")continue;let a=t.get(s.toLowerCase());if(!a)continue;let l=i.toLowerCase();t.has(l)||t.set(l,a)}let r=t.get("gold");r&&t.set("golden",r);let o={id:"Normal",label:"Normal",tileRef:null,category:"color"};return t.set("normal",o),t})(),bl=new Map,dl=new Map,Ju=new Map,ul=new Map,vl=new Map,pl=new Map,wl=new Map,fl=new Map,Sl=new Map,ml=new Map,Cb=0,VI=`
.${Ce} {
  display: none;
  width: min(100%, 500px);
  padding: 12px 14px;
  color: #e2e8f0;
  display: flex;
  flex-direction: column;
  gap: 10px;
  font-family: "Inter", system-ui, -apple-system, "Segoe UI", sans-serif;
  position: relative;
  z-index: 2000;
  pointer-events: auto;
}
.${Ce} .mg-crop-simulation__header {
  display: flex;
  align-items: baseline;
  justify-content: space-between;
  gap: 8px;
}
.${Ce} .mg-crop-simulation__title {
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 0.03em;
  text-transform: uppercase;
  color: #f8fafc;
}
.${Ce} .mg-crop-simulation__crop-name {
  font-size: 13px;
  font-weight: 600;
  color: #38bdf8;
  text-transform: capitalize;
}
.${Ce} .mg-crop-simulation__sprite-section {
  display: flex;
  flex-direction: column;
}
.${Ce} .mg-crop-simulation__sprite-box {
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 12px;
}
.${Ce} .mg-crop-simulation__sprite {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: ${Sb}px;
  height: ${Sb}px;
  position: relative;
  flex-shrink: 0;
  --mg-crop-simulation-scale: 1;
  transform-origin: center;
  transform: scale(var(--mg-crop-simulation-scale));
}
.${Ce} .mg-crop-simulation__sprite-layer,
.${Ce} .mg-crop-simulation__sprite-fallback {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
.${Ce} .mg-crop-simulation__sprite-layer img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  image-rendering: pixelated;
}
.${Ce} .mg-crop-simulation__sprite-layer--base {
  z-index: 1;
}
.${Ce} .mg-crop-simulation__sprite-layer--overlay {
  z-index: 2;
  transform: translateY(-4px);
}
.${Ce} .mg-crop-simulation__sprite-layer--overlay-lighting {
  transform: translateY(-30px);
}
.${Ce} .mg-crop-simulation__sprite-fallback {
  z-index: 0;
  font-size: 42px;
}
.${Ce} .mg-crop-simulation__slider-container {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 6px;
}
.${Ce} .mg-crop-simulation__slider-row {
  display: flex;
  align-items: center;
  gap: 8px;
}
.${Ce} .mg-crop-simulation__slider-label {
  font-size: 12px;
  color: rgba(226, 232, 240, 0.82);
  flex: 0 0 auto;
}
.${Ce} .mg-crop-simulation__slider-value {
  margin-left: auto;
  font-size: 12px;
  font-variant-numeric: tabular-nums;
  color: #f8fafc;
  text-align: right;
  width: 4ch;
  min-width: 4ch;
  flex: 0 0 4ch;
  white-space: nowrap;
}
.${Ce} .mg-crop-simulation__slider-weight {
  font-size: 11px;
  color: rgba(148, 163, 184, 0.82);
  font-variant-numeric: tabular-nums;
  text-align: center;
  white-space: nowrap;
}
.${Ce} .mg-crop-simulation__slider {
  flex: 1 1 auto;
  min-width: 0;
  accent-color: #38bdf8;
}
.${Ce} .mg-crop-simulation__price {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-weight: 700;
  font-size: 14px;
  color: #ffd84d;
  align-self: flex-start;
  margin-top: auto;
}
.${Ce} .mg-crop-simulation__price-icon {
  width: 20px;
  height: 20px;
  flex: 0 0 auto;
  display: inline-block;
  user-select: none;
  pointer-events: none;
}
.${Ce} .mg-crop-simulation__price-value {
  line-height: 1;
}
.${Ce} .mg-crop-simulation__section-title {
  font-size: 11px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgba(148, 163, 184, 0.9);
}
.${Ce}.mg-crop-simulation--calculator {
  align-items: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__layout {
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 12px;
  width: min(440px, 100%);
  margin: 0 auto;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section {
  display: grid;
  gap: 10px;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid #4446;
  background: #1f2328;
  box-shadow: 0 0 0 1px #0002 inset;
  justify-items: stretch;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section-heading {
  font-size: 11px;
  letter-spacing: 0.06em;
  text-transform: uppercase;
  color: rgba(226, 232, 240, 0.82);
  font-weight: 600;
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section--preview {
  justify-items: center;
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__section--preview .mg-crop-simulation__slider-row {
  width: 100%;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__mutations-weather {
  display: grid;
  gap: 8px;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-calculator__mutations-heading {
  font-size: 10px;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: rgba(148, 163, 184, 0.82);
  text-align: center;
}
.${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price {
  margin-top: 0;
}
.${Ce} .mg-crop-simulation__segmented {
  display: flex;
  width: 100%;
}
.${Ce} .mg-crop-simulation__segmented-control {
  --qmm-bg-soft: rgba(11, 15, 19, 0.8);
  --qmm-border-2: rgba(148, 163, 184, 0.28);
  --qmm-text: #e2e8f0;
  --qmm-text-dim: rgba(148, 163, 184, 0.82);
  --seg-pad: 6px;
  --seg-fill: rgba(56, 191, 248, 0.02);
  --seg-stroke-color: rgba(255, 255, 255, 0.49);
  flex: 1 1 auto;
  min-width: 0;
  width: 100%;
}
.${Ce} .mg-crop-simulation__segmented-control .qmm-seg__btn {
  font-size: 11px;
  letter-spacing: 0.02em;
  font-weight: 600;
  flex: 1 1 0;
  display: flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  min-width: 0;
}
.${Ce} .qmm-seg__btn[data-mg-color="none"],
.${Ce} .qmm-seg__btn[data-mg-color="none"].active {
  color: rgba(148, 163, 184, 0.92);
}
.${Ce} .qmm-seg__btn[data-mg-color="gold"],
.${Ce} .qmm-seg__btn[data-mg-color="gold"].active {
  color: #facc15;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-color="gold"] .qmm-seg__btn-label,
.${Ce} .qmm-seg__btn[data-mg-color="gold"].active .qmm-seg__btn-label {
  color: transparent;
  background-image: linear-gradient(90deg, #fef08a, #facc15, #fef08a);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 100% 100%;
  background-repeat: no-repeat;
}
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"],
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"].active {
  color: #fbbf24;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"] .qmm-seg__btn-label,
.${Ce} .qmm-seg__btn[data-mg-color="rainbow"].active .qmm-seg__btn-label {
  color: transparent;
  background-image: linear-gradient(90deg, #f87171, #fbbf24, #34d399, #38bdf8, #c084fc);
  background-clip: text;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-size: 100% 100%;
  background-repeat: no-repeat;
}
.${Ce} .qmm-seg__btn[data-mg-weather="none"],
.${Ce} .qmm-seg__btn[data-mg-weather="none"].active,
.${Ce} .qmm-seg__btn[data-mg-lighting="none"],
.${Ce} .qmm-seg__btn[data-mg-lighting="none"].active {
  color: rgba(148, 163, 184, 0.92);
}
.${Ce} .qmm-seg__btn[data-mg-weather="wet"],
.${Ce} .qmm-seg__btn[data-mg-weather="wet"].active {
  color: #5AF6F5;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-weather="chilled"],
.${Ce} .qmm-seg__btn[data-mg-weather="chilled"].active {
  color: #AFE0F6;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-weather="frozen"],
.${Ce} .qmm-seg__btn[data-mg-weather="frozen"].active {
  color: #AABEFF;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnlit"],
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnlit"].active {
  color: #7864B4;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnbound"],
.${Ce} .qmm-seg__btn[data-mg-lighting="dawnbound"].active {
  color: #9785CB;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="amberlit"],
.${Ce} .qmm-seg__btn[data-mg-lighting="amberlit"].active {
  color: #A04632;
  font-weight: 700;
}
.${Ce} .qmm-seg__btn[data-mg-lighting="amberbound"],
.${Ce} .qmm-seg__btn[data-mg-lighting="amberbound"].active {
  color: #F06E50;
  font-weight: 700;
}
.${Ce} .mg-crop-simulation__mutations-section {
  display: flex;
  flex-direction: column;
  gap: 6px;
}
`,Tb=null;function YI(){Tb||(Tb=du(VI))}function kb(t){if(typeof t!="string")return null;let e=t.trim().toLowerCase();return e?UI.get(e)??null:null}function xl(t){return kb(t.id)??kb(t.label)}function El(t){let e=t.toLowerCase();return WI.get(e)??Number.MAX_SAFE_INTEGER}function $I(t){return jI.has(t.toLowerCase())}function ep(t){let e=new Set,n=new Map,r=[];return t.forEach((o,s)=>{e.has(o)||(e.add(o),r.push(o),n.set(o,s))}),r.sort((o,s)=>{let i=El(o)-El(s);return i!==0?i:(n.get(o)??0)-(n.get(s)??0)}),r}function JI(t){let e=t.map(n=>xl(n)).filter(n=>n!=null);return ep(e)}function _b(t,e,n){return`${t}::variant::${e}::effects::${n.join("+")}`}function QI(){let t=new Set;try{ke.listTilesByCategory(/mutations/i).forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return e.length?e:["mutations"]}async function ZI(t){if(typeof window>"u")return null;let e=Be[t];if(!e)return null;let n=e?.crop?.tileRef??e?.plant?.tileRef??e?.seed?.tileRef,r=tA(t),o=nA(n,r);if(o==null)return null;for(let s of r)try{let a=(await ke.getTile(s,o,"canvas"))?.data;if(a&&a.width>0&&a.height>0){let l=document.createElement("canvas");l.width=a.width,l.height=a.height;let c=l.getContext("2d");if(!c)continue;return c.imageSmoothingEnabled=!1,c.drawImage(a,0,0),l}}catch{}return null}function Lb(t){let e=Ju.get(t);if(e!==void 0)return Promise.resolve(e);let n=ul.get(t);if(n)return n;let r=ZI(t).then(o=>(Ju.set(t,o),ul.delete(t),o)).catch(()=>(Ju.set(t,null),ul.delete(t),null));return ul.set(t,r),r}async function Nb(t,e){let n=await Lb(t);if(!n)return null;if(e==="normal")return n;let r={sheet:"",url:"",index:0,col:0,row:0,size:n.width,data:n};return e==="gold"?ke.effectGold(r):ke.effectRainbow(r)}function XI(t,e){if(e==="normal")return rA(t);let n=`${t}::${e}`,r=vl.get(n);if(r!==void 0)return Promise.resolve(r);let o=pl.get(n);if(o)return o;let s=Nb(t,e).then(i=>i?i.toDataURL():null).then(i=>(vl.set(n,i??null),pl.delete(n),i??null)).catch(()=>(vl.set(n,null),pl.delete(n),null));return pl.set(n,s),s}function eA(t){let e=t.tileRef;if(e==null)return Promise.resolve(null);let n=t.id.toLowerCase(),r=Sl.get(n);if(r!==void 0)return Promise.resolve(r);let o=ml.get(n);if(o)return o;let s=(async()=>{let i=QI(),a=e>0?e-1:e;for(let l of i)try{let d=(await ke.getTile(l,a,"canvas"))?.data;if(d&&d.width>0&&d.height>0){let u=document.createElement("canvas");u.width=d.width,u.height=d.height;let p=u.getContext("2d");if(!p)continue;return p.imageSmoothingEnabled=!1,p.drawImage(d,0,0),u.toDataURL()}}catch{}return null})().then(i=>(Sl.set(n,i),ml.delete(n),i)).catch(()=>(Sl.set(n,null),ml.delete(n),null));return ml.set(n,s),s}function tA(t){let e=new Set;try{ke.listPlants().forEach(s=>e.add(s))}catch{}try{ke.listAllPlants().forEach(s=>e.add(s))}catch{}let n=Array.from(e,s=>{let i=s.split(/[?#]/)[0]??s;return(i.split("/").pop()??i).replace(/\.[^.]+$/,"")});if(!t)return n.length?n:["plants"];let r=n.map(s=>s.toLowerCase()),o=s=>n.filter((i,a)=>s(i,r[a]??i.toLowerCase()));if(KI.has(t)){let s=o((a,l)=>l==="tallplants");if(s.length)return s;let i=o((a,l)=>/tall/.test(a)||/tall/.test(l));if(i.length)return i}else{let s=o((a,l)=>l==="plants");if(s.length)return s;let i=o((a,l)=>!/tall/.test(a)&&!/tall/.test(l));if(i.length)return i}return n.length?n:["plants"]}function nA(t,e=[]){let n=typeof t=="number"&&Number.isFinite(t)?t:Number(t);if(!Number.isFinite(n))return null;if(n<=0)return n;let r=e.map(o=>o.toLowerCase());return r.some(o=>o.includes("tall"))||r.some(o=>o.includes("plants")),n-1}function rA(t){let e=bl.get(t);if(e!==void 0)return Promise.resolve(e);let n=dl.get(t);if(n)return n;let r=Lb(t).then(o=>{let s=o?o.toDataURL():null;return bl.set(t,s),dl.delete(t),s}).catch(()=>(bl.set(t,null),dl.delete(t),null));return dl.set(t,r),r}function oA(t){let e=t.map((n,r)=>({mutation:n,index:r}));return e.sort((n,r)=>{let o=xl(n.mutation),s=xl(r.mutation),i=o?El(o):Number.MAX_SAFE_INTEGER,a=s?El(s):Number.MAX_SAFE_INTEGER;return i!==a?i-a:n.index-r.index}),e.map(n=>n.mutation)}function sA(t,e){if(!e.colors.length)return;let n=t.getContext("2d");if(n){if(n.save(),n.imageSmoothingEnabled=!1,n.globalCompositeOperation=e.blendMode,n.globalAlpha=e.alpha,e.colors.length===1)n.fillStyle=e.colors[0]??"transparent";else{let r=n.createLinearGradient(0,0,0,t.height),o=e.colors.length-1;e.colors.forEach((s,i)=>{let a=o===0?0:i/o;r.addColorStop(a,s)}),n.fillStyle=r}n.fillRect(0,0,t.width,t.height),n.restore()}}function iA(t,e,n){let r=ep(n);if(!r.length)return XI(t,e);let o=_b(t,e,r),s=wl.get(o);if(s!==void 0)return Promise.resolve(s);let i=fl.get(o);if(i)return i;let a=Nb(t,e).then(l=>{if(!l)return null;let c=document.createElement("canvas");c.width=l.width,c.height=l.height;let d=c.getContext("2d");return d?(d.imageSmoothingEnabled=!1,d.drawImage(l,0,0),r.forEach(u=>{let p=Rb[u];p&&sA(c,p)}),c.toDataURL()):null}).then(l=>(wl.set(o,l??null),fl.delete(o),l??null)).catch(()=>(wl.set(o,null),fl.delete(o),null));return fl.set(o,a),a}function aA(t,e,n){let r=ep(n);if(r.length===0){if(e==="normal")return bl.get(t);let s=`${t}::${e}`;return vl.get(s)}let o=_b(t,e,r);return wl.get(o)}function lA(t){let e=xl(t);return e?$I(e):!1}function hl(t,e,n,r){if(t.innerHTML="",e){let o=document.createElement("span");o.className="mg-crop-simulation__sprite-layer mg-crop-simulation__sprite-layer--base";let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,o.appendChild(s),t.appendChild(o)}if(n.forEach(({src:o,mutation:s},i)=>{let a=document.createElement("span");a.className="mg-crop-simulation__sprite-layer mg-crop-simulation__sprite-layer--overlay",a.style.setProperty("--mg-crop-simulation-layer",String(i+1)),lA(s)&&a.classList.add("mg-crop-simulation__sprite-layer--overlay-lighting");let l=document.createElement("img");l.src=o,l.alt="",l.decoding="async",l.loading="lazy",l.draggable=!1,a.appendChild(l),t.appendChild(a)}),!e&&n.length===0){let o=document.createElement("span");o.className="mg-crop-simulation__sprite-fallback";let s=typeof r=="string"&&r.trim().length>0?r:"\u{1F331}";o.textContent=s,t.appendChild(o)}}function cA(t,e,n){Cb+=1;let r=Cb;if(t.dataset.spriteSeq=String(r),!e){hl(t,null,[],n.fallback??null);return}let{colorVariant:o,weatherMutations:s}=n,i=oA(s),a=o==="normal"?JI(i):[],l=aA(e,o,a),c=i.map(f=>{let h=Sl.get(f.id.toLowerCase());return typeof h=="string"&&h.length>0?{mutation:f,src:h}:null}).filter(f=>f!=null);hl(t,typeof l=="string"?l:null,c,n.fallback??null);let u=iA(e,o,a),p=i.map(async f=>({mutation:f,src:await eA(f)}));Promise.all([u,Promise.all(p)]).then(([f,h])=>{if(t.dataset.spriteSeq!==String(r))return;let m=h.filter(g=>typeof g.src=="string"&&g.src.length>0);hl(t,f??null,m,n.fallback??null)}).catch(()=>{t.dataset.spriteSeq===String(r)&&hl(t,null,[],n.fallback??null)})}function dA(t){let e=typeof t=="string"?t.trim().toLowerCase():"";return e==="gold"?"gold":e==="rainbow"?"rainbow":"normal"}function uA(t){if(typeof t!="string")return null;let e=t.trim();if(!e)return null;let n=e.toLowerCase(),r=Eb.get(n);if(r)return r;let o=GI.get(n);if(o){let s=Eb.get(o.toLowerCase());if(s)return s}return{id:e,label:e,tileRef:null,category:"weather"}}function pA(t,e,n={}){let r=n.colorLabel??"None",o=dA(r),s=Array.isArray(n.weatherLabels)?n.weatherLabels:[],i=new Set,a=[];for(let l of s){if(!l||typeof l!="string")continue;let c=uA(l);if(!c||c.category!=="weather")continue;let d=c.id.toLowerCase();i.has(d)||(i.add(d),a.push(c))}cA(t,e,{colorVariant:o,weatherMutations:a,fallback:n.fallback??null})}var Ws=(t,e)=>{let n=r=>r.startsWith("--")?r:r.replace(/[A-Z]/g,o=>"-"+o.toLowerCase());for(let[r,o]of Object.entries(e))t.style.setProperty(n(r),o);return t},Ib=null;function fA(){YI(),!Ib&&(Ib=du(`
    .${Ce}.mg-crop-simulation--calculator {
      width: 100%;
      max-width: none;
      min-width: 0;
      position: relative;
    }
    .${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price {
      justify-content: center;
      margin: 0 0 12px;
      font-size: 20px;
      gap: 10px;
    }
    .${Ce}.mg-crop-simulation--calculator .mg-crop-simulation__price-value {
      font-size: 20px;
    }
    .mg-crop-calculator__placeholder {
      font-size: 13px;
      text-align: center;
      opacity: 0.7;
      padding: 24px 12px;
    }
  `))}function go(t,e,n){return Math.min(n,Math.max(e,t))}function zs(t,e){let n=typeof t=="string"?t.trim().toLowerCase():"";for(let r of e)if(r.toLowerCase()===n)return r;return e[0]}function Ob(t){if(typeof t!="number"||!Number.isFinite(t))return ho;let e=Math.round(t);return go(e,ho,Pb)}function mA(t){let e=Ob(t);return mo[e-1]??mo[0]}function hA(t){let e=zs(t,mo),n=mo.indexOf(e),r=n>=0?n+1:ho;return go(r,ho,Pb)}function gA(t,e){let r=go(Math.round(e),en,br)/100;t.style.setProperty("--mg-crop-simulation-scale",r.toString())}function Qu(t,e,n,r){let o=go(Math.round(e),en,br);t.sizeSlider.value=String(o),t.sizeValue.textContent=`${o}%`,gA(t.sprite,o),typeof n=="number"&&Number.isFinite(n)&&n>pn?t.sizeSlider.dataset.maxScale=String(n):delete t.sizeSlider.dataset.maxScale;let[s,i]=bA(r,o,n);t.sizeWeight.textContent=vA(s,i)}function js(t){if(typeof t!="number"||!Number.isFinite(t))return"\u2014";let e=Math.max(0,Math.round(t));return DI.format(e)}function yA(t,e){let n=typeof t=="number"&&Number.isFinite(t)?Math.max(0,t):null,r=typeof e=="number"&&Number.isFinite(e)?Math.max(0,e):null;return n==null&&r==null?"\u2014":n==null?js(r):r==null||Math.round(n)===Math.round(r)?js(n):`${js(n)} \u2013 ${js(r)}`}function bA(t,e,n){let r=typeof t=="number"?t:Number(t);if(!Number.isFinite(r)||r==null||r<=0)return[null,null];let o=qb(e,n);if(!Number.isFinite(o)||o<=0)return[null,null];let s=r*o,i=typeof n=="number"&&Number.isFinite(n)&&n>pn?n:pn,a=1+Math.max(0,(i-o)*.02),l=s*a;return[s,l]}function Ab(t){return typeof t!="number"||!Number.isFinite(t)||t<=0?null:BI.format(t).replace(/(\.\d*?[1-9])0+$/u,"$1").replace(/\.0+$/u,"")}function vA(t,e){let n=Ab(t),r=Ab(e);return!n&&!r?"\u2014":!r||n===r?`${n??r} kg`:`${n??"\u2014"} \u2013 ${r} kg`}function qb(t,e){let n=Number(t);if(!Number.isFinite(n))return pn;let r=go(n,en,br),o=typeof e=="number"&&Number.isFinite(e)&&e>pn?e:_I;if(o<=pn)return pn;let s=(r-en)/(br-en),i=pn+s*(o-pn);return Number.isFinite(i)?i:pn}function gl(t,e,n,r,o){let s=zs(e,t),i=t.map(l=>({value:l,label:l,disabled:!n})),a=Xu.segmented(i,s,n&&r?l=>r(l):void 0,{ariaLabel:o,fullWidth:!0});return a.classList.add("mg-crop-simulation__segmented-control"),a}function Zu(t,e){t.querySelectorAll(".qmm-seg__btn").forEach(r=>{let o=r.textContent?.trim();if(!o)return;let s=e[o];s&&Object.entries(s).forEach(([i,a])=>{a&&(r.dataset[i]=a)})})}function wA(t){let e=[];return t.color!=="None"&&e.push(t.color),t.weatherCondition!=="None"&&e.push(t.weatherCondition),t.weatherLighting!=="None"&&e.push(t.weatherLighting),e}function SA(t){let e=[];return t.weatherCondition!=="None"&&e.push(t.weatherCondition),t.weatherLighting!=="None"&&e.push(t.weatherLighting),e}function Mb(t,e,n,r){let o=qb(n,r);if(!Number.isFinite(o)||o<=0)return null;let s=wA(e),i=Ob(e.friendPlayers),a={...ks,friendPlayers:i},l=fr(t,o,s,a);return Number.isFinite(l)&&l>0?l:null}function yl(t){let e=Be[t],n=[e?.crop?.maxScale,e?.plant?.maxScale,e?.seed?.maxScale];for(let r of n){let o=typeof r=="number"?r:Number(r);if(Number.isFinite(o)&&o>0)return o}return null}function xA(t){let e=Be[t],n=[e?.produce?.baseWeight,e?.crop?.baseWeight,e?.item?.baseWeight,e?.seed?.baseWeight];for(let r of n){let o=typeof r=="number"?r:Number(r);if(Number.isFinite(o)&&o>0)return o}return null}async function Db(t){fA(),yr();let e=new Ye({id:"calculator",compact:!0});e.addTab("crops","Crops",n=>{n.innerHTML="",n.style.padding="8px",n.style.boxSizing="border-box",n.style.height="61vh",n.style.overflow="auto",n.style.display="grid";let r=Ws(document.createElement("div"),{display:"grid",gridTemplateColumns:"minmax(220px, 280px) minmax(0, 1fr)",gap:"10px",alignItems:"stretch",height:"100%",overflow:"hidden"});n.appendChild(r);let o=Ws(document.createElement("div"),{display:"grid",gridTemplateRows:"minmax(0, 1fr)",minHeight:"0",flex:"0 0 260px",minWidth:"220px",maxWidth:"280px"});r.appendChild(o);let s=Ws(document.createElement("div"),{display:"grid",gridTemplateColumns:"1fr",overflow:"auto",paddingRight:"2px",border:"1px solid #4445",borderRadius:"10px",minHeight:"0",height:"100%"});o.appendChild(s);let i=Ws(document.createElement("div"),{display:"flex",flexDirection:"column",minHeight:"0",flex:"1 1 auto"});r.appendChild(i);let a=Ws(document.createElement("div"),{flex:"1 1 auto",overflow:"auto",display:"flex",justifyContent:"center"});i.appendChild(a);let l=document.createElement("div");l.className=`${Ce} mg-crop-simulation--visible mg-crop-simulation--calculator`;let c=document.createElement("div");c.className="mg-crop-calculator__layout";let d=(O,b)=>{let M=document.createElement("div");if(M.className="mg-crop-calculator__section",b&&M.classList.add(b),O){let _=document.createElement("div");_.className="mg-crop-calculator__section-heading",_.textContent=O,M.appendChild(_)}return M},u=d(null,"mg-crop-calculator__section--preview"),p=document.createElement("div");p.className="mg-crop-simulation__price";let f=document.createElement("img");f.className="mg-crop-simulation__price-icon",f.src=nr.img64,f.alt="",f.decoding="async",f.loading="lazy",f.setAttribute("aria-hidden","true"),f.draggable=!1;let h=document.createElement("span");h.className="mg-crop-simulation__price-value",h.textContent="\u2014",p.append(f,h);let m=document.createElement("div");m.className="mg-crop-simulation__sprite-section";let g=document.createElement("div");g.className="mg-crop-simulation__sprite-box";let y=document.createElement("span");y.className="mg-crop-simulation__sprite",g.appendChild(y);let v=document.createElement("div");v.className="mg-crop-simulation__slider-container";let w=document.createElement("div");w.className="mg-crop-simulation__slider-row";let x=document.createElement("span");x.className="mg-crop-simulation__slider-label",x.textContent="Size";let E=e.slider(en,br,1,en);E.classList.add("mg-crop-simulation__slider"),E.disabled=!0;let L=document.createElement("span");L.className="mg-crop-simulation__slider-value",L.textContent=`${en}%`;let P=document.createElement("span");P.className="mg-crop-simulation__slider-weight",P.textContent="\u2014",w.append(x,E,L),v.append(w,P),m.append(g,v),u.appendChild(m);let V=d("Mutations"),z=document.createElement("div");z.className="mg-crop-simulation__segmented",V.appendChild(z);let C=document.createElement("div");C.className="mg-crop-calculator__mutations-weather";let D=document.createElement("div");D.className="mg-crop-simulation__segmented";let S=document.createElement("div");S.className="mg-crop-simulation__segmented",C.append(D,S),V.appendChild(C);let G=d("Friend bonus","mg-crop-calculator__section--friend-bonus"),se=document.createElement("div");se.className="mg-crop-simulation__segmented",G.appendChild(se),c.append(p,u,V,G),l.appendChild(c),a.appendChild(l);let X={root:l,sprite:y,sizeSlider:E,sizeValue:L,sizeWeight:P,colorMutations:z,weatherConditions:D,weatherLighting:S,friendBonus:se,priceValue:h},ue=new Map,N=new Map,ee=ol();ee.forEach(O=>N.set(O.key,O));let q=O=>{let b=ue.get(O);if(b)return b;let M={...FI};return ue.set(O,M),M},A=null,te=null,ne=null;function Z(O,b){let M=O?.color??Vu[0],_=gl(Vu,M,b,b?k=>{if(!A)return;let T=q(A);T.color=zs(k,Vu),Z(T,!0),me(T,!0),Q(T,!0),U(),W()}:void 0,"Mutations");Zu(_,LI),X.colorMutations.innerHTML="",X.colorMutations.appendChild(_)}function me(O,b){let M=O?.weatherCondition??Yu[0],_=gl(Yu,M,b,b?k=>{if(!A)return;let T=q(A);T.weatherCondition=zs(k,Yu),me(T,!0),U(),W()}:void 0,"Weather condition");Zu(_,NI),X.weatherConditions.innerHTML="",X.weatherConditions.appendChild(_)}function Q(O,b){let M=O?.weatherLighting??$u[0],_=gl($u,M,b,b?k=>{if(!A)return;let T=q(A);T.weatherLighting=zs(k,$u),Q(T,!0),U(),W()}:void 0,"Weather lighting");Zu(_,OI),X.weatherLighting.innerHTML="",X.weatherLighting.appendChild(_)}function oe(O,b){let M=mA(O?.friendPlayers??ho),_=gl(mo,M,b,b?k=>{if(!A)return;let T=q(A);T.friendPlayers=hA(k),oe(T,!0),W()}:void 0,"Friend bonus");X.friendBonus.innerHTML="",X.friendBonus.appendChild(_)}function W(){let O=A;if(!O){X.priceValue.textContent="\u2014";return}let b=q(O),M=Mb(O,b,b.sizePercent,te),_=Math.min(br,b.sizePercent+1),k=Mb(O,b,_,te);X.priceValue.textContent=yA(M,k)}function U(){let O=A;if(!O){X.sprite.innerHTML="";return}let b=q(O),M=N.get(O),_=qs(O)||(M?.seedName?Ds(M.seedName):void 0)||"\u{1F331}";pA(X.sprite,O,{colorLabel:b.color,weatherLabels:SA(b),fallback:_})}function J(){let O=A;if(!O){X.sprite.innerHTML="",X.sizeSlider.disabled=!0,ne=null,Qu(X,en,null,ne),Z(null,!1),me(null,!1),Q(null,!1),oe(null,!1),X.priceValue.textContent="\u2014";return}te=yl(O),ne=xA(O);let b=q(O);X.sizeSlider.disabled=!1,Qu(X,b.sizePercent,te,ne),Z(b,!0),me(b,!0),Q(b,!0),oe(b,!0),U(),W()}E.addEventListener("input",()=>{if(!A)return;let O=q(A),b=Number(E.value),M=go(Math.round(b),en,br);O.sizePercent=M,Qu(X,M,te,ne),W()});function B(){let O=s.scrollTop;if(s.innerHTML="",!ee.length){let M=document.createElement("div");M.className="mg-crop-calculator__placeholder",M.textContent="No crops available.",s.appendChild(M),A=null,te=null,J();return}A&&!ee.some(M=>M.key===A)&&(A=ee[0].key,te=yl(A)),A||(A=ee[0].key,te=yl(A));let b=document.createDocumentFragment();yr(),ee.forEach(M=>{let _=document.createElement("button");_.className="qmm-vtab",_.style.display="grid",_.style.gridTemplateColumns="16px 1fr auto",_.style.alignItems="center",_.style.gap="8px",_.style.textAlign="left",_.style.padding="6px 8px",_.style.marginBottom="6px",_.style.borderRadius="8px",_.style.border="1px solid #4445",_.style.background=A===M.key?"#2b8a3e":"#1f2328",_.style.color="#e7eef7";let k=document.createElement("span");k.className="qmm-dot",k.style.background=A===M.key?"#2ecc71":"#4c566a";let T=document.createElement("span");T.className="label",T.textContent=M.cropName||M.key;let F=qs(M.key)||Ds(M.seedName)||"\u{1F331}",$=al(M.key,{size:24,fallback:F});_.append(k,T,$),_.onmouseenter=()=>_.style.borderColor="#6aa1",_.onmouseleave=()=>_.style.borderColor="#4445",_.onclick=()=>{A!==M.key&&(A=M.key,te=yl(M.key),B())},b.appendChild(_)}),s.appendChild(b),s.scrollTop=O,J()}B()}),e.mount(t)}var zn=null,Cl=null,Tl=null,kl=null,Il=null,wn=()=>{if(zn){try{zn.remove()}catch{}zn=null}Cl&&(Cl(),Cl=null),Tl&&(Tl(),Tl=null),kl&&(kl(),kl=null),Il&&(Il(),Il=null)},Bb=(t,e)=>{e?(t.setAttribute("aria-disabled","true"),t.style.opacity="0.5",t.style.pointerEvents="none",t.style.cursor="not-allowed",t.title="Max owned \u2014 notifications disabled"):(t.removeAttribute("aria-disabled"),t.style.opacity="",t.style.pointerEvents="",t.style.cursor="",t.removeAttribute("title"))},Fb=t=>{let e=document.createElement("label");e.style.display="inline-flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.width="100%",e.style.padding="4px 6px",e.style.userSelect="none",e.setAttribute("role","switch"),e.setAttribute("aria-checked","false");let n=document.createElement("span");n.style.position="relative",n.style.width="42px",n.style.height="24px",n.style.borderRadius="999px",n.style.background="#1f2328",n.style.border="1px solid #4446",n.style.display="inline-block",n.style.boxShadow="inset 0 0 0 1px #0005";let r=document.createElement("span");r.style.position="absolute",r.style.top="50%",r.style.left="3px",r.style.transform="translateY(-50%)",r.style.width="18px",r.style.height="18px",r.style.borderRadius="50%",r.style.background="#e7eef7",r.style.boxShadow="0 1px 2px rgba(0,0,0,.7)",r.style.transition="left 160ms ease, transform 160ms ease";let o=document.createElement("input");o.type="checkbox",o.style.position="absolute",o.style.opacity="0",o.style.pointerEvents="none",o.tabIndex=-1;let s=i=>{o.checked=i,e.setAttribute("aria-checked",i?"true":"false"),r.style.left=i?"21px":"3px",r.style.transform=i?"translateY(-50%) scale(1.02)":"translateY(-50%) scale(1)",i?(n.style.background="linear-gradient(180deg, #2b5cff, #1e40ff)",n.style.borderColor="#7aa2ff",n.style.boxShadow="0 0 0 2px #7aa2ff55, inset 0 0 0 1px #0005"):(n.style.background="#1f2328",n.style.borderColor="#4446",n.style.boxShadow="inset 0 0 0 1px #0005")};return o.disabled=!0,e.addEventListener("mousedown",i=>i.preventDefault()),e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),s(!o.checked),t?.(o.checked)}),n.appendChild(r),e.appendChild(o),e.appendChild(n),s(!1),e},tp=(t,e)=>{let n=t.querySelector("input"),r=t.querySelector("span"),o=r?.querySelector("span");!n||!r||!o||(n.checked=!!e,o.style.left=e?"21px":"3px",o.style.transform=e?"translateY(-50%) scale(1.02)":"translateY(-50%) scale(1)",e?(r.style.background="linear-gradient(180deg, #2b5cff, #1e40ff)",r.style.borderColor="#7aa2ff",r.style.boxShadow="0 0 0 2px #7aa2ff55, inset 0 0 0 1px #0005",t.setAttribute("aria-checked","true")):(r.style.background="#1f2328",r.style.borderColor="#4446",r.style.boxShadow="inset 0 0 0 1px #0005",t.setAttribute("aria-checked","false")))},Us=t=>{let e=document.createElement("div");return e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.borderBottom="1px solid #ffffff12",e.style.padding="4px 6px",e.style.boxSizing="border-box",e.appendChild(t),e},Un=(t,e="center")=>{let n=document.createElement("div");return n.textContent=t,n.style.fontWeight="600",n.style.opacity="0.9",n.style.padding="4px 6px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent=e==="left"?"flex-start":"center",n};function np(t){let e=String(t||"").trim(),n=(()=>{let i=e.toLowerCase();return i==="mythical"?"Mythical":i==="celestial"?"Celestial":i==="divine"?"Divine":i==="legendary"?"Legendary":i==="rare"?"Rare":i==="uncommon"?"Uncommon":i==="common"?"Common":e||"\u2014"})(),r={Common:"#E7E7E7",Uncommon:"#67BD4D",Rare:"#0071C6",Legendary:"#FFC734",Mythical:"#9944A7",Divine:"#FF7835",Celestial:null},o=new Set(["Common","Uncommon","Legendary","Divine"]),s=document.createElement("div");if(s.textContent=n,Object.assign(s.style,{display:"inline-flex",justifyContent:"center",alignItems:"center",padding:"4px 8px",borderRadius:"5px",fontSize:"12px",fontWeight:"700",margin:"2px auto",color:o.has(n)?"#0b0b0b":"#ffffff",boxShadow:"0 0 0 1px #0006 inset",lineHeight:"1.1",whiteSpace:"nowrap"}),n==="Celestial"){if(!document.getElementById("qws-celestial-kf")){let i=document.createElement("style");i.id="qws-celestial-kf",i.textContent=`
@keyframes qwsCelestialShift {
  0%   { background-position: 0% 50%; }
  50%  { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}`,document.head.appendChild(i)}s.style.background=`linear-gradient(130deg,
      rgb(0,180,216) 0%,
      rgb(124,42,232) 40%,
      rgb(160,0,126) 60%,
      rgb(255,215,0) 100%)`,s.style.backgroundSize="200% 200%",s.style.animation="qwsCelestialShift 4s linear infinite"}else s.style.background=r[n]||"#444";return s}var Gs=(t,e,n)=>{let r=e?.querySelector("button[data-role='rule']")??null,o=t.querySelector('[data-role="rule-hint"]'),s=!!(n&&(n.sound||n.playbackMode||n.stopMode||n.loopIntervalMs!=null)),i=s?Rh(n):"";r&&(r.dataset.active=s?"1":"0",r.title=s&&i?`Custom rule \u2014 ${i}`:"Custom rule"),o&&(s&&i?(o.textContent=i,o.style.visibility="visible"):(o.textContent="",o.style.visibility="hidden"))},Hb=(t,e,n)=>{wn();let r=document.createElement("div");r.className="qws-rule-popover",Object.assign(r.style,{position:"fixed",zIndex:"var(--qws-z-popover)",minWidth:"260px",maxWidth:"320px",padding:"14px 16px",borderRadius:"14px",border:"1px solid #32404e",background:"linear-gradient(180deg, #111923, #0b131c)",boxShadow:"0 16px 40px rgba(0,0,0,0.45)"});let o=12,s=(K,R,Y)=>!Number.isFinite(R)||!Number.isFinite(Y)?K:Y>=R?Math.min(Math.max(K,R),Y):Math.min(Math.max(K,Y),R),i=(K,R)=>{let Y=r.offsetWidth,re=r.offsetHeight,I=s(K,o,window.innerWidth-Y-o),j=s(R,o,window.innerHeight-re-o);return r.style.left=`${Math.round(I)}px`,r.style.top=`${Math.round(j)}px`,{left:I,top:j}},a=document.createElement("div");a.style.display="flex",a.style.justifyContent="space-between",a.style.alignItems="flex-start",a.style.gap="12px",a.style.cursor="move",a.style.userSelect="none",a.style.touchAction="none";let l=document.createElement("div"),c=document.createElement("div");c.textContent=e.name,c.style.fontWeight="700",c.style.fontSize="14px",c.style.lineHeight="1.2";let d=document.createElement("div");d.textContent=e.type,d.style.opacity="0.7",d.style.fontSize="12px",l.append(c,d);let u=document.createElement("button");u.type="button",u.textContent="\u2715",Object.assign(u.style,{background:"transparent",border:"none",color:"#c8d7e8",fontSize:"16px",lineHeight:"1",cursor:"pointer"}),u.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),wn()}),a.append(l,u);let p=null,f=K=>{if(!p||K.pointerId!==p.pointerId)return;let R=K.clientX-p.startX,Y=K.clientY-p.startY;i(p.baseLeft+R,p.baseTop+Y)},h=K=>{if(p&&!(K&&K.pointerId!==p.pointerId)){document.removeEventListener("pointermove",f),document.removeEventListener("pointerup",h),document.removeEventListener("pointercancel",h);try{a.releasePointerCapture(p.pointerId)}catch{}p=null}},m=K=>{if(K.button!==0)return;let R=K.target;if(R&&u.contains(R))return;p&&h();let Y=r.getBoundingClientRect();p={pointerId:K.pointerId,startX:K.clientX,startY:K.clientY,baseLeft:Y.left,baseTop:Y.top};try{a.setPointerCapture(K.pointerId)}catch{}document.addEventListener("pointermove",f),document.addEventListener("pointerup",h),document.addEventListener("pointercancel",h),K.preventDefault()};a.addEventListener("pointerdown",m),Il=()=>{a.removeEventListener("pointerdown",m),h()},r.appendChild(a);let g=De.getRule(e.id),y=Me.getPlaybackSettings(e.context),v=De.getContextStopDefaults(e.context),w=e.context==="shops",x=(y.defaultSoundName||"").trim()||"Default",E=K=>K==="loop"?"Loop":"One-shot",L=E(y.mode),P=Math.max(150,Math.floor(v.loopIntervalMs??y.loopIntervalMs??150)),V=document.createElement("div");V.className="qws-rule-field";let z=document.createElement("label");z.textContent="Sound";let C=document.createElement("select");C.className="qmm-input",C.style.width="100%",(()=>{let K=g?.sound??"";C.innerHTML="";let R=document.createElement("option");R.value="",R.textContent=x,C.appendChild(R);let Y=Me.listSounds();for(let re of Y){if(re===x&&K!==re)continue;let I=document.createElement("option");I.value=re,I.textContent=re,C.appendChild(I)}if(K&&!Y.includes(K)){let re=document.createElement("option");re.value=K,re.textContent=K.length>32?`${K.slice(0,29)}\u2026`:K,re.dataset.extra="1",C.appendChild(re)}C.value=K})(),V.append(z,C),r.appendChild(V);let S=document.createElement("div");S.className="qws-rule-field";let G=document.createElement("label");G.textContent="Playback mode";let se=document.createElement("select");se.className="qmm-input",(w?y.mode==="loop"?["loop","oneshot"]:["oneshot","loop"]:["oneshot"]).forEach(K=>{let R=document.createElement("option");R.value=K,R.textContent=E(K),se.appendChild(R)});let ue=w?g?.playbackMode??y.mode:"oneshot";se.value=ue==="loop"&&!w?"oneshot":ue,w||(se.disabled=!0),S.append(G,se),r.appendChild(S);let N=null,ee=document.createElement("div");if(ee.className="qws-rule-field",w){let K=document.createElement("label");K.textContent="Stop condition",N=document.createElement("select"),N.className="qmm-input";let R=document.createElement("option");R.value="purchase",R.textContent="Until purchase",N.appendChild(R);let Y=g?.stopMode??v.stopMode;N.value="purchase",ee.append(K,N),r.appendChild(ee)}let q=document.createElement("div");q.className="qws-rule-field";let A=document.createElement("label");A.textContent="Loop interval (ms)";let te=document.createElement("input");te.type="number",te.className="qmm-input",te.min="150",te.step="50",te.placeholder=String(P),te.value=g?.loopIntervalMs!=null?String(g.loopIntervalMs):"",te.inputMode="numeric",q.append(A,te),w&&r.appendChild(q),(K=>{K.addEventListener("keydown",R=>{if(R.stopPropagation(),R.stopImmediatePropagation(),R.ctrlKey||R.metaKey||R.altKey)return;let Y=R.key;/^[0-9]$/.test(Y)||Y==="Backspace"||Y==="Delete"||Y==="Tab"||Y==="Enter"||Y==="ArrowLeft"||Y==="ArrowRight"||Y==="ArrowUp"||Y==="ArrowDown"||Y==="Home"||Y==="End"||R.preventDefault()}),K.addEventListener("input",()=>{let R=K.value.replace(/\D+/g,"");R!==K.value&&(K.value=R)})})(te);let Z=()=>{let K=se.value;return K==="oneshot"||K==="loop"?K:w?y.mode:"oneshot"},me=()=>(!w||N?.value==="purchase","purchase"),Q=()=>{if(!w){ee.style.display="none",q.style.display="none";return}let R=Z()==="loop";ee.style.display=R?"grid":"none",q.style.display=R?"grid":"none"},oe=()=>{w&&se.value!=="loop"&&(se.value="loop",Q())};se.addEventListener("change",()=>{Q()}),w&&N&&N.addEventListener("change",()=>{oe()}),w&&te.addEventListener("input",oe),Q();let W=document.createElement("div");W.textContent="Leave fields empty to inherit global defaults.",W.style.opacity="0.7",W.style.fontSize="12px",r.appendChild(W);let U=document.createElement("div");U.className="qws-rule-actions";let J=t.btn("Clear",{variant:"ghost",size:"sm"});J.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation(),De.clearRule(e.id),wn()}),g||t.setButtonEnabled(J,!1);let B=t.btn("Save",{variant:"primary",size:"sm"});B.addEventListener("click",K=>{K.preventDefault(),K.stopPropagation();let R=C.value?.trim()||null,Y=se.value||"",re=N?.value||"",I=te.value?.trim(),j=Y==="oneshot"||Y==="loop"?Y:null;j===y.mode&&(j=null);let de=w&&re==="purchase"?"purchase":null;de!=null&&de===v.stopMode&&(de=null);let ie=null;if(w&&I){let ge=Number(I);if(Number.isFinite(ge)){let be=Math.max(150,Math.min(1e4,Math.floor(ge)));be!==P&&(ie=be)}}w&&!j&&y.mode!=="loop"&&(de!=null||ie!=null)&&(j="loop"),De.setRule(e.id,{sound:R,playbackMode:j,stopMode:de,loopIntervalMs:ie}),wn()}),U.append(J,B),r.appendChild(U),document.body.appendChild(r);let O=n.getBoundingClientRect(),b=r.offsetWidth,M=r.offsetHeight,_=O.right-b,k=O.bottom+8;_<o&&(_=o),_+b>window.innerWidth-o&&(_=window.innerWidth-b-o),k+M>window.innerHeight-o&&(k=O.top-M-8),k<o&&(k=o),i(_,k);let T=K=>{let R=K.target;R&&(r.contains(R)||n.contains(R)||wn())};setTimeout(()=>document.addEventListener("pointerdown",T,!0)),Cl=()=>document.removeEventListener("pointerdown",T,!0);let F=K=>{zn&&(zn.contains(K.target)||K.stopImmediatePropagation())};document.addEventListener("keydown",F,!0),Tl=()=>document.removeEventListener("keydown",F,!0);let $=K=>{let R=K.target;zn&&R&&zn.contains(R)&&K.stopImmediatePropagation()};document.addEventListener("wheel",$,{capture:!0,passive:!0}),kl=()=>{document.removeEventListener("wheel",$,{capture:!0})},zn=r};function EA(t,e){t.innerHTML="";let n=Q=>{let oe=e.card(Q,{tone:"muted"});return oe.body.style.display="grid",oe.body.style.gap="10px",oe},r=(Q,oe,W)=>{let{root:U,label:J}=e.formRow(Q,oe,{alignTop:W?.alignTop,labelWidth:"160px"});return J.style.opacity="0.9",J.style.fontWeight="600",U},o=(Q,oe,W)=>{let U=e.toggleChip(W,{type:"radio",name:Q,value:oe});return U.root.classList.add("qmm-radio-chip"),{label:U.root,input:U.input}},s=Q=>e.select({id:Q,width:"180px"}),i=(Q="Play")=>e.btn("",{icon:"\u25B6",size:"sm",tooltip:Q,ariaLabel:Q}),a=Q=>e.btn(Q,{size:"sm"}),l=()=>e.errorBar(),c=document.createElement("div");Object.assign(c.style,{display:"grid",gridTemplateRows:"1fr",gap:"12px",height:"54vh",minHeight:"0",overflow:"hidden"}),t.appendChild(c);let d=n("Audio & Playback");c.appendChild(d.root);let u={},p=[{key:"shops",label:"Shops",allowPurchase:!0},{key:"weather",label:"Weather",allowPurchase:!1}];for(let Q of p){let oe=document.createElement("div");Object.assign(oe.style,{display:"grid",gap:"12px",padding:"16px",borderRadius:"12px",border:"1px solid #1f2429",background:"#111821"});let W=document.createElement("div");W.textContent=Q.label,W.style.fontWeight="700",W.style.fontSize="14px",W.style.letterSpacing="0.02em",oe.appendChild(W);let U=document.createElement("div");U.style.display="flex",U.style.alignItems="center",U.style.gap="8px";let J=s(`ap.defaultSound.${Q.key}`);J.dataset.soundSelect=Q.key;let B=i(`Play ${Q.label.toLowerCase()} sound`);U.append(J,B),oe.appendChild(r("Default sound",U));let O=document.createElement("div");O.style.display="flex",O.style.alignItems="center",O.style.gap="10px";let b=document.createElement("input");b.type="range",b.min="0",b.max="100",b.step="1",b.style.width="220px";let M=document.createElement("span");M.style.minWidth="32px",M.style.textAlign="right",O.append(b,M),oe.appendChild(r("Volume",O));let _=document.createElement("div");_.style.display="flex",_.style.gap="12px";let k=o(`ap.mode.${Q.key}`,"oneshot","One-shot");_.append(k.label);let T=null;Q.allowPurchase&&(T=o(`ap.mode.${Q.key}`,"loop","Loop"),_.append(T.label)),oe.appendChild(r("Playback mode",_));let F,$,K;if(Q.allowPurchase){let R=document.createElement("div");R.style.display="flex",R.style.flexDirection="column",R.style.gap="10px",K=document.createElement("div"),K.style.display="flex",K.style.flexDirection="column",K.style.gap="4px";let Y=document.createElement("div");Y.textContent="Loop interval",Y.style.opacity="0.8",Y.style.fontSize="12px",Y.style.fontWeight="600";let re=document.createElement("div");re.style.display="inline-flex",re.style.alignItems="center",re.style.gap="8px",$=document.createElement("input"),$.type="number",$.min="150",$.max="10000",$.step="50",$.style.width="100px",$.style.textAlign="center";let I=document.createElement("span");I.textContent="ms between plays",I.style.opacity="0.85",re.append($,I),K.append(Y,re);let j=document.createElement("div");j.textContent="Loops stop automatically when the item is purchased.",j.style.opacity="0.75",j.style.fontSize="12px",j.style.lineHeight="1.4",R.append(j,K),F=r("Stop condition",R),oe.appendChild(F)}else{let R=document.createElement("div");R.textContent="Weather alerts play once per trigger.",R.style.opacity="0.75",R.style.fontSize="12px",R.style.lineHeight="1.4",oe.appendChild(r("Details",R))}u[Q.key]={container:oe,select:J,playBtn:B,volumeRange:b,volumeValue:M,modeOneshot:k.input,modeLoop:T?.input,stopRow:F,loopInput:$,loopWrap:K},d.body.appendChild(oe)}let f=l();d.body.appendChild(f.el);let h=n("Sound library");c.appendChild(h.root);let m=document.createElement("div");Object.assign(m.style,{display:"flex",flexDirection:"column",gap:"12px",width:"100%"});let g=document.createElement("input");g.type="file",g.accept="audio/*",g.multiple=!0,g.style.display="none";let y=document.createElement("div");Object.assign(y.style,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"6px",padding:"18px 22px",width:"100%",minHeight:"110px",borderRadius:"14px",border:"1px dashed #5d6a7d",background:"linear-gradient(180deg, #0b141c, #091018)",transition:"border-color 0.2s ease, background 0.2s ease, box-shadow 0.2s ease",cursor:"pointer",textAlign:"center"}),y.tabIndex=0,y.setAttribute("role","button"),y.setAttribute("aria-label","Select audio files");let v=document.createElement("div");v.textContent="Select audio files",Object.assign(v.style,{fontWeight:"600",fontSize:"14px",letterSpacing:"0.02em"});let w=document.createElement("div"),x="Click to browse or drop files";w.textContent=x,Object.assign(w.style,{fontSize:"12px",opacity:"0.75"}),y.append(v,w);let E=Q=>{Q?(y.style.borderColor="#6fc3ff",y.style.boxShadow="0 0 0 3px #6fc3ff22",y.style.background="linear-gradient(180deg, #102030, #0b1826)"):(y.style.borderColor="#5d6a7d",y.style.boxShadow="none",y.style.background="linear-gradient(180deg, #0b141c, #091018)")};y.addEventListener("mouseenter",()=>E(!0)),y.addEventListener("mouseleave",()=>E(document.activeElement===y)),y.addEventListener("focus",()=>E(!0)),y.addEventListener("blur",()=>E(!1)),y.addEventListener("dragover",Q=>{Q.preventDefault(),E(!0),Q.dataTransfer&&(Q.dataTransfer.dropEffect="copy")}),y.addEventListener("dragleave",()=>E(document.activeElement===y));let L=()=>g.click();y.addEventListener("click",L),y.addEventListener("keydown",Q=>{(Q.key==="Enter"||Q.key===" ")&&(Q.preventDefault(),L())});let P=Q=>{if(!Q||!Q.length){w.textContent=x;return}w.textContent=Q.length===1?Q[0].name:`${Q.length} files selected`};y.addEventListener("drop",async Q=>{Q.preventDefault();let oe=Q.dataTransfer?.files||null;P(oe),await Z(oe),P(null),E(document.activeElement===y)}),m.append(g,y),h.body.appendChild(m);let V=document.createElement("div");V.textContent="MP3, WAV, OGG \u2014 limited to \u2264 10 s and \u2264 200 KB.",V.style.opacity="0.75",V.style.fontSize="12px",h.body.appendChild(V);let z=document.createElement("div");Object.assign(z.style,{display:"grid",gridTemplateRows:"auto 1fr",gap:"6px",border:"1px solid #4445",borderRadius:"10px",background:"#10161c",padding:"10px"});let C=document.createElement("div");Object.assign(C.style,{display:"grid",gridTemplateColumns:"minmax(0, 1fr) auto",gap:"12px",fontSize:"12px",letterSpacing:"0.05em",textTransform:"uppercase",opacity:"0.65",paddingBottom:"4px",borderBottom:"1px solid #ffffff14"});let D=document.createElement("span");D.textContent="Sound";let S=document.createElement("span");S.textContent="Actions",S.style.justifySelf="end",C.append(D,S);let G=document.createElement("div");Object.assign(G.style,{display:"flex",flexDirection:"column",gap:"6px",maxHeight:"240px",overflowY:"auto",paddingRight:"4px",minHeight:"0",padding:"4px 0"}),z.append(C,G),h.body.appendChild(z);let se=l();h.body.appendChild(se.el);let X=(Q,oe)=>{let W=(Q.value||"").trim(),U=W?Number(W):NaN,J=Number.isFinite(U)?U:oe,B=Math.max(150,Math.min(1e4,Math.floor(J)));return Q.value=String(B),B},ue=Q=>{let oe=u[Q],W=oe.modeLoop?.checked??!1;oe.stopRow&&(oe.stopRow.style.display=W?"":"none"),oe.loopWrap&&(oe.loopWrap.style.display=W?"flex":"none")},N=(Q,oe)=>{if(Q==="weather"&&oe==="loop"){Me.setPlaybackMode("oneshot",Q),u[Q].modeOneshot.checked=!0,u[Q].modeLoop&&(u[Q].modeLoop.checked=!1),ue(Q);return}Me.setPlaybackMode(oe,Q),ue(Q)},ee=()=>{let Q=u.shops;if(!Q.loopInput)return;let oe=X(Q.loopInput,Me.getLoopInterval("shops"));return Me.setLoopInterval(oe,"shops"),Q.modeLoop?.checked||(Q.modeLoop&&(Q.modeLoop.checked=!0),Q.modeOneshot.checked=!1,N("shops","loop")),Me.setStopPurchase("shops"),De.setContextStopDefaults("shops",{stopMode:"purchase",stopRepeats:null,loopIntervalMs:oe}),oe};for(let Q of p){let oe=u[Q.key];oe.select.addEventListener("change",()=>{Me.setDefaultSoundByName(oe.select.value,Q.key),A()}),oe.playBtn.addEventListener("click",()=>{Me.trigger("preview",{sound:oe.select.value},Q.key).catch(()=>{})}),oe.volumeRange.addEventListener("input",()=>{let W=Math.max(0,Math.min(100,parseInt(oe.volumeRange.value||"0",10)||0));oe.volumeValue.textContent=`${W}%`,Me.setVolume(W/100,Q.key)}),oe.modeOneshot.addEventListener("change",()=>{if(oe.modeOneshot.checked&&(N(Q.key,"oneshot"),Q.key==="shops")){let W=oe.loopInput?X(oe.loopInput,Me.getLoopInterval("shops")):Me.getLoopInterval("shops");Me.setLoopInterval(W,"shops"),Me.setStopManual("shops"),De.setContextStopDefaults("shops",{stopMode:"manual",stopRepeats:null,loopIntervalMs:W})}}),oe.modeLoop?.addEventListener("change",()=>{oe.modeLoop?.checked&&(N(Q.key,"loop"),Q.key==="shops"&&ee())}),Q.allowPurchase&&(oe.loopInput?.addEventListener("change",ee),oe.loopInput?.addEventListener("blur",ee))}let q=()=>{let Q=Me.listSounds(),oe=(U,J)=>{let B=U.value;U.innerHTML="";for(let b of Q){let M=document.createElement("option");M.value=b,M.textContent=b,U.appendChild(M)}let O=Me.getDefaultSoundName(J);Q.includes(B)?U.value=B:O&&Q.includes(O)?U.value=O:Q.length&&(U.value=Q[0])};for(let U of p)oe(u[U.key].select,U.key);let W=Array.from(document.querySelectorAll("select[data-sound-select]"));for(let U of W){let J=U.dataset.soundSelect||"shops";u[J]?.select!==U&&oe(U,J)}},A=()=>{G.replaceChildren();let Q=Me.listSounds();if(!Q.length){let U=document.createElement("div");U.textContent="No sounds in the library.",U.style.opacity="0.75",U.style.textAlign="center",U.style.padding="12px 6px",G.appendChild(U);return}let oe=Me.getDefaultSoundName("shops"),W=Me.getDefaultSoundName("weather");for(let U of Q){let J=document.createElement("div");Object.assign(J.style,{display:"grid",gridTemplateColumns:"minmax(0, 1fr) auto",gap:"12px",alignItems:"center",padding:"8px 10px",borderRadius:"8px",border:"1px solid #1f2429",background:"#151b22"});let B=document.createElement("div");Object.assign(B.style,{display:"flex",alignItems:"center",gap:"8px",minWidth:"0"});let O=document.createElement("span");O.textContent=U,O.style.fontWeight="600",O.style.overflow="hidden",O.style.textOverflow="ellipsis",O.style.whiteSpace="nowrap",B.appendChild(O);let b=document.createElement("div");b.style.display="flex",b.style.gap="6px";let M=re=>{let I=document.createElement("span");return I.textContent=re,Object.assign(I.style,{fontSize:"11px",padding:"2px 6px",borderRadius:"999px",background:"#2b5cff33",border:"1px solid #2b5cff66",color:"#9cbcff",fontWeight:"600",textTransform:"uppercase",letterSpacing:"0.04em"}),I},_=oe===U,k=W===U;_&&b.appendChild(M("Shops")),k&&b.appendChild(M("Weather")),b.childElementCount&&B.appendChild(b),(_||k)&&(J.style.borderColor="#2b5cff99",J.style.boxShadow="0 0 0 1px #2b5cff33");let T=document.createElement("div");Object.assign(T.style,{display:"flex",gap:"6px",justifyContent:"flex-end",flexWrap:"wrap"});let F=a("\u25B6"),$=a("Set shops"),K=a("Set weather"),R=a("Remove");F.title="Preview",$.title="Set as shops default",K.title="Set as weather default",R.title="Remove from library";let Y=typeof Me.isProtectedSound=="function"&&Me.isProtectedSound(U);(Y||_||k)&&(R.disabled=!0,R.style.opacity="0.6",Y?R.title="Built-in sound cannot be removed":R.title="Currently used as default"),F.onclick=()=>Me.trigger("preview",{sound:U},"shops").catch(()=>{}),$.onclick=()=>{Me.setDefaultSoundByName(U,"shops"),q(),A()},K.onclick=()=>{Me.setDefaultSoundByName(U,"weather"),q(),A()},R.onclick=()=>{Me.unregisterSound(U),q(),A()},T.append(F,$,K,R),J.append(B,T),G.appendChild(J)}},te=Q=>{let oe=u[Q],W=Me.getPlaybackSettings(Q),U=Me.listSounds();W.defaultSoundName&&U.includes(W.defaultSoundName)&&(oe.select.value=W.defaultSoundName);let J=Math.round(W.volume*100);oe.volumeRange.value=String(J),oe.volumeValue.textContent=`${J}%`,oe.modeLoop&&W.mode==="loop"?oe.modeLoop.checked=!0:oe.modeOneshot.checked=!0;let B=De.getContextStopDefaults(Q),O=Math.max(150,Math.min(1e4,Math.floor(B.loopIntervalMs||W.loopIntervalMs||150))),b=oe.loopInput?X(oe.loopInput,O):O;Me.setLoopInterval(b,Q),Q==="shops"?oe.modeLoop?.checked?(Me.setStopPurchase("shops"),De.setContextStopDefaults("shops",{stopMode:"purchase",stopRepeats:null,loopIntervalMs:b})):(Me.setStopManual("shops"),De.setContextStopDefaults("shops",{stopMode:"manual",stopRepeats:null,loopIntervalMs:b})):(N("weather","oneshot"),Me.setStopManual("weather"),De.setContextStopDefaults("weather",{stopMode:"manual",stopRepeats:null,loopIntervalMs:b})),ue(Q)},ne=()=>{q(),te("shops"),te("weather"),A()},Z=async Q=>{if(se.clear(),!Q||!Q.length)return;let oe=[];for(let W of Array.from(Q))try{let U=await Me.importFileAsSound(W,{maxBytes:204800,maxSeconds:10,bitrates:[48e3,32e3,2e4,12e3,8e3],maxInputBytes:8388608});oe.push(U.name)}catch(U){se.show(`Failed for "${W.name}": ${U?.message||U}`)}if(oe.length){q(),A();for(let W of p)Me.getDefaultSoundName(W.key)||Me.setDefaultSoundByName(oe[0],W.key);q(),A()}g.value=""};g.onchange=async()=>{let Q=g.files;P(Q),await Z(Q),P(null),E(document.activeElement===y)},ne();let me=document.createElement("div");Object.assign(me.style,{overflow:"auto",minHeight:"0",height:"100%",display:"grid",gap:"12px"}),me.append(d.root,h.root),c.appendChild(me),t.__cleanup__=(()=>{let Q=t.__cleanup__;return()=>{try{Q?.()}catch{}}})()}function CA(t,e){if(t.innerHTML="",t.style.cssText="",!document.getElementById("qws-rule-style")){let N=document.createElement("style");N.id="qws-rule-style",N.textContent=`
:root {
  /* PATCH: z-index centralis\xE9 */
  --qws-z-popover: 99999999999999;
}

/* PATCH: bouton engrenage carr\xE9, centr\xE9, plus gros */
.qws-rule-btn {
  display: inline-grid;
  place-items: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border-radius: 8px;
  line-height: 1;
  font-size: 18px; /* taille de l'ic\xF4ne */
  min-width: 32px; /* \xE9vite les r\xE9tr\xE9cissements */
  box-sizing: border-box;
}
.qws-rule-btn[data-active="1"] {
  background: linear-gradient(180deg, #1b2735, #101821);
  box-shadow: 0 0 0 1px #658dff88 inset;
  color: #c7daff;
}

/* PATCH: popover toujours devant */
.qws-rule-popover {
  position: fixed !important;
  z-index: var(--qws-z-popover) !important;
  display: flex;
  flex-direction: column;
  gap: 10px;
  color: #f1f6ff;
}
.qws-rule-popover .qws-rule-field {
  display: grid;
  gap: 6px;
}
.qws-rule-popover .qws-rule-field label {
  font-weight: 600;
  font-size: 13px;
}
.qws-rule-popover .qws-rule-actions {
  display: flex;
  justify-content: space-between;
  gap: 8px;
}

/* PATCH: r\xE9serve un espace pour le r\xE9sum\xE9 afin d'\xE9viter tout shift */
[data-role="rule-hint"] {
  min-height: 1.2em;  /* ~1 ligne r\xE9serv\xE9e */
}
`,document.head.appendChild(N)}let n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateRows:"auto 1fr",gap:"10px",height:"54vh",overflow:"hidden",minHeight:"0",position:"relative"}),t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="10px",r.style.rowGap="8px",n.appendChild(r);let o=e.label("Type"),s=document.createElement("select");s.className="qmm-input",s.style.minWidth="140px",s.id="shop.filter.type",[["all","All"],["seed","Seeds"],["egg","Eggs"],["tool","Tools"],["decor","Decor"]].forEach(([N,ee])=>{let q=document.createElement("option");q.value=N,q.textContent=ee,s.appendChild(q)}),s.value="all";let i=e.label("Rarity"),a=document.createElement("select");a.className="qmm-input",a.style.minWidth="160px",a.id="shop.filter.rarity",[["all","All"],["common","Common"],["uncommon","Uncommon"],["rare","Rare"],["legendary","Legendary"],["mythical","Mythical"],["divine","Divine"],["celestial","Celestial"]].forEach(([N,ee])=>{let q=document.createElement("option");q.value=N,q.textContent=ee,a.appendChild(q)}),a.value="all";let l=document.createElement("div");l.id="shop.followedCount",l.textContent="Followed: 0",l.title="Items with Overlay enabled",l.style.padding="6px 10px",l.style.borderRadius="999px",l.style.border="1px solid #4445",l.style.background="#1f2328",l.style.color="#e7eef7",l.style.fontWeight="600",l.style.marginLeft="auto",l.style.width="115px",r.append(o,s,i,a,l);let c=document.createElement("div");c.style.border="1px solid #4445",c.style.borderRadius="10px",c.style.padding="10px",c.style.background="#0f1318",c.style.overflow="hidden",c.style.display="grid",c.style.gridTemplateRows="auto 1fr",c.style.minHeight="0",n.appendChild(c);let d=document.createElement("div"),u="minmax(200px, 1fr) 9rem 7rem 8rem";d.style.display="grid",d.style.gridTemplateColumns=u,d.style.justifyContent="start",d.style.columnGap="0",d.style.borderBottom="1px solid #ffffff1a",d.style.padding="0 0 4px 0",d.style.position="sticky",d.style.top="0",d.append(Un("Item","left"),Un("Rarity"),Un("Notify"),Un("Custom rules")),c.appendChild(d);let p=document.createElement("div");p.style.display="grid",p.style.gridTemplateColumns=u,p.style.justifyContent="start",p.style.gridAutoRows="auto",p.style.alignContent="start",p.style.minHeight="0",p.style.height="100%",p.style.overflow="auto",p.style.overscrollBehavior="contain",p.style.width="100%",p.style.scrollbarGutter="stable",c.appendChild(p);let f=()=>{let N=Array.from(p.children);for(let ee=0;ee+3<N.length;ee+=4){let q=N[ee],A=N[ee+3],te=q?.dataset?.id;te&&Gs(q,A??null,De.getRule(te))}},h=N=>{let ee=new Map(N.rows.map(A=>[A.id,A])),q=Array.from(p.children);for(let A=0;A+3<q.length;A+=4){let te=q[A],ne=q[A+2],Z=q[A+3],me=te.dataset.id,Q=ee.get(me);if(!Q)continue;let oe=ne.querySelector("label");oe&&tp(oe,!!Q.popup),te.dataset.follow=Q.followed?"1":"0",Gs(te,Z??null,De.getRule(me));let W=De.isIdCapped?.(me)??!1;oe&&Bb(oe,W)}},m=()=>{let N=p.offsetWidth-p.clientWidth;d.style.boxSizing="border-box",d.style.paddingRight=`${N}px`};m();let g=new ResizeObserver(m);g.observe(p);let y=()=>m();window.addEventListener("resize",y);let v=new Map,w=null,x=new Set,E=()=>({type:s.value||"all",rarity:a.value||"all"}),L=N=>De.filterRows(N,E()),P=N=>{let ee=document.createElement("div");Object.assign(ee.style,{display:"flex",alignItems:"center",gap:"6px",padding:"4px 6px",borderBottom:"1px solid #ffffff12"});let q=40,A=document.createElement("div");Object.assign(A.style,{width:`${q}px`,height:`${q}px`,flex:`0 0 ${q}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",background:"#101820",marginRight:"6px",aspectRatio:"1 / 1"});let te=J=>{let B=J.indexOf(":");return B>=0?J.slice(B+1):J},ne=N.type==="Seed"?"\u{1F331}":N.type==="Egg"?"\u{1F95A}":N.type==="Tool"?"\u{1F9F0}":"\u{1F3E0}",Z=te(N.id),me=to(N.type,Z,{size:q-6,fallback:ne,alt:N.name});A.appendChild(me);let Q=document.createElement("div");Object.assign(Q.style,{display:"flex",flexDirection:"column",gap:"2px",lineHeight:"1.15",minWidth:"0",flex:"1 1 auto"});let oe=document.createElement("div");oe.textContent=N.name,Object.assign(oe.style,{fontWeight:"700",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"});let W=document.createElement("div");W.textContent=N.type,W.style.opacity="0.7",W.style.fontSize="12px";let U=document.createElement("div");return U.dataset.role="rule-hint",U.style.display="none",U.style.opacity="0.75",U.style.fontSize="11px",U.style.whiteSpace="nowrap",U.style.overflow="hidden",U.style.textOverflow="ellipsis",U.style.minHeight="1.2em",U.style.visibility="hidden",Q.append(oe,W,U),ee.append(A,Q),ee},V=N=>{let ee=P(N);ee.dataset.id=N.id,ee.dataset.type=N.type,ee.dataset.follow=N.followed?"1":"0",ee.dataset.context="shops";let q=document.createElement("div");q.style.display="flex",q.style.alignItems="center",q.style.justifyContent="center",q.style.borderBottom="1px solid #ffffff12",q.appendChild(np(String(N.rarity??"\u2014")));let A=Fb(Q=>{try{De.setPopup(N.id,!!Q)}catch{}let oe=De.getPref(N.id);ee.dataset.follow=oe.followed?"1":"0"});tp(A,!!N.popup),A.style.padding="0";let te=Us(A),ne=De.isIdCapped?.(N.id)??!1;Bb(A,ne);let Z=e.btn("",{icon:"\u2699",size:"sm",tooltip:"Custom rule",ariaLabel:`Custom rule for ${N.name}`});Z.dataset.role="rule",Z.classList.add("qws-rule-btn"),Z.addEventListener("click",Q=>{Q.preventDefault(),Q.stopPropagation(),Hb(e,{id:N.id,name:N.name,type:N.type,context:"shops"},Z)});let me=Us(Z);me.dataset.role="rule-cell",p.append(ee,q,te,me),Gs(ee,me,De.getRule(N.id))};function z(){wn(),p.innerHTML="",x=new Set}function C(){let N=document.createElement("div");N.textContent="No items.",N.style.opacity="0.75",N.style.gridColumn="1 / -1",N.style.padding="8px",p.appendChild(N)}function D(){if(z(),!w){C();return}let N=L(w.rows);N.length?N.forEach(ee=>{V(ee),x.add(ee.id)}):C(),f(),l.textContent=`Followed: ${w.counts.followed}`,m()}function S(N){l.textContent=`Followed: ${N.counts.followed}`}function G(N){let ee=new Set;for(let q of L(N.rows))ee.add(q.id);return ee}let se=null,X=null;(async()=>{try{await De.start()}catch{}se=await De.onChangeNow(N=>{let ee=w;if(w=N,!ee){D(),h(w);return}let q=x,A=G(N),te=!1;if(q.size!==A.size)te=!0;else for(let ne of A)if(!q.has(ne)){te=!0;break}te?D():(S(N),h(N))});try{X=await De.onRulesChangeNow(()=>f())}catch{}})();let ue=()=>{w&&D()};s.onchange=ue,a.onchange=ue,t.__cleanup__=(()=>{let N=t.__cleanup__;return()=>{try{se?.()}catch{}try{X?.()}catch{}try{g.disconnect()}catch{}try{window.removeEventListener("resize",y)}catch{}try{wn()}catch{}try{N?.()}catch{}}})()}function TA(t,e){t.innerHTML="",t.style.cssText="";let n=document.createElement("div");Object.assign(n.style,{display:"grid",gridTemplateRows:"1fr",height:"54vh",overflow:"hidden",minHeight:"0"}),t.appendChild(n);let r=document.createElement("div");r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="10px",r.style.background="#0f1318",r.style.overflow="hidden",r.style.display="grid",r.style.gridTemplateRows="auto 1fr",r.style.minHeight="0",n.appendChild(r);let o=document.createElement("div"),s="minmax(240px, 1fr) 9rem 7rem 8rem";o.style.display="grid",o.style.gridTemplateColumns=s,o.style.justifyContent="start",o.style.columnGap="0",o.style.borderBottom="1px solid #ffffff1a",o.style.padding="0 0 4px 0",o.style.position="sticky",o.style.top="0",o.append(Un("Weather","left"),Un("Last seen"),Un("Notify"),Un("Custom rules")),r.appendChild(o);let i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns=s,i.style.justifyContent="start",i.style.gridAutoRows="auto",i.style.alignContent="start",i.style.minHeight="0",i.style.height="100%",i.style.overflow="auto",i.style.overscrollBehavior="contain",i.style.width="100%",i.style.scrollbarGutter="stable",r.appendChild(i);let a=new Map,l=()=>{let z=Array.from(i.children);for(let C=0;C+3<z.length;C+=4){let D=z[C],S=z[C+3],G=D?.dataset?.id;G&&Gs(D,S??null,De.getRule(G))}},c=()=>{let z=i.offsetWidth-i.clientWidth;o.style.boxSizing="border-box",o.style.paddingRight=`${z}px`};c();let d=new ResizeObserver(c);d.observe(i);let u=()=>c();window.addEventListener("resize",u);let p=z=>{let C=document.createElement("div");Object.assign(C.style,{display:"flex",alignItems:"center",gap:"8px",padding:"6px",borderBottom:"1px solid #ffffff12"});let D=40,S=document.createElement("div");Object.assign(S.style,{width:`${D}px`,height:`${D}px`,flex:`0 0 ${D}px`,display:"inline-flex",alignItems:"center",justifyContent:"center",borderRadius:"8px",background:"#101820"});let G=Ta(z.spriteKey??z.id,{size:D-4,fallback:"\u{1F326}",alt:z.name});S.appendChild(G);let se=document.createElement("div");Object.assign(se.style,{display:"flex",flexDirection:"column",gap:"4px",lineHeight:"1.2",minWidth:"0",flex:"1 1 auto"});let X=document.createElement("div");Object.assign(X.style,{display:"flex",alignItems:"center",gap:"6px",minWidth:"0"});let ue=document.createElement("div");if(ue.textContent=z.name,Object.assign(ue.style,{fontWeight:"700",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:"1 1 auto"}),X.appendChild(ue),z.isCurrent){let A=document.createElement("span");A.textContent="Current",Object.assign(A.style,{fontSize:"11px",padding:"2px 6px",borderRadius:"999px",background:"#2b5cff33",border:"1px solid #2b5cff66",color:"#9cbcff",fontWeight:"600",whiteSpace:"nowrap"}),X.appendChild(A)}let N=document.createElement("div");N.textContent="Mutations",Object.assign(N.style,{fontSize:"11px",opacity:"0.7",fontWeight:"600"});let ee=document.createElement("div");if(Object.assign(ee.style,{display:"flex",flexWrap:"wrap",gap:"6px",alignItems:"flex-start",fontSize:"12px",lineHeight:"1.3",opacity:z.mutations.length?"0.85":"0.6"}),z.mutations.length)for(let A of z.mutations){let te=document.createElement("span");te.textContent=_h(A),Object.assign(te.style,{display:"inline-flex",alignItems:"center",padding:"2px 8px",borderRadius:"999px",background:"#ffffff12",whiteSpace:"nowrap"}),ee.appendChild(te)}else{let A=document.createElement("span");A.textContent="No mutation effects.",A.style.whiteSpace="nowrap",ee.appendChild(A)}let q=document.createElement("div");return q.dataset.role="rule-hint",q.style.opacity="0.75",q.style.fontSize="11px",q.style.whiteSpace="nowrap",q.style.overflow="hidden",q.style.textOverflow="ellipsis",q.style.minHeight="1.2em",q.style.visibility="hidden",se.append(X,N,ee,q),C.append(S,se),z.isCurrent&&(C.style.background="linear-gradient(180deg, #1b2735, #141d25)",C.style.borderRadius="8px"),C},f=z=>{let C=p(z);C.dataset.id=z.id,C.dataset.context="weather",C.dataset.current=z.isCurrent?"1":"0";let D=document.createElement("div"),{label:S,title:G}=$d(z.lastSeen,z.isCurrent);D.textContent=S,D.title=G,D.style.fontWeight="600",D.style.opacity=S==="Never"?"0.7":"1",D.style.whiteSpace="nowrap";let se=Us(D);a.set(z.id,D);let X=Fb(q=>{try{De.setWeatherNotify(z.id,!!q)}catch{}});tp(X,!!z.notify),X.style.padding="0";let ue=Us(X),N=e.btn("",{icon:"\u2699",size:"sm",tooltip:"Custom rule",ariaLabel:`Custom rule for ${z.name}`});N.dataset.role="rule",N.classList.add("qws-rule-btn"),N.addEventListener("click",q=>{q.preventDefault(),q.stopPropagation(),Hb(e,{id:z.id,name:z.name,type:z.type,context:"weather"},N)});let ee=Us(N);ee.dataset.role="rule-cell",i.append(C,se,ue,ee),Gs(C,ee,De.getRule(z.id))},h=()=>{wn(),i.innerHTML="",a.clear()},m=()=>{let z=document.createElement("div");z.textContent="No weather entries.",z.style.opacity="0.75",z.style.gridColumn="1 / -1",z.style.padding="8px",i.appendChild(z)},g=null,y="",v=()=>{if(g)for(let z of g.rows){let C=a.get(z.id);if(C){let{label:D,title:S}=$d(z.lastSeen,z.isCurrent);C.textContent=D,C.title=S,C.style.opacity=D==="Never"?"0.7":"1"}}},w=()=>{h(),!g||!g.rows.length?m():(g.rows.forEach(f),l()),c(),v()},x=null,E=null;(async()=>{try{await De.start()}catch{}try{x=await De.onWeatherChangeNow(z=>{g=z,y=Jd(z.rows),w()})}catch{}try{E=await De.onRulesChangeNow(()=>l())}catch{}})();let L=async()=>{try{let z=await De.getWeatherState(),C=Jd(z.rows),D=C!==y;g=z,y=C,D?w():v()}catch{}},P=window.setInterval(v,3e4),V=window.setInterval(()=>{L()},6e4);t.__cleanup__=(()=>{let z=t.__cleanup__;return()=>{try{x?.()}catch{}try{E?.()}catch{}try{d.disconnect()}catch{}try{window.removeEventListener("resize",u)}catch{}try{window.clearInterval(P)}catch{}try{window.clearInterval(V)}catch{}try{wn()}catch{}try{z?.()}catch{}}})()}function Wb(t){let e=new Ye({id:"alerts",compact:!0,windowSelector:".qws-win"});e.addTab("shops","\u{1F6D2} Shops",n=>CA(n,e)),e.addTab("weather","\u{1F326} Weather",n=>TA(n,e)),e.addTab("settings","\u2699\uFE0F General settings",n=>EA(n,e)),e.mount(t)}var kA=new Intl.NumberFormat("en-US"),et=t=>kA.format(Math.max(0,Math.floor(t||0))),IA=new Set(["egggrowthboost","egggrowthboostii","egggrowthboostiii","plantgrowthboost","plantgrowthboostii"]),AA=new Set(["petxpboost","petxpboostii"]),MA=new Set(["pethatchsizeboost","pethatchsizeboostii"]),PA=new Set(["hungerrestore","hungerrestoreii"]);function Sn(t){return typeof t=="object"&&t!==null}function jb(t){return(t.totalPlanted??0)<=0&&(t.totalHarvested??0)<=0&&(t.totalDestroyed??0)<=0&&(t.watercanUsed??0)<=0&&(t.waterTimeSavedMs??0)<=0}function zb(t){return(t.seedsBought??0)<=0&&(t.decorBought??0)<=0&&(t.eggsBought??0)<=0&&(t.toolsBought??0)<=0&&(t.cropsSoldCount??0)<=0&&(t.cropsSoldValue??0)<=0&&(t.petsSoldCount??0)<=0&&(t.petsSoldValue??0)<=0}function Ub(t){let e=Object.values(t.pets?.hatchedByType??{});return e.length===0?!0:e.every(n=>{if(!n)return!0;let r=Number(n.normal)||0,o=Number(n.gold)||0,s=Number(n.rainbow)||0;return r<=0&&o<=0&&s<=0})}async function Al(t,e){try{let n=await t.get();if(!Array.isArray(n))return 0;let r=0;for(let o of n){if(!o||typeof o!="object")continue;let s=Number(o.quantity);Number.isFinite(s)&&s>0&&(r+=Math.max(0,Math.floor(s)))}return r}catch(n){return console.warn(`[StatsMenu] Failed to read ${e} inventory`,n),0}}async function $b(t){if(!jb(t.garden))return;let e;try{e=await Fi.get()}catch(r){console.warn("[StatsMenu] Failed to read garden data",r);return}if(!e||!Sn(e.tileObjects))return;let n=0;for(let r of Object.values(e.tileObjects)){if(!Sn(r))continue;(typeof r.objectType=="string"?r.objectType.toLowerCase():"")==="plant"&&(n+=1)}n<=0||_e.update(r=>{jb(r.garden)&&(r.garden.totalPlanted=n)})}async function Jb(t){if(!zb(t.shops))return;let e=null;try{e=await Fi.get()}catch(d){console.warn("[StatsMenu] Failed to read garden data",d)}let n=0,r=0,o=0,s=0;if(e&&Sn(e.tileObjects))for(let d of Object.values(e.tileObjects)){if(!Sn(d))continue;let u=typeof d.objectType=="string"?d.objectType.toLowerCase():"";u==="plant"?n+=1:u==="egg"&&(r+=1)}if(e&&Sn(e.boardwalkTileObjects))for(let d of Object.values(e.boardwalkTileObjects))d!=null&&(o+=1);let[i,a,l,c]=await Promise.all([Al(xc,"seed"),Al(Ec,"tool"),Al(Cc,"egg"),Al(Tc,"decor")]);n+=i,r+=l,o+=c,s+=a,!(n<=0&&r<=0&&o<=0&&s<=0)&&_e.update(d=>{zb(d.shops)&&(n>0&&(d.shops.seedsBought??0)<=0&&(d.shops.seedsBought=n),r>0&&(d.shops.eggsBought??0)<=0&&(d.shops.eggsBought=r),o>0&&(d.shops.decorBought??0)<=0&&(d.shops.decorBought=o),s>0&&(d.shops.toolsBought??0)<=0&&(d.shops.toolsBought=s))})}function RA(t){return Array.isArray(t)?t:Sn(t)&&Array.isArray(t.items)?t.items:[]}function Gb(t){if(!Array.isArray(t))return"normal";let e=!1;for(let n of t){if(typeof n!="string")continue;let r=n.trim().toLowerCase();if(r==="rainbow")return"rainbow";r==="gold"&&(e=!0)}return e?"gold":"normal"}async function Qb(t){if(!Ub(t))return;let e;try{e=await Sc.get()}catch(a){console.warn("[StatsMenu] Failed to read inventory data",a),e=null}let n;try{n=await er.get()}catch(a){console.warn("[StatsMenu] Failed to read active pet data",a),n=null}let r=RA(e),o=Array.isArray(n)?n:[];if(r.length===0&&o.length===0)return;let s=new Map;for(let a of r){if(!Sn(a)||(typeof a.itemType=="string"?a.itemType.toLowerCase():"")!=="pet")continue;let d=(typeof a.petSpecies=="string"?a.petSpecies:null)?.trim();if(!d)continue;let u=d.toLowerCase(),p=s.get(u)??{normal:0,gold:0,rainbow:0},f=Gb(a.mutations);p[f]=(p[f]??0)+1,s.set(u,p)}for(let a of o){if(!Sn(a))continue;let l=Sn(a.slot)?a.slot:null;if(!l)continue;let d=(typeof l.petSpecies=="string"?l.petSpecies:null)?.trim();if(!d)continue;let u=d.toLowerCase(),p=s.get(u)??{normal:0,gold:0,rainbow:0},f=Gb(l.mutations);p[f]=(p[f]??0)+1,s.set(u,p)}let i=!1;for(let a of s.values())if((a.normal??0)>0||(a.gold??0)>0||(a.rainbow??0)>0){i=!0;break}i&&_e.update(a=>{if(Ub(a))for(let[l,c]of s){if((c.normal??0)<=0&&(c.gold??0)<=0&&(c.rainbow??0)<=0)continue;let d=a.pets.hatchedByType[l]??{normal:0,gold:0,rainbow:0};d.normal=(d.normal??0)+(c.normal??0),d.gold=(d.gold??0)+(c.gold??0),d.rainbow=(d.rainbow??0)+(c.rainbow??0),a.pets.hatchedByType[l]=d}})}function _A(t,e){let n=t.toLowerCase(),r=Number.isFinite(e)?Math.max(0,e):0;if(IA.has(n))return r0(r);if(AA.has(n))return`${et(r)} XP`;if(MA.has(n))return`${et(r)} strength`;if(PA.has(n)){let o=Math.round(r);return`${Math.abs(r-o)<1e-6?et(o):r.toFixed(1)}% hunger`}return Zr(r)??et(r)}var Kb=560,Zb="menu:stats:collapsed",Ml=null;function Xb(){try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{}try{if(typeof localStorage<"u")return localStorage}catch{}return null}function LA(){let t=Xb();if(!t)return{};try{let e=t.getItem(Zb);if(!e)return{};let n=JSON.parse(e);if(!n||typeof n!="object")return{};let r=Object.entries(n).filter(o=>typeof o[1]=="boolean");return Object.fromEntries(r)}catch(e){return console.warn("[StatsMenu] Failed to read collapse state",e),{}}}function NA(t){let e=Xb();if(e)try{e.setItem(Zb,JSON.stringify(t))}catch(n){console.warn("[StatsMenu] Failed to save collapse state",n)}}function e0(){return Ml||(Ml=LA()),Ml}function OA(t,e){let r=e0()[t];return typeof r=="boolean"?r:e}function qA(t,e){let n=e0();if(n[t]===e)return;let r={...n,[t]:e};Ml=r,NA(r)}var DA=new Intl.DateTimeFormat(void 0,{dateStyle:"medium",timeStyle:"short"}),SN=new Intl.RelativeTimeFormat(void 0,{numeric:"auto"}),t0=[he.Common,he.Uncommon,he.Rare,he.Legendary,he.Mythic,he.Divine,he.Celestial],BA={[he.Common]:"#E7E7E7",[he.Uncommon]:"#67BD4D",[he.Rare]:"#0071C6",[he.Legendary]:"#FFC734",[he.Mythic]:"#9944A7",[he.Divine]:"#FF7835",[he.Celestial]:"#7C2AE8"};function Ys(t,e,n={}){let r=t.card(e,{tone:"muted",align:"stretch",subtitle:n.subtitle,icon:n.icon});r.root.classList.add("qmm-card--collapsible");let o=document.createElement("button");o.type="button",o.className="qmm-btn qmm-btn--ghost qmm-btn--sm stats-collapse-toggle",o.style.marginLeft="auto";let s=document.createElement("span");s.className="stats-collapse-toggle__icon",s.setAttribute("aria-hidden","true");let i=document.createElement("span");i.className="stats-collapse-toggle__label",o.append(s,i);let a=r.header.querySelector(".qmm-card__title");a?a.insertAdjacentElement("afterend",o):r.header.appendChild(o);let l=n.storageId?.trim()||null,c=null,d=()=>{c&&(c.cancel(),c=null)},u=m=>{let g=r.body;if(d(),typeof window.matchMedia=="function"&&window.matchMedia("(prefers-reduced-motion: reduce)").matches){g.style.display=m?"none":"grid",g.style.height="",g.style.opacity="",g.style.overflow="";return}let v="cubic-bezier(0.33, 1, 0.68, 1)",w=220;if(g.style.overflow="hidden",m){let x=g.offsetHeight;g.style.height=`${x}px`,g.style.opacity="1",c=g.animate([{height:`${x}px`,opacity:1},{height:"0px",opacity:0}],{duration:w,easing:v,fill:"forwards"})}else{g.style.display="grid",g.style.height="0px",g.style.opacity="0";let x=g.scrollHeight;c=g.animate([{height:"0px",opacity:0},{height:`${x}px`,opacity:1}],{duration:w,easing:v,fill:"forwards"})}if(!c){g.style.display=m?"none":"grid",g.style.height="",g.style.opacity="",g.style.overflow="";return}c.onfinish=()=>{m?(g.style.display="none",g.style.opacity=""):(g.style.display="grid",g.style.opacity=""),g.style.height="",g.style.overflow="",c=null},c.oncancel=()=>{g.style.height="",g.style.opacity="",g.style.overflow="",m&&(g.style.display="none"),c=null}},p=(m,g=!0,y=!0)=>{y?u(m):(d(),r.body.style.display=m?"none":"grid",r.body.style.height="",r.body.style.opacity="",r.body.style.overflow=""),r.root.dataset.collapsed=m?"true":"false",o.setAttribute("aria-expanded",String(!m));let v=m?"Show":"Hide",w=`${v} ${e}`;i.textContent=v,o.setAttribute("aria-label",w),o.title=w,r.root.classList.toggle("is-collapsed",m),g&&l&&qA(l,m)},f=!!n.startCollapsed,h=l?OA(l,f):f;return p(h,!1,!1),o.addEventListener("click",()=>{let m=r.root.dataset.collapsed==="true";p(!m)}),{root:r.root,body:r.body,header:r.header,setCollapsed:p}}function n0(t){let e=document.createElement("div");e.className="stats-metric-grid";for(let n of t){let r=document.createElement("div");r.className="stats-metric",n.hint&&(r.title=n.hint);let o=document.createElement("span");o.className="stats-metric__label",o.textContent=n.label;let s=document.createElement("span");s.className="stats-metric__value qmm-num",s.textContent=n.value,r.append(o,s),e.appendChild(r)}return e}function FA(t){let e=document.createElement("span");e.className="stats-weather__name";let n=document.createElement("span");n.className="stats-weather__icon";let r=Ta(t.spriteKey??t.label,{size:32,fallback:"\u{1F326}",alt:t.label});n.appendChild(r);let o=document.createElement("span");return o.className="stats-weather__label",o.textContent=t.label,e.append(n,o),{content:e}}function rp(t,e){let n=document.createElement("div");n.className="stats-list";let r=i=>i.width?i.width:i.minWidth?`minmax(${i.minWidth}, 1fr)`:"minmax(0, 1fr)",o=t.map(r).join(" "),s=document.createElement("div");s.className="stats-list__row stats-list__row--header",s.style.gridTemplateColumns=o;for(let i of t){let a=document.createElement("span");a.className="stats-list__cell";let l=i.align??"left";l!=="left"&&a.classList.add(`stats-list__cell--align-${l}`),i.headerClassName&&a.classList.add(i.headerClassName),a.textContent=i.label,s.appendChild(a)}n.appendChild(s);for(let i of e){let a=document.createElement("div");a.className="stats-list__row",a.style.gridTemplateColumns=o,i.forEach((l,c)=>{let d=t[c],u=document.createElement("span");u.className="stats-list__cell";let p=l.align??d.align??"left";p!=="left"&&(u.classList.add(`stats-list__cell--align-${p}`),p==="right"&&u.classList.add("qmm-num")),l.hint&&(u.title=l.hint);let f=!!l.content;if(l.content&&u.appendChild(l.content),l.text!=null)if(f){let h=document.createElement("span");h.textContent=l.text,u.appendChild(h)}else u.textContent=l.text;else f||(u.textContent="");a.appendChild(u)}),n.appendChild(a)}return n}function r0(t){let e=Math.max(0,t||0);if(e<1e3)return`${et(e)} ms`;let n=e/1e3;if(n<60)return`${n.toFixed(1)} s`;let r=n/60;return r<60?`${r.toFixed(1)} min`:`${(r/60).toFixed(1)} h`}function HA(t){return DA.format(new Date(t))}function WA(t,e,n){let r=t.card("\u{1F5D3}\uFE0F Tracking",{tone:"muted",align:"stretch",compactHeader:!0}),o=Number.isFinite(n.createdAt)?Math.max(0,Math.floor(n.createdAt)):0,s=o>0,i=t.flexRow({align:"center",gap:12,className:"stats-meta"}),a=document.createElement("span");a.className="stats-meta__label",a.textContent="Tracking started:",i.appendChild(a);let l=document.createElement("strong");l.className="stats-meta__value",l.textContent=s?HA(o):"Unavailable",i.appendChild(l);let c=t.btn("RESET",{variant:"danger"});c.style.marginLeft="auto",c.addEventListener("click",()=>{let d=_e.reset();$b(d),Jb(d),Qb(d)}),i.appendChild(c),r.body.appendChild(i),e.appendChild(r.root)}function jA(t,e,n){let r=Ys(t,"\u{1F331} Garden",{subtitle:"Field activity",storageId:"garden"}),o=[{label:"Total planted",value:et(n.garden.totalPlanted)},{label:"Total harvested",value:et(n.garden.totalHarvested)},{label:"Total destroyed",value:et(n.garden.totalDestroyed)},{label:"Watering can Used",value:et(n.garden.watercanUsed)},{label:"Water time saved",value:r0(n.garden.waterTimeSavedMs),hint:`${et(n.garden.waterTimeSavedMs)} ms`}];r.body.appendChild(n0(o)),e.appendChild(r.root)}function zA(t,e,n){let r=Ys(t,"\u{1F3EA} Shops",{subtitle:"Purchases & sales",storageId:"shops"}),o=[{label:"Seeds bought",value:et(n.shops.seedsBought)},{label:"Tools bought",value:et(n.shops.toolsBought)},{label:"Eggs bought",value:et(n.shops.eggsBought)},{label:"Decor bought",value:et(n.shops.decorBought)},{label:"Crops sold",value:`${et(n.shops.cropsSoldCount)} items`},{label:"Crop revenue",value:Zr(n.shops.cropsSoldValue)??et(n.shops.cropsSoldValue)},{label:"Pets sold",value:`${et(n.shops.petsSoldCount)} pets`},{label:"Pet revenue",value:Zr(n.shops.petsSoldValue)??et(n.shops.petsSoldValue)}];r.body.appendChild(n0(o)),e.appendChild(r.root)}function UA(){let t=new Map;for(let e of t0)t.set(e,[]);for(let e of Object.keys(ot)){let r=ot[e]?.rarity??he.Common,o=t.get(r)??[];o.push(e),t.set(r,o)}for(let e of t.values())e.sort((n,r)=>n.localeCompare(r));return t}var Rl=new Map,Ks=new Map,Vs=new Map,op=new WeakMap,Vb=!1,Pl=null;function GA(){Pl=null}function KA(){if(Pl)return Pl;let t=new Set;try{ke.listPets().forEach(n=>t.add(n))}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return Pl=e,e}function VA(t){let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}async function YA(t){let n=ot[t]?.tileRef;if(n==null)return null;let r=VA(n);if(r==null)return null;let o=new Set(KA());o.size===0&&(o.add("pets"),o.add("Pets"));for(let s of o)try{let a=(await ke.getTile(s,r,"canvas"))?.data;if(a&&a.width>0&&a.height>0){let l=document.createElement("canvas");l.width=a.width,l.height=a.height;let c=l.getContext("2d");if(!c)continue;return c.imageSmoothingEnabled=!1,c.drawImage(a,0,0),l.toDataURL()}}catch{}return null}function o0(t,e){let n=op.get(t);if(!n)return;let{size:r,fallback:o}=n;if(t.classList.add("stats-pet__sprite-icon"),t.style.setProperty("--stats-pet-sprite-size",`${r}px`),t.innerHTML="",e){t.style.fontSize="";let s=document.createElement("img");s.src=e,s.alt="",s.decoding="async",s.loading="lazy",s.draggable=!1,t.appendChild(s)}else t.textContent=o,t.style.fontSize=`${Math.max(10,Math.round(r*.7))}px`}function $A(t,e,n){let r=Vs.get(t);r||(r=new Set,Vs.set(t,r)),r.add(e),op.set(e,n)}function Yb(t,e){let n=Vs.get(t);n&&(n.forEach(r=>{if(!r.isConnected){n.delete(r),op.delete(r);return}o0(r,e)}),n.size===0&&Vs.delete(t))}function s0(t){if(typeof window>"u")return Promise.resolve(null);let e=Rl.get(t);if(e!==void 0)return Yb(t,e),Promise.resolve(e);let n=Ks.get(t);if(n)return n;let r=YA(t).then(o=>(Rl.set(t,o),Ks.delete(t),Yb(t,o),o)).catch(()=>(Ks.delete(t),null));return Ks.set(t,r),r}function JA(){Vb||typeof window>"u"||(Vb=!0,window.addEventListener("mg:sprite-detected",()=>{Rl.clear(),Ks.clear(),GA(),Array.from(Vs.keys()).forEach(e=>{s0(e)})}))}function QA(t,e={}){let n=Math.max(12,e.size??28),r=t.trim().charAt(0)||"\u{1F43E}",s=(e.fallback??r).toString(),i=document.createElement("span");if(typeof window>"u")return i.classList.add("stats-pet__sprite-icon"),i.style.setProperty("--stats-pet-sprite-size",`${n}px`),i.textContent=s,i.style.fontSize=`${Math.max(10,Math.round(n*.7))}px`,i;JA(),$A(t,i,{size:n,fallback:s});let a=Rl.get(t);return o0(i,a??null),s0(t),i}function ZA(t){let e=document.createElement("span");e.className="stats-pet__species";let n=QA(t,{size:28,fallback:t.trim().charAt(0).toUpperCase()||"\u{1F43E}"}),r=document.createElement("span");return r.className="stats-pet__label",r.textContent=t,e.appendChild(n),e.appendChild(r),{content:e}}function XA(t){let e=document.createElement("span");return e.className="stats-pet__total-value qmm-num",e.textContent=et(t),{content:e,align:"center"}}function eM(t,e,n){let r=Ys(t,"\u{1F43E} Pets",{subtitle:"Hatching overview",storageId:"pets"}),o=UA();for(let s of t0){let i=o.get(s)??[];if(!i.length)continue;let a=document.createElement("div");a.className="stats-pet-group",a.style.setProperty("--stats-pet-group-border-color",BA[s]);let l=document.createElement("div");l.className="stats-pet-group__summary",l.textContent="";let c=np(s);c.style.margin="0",l.appendChild(c),a.appendChild(l);let d=document.createElement("div");d.className="stats-pet-group__content";let u=[{label:"Species",width:"2.2fr"},{label:"Normal",align:"center",width:"1fr"},{label:"Gold",align:"center",width:"1fr",headerClassName:"stats-list__header-label--gold"},{label:"Rainbow",align:"center",width:"1fr",headerClassName:"stats-list__header-label--rainbow"},{label:"Total",align:"center",width:"1fr"}],p=[];for(let f of i){let h=f.toLowerCase(),m=n.pets.hatchedByType[h]??{normal:0,gold:0,rainbow:0},g=m.normal+m.gold+m.rainbow;p.push([ZA(f),{text:et(m.normal),align:"center"},{text:et(m.gold),align:"center"},{text:et(m.rainbow),align:"center"},XA(g)])}d.appendChild(rp(u,p)),a.appendChild(d),r.body.appendChild(a)}e.appendChild(r.root)}function tM(t,e,n){let r=Ys(t,"\u{1F9E0} Abilities",{subtitle:"Trigger counts",storageId:"abilities"}),o=Object.keys(xt).sort((a,l)=>{let c=xt[a]?.name??a,d=xt[l]?.name??l;return c.localeCompare(d)}),s=[{label:"Ability",width:"2.2fr"},{label:"Triggers",align:"right",width:"1fr"},{label:"Value",align:"right",width:"1.2fr"}],i=[];for(let a of o){let l=xt[a],c=n.abilities[a]??{triggers:0,totalValue:0},d=_A(a,c.totalValue);i.push([{text:l?.name??a,hint:l?.description},{text:et(c.triggers)},{text:d}])}r.body.appendChild(rp(s,i)),e.appendChild(r.root)}function nM(t,e,n){let r=Ys(t,"\u26C5 Weather",{subtitle:"Events overview",storageId:"weather"}),o=[{label:"Weather",width:"2fr"},{label:"TOTAL",align:"right",width:"1fr"}],s=[],i=Object.keys(tr).map(a=>{let l=tr[a],c=l?.atomValue??a,d=a.toLowerCase(),u=n.weather[d]??{triggers:0},p=pr(a)??pr(l?.atomValue)??pr(l?.displayName)??null;return{key:d,label:c,triggers:u.triggers,spriteKey:p}}).sort((a,l)=>a.label.localeCompare(l.label));for(let a of i)s.push([FA({label:a.label,spriteKey:a.spriteKey}),{text:et(a.triggers)}]);r.body.appendChild(rp(o,s)),e.appendChild(r.root)}function sp(t){let e=t;if(typeof e.__statsCleanup=="function"){try{e.__statsCleanup()}catch(y){console.error("[StatsMenu] Cleanup error",y)}e.__statsCleanup=void 0}let n=t.firstElementChild,r=n?.classList.contains("qmm")?n.querySelector(".qmm-views")??null:null,o=r?r.scrollTop:null,s=null,i=!1,a=()=>{},l=()=>{if(!i){i=!0;try{a()}catch(y){console.error("[StatsMenu] Unsubscribe error",y)}s!==null&&(cancelAnimationFrame(s),s=null),e.__statsCleanup===l&&(e.__statsCleanup=void 0)}};a=_e.subscribe(()=>{if(!e.isConnected){l();return}s===null&&(s=requestAnimationFrame(()=>{s=null,sp(t)}))}),e.__statsCleanup=l;let c=new Ye({id:"stats",compact:!0});c.mount(t);let d=c.root.closest(".qws-win");d&&(d.style.minWidth=`${Kb}px`);let u=getComputedStyle(t),p=Number.parseFloat(u.paddingLeft)||0,f=Number.parseFloat(u.paddingRight)||0,h=Math.max(0,Kb-p-f);t.style.minWidth=`${h}px`;let m=c.root.querySelector(".qmm-views");if(!m)return;m.innerHTML="",m.style.display="grid",m.style.gap="12px",m.style.padding="4px 0",m.style.minHeight="0",m.style.alignContent="start",m.style.maxHeight="54vh";let g=_e.getSnapshot();$b(g).catch(y=>{console.error("[StatsMenu] Failed to initialize garden stats",y)}),Jb(g).catch(y=>{console.error("[StatsMenu] Failed to initialize shop stats",y)}),Qb(g).catch(y=>{console.error("[StatsMenu] Failed to initialize pet stats",y)}),WA(c,m,g),jA(c,m,g),zA(c,m,g),eM(c,m,g),tM(c,m,g),nM(c,m,g),o!==null&&(m.scrollTop=o)}var rM={tileRefsMap:"Map tiles",tileRefsPlants:"Plants",tileRefsTallPlants:"Tall plants",tileRefsSeeds:"Seeds",tileRefsItems:"Items",tileRefsAnimations:"Animations",tileRefsPets:"Pets",tileRefsMutations:"Mutations",tileRefsDecor:"Decor"};function oM(t){let e=t.replace(/_/g," ").replace(/([a-z0-9])([A-Z])/g,"$1 $2").replace(/\s+/g," ").trim();return e?e.charAt(0).toUpperCase()+e.slice(1):t}function sM(t){let e=new Map;for(let{source:n,refs:r}of t.sources){let o=rM[n]??n;for(let[s,i]of Object.entries(r)){if(typeof i!="number"||Number.isNaN(i))continue;let a=i>0?i-1:i,l={index:a,key:s,source:n,sourceLabel:o,qualifiedName:`${n}.${s}`,displayName:oM(s)},c=e.get(a);c?c.push(l):e.set(a,[l])}}return e}var iM=[{id:"plants-tall",label:"Tall plants",test:t=>t.includes("tall"),sources:[{source:"tileRefsTallPlants",refs:at}]},{id:"plants",label:"Plants",test:t=>t.includes("plants"),sources:[{source:"tileRefsPlants",refs:Pe}]},{id:"mutations",label:"Mutations",test:t=>t.includes("mutation"),sources:[{source:"tileRefsMutations",refs:Kt}]},{id:"seeds",label:"Seeds",test:t=>t.includes("seed"),sources:[{source:"tileRefsSeeds",refs:Ge}]},{id:"items",label:"Items",test:t=>t.includes("item"),sources:[{source:"tileRefsItems",refs:Wr}]},{id:"pets",label:"Pets",test:t=>t.includes("pet"),sources:[{source:"tileRefsPets",refs:nt}]},{id:"decor",label:"Decor",test:t=>t.includes("decor"),sources:[{source:"tileRefsDecor",refs:xe}]},{id:"animations",label:"Animations",test:t=>t.includes("anim"),sources:[{source:"tileRefsAnimations",refs:Hi}]},{id:"map",label:"Map",test:t=>t.includes("map"),sources:[{source:"tileRefsMap",refs:hf}]}],ap=iM.map(t=>({...t,entries:sM(t)})),ip=new Map;for(let t of ap)for(let{source:e}of t.sources){let n=ip.get(e);n?n.push(t):ip.set(e,[t])}var aM=(()=>{let t=new Map;for(let e of ap)for(let[n,r]of e.entries){let o=t.get(n);o?o.push(...r):t.set(n,[...r])}return t})();function lM(t){return t.toLowerCase()}function i0(t,e){let n=lM(t);for(let o of ap){if(!o.test(n))continue;let s=o.entries.get(e);if(s?.length)return{sheetId:o.id,sheetLabel:o.label,entries:[...s]}}let r=aM.get(e);if(r?.length===1){let o=r[0],s=ip.get(o.source);if(!s||s.some(i=>i.test(n)))return{sheetId:o.source,sheetLabel:o.sourceLabel,entries:[...r]}}return null}var vr=t=>{let e=new Date(t),n=(r,o=2)=>String(r).padStart(o,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`},u0=t=>t.replace(/[<>&]/g,e=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[e]),Ll=class{constructor(e=2e3){this.max=e;ce(this,"arr",[])}push(e){this.arr.push(e),this.arr.length>this.max&&this.arr.splice(0,this.arr.length-this.max)}toArray(){return this.arr.slice()}clear(){this.arr.length=0}},_l=new Map;function lp(){return Array.from(_l.values())}function p0(){return`status: ${pt.some(n=>n.readyState===WebSocket.OPEN)?"OPEN":"none"} \u2022 mode: ${Li?"worker":"page/auto"}`}var a0=Symbol.for("qmm.wsCtorHooked"),l0=Symbol.for("qmm.wsPatchedSend"),c0=!1;function f0(t){let e=window.WebSocket;if(!e[a0]){let n=new Proxy(e,{construct(r,o,s){let i=Reflect.construct(r,o,s);try{d0(i,"new",t)}catch{}return i}});n[a0]=!0,window.WebSocket=n}pt.forEach(n=>{try{d0(n,"existing",t)}catch{}}),c0||(c0=!0)}function d0(t,e,n){if(_l.has(t))return;let r=`WS#${1+_l.size} (${Oi(t.readyState)})`,o={ws:t,id:r,listeners:[]};pt.includes(t)||pt.push(t),Qn?.(t,e);let s=l=>{let c="";try{c=typeof l.data=="string"?l.data:JSON.stringify(l.data)}catch{c=String(l.data)}n({t:Date.now(),dir:"in",text:c,ws:t})};t.addEventListener("message",s),o.listeners.push(()=>t.removeEventListener("message",s));let i=()=>{o.id=o.id.replace(/\(.*\)/,`(${Oi(t.readyState)})`)},a=()=>{o.id=o.id.replace(/\(.*\)/,`(${Oi(t.readyState)})`)};if(t.addEventListener("open",i),t.addEventListener("close",a),o.listeners.push(()=>t.removeEventListener("open",i)),o.listeners.push(()=>t.removeEventListener("close",a)),!t[l0]){let l=t.send.bind(t);o.sendOrig=l,t[l0]=!0,t.send=c=>{try{let d=typeof c=="string"?c:JSON.stringify(c);n({t:Date.now(),dir:"out",text:d,ws:t})}catch{n({t:Date.now(),dir:"out",text:String(c),ws:t})}return l(c)}}_l.set(t,o)}var m0=!1;function cp(t,e){let n=t.querySelector(".label");n?n.textContent=e:t.textContent=e}function zt(t,e="warn"){try{window.toastSimple?.(t,"",e)}catch{}}function cM(){if(m0)return;m0=!0;let t=document.createElement("style");t.id="mg-debug-data-styles",t.textContent=`
  .dd-debug-view{display:flex;flex-direction:column;gap:16px;}
  .dd-debug-columns{display:grid;gap:16px;grid-template-columns:repeat(2,minmax(320px,1fr));align-items:start;}
  @media (max-width:720px){.dd-debug-columns{grid-template-columns:minmax(0,1fr);}}
  .dd-debug-column{display:flex;flex-direction:column;gap:16px;min-width:0;}
  .dd-card-description{font-size:13px;opacity:.72;margin:0;}
  .dd-atom-list{display:flex;flex-direction:column;gap:4px;margin-top:8px;max-height:40vh;overflow:auto;padding-right:4px;}
  .dd-atom-list__item{display:flex;align-items:center;gap:8px;font-size:13px;padding:4px 6px;border-radius:8px;border:1px solid transparent;cursor:pointer;transition:background .12s ease,border-color .12s ease;}
  .dd-atom-list__item:hover{background:rgba(255,255,255,.06);border-color:rgba(255,255,255,.1);}
  .dd-atom-list__checkbox{accent-color:#5c7eff;}
  .dd-atom-list__label{flex:1 1 auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
  .dd-status-chip{display:inline-flex;align-items:center;gap:6px;padding:4px 12px;border-radius:999px;font-size:12px;font-weight:600;letter-spacing:.01em;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.14);color:#f5f7ff;}
  .dd-status-chip.is-ok{color:#49d389;background:rgba(73,211,137,.14);border-color:rgba(73,211,137,.32);}
  .dd-status-chip.is-warn{color:#ffb760;background:rgba(255,183,96,.12);border-color:rgba(255,183,96,.32);}
  .dd-toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
  .dd-toolbar--stretch{width:100%;}
  .dd-toolbar .qmm-input{min-width:160px;}
  .dd-toolbar .dd-grow{flex:1 1 220px;min-width:180px;}
  .dd-mute-chips{display:flex;flex-wrap:wrap;gap:6px;}
  .dd-log{position:relative;border:1px solid #ffffff18;border-radius:16px;background:#0b1016;padding:10px;max-height:48vh;overflow:auto;box-shadow:inset 0 1px 0 rgba(255,255,255,.04);}
  .dd-log__empty{padding:28px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-log .ws-row{position:relative;display:grid;grid-template-columns:96px 20px minmax(0,1fr);gap:10px;padding:8px 12px;border-radius:12px;border:1px solid transparent;transition:background .15s ease,border-color .15s ease;align-items:start;margin:2px 0;}
  .dd-log .ws-row .ts{opacity:.76;font-size:12px;}
  .dd-log .ws-row .arrow{font-weight:600;}
  .dd-log .ws-row .body{white-space:pre-wrap;word-break:break-word;}
  .dd-log .ws-row .body code{font-family:inherit;font-size:12px;color:#dbe4ff;}
  .dd-log .ws-row .acts{position:absolute;top:6px;right:8px;display:flex;gap:6px;padding:4px 6px;background:rgba(13,18,25,.94);border:1px solid rgba(255,255,255,.18);border-radius:8px;opacity:0;visibility:hidden;transition:opacity .12s ease;z-index:1;}
  .dd-log .ws-row .acts .qmm-btn{padding:2px 6px;font-size:11px;}
  .dd-log .ws-row:hover .acts{opacity:1;visibility:visible;}
  .dd-log .ws-row:hover{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.18);}
  .dd-log .ws-row.selected{background:rgba(92,126,255,.16);border-color:rgba(92,126,255,.42);}
  .dd-send-controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
  .dd-send-controls .qmm-radio-group{display:flex;gap:10px;}
  .dd-textarea{min-height:140px;}
  .dd-inline-note{font-size:12px;opacity:.7;}
  .dd-log-filter-group{display:flex;flex-wrap:wrap;gap:6px;align-items:center;}
  .dd-script-log{position:relative;border:1px solid #ffffff18;border-radius:16px;background:#0b1016;max-height:48vh;overflow:auto;box-shadow:inset 0 1px 0 rgba(255,255,255,.04);}
  .dd-script-log__empty{padding:28px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-script-log__row{display:grid;grid-template-columns:minmax(92px,96px) minmax(70px,90px) minmax(120px,160px) minmax(0,1fr);gap:12px;padding:12px 16px;border-bottom:1px solid rgba(255,255,255,.06);align-items:start;}
  .dd-script-log__row:last-child{border-bottom:none;}
  .dd-script-log__ts{font-size:12px;opacity:.7;font-family:var(--qmm-font-mono,monospace);}
  .dd-script-log__level{display:inline-flex;align-items:center;justify-content:center;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:600;letter-spacing:.03em;text-transform:uppercase;min-width:58px;}
  .dd-script-log__level.is-debug{background:rgba(138,180,255,.14);color:#8ab4ff;border:1px solid rgba(138,180,255,.32);}
  .dd-script-log__level.is-info{background:rgba(92,126,255,.14);color:#9fb6ff;border:1px solid rgba(92,126,255,.32);}
  .dd-script-log__level.is-warn{background:rgba(255,183,96,.12);color:#ffb760;border:1px solid rgba(255,183,96,.32);}
  .dd-script-log__level.is-error{background:rgba(255,108,132,.16);color:#ff6c84;border:1px solid rgba(255,108,132,.32);}
  .dd-script-log__source{font-size:12px;font-weight:600;opacity:.85;}
  .dd-script-log__context{display:block;font-size:11px;opacity:.6;margin-top:2px;text-transform:uppercase;letter-spacing:.05em;}
  .dd-script-log__message-wrap{display:flex;flex-direction:column;gap:6px;}
  .dd-script-log__message{font-size:13px;line-height:1.45;white-space:pre-wrap;word-break:break-word;}
  .dd-script-log__actions{display:flex;gap:6px;justify-content:flex-end;align-self:flex-end;}
  .dd-script-log__actions button{padding:2px 8px;font-size:11px;border-radius:8px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.04);color:inherit;cursor:pointer;transition:background .12s ease,border-color .12s ease;}
  .dd-script-log__actions button:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.28);}
  .dd-script-log__details{grid-column:1/-1;margin:4px 0 0;background:#05080c;border:1px solid rgba(255,255,255,.08);border-radius:10px;padding:10px;white-space:pre-wrap;font-family:var(--qmm-font-mono,monospace);font-size:12px;line-height:1.4;display:none;word-break:break-word;max-height:180px;overflow:auto;}
  .dd-script-log__row.is-open .dd-script-log__details{display:block;}
  .dd-log-source-chips{display:flex;flex-wrap:wrap;gap:6px;}
  .dd-log-toolbar-spacer{flex:1 1 auto;}
  .dd-audio-summary{display:grid;gap:4px;font-size:13px;}
  .dd-audio-summary strong{font-size:14px;}
  .dd-audio-volume{font-family:var(--qmm-font-mono,monospace);font-size:12px;opacity:.78;}
  .dd-audio-list{display:flex;flex-direction:column;gap:8px;margin-top:4px;max-height:48vh;overflow:auto;padding-right:4px;}
  .dd-audio-row{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-start;padding:10px 12px;border-radius:12px;border:1px solid rgba(255,255,255,.08);background:rgba(9,12,18,.72);}
  .dd-audio-row__info{flex:1 1 260px;min-width:0;display:flex;flex-direction:column;gap:6px;}
  .dd-audio-row__title{font-weight:600;font-size:13px;word-break:break-word;}
  .dd-audio-meta{font-size:12px;opacity:.72;display:flex;flex-wrap:wrap;gap:8px;}
  .dd-audio-url{font-family:var(--qmm-font-mono,monospace);font-size:11px;word-break:break-all;color:#d6dcffb3;}
  .dd-audio-actions{display:flex;gap:6px;flex-wrap:wrap;margin-left:auto;}
  .dd-audio-empty{padding:24px 12px;text-align:center;font-size:13px;opacity:.6;}
  .dd-sprite-controls{display:flex;flex-direction:column;gap:12px;}
  .dd-sprite-control-grid{display:grid;gap:10px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));}
  .dd-sprite-control{display:flex;flex-direction:column;gap:4px;}
  .dd-sprite-control__label{font-size:11px;opacity:.72;text-transform:uppercase;letter-spacing:.08em;}
  .dd-sprite-control.is-hidden{display:none;}
  .dd-sprite-control .qmm-select{width:100%;}
  .dd-sprite-toolbar{display:flex;flex-wrap:wrap;align-items:center;gap:8px;width:100%;}
  .dd-sprite-toolbar .qmm-input{flex:1 1 220px;min-width:180px;padding:6px 10px;border-radius:8px;font-size:13px;}
  .dd-sprite-btn{padding:6px 12px;font-size:12px;border-radius:8px;border:1px solid rgba(124,148,255,.38);background:linear-gradient(180deg,rgba(122,150,255,.26),rgba(82,108,214,.14));color:#f5f7ff;box-shadow:0 3px 10px rgba(78,104,214,.22);text-shadow:0 1px 0 rgba(0,0,0,.24);}
  .dd-sprite-btn:hover{border-color:rgba(148,172,255,.45);background:linear-gradient(180deg,rgba(136,162,255,.34),rgba(98,122,226,.18));}
  .dd-sprite-btn:active{transform:translateY(1px);}
  .dd-sprite-btn .qmm-btn__icon{font-size:1.05em;}
  .dd-sprite-btn--ghost{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.14);box-shadow:none;color:inherit;text-shadow:none;}
  .dd-sprite-btn--ghost:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.2);}
  .dd-sprite-list{display:flex;flex-direction:column;gap:6px;max-height:48vh;overflow:auto;padding-right:4px;}
  .dd-sprite-item{display:flex;flex-direction:column;align-items:flex-start;gap:2px;padding:8px 10px;border-radius:10px;border:1px solid transparent;background:rgba(255,255,255,.02);cursor:pointer;text-align:left;transition:background .12s ease,border-color .12s ease,transform .12s ease;}
  .dd-sprite-item:hover{background:rgba(255,255,255,.05);border-color:rgba(255,255,255,.14);}
  .dd-sprite-item.is-active{border-color:rgba(92,126,255,.45);background:rgba(92,126,255,.18);}
  .dd-sprite-item__title{font-weight:600;font-size:13px;}
  .dd-sprite-item__subtitle{font-size:11px;opacity:.7;word-break:break-all;}
  .dd-sprite-empty{padding:20px 12px;text-align:center;font-size:13px;opacity:.68;}
  .dd-sprite-preview-body{display:flex;flex-direction:column;gap:12px;}
  .dd-sprite-preview-scroll{max-height:60vh;overflow:auto;padding-right:4px;}
  .dd-sprite-url{font-size:12px;opacity:.75;word-break:break-all;}
  .dd-sprite-tiles-grid{display:grid;gap:12px;grid-template-columns:repeat(auto-fill,minmax(96px,1fr));}
  .dd-sprite-tile{display:flex;flex-direction:column;gap:6px;align-items:center;padding:8px;border-radius:12px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);}
  .dd-sprite-tile canvas{width:100%;height:auto;image-rendering:pixelated;background:#05080c;border-radius:8px;}
  .dd-sprite-tile__name{font-weight:600;font-size:12px;text-align:center;}
  .dd-sprite-tile__refs{font-size:11px;opacity:.68;text-align:center;font-family:var(--qmm-font-mono,monospace);word-break:break-word;}
  .dd-sprite-tile__meta{font-size:11px;opacity:.75;text-align:center;font-family:var(--qmm-font-mono,monospace);}
  .dd-sprite-ui-preview{display:flex;flex-direction:column;align-items:center;gap:12px;background:rgba(0,0,0,.28);padding:12px;border-radius:12px;}
  .dd-sprite-variant-grid{display:grid;gap:8px;width:100%;grid-template-columns:repeat(auto-fit,minmax(96px,1fr));}
  .dd-sprite-variant-grid.is-wide{grid-template-columns:repeat(auto-fit,minmax(160px,1fr));max-width:100%;}
  .dd-sprite-variant{display:flex;flex-direction:column;gap:4px;align-items:center;}
  .dd-sprite-variant__label{font-size:11px;opacity:.78;text-transform:uppercase;letter-spacing:.08em;text-align:center;}
  .dd-sprite-variant__label[data-variant="gold"]{color:#f8d47c;background:linear-gradient(135deg,#fff1a1,#f3c76a 58%,#f6b84f);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 1px 4px rgba(0,0,0,.35);}
  .dd-sprite-variant__label[data-variant="rainbow"]{color:#f7f2ff;background:linear-gradient(90deg,#ff6b6b,#ffd86f,#6bff8f,#6bc7ff,#b86bff);background-clip:text;-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-shadow:0 1px 4px rgba(0,0,0,.35);}
  .dd-sprite-variant__canvas{width:100%;height:auto;image-rendering:pixelated;background:#05080c;border-radius:8px;box-shadow:inset 0 1px 0 rgba(255,255,255,.08);}
  `,document.head.appendChild(t)}function Nl(t){let e=document.createElement("div");e.className="dd-debug-columns",t.appendChild(e);let n=document.createElement("div");n.className="dd-debug-column";let r=document.createElement("div");return r.className="dd-debug-column",e.append(n,r),{columns:e,leftCol:n,rightCol:r}}async function h0(t){cM();let e=new Ye({id:"debug-tools",compact:!0});e.mount(t),e.addTab("jotai","Jotai",n=>dM(n,e)),e.addTab("atoms-live","Live atoms",n=>uM(n,e)),e.addTab("sprites","Sprites",n=>pM(n,e)),e.addTab("audio-player","Audio player",n=>fM(n,e)),e.addTab("websocket","WebSocket",n=>mM(n,e))}function dM(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Nl(t);{let s=e.card("\u{1F5C4}\uFE0F Capture store",{tone:"muted",subtitle:"Initialize the Jotai store so atoms can be inspected."});n.appendChild(s.root);let i=document.createElement("span");i.className="dd-status-chip";let a=()=>{let d=Fo();i.textContent=d?"Store captured":"Store not captured",i.classList.toggle("is-ok",d),i.classList.toggle("is-warn",!d)};a();let l=e.flexRow({gap:10,align:"center",wrap:!0}),c=e.btn("Capture store",{variant:"primary",icon:"\u23FA",onClick:async()=>{try{await St()}catch{}a()}});l.append(c,i),s.body.appendChild(l)}{let s=e.card("\u{1F50D} Explore atoms",{tone:"muted",subtitle:"Filter labels using a regular expression."});n.appendChild(s.root);let i=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),a=e.inputText("regex label (ex: position|health)","");a.classList.add("dd-grow");let l=e.btn("List",{icon:"\u{1F4C4}",onClick:()=>u()}),c=e.btn("Copy",{icon:"\u{1F4CB}",onClick:()=>tn(d.textContent||"")});i.append(a,l,c);let d=document.createElement("pre");$s(d),d.style.minHeight="140px";async function u(){let p=a.value.trim(),f=Js(p||".*"),g=Br(/.*/).filter(y=>f.test(String(y?.debugLabel||y?.label||""))).map(y=>String(y?.debugLabel||y?.label||"<?>"));d.textContent=g.join(`
`)}s.body.append(i,d)}{let s=e.card("\u{1F9ED} Inspect an atom",{tone:"muted",subtitle:"Get the current value or subscribe to updates."});r.appendChild(s.root);let i=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),a=e.inputText("atom label (ex: positionAtom)","");a.classList.add("dd-grow");let l=document.createElement("pre");$s(l),l.style.minHeight="160px";let c=null,d=e.btn("Get",{icon:"\u{1F441}",onClick:async()=>{let h=kt(a.value.trim());if(!h){l.textContent=`Atom "${a.value}" not found`;return}try{o(l,await Ht(h))}catch(m){o(l,m?.message||String(m))}}}),u=e.btn("Subscribe",{icon:"\u{1F514}",onClick:async()=>{let h=a.value.trim();if(!h)return;let m=kt(h);if(!m){l.textContent=`Atom "${h}" not found`;return}if(c){c(),c=null,u.textContent="Subscribe";return}c=await Xn(m,async()=>{try{o(l,await Ht(m))}catch{}}),u.textContent="Unsubscribe"}}),p=e.btn("Copy",{icon:"\u{1F4CB}",onClick:()=>tn(l.textContent||"")});i.append(a,d,u,p);let f=document.createElement("p");f.className="dd-inline-note",f.textContent="Tip: subscriptions keep the value updated after each mutation.",s.body.append(i,f,l)}{let s=e.card("\u270F\uFE0F Update an atom",{tone:"muted",subtitle:"Publish a new value (JSON)."});r.appendChild(s.root);let i=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),a=e.inputText("atom label (ex: activeModalAtom)","");a.classList.add("dd-grow");let l=document.createElement("textarea");l.className="qmm-input dd-textarea",l.placeholder='JSON or text value, e.g. inventory or { "x": 1, "y": 2 }';let c=e.btn("Set",{icon:"\u2705",variant:"primary",onClick:async()=>{let u=a.value.trim();if(!u){zt("Enter an atom label");return}try{await St()}catch(y){zt(y?.message||"Unable to capture store");return}if(!Fo()){zt('Store not captured. Use "Capture store" first.');return}let p=kt(u);if(!p){zt(`Atom "${u}" not found`);return}let f=l.value,h=f.trim(),m=f,g=!1;if(h)try{m=JSON.parse(h)}catch{g=!0}else m="";try{await Zn(p,m),zt(g?"Set OK (raw text)":"Set OK")}catch(y){zt(y?.message||"Set failed")}}}),d=e.btn("Copy JSON",{icon:"\u{1F4CB}",onClick:()=>tn(l.value)});i.append(a,c,d),s.body.append(i,l)}function o(s,i){s.textContent=typeof i=="string"?i:JSON.stringify(i,null,2)}}function uM(t,e){if(typeof t.__atoms_live_cleanup__=="function")try{t.__atoms_live_cleanup__()}catch{}t.innerHTML="",t.classList.add("dd-debug-view");let n=new Map,r=[],o=!1,s=null,{leftCol:i,rightCol:a}=Nl(t),l=e.card("\u{1F9EA} Pick atoms",{tone:"muted",subtitle:"Filter labels with a regex then toggle atoms to monitor."});i.appendChild(l.root);let c=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),d=e.inputText("regex label (ex: position|health)","");d.classList.add("dd-grow");let u=e.btn("Refresh",{icon:"\u{1F50D}",onClick:()=>N()});c.append(d,u);let p=document.createElement("div");p.className="dd-atom-list";let f=document.createElement("p");f.className="dd-card-description",f.textContent="No atoms match the current filter.",f.style.display="none";let h=document.createElement("p");h.className="dd-card-description",h.style.marginTop="8px",l.body.append(c,p,f,h),d.addEventListener("keydown",B=>{B.key==="Enter"&&(B.preventDefault(),N())});let m=e.card("\u{1F4E1} Live atom log",{tone:"muted",subtitle:"Start recording to capture updates for the selected atoms."});a.appendChild(m.root);let g=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),y=e.btn("Start recording",{variant:"primary",onClick:()=>Z()}),v=e.btn("Clear log",{variant:"ghost",icon:"\u{1F9F9}",onClick:()=>{r.length=0,s=null,A(!1),te(null),q()}}),w=e.btn("Copy log",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>oe()});g.append(y,v,w),m.body.appendChild(g);let x=document.createElement("div");x.className="dd-log",x.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace";let E=document.createElement("div");E.className="dd-log__empty",E.textContent="No updates yet.",x.appendChild(E),m.body.appendChild(x);let L=document.createElement("p");L.className="dd-card-description",L.textContent="Select a log entry to inspect previous and next values.";let P=e.flexRow({gap:12,wrap:!0,fullWidth:!0}),V=document.createElement("div");V.style.flex="1 1 320px";let z=document.createElement("strong");z.textContent="Previous",z.style.display="block",z.style.marginBottom="6px";let C=document.createElement("pre");$s(C),C.style.minHeight="140px",C.textContent="",V.append(z,C);let D=document.createElement("div");D.style.flex="1 1 320px";let S=document.createElement("strong");S.textContent="Next",S.style.display="block",S.style.marginBottom="6px";let G=document.createElement("pre");$s(G),G.style.minHeight="140px",G.textContent="",D.append(S,G);let se=document.createElement("div");se.style.flex="1 1 100%",se.style.minWidth="0";let X=document.createElement("strong");X.textContent="History",X.style.display="block",X.style.marginBottom="6px";let ue=document.createElement("div");ue.style.display="flex",ue.style.flexDirection="column",ue.style.gap="10px",ue.style.maxHeight="320px",ue.style.overflow="auto",se.append(X,ue),P.append(V,D,se),m.body.append(L,P);function N(){let B=d.value.trim(),O=Js(B||".*"),b=Br(O);p.innerHTML="",f.style.display=b.length?"none":"block",b.map(M=>({atom:M,label:String(M?.debugLabel||M?.label||"<unknown>")})).sort((M,_)=>M.label.localeCompare(_.label)).forEach(({atom:M,label:_})=>{let k=document.createElement("label");k.className="dd-atom-list__item",k.title=_;let T=document.createElement("input");T.type="checkbox",T.checked=n.has(_),T.className="dd-atom-list__checkbox";let F=document.createElement("span");if(F.className="dd-atom-list__label",F.textContent=_,k.append(T,F),T.addEventListener("change",async()=>{if(T.checked){let $=n.get(_);$?$.atom=M:n.set(_,{atom:M,lastValue:null,unsubscribe:null}),o&&(await Q(_)||(T.checked=!1))}else{let $=n.get(_);if($?.unsubscribe)try{$.unsubscribe()}catch{}n.delete(_)}ee(),q()}),p.appendChild(k),n.has(_)){let $=n.get(_);$&&($.atom=M)}}),ee()}function ee(){let B=n.size;h.textContent=B?`${B} atom${B>1?"s":""} selected.`:"No atom selected."}function q(){cp(y,o?"Stop recording":"Start recording"),y.classList.toggle("active",o),y.disabled=!o&&!n.size,v.disabled=r.length===0,w.disabled=r.length===0}function A(B=!1){if(x.innerHTML="",!r.length){x.appendChild(E),ne(null,null);return}r.forEach((O,b)=>{let M=document.createElement("div");M.className="atoms-log-row",M.dataset.idx=String(b),M.style.display="grid",M.style.gridTemplateColumns="minmax(120px, 160px) minmax(0, 1fr)",M.style.gap="12px",M.style.padding="10px 12px",M.style.margin="4px 0",M.style.borderRadius="12px",M.style.border="1px solid rgba(255,255,255,.12)";let _=s===b;M.style.background=_?"rgba(92,126,255,.16)":"rgba(11,16,22,.85)",M.style.borderColor=_?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)",M.style.cursor="pointer",M.addEventListener("mouseenter",()=>{M.style.borderColor="rgba(255,255,255,.28)"}),M.addEventListener("mouseleave",()=>{let R=s===b;M.style.borderColor=R?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)"});let k=document.createElement("div");k.style.display="flex",k.style.flexDirection="column",k.style.gap="2px";let T=document.createElement("strong");T.textContent=O.label;let F=document.createElement("span");F.style.opacity="0.7",F.style.fontSize="12px",F.textContent=`${vr(O.timestamp)}${O.type==="initial"?" \u2022 initial":""}`,k.append(T,F);let $=document.createElement("div");$.style.fontSize="12px",$.style.lineHeight="1.45",$.style.whiteSpace="pre-wrap";let K=O.type==="initial"?"[initial] ":"";$.textContent=K+J(O.next),M.append(k,$),M.addEventListener("click",()=>{s=b,A(!1),te(O)}),x.appendChild(M)}),B&&(x.scrollTop=x.scrollHeight),s!=null&&!r[s]&&(s=r.length?Math.min(s,r.length-1):null),s!=null&&ne(r[s]?.label??null,s)}function te(B){if(!B){L.textContent="Select a log entry to inspect previous and next values.",z.textContent="Previous",C.textContent="",S.textContent="Next",G.textContent="",ne(null,null);return}let O=B.type==="initial"?" (initial)":"";L.textContent=`${B.label} \u2014 ${vr(B.timestamp)}${O}`,z.textContent=B.type==="initial"?"Previous (none)":"Previous",C.textContent=B.type==="initial"?"(no previous snapshot)":U(B.previous),S.textContent=B.type==="initial"?"Initial value":"Next",G.textContent=U(B.next),ne(B.label,s)}function ne(B,O){if(ue.innerHTML="",!B){let M=document.createElement("p");M.className="dd-card-description",M.textContent="Select a log entry to inspect the value history.",ue.appendChild(M);return}let b=r.map((M,_)=>({rec:M,idx:_})).filter(({rec:M})=>M.label===B);if(!b.length){let M=document.createElement("p");M.className="dd-card-description",M.textContent="No history recorded yet.",ue.appendChild(M);return}b.forEach(({rec:M,idx:_},k)=>{let T=document.createElement("div");T.style.display="flex",T.style.flexDirection="column",T.style.gap="6px",T.style.padding="10px 12px",T.style.borderRadius="12px",T.style.border="1px solid rgba(255,255,255,.12)";let F=_===O;T.style.background=F?"rgba(92,126,255,.16)":"rgba(11,16,22,.85)",T.style.borderColor=F?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)",T.style.cursor="pointer",T.addEventListener("mouseenter",()=>{F||(T.style.borderColor="rgba(255,255,255,.24)")}),T.addEventListener("mouseleave",()=>{T.style.borderColor=F?"rgba(92,126,255,.42)":"rgba(255,255,255,.12)"}),T.addEventListener("click",()=>{s=_,A(!1),te(r[s])});let $=document.createElement("div");$.style.display="flex",$.style.alignItems="center",$.style.justifyContent="space-between";let K=document.createElement("div");K.style.display="flex",K.style.alignItems="center",K.style.gap="8px";let R=document.createElement("span");R.textContent=`#${k+1}`,R.style.fontSize="11px",R.style.letterSpacing=".04em",R.style.textTransform="uppercase",R.style.padding="2px 6px",R.style.borderRadius="999px",R.style.background="rgba(255,255,255,.08)",R.style.border="1px solid rgba(255,255,255,.16)";let Y=document.createElement("span");Y.textContent=M.type==="initial"?"Initial":"Update",Y.style.fontSize="11px",Y.style.opacity="0.75",Y.style.textTransform="uppercase",K.append(R,Y);let re=document.createElement("span");re.textContent=vr(M.timestamp),re.style.fontSize="12px",re.style.opacity="0.75",$.append(K,re);let I=document.createElement("pre");$s(I),I.style.margin="0",I.textContent=U(M.next),T.append($,I),ue.appendChild(T)})}async function Z(){if(o){me();return}if(!n.size){zt("Select at least one atom");return}try{await St()}catch(B){zt(B?.message||"Unable to capture store");return}o=!0,q();for(let B of Array.from(n.keys()))await Q(B)||n.delete(B);n.size||me(),ee(),q()}function me(){if(o){o=!1;for(let B of n.values())if(B.unsubscribe){try{B.unsubscribe()}catch{}B.unsubscribe=null}q()}}async function Q(B){let O=n.get(B);if(!O)return!1;if(O.unsubscribe){try{O.unsubscribe()}catch{}O.unsubscribe=null}try{let b=W(await Ht(O.atom));O.lastValue=b;let M=await Xn(O.atom,async()=>{let k=W(O.lastValue),T;try{T=await Ht(O.atom)}catch(K){T=K?.message||String(K)}let F=W(T);O.lastValue=F;let $={label:B,timestamp:Date.now(),previous:k,next:F,type:"update"};r.push($),s==null&&(s=r.length-1),A(!0),te(r[s]),q()}),_={label:B,timestamp:Date.now(),previous:null,next:W(b),type:"initial"};return r.push(_),s==null&&(s=r.length-1),A(!0),te(r[s]),O.unsubscribe=()=>{try{M()}catch{}},!0}catch(b){return zt(b?.message||`Unable to subscribe to ${B}`),n.delete(B),ee(),q(),!1}}function oe(){if(!r.length)return;let B=r.map(O=>{let b=O.previous==null?"(no previous snapshot)":U(O.previous),M=U(O.next),_=O.type==="initial"?"initial":"update";return`[${vr(O.timestamp)}] ${O.label} (${_})
previous: ${b}
next: ${M}`}).join(`

`);tn(B)}function W(B){if(B==null)return B;try{if(typeof structuredClone=="function")return structuredClone(B)}catch{}try{return JSON.parse(JSON.stringify(B))}catch{return B}}function U(B){if(typeof B=="string")return B;try{return JSON.stringify(B,null,2)}catch{return String(B)}}function J(B){let O=U(B).replace(/\s+/g," ").trim();return O.length>140?O.slice(0,140)+"\u2026":O}N(),q(),t.__atoms_live_cleanup__=()=>{me();for(let B of n.values())if(B.unsubscribe)try{B.unsubscribe()}catch{}n.clear(),r.length=0,s=null}}function pM(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Nl(t),o=[{id:"all",label:"All tiles",icon:"\u{1F5C2}\uFE0F",getUrls:()=>ke.lists().tiles},{id:"map",label:"Map",icon:"\u{1F5FA}\uFE0F",getUrls:()=>ke.listMap()},{id:"plants",label:"Plants",icon:"\u{1F33F}",getUrls:()=>[...new Set([...ke.listPlants(),...ke.listAllPlants()])]},{id:"seeds",label:"Seeds",icon:"\u{1F330}",getUrls:()=>ke.listSeeds()},{id:"items",label:"Items",icon:"\u{1F381}",getUrls:()=>ke.listItems()},{id:"pets",label:"Pets",icon:"\u{1F43E}",getUrls:()=>ke.listPets()}],s=[...o,{id:"other",label:"Other",icon:"\u{1F9E9}",getUrls:()=>{let le=new Set(ke.lists().tiles);return o.filter(H=>H.id!=="all").forEach(H=>{for(let fe of H.getUrls())le.delete(fe)}),[...le]}}],i="tiles",a="all",l=null,c=[],d=[],u=0,p="all",f=e.card("\u{1F3A8} Sprites explorer",{tone:"muted",subtitle:"Browse captured tile sheets and UI assets detected by the sprite sniffer."});f.body.classList.add("dd-sprite-controls"),n.appendChild(f.root);let h=document.createElement("div");h.className="dd-sprite-control-grid",f.body.appendChild(h);function m(le,H){let fe=document.createElement("label");fe.className="dd-sprite-control";let ae=document.createElement("span");return ae.className="dd-sprite-control__label",ae.textContent=le,fe.append(ae,H),fe}let g=e.select({width:"100%"});[{value:"tiles",label:"\u{1F9F1} Tiles"},{value:"ui",label:"\u{1F5BC}\uFE0F UI"}].forEach(({value:le,label:H})=>{let fe=document.createElement("option");fe.value=le,fe.textContent=H,g.appendChild(fe)}),g.value=i;let v=m("Asset type",g);h.appendChild(v);let w=e.select({width:"100%"});s.forEach(le=>{let H=document.createElement("option");H.value=le.id,H.textContent=`${le.icon} ${le.label}`,w.appendChild(H)}),w.value=a;let x=m("Tiles category",w);h.appendChild(x);let E=e.select({width:"100%"});[{id:"all",label:"\u2728 All variants"},{id:"normal",label:"\u{1F3A8} Normal"},{id:"gold",label:"\u{1F947} Gold"},{id:"rainbow",label:"\u{1F308} Rainbow"}].forEach(le=>{let H=document.createElement("option");H.value=le.id,H.textContent=le.label,E.appendChild(H)}),E.value=p;let P=m("Variant preview",E);h.appendChild(P);let V=e.flexRow({gap:8,wrap:!0,fullWidth:!0});V.classList.add("dd-sprite-toolbar");let z="Export all sprites",C=e.btn(z,{icon:"\u{1F4E6}",size:"sm",variant:"primary"});C.classList.add("dd-sprite-btn");let D=e.btn("Refresh lists",{icon:"\u{1F504}",size:"sm",onClick:()=>Q({preserveSelection:!0})});D.classList.add("dd-sprite-btn"),V.append(C,D),f.body.appendChild(V);let S=e.card("\u{1F5C2}\uFE0F Tile sheets",{tone:"muted",subtitle:"Select a sprite sheet to preview its tiles."});S.body.style.display="flex",S.body.style.flexDirection="column",S.body.style.gap="12px",n.appendChild(S.root);let G=e.flexRow({gap:8,wrap:!0,fullWidth:!0});G.classList.add("dd-sprite-toolbar");let se=e.inputText("filter (regex)","");se.classList.add("dd-grow");let X=e.btn("Clear",{icon:"\u{1F9F9}",size:"sm",onClick:()=>{se.value="",U(!0),se.focus()}});X.classList.add("dd-sprite-btn","dd-sprite-btn--ghost"),G.append(se,X),S.body.appendChild(G);let ue=document.createElement("div");ue.className="dd-card-description",S.body.appendChild(ue);let N=document.createElement("div");N.className="dd-sprite-list",S.body.appendChild(N);let ee=document.createElement("div");ee.className="dd-sprite-empty",ee.style.display="none",S.body.appendChild(ee);let q=e.card("\u{1F441}\uFE0F Preview",{tone:"muted",subtitle:"Visualize the slices for a tile sheet or inspect a UI sprite."});q.body.classList.add("dd-sprite-preview-body"),r.appendChild(q.root);let A=q.body,te=document.createElement("div");te.className="dd-sprite-empty",te.textContent="Select a sprite sheet or UI asset from the list.",A.appendChild(te);function ne(le){i!==le&&(i=le,g.value=i,Z(),re(),Q({preserveSelection:!1}))}function Z(){let le=i==="tiles";x.classList.toggle("is-hidden",!le),w.disabled=!le}C.addEventListener("click",()=>{me()});async function me(){if(C.disabled)return;if(typeof ke.zipAllSprites!="function"){zt("Sprites export not available yet");return}C.disabled=!0,cp(C,"Exporting\u2026");try{await ke.zipAllSprites(),zt("Sprites export ready","success")}catch(H){console.error("[debug] sprites export failed",H);let fe=H instanceof Error?H.message:typeof H=="string"?H:"Unknown error";zt(`Export failed: ${fe}`)}finally{C.disabled=!1,cp(C,z)}}function Q(le={}){let H=!!le.preserveSelection,fe=H?l:null,ae=i==="tiles"?oe(a):Array.from(new Set(ke.lists().ui));c=W(ae),H&&fe&&c.some(ye=>ye.base===fe)?l=fe:l=c[0]?.base??null,re(),U(!0)}function oe(le){let H=s.find(fe=>fe.id===le)??s[0];try{return Array.from(new Set(H.getUrls()))}catch{return[]}}function W(le){return le.map(H=>({url:H,base:de(H)})).sort((H,fe)=>H.base.localeCompare(fe.base))}function U(le){let H=se.value.trim(),fe=H?Js(H):/.*/i;d=c.filter(ae=>fe.test(ae.base)||fe.test(ae.url)),le?l&&!d.some(ae=>ae.base===l)&&(l=d[0]?.base??null):l=d[0]?.base??null,J(),O(),b(),B(),_()}function J(){N.innerHTML="";for(let le of d){let H=document.createElement("button");H.type="button",H.className="dd-sprite-item",H.dataset.base=le.base,le.base===l&&H.classList.add("is-active");let fe=document.createElement("span");fe.className="dd-sprite-item__title",fe.textContent=le.base;let ae=document.createElement("span");ae.className="dd-sprite-item__subtitle",ae.textContent=ie(le.url),H.append(fe,ae),H.addEventListener("click",()=>M(le.base)),N.appendChild(H)}}function B(){N.querySelectorAll(".dd-sprite-item").forEach(le=>{le.classList.toggle("is-active",le.dataset.base===l)})}function O(){let le=c.length,H=d.length,fe=i==="tiles"?"tile sheet":"UI asset";if(!le){ue.textContent=i==="tiles"?"No tile sheets captured yet. Trigger in-game actions then refresh.":"No UI sprites captured yet. Interact with the UI then refresh.";return}let ae=`${H} ${fe}${H===1?"":"s"} visible`;if(H!==le&&(ae+=` (total ${le})`),i==="tiles"&&a!=="all"){let ye=s.find(Ee=>Ee.id===a);ye&&(ae+=` \xB7 ${ye.label}`)}ue.textContent=ae}function b(){d.length?ee.style.display="none":(ee.style.display="",c.length?ee.textContent=i==="tiles"?"No tile sheets match the current filters.":"No UI assets match the current filters.":ee.textContent=i==="tiles"?"No tile sheets captured yet. Trigger in-game actions then refresh.":"No UI sprites captured yet. Interact with the UI then refresh.")}function M(le){l!==le&&(l=le,B(),_())}async function _(){let le=d.find(fe=>fe.base===l)??c.find(fe=>fe.base===l)??null,H=++u;await k(le,H)}async function k(le,H){if(!le){q.setTitle("\u{1F441}\uFE0F Preview"),A.replaceChildren(j(i==="tiles"?"Select a tile sheet to preview its tiles.":"Select a UI asset to inspect it."));return}q.setTitle(`\u{1F441}\uFE0F Preview \xB7 ${le.base}`);let fe=j("Loading\u2026");A.replaceChildren(fe);try{i==="tiles"?await R(le,H):await Y(le,H)}catch(ae){if(H!==u)return;let ye=ae instanceof Error?ae.message:typeof ae=="string"?ae:"Unknown error";A.replaceChildren(j(`Failed to load sprite: ${ye}`))}}function T(le,H){let fe=document.createElement("div");return fe.className="dd-sprite-variant-grid",H?.wide&&fe.classList.add("is-wide"),le.forEach(ae=>{let{type:ye,icon:Ee,label:Ie,canvas:Oe}=ae;Oe.classList.add("dd-sprite-variant__canvas");let je=document.createElement("div");je.className="dd-sprite-variant";let Ne=document.createElement("div");Ne.className="dd-sprite-variant__label",Ne.dataset.variant=ye,Ne.textContent=`${Ee} ${Ie}`,je.append(Oe,Ne),fe.appendChild(je)}),fe}function F(le){let H=le.data;if(typeof H=="string"||!H)return null;let fe=le.size??0,ae=Math.max(typeof H.width=="number"?H.width:fe,1),ye=Math.max(typeof H.height=="number"?H.height:fe,1),Ee=document.createElement("canvas");Ee.width=ae,Ee.height=ye;let Ie=Ee.getContext("2d");if(!Ie)return null;Ie.imageSmoothingEnabled=!1;try{Ie.drawImage(H,0,0,ae,ye)}catch{return null}return Ee}function $(le){return p==="all"?le:le.filter(H=>H.type===p)}function K(le){let H=[],fe=F(le);fe&&H.push({type:"normal",icon:"\u{1F3A8}",label:"Normal",canvas:fe});let ae=(ye,Ee,Ie,Oe)=>{try{let je=Oe();H.push({type:ye,icon:Ie,label:Ee,canvas:je})}catch{}};return fe&&(ae("gold","Gold","\u{1F947}",()=>ke.effectGold(le)),ae("rainbow","Rainbow","\u{1F308}",()=>ke.effectRainbow(le))),H}async function R(le,H){let fe=le.base.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),ae=new RegExp(`${fe}.(png|webp)$`,"i"),ye=await ke.loadTiles({mode:"canvas",includeBlanks:!1,onlySheets:ae});if(H!==u)return;let Ee=ye.get(le.base)||[];if(A.innerHTML="",!Ee.length){A.append(j("No tiles available for this sheet."));return}let Ie=document.createElement("div");Ie.className="dd-card-description";let Oe=Ee[0]?.size??0;Ie.textContent=`${Ee.length} tile${Ee.length===1?"":"s"} \xB7 ${Oe?`${Oe}\xD7${Oe}px`:"unknown size"}`;let je=I(le.url),Ne=document.createElement("div");Ne.className="dd-sprite-preview-scroll";let Qe=document.createElement("div");Qe.className="dd-sprite-tiles-grid",Ne.appendChild(Qe),Ee.forEach($e=>{let ut=document.createElement("div");ut.className="dd-sprite-tile";let Ft=$(K($e));Ft.length&&ut.appendChild(T(Ft));let Cn=i0($e.sheet,$e.index);if(Cn){let Pi=Array.from(new Set(Cn.entries.map(Oo=>Oo.displayName||Oo.key))),No=document.createElement("div");No.className="dd-sprite-tile__name",No.textContent=Pi.length?`${Cn.sheetLabel}: ${Pi.join(", ")}`:Cn.sheetLabel,ut.appendChild(No);let Dr=document.createElement("div");Dr.className="dd-sprite-tile__refs";let Qp=Cn.entries.map(Oo=>`${Oo.qualifiedName} (#${Oo.index})`).join(" \xB7 ");Dr.textContent=Qp,Dr.title=Qp,ut.appendChild(Dr)}let Lo=document.createElement("div");Lo.className="dd-sprite-tile__meta",Lo.textContent=`#${$e.index} \xB7 col ${$e.col} \xB7 row ${$e.row}`,ut.appendChild(Lo),Qe.appendChild(ut)}),A.append(Ie,je,Ne)}async function Y(le,H){let fe=await ke.loadUI();if(H!==u)return;let ae=fe.get(le.base);if(A.innerHTML="",!ae){A.append(j("This UI asset was not found in the cache yet."));return}let ye=document.createElement("div");ye.className="dd-card-description",ye.textContent="Dimensions: \u2026";let Ee=I(le.url),Ie=document.createElement("div");Ie.className="dd-sprite-ui-preview";let Oe=ae.naturalWidth||ae.width,je=ae.naturalHeight||ae.height;Oe&&je?ye.textContent=`Dimensions: ${Oe}\xD7${je}px`:ye.textContent="Dimensions: unknown";let Ne=document.createElement("canvas");Ne.width=Oe||ae.width||1,Ne.height=je||ae.height||1;let Qe=Ne.getContext("2d");if(Qe){Qe.imageSmoothingEnabled=!1;try{Qe.drawImage(ae,0,0,Ne.width,Ne.height)}catch{}}let $e={sheet:le.base,url:le.url,index:0,col:0,row:0,size:Math.max(Ne.width,Ne.height,1),data:Ne},ut=$(K($e));ut.length&&Ie.appendChild(T(ut,{wide:!0})),A.append(ye,Ee,Ie)}function re(){if(i==="tiles"){let le=s.find(H=>H.id===a);S.setTitle(`${le?.icon??"\u{1F5C2}\uFE0F"} ${le?.label??"Tiles"}`)}else S.setTitle("\u{1F5BC}\uFE0F UI assets")}function I(le){let H=document.createElement("div");H.className="dd-sprite-url";let fe=document.createElement("a");return fe.href=le,fe.target="_blank",fe.rel="noopener noreferrer",fe.textContent=le,H.appendChild(fe),H}function j(le){let H=document.createElement("div");return H.className="dd-sprite-empty",H.textContent=le,H}function de(le){try{let H=decodeURIComponent(le.split(/[#?]/)[0]),ae=H.split("/").pop()||"";return ae.replace(/\.[a-z0-9]+$/i,"")||ae||H}catch{return le}}function ie(le){try{let H=new URL(le,location.href);return H.pathname.replace(/^\//,"")||H.hostname}catch{return le}}function ge(){Q({preserveSelection:!0})}se.addEventListener("input",()=>U(!0)),se.addEventListener("keydown",le=>{le.key==="Enter"&&(le.preventDefault(),U(!0))}),g.addEventListener("change",()=>{let le=g.value==="ui"?"ui":"tiles";ne(le)}),w.addEventListener("change",()=>{let le=w.value||s[0]?.id||"all";a!==le&&(a=le,re(),Q({preserveSelection:!1}))}),E.addEventListener("change",()=>{let le=E.value||"all";p!==le&&(p=le,_())}),Z(),re(),Q({preserveSelection:!1});let be=t.__spriteListener;be&&window.removeEventListener("mg:sprite-detected",be),t.__spriteListener=ge,window.addEventListener("mg:sprite-detected",ge);let ve=e.on("unmounted",()=>{window.removeEventListener("mg:sprite-detected",ge),t.__spriteListener=void 0,ve()})}function fM(t,e){t.innerHTML="",t.classList.add("dd-debug-view");let{leftCol:n,rightCol:r}=Nl(t),o=[],s=[],i=[],a=e.card("\u{1F3A7} Audio player",{tone:"muted",subtitle:"Inspect detected sounds, auto groups and Howler status."});n.appendChild(a.root);let l=document.createElement("div");l.className="dd-audio-summary";let c=document.createElement("div"),d=document.createElement("div"),u=document.createElement("div");l.append(c,d,u);let p=document.createElement("div");p.className="dd-audio-volume";let f=document.createElement("div");f.className="dd-audio-volume";let h=e.errorBar(),m=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),g=e.btn("Rescan sounds",{icon:"\u{1F504}",variant:"primary",onClick:()=>{B({rescan:!0})}}),y=e.btn("Refresh snapshot",{icon:"\u{1F501}",onClick:()=>{B()}}),v=e.btn("Copy JSON",{icon:"\u{1F4CB}",onClick:()=>tn($t.exportJSON())});m.append(g,y,v),a.body.append(l,p,f,h.el,m);let w=e.card("\u{1F39B}\uFE0F Groups",{tone:"muted",subtitle:"Browse auto-generated groups and play random variations."});n.appendChild(w.root);let x=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),E=e.inputText("filter groups (regex)","");E.classList.add("dd-grow");let L=e.btn("Clear",{icon:"\u{1F9F9}",onClick:()=>{E.value="",U(),E.focus()}});x.append(E,L);let P=document.createElement("p");P.className="dd-card-description",P.style.margin="0";let V=document.createElement("div");V.className="dd-audio-list";let z=document.createElement("div");z.className="dd-audio-empty",z.textContent="No groups match the current filter.",w.body.append(x,P,V,z);let C=e.card("\u{1F509} Sounds",{tone:"muted",subtitle:"Inspect detected files and trigger playback."});r.appendChild(C.root);let D=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),S=e.inputText("filter sounds (regex)","");S.classList.add("dd-grow");let G=e.btn("Clear",{icon:"\u{1F9F9}",onClick:()=>{S.value="",J(),S.focus()}}),se=e.btn("Copy visible URLs",{icon:"\u{1F4CB}",onClick:()=>{i.length&&tn(i.map(O=>O.url).join(`
`))}});D.append(S,G,se);let X=document.createElement("p");X.className="dd-card-description",X.style.margin="0";let ue=document.createElement("div");ue.className="dd-audio-list";let N=document.createElement("div");N.className="dd-audio-empty",N.textContent="No sounds match the current filter.",C.body.append(D,X,ue,N),E.addEventListener("input",()=>U()),E.addEventListener("keydown",O=>{O.key==="Enter"&&(O.preventDefault(),U())}),S.addEventListener("input",()=>J()),S.addEventListener("keydown",O=>{O.key==="Enter"&&(O.preventDefault(),J())});let ee=!1;function q(O){return O.logicalName||O.name||A(O.url)}function A(O){try{return new URL(O,location.href).pathname.split("/").pop()||O}catch{return O}}function te(O,b=3){return O==null||Number.isNaN(O)||!Number.isFinite(O)?"\u2014":O.toFixed(b)}function ne(O,b){let M=O.setEnabled;typeof M=="function"?M(b):O.disabled=!b}let Z=g.querySelector(".label"),me=Z?.textContent??"Rescan sounds";function Q(O){ne(g,!O),Z&&(Z.textContent=O?"Scanning\u2026":me)}function oe(){o=$t.info().slice().sort((O,b)=>q(O).localeCompare(q(b))),s=Object.entries($t.groups()).sort((O,b)=>O[0].localeCompare(b[0]))}function W(){let O=new Set;o.forEach(F=>{(F.sources||"").split(",").map($=>$.trim()).filter(Boolean).forEach($=>O.add($))});let b=$t.getGameSfxVolume(),M=window?.Howler,_=null;try{if(M&&typeof M.volume=="function"){let F=M.volume();typeof F=="number"&&Number.isFinite(F)&&(_=F)}}catch{}let k=Array.isArray(M?._howls)?M._howls.length:0;c.innerHTML=`<strong>${o.length}</strong> sounds detected`,d.innerHTML=`<strong>${s.length}</strong> auto groups`,u.innerHTML=`<strong>${O.size}</strong> unique source tags`,p.textContent=`Atom raw: ${te(b.raw)} (clamped ${te(b.clamped)})`;let T="";_!=null?(T=` \xB7 Howler master ${te(_)}`,k&&(T+=` (${k} howl${k===1?"":"s"})`)):k&&(T=` \xB7 ${k} howl${k===1?"":"s"} registered`),f.textContent=`Final output volume: ${te(b.vol)}${T}`}function U(){let O=Js(E.value.trim()||".*"),b=new Map(o.map(k=>[k.url,k]));V.innerHTML="";let M=0,_=k=>!!k&&O.test(k);for(let[k,T]of s){if(!(_(k)||T.some(le=>{let H=b.get(le);return _(le)||_(H?.logicalName)||_(H?.name)})))continue;M++;let $=T[0]||"",K=b.get($),R=document.createElement("div");R.className="dd-audio-row";let Y=document.createElement("div");Y.className="dd-audio-row__info";let re=document.createElement("div");re.className="dd-audio-row__title",re.textContent=k;let I=document.createElement("div");I.className="dd-audio-meta";let j=[];j.push(`${T.length} variation${T.length===1?"":"s"}`),K?.name&&j.push(`Sample: ${K.name}`),K?.sources&&j.push(`Sources: ${K.sources}`),I.textContent=j.join(" \u2022 ");let de=document.createElement("div");de.className="dd-audio-url",de.textContent=$||"(no sample)",Y.append(re,I,de),R.appendChild(Y);let ie=e.flexRow({gap:6,wrap:!1,align:"center"});ie.className="dd-audio-actions";let ge=e.btn("Play",{icon:"\u25B6\uFE0F",size:"sm",onClick:()=>{$t.playGroup(k,{random:!0})}}),be=e.btn("Copy URLs",{icon:"\u{1F4CB}",size:"sm",onClick:()=>tn(T.join(`
`))}),ve=$?e.btn("Open",{icon:"\u{1F517}",size:"sm",onClick:()=>{try{window.open($,"_blank","noopener,noreferrer")}catch{}}}):null;ie.append(ge,be),ve&&ie.append(ve),R.appendChild(ie),V.appendChild(R)}P.textContent=s.length?`${M} / ${s.length} groups shown.`:"No groups have been detected yet. Run a rescan to populate the cache.",V.style.display=M?"":"none",z.textContent=s.length?"No groups match the current filter.":"No groups detected yet. Run a rescan to populate the cache.",z.style.display=M?"none":"block",ne(L,E.value.trim().length>0)}function J(){let O=Js(S.value.trim()||".*");i=[],ue.innerHTML="";let b=M=>!!M&&O.test(M);for(let M of o){if(!(b(M.logicalName)||b(M.name)||b(M.sources)||b(M.url)))continue;i.push(M);let _=document.createElement("div");_.className="dd-audio-row";let k=document.createElement("div");k.className="dd-audio-row__info";let T=document.createElement("div");T.className="dd-audio-row__title",T.textContent=q(M);let F=document.createElement("div");F.className="dd-audio-meta";let $=[];M.name&&M.name!==M.logicalName&&$.push(`File: ${M.name}`),M.logicalName&&$.push(`Logical: ${M.logicalName}`),M.sources&&$.push(`Sources: ${M.sources}`),F.textContent=$.join(" \u2022 ");let K=document.createElement("div");K.className="dd-audio-url",K.textContent=M.url,k.append(T,F,K),_.appendChild(k);let R=e.flexRow({gap:6,wrap:!1,align:"center"});R.className="dd-audio-actions";let Y=e.btn("Play",{icon:"\u25B6\uFE0F",size:"sm",onClick:()=>{$t.playUrl(M.url)}}),re=e.btn("Copy",{icon:"\u{1F4CB}",size:"sm",onClick:()=>tn(M.url)}),I=e.btn("Open",{icon:"\u{1F517}",size:"sm",onClick:()=>{try{window.open(M.url,"_blank","noopener,noreferrer")}catch{}}});R.append(Y,re,I),_.appendChild(R),ue.appendChild(_)}X.textContent=o.length?`${i.length} / ${o.length} sounds shown.`:"No sounds have been detected yet. Run a rescan to populate the cache.",ue.style.display=i.length?"":"none",N.textContent=o.length?"No sounds match the current filter.":"No sounds detected yet. Run a rescan to populate the cache.",N.style.display=i.length?"none":"block",ne(se,i.length>0),ne(G,S.value.trim().length>0)}async function B(O={}){if(ee)return;ee=!0;let{rescan:b=!1}=O;h.clear(),b?Q(!0):ne(g,!1),ne(y,!1);let M=null;try{if(b)try{await $t.scan()}catch(_){M=_}if(oe(),W(),U(),J(),M){let _=M instanceof Error?M.message:String(M);h.show(`Scan failed: ${_}`),console.error("[debug] audio scan failed",M)}}finally{b?Q(!1):ne(g,!0),ne(y,!0),ee=!1}}B()}function mM(t,e){if(typeof t.__ws_cleanup__=="function")try{t.__ws_cleanup__()}catch{}t.innerHTML="",t.classList.add("dd-debug-view");let n=new Ll(2e3),r=new Map,o=0,s=!1,i=!0,a=!0,l=!0,c="",d=!1,u=!1,p=null,f=[],h=I=>{if(p=I,[...ne.querySelectorAll("[data-fid]")].forEach(j=>{j.classList.toggle("selected",String(I||"")===j.dataset.fid)}),I!=null){let j=r.get(I);j&&(me.value=j.text)}},m=I=>f.some(j=>j.test(I)),g=e.card("\u{1F4E1} Live traffic",{tone:"muted",subtitle:"Monitor, filter, and replay WebSocket frames."});t.appendChild(g.root);let y=e.card("\u{1F649} Mutes (regex)",{tone:"muted",subtitle:"Hide unwanted messages."});t.appendChild(y.root);let v=e.card("\u{1F9FE} Frame log",{tone:"muted"});t.appendChild(v.root);let w=e.card("\u{1F4E4} Send a frame",{tone:"muted",subtitle:"Pick or compose a payload and send it."});t.appendChild(w.root);let x=document.createElement("div");x.className="dd-toolbar dd-toolbar--stretch",g.body.appendChild(x);let E=document.createElement("span");E.className="dd-status-chip";let L=e.select({width:"220px"}),P=e.btn("Pause",{variant:"secondary",onClick:()=>{s=!s,V(s?"Resume":"Pause"),P.classList.toggle("active",s),P.title=s?"Resume live updates":"Pause live updates"}}),V=I=>{let j=P.querySelector(".label");j?j.textContent=I:P.textContent=I};V("Pause"),P.title="Suspend live updates";let z=e.btn("Clear",{variant:"ghost",icon:"\u{1F9F9}",onClick:()=>{n.clear(),r.clear(),h(null),$(!0)}}),C=e.btn("Copy visible",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>K()});x.append(E,L,P,z,C);let D=document.createElement("div");D.className="dd-toolbar dd-toolbar--stretch",g.body.appendChild(D);let S=e.inputText("filter text (case-insensitive)","");S.classList.add("dd-grow"),S.addEventListener("input",()=>{c=S.value.trim().toLowerCase(),$(!0)});let G=e.toggleChip("IN",{checked:!0,icon:"\u2190",tooltip:"Show incoming messages"});G.input.addEventListener("change",()=>{a=G.input.checked,$(!0)});let se=e.toggleChip("OUT",{checked:!0,icon:"\u2192",tooltip:"Show outgoing messages"});se.input.addEventListener("change",()=>{l=se.input.checked,$(!0)});let X=e.toggleChip("Active socket",{checked:!1,icon:"\u{1F3AF}",tooltip:"Limit to the selected socket"});X.input.addEventListener("change",()=>{d=X.input.checked,$(!0)});let ue=e.toggleChip("Auto-scroll",{checked:!0,icon:"\u{1F4DC}",tooltip:"Keep the log aligned with the latest frames"});ue.input.addEventListener("change",()=>{i=ue.input.checked}),D.append(S,G.root,se.root,X.root,ue.root);let N=e.flexRow({gap:10,wrap:!0,fullWidth:!0}),ee=e.inputText("add regex (e.g. ping|keepalive)","");ee.classList.add("dd-grow");let q=e.btn("Add",{icon:"\u2795",onClick:()=>{let I=ee.value.trim();if(I)try{f.push(new RegExp(I,"i")),ee.value="",te(),$(!0)}catch{}}});N.append(ee,q),y.body.appendChild(N);let A=document.createElement("div");A.className="dd-mute-chips",y.body.appendChild(A);function te(){A.innerHTML="",f.forEach((I,j)=>{let de=e.btn(`/${I.source}/i \xD7`,{variant:"ghost",size:"sm",onClick:()=>{f.splice(j,1),te(),$(!0)}});A.appendChild(de)})}let ne=document.createElement("div");ne.className="dd-log",ne.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",ne.style.fontSize="12px",ne.style.lineHeight="1.4",ne.style.userSelect="text";let Z=document.createElement("div");Z.className="dd-log__empty",Z.textContent="No frames visible yet.",ne.appendChild(Z),v.body.appendChild(ne);let me=document.createElement("textarea");me.className="qmm-input dd-textarea",me.placeholder="Select a frame or paste a payload here. Choose Text or JSON below.";let Q=document.createElement("div");Q.className="dd-send-controls";let oe=e.radioGroup("ws-send-mode",[{value:"text",label:"Text"},{value:"json",label:"JSON"}],"text",()=>{}),W=e.toggleChip("Use source WS",{checked:!1,icon:"\u21A9"});W.input.addEventListener("change",()=>{u=W.input.checked});let U=e.btn("Send",{variant:"primary",icon:"\u{1F4E8}",onClick:()=>Y()}),J=e.btn("Copy payload",{variant:"ghost",icon:"\u{1F4CB}",onClick:()=>tn(me.value)});Q.append(oe,W.root,U,J),w.body.append(me,Q);function B(){let I=lp();L.innerHTML="",I.forEach((j,de)=>{let ie=document.createElement("option");ie.value=String(de),ie.textContent=j.id+(j.ws===yn?" \u2022 page":""),L.appendChild(ie)}),!L.value&&L.options.length&&(L.value="0"),b()}function O(){let I=Number(L.value),j=lp();return Number.isFinite(I)?j[I]?.ws??null:null}function b(){let I=p0();E.textContent=I;let j=I.toLowerCase();E.classList.toggle("is-ok",/open|connected|ready/.test(j)),E.classList.toggle("is-warn",/closing|connecting|pending/.test(j))}function M(){let I=ne.querySelector(".ws-row")!=null;Z.style.display=I?"none":""}function _(I){return!(I.dir==="in"&&!a||I.dir==="out"&&!l||c&&!I.text.toLowerCase().includes(c)||d&&I.ws&&O()&&I.ws!==O()||m(I.text))}function k(I,j){let de=document.createElement("div");de.className="acts";let ie=document.createElement("button");ie.className="qmm-btn",ie.textContent="Copy",ie.onclick=ve=>{ve.stopPropagation(),tn(j.text)};let ge=document.createElement("button");ge.className="qmm-btn",ge.textContent="\u2192 Editor",ge.onclick=ve=>{ve.stopPropagation(),me.value=j.text,h(I)};let be=document.createElement("button");return be.className="qmm-btn",be.textContent="Replay",be.title="Send right away (to current WS or source WS if enabled)",be.onclick=ve=>{ve.stopPropagation(),R(j)},de.append(ie,ge,be),de}function T(I){let j=document.createElement("div");j.className="ws-row",j.dataset.fid=String(I.id);let de=document.createElement("div");de.className="ts",de.textContent=vr(I.t);let ie=document.createElement("div");ie.className="arrow",ie.textContent=I.dir==="in"?"\u2190":"\u2192",ie.style.color=I.dir==="in"?"#4bd17a":"#8ab4ff";let ge=document.createElement("div");ge.className="body",ge.innerHTML=`<code>${u0(I.text)}</code>`;let be=k(I.id,I);return j.append(de,ie,ge,be),j.onclick=()=>h(I.id),j.ondblclick=()=>{me.value=I.text,h(I.id)},j}function F(I){if(!_(I))return;let j=T(I);ne.appendChild(j),M(),i&&(ne.scrollTop=ne.scrollHeight)}function $(I=!1){ne.querySelectorAll(".ws-row").forEach(j=>j.remove()),n.toArray().forEach(j=>{_(j)&&ne.appendChild(T(j))}),M(),p!=null&&h(p),i&&(ne.scrollTop=ne.scrollHeight)}function K(){let I=n.toArray().filter(j=>_(j)).map(j=>`[${vr(j.t)}] ${j.dir==="in"?"<-":"->"} ${j.text}`).join(`
`);tn(I)}function R(I){let j=u&&I.ws?I.ws:O();if(!j||j.readyState!==WebSocket.OPEN)return;if((oe.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{j.send(JSON.parse(I.text))}catch{j.send(I.text)}else j.send(I.text)}function Y(){let I=O(),j=p!=null&&u?r.get(p)?.ws??null:null,de=(u?j:I)||I;if(!de||de.readyState!==WebSocket.OPEN)return;if((oe.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{de.send(JSON.parse(me.value))}catch{de.send(me.value)}else de.send(me.value)}f0(I=>{if(s)return;let j={...I,id:++o};n.push(j),r.set(j.id,j),b(),F(j)}),B(),$(!0);let re=window.setInterval(()=>{B()},1e3);t.__ws_cleanup__=()=>{window.clearInterval(re)}}function tn(t){let e=String(t??"");if(!e.length)return;let n=()=>{let r=document.createElement("textarea");r.value=e,r.setAttribute("readonly","true"),r.style.position="fixed",r.style.left="-9999px",r.style.opacity="0",document.body.appendChild(r),r.focus(),r.select();let o=!1;try{o=document.execCommand("copy")}catch{}document.body.removeChild(r);try{window.toastSimple?.(o?"Copied":"Copy failed","",o?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(e).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(n):n()}function Js(t){try{return new RegExp(t,"i")}catch{return/.*/i}}function $s(t){t.style.maxHeight="260px",t.style.overflow="auto",t.style.background="#0b1016",t.style.border="1px solid #ffffff18",t.style.borderRadius="12px",t.style.padding="12px",t.style.margin="6px 0 0",t.style.fontSize="12px",t.style.lineHeight="1.5",t.style.color="#dbe4ff",t.style.boxShadow="inset 0 1px 0 rgba(255,255,255,.04)"}function hM(t){if(!t||typeof t!="object")return[];let e=[],n=new Set,r=[t];for(;r.length;){let s=r.pop();if(!(!s||typeof s!="object"||n.has(s))){n.add(s);for(let i of Object.keys(s)){let a=s[i];Array.isArray(a)&&a.length&&a.every(l=>l&&typeof l=="object")&&a.some(c=>"id"in c&&"name"in c)&&/player/i.test(i)&&e.push(...a),a&&typeof a=="object"&&r.push(a)}}}let o=new Map;for(let s of e)s?.id&&o.set(String(s.id),s);return[...o.values()]}function g0(t){let e=t?.fullState?.data?.players??t?.data?.players??t?.players;return Array.isArray(e)?e:hM(t)}function up(t){let e=t?.child?.data?.userSlots??t?.fullState?.child?.data?.userSlots??t?.data?.userSlots;if(Array.isArray(e))return e;if(e&&typeof e=="object"){let n=Object.entries(e);return n.sort((r,o)=>{let s=Number(r[0]),i=Number(o[0]);return Number.isFinite(s)&&Number.isFinite(i)?s-i:r[0].localeCompare(o[0])}),n.map(([,r])=>r)}return[]}function w0(t){let e=t?.data?.position??t?.position??t?.data?.coords??t?.coords,n=Number(e?.x),r=Number(e?.y);return Number.isFinite(n)&&Number.isFinite(r)?{x:n,y:r}:null}function S0(t){let e=t?.data?.inventory;if(!e||typeof e!="object")return null;let n=Array.isArray(e.items)?e.items:[],r=Array.isArray(e.favoritedItemIds)?e.favoritedItemIds:[];return{items:n,favoritedItemIds:r}}function gM(t){let e=t?.data?.journal??t?.journal;if(!e||typeof e!="object")return null;let n=e.produce&&typeof e.produce=="object"?e.produce:void 0,r=e.pets&&typeof e.pets=="object"?e.pets:void 0,o=n?Object.fromEntries(Object.entries(n).map(([i,a])=>[String(i),{variantsLogged:Array.isArray(a?.variantsLogged)?a.variantsLogged:[]}])):void 0,s=r?Object.fromEntries(Object.entries(r).map(([i,a])=>[String(i),{variantsLogged:Array.isArray(a?.variantsLogged)?a.variantsLogged:[],abilitiesLogged:Array.isArray(a?.abilitiesLogged)?a.abilitiesLogged:[]}])):void 0;return{produce:o,pets:s}}function yM(t){let e=t?.data?.garden??t?.garden;if(!e||typeof e!="object")return null;let n=e.tileObjects,r=e.boardwalkTileObjects;return{tileObjects:n&&typeof n=="object"?n:{},boardwalkTileObjects:r&&typeof r=="object"?r:{}}}function Ol(t,e){for(let n of up(t))if(String(n?.playerId??"")===String(e))return n;return null}function bM(t,e){let n=new Map;for(let r of up(e)){if(!r||typeof r!="object")continue;let o=r.playerId!=null?String(r.playerId):"";if(!o)continue;let s=w0(r),i=S0(r);n.set(o,{x:s?.x,y:s?.y,inventory:i??null})}return t.map(r=>{let o=n.get(String(r.id));return o?{...r,...o}:{...r,inventory:null}})}function vM(t,e){let n=up(e),r=new Map;for(let i of t)r.set(String(i.id),i);let o=[],s=new Set;for(let i of n){let a=i?.playerId!=null?String(i.playerId):"";if(!a||s.has(a))continue;let l=r.get(a);l&&(o.push(l),s.add(a))}for(let i of t){let a=String(i.id);s.has(a)||(o.push(i),s.add(a))}return o}function wM(t){let e=Math.floor(Number(t));return Number.isFinite(e)?Math.max(1,Math.min(6,e)):1}async function y0(){try{let t=await pe.server.numPlayers.get();return wM(t)}catch{return 1}}var Gn=null,Qs=null;async function SM(){if(Array.isArray(Gn))return Gn;if(Qs)return Qs;Qs=(async()=>{try{let n=(await pe.root.map.get())?.spawnTiles;if(Array.isArray(n)&&n.every(r=>Number.isFinite(r)))return Gn=[...n].sort((r,o)=>r-o),Gn}catch{}try{let e=await pe.root.state.get(),n=new Set,r=[e];for(;r.length;){let o=r.pop();if(!o||typeof o!="object"||n.has(o))continue;n.add(o);let s=o?.spawnTiles;if(Array.isArray(s)&&s.every(i=>Number.isFinite(i)))return Gn=[...s].sort((i,a)=>i-a),Gn;for(let i of Object.keys(o)){let a=o[i];a&&typeof a=="object"&&r.push(a)}}}catch{}return Gn=[],Gn})();let t=await Qs;return Qs=null,t}async function xM(){try{let t=await pe.root.map.get(),e=Number(t?.cols);if(Number.isFinite(e)&&e>0)return e}catch{}try{let t=await pe.root.state.get(),e=Number(t?.map?.cols??t?.child?.data?.map?.cols??t?.fullState?.map?.cols);if(Number.isFinite(e)&&e>0)return e}catch{}return 81}function EM(t,e){if(!t.length||!e.length)return t.map(r=>({...r,gardenPosition:null}));let n=[];for(let r=0;r<t.length;r++)n.push({...t[r],gardenPosition:e[r]??null});return n}function dp(){return Date.now()}function CM(t){if(!t||typeof t!="object")return{};let e={};return t.produce&&typeof t.produce=="object"&&(e.produce=t.produce),t.pets&&typeof t.pets=="object"&&(e.pets=t.pets),e}function TM(t){if(!t)return!1;let e=!!t.produce&&Object.values(t.produce).some(r=>(r.variantsLogged?.length??0)>0),n=!!t.pets&&Object.values(t.pets).some(r=>(r.variantsLogged?.length??0)>0||(r.abilitiesLogged?.length??0)>0);return e||n}var Je={currentTargetId:null,unsub:null,lastPos:null,prevPos:null,steps:0},kM=20,IM=3,b0=1,We={targetId:null,unsub:null,timer:null,pets:[],history:[],historyCap:0};function AM(){We.timer&&(clearInterval(We.timer),We.timer=null)}async function MM(){if(We.unsub){let t=We.unsub;We.unsub=null;try{await t()}catch{}}else We.unsub=null;AM(),We.targetId=null,We.pets=[],We.history=[],We.historyCap=0}function v0(t,e=!1){let n=We.history[0];if(!e&&n&&n.x===t.x&&n.y===t.y)return;We.history.unshift({x:t.x,y:t.y});let r=We.historyCap||We.history.length;We.history.length>r&&(We.history.length=r)}var ct={async list(){let t=await pe.root.state.get();if(!t)return[];let e=bM(g0(t),t),n=vM(e,t),r=await SM();return EM(n,r)},async onChange(t){return pe.root.state.onChange(async()=>{try{t(await this.list())}catch{}})},async getPosition(t){let e=await pe.root.state.get();if(!e)return null;let n=Ol(e,t);return w0(n)},async getInventory(t){let e=await pe.root.state.get();if(!e)return null;let n=Ol(e,t);return S0(n)},async getJournal(t){let e=await pe.root.state.get();if(!e)return null;let n=Ol(e,t),r=gM(n);return r?CM(r):null},async getGarden(t){let e=await pe.root.state.get();if(!e)return null;let n=Ol(e,t);return yM(n)},async getGardenPosition(t){return(await this.list()).find(r=>String(r.id)===String(t))?.gardenPosition??null},async getPlayerNameById(t){try{let e=await pe.root.state.get();if(e){let r=g0(e).find(o=>String(o?.id)===String(t));if(r&&typeof r.name=="string"&&r.name)return r.name}}catch{}try{return(await this.list()).find(r=>String(r.id)===String(t))?.name??null}catch{return null}},async teleportToPlayer(t){let e=await this.getPosition(t);if(!e)throw new Error("Unknown position for this player");Se.teleport(e.x,e.y),we("Teleport",`Teleported to ${await this.getPlayerNameById(t)}`,"success")},async teleportToGarden(t){let e=await this.getGardenPosition(t);if(e==null){await we("Teleport","No garden position for this player.","error");return}let n=await xM(),r=e%n,o=Math.floor(e/n);await Se.teleport(r,o),await we("Teleport",`Teleported to ${await this.getPlayerNameById(t)}'s garden`,"success")},async getInventoryValue(t,e){try{let n=await y0(),r=await this.getInventory(t),o=Array.isArray(r?.items)?r.items:[];return o.length?Sg(o,e,n):0}catch{return 0}},async getGardenValue(t,e){try{let n=await y0(),r=await this.getGarden(t);return r?xg(r.tileObjects??{},e,n):0}catch{return 0}},async openInventoryPreview(t,e){try{let n=await this.getInventory(t);if(!n){await we("Inventory","No inventory object found for this player.","error");return}let r=Array.isArray(n.items)?n.items:[];if(r.length===0){await we("Inventory","Inventory is empty for this player.","info");return}try{await Wt({...n,items:r},{open:!0})}catch(o){await we("Inventory",o?.message||"Failed to open inventory","error");return}e&&await we("Inventory",`${e}'s inventory displayed.`,"info")}catch(n){await we("Inventory",n?.message||"Failed to open inventory.","error")}},async openJournalLog(t,e){try{let n=await this.getJournal(t);if(!TM(n)){await we("Journal","No journal data for this player.","error");return}let r=n??{};try{await Jo(r,{open:!0})}catch(o){await we("Journal",o?.message||"Failed to open journal.","error");return}e&&await we("Journal",`${e}'s journal displayed.`,"info")}catch(n){await we("Journal",n?.message||"Failed to open journal.","error")}},async addProduceVariant(t,e,n,r=dp()){if(!e||!n){await we("Journal","Missing species or variant.","error");return}try{await Jo({produce:{[String(e)]:{variantsLogged:[{variant:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await we("Journal",`Added produce variant "${n}" for ${o??t}.`,"success")}catch(o){await we("Journal",o?.message||"Failed to add produce variant.","error")}},async addPetVariant(t,e,n,r=dp()){if(!e||!n){await we("Journal","Missing pet species or variant.","error");return}try{await Jo({pets:{[String(e)]:{variantsLogged:[{variant:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await we("Journal",`Added pet variant "${n}" for ${o??t}.`,"success")}catch(o){await we("Journal",o?.message||"Failed to add pet variant.","error")}},async addPetAbility(t,e,n,r=dp()){if(!e||!n){await we("Journal","Missing pet species or ability.","error");return}try{await Jo({pets:{[String(e)]:{abilitiesLogged:[{ability:String(n),createdAt:r}]}}},{open:!0});let o=await this.getPlayerNameById(t);await we("Journal",`Added pet ability "${n}" for ${o??t}.`,"success")}catch(o){await we("Journal",o?.message||"Failed to add pet ability.","error")}},async stopFollowing(){if(Je.unsub)try{await Je.unsub()}catch{}Je.unsub=null,Je.currentTargetId=null,Je.lastPos=null,Je.prevPos=null,Je.steps=0},isFollowing(t){return Je.currentTargetId===t},async startFollowing(t){if(Je.unsub){try{await Je.unsub()}catch{}Je.unsub=null}Je.currentTargetId=t,Je.lastPos=null,Je.prevPos=null,Je.steps=0;let e=await this.getPosition(t);if(!e){await we("Follow","Unable to retrieve player position.","error"),Je.currentTargetId=null;return}await Se.teleport(e.x,e.y),Je.lastPos={x:e.x,y:e.y},Je.prevPos=null,Je.steps=0,Je.unsub=await this.onChange(async n=>{if(Je.currentTargetId!==t)return;let r=n.find(i=>i.id===t);if(!r||typeof r.x!="number"||typeof r.y!="number"){await this.stopFollowing(),await we("Follow","The target is no longer trackable (disconnected?).","error");return}let o={x:r.x,y:r.y},s=Je.lastPos;if(!s){Je.lastPos=o;return}(o.x!==s.x||o.y!==s.y)&&(Je.steps+=1,Je.steps>=2&&s&&Se.move(s.x,s.y),Je.prevPos=Je.lastPos,Je.lastPos=o)}),await we("Follow","Follow enabled","success")},async stopPetFollowing(t){await MM(),t?.silent||await we("Pet follow",t?.message??"Disabled.",t?.tone??"info")},isPetFollowing(t){return We.targetId===t},async startPetFollowing(t){await this.stopPetFollowing({silent:!0});let e=await pe.pets.myPetInfos.get(),n=Array.isArray(e)?e.map(i=>i?.slot?.id).filter(i=>typeof i=="string"&&!!i):[];if(!n.length){await we("Pet follow","You don't have any active pets.","error");return}let r=await this.getPosition(t);if(!r){await we("Pet follow","Unable to retrieve player position.","error");return}We.targetId=t,We.pets=n,We.historyCap=Math.max(n.length*IM,n.length+b0+1),We.history=[];for(let i=0;i<We.historyCap;i+=1)v0(r,!0);let o=async()=>{if(We.targetId!==t||!We.pets.length||!We.history.length)return;let i={};for(let a=0;a<We.pets.length;a+=1){let l=We.pets[a],c=Math.min(We.history.length-1,(a+1)*b0),d=We.history[c]??We.history[We.history.length-1];d&&(i[l]={x:d.x,y:d.y})}if(Object.keys(i).length!==0)try{await Se.petPositions(i)}catch{}};We.timer=setInterval(()=>{o().catch(()=>{})},kM);let s=o();We.unsub=await this.onChange(async i=>{if(We.targetId!==t)return;let a=i.find(l=>l.id===t);if(!a||typeof a.x!="number"||typeof a.y!="number"){await this.stopPetFollowing({silent:!1,message:"Target is no longer trackable.",tone:"error"});return}v0({x:a.x,y:a.y})}),await s,await we("Pet follow","Pets are now following the target.","success")}};async function PM(){return ct.list()}var x0=new Intl.NumberFormat("en-US",{maximumFractionDigits:0});function RM(t,e=22){return t?t.length<=e?t:t.slice(0,e-1)+"\u2026":""}var _M=t=>({id:t.id,title:RM(t.name||t.id,9),subtitle:t.isConnected?"Online":"Offline",avatarUrl:t.discordAvatarUrl||"",statusColor:t.isConnected?"#48d170":"#999a"});async function E0(t){let e=new Ye({id:"players",compact:!0,windowSelector:".qws-win"});e.mount(t);let n=e.root.querySelector(".qmm-views"),{root:r,left:o,right:s}=e.split2("260px");n.appendChild(r),r.style.height="100%",r.style.minHeight="0",o.style.display="flex",o.style.flexDirection="column",o.style.minHeight="0",s.style.minHeight="0",s.style.overflow="auto";let i=e.vtabs({filterPlaceholder:"Find player\u2026",onSelect:(f,h)=>l(h?.id||null),fillAvailableHeight:!0});i.root.style.display="flex",i.root.style.flexDirection="column",i.root.style.flex="1 1 auto",i.root.style.minHeight="0",o.appendChild(i.root);let a=i.root.querySelector(".filter");if(a){a.style.display="flex",a.style.alignItems="center",a.style.gap="8px";let f=a.querySelector("input");f&&(f.style.flex="1 1 auto",f.style.minWidth="0")}async function l(f){s.innerHTML="";let h=f&&c.find(b=>b.id===f)||null;if(!h){let b=document.createElement("div");b.style.opacity="0.75",b.textContent="Select a player on the left.",s.appendChild(b);return}let m=document.createElement("div");m.style.display="grid",m.style.gridAutoRows="min-content",m.style.justifyItems="center",m.style.gap="10px",m.style.overflow="auto",s.appendChild(m);let g=document.createElement("div");g.style.display="grid",g.style.gap="8px",g.style.justifyItems="center";let y=document.createElement("div");y.style.display="flex",y.style.alignItems="center",y.style.gap="12px";let v=document.createElement("img");v.src=h.discordAvatarUrl||"",v.alt=h.name,v.width=48,v.height=48,v.style.borderRadius="50%",v.style.objectFit="cover",v.style.border="1px solid #4446";let w=document.createElement("div"),x=document.createElement("div");x.textContent=h.name||h.id,x.style.fontWeight="600",x.style.fontSize="16px";let E=document.createElement("div");E.style.opacity="0.8",E.style.fontSize="12px",E.textContent=h.isConnected?"Online":"Offline",w.append(x,E),y.append(v,w);let L=document.createElement("div");L.style.opacity="0.9",g.append(y,L),m.appendChild(g);let P=document.createElement("div");P.style.display="grid",P.style.gap="6px",P.style.justifySelf="stretch",P.style.width="100%";let V=e.flexRow({justify:"start",fullWidth:!0,gap:6}),z=document.createElement("div");z.textContent="Inventory: ",z.style.fontSize="14px",z.style.opacity="0.85";let C=document.createElement("div");C.textContent="\u2026",C.style.fontSize="15px",C.style.fontWeight="700",C.style.color="#FFD84D",V.append(z,C);let D=e.flexRow({justify:"start",fullWidth:!0,gap:6}),S=document.createElement("div");S.textContent="Garden: ",S.style.fontSize="14px",S.style.opacity="0.85";let G=document.createElement("div");G.textContent="\u2026",G.style.fontWeight="700",G.style.fontSize="15px",G.style.color="#FFD84D",D.append(S,G),P.append(V,D);let se=e.card("\u{1F331} Crops values",{tone:"muted",align:"center"});se.body.append(P),m.appendChild(se.root);let X=e.flexRow({justify:"center"}),ue=e.btn("To player",{size:"sm"});ue.style.minWidth="120px";let N=e.btn("To garden",{size:"sm"});N.style.minWidth="120px",ue.onclick=async()=>{try{await(ct.teleportToPlayer??ct.teleportTo).call(ct,h.id)}catch(b){await we("Teleport",b?.message||"Error during teleport.","error")}},N.onclick=async()=>{try{await(ct.teleportToGarden??ct.tptogarden).call(ct,h.id)}catch(b){await we("Teleport",b?.message||"Error during teleport.","error")}},X.append(ue,N);let ee=e.card("\u{1F300} Teleport",{tone:"muted",align:"center"});ee.body.append(X),m.appendChild(ee.root);let q=e.flexRow({justify:"center"}),A=e.btn("Inventory",{size:"sm"});A.style.minWidth="120px";let te=e.btn("Journal",{size:"sm"});te.style.minWidth="120px",A.onclick=async()=>{try{e.setWindowVisible(!1),await ct.openInventoryPreview(h.id,h.name),await Yi()&&await $i()}finally{e.setWindowVisible(!0)}},te.onclick=async()=>{try{e.setWindowVisible(!1),await ct.openJournalLog(h.id,h.name),await Bf()&&await Ff()}finally{e.setWindowVisible(!0)}},q.append(A,te);let ne=e.card("\u{1F50D} Inspect",{tone:"muted",align:"center"});ne.body.append(q),m.appendChild(ne.root);let Z=document.createElement("div");Z.style.display="grid",Z.style.gap="10px";let me=e.flexRow({justify:"center"});me.style.gap="16px";let Q=document.createElement("div");Q.style.display="flex",Q.style.alignItems="center",Q.style.gap="8px";let oe=document.createElement("div");oe.textContent="Follow player",oe.style.fontSize="14px",oe.style.opacity="0.85";let W=e.switch(ct.isFollowing(h.id));W.addEventListener("change",async()=>{try{W.checked?(await ct.startFollowing(h.id),await we("Follow","Enabled.","success")):(ct.stopFollowing(),await we("Follow","Disable.","info"))}catch(b){await we("Follow",b?.message||"Error","error"),W.checked=!W.checked}}),Q.append(oe,W);let U=document.createElement("div");U.style.display="flex",U.style.alignItems="center",U.style.gap="4px";let J=document.createElement("div");J.textContent="Pet follow",J.style.fontSize="14px",J.style.opacity="0.85";let B=e.switch(ct.isPetFollowing(h.id));B.addEventListener("change",async()=>{try{B.checked?await ct.startPetFollowing(h.id):await ct.stopPetFollowing()}catch(b){await we("Pet follow",b?.message||"Error","error"),B.checked=!B.checked}}),U.append(J,B),me.append(Q,U),Z.append(me);let O=e.card("\u{1F389} Fun",{tone:"muted",align:"center"});O.body.append(Z),m.appendChild(O.root),(async()=>{try{let b=await ct.getInventoryValue(h.id);C.textContent=`${x0.format(Math.round(b))}`,C.title="Total inventory value"}catch{C.textContent="\u2014"}try{let b=await ct.getGardenValue(h.id);G.textContent=`${x0.format(Math.round(b))}`,G.title="Total garden value"}catch{G.textContent="\u2014"}})()}let c=[],d="";function u(f){return f.map(h=>`${h.id}|${h.name??""}|${h.isConnected?1:0}|${h.inventory?.items?.length??0}`).join(";")}async function p(f=!0){let h=i.getSelected()?.id??null,m=await PM(),g=u(m);if(g===d)return;d=g,c=m,i.setItems(c.map(_M));let y=f&&h&&c.some(v=>v.id===h)?h:c[0]?.id??null;y!==null?i.select(y):l(null)}await ct.onChange(()=>{p(!0).catch(()=>{})}),await p(!0)}var pp=new Map,Zs=new Map,ql=null,C0=!1;function LM(t){if(!t||ot[t])return t;let e=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase();return ot[e]?e:t}function NM(t){let e=typeof t=="number"&&Number.isFinite(t)?t:Number(t);return Number.isFinite(e)?e<=0?e:e-1:null}function OM(){if(ql)return ql;let t=new Set;try{let n=typeof ke.listPets=="function"?ke.listPets():[];for(let r of n)typeof r=="string"&&r.length&&t.add(r)}catch{}let e=Array.from(t,n=>{let r=n.split(/[?#]/)[0]??n;return(r.split("/").pop()??r).replace(/\.[^.]+$/,"")});return ql=e,e}function qM(){pp.clear(),Zs.clear(),ql=null}function DM(){C0||typeof window>"u"||(C0=!0,window.addEventListener("mg:sprite-detected",()=>{qM()}))}function BM(t,e){return`${t.toLowerCase()}::${e}`}function T0(t,e){return e?(Array.isArray(e)?e:[e]).map(r=>String(r??"").toLowerCase()).some(r=>r.includes(t)):!1}function FM(t){return T0("rainbow",t)?"rainbow":T0("gold",t)?"gold":"normal"}async function HM(t,e){if(typeof window>"u"||typeof ke.getTile!="function")return null;let r=ot[t]?.tileRef;if(r==null)return null;let o=NM(r);if(o==null)return null;let s=new Set(OM());s.size===0&&(s.add("pets"),s.add("Pets"));for(let i of s)try{let a=await ke.getTile(i,o,"canvas");if(!a)continue;let l=a.data;if(!(l instanceof HTMLCanvasElement)||l.width===0||l.height===0)continue;let c=null;if(e==="gold"&&typeof ke.effectGold=="function")c=ke.effectGold(a);else if(e==="rainbow"&&typeof ke.effectRainbow=="function")c=ke.effectRainbow(a);else{let d=document.createElement("canvas");d.width=l.width,d.height=l.height;let u=d.getContext("2d");if(!u)continue;u.imageSmoothingEnabled=!1,u.drawImage(l,0,0),c=d}if(!c||c.width===0||c.height===0)continue;return c.toDataURL()}catch{}return null}function WM(t,e="normal"){if(typeof window>"u")return Promise.resolve(null);let n=LM(String(t??"").trim());if(!n)return Promise.resolve(null);DM();let r=BM(n,e),o=pp.get(r);if(o!==void 0)return Promise.resolve(o);let s=Zs.get(r);if(s)return s;let i=HM(n,e).then(a=>(pp.set(r,a),Zs.delete(r),a)).catch(()=>(Zs.delete(r),null));return Zs.set(r,i),i}function k0(t,e){let n=FM(e);return WM(t,n)}function jM(t){let e=String(t||""),n=(Te.getAbilityNameWithoutLevel?.(e)||"").replace(/[\s\-_]+/g,"").toLowerCase(),r=o=>e.startsWith(o)||n===o.toLowerCase();if(r("ProduceScaleBoost"))return{bg:"rgba(34,139,34,0.9)",hover:"rgba(34,139,34,1)"};if(r("PlantGrowthBoost"))return{bg:"rgba(0,128,128,0.9)",hover:"rgba(0,128,128,1)"};if(r("EggGrowthBoost"))return{bg:"rgba(180,90,240,0.9)",hover:"rgba(180,90,240,1)"};if(r("PetAgeBoost"))return{bg:"rgba(147,112,219,0.9)",hover:"rgba(147,112,219,1)"};if(r("PetHatchSizeBoost"))return{bg:"rgba(128,0,128,0.9)",hover:"rgba(128,0,128,1)"};if(r("PetXpBoost"))return{bg:"rgba(30,144,255,0.9)",hover:"rgba(30,144,255,1)"};if(r("HungerBoost"))return{bg:"rgba(255,20,147,0.9)",hover:"rgba(255,20,147,1)"};if(r("SellBoost"))return{bg:"rgba(220,20,60,0.9)",hover:"rgba(220,20,60,1)"};if(r("CoinFinder"))return{bg:"rgba(180,150,0,0.9)",hover:"rgba(180,150,0,1)"};if(r("ProduceMutationBoost"))return{bg:"rgba(138,43,226,0.9)",hover:"rgba(138,43,226,1)"};if(r("DoubleHarvest"))return{bg:"rgba(0,120,180,0.9)",hover:"rgba(0,120,180,1)"};if(r("ProduceEater"))return{bg:"rgba(255,69,0,0.9)",hover:"rgba(255,69,0,1)"};if(r("ProduceRefund"))return{bg:"rgba(255,99,71,0.9)",hover:"rgba(255,99,71,1)"};if(r("PetMutationBoost"))return{bg:"rgba(156,65,181,0.9)",hover:"rgba(156,65,181,1)"};if(r("HungerRestore"))return{bg:"rgba(255,105,180,0.9)",hover:"rgba(255,105,180,1)"};if(r("PetRefund"))return{bg:"rgba(0,80,120,0.9)",hover:"rgba(0,80,120,1)"};if(r("Copycat"))return{bg:"rgba(255,140,0,0.9)",hover:"rgba(255,140,0,1)"};if(r("GoldGranter"))return{bg:"linear-gradient(135deg, rgba(225,200,55,0.9) 0%, rgba(225,180,10,0.9) 40%, rgba(215,185,45,0.9) 70%, rgba(210,185,45,0.9) 100%)",hover:"linear-gradient(135deg, rgba(220,200,70,1) 0%, rgba(210,175,5,1) 40%, rgba(210,185,55,1) 70%, rgba(200,175,30,1) 100%)"};if(r("RainbowGranter"))return{bg:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))",hover:"linear-gradient(45deg, rgba(200,0,0,1), rgba(200,120,0,1), rgba(160,170,30,1), rgba(60,170,60,1), rgba(50,170,170,1), rgba(40,150,180,1), rgba(20,90,180,1), rgba(70,30,150,1))"};if(r("SeedFinderIV"))return{bg:"linear-gradient(130deg, rgba(0,180,216,0.9) 0%, rgba(124,42,232,0.9) 40%, rgba(160,0,126,0.9) 60%, rgba(255,215,0,0.9) 100%)",hover:"linear-gradient(130deg, rgba(0,180,216,1) 0%, rgba(124,42,232,1) 40%, rgba(160,0,126,1) 60%, rgba(255,215,0,1) 100%)"};if(r("SeedFinder")){let o=e.replace(/.*?([IVX]+)$/,"$1");return o==="II"?{bg:"rgba(183,121,31,0.9)",hover:"rgba(183,121,31,1)"}:o==="III"?{bg:"rgba(139,62,152,0.9)",hover:"rgba(139,62,152,1)"}:{bg:"rgba(94,172,70,0.9)",hover:"rgba(94,172,70,1)"}}return{bg:"rgba(100,100,100,0.9)",hover:"rgba(150,150,150,1)"}}function zM(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 260px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",n.style.border="1px solid #4445",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#0f1318",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateColumns="1fr",r.style.rowGap="6px",r.style.overflow="auto",r.style.padding="6px",r.style.border="1px solid #4445",r.style.borderRadius="10px",n.appendChild(r);let o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="12px",o.style.overflow="auto",o.style.minHeight="0",n.appendChild(o);let s=(y,v)=>{let w=e.card(y,{tone:"muted",align:"center"});return w.body.append(v),w.root.style.maxWidth="720px",w.root},i=()=>e.flexRow({justify:"center"}),a=(()=>{let y=i(),v=e.switch(!1);return v.id="pets.autofeed.enabled",y.append(v,e.label("Enable Autofeed for this pet")),{wrap:s("\u{1F513} Activation",y),sw:v}})();o.appendChild(a.wrap);let l=(()=>{let y=i(),v=e.label("Feed when hunger < (%)"),w=e.inputNumber(1,100,1,10);return w.id="pets.autofeed.thresholdPct",y.append(v,w.wrap??w),{wrap:s("\u2699\uFE0F Local threshold",y),num:w}})();o.appendChild(l.wrap);let c=(()=>{let y=e.table(["Allow","Crop"],{minimal:!0,maxHeight:"50vh",fixed:!0});return{wrap:s("\u{1F33E} Compatible crops",y.root),tbody:y.tbody}})();o.appendChild(c.wrap);let d=[],u=Te.getSelectedPetId?.()??null;function p(){if(r.innerHTML="",!d.length){let y=document.createElement("div");y.textContent="No pets to display",y.style.opacity="0.75",r.appendChild(y),m(null);return}for(let y of d){let v=String(y?.slot?.id||""),w=(y?.slot?.name||y?.slot?.petSpecies||"Pet").toString(),x=Te.getHungerPctFor(y),E=document.createElement("button");E.className="qmm-btn",E.dataset.pid=v,E.setAttribute("aria-pressed",v===u?"true":"false"),E.style.display="flex",E.style.justifyContent="space-between",E.style.alignItems="center",E.style.width="100%",E.style.textAlign="left";let L=document.createElement("div");L.textContent=`${w}`;let P=document.createElement("div");P.style.opacity="0.8",P.textContent=`${x}%`,E.append(L,P),E.classList.toggle("active",v===u),E.onclick=()=>{u!==v&&(u=v,Te.setSelectedPet(u),r.querySelectorAll("button.qmm-btn").forEach(V=>{let z=V.dataset.pid===u;V.classList.toggle("active",z),V.setAttribute("aria-pressed",z?"true":"false")}),m(v))},r.appendChild(E)}}function f(){a.sw.onchange=async()=>{if(u)try{await Te.setPetAutofeedEnabled(u,!!a.sw.checked)}catch{}},l.num.addEventListener("change",async()=>{if(!u)return;let y=Math.max(1,Math.min(100,Number(l.num.value)||10));l.num.value=String(y);try{await Te.setPetAutofeedThresholdPct(u,y)}catch{}})}async function h(y,v){let w=c.tbody;if(w.innerHTML="",!y||!v){let L=document.createElement("tr"),P=document.createElement("td");P.colSpan=2,P.style.opacity="0.75",P.textContent="Select a pet to view compatible crops.",L.appendChild(P),w.appendChild(L);return}let x=[],E=new Set;try{let L=Te.getCompatibleCropsForSpecies(v);x=Array.isArray(L)?L:[]}catch{}try{let L=await Te.getPetAllowedCrops(y);E=L instanceof Set?L:new Set(Array.isArray(L)?L:[])}catch{E=new Set(x)}if(!x.length){let L=document.createElement("tr"),P=document.createElement("td");P.colSpan=2,P.style.opacity="0.75",P.textContent="No compatible crops for this species.",L.appendChild(P),w.appendChild(L);return}x.forEach(L=>{let P=document.createElement("tr"),V=document.createElement("td"),z=e.switch(E.has(L));z.ariaLabel=`Allow ${L}`,z.onchange=async()=>{if(u)try{await Te.setPetAllowedCrop(u,L,!!z.checked)}catch{}},V.appendChild(z);let C=document.createElement("td");C.textContent=L,P.append(V,C),w.appendChild(P)})}async function m(y){let v=!!y;if(a.sw.disabled=!v,l.num.disabled=!v,!v){a.sw.checked=!1,l.num.value="10",await h(null,null);return}try{a.sw.checked=await Te.getPetAutofeedEnabled(y)}catch{a.sw.checked=!1}try{let E=await Te.getPetAutofeedThresholdPct(y);l.num.value=String(Math.max(1,Math.min(100,E|0||10)))}catch{l.num.value="10"}let x=(d.find(E=>String(E?.slot?.id||"")===y)||null)?.slot?.petSpecies||null;await h(y,x)}Te.onPetsChangeNow(y=>{d=Array.isArray(y)?y.slice():[],d.some(v=>String(v?.slot?.id||"")===u)||(u=d[0]?.slot?.id?String(d[0].slot.id):null,Te.setSelectedPet(u)),p(),m(u)}).then(y=>{t.__unsubPets=y}).catch(()=>{}),f(),t.__cleanup__=()=>{try{t.__unsubPets?.()}catch{}}}function UM(t,e){t.innerHTML="";let n=[],r=null,o=null,s=new Set,i=!1,a=null,l=null,c=0,d=null,u=[null,null,null];function p(W,U,J=.22){let O=((b,M)=>{let _=b.replace("#",""),k=parseInt(_.length===3?_[0]+_[0]:_.slice(0,2),16),T=parseInt(_.length===3?_[1]+_[1]:_.slice(2,4),16),F=parseInt(_.length===3?_[2]+_[2]:_.slice(4,6),16);return`rgba(${k},${T},${F},${M})`})(U,J);W.style.border=`1px solid ${O}`,W.style.background="#1f2328",W.style.boxShadow="none",W.style.transition="none"}let f=(W,U)=>{let J=e.card(W,{tone:"muted",align:"center"});return J.body.append(U),J.root.style.maxWidth="720px",J.root},h=W=>e.flexRow({justify:W?.justify??"center"}),m=document.createElement("div");m.style.display="grid",m.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",m.style.gap="10px",m.style.alignItems="stretch",m.style.height="54vh",m.style.overflow="hidden",t.appendChild(m);let g=document.createElement("div");g.style.display="grid",g.style.gridTemplateRows="1fr auto",g.style.gap="8px",g.style.minHeight="0",m.appendChild(g);let y=document.createElement("div");y.style.display="flex",y.style.flexDirection="column",y.style.gap="6px",y.style.overflow="auto",y.style.padding="6px",y.style.border="1px solid #4445",y.style.borderRadius="10px",y.style.scrollBehavior="smooth",y.style.minHeight="0",g.appendChild(y);let v=document.createElement("div");v.style.display="flex",v.style.gap="6px",g.appendChild(v);let w=e.btn("\u2795 New",{variant:"primary",size:"sm"});w.id="pets.teams.new",w.style.flex="1 1 0";let x=e.btn("\u{1F5D1}\uFE0F Delete",{variant:"danger",size:"sm"});x.id="pets.teams.delete",x.style.flex="1 1 0",p(w,"#22c55e",.22),p(x,"#ef4444",.22),v.append(w,x);function E(){return n.find(W=>W.id===r)||null}function L(W){let U=Array.from(y.children);if(!U.length)return 0;let J=U[0].getBoundingClientRect();if(W<J.top+J.height/2)return 0;for(let B=0;B<U.length;B++){let O=U[B].getBoundingClientRect(),b=O.top+O.height/2;if(W<b)return B}return U.length}function P(W){let U=document.createElement("span");U.style.display="inline-flex",U.style.alignItems="center",U.style.lineHeight="1";let J=8,B=12,O=3,b=Array.isArray(W)?W.filter(Boolean):[];if(!b.length){let M=document.createElement("span");return M.textContent="No ability",M.style.opacity="0.75",M.style.fontSize="12px",U.appendChild(M),U}return b.forEach((M,_)=>{let k=document.createElement("span"),{bg:T,hover:F}=jM(M);k.title=Te.getAbilityName(M)||M,k.setAttribute("aria-label",k.title),Object.assign(k.style,{display:"inline-block",width:`${B}px`,height:`${B}px`,borderRadius:`${O}px`,marginRight:_===b.length-1?"0":`${J}px`,background:T,transition:"transform 80ms ease, box-shadow 120ms ease, background 120ms ease",cursor:"default",boxShadow:"0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"}),k.onmouseenter=()=>{k.style.background=F,k.style.transform="scale(1.08)",k.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff33"},k.onmouseleave=()=>{k.style.background=T,k.style.transform="none",k.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"},U.appendChild(k)}),U}function V(){let W=Array.from(y.children);if(W.forEach(B=>B.style.transform=""),a===null||l===null)return;let U=a,J=l;W.forEach((B,O)=>{B.style.transition="transform 120ms ease",O!==U&&(J>U&&O>U&&O<J&&(B.style.transform=`translateY(${-c}px)`),J<U&&O>=J&&O<U&&(B.style.transform=`translateY(${c}px)`))})}function z(){Array.from(y.children).forEach(W=>{W.style.transform="",W.style.transition=""})}async function C(){o=null,s=new Set;try{let W=await Te.getPets(),U=Array.isArray(W)?W.map(J=>String(J?.slot?.id||"")).filter(Boolean):[];s=new Set(U);for(let J of n){let B=(J.slots||[]).filter(Boolean);if(B.length!==U.length)continue;let O=!0;for(let b of B)if(!s.has(b)){O=!1;break}if(O){o=J.id;break}}}catch{}}async function D(W=!1){if(W||await C(),z(),a=null,l=null,c=0,y.innerHTML="",!n.length){let U=document.createElement("div");U.textContent="No teams yet. Create one!",U.style.opacity="0.75",U.style.textAlign="center",U.style.padding="8px",y.appendChild(U),Z(null);return}n.forEach((U,J)=>{let B=document.createElement("div"),O=U.id===o;B.dataset.index=String(J),B.textContent="",B.style.height="36px",B.style.lineHeight="36px",B.style.padding="0 10px",B.style.border="1px solid #ffffff15",B.style.borderRadius="6px",B.style.cursor="pointer",B.style.fontSize="13px",B.style.overflow="hidden",B.style.whiteSpace="nowrap",B.style.textOverflow="ellipsis",B.style.display="flex",B.style.flex="0 0 auto",B.style.gap="8px",B.style.alignItems="center",B.style.background=U.id===r?"#2a313a":"#1f2328";let b=document.createElement("span");b.style.width="10px",b.style.height="10px",b.style.borderRadius="50%",b.style.boxShadow="0 0 0 1px #0006 inset",b.style.background=O?"#48d170":"#64748b",b.title=O?"This team is currently active":"Inactive team";let M=document.createElement("span");M.textContent=U.name||"(unnamed)",M.style.overflow="hidden",M.style.textOverflow="ellipsis",M.style.whiteSpace="nowrap",B.append(b,M);let _=document.createElement("span");_.className="qmm-grab",_.title="Drag to reorder",_.innerHTML="&#8942;",_.draggable=!0,B.onmouseenter=()=>B.style.borderColor="#6aa1",B.onmouseleave=()=>B.style.borderColor="#ffffff15",B.onclick=k=>{if(k.__byDrag)return;r!==U.id&&(r=U.id,D(!0)),Z(E())},_.addEventListener("dragstart",k=>{a=J,c=B.getBoundingClientRect().height,B.classList.add("qmm-dragging"),k.dataTransfer?.setData("text/plain",String(J)),k.dataTransfer&&(k.dataTransfer.effectAllowed="move");try{let T=B.cloneNode(!0);T.style.width=`${B.getBoundingClientRect().width}px`,T.style.position="absolute",T.style.top="-9999px",document.body.appendChild(T),k.dataTransfer.setDragImage(T,T.offsetWidth/2,T.offsetHeight/2),setTimeout(()=>document.body.removeChild(T),0)}catch{}}),_.addEventListener("dragend",()=>{B.classList.remove("qmm-dragging"),z(),a=null,l=null}),B.addEventListener("dragover",k=>{if(k.preventDefault(),k.dataTransfer&&(k.dataTransfer.dropEffect="move"),a===null)return;let T=Number(k.currentTarget.dataset.index||-1);if(T<0)return;let F=B.getBoundingClientRect(),$=F.top+F.height/2,K=k.clientY<$?T:T+1,R=Math.max(0,Math.min(n.length,K));l!==R&&(l=R,V());let Y=28,re=y.getBoundingClientRect();k.clientY<re.top+Y?y.scrollTop-=18:k.clientY>re.bottom-Y&&(y.scrollTop+=18)}),B.addEventListener("drop",k=>{if(k.preventDefault(),k.__byDrag=!0,a===null)return;let T=l??L(k.clientY);if(T>a&&(T-=1),T=Math.max(0,Math.min(n.length-1,T)),T!==a){let F=n.slice(),[$]=F.splice(a,1);F.splice(T,0,$),n=F;try{Te.setTeamsOrder(n.map(K=>K.id))}catch{}}z(),a=null,l=null,c=0,D()}),B.appendChild(_),y.appendChild(B)})}y.addEventListener("dragover",W=>{if(W.preventDefault(),W.dataTransfer&&(W.dataTransfer.dropEffect="move"),a===null)return;let U=L(W.clientY);l!==U&&(l=U,V());let J=28,B=y.getBoundingClientRect();W.clientY<B.top+J?y.scrollTop-=18:W.clientY>B.bottom-J&&(y.scrollTop+=18)}),y.addEventListener("drop",W=>{if(W.preventDefault(),a===null)return;let U=l??L(W.clientY);if(U>a&&(U-=1),U=Math.max(0,Math.min(n.length-1,U)),U!==a){let J=n.slice(),[B]=J.splice(a,1);J.splice(U,0,B),n=J;try{Te.setTeamsOrder(n.map(O=>O.id))}catch{}}z(),a=null,l=null,c=0,D()}),w.onclick=()=>{r=Te.createTeam("New Team").id,D(),Z(E())},x.onclick=()=>{!r||Te.deleteTeam(r)};let S=null;(async()=>{try{S=await Te.onTeamsChangeNow(async W=>{n=Array.isArray(W)?W.slice():[],r&&!n.some(U=>U.id===r)&&(r=n[0]?.id??null),!r&&n.length&&(r=n[0].id),D(),ps(n),await Te.getInventoryPets().catch(()=>[]),await Z(E())})}catch{}})();let G=document.createElement("div");G.style.display="grid",G.style.gridTemplateRows="auto 1fr",G.style.gap="10px",G.style.minHeight="0",m.appendChild(G);let se=document.createElement("div");se.style.display="flex",se.style.alignItems="center",se.style.gap="8px";let X=document.createElement("div");X.textContent="Team editor \u2014 ",X.style.fontWeight="700",X.style.fontSize="14px";let ue=document.createElement("button");ue.id="pets.teams.useThisTeam",ue.textContent="Use this team",ue.style.padding="6px 10px",ue.style.borderRadius="8px",ue.style.border="1px solid #4445",ue.style.background="#1f2328",ue.style.color="#e7eef7",ue.style.cursor="pointer",ue.onmouseenter=()=>ue.style.borderColor="#6aa1",ue.onmouseleave=()=>ue.style.borderColor="#4445",ue.disabled=!0;let N=document.createElement("button");N.id="pets.teams.save",N.textContent="\u{1F4BE} Save",N.style.padding="6px 10px",N.style.borderRadius="8px",N.style.border="1px solid #4445",N.style.background="#1f2328",N.style.color="#e7eef7",N.style.cursor="pointer",N.onmouseenter=()=>N.style.borderColor="#6aa1",N.onmouseleave=()=>N.style.borderColor="#4445",N.disabled=!0,se.append(X,ue),G.appendChild(se);let ee=document.createElement("div");ee.style.border="1px solid #4445",ee.style.borderRadius="10px",ee.style.padding="10px",ee.style.display="flex",ee.style.flexDirection="column",ee.style.gap="12px",ee.style.overflow="auto",ee.style.minHeight="0",ee.style.background="#0f1318",G.appendChild(ee);let q=(()=>{let W=h();W.style.width="100%";let U=e.inputText("Team name","");return U.id="pets.teams.editor.name",U.style.flex="1",U.style.minWidth="0",N.style.marginLeft="auto",N.style.padding="6px 10px",W.append(U,N),ee.appendChild(f("\u{1F3F7}\uFE0F Team name",W)),{nameInput:U}})(),A=(()=>{let W=document.createElement("div");W.style.display="flex",W.style.flexDirection="column",W.style.gap="10px",W.style.alignItems="center";let U=!1,J="ability",B=e.segmented([{value:"ability",label:"\u2728 Ability"},{value:"species",label:"\u{1F9EC} Species"}],"ability",async F=>{U||(J=F,await _(),O.value="",k())},{ariaLabel:"Search mode"}),O=document.createElement("select");O.className="qmm-input",O.id="pets.teams.filter.select",O.style.minWidth="260px";let b=()=>J,M=F=>{J=F,U=!0,B.set(F),U=!1},_=async()=>{let F=O.value,$=await Te.getInventoryPets().catch(()=>[]);O.innerHTML="";let K=document.createElement("option");if(K.value="",K.textContent="\u2014 No filter \u2014",O.appendChild(K),b()==="ability"){let R=new Set;for(let Y of $){let re=Array.isArray(Y?.abilities)?Y.abilities.filter(Boolean):[];for(let I of re){let j=Te.getAbilityNameWithoutLevel?.(I)||"";j&&R.add(j)}}for(let Y of Array.from(R).sort((re,I)=>re.localeCompare(I))){let re=document.createElement("option");re.value=Y,re.textContent=Y,O.appendChild(re)}}else{let R=new Set;for(let Y of $){let re=String(Y?.petSpecies||"").trim();re&&R.add(re)}for(let Y of Array.from(R).sort((re,I)=>re.localeCompare(I))){let re=document.createElement("option");re.value=Y,re.textContent=Y.charAt(0).toUpperCase()+Y.slice(1),O.appendChild(re)}}Array.from(O.options).some(R=>R.value===F)&&(O.value=F)},k=()=>{let F=E();if(!F)return;let $=(O.value||"").trim(),K=b()==="ability"?$?`ab:${$}`:"":$?`sp:${$}`:"";Te.setTeamSearch(F.id,K)};O.addEventListener("change",k),W.append(B,O),ee.appendChild(f("\u{1F50D} Search",W));let T=(F,$)=>{let K=(F||"").trim();if(!K)return;if(!Array.from(O.options).some(Y=>Y.value===K)){let Y=document.createElement("option");Y.value=K,Y.textContent=$??K,O.appendChild(Y)}};return{getMode:b,setMode:M,select:O,rebuild:_,apply:k,setFromSearchString(F){let $=(F||"").match(/^(ab|sp):\s*(.*)$/i);if(!$){M("ability"),O.value="";return}let K=$[1].toLowerCase()==="ab"?"ability":"species",R=($[2]||"").trim();M(K),T(R,K==="species"?R.charAt(0).toUpperCase()+R.slice(1):R),O.value=R}}})(),te=(()=>{let W=document.createElement("div");W.style.display="grid",W.style.gridTemplateColumns="1fr",W.style.rowGap="10px",W.style.justifyItems="center";let U=F=>{let $=document.createElement("div"),K=28,R=40;$.style.display="grid",$.style.gridTemplateColumns=`${R}px minmax(0,1fr) ${K}px ${K}px`,$.style.alignItems="center",$.style.gap="8px",$.style.width="min(560px, 100%)",$.style.border="1px solid #4445",$.style.borderRadius="10px",$.style.padding="8px 10px",$.style.background="#0f1318";let Y=document.createElement("div");Object.assign(Y.style,{width:`${R}px`,height:`${R}px`,display:"inline-flex",alignItems:"center",justifyContent:"center"});let re=()=>{Y.replaceChildren();let H=document.createElement("span");H.textContent="\u{1F43E}",H.style.fontSize=`${Math.max(R-6,12)}px`,H.setAttribute("aria-hidden","true"),Y.appendChild(H)},I=0,j=(H,fe)=>{I+=1;let ae=I,ye=String(H??"").trim();if(!ye){re();return}re(),k0(ye,fe).then(Ee=>{if(ae!==I)return;if(!Ee){re();return}let Ie=new Image;Ie.src=Ee,Ie.alt=ye||"pet",Ie.decoding="async",Ie.loading="lazy",Ie.draggable=!1,Object.assign(Ie.style,{width:"100%",height:"100%",imageRendering:"auto",objectFit:"contain"}),Y.replaceChildren(Ie)}).catch(()=>{ae===I&&re()})},de=document.createElement("div");de.style.display="flex",de.style.flexDirection="column",de.style.gap="6px",de.style.minWidth="0";let ie=document.createElement("div");ie.style.fontWeight="700",ie.textContent="None",ie.style.overflow="hidden",ie.style.textOverflow="ellipsis",ie.style.whiteSpace="nowrap";let ge=P([]);ge.style.display="inline-block",de.append(ie,ge);let be=document.createElement("button");be.textContent="+",Object.assign(be.style,{width:`${K}px`,minWidth:`${K}px`,height:`${K}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),be.title="Choose a pet",be.setAttribute("aria-label","Choose a pet");let ve=document.createElement("button");ve.textContent="\u2212",Object.assign(ve.style,{width:`${K}px`,minWidth:`${K}px`,height:`${K}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),ve.title="Remove this pet",ve.setAttribute("aria-label","Remove this pet"),$.append(Y,de,be,ve);function le(H){if(!H){ie.textContent="None",j(void 0,void 0);let Oe=P([]);Oe.style.display="inline-block",de.replaceChild(Oe,de.children[1]),ge=Oe;return}let fe=String(H.petSpecies||"").trim(),ae=Array.isArray(H.mutations)?H.mutations:[];j(fe,ae);let ye=fe?fe.charAt(0).toUpperCase()+fe.slice(1):"";ie.textContent=H.name?.trim()||ye||"Pet";let Ee=Array.isArray(H.abilities)?H.abilities.filter(Boolean):[],Ie=P(Ee);Ie.style.display="inline-block",de.replaceChild(Ie,de.children[1]),ge=Ie}return be.onclick=async()=>{let H=E();if(H){be.disabled=!0,ve.disabled=!0,e.setWindowVisible(!1);try{await Te.chooseSlotPet(H.id,F),await ne(E())}finally{e.setWindowVisible(!0),be.disabled=!1,ve.disabled=!1}}},ve.onclick=async()=>{let H=E();if(!H)return;let fe=H.slots.slice(0,3);fe[F]=null,Te.saveTeam({id:H.id,slots:fe}),await ne(H)},{root:$,nameEl:ie,abilitiesEl:ge,btnChoose:be,btnClear:ve,update:le}},J=U(0),B=U(1),O=U(2);W.append(J.root,B.root,O.root);let b=document.createElement("div");b.style.display="flex",b.style.gap="6px",b.style.justifyContent="center";let M=e.btn("Current active",{variant:"primary"});M.id="pets.teams.useCurrent",M.style.minWidth="140px";let _=e.btn("Clear slots",{variant:"secondary"});_.id="pets.teams.clearSlots",_.style.minWidth="140px";let k="#0f1318";b.append(M,_),Object.assign(M.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:k,boxShadow:"none"}),Object.assign(_.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:k,boxShadow:"none"});let T=document.createElement("div");return T.style.display="flex",T.style.flexDirection="column",T.style.gap="8px",T.append(W,b),ee.appendChild(f("\u26A1 Active pets (3 slots)",T)),{rows:[J,B,O],btnUseCurrent:M,btnClear:_}})();async function ne(W){let U=W??E();if(!U)return;let J=await Te.getInventoryPets().catch(()=>null);if(!(!J||J.length===0)){d=new Map;for(let O of J){let b=O?.id!=null?String(O.id):"";b&&d.set(b,O)}}let B=d??new Map;[0,1,2].forEach(O=>{let b=U.slots[O]||null;if(!b){u[O]!==null&&(te.rows[O].update(null),u[O]=null);return}let M=B.get(b);M&&u[O]!==b&&(te.rows[O].update(M),u[O]=b)})}async function Z(W){let U=!!W;if(q.nameInput.disabled=!U,te.btnClear.disabled=!U,te.btnUseCurrent.disabled=!U,ue.disabled=!U,N.disabled=!U,U){let J=Te.getTeamSearch(W.id)||"",B=J.match(/^(ab|sp):\s*(.*)$/i),O=B?B[1].toLowerCase()==="ab"?"ability":"species":"ability";A.setMode(O),await A.rebuild(),B&&A.setFromSearchString(J)}else await A.rebuild();if(!U){te.rows.forEach(J=>J.update(null)),q.nameInput.value="";return}q.nameInput.value=String(W.name||""),await ne(W)}q.nameInput.addEventListener("keydown",W=>{W.key==="Enter"&&W.currentTarget.blur()}),q.nameInput.addEventListener("blur",()=>{let W=E();if(!W)return;let U=q.nameInput.value.trim();U!==W.name&&Te.saveTeam({id:W.id,name:U})}),te.btnUseCurrent.onclick=async()=>{let W=E();if(W)try{let U=await Te.getPets(),B=(Array.isArray(U)?U:[]).map(b=>String(b?.slot?.id||"")).filter(b=>!!b).slice(0,3),O=[B[0]||null,B[1]||null,B[2]||null];Te.saveTeam({id:W.id,slots:O}),await ne(W)}catch{}},te.btnClear.onclick=async()=>{let W=E();W&&(Te.saveTeam({id:W.id,slots:[null,null,null]}),await ne(W))},N.onclick=()=>{let W=E();if(!W)return;let U=q.nameInput.value.trim(),J=W.slots.slice(0,3);Te.saveTeam({id:W.id,name:U,slots:J}),ne(W)};function me(W,U){if(W.length!==U.length)return!1;let J=new Set(W);for(let B of U)if(!J.has(B))return!1;return!0}async function Q(W,U=2e3){let J=(W.slots||[]).filter(Boolean),B=performance.now();for(;performance.now()-B<U;){let O=await Te.getPets().catch(()=>null),b=Array.isArray(O)?O.map(M=>String(M?.slot?.id||"")).filter(Boolean):[];if(me(b,J))return!0;await new Promise(M=>setTimeout(M,80))}return!1}ue.onclick=async()=>{let W=E();if(W)try{i=!0,o=W.id,await D(!0),await Te.useTeam(W.id),await Q(W),await Z(E()),await D()}catch(U){console.warn("[Pets] Use this team failed:",U),await D()}finally{i=!1}};let oe=null;(async()=>{try{oe=await ff(async()=>{i||(await ne(E()),await D())})}catch{}})(),ma(async W=>{let U=n.find(J=>J.id===W)||null;try{i=!0,U&&(o=U.id,await D(!0)),await Te.useTeam(W),U&&await Q(U),await Z(E()),await D()}catch(J){console.warn("[Pets] hotkey useTeam failed:",J),await D()}finally{i=!1}}),t.__cleanup__=(()=>{let W=t.__cleanup__;return()=>{try{S?.()}catch{}try{oe?.()}catch{}try{W?.()}catch{}}})()}function KM(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.height="54vh",t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="8px",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="8px 10px",r.style.background="#0f1318",n.appendChild(r);let o=e.select({id:"pets.logs.filter.ability",width:"200px"}),s=e.select({id:"pets.logs.sort",width:"140px"});[["desc","Newest first"],["asc","Oldest first"]].forEach(([C,D])=>{let S=document.createElement("option");S.value=C,S.textContent=D,s.appendChild(S)}),s.value="desc";let i=e.inputText("search (pet / ability / details)","");i.id="pets.logs.search",i.style.minWidth="220px";let a=e.btn("\u{1F9F9} Clear",{size:"sm"});a.id="pets.logs.clear",a.style.flex="0 0 auto",r.append(e.label("Ability"),o,e.label("Sort"),s,i,a);let l=document.createElement("div");l.style.border="1px solid #4445",l.style.borderRadius="10px",l.style.padding="10px",l.style.background="#0f1318",l.style.overflow="hidden",l.style.display="grid",l.style.gridTemplateRows="auto 1fr",l.style.minHeight="0",n.appendChild(l);let c=document.createElement("div");c.style.display="grid",c.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",c.style.columnGap="0",c.style.borderBottom="1px solid #ffffff1a",c.style.padding="0 0 6px 0";function d(C,D="center"){let S=document.createElement("div");return S.textContent=C,S.style.fontWeight="600",S.style.opacity="0.9",S.style.padding="6px 8px",S.style.textAlign=D,S}c.append(d("Date & Time"),d("Pet"),d("Ability"),d("Details","left")),l.appendChild(c);let u=document.createElement("div");u.style.display="grid",u.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",u.style.gridAutoRows="auto",u.style.alignContent="start",u.style.overflow="auto",u.style.width="100%",u.style.minHeight="0",l.appendChild(u);let p=Te.getAbilityLogsSessionStart?.()??0,f=[],h="",m="desc",g="";function y(){let C=o.value;o.innerHTML="";let D=[["","All abilities"],...Te.getSeenAbilityIds().map(S=>[S,S])];for(let[S,G]of D){let se=document.createElement("option");se.value=S,se.textContent=G,o.appendChild(se)}o.value=D.some(([S])=>S===C)?C:""}function v(C){let D=Number(C);if(!Number.isFinite(D))return"";let S=new Date(D);if(Number.isNaN(S.getTime()))return"";let G=String(S.getMonth()+1).padStart(2,"0"),se=String(S.getDate()).padStart(2,"0"),X=String(S.getFullYear()%100).padStart(2,"0");return`${G}/${se}/${X}`}function w(C,D="center"){let S=document.createElement("div");return S.textContent=C,S.style.padding="6px 8px",S.style.display="flex",S.style.flexDirection="column",S.style.justifyContent="center",S.style.alignItems=D==="left"?"flex-start":"center",S.style.textAlign=D,S.style.whiteSpace=D==="left"?"pre-wrap":"normal",S.style.wordBreak=D==="left"?"break-word":"normal",S.style.borderBottom="1px solid #ffffff12",S}function x(C){let D=w("","center");D.style.gap="2px";let S=document.createElement("div"),G=document.createElement("div"),se=typeof C.date=="string"&&C.date.trim().length>0;se&&(S.textContent=C.date??""),G.textContent=C.time12,se&&D.appendChild(S),D.appendChild(G);let X=C.petName||C.species||"Pet",ue=w(X,"center"),N=w(C.abilityName||C.abilityId,"center"),ee=typeof C.data=="string"?C.data:(()=>{try{return JSON.stringify(C.data)}catch{return""}})(),q=w(ee,"left");C.isActiveSession&&[D,ue,N,q].forEach(A=>{A.style.background="rgba(89, 162, 255, 0.14)"}),u.append(D,ue,N,q)}let E=C=>String(C??"").toLowerCase().replace(/\s+/g,"").replace(/([ivx]+)$/i,"");function L(){let C=f.slice();if(h&&h.trim()){let D=E(h);C=C.filter(S=>{let G=E(S.abilityId),se=E(Te.getAbilityNameWithoutLevel(S.abilityId));return G===D||se===D})}if(g&&g.trim()){let D=g.toLowerCase();C=C.filter(S=>{let G=(S.petName||S.species||"").toLowerCase(),se=(S.abilityName||"").toLowerCase(),X=(S.abilityId||"").toLowerCase(),ue=(typeof S.data=="string"?S.data:(()=>{try{return JSON.stringify(S.data)}catch{return""}})()).toLowerCase();return G.includes(D)||se.includes(D)||X.includes(D)||ue.includes(D)||(S.petId||"").toLowerCase().includes(D)})}return C.sort((D,S)=>m==="asc"?D.performedAt-S.performedAt:S.performedAt-D.performedAt),C}function P(){u.innerHTML="";let C=L();if(!C.length){let D=document.createElement("div");D.textContent="No logs yet.",D.style.opacity="0.75",D.style.gridColumn="1 / -1",D.style.padding="8px",u.appendChild(D);return}C.forEach(x),m==="asc"?u.scrollTop=u.scrollHeight+32:u.scrollTop=0}o.onchange=()=>{h=o.value,P()},s.onchange=()=>{m=s.value||"desc",P()},i.addEventListener("input",()=>{g=i.value.trim(),P()}),a.onclick=()=>{try{Te.clearAbilityLogs()}catch{}};let V=null,z=null;(async()=>{try{V=await Te.startAbilityLogsWatcher(),y(),z=Te.onAbilityLogs(C=>{f=C.map(D=>({petId:D.petId,petName:D.name??null,species:D.species??null,abilityId:D.abilityId,abilityName:D.abilityName,data:D.data,performedAt:D.performedAt,date:v(D.performedAt),time12:D.time12,isActiveSession:p>0&&D.performedAt>=p})),y(),P()})}catch{}})(),t.__cleanup__=(()=>{let C=t.__cleanup__;return()=>{try{z?.()}catch{}try{V?.()}catch{}try{C?.()}catch{}}})(),P()}function I0(t){let e=new Ye({id:"pets",compact:!0,windowSelector:".qws-win"});e.mount(t),e.addTab("autofeed","\u{1F37D}\uFE0F Autofeed",n=>zM(n,e)),e.addTab("manager","\u{1F9F0} Manager",n=>UM(n,e)),e.addTab("logs","\u{1F4DD} Logs",n=>KM(n,e))}var A0="qws:player:ghostMode",M0="qws:ghost:delayMs",Fl=50,VM=(t=!1)=>{try{return localStorage.getItem(A0)==="1"}catch{return t}},YM=t=>{try{localStorage.setItem(A0,t?"1":"0")}catch{}},P0=()=>{try{let t=Math.floor(Number(localStorage.getItem(M0))||Fl);return Math.max(5,t)}catch{return Fl}},R0=t=>{let e=Math.max(5,Math.floor(t||Fl));try{localStorage.setItem(M0,String(e))}catch{}};function $M(){let t=P0(),e=new Set,n=h=>{let m=h.key.toLowerCase();(m==="z"||m==="q"||m==="s"||m==="d"||m==="w"||m==="a"||h.key==="ArrowUp"||h.key==="ArrowDown"||h.key==="ArrowLeft"||h.key==="ArrowRight")&&(h.preventDefault(),h.stopImmediatePropagation(),!h.repeat&&e.add(m))},r=h=>{let m=h.key.toLowerCase();(m==="z"||m==="q"||m==="s"||m==="d"||m==="w"||m==="a"||h.key==="ArrowUp"||h.key==="ArrowDown"||h.key==="ArrowLeft"||h.key==="ArrowRight")&&(h.preventDefault(),h.stopImmediatePropagation(),e.delete(m))},o=()=>{e.clear()},s=()=>{document.hidden&&e.clear()};function i(){let h=0,m=0;return(e.has("z")||e.has("w")||e.has("arrowup"))&&(m-=1),(e.has("s")||e.has("arrowdown"))&&(m+=1),(e.has("q")||e.has("a")||e.has("arrowleft"))&&(h-=1),(e.has("d")||e.has("arrowright"))&&(h+=1),h&&(h=h>0?1:-1),m&&(m=m>0?1:-1),{dx:h,dy:m}}let a=null,l=0,c=0,d=!1;async function u(h,m){let g;try{g=await Se.getPosition()}catch{}let y=Math.round(g?.x??0),v=Math.round(g?.y??0);try{await Se.move(y+h,v+m)}catch{}}let p={capture:!0};function f(h){l||(l=h);let m=h-l;l=h;let{dx:g,dy:y}=i();if(c+=m,g===0&&y===0){c=Math.min(c,t*4),a=requestAnimationFrame(f);return}c>=t&&!d&&(c-=t,d=!0,(async()=>{try{await u(g,y)}finally{d=!1}})()),c=Math.min(c,t*4),a=requestAnimationFrame(f)}return{start(){a===null&&(l=0,c=0,d=!1,window.addEventListener("keydown",n,p),window.addEventListener("keyup",r,p),window.addEventListener("blur",o),document.addEventListener("visibilitychange",s),a=requestAnimationFrame(f))},stop(){a!==null&&(cancelAnimationFrame(a),a=null),e.clear(),window.removeEventListener("keydown",n,p),window.removeEventListener("keyup",r,p),window.removeEventListener("blur",o),document.removeEventListener("visibilitychange",s)},setSpeed(h){let m=Math.max(5,Math.floor(h||Fl));t=m,R0(m)},getSpeed(){return t}}}var Ct=new Map,Dl=new Map,yo=[],JM=new Intl.NumberFormat("en-US"),Xs=t=>JM.format(Math.max(0,Math.floor(t||0)));async function _0(){try{await pe.inventory.mySelectedItemName.set(null)}catch{}try{await pe.inventory.myValidatedSelectedItemIndex.set(null)}catch{}try{await pe.inventory.myPossiblyNoLongerValidSelectedItemIndex.set(null)}catch{}}var jl="qws-seeddeleter-overlay",L0="qws-seeddeleter-list",N0="qws-seeddeleter-summary";function QM(t){return new Promise(e=>setTimeout(e,t))}function ZM(){let t=new Map;try{let e=Be;for(let n of Object.keys(e||{})){let r=e?.[n]?.seed?.name&&String(e?.[n]?.seed?.name)||`${n} Seed`,o=t.get(r)??[];o.push(n),t.set(r,o)}}catch{}return t}async function XM(){let t=await zl(),e=new Map;for(let n of t){let r=Math.max(0,Math.floor(n.quantity||0));r>0&&e.set(n.species,(e.get(n.species)??0)+r)}return e}function eP(t,e,n){let r=Math.max(0,Math.floor(t.qty||0)),o=e.get(t.name)??[];if(!o.length&&/ seed$/i.test(t.name)){let a=t.name.replace(/\s+seed$/i,"");Be?.[a]&&(o=[a])}if(!o.length||r<=0)return[];let s=o.map(a=>({sp:a,available:n.get(a)??0})).filter(a=>a.available>0).sort((a,l)=>l.available-a.available),i=[];for(let{sp:a,available:l}of s){if(r<=0)break;let c=Math.min(l,r);c>0&&(i.push({species:a,qty:c}),r-=c)}return i}var fp=null,Bl=!1;async function O0(t={}){if(Bl){await we("Seed deleter","Deletion already in progress.","info");return}let e=Math.max(1,Math.floor(t.batchSize??25)),n=Math.max(0,Math.floor(t.delayMs??16)),r=(t.selection&&Array.isArray(t.selection)?t.selection:Array.from(Ct.values())).map(p=>({name:p.name,qty:Math.max(0,Math.floor(p.qty||0))})).filter(p=>p.qty>0);if(r.length===0){await we("Seed deleter","No seeds selected.","info");return}let o=ZM(),s=await XM(),i=new Map,a=0,l=0;for(let p of r){a+=p.qty;let f=eP(p,o,s),h=f.reduce((m,g)=>m+g.qty,0);l+=h;for(let m of f)i.set(m.species,(i.get(m.species)??0)+m.qty)}if(l<=0){await we("Seed deleter","Nothing to delete (not in inventory).","info");return}l<a&&await we("Seed deleter",`Requested ${Xs(a)} but only ${Xs(l)} available. Proceeding.`,"info");let c=Array.from(i.entries()).map(([p,f])=>({species:p,qty:Math.max(0,Math.floor(f||0))})).filter(p=>p.qty>0),d=c.reduce((p,f)=>p+f.qty,0);if(d<=0){await we("Seed deleter","Nothing to delete.","info");return}Bl=!0;let u=new AbortController;fp=u;try{await we("Seed deleter",`Deleting ${Xs(d)} seeds across ${c.length} species...`,"info");let p=0;for(let f of c){let h=f.qty;for(;h>0;){if(u.signal.aborted)throw new Error("Deletion cancelled.");let m=Math.min(e,h);for(let g=0;g<m;g++)try{await Se.wish(f.species)}catch{}p+=m,h-=m;try{t.onProgress?.({done:p,total:d,species:f.species,remainingForSpecies:h}),window.dispatchEvent(new CustomEvent("qws:seeddeleter:progress",{detail:{done:p,total:d,species:f.species,remainingForSpecies:h}}))}catch{}n>0&&h>0&&await QM(n)}}t.keepSelection||Ct.clear();try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:done",{detail:{total:d,speciesCount:c.length}}))}catch{}await we("Seed deleter",`Deleted ${Xs(d)} seeds (${c.length} species).`,"success")}catch(p){let f=p?.message||"Deletion failed.";try{window.dispatchEvent(new CustomEvent("qws:seeddeleter:error",{detail:{message:f}}))}catch{}await we("Seed deleter",f,"error")}finally{Bl=!1,fp=null}}function tP(){try{fp?.abort()}catch{}}function nP(){return Bl}try{window.addEventListener("qws:seeddeleter:apply",async t=>{try{let e=Array.isArray(t?.detail?.selection)?t.detail.selection:void 0;await O0({selection:e,batchSize:25,delayMs:16,keepSelection:!1})}catch{}})}catch{}function q0(t){try{let n=Be?.[t]?.seed?.name;if(typeof n=="string"&&n)return n}catch{}return`${t} Seed`}function rP(t,e){if(!t||typeof t!="object")return null;let n=typeof t.species=="string"?t.species.trim():"",r=t.itemType==="Seed"?"Seed":null,o=Number.isFinite(t.quantity)?Math.max(0,Math.floor(t.quantity)):0;return!n||r!=="Seed"||o<=0?null:{species:n,itemType:"Seed",quantity:o,id:`seed:${n}`}}async function zl(){try{let t=await pe.inventory.mySeedInventory.get();if(!Array.isArray(t))return[];let e=[];return t.forEach((n,r)=>{let o=rP(n,r);o&&e.push(o)}),e}catch{return[]}}function D0(t){return{items:t,favoritedItemIds:[]}}function qt(t,e){Object.assign(t.style,e)}function oP(t){t.id=jl,qt(t,{position:"fixed",left:"12px",top:"12px",zIndex:"999999",display:"grid",gridTemplateRows:"auto auto 1px 1fr auto",gap:"6px",minWidth:"320px",maxWidth:"420px",maxHeight:"52vh",padding:"8px",border:"1px solid #39424c",borderRadius:"10px",background:"rgba(22,27,34,0.92)",boxShadow:"0 10px 30px rgba(0,0,0,0.35)",backdropFilter:"blur(2px)",userSelect:"none",fontFamily:"ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial",fontSize:"12px",lineHeight:"1.25"}),t.dataset.qwsSeedDeleter="1"}function sP(t,e){let n=!1,r=0,o=0,s=l=>{n=!0;let c=t.getBoundingClientRect();r=l.clientX-c.left,o=l.clientY-c.top,document.addEventListener("mousemove",i),document.addEventListener("mouseup",a,{once:!0})},i=l=>{if(!n)return;let c=Math.max(4,l.clientX-r),d=Math.max(4,l.clientY-o);t.style.left=`${c}px`,t.style.top=`${d}px`},a=()=>{n=!1,document.removeEventListener("mousemove",i)};e.addEventListener("mousedown",s)}function mp(t,e){let n=document.createElement("button");return n.textContent=t,qt(n,{padding:"4px 8px",borderRadius:"8px",border:"1px solid #4446",background:"#161b22",color:"#E7EEF7",cursor:"pointer",fontWeight:"600",fontSize:"12px",...e}),n.onmouseenter=()=>n.style.borderColor="#6aa1",n.onmouseleave=()=>n.style.borderColor="#4446",n}var Hl=!1;function iP(t){return!!(t&&t.closest?.(`#${jl}`))}function B0(t){let e=document.activeElement;if(!iP(e))return;let n=(e?.tagName||"").toLowerCase();(n==="input"||n==="textarea"||e&&e.isContentEditable)&&/^[0-9]$/.test(t.key)&&t.stopImmediatePropagation()}function aP(){Hl||(window.addEventListener("keydown",B0,{capture:!0}),Hl=!0)}function lP(){Hl&&(window.removeEventListener("keydown",B0,{capture:!0}),Hl=!1)}async function cP(){try{await Df()}catch{try{document.dispatchEvent(new KeyboardEvent("keydown",{key:"Escape"}))}catch{}}}function dP(){let t=document.createElement("div");oP(t);let e=document.createElement("div");qt(e,{display:"flex",alignItems:"center",gap:"4px",cursor:"move"});let n=document.createElement("div");n.textContent="\u{1F3AF} Selection mode",qt(n,{fontWeight:"700",fontSize:"13px"});let r=document.createElement("div");r.textContent="Click seeds in inventory to toggle selection.",qt(r,{opacity:"0.8",fontSize:"11px"});let o=document.createElement("div");qt(o,{height:"1px",background:"#2d333b"});let s=document.createElement("div");s.id=L0,qt(s,{minHeight:"44px",maxHeight:"26vh",overflow:"auto",padding:"4px",border:"1px dashed #39424c",borderRadius:"8px",background:"rgba(15,19,24,0.84)",userSelect:"text"});let i=document.createElement("div");qt(i,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"8px"});let a=document.createElement("div");a.id=N0,qt(a,{fontWeight:"600"}),a.textContent="Selected: 0 species \xB7 0 seeds";let l=mp("Clear");return l.title="Clear selection",l.onclick=async()=>{Ct.clear(),Ul(),ei(),await _0(),await hp()},xn=mp("Confirm",{background:"#1F2328CC"}),xn.disabled=!0,xn.onclick=async()=>{await cP()},e.append(n),i.append(a,l,xn),t.append(e,r,o,s,i),sP(t,e),t}function uP(){if(document.getElementById(jl))return;let t=dP();document.body.appendChild(t),aP(),Ul(),ei()}function pP(){let t=document.getElementById(jl);t&&t.remove(),lP()}var xn=null,Wl=null;function fP(t){let e=document.createElement("div");qt(e,{display:"grid",gridTemplateColumns:"1fr auto",alignItems:"center",gap:"6px",padding:"4px 6px",borderBottom:"1px dashed #2d333b"});let n=document.createElement("div");n.textContent=t.name,qt(n,{fontSize:"12px",fontWeight:"600",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"});let r=document.createElement("div");qt(r,{display:"flex",alignItems:"center",gap:"6px"});let o=document.createElement("input");o.type="number",o.min="1",o.max=String(Math.max(1,t.maxQty)),o.step="1",o.value=String(t.qty),o.className="qmm-input",qt(o,{width:"68px",height:"28px",border:"1px solid #4446",borderRadius:"8px",background:"rgba(15,19,24,0.90)",padding:"0 8px",fontSize:"12px"});let s=a=>{/^[0-9]$/.test(a.key)&&(a.stopPropagation(),a.stopImmediatePropagation())};o.addEventListener("keydown",s),o.onchange=()=>{let a=Math.min(t.maxQty,Math.max(1,Math.floor(Number(o.value)||1)));o.value=String(a);let l=Ct.get(t.name);l&&(l.qty=a,Ct.set(t.name,l),ei())},o.oninput=o.onchange;let i=mp("Remove",{background:"transparent"});return i.onclick=async()=>{Ct.delete(t.name),Ul(),ei(),await hp()},r.append(o,i),e.append(n,r),e}function Ul(){let t=document.getElementById(L0);if(!t)return;t.innerHTML="";let e=Array.from(Ct.values()).sort((n,r)=>n.name.localeCompare(r.name));if(e.length===0){let n=document.createElement("div");n.textContent="No seeds selected.",n.style.opacity="0.8",t.appendChild(n);return}for(let n of e)t.appendChild(fP(n))}function mP(){let t=0,e=0;for(let n of Ct.values())t+=1,e+=n.qty;return{species:t,qty:e}}function ei(){let{species:t,qty:e}=mP(),n=document.getElementById(N0);n&&(n.textContent=`Selected: ${t} species \xB7 ${Xs(e)} seeds`),xn&&(xn.textContent="Confirm",xn.disabled=e<=0,xn.style.opacity=e<=0?"0.6":"1",xn.style.cursor=e<=0?"not-allowed":"pointer")}async function hp(){let t=new Set(Array.from(Ct.keys())),e=(Array.isArray(yo)?yo:[]).filter(n=>{let r=q0(n.species);return!t.has(r)});try{await Wt({items:e,favoritedItemIds:[]},{open:!1})}catch{}}async function hP(){if(Wl)return;let t=await pe.inventory.mySelectedItemName.onChange(async e=>{let n=(e||"").trim();if(n){if(Ct.has(n))Ct.delete(n);else{let r=Math.max(1,Dl.get(n)??1);Ct.set(n,{name:n,qty:r,maxQty:r})}Ul(),ei(),await _0(),await hp()}});Wl=typeof t=="function"?t:null}async function gP(){let t=Wl;Wl=null;try{await t?.()}catch{}}async function yP(){try{let t=await zl();if(!t.length){await we("Seed inventory","No seeds to display.","info");return}await Wt(D0(t),{open:!0})}catch(t){await we("Seed inventory",t?.message||"Failed to open seed inventory.","error")}}async function bP(t){try{t?.(!1),yo=await zl(),Dl=new Map;for(let e of yo){let n=q0(e.species);Dl.set(n,Math.max(1,Math.floor(e.quantity||0)))}Ct.clear(),uP(),await hP(),await Wt(D0(yo),{open:!0}),await Yi()&&await $i()}catch(e){await we("Seed inventory",e?.message||"Failed to open seed selector.","error")}finally{await gP(),pP(),yo=[],Dl.clear(),t?.(!0)}}var fn={readGhostEnabled:VM,writeGhostEnabled:YM,getGhostDelayMs:P0,setGhostDelayMs:R0,createGhostController:$M,getMySeedInventory:zl,openSeedInventoryPreview:yP,openSeedSelectorFlow:bP,deleteSelectedSeeds:O0,cancelSeedDeletion:tP,isSeedDeletionRunning:nP,getCurrentSeedSelection(){return Array.from(Ct.values())},clearSeedSelection(){Ct.clear()}};var vP=new Intl.NumberFormat("en-US"),wP=t=>vP.format(Math.max(0,Math.floor(t||0)));async function F0(t){let e=new Ye({id:"misc",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gap="8px",n.style.minHeight="0",n.style.justifyItems="center";let r=(()=>{let a=document.createElement("div");a.style.display="flex",a.style.alignItems="center",a.style.gap="12px",a.style.flexWrap="wrap";let l=(g,y,v)=>{let w=document.createElement("div");w.style.display="inline-flex",w.style.alignItems="center",w.style.gap="6px";let x=e.label(g);return x.style.fontSize="13px",x.style.margin="0",x.style.justifySelf="start",v&&(x.id=v),w.append(x,y),w},c=e.switch(fn.readGhostEnabled(!1));c.id="player.ghostMode";let d=l("Ghost",c,"label.ghost"),u=e.inputNumber(10,1e3,5,50);u.id="player.moveDelay";let p=u.wrap??u;p.style&&(p.style.margin="0"),u.style&&(u.style.width="84px");let f=l("Delay (ms)",p,"label.delay");a.append(d,f);let h=fn.createGhostController();u.value=String(fn.getGhostDelayMs()),u.addEventListener("change",()=>{let g=Math.max(10,Math.min(1e3,Math.floor(Number(u.value)||50)));u.value=String(g),h.setSpeed?.(g),fn.setGhostDelayMs(g)}),c.checked&&h.start(),c.onchange=()=>{let g=!!c.checked;fn.writeGhostEnabled(g),g?h.start():h.stop()},a.__cleanup__=()=>{try{h.stop()}catch{}};let m=e.card("\u{1F3AE} Player controls",{tone:"muted",align:"center"});return m.root.style.maxWidth="440px",m.body.append(a),m.root})(),o=(()=>{let a=e.card("\u{1F43E} Pet feeding",{tone:"muted",align:"center"});a.root.style.maxWidth="440px";let l=document.createElement("div");l.style.display="grid",l.style.gap="6px",l.style.justifyItems="center";let c=e.flexRow({gap:8,align:"center"}),d=e.switch(!1);d.id="misc.petFeeding.enabled";let u=e.label("Log compatible crops for the expanded pet");u.style.fontSize="13px",u.style.margin="0",c.append(d,u);let p=document.createElement("div");p.style.fontSize="12px",p.style.opacity="0.85",p.style.textAlign="center",p.textContent="Inactive",l.append(c,p),a.body.append(l);let f=null,h=async()=>{let v=f;if(f=null,!v){p.textContent="Inactive";return}try{let w=v();w&&typeof w.then=="function"&&await w}catch{}p.textContent="Inactive"},m=async v=>{let w=typeof v=="string"&&v.length?v:null;if(!d.checked)return;if(!w){p.textContent="Listening\u2026 (no expanded pet)";return}let x=`${w.slice(0,8)}\u2026`;p.textContent=`Resolving ${x}`;try{let E=await Te.getPets(),P=(Array.isArray(E)?E:[]).find(C=>String(C?.slot?.id||"")===w)??null;if(!P){p.textContent=`No pet found for ${x}`,console.warn("[Misc > Pet feeding] No pet found for expanded pet id",w);return}let V=String(P?.slot?.petSpecies||""),z=Te.getCompatibleCropsForSpecies(V);console.log(`[Misc > Pet feeding] Compatible crops for pet ${w} (${V||"unknown"})`,z),p.textContent=`Logged ${z.length} crop(s) for ${V||"unknown"}`}catch(E){p.textContent="Failed to resolve pet",console.error("[Misc > Pet feeding] Failed to resolve expanded pet",E)}},g=async()=>{if(!f){p.textContent="Listening\u2026";try{f=await pe.pets.expandedPetSlotId.onChangeNow(v=>{m(v)})}catch(v){p.textContent="Failed to listen to pet slot",console.error("[Misc > Pet feeding] Failed to subscribe to expanded pet slot",v),d.checked=!1}}};d.onchange=()=>{d.checked?g():h()};let y=()=>{d.checked=!1,h()};return{root:a.root,cleanup:y}})(),s=(()=>{let a=e.formGrid({columnGap:6,rowGap:6}),l=e.label("Selected");l.style.fontSize="13px",l.style.margin="0",l.style.justifySelf="start";let c=document.createElement("div");c.id="misc.seedDeleter.summary",c.style.fontSize="13px",c.style.opacity="0.9",c.textContent="0 species \xB7 0 seeds",a.append(l,c);let d=e.label("Actions");d.style.fontSize="13px",d.style.margin="0",d.style.justifySelf="start";let u=e.flexRow({gap:6});u.style.justifyContent="flex-start";let p=e.btn("Select seeds",{variant:"primary",size:"sm"}),f=e.btn("Delete",{variant:"danger",size:"sm",disabled:!0}),h=e.btn("Clear",{size:"sm",disabled:!0});u.append(p,f,h),a.append(d,u);function m(){let v=fn.getCurrentSeedSelection?.()||[],w=v.length,x=0;for(let E of v)x+=Math.max(0,Math.floor(E?.qty||0));return{sel:v,speciesCount:w,totalQty:x}}function g(){let{speciesCount:v,totalQty:w}=m();c.textContent=`${v} species \xB7 ${wP(w)} seeds`;let x=v>0&&w>0;e.setButtonEnabled(f,x),e.setButtonEnabled(h,x)}p.onclick=async()=>{await fn.openSeedSelectorFlow(e.setWindowVisible.bind(e)),g()},h.onclick=()=>{try{fn.clearSeedSelection?.()}catch{}g()},f.onclick=async()=>{await fn.deleteSelectedSeeds(),g()};let y=e.card("\u{1F5D1}\uFE0F Seed deleter",{tone:"muted",align:"center"});return y.root.style.maxWidth="440px",y.body.append(a),y.root})(),i=document.createElement("div");i.style.display="grid",i.style.gap="8px",i.style.justifyItems="center",i.append(r,o.root,s),n.appendChild(i),n.__cleanup__=()=>{try{r.__cleanup__?.()}catch{}try{o.cleanup?.()}catch{}try{s.__cleanup__?.()}catch{}}}var Gl=[{id:"wiki",title:"Magic Garden Wiki",description:"Community-curated documentation for plants, mechanics, weather, and more.",url:"https://magicgarden.fandom.com/wiki/MagicCircle_Wiki",icon:"\u{1F4DA}",tags:["guide"]},{id:"calculator",title:"Magic Garden Calculator",description:"Numerous optimisation statistics at your fingertips.",url:"https://daserix.github.io/magic-garden-calculator/",icon:"\u{1F9EE}",tags:["calculator"]},{id:"mgtools",title:"MGTools",description:"Utility scripts designed to streamline your time in Magic Garden.",url:"https://github.com/Myke247/MGTools/",icon:"\u{1F6E0}\uFE0F",tags:["utility"]},{id:"pet-revenue",title:"Pet Revenue Planner",description:"Forecast the extra income your pets generate, showing $/min and per-boost gains so you can decide which pets and crops to prioritize.",url:"https://docs.google.com/spreadsheets/d/1tG1LIEsXQlNRxaN2pySkwwN688_eCLgGIil_xRaPnBo/edit?gid=1430710045#gid=1430710045",icon:"\u{1F43E}",tags:["calculator"]},{id:"dollar-hour",title:"$ per Hour Calculators",description:"Estimate your gold per hour: select a crop, apply weather and friend/pet boosts, set the duration, and get an instant $/h result.",url:"https://docs.google.com/spreadsheets/d/1ZYikURs-vBMfTQCU_fFbl25CITBrjsEZePxWc-DqOm8/edit?gid=689506777#gid=689506777",icon:"\u{1F4B8}",tags:["calculator"]},{id:"should-i-invest",title:"Should I Invest?",description:"Instant ROI calculator, select crop, weather, mutation, size, and boost to see if it\u2019s worth it.",url:"https://docs.google.com/spreadsheets/d/1PyKd9NG3GsocFmCgwQ01ZQ783ADzcim5LS5XLSLJtqI/edit",icon:"\u{1F914}",tags:["calculator"]},{id:"matrixes",title:"Matrixes Reference",description:"A reference matrix that compares and ranks each plant\u2019s $/h across all buffs and combos, with quick pick/freeze/gold suggestions.",url:"https://docs.google.com/spreadsheets/d/1gUdu8LBFbkN7CJzqX_nDwLW9nxdIks-0jRJTrUI19U4/edit?gid=1450892699#gid=1450892699",icon:"\u{1F9E9}",tags:["reference"]},{id:"beginners-guide",title:"Beginner's Guide Snapshot",description:"A concise visual cheat sheet to get new gardeners up to speed quickly.",url:"https://i.imgur.com/7IHU0RJ.png",icon:"\u{1F331}",tags:["guide","beginner"]}],SP=Array.from(new Set(Gl.flatMap(t=>t.tags??[]))).sort((t,e)=>t.localeCompare(e));function Kl(t){return{...t,tags:t.tags?[...t.tags]:void 0}}function xP(t){if(typeof t=="string"){let e=Gl.find(n=>n.id===t);return e?Kl(e):null}return Kl(t)}function EP(t){if(typeof GM_openInTab=="function")return GM_openInTab(t,{active:!0,insert:!0}),!0;if(typeof window>"u")return!1;try{let e=document.createElement("a");return e.href=t,e.target="_blank",e.rel="noopener noreferrer",document.body.appendChild(e),e.click(),e.remove(),!0}catch{return!1}}var Vl={list(){return Gl.map(Kl)},tags(){return SP.map(t=>t)},get(t){let e=Gl.find(r=>r.id===t);return e?Kl(e):null},open(t){let e=xP(t);return e?EP(e.url):!1}};function CP(t){let e=document.createElement("span");return e.textContent=t,e.style.display="inline-flex",e.style.alignItems="center",e.style.justifyContent="center",e.style.padding="2px 8px",e.style.borderRadius="999px",e.style.background="#ffffff11",e.style.border="1px solid #ffffff22",e.style.fontSize="11px",e.style.letterSpacing="0.02em",e.style.textTransform="uppercase",e.style.opacity="0.8",e}function TP(t,e){let n=`${e.icon?`${e.icon} `:""}${e.title}`,r=t.card(n,{tone:"muted",align:"stretch"});r.root.style.width="100%";let o=r.body;o.style.display="grid",o.style.gap="10px",o.style.justifyItems="stretch";let s=document.createElement("p");if(s.textContent=e.description,s.style.margin="0",s.style.fontSize="13px",s.style.lineHeight="1.45",s.style.opacity="0.9",s.style.textAlign="left",o.appendChild(s),e.tags?.length){let l=document.createElement("div");l.style.display="flex",l.style.flexWrap="wrap",l.style.gap="6px",l.style.opacity="0.85",e.tags.forEach(c=>l.appendChild(CP(c))),o.appendChild(l)}let i=t.flexRow({gap:8,justify:"end",fullWidth:!0});i.style.marginTop="4px";let a=t.btn("Open tool",{variant:"primary",icon:"\u{1F517}",fullWidth:!0,title:"Open the tool in a new tab"});return a.style.flex="1 1 auto",a.style.minWidth="0",a.onclick=()=>{Vl.open(e)||we("Unable to open link","Please open the address manually.","error")},i.append(a),o.appendChild(i),r.root}async function H0(t){let e=new Ye({id:"tools",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px",n.style.alignItems="center",n.style.padding="8px",n.style.width="100%",n.style.maxHeight="54vh",n.style.overflowY="auto",n.style.overflowX="auto";let r=720,o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="12px",o.style.width=`${r}px`,o.style.minWidth=`${r}px`,o.style.maxWidth=`${r}px`,o.style.boxSizing="border-box",o.style.alignSelf="center";let s=e.card("\u{1F9F0} Community tools",{tone:"muted",align:"stretch"}),i=document.createElement("p");i.textContent="Discover community-made helpers to plan, calculate, and simplify your Magic Garden adventures.",i.style.margin="0",i.style.fontSize="13px",i.style.lineHeight="1.5",i.style.opacity="0.9",i.style.textAlign="left",s.body.appendChild(i),o.appendChild(s.root);let a=Vl.list(),l=document.createElement("div");l.style.display="flex",l.style.flexDirection="column",l.style.gap="8px",l.style.background="#ffffff08",l.style.border="1px solid #ffffff11",l.style.borderRadius="12px",l.style.padding="12px";let c=document.createElement("span");c.textContent="Filter by tags",c.style.fontSize="12px",c.style.letterSpacing="0.05em",c.style.textTransform="uppercase",c.style.opacity="0.75",c.style.fontWeight="600";let d=document.createElement("div");d.style.display="flex",d.style.flexWrap="wrap",d.style.gap="8px";let u=new Set,p=new Map,f,h,m=x=>{x.type="button",x.style.display="inline-flex",x.style.alignItems="center",x.style.justifyContent="center",x.style.padding="4px 10px",x.style.borderRadius="999px",x.style.border="1px solid",x.style.background="#ffffff11",x.style.borderColor="#ffffff22",x.style.fontSize="11px",x.style.fontWeight="600",x.style.letterSpacing="0.03em",x.style.textTransform="uppercase",x.style.color="inherit",x.style.opacity="0.85",x.style.cursor="pointer",x.style.transition="background 120ms ease, border-color 120ms ease, opacity 120ms ease"},g=(x,E)=>{E?(x.style.background="#2d8cff33",x.style.borderColor="#2d8cff66",x.style.opacity="1"):(x.style.background="#ffffff11",x.style.borderColor="#ffffff22",x.style.opacity="0.85")},y=()=>{h.innerHTML="";let x=u.size?a.filter(E=>E.tags?.some(L=>u.has(L))):a;if(x.length===0){let E=document.createElement("p");E.textContent="No tools match the selected tags yet.",E.style.margin="12px 0 0",E.style.fontSize="13px",E.style.opacity="0.75",E.style.textAlign="center",h.appendChild(E);return}x.forEach(E=>{h.appendChild(TP(e,E))})},v=()=>{p.forEach((x,E)=>{g(x,u.has(E))}),g(f,u.size===0)},w=x=>{u.has(x)?u.delete(x):u.add(x),v(),y()};f=document.createElement("button"),f.textContent="All",m(f),f.onclick=()=>{u.size!==0&&(u.clear(),v(),y())},d.appendChild(f),Vl.tags().forEach(x=>{let E=document.createElement("button");E.textContent=x,m(E),E.onclick=()=>w(x),d.appendChild(E),p.set(x,E)}),l.appendChild(c),l.appendChild(d),o.appendChild(l),h=document.createElement("div"),h.style.display="flex",h.style.flexDirection="column",h.style.gap="12px",y(),v(),o.appendChild(h),n.appendChild(o)}function kP(t,e){let n=document.createElement("div");n.style.display="flex",n.style.alignItems="center",n.style.flexWrap="nowrap",n.style.gap="8px";let r=t.hotkeyButton(lt(e.id),h=>rs(e.id,h),{emptyLabel:"Unassigned",listeningLabel:"Press a key\u2026",clearable:!0,allowModifierOnly:e.allowModifierOnly});r.style.flexShrink="0",n.appendChild(r);let o=null;if(e.holdDetection)if(e.id==="game.action"){let h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="center",h.style.gap="4px",h.style.flex="0 1 160px",h.style.alignSelf="center";let m=t.btn("Hold",{size:"sm",variant:"secondary"});m.style.display="inline-flex",m.style.alignItems="center",m.style.gap="6px",m.setAttribute("aria-label",e.holdDetection.label),m.title=e.holdDetection.label;let g=document.createElement("span");g.textContent="\u25CF",g.style.fontSize="10px",g.style.lineHeight="1",g.setAttribute("aria-hidden","true");let y=document.createElement("span");y.textContent="Hold",m.replaceChildren(g,y);let v=os(e.id),w=x=>{v=x,m.setAttribute("aria-pressed",x?"true":"false"),g.style.color=x?"#34c759":"#ff3b30"};if(w(v),m.addEventListener("click",()=>{nd(e.id,!v)}),o=ra(e.id,x=>{w(x)}),h.appendChild(m),e.holdDetection.description){let x=document.createElement("div");x.textContent=e.holdDetection.description,x.style.fontSize="11px",x.style.opacity="0.65",x.style.maxWidth="100%",x.style.textAlign="center",h.appendChild(x)}n.appendChild(h)}else{let h=document.createElement("div");h.style.display="flex",h.style.flexDirection="column",h.style.alignItems="flex-start",h.style.gap="2px",h.style.padding="2px 4px",h.style.borderRadius="8px",h.style.background="rgba(255, 255, 255, 0.04)",h.style.flex="0 1 180px",h.style.maxWidth="180px";let m=document.createElement("label");m.style.display="inline-flex",m.style.alignItems="center",m.style.gap="6px",m.style.fontSize="12px",m.style.cursor="pointer";let g=t.switch(os(e.id));g.style.margin="0",g.setAttribute("aria-label",e.holdDetection.label);let y=document.createElement("span");if(y.textContent=e.holdDetection.label,y.style.opacity="0.85",m.append(g,y),h.appendChild(m),e.holdDetection.description){let v=document.createElement("div");v.textContent=e.holdDetection.description,v.style.fontSize="11px",v.style.opacity="0.65",v.style.maxWidth="100%",h.appendChild(v)}g.addEventListener("change",()=>{nd(e.id,g.checked)}),o=ra(e.id,v=>{g.checked=v}),n.appendChild(h)}let s=document.createElement("div");s.style.display="flex",s.style.alignItems="center",s.style.gap="4px",s.style.marginLeft="auto";let i=e.sectionId==="game"?null:t.btn("",{icon:"\u{1F5D1}\uFE0F",variant:"danger",size:"sm",tooltip:"Remove this shortcut",ariaLabel:"Remove keybind"});i&&s.appendChild(i);let a=om(e.id),l=Lt(a),c=null;a&&(c=t.btn("",{icon:"\u{1F504}",variant:"primary",size:"sm",tooltip:"Restore default shortcut",ariaLabel:"Reset keybind to default"}),s.appendChild(c));let d=(h,m)=>{if(!h)return;let g=h.setEnabled;g?g(m):(h.disabled=!m,h.classList.toggle("is-disabled",!m),h.setAttribute("aria-disabled",(!m).toString()))},u=h=>{let m=Lt(h).length>0;if(i&&d(i,m),c){let g=Lt(h)===l;d(c,!g)}};i&&i.addEventListener("click",()=>{rs(e.id,null);let h=lt(e.id);r.refreshHotkey(h),u(h)}),c&&c.addEventListener("click",()=>{sm(e.id);let h=lt(e.id);r.refreshHotkey(h),u(h)}),n.appendChild(s),u(lt(e.id));let p=an(e.id,h=>{r.refreshHotkey(h),u(h)});t.on("unmounted",p),o&&t.on("unmounted",o);let f=t.formRow(e.label,n,{labelWidth:"180px"});if(f.label.style.fontSize="13px",f.label.style.opacity="0.92",e.hint){let h=document.createElement("div");h.textContent=e.hint,h.style.fontSize="11px",h.style.opacity="0.7",h.style.marginTop="2px",h.style.gridColumn="2 / 3",f.root.appendChild(h)}return f.root}async function W0(t){let e=new Ye({id:"keybinds",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="flex",n.style.flexDirection="column",n.style.gap="12px",n.style.padding="8px",n.style.maxHeight="60vh",n.style.overflowY="auto";let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="720px",r.style.margin="0 auto";for(let o of lm()){let s=e.card(`${o.icon} ${o.title}`,{tone:"muted",align:"stretch"});s.root.dataset.section=o.id,s.body.style.display="flex",s.body.style.flexDirection="column",s.body.style.gap="10px";let i=document.createElement("p");i.textContent=o.description,i.style.margin="0",i.style.fontSize="12px",i.style.opacity="0.78",s.body.appendChild(i);for(let a of o.actions){let l=kP(e,a);s.body.appendChild(l)}r.appendChild(s.root)}n.appendChild(r)}var IP="https://raw.githubusercontent.com/Ariedam64/MagicGarden-modMenu/refs/heads/main/rooms.json";function z0(){if(typeof GM_xmlhttpRequest=="function")return GM_xmlhttpRequest;if(typeof GM<"u"&&typeof GM.xmlHttpRequest=="function")return GM.xmlHttpRequest.bind(GM)}async function AP(t,e){let n=await fetch(t,{cache:"no-store",...e});if(!n.ok)throw new Error(`Failed to load remote resource: ${n.status} ${n.statusText}`);return await n.text()}async function j0(t,e){let n=z0();if(!n)throw new Error("GM_xmlhttpRequest not available");return await new Promise((r,o)=>{n({method:"GET",url:t,headers:e?.headers,onload:s=>{s.status>=200&&s.status<300?r(s.responseText??""):o(new Error(`GM_xmlhttpRequest failed: ${s.status}`))},onerror:s=>{o(new Error(s.error??"GM_xmlhttpRequest error"))},ontimeout:()=>o(new Error("GM_xmlhttpRequest timeout")),onabort:()=>o(new Error("GM_xmlhttpRequest aborted"))})})}async function MP(t,e){let n=Wn(),r=!!z0();if(n&&r)return await j0(t,e);try{return await AP(t,e)}catch(o){if(r)return await j0(t,e);throw o}}async function gp(){let t=await MP(IP);try{return JSON.parse(t)}catch(e){throw new Error("Failed to parse rooms JSON",{cause:e})}}async function U0(){try{let t=await gp();(Re?.console??console).log("[MagicGarden] Remote rooms:",t)}catch(t){console.error("[MagicGarden] Unable to retrieve rooms list:",t)}}var bp=6;function V0(t){let e=/^([a-zA-Z]+)/.exec(t);return e&&e[1]?e[1].toLowerCase():"other"}function PP(t,e=[]){let n=new Set(t.map(s=>s.category)),r=new Set,o=[];for(let s of e)n.has(s)&&(r.has(s)||(r.add(s),o.push(s)));for(let s of t)r.has(s.category)||(r.add(s.category),o.push(s.category));return o}function Y0(t,e=[]){let n=t.map(r=>({...r}));return{definitions:n,categoryOrder:PP(n,e)}}function $0(t){return{definitions:t.definitions.map(e=>({...e})),categoryOrder:[...t.categoryOrder]}}var RP=Y0([]),$l=$0(RP),bo="idle",yp=null;function _P(t){if(!t||typeof t!="object")return null;let e=t.publicRooms;if(!e||typeof e!="object")return null;let n=[],r=[];for(let[o,s]of Object.entries(e)){if(!Array.isArray(s)||!s.length)continue;let i=typeof o=="string"?o.trim():"";if(i){r.includes(i)||r.push(i);for(let a of s){if(typeof a!="string")continue;let l=a.indexOf(":");if(l<=0)continue;let c=a.slice(0,l).trim(),d=a.slice(l+1).trim();!c||!d||n.push({name:c,idRoom:d,category:i})}}}return n.length?Y0(n,r):null}function LP(t){$l=$0(t)}function vp(){return bo==="pending"||bo==="fulfilled"||bo==="rejected"?yp:typeof window>"u"?null:(bo="pending",yp=(async()=>{try{let t=await gp(),e=_P(t);e&&LP(e),bo="fulfilled"}catch(t){bo="rejected",console.warn("[MagicGarden] Unable to load remote rooms list",t)}})(),yp)}async function NP(){let t=vp();t&&await t}var J0="mg.customRooms";function Q0(){if(typeof window>"u")return null;try{return window.localStorage}catch{return null}}function OP(t){if(!t)return null;let e=typeof t.name=="string"?t.name.trim():"",n=typeof t.idRoom=="string"?t.idRoom.trim():"";return!e||!n?null:{name:e,idRoom:n,category:V0(e)}}function qP(){let t=Q0();if(!t)return[];try{let e=t.getItem(J0);if(!e)return[];let n=JSON.parse(e);if(!Array.isArray(n))return[];let r=[];for(let o of n){let s=OP(o);s&&r.push(s)}return r}catch{return[]}}function DP(t){let e=Q0();if(e)try{let n=t.map(r=>({name:r.name,idRoom:r.idRoom}));e.setItem(J0,JSON.stringify(n))}catch{}}var ti=null;function Yl(){return ti||(ti=qP()),ti.map(t=>({...t}))}function G0(t){ti=t.map(e=>({...e})),DP(ti)}function vo(t){return t.trim().toLowerCase()}function K0(t){let e=Date.now();return Promise.all(t.map(async n=>{try{let r=await Og(n.idRoom,{endpoint:"info",timeoutMs:1e4});if(!r.ok)throw new Error(`HTTP ${r.status}`);let o=r.parsed??(()=>{try{return JSON.parse(r.body)}catch{return}})(),s=BP(typeof o?.numPlayers=="number"?o.numPlayers:0),i=bp,a=typeof o?.currentGame=="string"&&o.currentGame.trim().length?o.currentGame.trim():void 0,l=typeof o?.hostPlayerId=="string"&&o.hostPlayerId.trim().length?o.hostPlayerId.trim():void 0,c=FP(o?.players,l);return{...n,players:s,capacity:i,isFull:s>=i,lastUpdatedAt:e,currentGame:a,hostPlayerId:l,playerDetails:c}}catch(r){let o=HP(r);return{...n,players:0,capacity:bp,isFull:!1,lastUpdatedAt:e,hostPlayerId:void 0,playerDetails:[],error:o}}}))}function BP(t){return Number.isFinite(t)?Math.max(0,Math.min(bp,Math.floor(t))):0}function FP(t,e){if(!Array.isArray(t))return[];let n=[];for(let r of t){if(!r||typeof r!="object")continue;let o=typeof r.id=="string"&&r.id.trim().length?r.id.trim():void 0,s=typeof r.databaseUserId=="string"&&r.databaseUserId.trim().length?r.databaseUserId.trim():void 0,a=(typeof r.name=="string"?r.name.trim():"")||"Unknown player",l=typeof r.isConnected=="boolean"?r.isConnected:!1,c=typeof r.discordAvatarUrl=="string"&&r.discordAvatarUrl.trim().length?r.discordAvatarUrl.trim():void 0;n.push({id:o,databaseUserId:s,name:a,isConnected:l,discordAvatarUrl:c,isHost:!!(e&&(o===e||s===e))})}return n}function HP(t){if(!t)return"Erreur inconnue.";if(typeof t=="string")return t;if(t instanceof Error)return t.message||"Erreur inconnue.";try{return JSON.stringify(t)}catch{return String(t)}}var st={getPublicRooms(){return vp(),$l.definitions.map(t=>({...t}))},getPublicRoomsCategoryOrder(){return vp(),[...$l.categoryOrder]},getCustomRooms(){return Yl()},addCustomRoom(t){let e=typeof t.name=="string"?t.name.trim():"",n=typeof t.idRoom=="string"?t.idRoom.trim():"";if(!e)return{ok:!1,error:"Room name is required."};if(!n)return{ok:!1,error:"Room identifier is required."};let r=vo(e),o=vo(n),s=[...this.getPublicRooms(),...Yl()];if(s.some(l=>vo(l.idRoom)===o))return{ok:!1,error:"This room already exists."};if(s.some(l=>vo(l.name)===r))return{ok:!1,error:"A room with this name already exists."};let i={name:e,idRoom:n,category:V0(e)},a=[...Yl(),i];return G0(a),{ok:!0,room:{...i}}},removeCustomRoom(t){let e=vo(t),n=Yl(),r=n.filter(o=>vo(o.idRoom)!==e);return r.length===n.length?!1:(G0(r),!0)},async fetchPublicRoomsStatus(){await NP();let t=$l.definitions.map(e=>({...e}));return K0(t)},async fetchCustomRoomsStatus(){let t=this.getCustomRooms();return t.length?K0(t):[]},canJoinPublicRoom(t){return!(t.error||t.isFull||this.isDiscordActivity())},isDiscordActivity(){return Wn()},joinPublicRoom(t){let e=Dg(t.idRoom,{siteFallbackOnDiscord:!0,preferSoft:!1});return e.ok,e}};var Z0="mc-room-menu-loading-style";function wp(){if(document.getElementById(Z0))return;let t=document.createElement("style");t.id=Z0,t.textContent=`
@keyframes room-menu-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

.qmm.qmm-room-menu .qmm-tab[data-id="public-rooms"],
.qmm.qmm-room-menu .qmm-tab[data-id="search-player"] {
  flex: 0 1 auto;
  min-width: 160px;
}
`,document.head.appendChild(t)}var WP="public-rooms",jP="custom-rooms",zP="search-player";async function X0(t){let e=new Ye({id:"room",compact:!0,windowSelector:".qws-win",classes:"qmm-room-menu"});e.addTab(WP,"\u{1F310} Public Rooms",n=>UP(n,e)),e.addTab(jP,"\u2B50 Custom Rooms",n=>GP(n,e)),e.addTab(zP,"\u{1F50D} Search Player",n=>KP(n,e)),e.mount(t)}function UP(t,e){t.innerHTML="",wp();let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.padding="12px",n.style.boxSizing="border-box",n.style.height="100%",n.style.minHeight="0",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="640px",r.style.height="100%",r.style.gridTemplateRows="max-content max-content 1fr max-content",n.appendChild(r);let o=document.createElement("div");if(o.textContent="Select a public room to quickly join a game.",o.style.fontSize="14px",o.style.opacity="0.9",r.appendChild(o),st.isDiscordActivity()){let B=document.createElement("div");B.textContent="You are using Discord: direct join is disabled. Open the official website to join a room.",B.style.fontSize="13px",B.style.lineHeight="1.4",B.style.padding="10px 12px",B.style.borderRadius="8px",B.style.background="#2e1f1f",B.style.color="#ffb4a2",B.style.border="1px solid rgba(255, 140, 105, 0.35)",r.appendChild(B)}let s=document.createElement("div");s.style.display="flex",s.style.flexWrap="wrap",s.style.alignItems="center",s.style.gap="8px",s.style.margin="12px 0 6px",s.style.width="100%",r.appendChild(s);let i=document.createElement("div");i.style.height="54vh",i.style.maxHeight="54vh",i.style.overflowY="auto",i.style.padding="6px 2px",i.style.borderRadius="10px",i.style.background="rgba(12, 13, 20, 0.65)",i.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.04)",i.style.width="100%",i.style.boxSizing="border-box",i.style.position="relative";let a=document.createElement("div");a.style.position="absolute",a.style.top="14px",a.style.right="14px",a.style.width="28px",a.style.height="28px",a.style.borderRadius="999px",a.style.display="flex",a.style.alignItems="center",a.style.justifyContent="center",a.style.background="rgba(14, 16, 25, 0.9)",a.style.border="1px solid rgba(255, 255, 255, 0.08)",a.style.boxShadow="0 10px 24px rgba(0, 0, 0, 0.45)",a.style.opacity="0",a.style.visibility="hidden",a.style.pointerEvents="none",a.style.transition="opacity 160ms ease, transform 160ms ease",a.style.zIndex="3";let l=document.createElement("div");l.style.width="16px",l.style.height="16px",l.style.borderRadius="999px",l.style.border="2px solid rgba(248, 250, 252, 0.16)",l.style.borderTopColor="#f8fafc",l.style.animation="room-menu-spin 1s linear infinite",a.appendChild(l);let c=document.createElement("div");c.style.display="grid",c.style.gap="10px",c.style.padding="4px",i.appendChild(c),i.appendChild(a),r.appendChild(i);let d=()=>{a.style.transform=`translateY(${i.scrollTop}px)`},u=!1,p=B=>{B?(u=!0,d(),a.style.visibility="visible",a.style.opacity="1"):(u=!1,a.style.opacity="0",a.addEventListener("transitionend",()=>{u||(a.style.visibility="hidden")},{once:!0}),window.setTimeout(()=>{u||(a.style.visibility="hidden")},220))},f=0;i.addEventListener("scroll",()=>{f=i.scrollTop,u&&d()});let h=!1,m=0,g=!0,y=null,v="any",w=[],x=new Map,E=[],L=document.createElement("div");L.style.display="flex",L.style.flexWrap="wrap",L.style.alignItems="center",L.style.gap="8px",s.appendChild(L);let P=e.btn("Refresh rooms",{size:"sm",icon:"\u{1F504}"});P.style.flexShrink="0",P.setAttribute("aria-label","Refresh public rooms list");let V=document.createElement("div");V.style.display="flex",V.style.alignItems="center",V.style.gap="8px",V.style.marginLeft="auto",s.appendChild(V);let z=document.createElement("div");z.style.fontSize="12px",z.style.opacity="0.75",z.style.marginLeft="auto",z.style.textAlign="right",z.textContent="Loading rooms\u2026";let C=document.createElement("div");C.style.display="flex",C.style.alignItems="center",C.style.gap="12px",C.style.marginTop="8px",C.style.width="100%",C.appendChild(P),C.appendChild(z),r.appendChild(C);let D=!1,S=()=>{let B=!h&&!D;e.setButtonEnabled(P,B),P.setAttribute("aria-busy",D?"true":"false")},G=()=>{for(let[B,O]of x){let b=B===y;O.dataset.active=b?"true":"false",O.setAttribute("aria-pressed",b?"true":"false"),O.style.opacity=b?"1":"0.7"}},se=B=>{switch(v){case"any":return!0;case"empty":return B.players===0;case"few":return B.players>0&&B.players<=3;case"crowded":return!B.isFull&&B.players>=4;case"full":return B.isFull;default:return!0}},X=B=>{y!==B&&(y=B,f=0,G(),A(w))};function ue(B,O){let b=e.btn(B,{size:"sm",variant:"ghost"});return b.addEventListener("click",()=>{X(O===null||y===O?null:O)}),b}function N(B){if(!B)return[];let O=new Set,b=[];for(let M of B){if(!M||typeof M.category!="string")continue;let _=M.category.trim();!_||O.has(_)||(O.add(_),b.push(_))}return b}function ee(B){if(!B.length)return[];let O=st.getPublicRoomsCategoryOrder();if(!O.length)return[...B];let b=new Set(B),M=[],_=new Set;for(let k of O)b.has(k)&&!_.has(k)&&(M.push(k),_.add(k));for(let k of B)_.has(k)||(M.push(k),_.add(k));return M}function q(B){let O=N(B),b=O.length?O:N(st.getPublicRooms()),M=ee(b);if(x.size===0||M.length!==E.length||M.some((k,T)=>k!==E[T])){y&&!M.includes(y)&&(y=null,f=0),L.innerHTML="",x.clear();let k=ue("All",null);x.set(null,k),L.appendChild(k);for(let T of M){let F=ue(T,T);x.set(T,F),L.appendChild(F)}E=[...M]}G()}q();let A=B=>{w=B,q(B),c.innerHTML="";let O=B.filter(b=>!(y!==null&&b.category!==y||!se(b)));if(O.length)for(let b of O)c.appendChild(Sp(b,e));else{let b=document.createElement("div");b.textContent=B.length?"No rooms match the selected filter.":"No public rooms available.",b.style.padding="16px",b.style.textAlign="center",b.style.opacity="0.7",c.appendChild(b)}requestAnimationFrame(()=>{let b=Math.max(0,i.scrollHeight-i.clientHeight),M=Math.min(f,b);i.scrollTop=M,f=M})},te=document.createElement("div");te.style.display="flex",te.style.alignItems="center",te.style.gap="6px",te.style.padding="4px 6px",te.style.background="rgba(24, 26, 36, 0.85)",te.style.borderRadius="10px",te.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.05)";let ne=document.createElement("span");ne.textContent="Players",ne.style.fontSize="12px",ne.style.opacity="0.75",ne.style.paddingLeft="2px",te.appendChild(ne);let Z=document.createElement("select");Z.style.background="rgba(17, 18, 27, 0.95)",Z.style.border="1px solid rgba(255, 255, 255, 0.08)",Z.style.color="#f8fafc",Z.style.borderRadius="8px",Z.style.padding="4px 10px",Z.style.fontSize="12px",Z.style.fontWeight="500",Z.style.outline="none",Z.style.cursor="pointer",Z.style.minWidth="130px";let me=[{value:"any",label:"Any players"},{value:"empty",label:"Empty rooms"},{value:"few",label:"1 \u2013 3 players"},{value:"crowded",label:"4 \u2013 5 players"},{value:"full",label:"Full rooms"}];for(let B of me){let O=document.createElement("option");O.value=B.value,O.textContent=B.label,Z.appendChild(O)}Z.value=v,Z.addEventListener("change",()=>{v=Z.value,f=0,A(w)}),te.appendChild(Z),V.appendChild(te);let Q=async()=>{if(h)return;let B=++m;D=!0,S(),p(!0),z.textContent=g?"Loading rooms\u2026":"Refreshing rooms\u2026";try{let O=await st.fetchPublicRoomsStatus();if(h||B!==m)return;A(O);let b=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});z.textContent=`Last update: ${b}`}catch(O){if(h||B!==m)return;z.textContent=`Failed to load rooms: ${String(O?.message||O)}`}finally{!h&&B===m&&p(!1),B===m&&(D=!1),S(),g=!1}};P.addEventListener("click",()=>{Q()}),S(),Q();let oe=t.closest(".qws-win"),W=B=>!B.classList.contains("is-hidden")&&getComputedStyle(B).display!=="none",U=null;if(oe){let B=W(oe);U=new MutationObserver(()=>{if(h)return;let O=W(oe);O&&!B&&Q(),B=O}),U.observe(oe,{attributes:!0,attributeFilter:["class","style"]})}let J=t.__cleanup__;t.__cleanup__=()=>{if(h=!0,U?.disconnect(),S(),typeof J=="function")try{J.call(t)}catch{}}}function GP(t,e){t.innerHTML="",wp();let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.padding="12px",n.style.boxSizing="border-box",n.style.height="100%",n.style.minHeight="0",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="640px",r.style.height="100%",r.style.maxHeight="100%",r.style.minHeight="0",r.style.gridTemplateRows="max-content max-content max-content 1fr max-content",n.appendChild(r);let o=document.createElement("div");o.textContent="Save your favourite rooms and access them quickly.",o.style.fontSize="14px",o.style.opacity="0.9",r.appendChild(o);let s=document.createElement("div");s.style.display="grid",s.style.gap="10px",s.style.padding="16px",s.style.borderRadius="12px",s.style.background="rgba(20, 22, 32, 0.95)",s.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.05)",r.appendChild(s);let i=document.createElement("div");i.textContent="Add a custom room",i.style.fontWeight="600",i.style.fontSize="14px",s.appendChild(i);let a=document.createElement("form");a.style.display="grid",a.style.gap="10px",s.appendChild(a);let l=document.createElement("div");l.style.display="grid",l.style.gap="10px",l.style.gridTemplateColumns="minmax(180px, 1fr) minmax(160px, 1fr) auto",l.style.alignItems="center",a.appendChild(l);let c=document.createElement("input");c.type="text",c.placeholder="Room name",c.required=!0,c.style.background="rgba(15, 16, 24, 0.95)",c.style.border="1px solid rgba(148, 163, 184, 0.25)",c.style.borderRadius="10px",c.style.padding="10px 12px",c.style.fontSize="13px",c.style.color="#f8fafc",c.style.width="100%",c.autocomplete="off",l.appendChild(c);let d=document.createElement("input");d.type="text",d.placeholder="Room code",d.required=!0,d.style.background="rgba(15, 16, 24, 0.95)",d.style.border="1px solid rgba(148, 163, 184, 0.25)",d.style.borderRadius="10px",d.style.padding="10px 12px",d.style.fontSize="13px",d.style.color="#f8fafc",d.style.width="100%",d.autocomplete="off",l.appendChild(d);let u=e.btn("Add room",{size:"sm",variant:"primary"});u.type="submit",u.style.whiteSpace="nowrap",l.appendChild(u);let p=document.createElement("div");p.style.fontSize="12px",p.style.opacity="0.85",p.style.minHeight="16px",a.appendChild(p);let f=document.createElement("div");if(f.textContent="Custom rooms are stored locally in your browser.",f.style.fontSize="12px",f.style.opacity="0.65",s.appendChild(f),st.isDiscordActivity()){let b=document.createElement("div");b.textContent="You are using Discord: direct join is disabled. Open the official website to join a room.",b.style.fontSize="13px",b.style.lineHeight="1.4",b.style.padding="10px 12px",b.style.borderRadius="8px",b.style.background="#2e1f1f",b.style.color="#ffb4a2",b.style.border="1px solid rgba(255, 140, 105, 0.35)",r.appendChild(b)}let h=document.createElement("div");h.style.display="flex",h.style.flexWrap="wrap",h.style.alignItems="center",h.style.gap="8px",h.style.margin="12px 0 6px",h.style.width="100%",r.appendChild(h);let m=document.createElement("div");m.style.height="36vh",m.style.maxHeight="36vh",m.style.overflowY="auto",m.style.padding="6px 2px",m.style.borderRadius="10px",m.style.background="rgba(12, 13, 20, 0.65)",m.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.04)",m.style.width="100%",m.style.boxSizing="border-box",m.style.position="relative";let g=document.createElement("div");g.style.position="absolute",g.style.top="14px",g.style.right="14px",g.style.width="28px",g.style.height="28px",g.style.borderRadius="999px",g.style.display="flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.background="rgba(14, 16, 25, 0.9)",g.style.border="1px solid rgba(255, 255, 255, 0.08)",g.style.boxShadow="0 10px 24px rgba(0, 0, 0, 0.45)",g.style.opacity="0",g.style.visibility="hidden",g.style.pointerEvents="none",g.style.transition="opacity 160ms ease, transform 160ms ease",g.style.zIndex="3";let y=document.createElement("div");y.style.width="16px",y.style.height="16px",y.style.borderRadius="999px",y.style.border="2px solid rgba(248, 250, 252, 0.16)",y.style.borderTopColor="#f8fafc",y.style.animation="room-menu-spin 1s linear infinite",g.appendChild(y);let v=document.createElement("div");v.style.display="grid",v.style.gap="10px",v.style.padding="4px",m.appendChild(v),m.appendChild(g),r.appendChild(m);let w=()=>{g.style.transform=`translateY(${m.scrollTop}px)`},x=!1,E=b=>{b?(x=!0,w(),g.style.visibility="visible",g.style.opacity="1"):(x=!1,g.style.opacity="0",g.addEventListener("transitionend",()=>{x||(g.style.visibility="hidden")},{once:!0}),window.setTimeout(()=>{x||(g.style.visibility="hidden")},220))},L=e.btn("Refresh rooms",{size:"sm",icon:"\u{1F504}"});L.style.flexShrink="0",L.setAttribute("aria-label","Refresh custom rooms list");let P=document.createElement("div");P.style.fontSize="12px",P.style.opacity="0.75",P.textContent="Add a custom room to get started.";let V=document.createElement("div");V.style.display="flex",V.style.alignItems="center",V.style.gap="12px",V.style.marginTop="8px",V.style.width="100%",V.appendChild(L),V.appendChild(P),r.appendChild(V);let z=0;m.addEventListener("scroll",()=>{z=m.scrollTop,x&&w()});let C=!1,D=0,S=!0,G=null,se="any",X=[],ue=new Map,N=document.createElement("div");N.style.display="flex",N.style.flexWrap="wrap",N.style.alignItems="center",N.style.gap="8px",h.appendChild(N);let ee=()=>{for(let[b,M]of ue){let _=b===G;M.dataset.active=_?"true":"false",M.setAttribute("aria-pressed",_?"true":"false"),M.style.opacity=_?"1":"0.7"}},q=(b,M)=>{let _=e.btn(b,{size:"sm",variant:"ghost"});_.addEventListener("click",()=>{te(M===null||G===M?null:M)}),ue.set(M,_),N.appendChild(_)},A=b=>{let M=new Set;for(let F of b)F.category&&M.add(F.category);let _=Array.from(M),k=st.getPublicRoomsCategoryOrder();if(k.length){let F=new Map(k.map(($,K)=>[$,K]));_.sort(($,K)=>{let R=F.get($),Y=F.get(K);return R===void 0&&Y===void 0?$.localeCompare(K):R===void 0?1:Y===void 0?-1:R-Y})}else _.sort((F,$)=>F.localeCompare($));ue.clear(),N.innerHTML="",q("All",null);let T=G===null;for(let F of _)q(F,F),F===G&&(T=!0);T||(G=null),ee()},te=b=>{G!==b&&(G=b,z=0,ee(),Z(X))},ne=b=>{switch(se){case"any":return!0;case"empty":return b.players===0;case"few":return b.players>0&&b.players<=3;case"crowded":return!b.isFull&&b.players>=4;case"full":return b.isFull;default:return!0}},Z=b=>{X=b,v.innerHTML="";let M=b.filter(_=>!(G!==null&&_.category!==G||!ne(_)));if(M.length)for(let _ of M){let k=Sp(_,e,{onRemove:()=>{st.removeCustomRoom(_.idRoom)&&(z=0,B())}});v.appendChild(k)}else{let _=document.createElement("div"),k=st.getCustomRooms().length>0;_.textContent=k?"No rooms match the selected filter.":"No custom rooms yet. Add one above.",_.style.padding="16px",_.style.textAlign="center",_.style.opacity="0.7",v.appendChild(_)}requestAnimationFrame(()=>{let _=Math.max(0,m.scrollHeight-m.clientHeight),k=Math.min(z,_);m.scrollTop=k,z=k})},me=document.createElement("div");me.style.display="flex",me.style.alignItems="center",me.style.gap="6px",me.style.marginLeft="auto",me.style.padding="4px 6px",me.style.background="rgba(24, 26, 36, 0.85)",me.style.borderRadius="10px",me.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.05)";let Q=document.createElement("span");Q.textContent="Players",Q.style.fontSize="12px",Q.style.opacity="0.75",Q.style.paddingLeft="2px",me.appendChild(Q);let oe=document.createElement("select");oe.style.background="rgba(17, 18, 27, 0.95)",oe.style.border="1px solid rgba(255, 255, 255, 0.08)",oe.style.color="#f8fafc",oe.style.borderRadius="8px",oe.style.padding="4px 10px",oe.style.fontSize="12px",oe.style.fontWeight="500",oe.style.outline="none",oe.style.cursor="pointer",oe.style.minWidth="130px";let W=[{value:"any",label:"Any players"},{value:"empty",label:"Empty rooms"},{value:"few",label:"1 \u2013 3 players"},{value:"crowded",label:"4 \u2013 5 players"},{value:"full",label:"Full rooms"}];for(let b of W){let M=document.createElement("option");M.value=b.value,M.textContent=b.label,oe.appendChild(M)}oe.value=se,oe.addEventListener("change",()=>{se=oe.value,z=0,Z(X)}),me.appendChild(oe),h.appendChild(me);let U=!1,J=()=>{let b=!C&&!U;e.setButtonEnabled(L,b),L.setAttribute("aria-busy",U?"true":"false")};J();let B=()=>{A(st.getCustomRooms()),O()},O=async()=>{if(C)return;let b=st.getCustomRooms();if(A(b),!b.length){E(!1),X=[],Z([]),P.textContent="Add a custom room to get started.",U=!1,J(),S=!1;return}let M=++D;U=!0,J(),E(!0),P.textContent=S?"Loading rooms\u2026":"Refreshing rooms\u2026";try{let _=await st.fetchCustomRoomsStatus();if(C||M!==D)return;Z(_);let k=new Date().toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!0});P.textContent=`Last update: ${k}`}catch(_){if(C||M!==D)return;P.textContent=`Failed to load rooms: ${String(_?.message||_)}`}finally{!C&&M===D&&E(!1),M===D&&(U=!1),J(),S=!1}};L.addEventListener("click",()=>{O()}),a.addEventListener("submit",b=>{b.preventDefault();let M=st.addCustomRoom({name:c.value,idRoom:d.value});if(!M.ok){p.textContent=M.error,p.style.color="#fda4af";return}p.textContent=`Added room \u201C${M.room.name}\u201D.`,p.style.color="#86efac",c.value="",d.value="",c.focus(),B()}),A(st.getCustomRooms()),O(),t.__cleanup__=()=>{C=!0,J()}}function KP(t,e){t.innerHTML="",wp();let n=document.createElement("div");n.style.display="flex",n.style.flexDirection="column",n.style.alignItems="center",n.style.padding="12px",n.style.boxSizing="border-box",n.style.height="100%",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gap="12px",r.style.width="100%",r.style.maxWidth="640px",r.style.gridTemplateRows="max-content max-content max-content 1fr",r.style.height="100%",n.appendChild(r);let o=document.createElement("div");o.textContent="Search for a player across all available rooms.",o.style.fontSize="14px",o.style.opacity="0.9",r.appendChild(o);let s=document.createElement("div");s.textContent="Enter at least three characters to look for matching player names.",s.style.fontSize="12px",s.style.opacity="0.72",s.style.lineHeight="1.45",r.appendChild(s);let i=document.createElement("form");i.style.display="flex",i.style.flexWrap="wrap",i.style.alignItems="center",i.style.gap="8px",r.appendChild(i);let a=document.createElement("input");a.type="search",a.placeholder="Player name\u2026",a.autocomplete="off",a.spellcheck=!1,a.style.flex="1",a.style.minWidth="200px",a.style.padding="10px 12px",a.style.borderRadius="10px",a.style.border="1px solid rgba(255, 255, 255, 0.08)",a.style.background="rgba(17, 18, 27, 0.95)",a.style.color="#f8fafc",a.style.fontSize="13px",a.style.fontWeight="500",a.style.outline="none",a.style.boxShadow="0 6px 16px rgba(15, 23, 42, 0.45)",i.appendChild(a);let l=e.btn("Search",{size:"sm",icon:"\u{1F50D}",variant:"primary"});l.type="submit",l.style.flexShrink="0",l.title="Search for a player across rooms",i.appendChild(l);let c=document.createElement("div");c.style.fontSize="12px",c.style.opacity="0.75",c.style.minHeight="18px",c.textContent="Enter a player name to search across rooms.",r.appendChild(c);let d=document.createElement("div");d.style.height="54vh",d.style.maxHeight="54vh",d.style.overflowY="auto",d.style.padding="6px 2px",d.style.borderRadius="10px",d.style.background="rgba(12, 13, 20, 0.65)",d.style.boxShadow="inset 0 0 0 1px rgba(255, 255, 255, 0.04)",d.style.width="100%",d.style.boxSizing="border-box",d.style.position="relative";let u=document.createElement("div");u.style.position="absolute",u.style.top="14px",u.style.right="14px",u.style.width="28px",u.style.height="28px",u.style.borderRadius="999px",u.style.display="flex",u.style.alignItems="center",u.style.justifyContent="center",u.style.background="rgba(14, 16, 25, 0.9)",u.style.border="1px solid rgba(255, 255, 255, 0.08)",u.style.boxShadow="0 10px 24px rgba(0, 0, 0, 0.45)",u.style.opacity="0",u.style.visibility="hidden",u.style.pointerEvents="none",u.style.transition="opacity 160ms ease, transform 160ms ease",u.style.zIndex="3";let p=document.createElement("div");p.style.width="16px",p.style.height="16px",p.style.borderRadius="999px",p.style.border="2px solid rgba(248, 250, 252, 0.16)",p.style.borderTopColor="#f8fafc",p.style.animation="room-menu-spin 1s linear infinite",u.appendChild(p);let f=document.createElement("div");f.style.display="grid",f.style.gap="10px",f.style.padding="4px",d.appendChild(f),d.appendChild(u),r.appendChild(d);let h=C=>{f.innerHTML="";let D=document.createElement("div");D.textContent=C,D.style.padding="16px",D.style.textAlign="center",D.style.opacity="0.7",D.style.fontSize="13px",f.appendChild(D)};h("Search results will appear here.");let m=()=>{u.style.transform=`translateY(${d.scrollTop}px)`},g=!1,y=C=>{C?(g=!0,m(),u.style.visibility="visible",u.style.opacity="1"):(g=!1,u.style.opacity="0",u.addEventListener("transitionend",()=>{g||(u.style.visibility="hidden")},{once:!0}),window.setTimeout(()=>{g||(u.style.visibility="hidden")},220))};d.addEventListener("scroll",()=>{g&&m()});let v=!1,w=!1,x=0,E="",L=()=>{let C=a.value.trim().length>=3;e.setButtonEnabled(l,C&&!v),l.setAttribute("aria-busy",v?"true":"false")},P=C=>{let D=C.trim();if(!D)return"";try{return D.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase()}catch{return D.toLowerCase()}},V=C=>{let D=new Set,S=new Set,G=new Set;for(let se of C)se.id&&D.add(se.id),se.databaseUserId&&S.add(se.databaseUserId),G.add(P(se.name));return se=>se.id&&D.has(se.id)||se.databaseUserId&&S.has(se.databaseUserId)?!0:G.has(P(se.name))},z=async C=>{let D=C.trim(),S=P(D);if(!S){c.textContent="Enter a player name to search across rooms.",h("Search results will appear here."),E="";return}if(D.length<3){c.textContent="Please enter at least three characters.",h("Type a longer name to search for players."),E="";return}let G=++x;v=!0,L(),y(!0),c.textContent="Searching players\u2026";try{let[se,X]=await Promise.all([st.fetchPublicRoomsStatus(),st.fetchCustomRoomsStatus().catch(()=>[])]);if(w||G!==x)return;let ue=[...se,...X],N=new Map;for(let Z of ue){let me=Array.isArray(Z.playerDetails)?Z.playerDetails:[];if(!me.length)continue;let Q=me.filter(oe=>P(oe.name).includes(S));if(Q.length){let oe=N.get(Z.idRoom);if(oe)for(let W of Q)oe.players.some(J=>W.id&&J.id&&W.id===J.id||W.databaseUserId&&J.databaseUserId&&W.databaseUserId===J.databaseUserId?!0:P(J.name)===P(W.name))||oe.players.push(W);else N.set(Z.idRoom,{room:Z,players:[...Q]})}}let ee=Array.from(N.values());if(!ee.length){c.textContent=`No player found matching \u201C${D}\u201D.`,h("No rooms contain a player with this name."),E=D;return}ee.sort((Z,me)=>{let Q=Z.players.filter(W=>W.isConnected).length,oe=me.players.filter(W=>W.isConnected).length;return Q!==oe?oe-Q:Z.players.length!==me.players.length?me.players.length-Z.players.length:Z.room.name.localeCompare(me.room.name)});let q=ee.reduce((Z,me)=>Z+me.players.length,0),A=ee.length===1?"room":"rooms",te=q===1?"player":"players";c.textContent=`Found ${q} ${te} in ${ee.length} ${A}.`,f.innerHTML="";let ne=!0;for(let Z of ee){let me=V(Z.players),Q=Sp(Z.room,e,{highlightPlayers:me,defaultDetailsOpen:!0,scrollHighlightedPlayersIntoView:ne});f.appendChild(Q),ne=!1}E=D}catch(se){if(w||G!==x)return;let X=se?.message||String(se);c.textContent=`Search failed: ${X}`,h("Unable to complete the search. Please try again.")}finally{!w&&G===x&&(v=!1,y(!1),L())}};i.addEventListener("submit",C=>{C.preventDefault(),z(a.value)}),a.addEventListener("input",()=>{L();let C=a.value.trim();!C&&E?(c.textContent="Enter a player name to search across rooms.",h("Search results will appear here."),E=""):!v&&C.length>0&&C.length<3&&(c.textContent="Type at least three characters to start a search.")}),L(),t.__cleanup__=()=>{w=!0}}function VP(){let t=/^\/r\/([^/]+)/.exec(location.pathname);if(!t)return null;try{return decodeURIComponent(t[1])}catch{return t[1]}}function Sp(t,e,n){let r=st.isDiscordActivity(),s=VP()===t.idRoom,i=Array.isArray(t.playerDetails)?t.playerDetails:[],a=document.createElement("div");a.style.display="grid",a.style.gap="8px",a.style.padding="14px 16px",a.style.borderRadius="14px",a.style.background="linear-gradient(135deg, rgba(30, 33, 46, 0.95), rgba(18, 19, 28, 0.95))",a.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.35)",a.style.position="relative";let l=document.createElement("div");l.style.overflow="hidden",l.style.maxHeight="0",l.style.opacity="0",l.style.transition="max-height 0.25s ease, opacity 0.2s ease, margin-top 0.2s ease",l.style.marginTop="0";let c=document.createElement("div");c.style.display="grid",c.style.gap="10px",c.style.paddingTop="12px",c.style.paddingLeft="6px",c.style.paddingRight="6px",c.style.paddingBottom="4px",c.style.borderTop="1px solid rgba(148, 163, 184, 0.16)",l.appendChild(c);let d=document.createElement("div");d.textContent="Players",d.style.fontSize="13px",d.style.fontWeight="600",d.style.letterSpacing="0.02em",d.style.color="#e2e8f0",c.appendChild(d);let u=[];if(i.length){let N=document.createElement("ul");N.style.listStyle="none",N.style.margin="0",N.style.padding="0",N.style.display="grid",N.style.gap="10px",N.style.gridTemplateColumns="repeat(2, minmax(0, 1fr))";for(let ee of i){let q=document.createElement("li");q.style.display="flex",q.style.alignItems="center",q.style.gap="12px",q.style.padding="6px 0";let A=document.createElement("div");if(A.style.width="36px",A.style.height="36px",A.style.borderRadius="999px",A.style.overflow="hidden",A.style.flexShrink="0",A.style.display="grid",A.style.placeItems="center",A.style.border="1px solid rgba(148, 163, 184, 0.25)",A.style.background="linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(14, 165, 233, 0.2))",ee.discordAvatarUrl){let W=document.createElement("img");W.src=ee.discordAvatarUrl,W.alt=`${ee.name}'s avatar`,W.loading="lazy",W.style.width="100%",W.style.height="100%",W.style.objectFit="cover",A.appendChild(W)}else{let W=document.createElement("span");W.textContent=ee.name.charAt(0)?.toUpperCase()||"?",W.style.fontWeight="600",W.style.fontSize="14px",W.style.color="#e2e8f0",A.appendChild(W)}let te=document.createElement("div");te.style.display="grid",te.style.gap="4px";let ne=document.createElement("div");ne.style.display="flex",ne.style.alignItems="center",ne.style.gap="8px";let Z=document.createElement("div");if(Z.textContent=ee.name,Z.style.fontWeight="600",Z.style.fontSize="14px",Z.style.color="#f8fafc",ne.appendChild(Z),ee.isHost){let W=document.createElement("span");W.textContent="Host",W.style.fontSize="10px",W.style.letterSpacing="0.06em",W.style.textTransform="uppercase",W.style.padding="2px 6px",W.style.borderRadius="999px",W.style.fontWeight="600",W.style.color="#facc15",W.style.background="rgba(250, 204, 21, 0.18)",W.style.border="1px solid rgba(250, 204, 21, 0.32)",ne.appendChild(W)}let me=document.createElement("div");me.style.display="flex",me.style.alignItems="center",me.style.gap="10px",me.style.fontSize="11px",me.style.color="rgba(226, 232, 240, 0.75)";let Q=document.createElement("span");Q.style.display="inline-flex",Q.style.alignItems="center",Q.style.gap="6px";let oe=document.createElement("span");oe.style.width="8px",oe.style.height="8px",oe.style.borderRadius="999px",oe.style.background=ee.isConnected?"#34d399":"#f97316",Q.appendChild(oe),Q.append(ee.isConnected?"Online":"Offline"),me.appendChild(Q),te.append(ne,me),q.append(A,te),n?.highlightPlayers?.(ee)&&(q.style.background="rgba(34, 197, 94, 0.12)",q.style.borderRadius="12px",q.style.padding="10px",q.style.margin="-2px",q.style.boxShadow="inset 0 0 0 1px rgba(34, 197, 94, 0.35)",A.style.border="1px solid rgba(74, 222, 128, 0.65)",Z.style.color="#bbf7d0",me.style.color="rgba(190, 242, 100, 0.85)",oe.style.background="#4ade80",q.dataset.highlightedPlayer="true",u.push(q)),N.appendChild(q)}c.appendChild(N)}else{let N=document.createElement("div");N.textContent=t.error?"Player details unavailable.":"No player details available.",N.style.fontSize="12px",N.style.color="rgba(226, 232, 240, 0.7)",c.appendChild(N)}let p=t.error?"rgba(248, 180, 127, 0.9)":t.isFull?"rgba(248, 113, 113, 0.85)":t.players<=5?"rgba(74, 222, 128, 0.75)":"rgba(96, 165, 250, 0.45)";a.style.setProperty("--accent-color",p),a.style.outline="2px solid transparent",a.style.outlineOffset="0",a.style.border="1px solid rgba(255, 255, 255, 0.05)",a.style.boxShadow="0 10px 20px rgba(0, 0, 0, 0.35), inset 0 0 0 1px rgba(255, 255, 255, 0.04), 0 0 0 2px var(--accent-color)";let f=document.createElement("div");f.style.display="flex",f.style.flexWrap="wrap",f.style.alignItems="center",f.style.justifyContent="space-between",f.style.gap="12px";let h=document.createElement("div");h.style.display="grid",h.style.gap="6px";let m=document.createElement("div");m.style.display="flex",m.style.alignItems="center",m.style.gap="10px";let g=document.createElement("div");g.textContent=t.name,g.style.fontWeight="600",g.style.fontSize="16px",g.style.letterSpacing="0.01em",g.style.color="#f8fafc";let y=document.createElement("span");if(y.textContent=t.category,y.style.fontSize="11px",y.style.letterSpacing="0.08em",y.style.textTransform="uppercase",y.style.padding="4px 8px",y.style.borderRadius="999px",y.style.background="rgba(148, 163, 184, 0.12)",y.style.border="1px solid rgba(148, 163, 184, 0.22)",y.style.color="#cbd5f5",m.append(g,y),h.appendChild(m),t.currentGame&&t.currentGame.toLowerCase()!=="quinoa"){let N=document.createElement("div");N.textContent=t.currentGame,N.style.fontSize="12px",N.style.opacity="0.7",N.style.color="#e0f2fe",h.appendChild(N)}let v=document.createElement("div");v.style.display="grid",v.style.gap="6px",v.style.minWidth="120px";let w=document.createElement("div");w.style.position="relative",w.style.height="20px",w.style.borderRadius="999px",w.style.background="rgba(255, 255, 255, 0.08)",w.style.overflow="hidden",w.style.display="flex",w.style.alignItems="center",w.style.justifyContent="center",w.style.fontWeight="600",w.style.fontSize="12px",w.style.color="#f8fafc",w.style.fontVariantNumeric="tabular-nums",w.style.textShadow="0 1px 2px rgba(0, 0, 0, 0.55)";let x=document.createElement("div");x.style.position="absolute",x.style.left="0",x.style.top="0",x.style.bottom="0",x.style.height="100%",x.style.width=`${Math.min(100,t.players/t.capacity*100)}%`,x.style.background=t.isFull?"linear-gradient(90deg, #ef4444, #f87171)":"linear-gradient(90deg, #34d399, #2dd4bf)",x.style.borderRadius="inherit",w.appendChild(x);let E=document.createElement("span");E.textContent=`${t.players} / ${t.capacity} players`,E.style.position="relative",E.style.zIndex="1",w.appendChild(E),v.appendChild(w);let L=document.createElement("div");L.style.display="grid",L.style.justifyItems="end",L.style.gap="6px";let P=document.createElement("span");P.textContent="\u25BE",P.style.display="inline-block",P.style.transition="transform 0.2s ease",P.style.transform="rotate(-90deg)";let V=e.btn("Details",{size:"sm",variant:"ghost",icon:P});V.style.minWidth="86px",V.style.justifyContent="center",V.title=i.length?"Show the players currently in this room.":t.error?"Player details unavailable.":"No player details available.",L.appendChild(V);let z=e.btn("Join",{size:"sm",variant:"primary"});if(z.style.minWidth="86px",z.style.boxShadow="0 4px 10px rgba(56, 189, 248, 0.35)",L.appendChild(z),n?.onRemove){let N=e.btn("Remove",{size:"sm",variant:"danger"});N.style.minWidth="86px",N.addEventListener("click",ee=>{ee.stopPropagation(),n.onRemove?.()}),N.title=`Remove ${t.name} from custom rooms`,L.appendChild(N)}let C=[];t.error&&C.push("Status unavailable"),t.isFull&&C.push("Room is full"),r&&C.push("Join is blocked on Discord"),s&&C.push("Already in this room");let D=!s&&st.canJoinPublicRoom(t);e.setButtonEnabled(z,D),z.title=D?`Join ${t.name}`:C.join(" \xB7 "),z.addEventListener("click",()=>{s||st.canJoinPublicRoom(t)&&st.joinPublicRoom(t)});let S=V.querySelector(".label"),G=n?.defaultDetailsOpen??!1,se=()=>{if(G){let N=`${c.scrollHeight}px`;l.style.maxHeight=N,l.style.opacity="1",l.style.marginTop="8px",V.setAttribute("aria-expanded","true"),S&&(S.textContent="Hide details"),P.style.transform="rotate(0deg)"}else l.style.maxHeight="0",l.style.opacity="0",l.style.marginTop="0",V.setAttribute("aria-expanded","false"),S&&(S.textContent="Details"),P.style.transform="rotate(-90deg)"};V.addEventListener("click",()=>{G=!G,se()}),f.append(h,v,L),a.appendChild(f);let X=document.createElement("div");X.style.display="flex",X.style.flexWrap="wrap",X.style.gap="6px";let ue=(N,ee,q)=>{let A=document.createElement("span");A.textContent=N,A.style.fontSize="11px",A.style.padding="4px 8px",A.style.borderRadius="999px",A.style.fontWeight="600",A.style.letterSpacing="0.04em",A.style.textTransform="uppercase",A.style.color=ee,A.style.background=q,A.style.border=`1px solid ${ee}33`,X.appendChild(A)};return s&&ue("Current room","#86efac","rgba(34, 197, 94, 0.12)"),t.error&&ue("Status unavailable","#fbbf24","rgba(250, 204, 21, 0.1)"),r&&ue("Discord activity","#facc15","rgba(251, 191, 36, 0.12)"),X.childElementCount>0&&a.appendChild(X),a.appendChild(l),se(),(G||n?.scrollHighlightedPlayersIntoView)&&window.requestAnimationFrame(()=>{if(G&&(se(),n?.scrollHighlightedPlayersIntoView&&u.length)){let N=u[0];window.requestAnimationFrame(()=>{N.scrollIntoView({block:"nearest",behavior:"smooth"})})}}),a}var ev=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>(Kn(),wr)).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)};var ni=class extends Error{constructor(e,n="FunctionsError",r){super(e),this.name=n,this.context=r}},ri=class extends ni{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}},oi=class extends ni{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}},si=class extends ni{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}},Jl;(function(t){t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2"})(Jl||(Jl={}));var ZP=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},ii=class{constructor(e,{headers:n={},customFetch:r,region:o=Jl.Any}={}){this.url=e,this.headers=n,this.region=o,this.fetch=ev(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,n={}){var r;return ZP(this,void 0,void 0,function*(){try{let{headers:o,method:s,body:i,signal:a}=n,l={},{region:c}=n;c||(c=this.region);let d=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,d.searchParams.set("forceFunctionRegion",c));let u;i&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&i instanceof Blob||i instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",u=i):typeof i=="string"?(l["Content-Type"]="text/plain",u=i):typeof FormData<"u"&&i instanceof FormData?u=i:(l["Content-Type"]="application/json",u=JSON.stringify(i)));let p=yield this.fetch(d.toString(),{method:s||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),o),body:u,signal:a}).catch(g=>{throw g.name==="AbortError"?g:new ri(g)}),f=p.headers.get("x-relay-error");if(f&&f==="true")throw new oi(p);if(!p.ok)throw new si(p);let h=((r=p.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),m;return h==="application/json"?m=yield p.json():h==="application/octet-stream"?m=yield p.blob():h==="text/event-stream"?m=p:h==="multipart/form-data"?m=yield p.formData():m=yield p.text(),{data:m,error:null,response:p}}catch(o){return o instanceof Error&&o.name==="AbortError"?{data:null,error:new ri(o)}:{data:null,error:o,response:o instanceof si||o instanceof oi?o.context:void 0}}})}};var uv=Xp(dv(),1),{PostgrestClient:pv,PostgrestQueryBuilder:KO,PostgrestFilterBuilder:VO,PostgrestTransformBuilder:YO,PostgrestBuilder:$O,PostgrestError:lR}=uv.default;var Op=class{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){let n=process.versions;if(n&&n.node){let r=n.node,o=parseInt(r.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){let e=this.detectEnvironment();if(e.constructor)return e.constructor;let n=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(n+=`

Suggested solution: ${e.workaround}`),new Error(n)}static createWebSocket(e,n){let r=this.getWebSocketConstructor();return new r(e,n)}static isWebSocketSupported(){try{let e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}},qp=Op;var fv="2.15.5";var mv=`realtime-js/${fv}`,hv="1.0.0";var fi=1e4,gv=1e3,yv=100,xo;(function(t){t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed"})(xo||(xo={}));var it;(function(t){t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving"})(it||(it={}));var Dt;(function(t){t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token"})(Dt||(Dt={}));var Zl;(function(t){t.websocket="websocket"})(Zl||(Zl={}));var Vn;(function(t){t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed"})(Vn||(Vn={}));var mi=class{constructor(){this.HEADER_LENGTH=1}decode(e,n){return e.constructor===ArrayBuffer?n(this._binaryDecode(e)):n(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){let n=new DataView(e),r=new TextDecoder;return this._decodeBroadcast(e,n,r)}_decodeBroadcast(e,n,r){let o=n.getUint8(1),s=n.getUint8(2),i=this.HEADER_LENGTH+2,a=r.decode(e.slice(i,i+o));i=i+o;let l=r.decode(e.slice(i,i+s));i=i+s;let c=JSON.parse(r.decode(e.slice(i,e.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var Sr=class{constructor(e,n){this.callback=e,this.timerCalc=n,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=n}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Ze;(function(t){t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange"})(Ze||(Ze={}));var Bp=(t,e,n={})=>{var r;let o=(r=n.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(e).reduce((s,i)=>(s[i]=cR(i,t,e,o),s),{})},cR=(t,e,n,r)=>{let o=e.find(a=>a.name===t),s=o?.type,i=n[t];return s&&!r.includes(s)?bv(s,i):Dp(i)},bv=(t,e)=>{if(t.charAt(0)==="_"){let n=t.slice(1,t.length);return fR(e,n)}switch(t){case Ze.bool:return dR(e);case Ze.float4:case Ze.float8:case Ze.int2:case Ze.int4:case Ze.int8:case Ze.numeric:case Ze.oid:return uR(e);case Ze.json:case Ze.jsonb:return pR(e);case Ze.timestamp:return mR(e);case Ze.abstime:case Ze.date:case Ze.daterange:case Ze.int4range:case Ze.int8range:case Ze.money:case Ze.reltime:case Ze.text:case Ze.time:case Ze.timestamptz:case Ze.timetz:case Ze.tsrange:case Ze.tstzrange:return Dp(e);default:return Dp(e)}},Dp=t=>t,dR=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},uR=t=>{if(typeof t=="string"){let e=parseFloat(t);if(!Number.isNaN(e))return e}return t},pR=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(e){return console.log(`JSON parse error: ${e}`),t}return t},fR=(t,e)=>{if(typeof t!="string")return t;let n=t.length-1,r=t[n];if(t[0]==="{"&&r==="}"){let s,i=t.slice(1,n);try{s=JSON.parse("["+i+"]")}catch{s=i?i.split(","):[]}return s.map(a=>bv(e,a))}return t},mR=t=>typeof t=="string"?t.replace(" ","T"):t,Xl=t=>{let e=t;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};var xr=class{constructor(e,n,r={},o=fi){this.channel=e,this.event=n,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,n){var r;return this._hasReceived(e)&&n((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:e,callback:n}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=n=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=n,this._matchReceive(n)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,n){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:n})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:n}){this.recHooks.filter(r=>r.status===e).forEach(r=>r.callback(n))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}};var Fp;(function(t){t.SYNC="sync",t.JOIN="join",t.LEAVE="leave"})(Fp||(Fp={}));var Eo=class t{constructor(e,n){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=n?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:s,onLeave:i,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,s,i),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,s,i)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:s,onLeave:i,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,s,i),a())}),this.onJoin((o,s,i)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:s,newPresences:i})}),this.onLeave((o,s,i)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:s,leftPresences:i})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,n,r,o){let s=this.cloneDeep(e),i=this.transformState(n),a={},l={};return this.map(s,(c,d)=>{i[c]||(l[c]=d)}),this.map(i,(c,d)=>{let u=s[c];if(u){let p=d.map(g=>g.presence_ref),f=u.map(g=>g.presence_ref),h=d.filter(g=>f.indexOf(g.presence_ref)<0),m=u.filter(g=>p.indexOf(g.presence_ref)<0);h.length>0&&(a[c]=h),m.length>0&&(l[c]=m)}else a[c]=d}),this.syncDiff(s,{joins:a,leaves:l},r,o)}static syncDiff(e,n,r,o){let{joins:s,leaves:i}={joins:this.transformState(n.joins),leaves:this.transformState(n.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(s,(a,l)=>{var c;let d=(c=e[a])!==null&&c!==void 0?c:[];if(e[a]=this.cloneDeep(l),d.length>0){let u=e[a].map(f=>f.presence_ref),p=d.filter(f=>u.indexOf(f.presence_ref)<0);e[a].unshift(...p)}r(a,d,l)}),this.map(i,(a,l)=>{let c=e[a];if(!c)return;let d=l.map(u=>u.presence_ref);c=c.filter(u=>d.indexOf(u.presence_ref)<0),e[a]=c,o(a,c,l),c.length===0&&delete e[a]}),e}static map(e,n){return Object.getOwnPropertyNames(e).map(r=>n(r,e[r]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((n,r)=>{let o=e[r];return"metas"in o?n[r]=o.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):n[r]=o,n},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Hp;(function(t){t.ALL="*",t.INSERT="INSERT",t.UPDATE="UPDATE",t.DELETE="DELETE"})(Hp||(Hp={}));var Co;(function(t){t.BROADCAST="broadcast",t.PRESENCE="presence",t.POSTGRES_CHANGES="postgres_changes",t.SYSTEM="system"})(Co||(Co={}));var mn;(function(t){t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR"})(mn||(mn={}));var To=class t{constructor(e,n={config:{}},r){this.topic=e,this.params=n,this.socket=r,this.bindings={},this.state=it.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},n.config),this.timeout=this.socket.timeout,this.joinPush=new xr(this,Dt.join,this.params,this.timeout),this.rejoinTimer=new Sr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=it.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=it.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=it.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Dt.reply,{},(o,s)=>{this._trigger(this._replyEventName(s),o)}),this.presence=new Eo(this),this.broadcastEndpointURL=Xl(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,n=this.timeout){var r,o,s;if(this.socket.isConnected()||this.socket.connect(),this.state==it.closed){let{config:{broadcast:i,presence:a,private:l}}=this.params,c=(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(f=>f.filter))!==null&&o!==void 0?o:[],d=!!this.bindings[Co.PRESENCE]&&this.bindings[Co.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,u={},p={broadcast:i,presence:Object.assign(Object.assign({},a),{enabled:d}),postgres_changes:c,private:l};this.socket.accessTokenValue&&(u.access_token=this.socket.accessTokenValue),this._onError(f=>e?.(mn.CHANNEL_ERROR,f)),this._onClose(()=>e?.(mn.CLOSED)),this.updateJoinPayload(Object.assign({config:p},u)),this.joinedOnce=!0,this._rejoin(n),this.joinPush.receive("ok",async({postgres_changes:f})=>{var h;if(this.socket.setAuth(),f===void 0){e?.(mn.SUBSCRIBED);return}else{let m=this.bindings.postgres_changes,g=(h=m?.length)!==null&&h!==void 0?h:0,y=[];for(let v=0;v<g;v++){let w=m[v],{filter:{event:x,schema:E,table:L,filter:P}}=w,V=f&&f[v];if(V&&V.event===x&&V.schema===E&&V.table===L&&V.filter===P)y.push(Object.assign(Object.assign({},w),{id:V.id}));else{this.unsubscribe(),this.state=it.errored,e?.(mn.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=y,e&&e(mn.SUBSCRIBED);return}}).receive("error",f=>{this.state=it.errored,e?.(mn.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(f).join(", ")||"error")))}).receive("timeout",()=>{e?.(mn.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,n={}){return await this.send({type:"presence",event:"track",payload:e},n.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,n,r){return this.state===it.joined&&e===Co.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,n,r)}async send(e,n={}){var r,o;if(!this._canPush()&&e.type==="broadcast"){let{event:s,payload:i}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:i,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=n.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var i,a,l;let c=this._push(e.type,e,n.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(a=(i=this.params)===null||i===void 0?void 0:i.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&s("ok"),c.receive("ok",()=>s("ok")),c.receive("error",()=>s("error")),c.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=it.leaving;let n=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Dt.close,"leave",this._joinRef())};this.joinPush.destroy();let r=null;return new Promise(o=>{r=new xr(this,Dt.leave,{},e),r.receive("ok",()=>{n(),o("ok")}).receive("timeout",()=>{n(),o("timed out")}).receive("error",()=>{o("error")}),r.send(),this._canPush()||r.trigger("ok",{})}).finally(()=>{r?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=it.closed,this.bindings={}}async _fetchWithTimeout(e,n,r){let o=new AbortController,s=setTimeout(()=>o.abort(),r),i=await this.socket.fetch(e,Object.assign(Object.assign({},n),{signal:o.signal}));return clearTimeout(s),i}_push(e,n,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new xr(this,e,n,r);return this._canPush()?o.send():this._addToPushBuffer(o),o}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>yv){let n=this.pushBuffer.shift();n&&(n.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${n.event}`,n.payload))}}_onMessage(e,n,r){return n}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,n,r){var o,s;let i=e.toLocaleLowerCase(),{close:a,error:l,leave:c,join:d}=Dt;if(r&&[a,l,c,d].indexOf(i)>=0&&r!==this._joinRef())return;let p=this._onMessage(i,n,r);if(n&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(i)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var h,m,g;return((h=f.filter)===null||h===void 0?void 0:h.event)==="*"||((g=(m=f.filter)===null||m===void 0?void 0:m.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===i}).map(f=>f.callback(p,r)):(s=this.bindings[i])===null||s===void 0||s.filter(f=>{var h,m,g,y,v,w;if(["broadcast","presence","postgres_changes"].includes(i))if("id"in f){let x=f.id,E=(h=f.filter)===null||h===void 0?void 0:h.event;return x&&((m=n.ids)===null||m===void 0?void 0:m.includes(x))&&(E==="*"||E?.toLocaleLowerCase()===((g=n.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let x=(v=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return x==="*"||x===((w=n?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===i}).map(f=>{if(typeof p=="object"&&"ids"in p){let h=p.data,{schema:m,table:g,commit_timestamp:y,type:v,errors:w}=h;p=Object.assign(Object.assign({},{schema:m,table:g,commit_timestamp:y,eventType:v,new:{},old:{},errors:w}),this._getPayloadRecords(h))}f.callback(p,r)})}_isClosed(){return this.state===it.closed}_isJoined(){return this.state===it.joined}_isJoining(){return this.state===it.joining}_isLeaving(){return this.state===it.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,n,r){let o=e.toLocaleLowerCase(),s={type:o,filter:n,callback:r};return this.bindings[o]?this.bindings[o].push(s):this.bindings[o]=[s],this}_off(e,n){let r=e.toLocaleLowerCase();return this.bindings[r]&&(this.bindings[r]=this.bindings[r].filter(o=>{var s;return!(((s=o.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===r&&t.isEqual(o.filter,n))})),this}static isEqual(e,n){if(Object.keys(e).length!==Object.keys(n).length)return!1;for(let r in e)if(e[r]!==n[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(Dt.close,{},e)}_onError(e){this._on(Dt.error,{},n=>e(n))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=it.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let n={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(n.new=Bp(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(n.old=Bp(e.columns,e.old_record)),n}};var Wp=()=>{},ec={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},gR=[1e3,2e3,5e3,1e4],yR=1e4,bR=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,ko=class{constructor(e,n){var r;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=fi,this.transport=null,this.heartbeatIntervalMs=ec.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Wp,this.ref=0,this.reconnectTimer=null,this.logger=Wp,this.conn=null,this.sendBuffer=[],this.serializer=new mi,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=o=>{let s;return o?s=o:typeof fetch>"u"?s=(...i)=>Promise.resolve().then(()=>(Kn(),wr)).then(({default:a})=>a(...i)).catch(a=>{throw new Error(`Failed to load @supabase/node-fetch: ${a.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):s=fetch,(...i)=>s(...i)},!(!((r=n?.params)===null||r===void 0)&&r.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=n.params.apikey,this.endPoint=`${e}/${Zl.websocket}`,this.httpEndpoint=Xl(e),this._initializeOptions(n),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(n?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=qp.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");let n=e.message;throw n.includes("Node.js")?new Error(`${n}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${n}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:hv}))}disconnect(e,n){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){let r=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(r),this._setConnectionState("disconnected")},e?this.conn.close(e,n??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){let n=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),n}async removeAllChannels(){let e=await Promise.all(this.channels.map(n=>n.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,n,r){this.logger(e,n,r)}connectionState(){switch(this.conn&&this.conn.readyState){case xo.connecting:return Vn.Connecting;case xo.open:return Vn.Open;case xo.closing:return Vn.Closing;default:return Vn.Closed}}isConnected(){return this.connectionState()===Vn.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,n={config:{}}){let r=`realtime:${e}`,o=this.getChannels().find(s=>s.topic===r);if(o)return o;{let s=new To(`realtime:${e}`,n,this);return this.channels.push(s),s}}push(e){let{topic:n,event:r,payload:o,ref:s}=e,i=()=>{this.encode(e,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${n} ${r} (${s})`,o),this.isConnected()?i():this.sendBuffer.push(i)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(n){this.log("error","error in heartbeat callback",n)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(n){this.log("error","error in heartbeat callback",n)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(gv,"heartbeat timeout"),setTimeout(()=>{var n;this.isConnected()||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout()},ec.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(n){this.log("error","error in heartbeat callback",n)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let n=this.channels.find(r=>r.topic===e&&(r._isJoined()||r._isJoining()));n&&(this.log("transport",`leaving duplicate topic "${e}"`),n.unsubscribe())}_remove(e){this.channels=this.channels.filter(n=>n.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,n=>{if(n.topic==="phoenix"&&n.event==="phx_reply")try{this.heartbeatCallback(n.payload.status==="ok"?"ok":"error")}catch(c){this.log("error","error in heartbeat callback",c)}n.ref&&n.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);let{topic:r,event:o,payload:s,ref:i}=n,a=i?`(${i})`:"",l=s.status||"";this.log("receive",`${l} ${r} ${o} ${a}`.trim(),s),this.channels.filter(c=>c._isMember(r)).forEach(c=>c._trigger(o,s,i)),this._triggerStateCallbacks("message",n)})}_clearTimer(e){var n;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((n=this.reconnectTimer)===null||n===void 0||n.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=n=>{this.log("worker","worker error",n.message),this.workerRef.terminate()},this.workerRef.onmessage=n=>{n.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var n;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(n=this.reconnectTimer)===null||n===void 0||n.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(Dt.error))}_appendParams(e,n){if(Object.keys(n).length===0)return e;let r=e.match(/\?/)?"&":"?",o=new URLSearchParams(n);return`${e}${r}${o}`}_workerObjectUrl(e){let n;if(e)n=e;else{let r=new Blob([bR],{type:"application/javascript"});n=URL.createObjectURL(r)}return n}_setConnectionState(e,n=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=n)}async _performAuth(e=null){let n;e?n=e:this.accessToken?n=await this.accessToken():n=this.accessTokenValue,this.accessTokenValue!=n&&(this.accessTokenValue=n,this.channels.forEach(r=>{let o={access_token:n,version:mv};n&&r.updateJoinPayload(o),r.joinedOnce&&r._isJoined()&&r._push(Dt.access_token,{access_token:n})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(n=>{this.log("error",`error setting auth in ${e}`,n)})}_triggerStateCallbacks(e,n){try{this.stateChangeCallbacks[e].forEach(r=>{try{r(n)}catch(o){this.log("error",`error in ${e} callback`,o)}})}catch(r){this.log("error",`error triggering ${e} callbacks`,r)}}_setupReconnectionTimer(){this.reconnectTimer=new Sr(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ec.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var n,r,o,s,i,a,l,c,d;if(this.transport=(n=e?.transport)!==null&&n!==void 0?n:null,this.timeout=(r=e?.timeout)!==null&&r!==void 0?r:fi,this.heartbeatIntervalMs=(o=e?.heartbeatIntervalMs)!==null&&o!==void 0?o:ec.HEARTBEAT_INTERVAL,this.worker=(s=e?.worker)!==null&&s!==void 0?s:!1,this.accessToken=(i=e?.accessToken)!==null&&i!==void 0?i:null,this.heartbeatCallback=(a=e?.heartbeatCallback)!==null&&a!==void 0?a:Wp,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(l=e?.reconnectAfterMs)!==null&&l!==void 0?l:u=>gR[u-1]||yR,this.encode=(c=e?.encode)!==null&&c!==void 0?c:(u,p)=>p(JSON.stringify(u)),this.decode=(d=e?.decode)!==null&&d!==void 0?d:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}};var Io=class extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}};function tt(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var tc=class extends Io{constructor(e,n,r){super(e),this.name="StorageApiError",this.status=n,this.statusCode=r}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},Er=class extends Io{constructor(e,n){super(e),this.name="StorageUnknownError",this.originalError=n}};var vR=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},rc=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>(Kn(),wr)).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},vv=()=>vR(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Promise.resolve().then(()=>(Kn(),wr))).Response:Response}),nc=t=>{if(Array.isArray(t))return t.map(n=>nc(n));if(typeof t=="function"||t!==Object(t))return t;let e={};return Object.entries(t).forEach(([n,r])=>{let o=n.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[o]=nc(r)}),e},wv=t=>{if(typeof t!="object"||t===null)return!1;let e=Object.getPrototypeOf(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)};var Cr=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},jp=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),wR=(t,e,n)=>Cr(void 0,void 0,void 0,function*(){let r=yield vv();t instanceof r&&!n?.noResolveJson?t.json().then(o=>{let s=t.status||500,i=o?.statusCode||s+"";e(new tc(jp(o),s,i))}).catch(o=>{e(new Er(jp(o),o))}):e(new Er(jp(t),t))}),SR=(t,e,n,r)=>{let o={method:t,headers:e?.headers||{}};return t==="GET"||!r?o:(wv(r)?(o.headers=Object.assign({"Content-Type":"application/json"},e?.headers),o.body=JSON.stringify(r)):o.body=r,e?.duplex&&(o.duplex=e.duplex),Object.assign(Object.assign({},o),n))};function hi(t,e,n,r,o,s){return Cr(this,void 0,void 0,function*(){return new Promise((i,a)=>{t(n,SR(e,r,o,s)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>i(l)).catch(l=>wR(l,a,r))})})}function Ao(t,e,n,r){return Cr(this,void 0,void 0,function*(){return hi(t,"GET",e,n,r)})}function Ut(t,e,n,r,o){return Cr(this,void 0,void 0,function*(){return hi(t,"POST",e,r,o,n)})}function gi(t,e,n,r,o){return Cr(this,void 0,void 0,function*(){return hi(t,"PUT",e,r,o,n)})}function Sv(t,e,n,r){return Cr(this,void 0,void 0,function*(){return hi(t,"HEAD",e,Object.assign(Object.assign({},n),{noResolveJson:!0}),r)})}function oc(t,e,n,r,o){return Cr(this,void 0,void 0,function*(){return hi(t,"DELETE",e,r,o,n)})}var xR=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},yi=class{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}then(e,n){return this.execute().then(e,n)}execute(){return xR(this,void 0,void 0,function*(){try{return{data:(yield this.downloadFn()).body,error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(tt(e))return{data:null,error:e};throw e}})}};var ER=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},bi=class{constructor(e,n){this.downloadFn=e,this.shouldThrowOnError=n}asStream(){return new yi(this.downloadFn,this.shouldThrowOnError)}then(e,n){return this.execute().then(e,n)}execute(){return ER(this,void 0,void 0,function*(){try{return{data:yield(yield this.downloadFn()).blob(),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(tt(e))return{data:null,error:e};throw e}})}};var At=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},CR={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},xv={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},vi=class{constructor(e,n={},r,o){this.shouldThrowOnError=!1,this.url=e,this.headers=n,this.bucketId=r,this.fetch=rc(o)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,n,r,o){return At(this,void 0,void 0,function*(){try{let s,i=Object.assign(Object.assign({},xv),o),a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(i.upsert)}),l=i.metadata;typeof Blob<"u"&&r instanceof Blob?(s=new FormData,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l)),s.append("",r)):typeof FormData<"u"&&r instanceof FormData?(s=r,s.append("cacheControl",i.cacheControl),l&&s.append("metadata",this.encodeMetadata(l))):(s=r,a["cache-control"]=`max-age=${i.cacheControl}`,a["content-type"]=i.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(n),d=this._getFinalPath(c),u=yield(e=="PUT"?gi:Ut)(this.fetch,`${this.url}/object/${d}`,s,Object.assign({headers:a},i?.duplex?{duplex:i.duplex}:{}));return{data:{path:c,id:u.Id,fullPath:u.Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(tt(s))return{data:null,error:s};throw s}})}upload(e,n,r){return At(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,n,r)})}uploadToSignedUrl(e,n,r,o){return At(this,void 0,void 0,function*(){let s=this._removeEmptyFolders(e),i=this._getFinalPath(s),a=new URL(this.url+`/object/upload/sign/${i}`);a.searchParams.set("token",n);try{let l,c=Object.assign({upsert:xv.upsert},o),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,d["cache-control"]=`max-age=${c.cacheControl}`,d["content-type"]=c.contentType);let u=yield gi(this.fetch,a.toString(),l,{headers:d});return{data:{path:s,fullPath:u.Key},error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(tt(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,n){return At(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),o=Object.assign({},this.headers);n?.upsert&&(o["x-upsert"]="true");let s=yield Ut(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),i=new URL(this.url+s.url),a=i.searchParams.get("token");if(!a)throw new Io("No token returned by API");return{data:{signedUrl:i.toString(),path:e,token:a},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}})}update(e,n,r){return At(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,n,r)})}move(e,n,r){return At(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(tt(o))return{data:null,error:o};throw o}})}copy(e,n,r){return At(this,void 0,void 0,function*(){try{return{data:{path:(yield Ut(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:n,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(tt(o))return{data:null,error:o};throw o}})}createSignedUrl(e,n,r){return At(this,void 0,void 0,function*(){try{let o=this._getFinalPath(e),s=yield Ut(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:n},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return s={signedUrl:encodeURI(`${this.url}${s.signedURL}${i}`)},{data:s,error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(tt(o))return{data:null,error:o};throw o}})}createSignedUrls(e,n,r){return At(this,void 0,void 0,function*(){try{let o=yield Ut(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:n,paths:e},{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(i=>Object.assign(Object.assign({},i),{signedUrl:i.signedURL?encodeURI(`${this.url}${i.signedURL}${s}`):null})),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(tt(o))return{data:null,error:o};throw o}})}download(e,n){let o=typeof n?.transform<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString(n?.transform||{}),i=s?`?${s}`:"",a=this._getFinalPath(e),l=()=>Ao(this.fetch,`${this.url}/${o}/${a}${i}`,{headers:this.headers,noResolveJson:!0});return new bi(l,this.shouldThrowOnError)}info(e){return At(this,void 0,void 0,function*(){let n=this._getFinalPath(e);try{let r=yield Ao(this.fetch,`${this.url}/object/info/${n}`,{headers:this.headers});return{data:nc(r),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}})}exists(e){return At(this,void 0,void 0,function*(){let n=this._getFinalPath(e);try{return yield Sv(this.fetch,`${this.url}/object/${n}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r)&&r instanceof Er){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(e,n){let r=this._getFinalPath(e),o=[],s=n?.download?`download=${n.download===!0?"":n.download}`:"";s!==""&&o.push(s);let a=typeof n?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(n?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(e){return At(this,void 0,void 0,function*(){try{return{data:yield oc(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}})}list(e,n,r){return At(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},CR),n),{prefix:e||""});return{data:yield Ut(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(this.shouldThrowOnError)throw o;if(tt(o))return{data:null,error:o};throw o}})}listV2(e,n){return At(this,void 0,void 0,function*(){try{let r=Object.assign({},e);return{data:yield Ut(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,r,{headers:this.headers},n),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let n=[];return e.width&&n.push(`width=${e.width}`),e.height&&n.push(`height=${e.height}`),e.resize&&n.push(`resize=${e.resize}`),e.format&&n.push(`format=${e.format}`),e.quality&&n.push(`quality=${e.quality}`),n.join("&")}};var Ev="2.12.2";var Cv={"X-Client-Info":`storage-js/${Ev}`};var Mo=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},wi=class{constructor(e,n={},r,o){this.shouldThrowOnError=!1;let s=new URL(e);o?.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase.")),this.url=s.href,this.headers=Object.assign(Object.assign({},Cv),n),this.fetch=rc(r)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return Mo(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(tt(e))return{data:null,error:e};throw e}})}getBucket(e){return Mo(this,void 0,void 0,function*(){try{return{data:yield Ao(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}})}createBucket(e,n={public:!1}){return Mo(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:n.type,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}})}updateBucket(e,n){return Mo(this,void 0,void 0,function*(){try{return{data:yield gi(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:n.public,file_size_limit:n.fileSizeLimit,allowed_mime_types:n.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(tt(r))return{data:null,error:r};throw r}})}emptyBucket(e){return Mo(this,void 0,void 0,function*(){try{return{data:yield Ut(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}})}deleteBucket(e){return Mo(this,void 0,void 0,function*(){try{return{data:yield oc(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(tt(n))return{data:null,error:n};throw n}})}};var Si=class extends wi{constructor(e,n={},r,o){super(e,n,r,o)}from(e){return new vi(this.url,this.headers,e,this.fetch)}};var Tv="2.58.0";var xi="";typeof Deno<"u"?xi="deno":typeof document<"u"?xi="web":typeof navigator<"u"&&navigator.product==="ReactNative"?xi="react-native":xi="node";var TR={"X-Client-Info":`supabase-js-${xi}/${Tv}`},kv={headers:TR},Iv={schema:"public"},Av={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},Mv={};Kn();var kR=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},IR=t=>{let e;return t?e=t:typeof fetch>"u"?e=xp:e=fetch,(...n)=>e(...n)},AR=()=>typeof Headers>"u"?Ep:Headers,Pv=(t,e,n)=>{let r=IR(n),o=AR();return(s,i)=>kR(void 0,void 0,void 0,function*(){var a;let l=(a=yield e())!==null&&a!==void 0?a:t,c=new o(i?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(s,Object.assign(Object.assign({},i),{headers:c}))})};var MR=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})};function PR(t){return t.endsWith("/")?t:t+"/"}function Rv(t,e){var n,r;let{db:o,auth:s,realtime:i,global:a}=t,{db:l,auth:c,realtime:d,global:u}=e,p={db:Object.assign(Object.assign({},l),o),auth:Object.assign(Object.assign({},c),s),realtime:Object.assign(Object.assign({},d),i),storage:{},global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},(n=u?.headers)!==null&&n!==void 0?n:{}),(r=a?.headers)!==null&&r!==void 0?r:{})}),accessToken:()=>MR(this,void 0,void 0,function*(){return""})};return t.accessToken?p.accessToken=t.accessToken:delete p.accessToken,p}function _v(t){let e=t?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(PR(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var sc="2.72.0";var Tr=30*1e3,ic=3,ac=ic*Tr,Lv="http://localhost:9999",Nv="supabase.auth.token";var Ov={"X-Client-Info":`gotrue-js/${sc}`};var Ei="X-Supabase-Api-Version",zp={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},qv=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,Dv=10*60*1e3;var Ci=class extends Error{constructor(e,n,r){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=n,this.code=r}};function Le(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var lc=class extends Ci{constructor(e,n,r){super(e,n,r),this.name="AuthApiError",this.status=n,this.code=r}};function Bv(t){return Le(t)&&t.name==="AuthApiError"}var Po=class extends Ci{constructor(e,n){super(e),this.name="AuthUnknownError",this.originalError=n}},hn=class extends Ci{constructor(e,n,r,o){super(e,r,o),this.name=n,this.status=r}},Gt=class extends hn{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function Fv(t){return Le(t)&&t.name==="AuthSessionMissingError"}var Yn=class extends hn{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},kr=class extends hn{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}},Ir=class extends hn{constructor(e,n=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function Hv(t){return Le(t)&&t.name==="AuthImplicitGrantRedirectError"}var Ti=class extends hn{constructor(e,n=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=n}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Ro=class extends hn{constructor(e,n){super(e,"AuthRetryableFetchError",n,void 0)}};function cc(t){return Le(t)&&t.name==="AuthRetryableFetchError"}var ki=class extends hn{constructor(e,n,r){super(e,"AuthWeakPasswordError",n,"weak_password"),this.reasons=r}};var Ar=class extends hn{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}};var dc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Wv=` 	
\r=`.split(""),RR=(()=>{let t=new Array(128);for(let e=0;e<t.length;e+=1)t[e]=-1;for(let e=0;e<Wv.length;e+=1)t[Wv[e].charCodeAt(0)]=-2;for(let e=0;e<dc.length;e+=1)t[dc[e].charCodeAt(0)]=e;return t})();function jv(t,e,n){if(t!==null)for(e.queue=e.queue<<8|t,e.queuedBits+=8;e.queuedBits>=6;){let r=e.queue>>e.queuedBits-6&63;n(dc[r]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){let r=e.queue>>e.queuedBits-6&63;n(dc[r]),e.queuedBits-=6}}function zv(t,e,n){let r=RR[t];if(r>-1)for(e.queue=e.queue<<6|r,e.queuedBits+=6;e.queuedBits>=8;)n(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(r===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(t)}"`)}}function Up(t){let e=[],n=i=>{e.push(String.fromCodePoint(i))},r={utf8seq:0,codepoint:0},o={queue:0,queuedBits:0},s=i=>{NR(i,r,n)};for(let i=0;i<t.length;i+=1)zv(t.charCodeAt(i),o,s);return e.join("")}function _R(t,e){if(t<=127){e(t);return}else if(t<=2047){e(192|t>>6),e(128|t&63);return}else if(t<=65535){e(224|t>>12),e(128|t>>6&63),e(128|t&63);return}else if(t<=1114111){e(240|t>>18),e(128|t>>12&63),e(128|t>>6&63),e(128|t&63);return}throw new Error(`Unrecognized Unicode codepoint: ${t.toString(16)}`)}function LR(t,e){for(let n=0;n<t.length;n+=1){let r=t.charCodeAt(n);if(r>55295&&r<=56319){let o=(r-55296)*1024&65535;r=(t.charCodeAt(n+1)-56320&65535|o)+65536,n+=1}_R(r,e)}}function NR(t,e,n){if(e.utf8seq===0){if(t<=127){n(t);return}for(let r=1;r<6;r+=1)if(!(t>>7-r&1)){e.utf8seq=r;break}if(e.utf8seq===2)e.codepoint=t&31;else if(e.utf8seq===3)e.codepoint=t&15;else if(e.utf8seq===4)e.codepoint=t&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(t<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|t&63,e.utf8seq-=1,e.utf8seq===0&&n(e.codepoint)}}function Uv(t){let e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};for(let o=0;o<t.length;o+=1)zv(t.charCodeAt(o),n,r);return new Uint8Array(e)}function Gv(t){let e=[];return LR(t,n=>e.push(n)),new Uint8Array(e)}function Kv(t){let e=[],n={queue:0,queuedBits:0},r=o=>{e.push(o)};return t.forEach(o=>jv(o,n,r)),jv(null,n,r),e.join("")}function Vv(t){return Math.round(Date.now()/1e3)+t}function Yv(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let e=Math.random()*16|0;return(t=="x"?e:e&3|8).toString(16)})}var Bt=()=>typeof window<"u"&&typeof document<"u",Mr={tested:!1,writable:!1},uc=()=>{if(!Bt())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mr.tested)return Mr.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Mr.tested=!0,Mr.writable=!0}catch{Mr.tested=!0,Mr.writable=!1}return Mr.writable};function $v(t){let e={},n=new URL(t);if(n.hash&&n.hash[0]==="#")try{new URLSearchParams(n.hash.substring(1)).forEach((o,s)=>{e[s]=o})}catch{}return n.searchParams.forEach((r,o)=>{e[o]=r}),e}var pc=t=>{let e;return t?e=t:typeof fetch>"u"?e=(...n)=>Promise.resolve().then(()=>(Kn(),wr)).then(({default:r})=>r(...n)):e=fetch,(...n)=>e(...n)},Jv=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",Pr=async(t,e,n)=>{await t.setItem(e,JSON.stringify(n))},$n=async(t,e)=>{let n=await t.getItem(e);if(!n)return null;try{return JSON.parse(n)}catch{return n}},En=async(t,e)=>{await t.removeItem(e)},Ii=class t{constructor(){this.promise=new t.promiseConstructor((e,n)=>{this.resolve=e,this.reject=n})}};Ii.promiseConstructor=Promise;function fc(t){let e=t.split(".");if(e.length!==3)throw new Ar("Invalid JWT structure");for(let r=0;r<e.length;r++)if(!qv.test(e[r]))throw new Ar("JWT not in base64url format");return{header:JSON.parse(Up(e[0])),payload:JSON.parse(Up(e[1])),signature:Uv(e[2]),raw:{header:e[0],payload:e[1]}}}async function Qv(t){return await new Promise(e=>{setTimeout(()=>e(null),t)})}function Zv(t,e){return new Promise((r,o)=>{(async()=>{for(let s=0;s<1/0;s++)try{let i=await t(s);if(!e(s,null,i)){r(i);return}}catch(i){if(!e(s,i)){o(i);return}}})()})}function OR(t){return("0"+t.toString(16)).substr(-2)}function qR(){let e=new Uint32Array(56);if(typeof crypto>"u"){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=n.length,o="";for(let s=0;s<56;s++)o+=n.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(e),Array.from(e,OR).join("")}async function DR(t){let n=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",n),o=new Uint8Array(r);return Array.from(o).map(s=>String.fromCharCode(s)).join("")}async function BR(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let n=await DR(t);return btoa(n).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Rr(t,e,n=!1){let r=qR(),o=r;n&&(o+="/PASSWORD_RECOVERY"),await Pr(t,`${e}-code-verifier`,o);let s=await BR(r);return[s,r===s?"plain":"s256"]}var FR=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Xv(t){let e=t.headers.get(Ei);if(!e||!e.match(FR))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ew(t){if(!t)throw new Error("Missing exp claim");let e=Math.floor(Date.now()/1e3);if(t<=e)throw new Error("JWT has expired")}function tw(t){switch(t){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}var HR=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function _r(t){if(!HR.test(t))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function mc(){let t={};return new Proxy(t,{get:(e,n)=>{if(n==="__isUserNotAvailableProxy")return!0;if(typeof n=="symbol"){let r=n.toString();if(r==="Symbol(Symbol.toPrimitive)"||r==="Symbol(Symbol.toStringTag)"||r==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${n}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,n)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${n}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function Gp(t){return JSON.parse(JSON.stringify(t))}var WR=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n},Lr=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),jR=[502,503,504];async function nw(t){var e;if(!Jv(t))throw new Ro(Lr(t),0);if(jR.includes(t.status))throw new Ro(Lr(t),t.status);let n;try{n=await t.json()}catch(s){throw new Po(Lr(s),s)}let r,o=Xv(t);if(o&&o.getTime()>=zp["2024-01-01"].timestamp&&typeof n=="object"&&n&&typeof n.code=="string"?r=n.code:typeof n=="object"&&n&&typeof n.error_code=="string"&&(r=n.error_code),r){if(r==="weak_password")throw new ki(Lr(n),t.status,((e=n.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(r==="session_not_found")throw new Gt}else if(typeof n=="object"&&n&&typeof n.weak_password=="object"&&n.weak_password&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.reasons.reduce((s,i)=>s&&typeof i=="string",!0))throw new ki(Lr(n),t.status,n.weak_password.reasons);throw new lc(Lr(n),t.status||500,r)}var zR=(t,e,n,r)=>{let o={method:t,headers:e?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),n))};async function qe(t,e,n,r){var o;let s=Object.assign({},r?.headers);s[Ei]||(s[Ei]=zp["2024-01-01"].name),r?.jwt&&(s.Authorization=`Bearer ${r.jwt}`);let i=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(i.redirect_to=r.redirectTo);let a=Object.keys(i).length?"?"+new URLSearchParams(i).toString():"",l=await UR(t,e,n+a,{headers:s,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function UR(t,e,n,r,o,s){let i=zR(e,r,o,s),a;try{a=await t(n,Object.assign({},i))}catch(l){throw console.error(l),new Ro(Lr(l),0)}if(a.ok||await nw(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await nw(l)}}function nn(t){var e;let n=null;GR(t)&&(n=Object.assign({},t),t.expires_at||(n.expires_at=Vv(t.expires_in)));let r=(e=t.user)!==null&&e!==void 0?e:t;return{data:{session:n,user:r},error:null}}function Kp(t){let e=nn(t);return!e.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((n,r)=>n&&typeof r=="string",!0)&&(e.data.weak_password=t.weak_password),e}function gn(t){var e;return{data:{user:(e=t.user)!==null&&e!==void 0?e:t},error:null}}function rw(t){return{data:t,error:null}}function ow(t){let{action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s}=t,i=WR(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:n,hashed_token:r,redirect_to:o,verification_type:s},l=Object.assign({},i);return{data:{properties:a,user:l},error:null}}function sw(t){return t}function GR(t){return t.access_token&&t.refresh_token&&t.expires_in}var hc=["global","local","others"];var KR=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)e.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(n[r[o]]=t[r[o]]);return n},Nr=class{constructor({url:e="",headers:n={},fetch:r}){this.url=e,this.headers=n,this.fetch=pc(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,n=hc[0]){if(hc.indexOf(n)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${hc.join(", ")}`);try{return await qe(this.fetch,"POST",`${this.url}/logout?scope=${n}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}async inviteUserByEmail(e,n={}){try{return await qe(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:n.data},headers:this.headers,redirectTo:n.redirectTo,xform:gn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async generateLink(e){try{let{options:n}=e,r=KR(e,["options"]),o=Object.assign(Object.assign({},r),n);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await qe(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:ow,redirectTo:n?.redirectTo})}catch(n){if(Le(n))return{data:{properties:null,user:null},error:n};throw n}}async createUser(e){try{return await qe(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:gn})}catch(n){if(Le(n))return{data:{user:null},error:n};throw n}}async listUsers(e){var n,r,o,s,i,a,l;try{let c={nextPage:null,lastPage:0,total:0},d=await qe(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(n=e?.page)===null||n===void 0?void 0:n.toString())!==null&&r!==void 0?r:"",per_page:(s=(o=e?.perPage)===null||o===void 0?void 0:o.toString())!==null&&s!==void 0?s:""},xform:sw});if(d.error)throw d.error;let u=await d.json(),p=(i=d.headers.get("x-total-count"))!==null&&i!==void 0?i:0,f=(l=(a=d.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(h=>{let m=parseInt(h.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(h.split(";")[1].split("=")[1]);c[`${g}Page`]=m}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},u),c),error:null}}catch(c){if(Le(c))return{data:{users:[]},error:c};throw c}}async getUserById(e){_r(e);try{return await qe(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:gn})}catch(n){if(Le(n))return{data:{user:null},error:n};throw n}}async updateUserById(e,n){_r(e);try{return await qe(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:n,headers:this.headers,xform:gn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async deleteUser(e,n=!1){_r(e);try{return await qe(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:n},xform:gn})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async _listFactors(e){_r(e.userId);try{let{data:n,error:r}=await qe(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:n,error:r}}catch(n){if(Le(n))return{data:null,error:n};throw n}}async _deleteFactor(e){_r(e.userId),_r(e.id);try{return{data:await qe(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}}};function Vp(t={}){return{getItem:e=>t[e]||null,setItem:(e,n)=>{t[e]=n},removeItem:e=>{delete t[e]}}}function iw(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Or={debug:!!(globalThis&&uc()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Ai=class extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}},gc=class extends Ai{};async function Yp(t,e,n){Or.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,e);let r=new globalThis.AbortController;return e>0&&setTimeout(()=>{r.abort(),Or.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Or.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await n()}finally{Or.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(e===0)throw Or.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new gc(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Or.debug)try{let s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await n()}}))}function $p(t){if(!/^0x[a-fA-F0-9]{40}$/.test(t))throw new Error(`@supabase/auth-js: Address "${t}" is invalid.`);return t.toLowerCase()}function aw(t){return parseInt(t,16)}function lw(t){let e=new TextEncoder().encode(t);return"0x"+Array.from(e,r=>r.toString(16).padStart(2,"0")).join("")}function cw(t){var e;let{chainId:n,domain:r,expirationTime:o,issuedAt:s=new Date,nonce:i,notBefore:a,requestId:l,resources:c,scheme:d,uri:u,version:p}=t;{if(!Number.isInteger(n))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${n}`);if(!r)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(i&&i.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${i}`);if(!u)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(p!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${p}`);if(!((e=t.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${t.statement}`)}let f=$p(t.address),h=d?`${d}://${r}`:r,m=t.statement?`${t.statement}
`:"",g=`${h} wants you to sign in with your Ethereum account:
${f}

${m}`,y=`URI: ${u}
Version: ${p}
Chain ID: ${n}${i?`
Nonce: ${i}`:""}
Issued At: ${s.toISOString()}`;if(o&&(y+=`
Expiration Time: ${o.toISOString()}`),a&&(y+=`
Not Before: ${a.toISOString()}`),l&&(y+=`
Request ID: ${l}`),c){let v=`
Resources:`;for(let w of c){if(!w||typeof w!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${w}`);v+=`
- ${w}`}y+=v}return`${g}
${y}`}iw();var VR={url:Lv,storageKey:Nv,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Ov,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function dw(t,e,n){return await n()}var _o={},qr=class t{constructor(e){var n,r;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&Bt()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let o=Object.assign(Object.assign({},VR),e);if(this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.persistSession=o.persistSession,this.storageKey=o.storageKey,this.autoRefreshToken=o.autoRefreshToken,this.admin=new Nr({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=pc(o.fetch),this.lock=o.lock||dw,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,o.lock?this.lock=o.lock:Bt()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=Yp:this.lock=dw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:uc()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Vp(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=Vp(this.memoryStorage)),Bt()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(r=this.broadcastChannel)===null||r===void 0||r.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}get jwks(){var e,n;return(n=(e=_o[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&n!==void 0?n:{keys:[]}}set jwks(e){_o[this.storageKey]=Object.assign(Object.assign({},_o[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,n;return(n=(e=_o[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&n!==void 0?n:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){_o[this.storageKey]=Object.assign(Object.assign({},_o[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${sc}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let n=$v(window.location.href),r="none";if(this._isImplicitGrantCallback(n)?r="implicit":await this._isPKCECallback(n)&&(r="pkce"),Bt()&&this.detectSessionInUrl&&r!=="none"){let{data:o,error:s}=await this._getSessionFromURL(n,r);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),Hv(s)){let l=(e=s.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:i,redirectType:a}=o;return this._debug("#_initialize()","detected session in URL",i,"redirect type",a),await this._saveSession(i),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",i):await this._notifyAllSubscribers("SIGNED_IN",i)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(n){return Le(n)?{error:n}:{error:new Po("Unexpected error during initialization",n)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var n,r,o;try{let s=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(r=(n=e?.options)===null||n===void 0?void 0:n.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:(o=e?.options)===null||o===void 0?void 0:o.captchaToken}},xform:nn}),{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};let l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Le(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var n,r,o;try{let s;if("email"in e){let{email:d,password:u,options:p}=e,f=null,h=null;this.flowType==="pkce"&&([f,h]=await Rr(this.storage,this.storageKey)),s=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:p?.emailRedirectTo,body:{email:d,password:u,data:(n=p?.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:p?.captchaToken},code_challenge:f,code_challenge_method:h},xform:nn})}else if("phone"in e){let{phone:d,password:u,options:p}=e;s=await qe(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:u,data:(r=p?.data)!==null&&r!==void 0?r:{},channel:(o=p?.channel)!==null&&o!==void 0?o:"sms",gotrue_meta_security:{captcha_token:p?.captchaToken}},xform:nn})}else throw new kr("You must provide either an email or phone number and a password");let{data:i,error:a}=s;if(a||!i)return{data:{user:null,session:null},error:a};let l=i.session,c=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(s){if(Le(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let n;if("email"in e){let{email:s,password:i,options:a}=e;n=await qe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Kp})}else if("phone"in e){let{phone:s,password:i,options:a}=e;n=await qe(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:i,gotrue_meta_security:{captcha_token:a?.captchaToken}},xform:Kp})}else throw new kr("You must provide either an email or phone number and a password");let{data:r,error:o}=n;return o?{data:{user:null,session:null},error:o}:!r||!r.session||!r.user?{data:{user:null,session:null},error:new Yn}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign({user:r.user,session:r.session},r.weak_password?{weakPassword:r.weak_password}:null),error:o})}catch(n){if(Le(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOAuth(e){var n,r,o,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(n=e.options)===null||n===void 0?void 0:n.redirectTo,scopes:(r=e.options)===null||r===void 0?void 0:r.scopes,queryParams:(o=e.options)===null||o===void 0?void 0:o.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){let{chain:n}=e;switch(n){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${n}"`)}}async signInWithEthereum(e){var n,r,o,s,i,a,l,c,d,u,p;let f,h;if("message"in e)f=e.message,h=e.signature;else{let{chain:m,wallet:g,statement:y,options:v}=e,w;if(Bt())if(typeof g=="object")w=g;else{let z=window;if("ethereum"in z&&typeof z.ethereum=="object"&&"request"in z.ethereum&&typeof z.ethereum.request=="function")w=z.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof g!="object"||!v?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=g}let x=new URL((n=v?.url)!==null&&n!==void 0?n:window.location.href),E=await w.request({method:"eth_requestAccounts"}).then(z=>z).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!E||E.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");let L=$p(E[0]),P=(r=v?.signInWithEthereum)===null||r===void 0?void 0:r.chainId;if(!P){let z=await w.request({method:"eth_chainId"});P=aw(z)}let V={domain:x.host,address:L,statement:y,uri:x.href,version:"1",chainId:P,nonce:(o=v?.signInWithEthereum)===null||o===void 0?void 0:o.nonce,issuedAt:(i=(s=v?.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date,expirationTime:(a=v?.signInWithEthereum)===null||a===void 0?void 0:a.expirationTime,notBefore:(l=v?.signInWithEthereum)===null||l===void 0?void 0:l.notBefore,requestId:(c=v?.signInWithEthereum)===null||c===void 0?void 0:c.requestId,resources:(d=v?.signInWithEthereum)===null||d===void 0?void 0:d.resources};f=cw(V),h=await w.request({method:"personal_sign",params:[lw(f),L]})}try{let{data:m,error:g}=await qe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:f,signature:h},!((u=e.options)===null||u===void 0)&&u.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:nn});if(g)throw g;return!m||!m.session||!m.user?{data:{user:null,session:null},error:new Yn}:(m.session&&(await this._saveSession(m.session),await this._notifyAllSubscribers("SIGNED_IN",m.session)),{data:Object.assign({},m),error:g})}catch(m){if(Le(m))return{data:{user:null,session:null},error:m};throw m}}async signInWithSolana(e){var n,r,o,s,i,a,l,c,d,u,p,f;let h,m;if("message"in e)h=e.message,m=e.signature;else{let{chain:g,wallet:y,statement:v,options:w}=e,x;if(Bt())if(typeof y=="object")x=y;else{let L=window;if("solana"in L&&typeof L.solana=="object"&&("signIn"in L.solana&&typeof L.solana.signIn=="function"||"signMessage"in L.solana&&typeof L.solana.signMessage=="function"))x=L.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof y!="object"||!w?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");x=y}let E=new URL((n=w?.url)!==null&&n!==void 0?n:window.location.href);if("signIn"in x&&x.signIn){let L=await x.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w?.signInWithSolana),{version:"1",domain:E.host,uri:E.href}),v?{statement:v}:null)),P;if(Array.isArray(L)&&L[0]&&typeof L[0]=="object")P=L[0];else if(L&&typeof L=="object"&&"signedMessage"in L&&"signature"in L)P=L;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in P&&"signature"in P&&(typeof P.signedMessage=="string"||P.signedMessage instanceof Uint8Array)&&P.signature instanceof Uint8Array)h=typeof P.signedMessage=="string"?P.signedMessage:new TextDecoder().decode(P.signedMessage),m=P.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in x)||typeof x.signMessage!="function"||!("publicKey"in x)||typeof x!="object"||!x.publicKey||!("toBase58"in x.publicKey)||typeof x.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");h=[`${E.host} wants you to sign in with your Solana account:`,x.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${E.href}`,`Issued At: ${(o=(r=w?.signInWithSolana)===null||r===void 0?void 0:r.issuedAt)!==null&&o!==void 0?o:new Date().toISOString()}`,...!((s=w?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((i=w?.signInWithSolana)===null||i===void 0)&&i.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((a=w?.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((l=w?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((c=w?.signInWithSolana)===null||c===void 0)&&c.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((u=(d=w?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||u===void 0)&&u.length?["Resources",...w.signInWithSolana.resources.map(P=>`- ${P}`)]:[]].join(`
`);let L=await x.signMessage(new TextEncoder().encode(h),"utf8");if(!L||!(L instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=L}}try{let{data:g,error:y}=await qe(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:h,signature:Kv(m)},!((p=e.options)===null||p===void 0)&&p.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:nn});if(y)throw y;return!g||!g.session||!g.user?{data:{user:null,session:null},error:new Yn}:(g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:Object.assign({},g),error:y})}catch(g){if(Le(g))return{data:{user:null,session:null},error:g};throw g}}async _exchangeCodeForSession(e){let n=await $n(this.storage,`${this.storageKey}-code-verifier`),[r,o]=(n??"").split("/");try{let{data:s,error:i}=await qe(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:r},xform:nn});if(await En(this.storage,`${this.storageKey}-code-verifier`),i)throw i;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Yn}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:o??null}),error:i})}catch(s){if(Le(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:n,provider:r,token:o,access_token:s,nonce:i}=e,a=await qe(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:r,id_token:o,access_token:s,nonce:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},xform:nn}),{data:l,error:c}=a;return c?{data:{user:null,session:null},error:c}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new Yn}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:c})}catch(n){if(Le(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithOtp(e){var n,r,o,s,i;try{if("email"in e){let{email:a,options:l}=e,c=null,d=null;this.flowType==="pkce"&&([c,d]=await Rr(this.storage,this.storageKey));let{error:u}=await qe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(n=l?.data)!==null&&n!==void 0?n:{},create_user:(r=l?.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:c,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){let{phone:a,options:l}=e,{data:c,error:d}=await qe(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(o=l?.data)!==null&&o!==void 0?o:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(i=l?.channel)!==null&&i!==void 0?i:"sms"}});return{data:{user:null,session:null,messageId:c?.message_id},error:d}}throw new kr("You must provide either an email or phone number.")}catch(a){if(Le(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var n,r;try{let o,s;"options"in e&&(o=(n=e.options)===null||n===void 0?void 0:n.redirectTo,s=(r=e.options)===null||r===void 0?void 0:r.captchaToken);let{data:i,error:a}=await qe(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:o,xform:nn});if(a)throw a;if(!i)throw new Error("An error occurred on token verification.");let l=i.session,c=i.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:c,session:l},error:null}}catch(o){if(Le(o))return{data:{user:null,session:null},error:o};throw o}}async signInWithSSO(e){var n,r,o;try{let s=null,i=null;return this.flowType==="pkce"&&([s,i]=await Rr(this.storage,this.storageKey)),await qe(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(r=(n=e.options)===null||n===void 0?void 0:n.redirectTo)!==null&&r!==void 0?r:void 0}),!((o=e?.options)===null||o===void 0)&&o.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:i}),headers:this.headers,xform:rw})}catch(s){if(Le(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:n},error:r}=e;if(r)throw r;if(!n)throw new Gt;let{error:o}=await qe(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:n.access_token});return{data:{user:null,session:null},error:o}})}catch(e){if(Le(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let n=`${this.url}/resend`;if("email"in e){let{email:r,type:o,options:s}=e,{error:i}=await qe(this.fetch,"POST",n,{headers:this.headers,body:{email:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:i}}else if("phone"in e){let{phone:r,type:o,options:s}=e,{data:i,error:a}=await qe(this.fetch,"POST",n,{headers:this.headers,body:{phone:r,type:o,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:i?.message_id},error:a}}throw new kr("You must provide either an email or phone number and a type")}catch(n){if(Le(n))return{data:{user:null,session:null},error:n};throw n}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async n=>n))}async _acquireLock(e,n){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let r=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),o=(async()=>(await r,await n()))();return this.pendingInLock.push((async()=>{try{await o}catch{}})()),o}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let r=n();for(this.pendingInLock.push((async()=>{try{await r}catch{}})()),await r;this.pendingInLock.length;){let o=[...this.pendingInLock];await Promise.all(o),this.pendingInLock.splice(0,o.length)}return await r}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let n=await this.__loadSession();return await e(n)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,n=await $n(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",n),n!==null&&(this._isValidSession(n)?e=n:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let r=e.expires_at?e.expires_at*1e3-Date.now()<ac:!1;if(this._debug("#__loadSession()",`session has${r?"":" not"} expired`,"expires_at",e.expires_at),!r){if(this.userStorage){let i=await $n(this.userStorage,this.storageKey+"-user");i?.user?e.user=i.user:e.user=mc()}if(this.storage.isServer&&e.user){let i=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,c,d)=>(!i&&c==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),i=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,c,d))})}return{data:{session:e},error:null}}let{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:o},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await qe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:gn}):await this._useSession(async n=>{var r,o,s;let{data:i,error:a}=n;if(a)throw a;return!(!((r=i.session)===null||r===void 0)&&r.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Gt}:await qe(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(o=i.session)===null||o===void 0?void 0:o.access_token)!==null&&s!==void 0?s:void 0,xform:gn})})}catch(n){if(Le(n))return Fv(n)&&(await this._removeSession(),await En(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:n};throw n}}async updateUser(e,n={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,n))}async _updateUser(e,n={}){try{return await this._useSession(async r=>{let{data:o,error:s}=r;if(s)throw s;if(!o.session)throw new Gt;let i=o.session,a=null,l=null;this.flowType==="pkce"&&e.email!=null&&([a,l]=await Rr(this.storage,this.storageKey));let{data:c,error:d}=await qe(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:n?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:l}),jwt:i.access_token,xform:gn});if(d)throw d;return i.user=c.user,await this._saveSession(i),await this._notifyAllSubscribers("USER_UPDATED",i),{data:{user:i.user},error:null}})}catch(r){if(Le(r))return{data:{user:null},error:r};throw r}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Gt;let n=Date.now()/1e3,r=n,o=!0,s=null,{payload:i}=fc(e.access_token);if(i.exp&&(r=i.exp,o=r<=n),o){let{session:a,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!a)return{data:{user:null,session:null},error:null};s=a}else{let{data:a,error:l}=await this._getUser(e.access_token);if(l)throw l;s={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:r-n,expires_at:r},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(n){if(Le(n))return{data:{session:null,user:null},error:n};throw n}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async n=>{var r;if(!e){let{data:i,error:a}=n;if(a)throw a;e=(r=i.session)!==null&&r!==void 0?r:void 0}if(!e?.refresh_token)throw new Gt;let{session:o,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:o?{data:{user:o.user,session:o},error:null}:{data:{user:null,session:null},error:null}})}catch(n){if(Le(n))return{data:{user:null,session:null},error:n};throw n}}async _getSessionFromURL(e,n){try{if(!Bt())throw new Ir("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Ir(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(n){case"implicit":if(this.flowType==="pkce")throw new Ti("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Ir("Not a valid implicit grant flow url.");break;default:}if(n==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Ti("No code detected.");let{data:v,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;let x=new URL(window.location.href);return x.searchParams.delete("code"),window.history.replaceState(window.history.state,"",x.toString()),{data:{session:v.session,redirectType:null},error:null}}let{provider_token:r,provider_refresh_token:o,access_token:s,refresh_token:i,expires_in:a,expires_at:l,token_type:c}=e;if(!s||!a||!i||!c)throw new Ir("No session defined in URL");let d=Math.round(Date.now()/1e3),u=parseInt(a),p=d+u;l&&(p=parseInt(l));let f=p-d;f*1e3<=Tr&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${f}s, should have been closer to ${u}s`);let h=p-u;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,p,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,p,d);let{data:m,error:g}=await this._getUser(s);if(g)throw g;let y={provider_token:r,provider_refresh_token:o,access_token:s,expires_in:u,expires_at:p,refresh_token:i,token_type:c,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:y,redirectType:e.type},error:null}}catch(r){if(Le(r))return{data:{session:null,redirectType:null},error:r};throw r}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let n=await $n(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&n)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async n=>{var r;let{data:o,error:s}=n;if(s)return{error:s};let i=(r=o.session)===null||r===void 0?void 0:r.access_token;if(i){let{error:a}=await this.admin.signOut(i,e);if(a&&!(Bv(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await En(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let n=Yv(),r={id:n,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",n),this.stateChangeEmitters.delete(n)}};return this._debug("#onAuthStateChange()","registered callback with id",n),this.stateChangeEmitters.set(n,r),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(n)})))(),{data:{subscription:r}}}async _emitInitialSession(e){return await this._useSession(async n=>{var r,o;try{let{data:{session:s},error:i}=n;if(i)throw i;await((r=this.stateChangeEmitters.get(e))===null||r===void 0?void 0:r.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,n={}){let r=null,o=null;this.flowType==="pkce"&&([r,o]=await Rr(this.storage,this.storageKey,!0));try{return await qe(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:r,code_challenge_method:o,gotrue_meta_security:{captcha_token:n.captchaToken}},headers:this.headers,redirectTo:n.redirectTo})}catch(s){if(Le(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:n,error:r}=await this.getUser();if(r)throw r;return{data:{identities:(e=n.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(n){if(Le(n))return{data:null,error:n};throw n}}async linkIdentity(e){var n;try{let{data:r,error:o}=await this._useSession(async s=>{var i,a,l,c,d;let{data:u,error:p}=s;if(p)throw p;let f=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(i=e.options)===null||i===void 0?void 0:i.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await qe(this.fetch,"GET",f,{headers:this.headers,jwt:(d=(c=u.session)===null||c===void 0?void 0:c.access_token)!==null&&d!==void 0?d:void 0})});if(o)throw o;return Bt()&&!(!((n=e.options)===null||n===void 0)&&n.skipBrowserRedirect)&&window.location.assign(r?.url),{data:{provider:e.provider,url:r?.url},error:null}}catch(r){if(Le(r))return{data:{provider:e.provider,url:null},error:r};throw r}}async unlinkIdentity(e){try{return await this._useSession(async n=>{var r,o;let{data:s,error:i}=n;if(i)throw i;return await qe(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(o=(r=s.session)===null||r===void 0?void 0:r.access_token)!==null&&o!==void 0?o:void 0})})}catch(n){if(Le(n))return{data:null,error:n};throw n}}async _refreshAccessToken(e){let n=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(n,"begin");try{let r=Date.now();return await Zv(async o=>(o>0&&await Qv(200*Math.pow(2,o-1)),this._debug(n,"refreshing attempt",o),await qe(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:nn})),(o,s)=>{let i=200*Math.pow(2,o);return s&&cc(s)&&Date.now()+i-r<Tr})}catch(r){if(this._debug(n,"error",r),Le(r))return{data:{session:null,user:null},error:r};throw r}finally{this._debug(n,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,n){let r=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:n.redirectTo,scopes:n.scopes,queryParams:n.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",n,"url",r),Bt()&&!n.skipBrowserRedirect&&window.location.assign(r),{data:{provider:e,url:r},error:null}}async _recoverAndRefresh(){var e,n;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await $n(this.storage,this.storageKey);if(o&&this.userStorage){let i=await $n(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!i&&(i={user:o.user},await Pr(this.userStorage,this.storageKey+"-user",i)),o.user=(e=i?.user)!==null&&e!==void 0?e:mc()}else if(o&&!o.user&&!o.user){let i=await $n(this.storage,this.storageKey+"-user");i&&i?.user?(o.user=i.user,await En(this.storage,this.storageKey+"-user"),await Pr(this.storage,this.storageKey,o)):o.user=mc()}if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let s=((n=o.expires_at)!==null&&n!==void 0?n:1/0)*1e3-Date.now()<ac;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${ac}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:i}=await this._callRefreshToken(o.refresh_token);i&&(console.error(i),cc(i)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",i),await this._removeSession()))}}else if(o.user&&o.user.__isUserNotAvailableProxy===!0)try{let{data:i,error:a}=await this._getUser(o.access_token);!a&&i?.user?(o.user=i.user,await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)):this._debug(r,"could not get user data, skipping SIGNED_IN notification")}catch(i){console.error("Error getting user data:",i),this._debug(r,"error getting user data, skipping SIGNED_IN notification",i)}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var n,r;if(!e)throw new Gt;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let o=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(o,"begin");try{this.refreshingDeferred=new Ii;let{data:s,error:i}=await this._refreshAccessToken(e);if(i)throw i;if(!s.session)throw new Gt;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let a={session:s.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(s){if(this._debug(o,"error",s),Le(s)){let i={session:null,error:s};return cc(s)||await this._removeSession(),(n=this.refreshingDeferred)===null||n===void 0||n.resolve(i),i}throw(r=this.refreshingDeferred)===null||r===void 0||r.reject(s),s}finally{this.refreshingDeferred=null,this._debug(o,"end")}}async _notifyAllSubscribers(e,n,r=!0){let o=`#_notifyAllSubscribers(${e})`;this._debug(o,"begin",n,`broadcast = ${r}`);try{this.broadcastChannel&&r&&this.broadcastChannel.postMessage({event:e,session:n});let s=[],i=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,n)}catch(l){s.push(l)}});if(await Promise.all(i),s.length>0){for(let a=0;a<s.length;a+=1)console.error(s[a]);throw s[0]}}finally{this._debug(o,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;let n=Object.assign({},e),r=n.user&&n.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!r&&n.user&&await Pr(this.userStorage,this.storageKey+"-user",{user:n.user});let o=Object.assign({},n);delete o.user;let s=Gp(o);await Pr(this.storage,this.storageKey,s)}else{let o=Gp(n);await Pr(this.storage,this.storageKey,o)}}async _removeSession(){this._debug("#_removeSession()"),await En(this.storage,this.storageKey),await En(this.storage,this.storageKey+"-code-verifier"),await En(this.storage,this.storageKey+"-user"),this.userStorage&&await En(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Bt()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(n){console.error("removing visibilitychange callback failed",n)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Tr);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async n=>{let{data:{session:r}}=n;if(!r||!r.refresh_token||!r.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let o=Math.floor((r.expires_at*1e3-e)/Tr);this._debug("#_autoRefreshTokenTick()",`access token expires in ${o} ticks, a tick lasts ${Tr}ms, refresh threshold is ${ic} ticks`),o<=ic&&await this._callRefreshToken(r.refresh_token)})}catch(n){console.error("Auto refresh tick failed with error. This is likely a transient error.",n)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Ai)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Bt()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let n=`#_onVisibilityChanged(${e})`;this._debug(n,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(n,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,n,r){let o=[`provider=${encodeURIComponent(n)}`];if(r?.redirectTo&&o.push(`redirect_to=${encodeURIComponent(r.redirectTo)}`),r?.scopes&&o.push(`scopes=${encodeURIComponent(r.scopes)}`),this.flowType==="pkce"){let[s,i]=await Rr(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(i)}`});o.push(a.toString())}if(r?.queryParams){let s=new URLSearchParams(r.queryParams);o.push(s.toString())}return r?.skipBrowserRedirect&&o.push(`skip_http_redirect=${r.skipBrowserRedirect}`),`${e}?${o.join("&")}`}async _unenroll(e){try{return await this._useSession(async n=>{var r;let{data:o,error:s}=n;return s?{data:null,error:s}:await qe(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Le(n))return{data:null,error:n};throw n}}async _enroll(e){try{return await this._useSession(async n=>{var r,o;let{data:s,error:i}=n;if(i)return{data:null,error:i};let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:c}=await qe(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(r=s?.session)===null||r===void 0?void 0:r.access_token});return c?{data:null,error:c}:(e.factorType==="totp"&&(!((o=l?.totp)===null||o===void 0)&&o.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(n){if(Le(n))return{data:null,error:n};throw n}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;let{data:o,error:s}=n;if(s)return{data:null,error:s};let{data:i,error:a}=await qe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+i.expires_in},i)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",i),{data:i,error:a})})}catch(n){if(Le(n))return{data:null,error:n};throw n}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async n=>{var r;let{data:o,error:s}=n;return s?{data:null,error:s}:await qe(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(r=o?.session)===null||r===void 0?void 0:r.access_token})})}catch(n){if(Le(n))return{data:null,error:n};throw n}})}async _challengeAndVerify(e){let{data:n,error:r}=await this._challenge({factorId:e.factorId});return r?{data:null,error:r}:await this._verify({factorId:e.factorId,challengeId:n.id,code:e.code})}async _listFactors(){let{data:{user:e},error:n}=await this.getUser();if(n)return{data:null,error:n};let r=e?.factors||[],o=r.filter(i=>i.factor_type==="totp"&&i.status==="verified"),s=r.filter(i=>i.factor_type==="phone"&&i.status==="verified");return{data:{all:r,totp:o,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var n,r;let{data:{session:o},error:s}=e;if(s)return{data:null,error:s};if(!o)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let{payload:i}=fc(o.access_token),a=null;i.aal&&(a=i.aal);let l=a;((r=(n=o.user.factors)===null||n===void 0?void 0:n.filter(u=>u.status==="verified"))!==null&&r!==void 0?r:[]).length>0&&(l="aal2");let d=i.amr||[];return{data:{currentLevel:a,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,n={keys:[]}){let r=n.keys.find(a=>a.kid===e);if(r)return r;let o=Date.now();if(r=this.jwks.keys.find(a=>a.kid===e),r&&this.jwks_cached_at+Dv>o)return r;let{data:s,error:i}=await qe(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(i)throw i;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=o,r=s.keys.find(a=>a.kid===e),!r)?null:r}async getClaims(e,n={}){try{let r=e;if(!r){let{data:f,error:h}=await this.getSession();if(h||!f.session)return{data:null,error:h};r=f.session.access_token}let{header:o,payload:s,signature:i,raw:{header:a,payload:l}}=fc(r);n?.allowExpired||ew(s.exp);let c=!o.alg||o.alg.startsWith("HS")||!o.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(o.kid,n?.keys?{keys:n.keys}:n?.jwks);if(!c){let{error:f}=await this.getUser(r);if(f)throw f;return{data:{claims:s,header:o,signature:i},error:null}}let d=tw(o.alg),u=await crypto.subtle.importKey("jwk",c,d,!0,["verify"]);if(!await crypto.subtle.verify(d,u,i,Gv(`${a}.${l}`)))throw new Ar("Invalid JWT signature");return{data:{claims:s,header:o,signature:i},error:null}}catch(r){if(Le(r))return{data:null,error:r};throw r}}};qr.nextInstanceID=0;var YR=qr,Jp=YR;var yc=class extends Jp{constructor(e){super(e)}};var $R=function(t,e,n,r){function o(s){return s instanceof n?s:new n(function(i){i(s)})}return new(n||(n=Promise))(function(s,i){function a(d){try{c(r.next(d))}catch(u){i(u)}}function l(d){try{c(r.throw(d))}catch(u){i(u)}}function c(d){d.done?s(d.value):o(d.value).then(a,l)}c((r=r.apply(t,e||[])).next())})},Mi=class{constructor(e,n,r){var o,s,i;this.supabaseUrl=e,this.supabaseKey=n;let a=_v(e);if(!n)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",a),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",a),this.storageUrl=new URL("storage/v1",a),this.functionsUrl=new URL("functions/v1",a);let l=`sb-${a.hostname.split(".")[0]}-auth-token`,c={db:Iv,realtime:Mv,auth:Object.assign(Object.assign({},Av),{storageKey:l}),global:kv},d=Rv(r??{},c);this.storageKey=(o=d.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken?(this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(u,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((i=d.auth)!==null&&i!==void 0?i:{},this.headers,d.global.fetch),this.fetch=Pv(n,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.rest=new pv(new URL("rest/v1",a).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch}),this.storage=new Si(this.storageUrl.href,this.headers,this.fetch,r?.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new ii(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,n={},r={}){return this.rest.rpc(e,n,r)}channel(e,n={config:{}}){return this.realtime.channel(e,n)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,n;return $R(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(n=(e=r.session)===null||e===void 0?void 0:e.access_token)!==null&&n!==void 0?n:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,userStorage:s,storageKey:i,flowType:a,lock:l,debug:c},d,u){let p={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new yc({url:this.authUrl.href,headers:Object.assign(Object.assign({},p),d),storageKey:i,autoRefreshToken:e,persistSession:n,detectSessionInUrl:r,storage:o,userStorage:s,flowType:a,lock:l,debug:c,fetch:u,hasCustomAuthorizationHeader:Object.keys(this.headers).some(f=>f.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new ko(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r?.access_token)})}_handleTokenChanged(e,n,r){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==r?(this.changedAccessToken=r,this.realtime.setAuth(r)):e==="SIGNED_OUT"&&(this.realtime.setAuth(),n=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var uw=(t,e,n)=>new Mi(t,e,n);function JR(){if(typeof window<"u"||typeof process>"u")return!1;let t=process.version;if(t==null)return!1;let e=t.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}JR()&&console.warn("\u26A0\uFE0F  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");var QR={url:["mg.supabase.url","MG_SUPABASE_URL","SUPABASE_URL"],anonKey:["mg.supabase.anonKey","MG_SUPABASE_ANON_KEY","SUPABASE_ANON_KEY"]},bc,Jn,pw,ZR="https://pquktqrngyxkvrgtfygp.supabase.co",XR="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBxdWt0cXJuZ3l4a3ZyZ3RmeWdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk2MTQzMDMsImV4cCI6MjA3NTE5MDMwM30.-d45t6qyEO54iz2SrjaoTUQjeNb6tngDx6pOQL7-Ubg",e_={url:ZR,anonKey:XR};function mw(t={}){let e=t_(t.credentials);if((t.refresh===!0||!bc||!Jn||Jn.url!==e.url||Jn.anonKey!==e.anonKey||t.options!==pw)&&(bc=uw(e.url,e.anonKey,t.options),Jn=e,pw=t.options),!bc)throw new Error("Supabase client is not initialized.");return bc}function t_(t){if(t)return n_(t);if(Jn)return Jn;let e=fw("url"),n=fw("anonKey");if(!e||!n)throw new Error("Supabase credentials are missing. Provide them via setSupabaseCredentials(), getSupabaseClient({ credentials }) or define globalThis.MG_SUPABASE.");return Jn={url:e,anonKey:n},Jn}function n_(t){return{url:t.url.trim(),anonKey:t.anonKey.trim()}}function fw(t){let e=r_(t);if(e)return e;for(let r of QR[t]){let o=o_(r);if(o)return o;let s=s_(r);if(s)return s;let i=i_(r);if(i)return i;let a=a_(r);if(a)return a}let n=e_[t];if(typeof n=="string"&&n.trim())return n.trim()}function r_(t){let e=globalThis.MG_SUPABASE;if(!e)return;let n=e[t];if(typeof n=="string"&&n.trim())return n.trim()}function o_(t){let e=globalThis?.[t];return typeof e=="string"&&e.trim()?e.trim():void 0}function s_(t){try{let e=unsafeWindow,n=typeof e=="object"&&e?e[t]:void 0;return typeof n=="string"&&n.trim()?n.trim():void 0}catch{return}}function i_(t){try{if(typeof GM_getValue=="function"){let e=GM_getValue(t);if(typeof e=="string"&&e.trim())return e.trim()}}catch(e){console.warn(`[Supabase] Failed to read ${t} from GM storage`,e)}}function a_(t){try{if(typeof localStorage<"u"){let e=localStorage.getItem(t);if(typeof e=="string"&&e.trim())return e.trim()}}catch(e){console.warn(`[Supabase] Failed to read ${t} from localStorage`,e)}}function hw(t){let e=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume"],n=[];function r(){let L=(P,V)=>{let z=C=>{C.stopImmediatePropagation(),C.preventDefault?.()};P.addEventListener(V,z,{capture:!0}),n.push({t:V,h:z,target:P})};e.forEach(P=>{L(document,P),L(window,P)})}function o(){for(let{t:L,h:P,target:V}of n)try{V.removeEventListener(L,P,{capture:!0})}catch{}n.length=0}let s=Object.getPrototypeOf(document),i={hidden:Object.getOwnPropertyDescriptor(s,"hidden"),visibilityState:Object.getOwnPropertyDescriptor(s,"visibilityState"),hasFocus:document.hasFocus?document.hasFocus.bind(document):null};function a(){try{Object.defineProperty(s,"hidden",{configurable:!0,get(){return!1}})}catch{}try{Object.defineProperty(s,"visibilityState",{configurable:!0,get(){return"visible"}})}catch{}try{document.hasFocus=()=>!0}catch{}}function l(){try{i.hidden&&Object.defineProperty(s,"hidden",i.hidden)}catch{}try{i.visibilityState&&Object.defineProperty(s,"visibilityState",i.visibilityState)}catch{}try{i.hasFocus&&(document.hasFocus=i.hasFocus)}catch{}}let c=null,d=null,u=null,p=()=>{c&&c.state!=="running"&&c.resume?.().catch(()=>{})};function f(){try{c=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),u=c.createGain(),u.gain.value=1e-5,d=c.createOscillator(),d.frequency.value=1,d.connect(u).connect(c.destination),d.start(),document.addEventListener("visibilitychange",p,{capture:!0}),window.addEventListener("focus",p,{capture:!0})}catch{h()}}function h(){try{d?.stop()}catch{}try{d?.disconnect(),u?.disconnect()}catch{}try{c?.close?.()}catch{}document.removeEventListener("visibilitychange",p,{capture:!0}),window.removeEventListener("focus",p,{capture:!0}),d=null,u=null,c=null}let m=null;function g(){let L=document.querySelector("canvas")||document.body||document.documentElement;m=window.setInterval(()=>{try{L.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}))}catch{}},25e3)}function y(){m!==null&&(clearInterval(m),m=null)}let v=null;async function w(){try{let L=await t.getPosition();if(!L)return;await t.move(Math.round(L.x),Math.round(L.y))}catch{}}function x(){v=window.setInterval(w,6e4),w()}function E(){v!==null&&(clearInterval(v),v=null)}return{start(){a(),r(),f(),g(),x()},stop(){E(),y(),h(),o(),l()}}}(async function(){"use strict";U0(),bd({config:{blackBelow:10,skipAlphaBelow:1,tolerance:.005},onAsset:(r,o)=>{console.debug("[Sprites] Asset d\xE9tect\xE9 depuis initSprites",{url:r,kind:o}),Re.dispatchEvent(new CustomEvent("mg:sprite-detected",{detail:{url:r,kind:o}}))}}),console.debug("[Sprites] V\xE9rification de l'instance globale",{hasWindowSprites:!!Re.Sprites,spriteKeys:Object.keys(Re.Sprites||{})}),Af(),await Gg();try{let r=mw(),{error:o}=await r.auth.getSession();o?console.error("[Supabase] Connexion \xE9chou\xE9e",o):console.log("[Supabase] Client initialis\xE9 avec succ\xE8s")}catch(r){console.error("[Supabase] Impossible d'initialiser le client",r)}ju({onRegister(r){r("players","\u{1F465} Players",E0),r("room","\u{1F3E0} Room",X0),r("garden","\u{1F331} Garden",ch),r("locker","\u{1F512} Locker",wb),r("calculator","\u{1F913} Calculator",Db),r("pets","\u{1F43E} Pets",I0),r("shops","\u{1F6D2} Shops",rh),r("stats","\u{1F4CA} Stats",sp),r("tools","\u{1F6E0}\uFE0F Tools",H0),r("keybinds","\u2328\uFE0F Keybinds",W0),r("alerts","\u{1F514} Alerts",Wb),r("misc","\u{1F9E9} Misc",F0),r("debug-data","\u{1F527} Debug",h0)}}),Zy(),hw({getPosition:()=>Se.getPosition(),move:(r,o)=>Se.move(r,o)}).start();let{tiles:e,ui:n}=ke.lists();console.debug("[Sprites] R\xE9capitulatif des listes au d\xE9marrage",{tilesCount:e.length,uiCount:n.length})})();})();
