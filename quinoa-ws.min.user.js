// ==UserScript==
// @name         Magic Garden ModMenu 
// @namespace    Quinoa
// @version      1.0.6
// @match        https://*.discordsays.com/*
// @run-at       document-start
// @all-frames   true
// @inject-into  page
// @grant        none
// @downloadURL  https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// @updateURL    https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// ==/UserScript==
(()=>{var dr=Object.defineProperty;var ur=(t,e,n)=>e in t?dr(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var _=(t,e,n)=>ur(t,typeof e!="symbol"?e+"":e,n);var ge=window.WebSocket,Ca=window.Worker,fe=[],_e=null;function We(t,e){if(!_e){_e=t;try{console.log("[QuinoaWS] selected ->",e)}catch{}}}var ut=!1;var mt=typeof Set<"u"?new Set:{_a:[],add(t){this._a.push(t)},delete(t){let e=this._a.indexOf(t);e>=0&&this._a.splice(e,1)},forEach(t){for(let e=0;e<this._a.length;e++)t(this._a[e])}};function pt(t){return["CONNECTING","OPEN","CLOSING","CLOSED"][t??-1]||"none"}async function ln(t){try{if(typeof t=="string")return JSON.parse(t);if(t instanceof Blob)return JSON.parse(await t.text());if(t instanceof ArrayBuffer)return JSON.parse(new TextDecoder().decode(t))}catch{}return null}function cn(){function t(e,n){let r=n!==void 0?new ge(e,n):new ge(e);fe.push(r),r.addEventListener("open",()=>{setTimeout(()=>{r.readyState===ge.OPEN&&We(r,"open-fallback")},800)}),r.addEventListener("message",async s=>{let i=await ln(s.data);i&&!window.quinoaWS&&(i.type==="Welcome"||i.type==="Config"||i.fullState||i.config)&&We(r,"message:"+(i.type||"state"))});let a=r.send.bind(r);return r.send=function(s){try{let i=null;typeof s=="string"?i=JSON.parse(s):s instanceof ArrayBuffer&&(i=JSON.parse(new TextDecoder().decode(s))),!window.quinoaWS&&i&&Array.isArray(i.scopePath)&&i.scopePath.join("/")==="Room/Quinoa"&&We(r,"send:"+i.type)}catch{}return a(s)},r}t.prototype=ge.prototype;try{t.OPEN=ge.OPEN}catch{}try{t.CLOSED=ge.CLOSED}catch{}try{t.CLOSING=ge.CLOSING}catch{}try{t.CONNECTING=ge.CONNECTING}catch{}window.WebSocket=t}var Ae=null,kt=!1,dn=null,yt=null,un=()=>globalThis.jotaiAtomCache?.cache;function mr(){let t=globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!t?.renderers?.size)return null;for(let[e]of t.renderers){let n=t.getFiberRoots(e);for(let r of n){let a=new Set,s=[r.current];for(;s.length;){let i=s.pop();if(!i||a.has(i))continue;a.add(i);let o=i?.pendingProps?.value;if(o&&typeof o.get=="function"&&typeof o.set=="function"&&typeof o.sub=="function")return yt="fiber",o;i.child&&s.push(i.child),i.sibling&&s.push(i.sibling),i.alternate&&s.push(i.alternate)}}}return null}async function pr(t=5e3){let e=un();if(!e)throw new Error("jotaiAtomCache.cache introuvable");let n=null,r=null,a=[];for(let o of e.values()){if(!o||typeof o.write!="function")continue;let d=o.write;o.__origWrite=d,o.write=function(c,b,...w){if(!r){n=c,r=b;for(let S of a)S.write=S.__origWrite,delete S.__origWrite}return d.call(this,c,b,...w)},a.push(o)}let s=o=>new Promise(d=>setTimeout(d,o)),i=Date.now();try{globalThis.dispatchEvent?.(new Event("visibilitychange"))}catch{}for(;!r&&Date.now()-i<t;)await s(50);return r?(yt="write",{get:o=>n(o),set:(o,d)=>r(o,d),sub:(o,d)=>{let c;try{c=n(o)}catch{}let b=setInterval(()=>{let w;try{w=n(o)}catch{return}if(w!==c){c=w;try{d()}catch{}}},100);return()=>clearInterval(b)}}):(yt="polyfill",{get:()=>{throw new Error("Store non captur\xE9: get indisponible")},set:()=>{throw new Error("Store non captur\xE9: set indisponible")},sub:()=>()=>{},__polyfill:!0})}async function Ie(){if(Ae)return Ae;if(kt){let t=Date.now();for(;!Ae&&Date.now()-t<3e3;)await new Promise(e=>setTimeout(e,25));if(Ae)return Ae}kt=!0;try{return Ae=mr()||await pr(),Ae}catch(t){throw dn=t,t}finally{kt=!1}}function $e(){return!!Ae&&!Ae.__polyfill}function mn(){return{via:yt,polyfill:!!Ae?.__polyfill,error:dn}}async function Pe(t){return(await Ie()).get(t)}async function ke(t,e){await(await Ie()).set(t,e)}async function Ve(t,e){return(await Ie()).sub(t,e)}function Xe(t){let e=un();if(!e)return[];let n=[];for(let r of e.values()){let a=r?.debugLabel||r?.label||"";t.test(String(a))&&n.push(r)}return n}function pe(t){return Xe(new RegExp("^"+t+"$"))[0]||null}function yr(t){if(mt.forEach)mt.forEach(e=>{try{e.postMessage(t)}catch{}});else for(let e of mt._a)try{e.postMessage(t)}catch{}}function gr(){if(_e&&_e.readyState===ge.OPEN)return _e;let t=null;if(fe.find&&(t=fe.find(e=>e.readyState===ge.OPEN)||null),!t){for(let e=0;e<fe.length;e++)if(fe[e].readyState===ge.OPEN){t=fe[e];break}}if(t)return We(t,"getPageWS"),t;throw new Error("No page WebSocket open")}function de(t){let e={scopePath:["Room","Quinoa"],...t};try{return gr().send(JSON.stringify(e)),!0}catch{return yr({__QWS_CMD:"send",payload:JSON.stringify(e)}),!0}}async function Rt(){try{await Ie()}catch{}}async function pn(t,e){await Rt();let n=pe(t);if(!n)return e;try{return await Pe(n)}catch{return e}}async function yn(t,e){await Rt();let n=pe(t);return n?await Ve(n,async()=>{try{e(await Pe(n))}catch{}}):()=>{}}async function fr(t,e){let n=await pn(t);return n!==void 0&&e(n),yn(t,e)}var Be={ensure:Rt,select:pn,subscribe:yn,subscribeImmediate:fr};function gt(t,e){if(t===e)return!0;if(!Array.isArray(t)||!Array.isArray(e)||t.length!==e.length)return!1;let n=new Set(t);for(let r of e)if(!n.has(r))return!1;return!0}function ve(t,e){return{label:t,get:()=>Be.select(t).then(n=>e?e(n):n),sub:n=>Be.subscribe(t,r=>n(e?e(r):r)),subNow:n=>Be.subscribeImmediate(t,r=>n(e?e(r):r))}}var ft=(()=>{let t=ve("myInventoryAtom",e=>Array.isArray(e?.favoritedItemIds)?e.favoritedItemIds.slice():[]);return{label:t.label+":favoriteIds",get:t.get,sub(e){let n=null;return t.sub(r=>{(!n||!gt(n,r))&&(n=r,e(r))})},subNow(e){let n=null;return t.subNow(r=>{(!n||!gt(n,r))&&(n=r,e(r))})}}})(),De=(()=>{let t=ve("myInventoryAtom",e=>Array.isArray(e?.favoritedItemIds)?e.favoritedItemIds:[]);return{label:t.label+":favoriteIdSet",async get(){let e=await t.get();return new Set(e)},sub(e){let n=null;return t.sub(r=>{(!n||!gt(n,r))&&(n=r,e(new Set(r)))})},subNow(e){let n=null;return t.subNow(r=>{(!n||!gt(n,r))&&(n=r,e(new Set(r)))})}}})(),Qe=function(){let{label:e,get:n,sub:r,subNow:a}=function(i,o){return{label:i,get:()=>Be.select(i).then(d=>o?o(d):d),sub:d=>Be.subscribe(i,c=>d(o?o(c):c)),subNow:d=>Be.subscribeImmediate(i,c=>d(o?o(c):c))}}("myDataAtom",s=>s?.garden??null);return{label:e,get:n,sub:r,subNow:a}}(),Ze=ve("positionAtom"),et=ve("stateAtom"),ze=ve("myInventoryAtom"),Ht=ve("shopsAtom"),Nt=ve("myShopPurchasesAtom"),ht=ve("myDataAtom"),qe=ve("myCropInventoryAtom"),bt=ve("numPlayersAtom"),_t=ve("totalCropSellPriceAtom"),Le=ve("myPetInfosAtom"),qa=ve("myPetSlotInfosAtom");function hr(t){if(!t)return"null";let e=typeof t.abilityId=="string"?t.abilityId:"",n=Number.isFinite(t.performedAt)?String(t.performedAt):"",r="";try{r=JSON.stringify(t.data??null)}catch{r=""}return`${e}|${n}|${r}`}function Lt(t){let e={},n=new Map;if(t&&typeof t=="object")for(let r of Object.keys(t)){let a=t[r]??{},s=a.lastAbilityTrigger??null,i=a.position??null;e[r]={petId:r,abilityId:s?.abilityId??null,performedAt:Number.isFinite(s?.performedAt)?s.performedAt:null,data:s?.data??null,position:i??null},n.set(r,hr(s))}return{value:e,sig:n}}function gn(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}var fn=(()=>{let t=ve("myPetSlotInfosAtom");return{label:t.label+":abilitiesTrigger",async get(){let n=await t.get();return Lt(n).value},sub(n){let r=null;return t.sub(a=>{let{value:s,sig:i}=Lt(a);gn(r,i)||(r=i,n(s))})},subNow(n){let r=null;return t.subNow(a=>{let{value:s,sig:i}=Lt(a);gn(r,i)||(r=i,n(s))})}}})();function hn(t){return t?[t.objectType??t.type??"",t.species??t.seedSpecies??t.plantSpecies??t.eggId??t.decorId??"",t.plantedAt??t.startTime??0,t.maturedAt??t.endTime??0].join("|"):"\u2205"}function Wt(t,e){let n=t?.tileObjects??{},r=e?.tileObjects??{},a=[],s=[],i=[],o=[],d=new Set;for(let c of Object.keys(r))d.add(c),c in n?hn(n[c])!==hn(r[c])&&(s.push(+c),o.push({kind:"updated",slot:+c,prev:n[c],next:r[c]})):(a.push(+c),o.push({kind:"added",slot:+c,next:r[c]}));for(let c of Object.keys(n))d.has(c)||(i.push(+c),o.push({kind:"removed",slot:+c,prev:n[c]}));return{added:a,updated:s,removed:i,changes:o}}function br(t){let e=t?.slot??{},n=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",r=Array.isArray(e.abilities)?e.abilities.slice().sort().join(","):"",a=e.name??"",s=e.petSpecies??"",i=Number.isFinite(e.xp)?Math.round(e.xp):0,o=Number.isFinite(e.hunger)?Math.round(e.hunger*1e3):0,d=Number.isFinite(e.targetScale)?Math.round(e.targetScale*1e3):0,c=Number.isFinite(t?.position?.x)?Math.round(t.position.x):0,b=Number.isFinite(t?.position?.y)?Math.round(t.position.y):0;return`${s}|${a}|xp:${i}|hg:${o}|sc:${d}|m:${n}|a:${r}|pos:${c},${b}`}function tt(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=String(r?.slot?.id??"");a&&e.set(a,br(r))}return e}function qt(t,e){let n=[],r=[],a=[],s=[];for(let[i,o]of e)t.has(i)?t.get(i)!==o&&(r.push(i),s.push({kind:"updated",id:i})):(n.push(i),s.push({kind:"added",id:i}));for(let i of t.keys())e.has(i)||(a.push(i),s.push({kind:"removed",id:i}));return{added:n,updated:r,removed:a,changes:s}}function Sr(t){let e=Array.isArray(t.mutations)?t.mutations.slice().sort().join(","):"",n=Number.isFinite(t.scale)?Math.round(t.scale*1e3):0;return`${t.species??""}|${t.itemType??""}|${n}|${e}`}function nt(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=String(r?.id??"");a&&e.set(a,Sr(r))}return e}function Ft(t,e){let n=[],r=[],a=[],s=[];for(let[i,o]of e)t.has(i)?t.get(i)!==o&&(r.push(i),s.push({kind:"updated",key:i})):(n.push(i),s.push({kind:"added",key:i}));for(let i of t.keys())e.has(i)||(a.push(i),s.push({kind:"removed",key:i}));return{added:n,updated:r,removed:a,changes:s}}var B={getPosition(){return Ze.get()},onPosition(t){return Ze.sub(t)},onPositionNow(t){return Ze.subNow(t)},async setPosition(t,e){let n=pe(Ze.label||"positionAtom");if(!n)throw new Error("positionAtom introuvable");await ke(n,{x:t,y:e})},async teleport(t,e){try{await this.setPosition(t,e)}catch{}try{de({type:"Teleport",position:{x:t,y:e}})}catch{}},async move(t,e){try{await this.setPosition(t,e)}catch{}try{de({type:"PlayerPosition",position:{x:t,y:e}})}catch{}},async plantSeed(t,e){try{de({type:"PlantSeed",slot:t,species:e})}catch{}},async sellAllCrops(){try{de({type:"SellAllCrops"})}catch{}},async sellPet(t){try{de({type:"SellPet",itemId:t})}catch{}},async waterPlant(t){try{de({type:"WaterPlant",slot:t})}catch{}},async setSelectedItem(t){try{de({type:"SetSelectedItem",itemIndex:t})}catch{}},async pickupObject(){try{de({type:"PickupObject"})}catch{}},async dropObject(){try{de({type:"DropObject"})}catch{}},async harvestCrop(t,e){try{de({type:"HarvestCrop",slot:t,slotsIndex:e})}catch{}},async feedPet(t,e){try{de({type:"FeedPet",petItemId:t,cropItemId:e})}catch{}},async hatchEgg(t){try{de({type:"HatchEgg",slot:t})}catch{}},async placeDecor(t,e,n){try{de({type:"PlaceDecor",tileType:t,localTileIndex:e,decorId:n})}catch{}},async swapPet(t,e){try{de({type:"SwapPet",petSlotId:t,petInventoryId:e})}catch{}},async placePet(t,e,n,r){try{de({type:"PlacePet",itemId:t,position:e,tileType:n,localTileIndex:r})}catch{}},async storePet(t){try{de({type:"StorePet",itemId:t})}catch{}},async toggleFavoriteItem(t){try{de({type:"ToggleFavoriteItem",itemId:t})}catch{}},async getFavoriteIds(){let t=await ft.get();return Array.isArray(t)?t.slice():[]},async getFavoriteIdSet(){return await De.get()},async isFavoriteItem(t){return(await De.get()).has(t)},async ensureFavoriteItem(t,e){let n=await this.isFavoriteItem(t);return n!==e?(await this.toggleFavoriteItem(t),e):n},async ensureFavorites(t,e){let n=await De.get(),r=0;for(let a of t)if(n.has(a)!==e)try{await this.toggleFavoriteItem(a),r++}catch{}},onFavoriteIdsChange(t){return ft.sub(e=>{let n=Array.isArray(e)?e:[];t(n)})},async onFavoriteIdsChangeNow(t){let e=await this.getFavoriteIds();return t(e),ft.sub(n=>{let r=Array.isArray(n)?n:[];t(r)})},onFavoriteSetChange(t){return De.sub(e=>{t(e)})},async onFavoriteSetChangeNow(t){let e=await De.get();return t(e),De.sub(n=>{t(n)})},async getGardenState(){return(await ht.get())?.garden??null},onGardenChange(t){let e=null;return Qe.sub(n=>{n!==e&&(e=n,t(n))})},async onGardenChangeNow(t){let e=await Qe.get();return t(e),Qe.sub(n=>{n!==e&&(e=n,t(n))})},onGardenDiff(t){let e=null;return Qe.sub(n=>{let r=Wt(e,n);(r.added.length||r.updated.length||r.removed.length||n!==e)&&(e=n,t(n,r))})},async onGardenDiffNow(t){let e=(await ht.get())?.garden??null;return t(e,Wt(null,e)),ht.sub(n=>{let r=n?.garden??null,a=Wt(e,r);(a.added.length||a.updated.length||a.removed.length)&&(e=r,t(r,a))})},async getPets(){let t=await Le.get();return Array.isArray(t)?t:null},onPetsChange(t){let e=null;return Le.sub(n=>{n!==e&&(e=n,t(e))})},async onPetsChangeNow(t){let e=await this.getPets();return t(e),Le.sub(n=>{n!==e&&(e=n,t(e))})},onPetsDiff(t){let e=tt(null);return Le.sub(n=>{let r=tt(n),a=qt(e,r);(a.added.length||a.updated.length||a.removed.length)&&(t(n,a),e=r)})},async onPetsDiffNow(t){let e=await this.getPets(),n=tt(null),r=tt(e),a=qt(n,r);return t(e,a),n=r,Le.sub(s=>{r=tt(s);let i=qt(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getCropInventoryState(){return await qe.get()},onCropInventoryChange(t){let e=null;return qe.sub(n=>{n!==e&&(e=n,t(n))})},async onCropInventoryChangeNow(t){let e=await qe.get();return t(e),qe.sub(n=>{n!==e&&(e=n,t(n))})},onCropInventoryDiff(t){let e=nt(null);return qe.sub(n=>{let r=nt(n),a=Ft(e,r);(a.added.length||a.updated.length||a.removed.length)&&(t(n,a),e=r)})},async onCropInventoryDiffNow(t){let e=await qe.get(),n=nt(null),r=nt(e),a=Ft(n,r);return t(e,a),n=r,qe.sub(s=>{r=nt(s);let i=Ft(n,r);(i.added.length||i.updated.length||i.removed.length)&&(t(s,i),n=r)})},async getNumPlayers(){let t=await bt.get();return typeof t=="number"?t:0},onNumPlayersChange(t){let e;return bt.sub(n=>{n!==e&&(e=n,t(n))})},async onNumPlayersChangeNow(t){let e=await this.getNumPlayers();return t(e),bt.sub(n=>{n!==e&&(e=n,t(n))})}};var A={Common:"Common",Uncommon:"Uncommon",Rare:"Rare",Legendary:"Legendary",Mythic:"Mythical",Divine:"Divine",Celestial:"Celestial"},te={Single:"Single",Multiple:"Multiple"};var j={Empty:0,DirtPatch:1,SproutFlower:2,SproutVegetable:3,SproutFruit:4,SproutVine:5,StemFlower:6,Trellis:7,Daffodil:11,Tulip:12,Sunflower:13,Lily:14,Starweaver:15,StarweaverPlant:16,AloePlant:17,Aloe:18,Blueberry:21,Banana:22,Strawberry:23,Mango:24,Grape:25,Watermelon:26,Lemon:27,Apple:28,Pepper:31,Tomato:32,BabyCarrot:33,Carrot:34,Pumpkin:35,Corn:36,PalmTreeTop:39,BushyTree:40,Coconut:41,MushroomPlant:42,PassionFruit:43,DragonFruit:44,Lychee:45,Mushroom:46,BurrosTail:47,Cacao:48,Echeveria:49},Fe={Empty:0,Bamboo:1,PalmTree:2,Cactus:3,Tree:4},ie={Empty:0,Daffodil:1,Tulip:2,Sunflower:3,Starweaver:6,Blueberry:11,Banana:12,Strawberry:13,Mango:14,Grape:15,Watermelon:16,Lemon:17,Apple:18,Lily:20,Pepper:21,Tomato:22,Carrot:23,Pumpkin:25,Corn:26,Bamboo:41,Coconut:31,Mushroom:32,PassionFruit:33,DragonFruit:34,Lychee:35,BurrosTail:37,Aloe:39,Echeveria:40,Cactus:42},St={Empty:0,Coin:1,Shovel:2,Seeds:3,PlanterPot:5,InventoryBag:6,WateringCan:14,Fertilizer:15,RainbowPotion:16,ArrowKeys:41,Touchpad:42};var ye={Bee:1,Chicken:2,Bunny:3,Turtle:4,Capybara:5,Cow:6,Pig:7,Butterfly:8,Snail:9,Worm:10,CommonEgg:11,UncommonEgg:12,RareEgg:13,LegendaryEgg:14,MythicalEgg:15,DivineEgg:16,CelestialEgg:17,Squirrel:18,Goat:19,Dragonfly:20,Peacock:30},rt={Wet:1,Chilled:2,Frozen:3,Dawnlit:11,Amberglow:12},le={SmallRock:11,MediumRock:21,LargeRock:31,WoodPedestal:4,WoodBench:13,WoodBucketPedestal:14,WoodLampPost:23,WoodStool:24,WoodArch:33,WoodBridge:34,WoodOwl:43,WoodGardenBox:44,StonePedestal:6,StoneBench:15,StoneBucketPedestal:16,StoneLampPost:25,StoneColumn:26,StoneArch:35,StoneBridge:36,StoneGnome:45,StoneGardenBox:46,MarblePedestal:8,MarbleBench:17,MarbleBucketPedestal:18,MarbleLampPost:27,MarbleColumn:28,MarbleArch:37,MarbleBridge:38,MarbleBlobling:47,MarbleGardenBox:48,StrawScarecrow:49,MiniFairyCottage:50,MiniFairyForge:40,MiniFairyKeep:60,Birdhouse:63,WoodenWindmill:64,StoneBirdbath:65},Ge={Carrot:{seed:{tileRef:ie.Carrot,name:"Carrot Seed",coinPrice:10,creditPrice:7,rarity:A.Common},plant:{tileRef:j.BabyCarrot,name:"Carrot Plant",harvestType:te.Single,baseTileScale:.7},crop:{tileRef:j.Carrot,name:"Carrot",baseSellPrice:20,baseWeight:.1,baseTileScale:.6,maxScale:3}},Strawberry:{seed:{tileRef:ie.Strawberry,name:"Strawberry Seed",coinPrice:50,creditPrice:21,rarity:A.Common},plant:{tileRef:j.SproutFruit,name:"Strawberry Plant",harvestType:te.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:70,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:j.Strawberry,name:"Strawberry",baseSellPrice:14,baseWeight:.05,baseTileScale:.25,maxScale:2}},Aloe:{seed:{tileRef:ie.Aloe,name:"Aloe Seed",coinPrice:135,creditPrice:18,rarity:A.Common},plant:{tileRef:j.AloePlant,name:"Aloe Plant",harvestType:te.Single,baseTileScale:.9},crop:{tileRef:j.Aloe,name:"Aloe",baseSellPrice:310,baseWeight:1.5,baseTileScale:.7,maxScale:2.5}},Blueberry:{seed:{tileRef:ie.Blueberry,name:"Blueberry Seed",coinPrice:400,creditPrice:49,rarity:A.Uncommon},plant:{tileRef:j.SproutFruit,name:"Blueberry Plant",harvestType:te.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:105,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:j.Blueberry,name:"Blueberry",baseSellPrice:23,baseWeight:.01,baseTileScale:.25,maxScale:2}},Apple:{seed:{tileRef:ie.Apple,name:"Apple Seed",coinPrice:500,creditPrice:67,rarity:A.Uncommon,unavailableSurfaces:["discord"]},plant:{tileRef:Fe.Tree,name:"Apple Tree",harvestType:te.Multiple,slotOffsets:[{x:.15,y:-1.9,rotation:-90},{x:0,y:-1.5,rotation:-75},{x:.6,y:-1.7,rotation:-60},{x:.3,y:-1.15,rotation:-55},{x:1.05,y:-1.4,rotation:-45},{x:.8,y:-1.2,rotation:-35},{x:.9,y:.6,rotation:-30}],secondsToMature:360*60,baseTileScale:3,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:j.Apple,name:"Apple",baseSellPrice:73,baseWeight:.18,baseTileScale:.5,maxScale:2}},OrangeTulip:{seed:{tileRef:ie.Tulip,name:"Tulip Seed",coinPrice:600,creditPrice:14,rarity:A.Uncommon},plant:{tileRef:j.Tulip,name:"Tulip Plant",harvestType:te.Single,baseTileScale:.5},crop:{tileRef:j.Tulip,name:"Tulip",baseSellPrice:767,baseWeight:.01,baseTileScale:.5,maxScale:3}},Tomato:{seed:{tileRef:ie.Tomato,name:"Tomato Seed",coinPrice:800,creditPrice:79,rarity:A.Uncommon},plant:{tileRef:j.SproutVine,name:"Tomato Plant",harvestType:te.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1100,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:j.Tomato,name:"Tomato",baseSellPrice:27,baseWeight:.3,baseTileScale:.33,maxScale:2}},Daffodil:{seed:{tileRef:ie.Daffodil,name:"Daffodil Seed",coinPrice:1e3,creditPrice:19,rarity:A.Rare},plant:{tileRef:j.Daffodil,name:"Daffodil Plant",harvestType:te.Single,baseTileScale:.5},crop:{tileRef:j.Daffodil,name:"Daffodil",baseSellPrice:1090,baseWeight:.01,baseTileScale:.5,maxScale:3}},Corn:{seed:{tileRef:ie.Corn,name:"Corn Kernel",coinPrice:1300,creditPrice:135,rarity:A.Rare},plant:{tileRef:j.SproutVegetable,name:"Corn Plant",harvestType:te.Multiple,slotOffsets:[{x:.5,y:.4,rotation:0}],secondsToMature:130,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:j.Corn,name:"Corn",baseSellPrice:36,baseWeight:1.2,baseTileScale:.7,maxScale:2}},Watermelon:{seed:{tileRef:ie.Watermelon,name:"Watermelon Seed",coinPrice:2500,creditPrice:195,rarity:A.Rare},plant:{tileRef:j.Watermelon,name:"Watermelon Plant",harvestType:te.Single,baseTileScale:.8},crop:{tileRef:j.Watermelon,name:"Watermelon",baseSellPrice:2708,baseWeight:4.5,baseTileScale:.8,maxScale:3}},Pumpkin:{seed:{tileRef:ie.Pumpkin,name:"Pumpkin Seed",coinPrice:3e3,creditPrice:210,rarity:A.Rare},plant:{tileRef:j.Pumpkin,name:"Pumpkin Plant",harvestType:te.Single,baseTileScale:.8},crop:{tileRef:j.Pumpkin,name:"Pumpkin",baseSellPrice:3700,baseWeight:6,baseTileScale:.8,maxScale:3}},Echeveria:{seed:{tileRef:ie.Echeveria,name:"Echeveria Cutting",coinPrice:4200,creditPrice:113,rarity:A.Legendary},plant:{tileRef:j.Echeveria,name:"Echeveria Plant",harvestType:te.Single,baseTileScale:.8},crop:{tileRef:j.Echeveria,name:"Echeveria",baseSellPrice:4600,baseWeight:.8,baseTileScale:.8,maxScale:2.75}},Coconut:{seed:{tileRef:ie.Coconut,name:"Coconut Seed",coinPrice:6e3,creditPrice:235,rarity:A.Legendary},plant:{tileRef:Fe.PalmTree,name:"Coconut Tree",harvestType:te.Multiple,slotOffsets:[{x:.3,y:-2.1,rotation:0},{x:.2,y:-1.9,rotation:51.4},{x:.7,y:-2,rotation:102.9},{x:.25,y:-1.6,rotation:154.3},{x:.5,y:-1.8,rotation:205.7},{x:.8,y:-1.7,rotation:257.1},{x:.55,y:-1.5,rotation:308.6}],secondsToMature:720*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:j.Coconut,name:"Coconut",baseSellPrice:302,baseWeight:5,baseTileScale:.25,maxScale:3}},Banana:{seed:{tileRef:ie.Banana,name:"Banana Seed",coinPrice:7500,creditPrice:199,rarity:A.Legendary,getCanSpawnInGuild:t=>{let e=t.slice(-1),n=parseInt(e,10);return!isNaN(n)&&n%2===0}},plant:{tileRef:Fe.PalmTree,name:"Banana Plant",harvestType:te.Multiple,slotOffsets:[{x:.2,y:-1.2,rotation:10},{x:.3,y:-1.2,rotation:-10},{x:.4,y:-1.2,rotation:-30},{x:.5,y:-1.2,rotation:-50},{x:.6,y:-1.2,rotation:-70}],secondsToMature:14400,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:j.Banana,name:"Banana",baseSellPrice:1750,baseWeight:.12,baseTileScale:.5,maxScale:1.7}},Lily:{seed:{tileRef:ie.Lily,name:"Lily Seed",coinPrice:2e4,creditPrice:34,rarity:A.Legendary},plant:{tileRef:j.Lily,name:"Lily Plant",harvestType:te.Single,baseTileScale:.75,nudgeY:.4},crop:{tileRef:j.Lily,name:"Lily",baseSellPrice:20123,baseWeight:.02,baseTileScale:.5,maxScale:2.75}},BurrosTail:{seed:{tileRef:ie.BurrosTail,name:"Burro's Tail Cutting",coinPrice:93e3,creditPrice:338,rarity:A.Legendary},plant:{tileRef:j.Trellis,name:"Burro's Tail Plant",harvestType:te.Multiple,slotOffsets:[{x:.37,y:.4,rotation:0},{x:.67,y:.63,rotation:0}],secondsToMature:1800,baseTileScale:.8,rotateSlotOffsetsRandomly:!1},crop:{tileRef:j.BurrosTail,name:"Burro's Tail",baseSellPrice:6e3,baseWeight:.4,baseTileScale:.4,maxScale:2.5}},Mushroom:{seed:{tileRef:ie.Mushroom,name:"Mushroom Spore",coinPrice:15e4,creditPrice:249,rarity:A.Mythic},plant:{tileRef:j.MushroomPlant,name:"Mushroom Plant",harvestType:te.Single,baseTileScale:.8},crop:{tileRef:j.Mushroom,name:"Mushroom",baseSellPrice:16e4,baseWeight:25,baseTileScale:.8,maxScale:3.5}},Cactus:{seed:{tileRef:ie.Cactus,name:"Cactus Seed",coinPrice:25e4,creditPrice:250,rarity:A.Mythic},plant:{tileRef:Fe.Cactus,name:"Cactus Plant",harvestType:te.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:Fe.Cactus,name:"Cactus",baseSellPrice:261e3,baseWeight:1500,baseTileScale:2.5,maxScale:1.8}},Bamboo:{seed:{tileRef:ie.Bamboo,name:"Bamboo Seed",coinPrice:4e5,creditPrice:300,rarity:A.Mythic},plant:{tileRef:Fe.Bamboo,name:"Bamboo Plant",harvestType:te.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:Fe.Bamboo,name:"Bamboo Shoot",baseSellPrice:5e5,baseWeight:1,baseTileScale:2.5,maxScale:2}},Grape:{seed:{tileRef:ie.Grape,name:"Grape Seed",coinPrice:85e4,creditPrice:599,rarity:A.Mythic,getCanSpawnInGuild:t=>t.endsWith("1")},plant:{tileRef:j.SproutVine,name:"Grape Plant",harvestType:te.Multiple,slotOffsets:[{x:.5,y:.5,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:j.Grape,name:"Grape",baseSellPrice:7085,baseWeight:3,baseTileScale:.5,maxScale:2}},Pepper:{seed:{tileRef:ie.Pepper,name:"Pepper Seed",coinPrice:1e6,creditPrice:629,rarity:A.Divine},plant:{tileRef:j.SproutVine,name:"Pepper Plant",harvestType:te.Multiple,slotOffsets:[{x:.1,y:.1,rotation:0},{x:.9,y:.1,rotation:0},{x:.3,y:.3,rotation:0},{x:.7,y:.3,rotation:0},{x:.5,y:.5,rotation:0},{x:.3,y:.7,rotation:0},{x:.7,y:.7,rotation:0},{x:.1,y:.9,rotation:0},{x:.9,y:.9,rotation:0}],secondsToMature:560,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:j.Pepper,name:"Pepper",baseSellPrice:7220,baseWeight:.5,baseTileScale:.3,maxScale:2}},Lemon:{seed:{tileRef:ie.Lemon,name:"Lemon Seed",coinPrice:2e6,creditPrice:500,rarity:A.Divine,getCanSpawnInGuild:t=>t.endsWith("2")},plant:{tileRef:Fe.Tree,name:"Lemon Tree",harvestType:te.Multiple,slotOffsets:[{x:0,y:-1,rotation:85},{x:.9,y:-1.1,rotation:195},{x:.2,y:-.68,rotation:340},{x:.7,y:-.7,rotation:280},{x:.51,y:-1,rotation:0},{x:.45,y:-1.3,rotation:280}],secondsToMature:720*60,baseTileScale:2.3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:j.Lemon,name:"Lemon",baseSellPrice:1e4,baseWeight:.5,baseTileScale:.25,maxScale:3}},PassionFruit:{seed:{tileRef:ie.PassionFruit,name:"Passion Fruit Seed",coinPrice:275e4,creditPrice:679,rarity:A.Divine},plant:{tileRef:j.SproutVine,name:"Passion Fruit Plant",harvestType:te.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1440*60,baseTileScale:1.1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:j.PassionFruit,name:"Passion Fruit",baseSellPrice:24500,baseWeight:9.5,baseTileScale:.35,maxScale:2}},DragonFruit:{seed:{tileRef:ie.DragonFruit,name:"Dragon Fruit Seed",coinPrice:5e6,creditPrice:715,rarity:A.Divine},plant:{tileRef:j.PalmTreeTop,name:"Dragon Fruit Plant",harvestType:te.Multiple,slotOffsets:[{x:.2,y:.1,rotation:0},{x:.1,y:.45,rotation:51.4},{x:.86,y:.2,rotation:102.9},{x:.25,y:.8,rotation:154.3},{x:.5,y:.4,rotation:205.7},{x:.9,y:.6,rotation:257.1},{x:.6,y:.7,rotation:308.6}],secondsToMature:600,baseTileScale:1.6,rotateSlotOffsetsRandomly:!0},crop:{tileRef:j.DragonFruit,name:"Dragon Fruit",baseSellPrice:24500,baseWeight:8.4,baseTileScale:.4,maxScale:2}},Lychee:{seed:{tileRef:ie.Lychee,name:"Lychee Pit",coinPrice:25e6,creditPrice:819,rarity:A.Divine,getCanSpawnInGuild:t=>t.endsWith("2")},plant:{tileRef:j.BushyTree,name:"Lychee Plant",harvestType:te.Multiple,slotOffsets:[{x:.1,y:.4,rotation:85},{x:.8,y:.3,rotation:195},{x:.2,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.4,rotation:0},{x:.3,y:.2,rotation:280}],secondsToMature:1440*60,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:j.Lychee,name:"Lychee Fruit",baseSellPrice:5e4,baseWeight:9,baseTileScale:.2,maxScale:2}},Sunflower:{seed:{tileRef:ie.Sunflower,name:"Sunflower Seed",coinPrice:1e8,creditPrice:900,rarity:A.Divine},plant:{tileRef:j.StemFlower,name:"Sunflower Plant",harvestType:te.Multiple,slotOffsets:[{x:.51,y:-.1,rotation:0}],secondsToMature:1440*60,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",baseTileScale:.8,nudgeY:.15},crop:{tileRef:j.Sunflower,name:"Sunflower",baseSellPrice:75e4,baseWeight:10,baseTileScale:.5,maxScale:2.5}},Starweaver:{seed:{tileRef:ie.Starweaver,name:"Starweaver Pod",coinPrice:1e9,creditPrice:1e3,rarity:A.Celestial},plant:{tileRef:j.StarweaverPlant,name:"Starweaver Plant",harvestType:te.Multiple,slotOffsets:[{x:.5,y:-.158,rotation:0}],secondsToMature:1440*60,baseTileScale:1.5,rotateSlotOffsetsRandomly:!1,nudgeY:.25},crop:{tileRef:j.Starweaver,name:"Starweaver Fruit",baseSellPrice:1e7,baseWeight:10,baseTileScale:.6,maxScale:2}}},Ka={Gold:{name:"Gold",baseChance:.01,coinMultiplier:25},Rainbow:{name:"Rainbow",baseChance:.001,coinMultiplier:50},Wet:{name:"Wet",baseChance:0,coinMultiplier:2,tileRef:rt.Wet},Chilled:{name:"Chilled",baseChance:0,coinMultiplier:2,tileRef:rt.Chilled},Frozen:{name:"Frozen",baseChance:0,coinMultiplier:10,tileRef:rt.Frozen},Dawnlit:{name:"Dawnlit",baseChance:0,coinMultiplier:2,tileRef:rt.Dawnlit},Ambershine:{name:"Ambershine",baseChance:0,coinMultiplier:5,tileRef:rt.Ambershine}},Ot={CommonEgg:{tileRef:ye.CommonEgg,name:"Common Egg",coinPrice:1e5,creditPrice:19,rarity:A.Common,initialTileScale:.3,baseTileScale:.8,secondsToHatch:600,faunaSpawnWeights:{Worm:60,Snail:35,Bee:5}},UncommonEgg:{tileRef:ye.UncommonEgg,name:"Uncommon Egg",coinPrice:1e6,creditPrice:48,rarity:A.Uncommon,initialTileScale:.3,baseTileScale:.8,secondsToHatch:3600,faunaSpawnWeights:{Chicken:65,Bunny:25,Dragonfly:10}},RareEgg:{tileRef:ye.RareEgg,name:"Rare Egg",coinPrice:1e7,creditPrice:99,rarity:A.Rare,initialTileScale:.3,baseTileScale:.8,secondsToHatch:21600,faunaSpawnWeights:{Pig:90,Cow:10}},LegendaryEgg:{tileRef:ye.LegendaryEgg,name:"Legendary Egg",coinPrice:1e8,creditPrice:249,rarity:A.Legendary,initialTileScale:.3,baseTileScale:.8,secondsToHatch:43200,faunaSpawnWeights:{Squirrel:60,Turtle:30,Goat:10}},MythicalEgg:{tileRef:ye.MythicalEgg,name:"Mythical Egg",coinPrice:1e9,creditPrice:599,rarity:A.Mythic,initialTileScale:.3,baseTileScale:.8,secondsToHatch:86400,faunaSpawnWeights:{Butterfly:75,Capybara:5,Peacock:20}}},Bt={Worm:{tileRef:ye.Worm,name:"Worm",description:"",coinsToFullyReplenishHunger:500,innateAbilityWeights:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.1,moveProbability:.1,hoursToMature:12,rarity:A.Common,tileTransformOrigin:"bottom",nudgeY:.25,diet:["Carrot","Strawberry","Aloe","Tomato","Apple"]},Snail:{tileRef:ye.Snail,name:"Snail",description:"",coinsToFullyReplenishHunger:1e3,innateAbilityWeights:{CoinFinderI:100},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.15,moveProbability:.01,hoursToMature:12,rarity:A.Common,tileTransformOrigin:"bottom",diet:["Blueberry","Tomato","Corn","Daffodil"],nudgeY:-.25},Bee:{tileRef:ye.Bee,name:"Bee",coinsToFullyReplenishHunger:1500,innateAbilityWeights:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,maturitySellPrice:3e4,matureWeight:.2,moveProbability:.5,hoursToMature:12,rarity:A.Common,diet:["Strawberry","Blueberry","OrangeTulip","Daffodil","Lily"]},Chicken:{tileRef:ye.Chicken,name:"Chicken",coinsToFullyReplenishHunger:3e3,innateAbilityWeights:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,maturitySellPrice:5e4,matureWeight:3,moveProbability:.2,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Aloe","Corn","Watermelon","Pumpkin"]},Bunny:{tileRef:ye.Bunny,name:"Bunny",coinsToFullyReplenishHunger:750,innateAbilityWeights:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,maturitySellPrice:75e3,matureWeight:2,moveProbability:.3,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Carrot","Strawberry","Blueberry","Echeveria"]},Dragonfly:{tileRef:ye.Dragonfly,name:"Dragonfly",coinsToFullyReplenishHunger:250,innateAbilityWeights:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,maturitySellPrice:15e4,matureWeight:.2,moveProbability:.7,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"center",diet:["Apple","OrangeTulip","Echeveria"]},Pig:{tileRef:ye.Pig,name:"Pig",coinsToFullyReplenishHunger:5e4,innateAbilityWeights:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,maturitySellPrice:5e5,matureWeight:200,moveProbability:.2,hoursToMature:72,rarity:A.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","Pumpkin","Mushroom","Bamboo"]},Cow:{tileRef:ye.Cow,name:"Cow",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,maturitySellPrice:1e6,matureWeight:600,moveProbability:.1,hoursToMature:72,rarity:A.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Coconut","Banana","BurrosTail","Mushroom"]},Squirrel:{tileRef:ye.Squirrel,name:"Squirrel",coinsToFullyReplenishHunger:15e3,innateAbilityWeights:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,maturitySellPrice:5e6,matureWeight:.5,moveProbability:.4,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Banana","Grape"]},Turtle:{tileRef:ye.Turtle,name:"Turtle",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,maturitySellPrice:1e7,matureWeight:150,moveProbability:.05,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","BurrosTail","Bamboo","Pepper"]},Goat:{tileRef:ye.Goat,name:"Goat",coinsToFullyReplenishHunger:2e4,innateAbilityWeights:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,maturitySellPrice:2e7,matureWeight:100,moveProbability:.2,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Coconut","Cactus","Pepper"]},Butterfly:{tileRef:ye.Butterfly,name:"Butterfly",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,maturitySellPrice:5e7,matureWeight:.2,moveProbability:.6,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"center",diet:["Daffodil","Lily","Grape","Lemon","Sunflower"]},Capybara:{tileRef:ye.Capybara,name:"Capybara",coinsToFullyReplenishHunger:15e4,innateAbilityWeights:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,maturitySellPrice:2e8,matureWeight:50,moveProbability:.2,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Lemon","PassionFruit","DragonFruit","Lychee"]},Peacock:{tileRef:ye.Peacock,name:"Peacock",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,maturitySellPrice:1e8,matureWeight:5,moveProbability:.2,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Cactus","Sunflower","Lychee"]}};var Dt={WateringCan:{tileRef:St.WateringCan,name:"Watering Can",coinPrice:5e3,creditPrice:2,rarity:A.Common,description:"Speeds up growth of plant by 5 minutes. SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.6,maxInventoryQuantity:99},PlanterPot:{tileRef:St.PlanterPot,name:"Planter Pot",coinPrice:25e3,creditPrice:5,rarity:A.Common,description:"Extract a plant to your inventory (can be replanted). SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.8},Shovel:{tileRef:St.Shovel,name:"Shovel",coinPrice:1e6,creditPrice:100,rarity:A.Uncommon,description:"Remove plants from your garden. UNLIMITED USES.",isOneTimePurchase:!0,baseTileScale:.7},RainbowPotion:{tileRef:St.RainbowPotion,name:"Rainbow Potion",coinPrice:1/0,creditPrice:1/0,rarity:A.Celestial,description:"Adds the Rainbow mutation to a crop in your garden. SINGLE USE.",isOneTimePurchase:!0,baseTileScale:1}},Gt={SmallRock:{tileRef:le.SmallRock,name:"Small Garden Rock",coinPrice:1e3,creditPrice:2,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MediumRock:{tileRef:le.MediumRock,name:"Medium Garden Rock",coinPrice:2500,creditPrice:5,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.21},LargeRock:{tileRef:le.LargeRock,name:"Large Garden Rock",coinPrice:5e3,creditPrice:10,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.1},WoodBench:{tileRef:le.WoodBench,name:"Wood Bench",coinPrice:1e4,creditPrice:15,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},WoodArch:{tileRef:le.WoodArch,name:"Wood Arch",coinPrice:2e4,creditPrice:25,rarity:A.Common,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},WoodBridge:{tileRef:le.WoodBridge,name:"Wood Bridge",coinPrice:4e4,creditPrice:35,rarity:A.Common,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},WoodLampPost:{tileRef:le.WoodLampPost,name:"Wood Lamp Post",coinPrice:8e4,creditPrice:49,rarity:A.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodOwl:{tileRef:le.WoodOwl,name:"Wood Owl",coinPrice:9e4,creditPrice:59,rarity:A.Common,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},WoodBirdhouse:{tileRef:le.Birdhouse,name:"Wood Birdhouse",coinPrice:1e5,creditPrice:69,rarity:A.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneBench:{tileRef:le.StoneBench,name:"Stone Bench",coinPrice:1e6,creditPrice:75,rarity:A.Uncommon,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},StoneArch:{tileRef:le.StoneArch,name:"Stone Arch",coinPrice:4e6,creditPrice:124,rarity:A.Uncommon,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},StoneBridge:{tileRef:le.StoneBridge,name:"Stone Bridge",coinPrice:5e6,creditPrice:179,rarity:A.Uncommon,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},StoneLampPost:{tileRef:le.StoneLampPost,name:"Stone Lamp Post",coinPrice:8e6,creditPrice:199,rarity:A.Uncommon,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneGnome:{tileRef:le.StoneGnome,name:"Stone Gnome",coinPrice:9e6,creditPrice:219,rarity:A.Uncommon,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},StoneBirdbath:{tileRef:le.StoneBirdbath,name:"Stone Birdbath",coinPrice:1e7,creditPrice:249,rarity:A.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.46},MarbleBench:{tileRef:le.MarbleBench,name:"Marble Bench",coinPrice:75e6,creditPrice:349,rarity:A.Rare,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},MarbleArch:{tileRef:le.MarbleArch,name:"Marble Arch",coinPrice:1e8,creditPrice:399,rarity:A.Rare,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},MarbleBridge:{tileRef:le.MarbleBridge,name:"Marble Bridge",coinPrice:15e7,creditPrice:429,rarity:A.Rare,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},MarbleLampPost:{tileRef:le.MarbleLampPost,name:"Marble Lamp Post",coinPrice:2e8,creditPrice:449,rarity:A.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},MarbleBlobling:{tileRef:le.MarbleBlobling,name:"Marble Blobling",coinPrice:3e8,creditPrice:499,rarity:A.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.56},MiniFairyCottage:{tileRef:le.MiniFairyCottage,name:"Mini Fairy Cottage",coinPrice:5e8,creditPrice:549,rarity:A.Rare,baseTileScale:1.1,isOneTimePurchase:!1,nudgeY:-.37},StrawScarecrow:{tileRef:le.StrawScarecrow,name:"Straw Scarecrow",coinPrice:1e9,creditPrice:599,rarity:A.Legendary,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.65},MiniFairyForge:{tileRef:le.MiniFairyForge,name:"Mini Fairy Forge",coinPrice:5e9,creditPrice:979,rarity:A.Legendary,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyKeep:{tileRef:le.MiniFairyKeep,name:"Mini Fairy Keep",coinPrice:25e9,creditPrice:1249,rarity:A.Mythic,baseTileScale:1.05,isOneTimePurchase:!1,nudgeY:-.33}};var In="qws:pets:overrides:v1",Mn="qws:pets:ui:v1",En="qws:pets:teams:v1",An="qws:pets:teamSearch:v1",bn={enabled:!1,thresholdPct:10,crops:{}},jt={selectedPetId:null};function at(){try{let t=localStorage.getItem(In);if(!t)return{};let e=JSON.parse(t);return e&&typeof e=="object"?e:{}}catch{return{}}}function vt(t){try{localStorage.setItem(In,JSON.stringify(t))}catch{}}function Kt(){try{let t=localStorage.getItem(Mn);if(!t)return{...jt};let e=JSON.parse(t);return{...jt,...e||{}}}catch{return{...jt}}}function vr(t){try{localStorage.setItem(Mn,JSON.stringify(t))}catch{}}function kn(){try{let t=localStorage.getItem(En);if(!t)return[];let e=JSON.parse(t);return Array.isArray(e)?e.map(n=>({id:String(n?.id||""),name:String(n?.name||"Team"),slots:Array.isArray(n?.slots)?n.slots.slice(0,3).map(r=>r?String(r):null):[null,null,null]})).filter(n=>n.id):[]}catch{return[]}}function Ye(t){try{localStorage.setItem(En,JSON.stringify(t))}catch{}}function Sn(){try{return crypto.randomUUID()}catch{return`t_${Date.now().toString(36)}_${Math.random().toString(16).slice(2)}`}}var ot=kn(),wr=new Set;function xr(){let t=ot.slice();wr.forEach(e=>{try{e(t)}catch{}})}function Pr(){try{let t=localStorage.getItem(An),e=t?JSON.parse(t):{};return e&&typeof e=="object"?e:{}}catch{return{}}}function Tr(t){try{localStorage.setItem(An,JSON.stringify(t))}catch{}}var wt=Pr(),Yt=new Set;function Cr(t){let e=wt[t]||"";Yt.forEach(n=>{try{n(t,e)}catch{}})}function Ir(t){let r=Bt?.[t]?.coinsToFullyReplenishHunger;return typeof r=="number"&&Number.isFinite(r)&&r>0?r:3e3}function Mr(t){return Math.max(0,Math.min(100,t))}function Er(t){let n=Bt?.[t],r=n?.diet??n?.compatibleCrops??n?.crops??[];return(Array.isArray(r)?r:[]).filter(s=>typeof s=="string"&&s.length>0)}function je(t){let e=t??bn;return{enabled:!!e.enabled,thresholdPct:Math.min(100,Math.max(1,Number(e.thresholdPct)||bn.thresholdPct)),crops:{...e.crops||{}}}}async function Ar(t){try{let e=await B.getPets();return(Array.isArray(e)?e:[]).find(r=>String(r?.slot?.id||"")===String(t))??null}catch{return null}}var lt=[],xt=new Map,Ut=null;function kr(t){try{console.log(`[Pets] Autofeed trigger for ${t.species} (${t.petId}) \u2014 hunger ${t.hungerPct}% < ${t.thresholdPct}%`,{allowedCrops:t.allowedCrops,chosenItem:t.chosenItem,didUnfavorite:t.didUnfavorite})}catch{}try{Ut?.(t)}catch{}}function Rr(t,e){let n=Array.isArray(e)?e:[];for(let r of n){let a=String(r?.species||"");if(a&&t.has(a))return r}return null}async function Lr(t){let e=String(t?.slot?.id||"");if(!e)return;let n=K.getOverride(e);if(!n.enabled){xt.set(e,!1);return}let r=K.getHungerPctFor(t),a=Math.max(1,Math.min(100,n.thresholdPct|0||10)),s=xt.get(e)===!0,i=r<a;if(i&&!s){let o;try{o=await K.getPetAllowedCrops(e)}catch{let w=String(t?.slot?.petSpecies||"");o=new Set(K.getCompatibleCropsForSpecies(w))}let d=Array.from(o),c=null,b=!1;try{let w=await B.getCropInventoryState();if(c=Rr(o,w),c?.id){try{await B.isFavoriteItem(c.id)&&(await B.toggleFavoriteItem(c.id),b=!0)}catch{}try{B.feedPet&&await B.feedPet(e,c.id)}catch{}}}catch{}kr({pet:t,petId:e,species:String(t?.slot?.petSpecies||""),hungerPct:r,thresholdPct:a,allowedCrops:d,chosenItem:c,didUnfavorite:b})}xt.set(e,i)}async function st(){let t=Array.isArray(lt)?lt:[];for(let e of t)try{await Lr(e)}catch{}}var Ue=null,Pt=[],Oe=[],Jt=new Set,vn=null,wn=null,$t=null,Vt=null,Tt=t=>typeof t=="string"?t:"",Rn=t=>typeof t=="string"?t:null,Ct=t=>Number.isFinite(t)?t:0,It=t=>Array.isArray(t)?t.filter(e=>typeof e=="string"):[];function Ln(t){if(!t||t.itemType!=="Pet")return null;let e=Tt(t.id);return e?{id:e,itemType:"Pet",petSpecies:Tt(t.petSpecies??t.data?.petSpecies),name:Rn(t.name??t.data?.name??null),xp:Ct(t.xp??t.data?.xp),hunger:Ct(t.hunger??t.data?.hunger),mutations:It(t.mutations??t.data?.mutations),targetScale:Number.isFinite(t.targetScale??t.data?.targetScale)?Number(t.targetScale??t.data?.targetScale):void 0,abilities:It(t.abilities??t.data?.abilities)}:null}function Hn(t){let e=t?.slot;if(!e||typeof e!="object")return null;let n=Tt(e.id);return n?{id:n,itemType:"Pet",petSpecies:Tt(e.petSpecies),name:Rn(e.name??null),xp:Ct(e.xp),hunger:Ct(e.hunger),mutations:It(e.mutations),targetScale:Number.isFinite(e.targetScale)?Number(e.targetScale):void 0,abilities:It(e.abilities)}:null}function Nn(t){return JSON.stringify({id:t.id,itemType:"Pet",petSpecies:t.petSpecies,name:t.name??null,mutations:Array.isArray(t.mutations)?t.mutations:[],targetScale:Number.isFinite(t.targetScale)?t.targetScale:null,abilities:Array.isArray(t.abilities)?t.abilities:[]})}function xn(t){let e=new Map,n=Array.isArray(t?.items)?t.items:Array.isArray(t)?t:[];for(let r of n){let a=Ln(r);a&&e.set(a.id,Nn(a))}return e}function Pn(t){let e=new Map,n=Array.isArray(t)?t:[];for(let r of n){let a=Hn(r);a&&e.set(a.id,Nn(a))}return e}function Tn(t,e){if(!t||t.size!==e.size)return!1;for(let[n,r]of e)if(t.get(n)!==r)return!1;return!0}function zt(){let t=new Map,e=Array.isArray(Ue?.items)?Ue.items:Array.isArray(Ue)?Ue:[];for(let a of e){let s=Ln(a);s&&s.id&&t.set(s.id,s)}let n=Array.isArray(Pt)?Pt:[];for(let a of n){let s=Hn(a);s&&s.id&&t.set(s.id,s)}Oe=Array.from(t.values());let r=Oe.slice();Jt.forEach(a=>{try{a(r)}catch{}})}async function it(){if(!vn){let t=await ze.subNow(e=>{let n=xn(e);Tn($t,n)||($t=n,Ue=e,zt())});vn=()=>{try{t()}catch{}}}if(!wn){let t=await Le.subNow(e=>{let n=Pn(e);Tn(Vt,n)||(Vt=n,Pt=Array.isArray(e)?e:[],zt())});wn=()=>{try{t()}catch{}}}if(!Oe.length)try{let[t,e]=await Promise.all([ze.get(),Le.get()]);$t=xn(t),Vt=Pn(e),Ue=t,Pt=Array.isArray(e)?e:[],zt()}catch{}}var K={getPets(){return B.getPets()},onPetsChange(t){return B.onPetsChange(t)},onPetsChangeNow(t){return B.onPetsChangeNow(t)},async getPetById(t){await it();let e=String(t||"");return e?Oe.find(n=>n.id===e)??null:null},getCompatibleCropsFor(t){return Er(t)},getCompatibleCropsForSpecies(t){return this.getCompatibleCropsFor(t)},getMaxHungerForSpecies(t){return Ir(t)},getHungerPctFor(t){let e=Number(t?.slot?.hunger)||0,n=String(t?.slot?.petSpecies||""),r=this.getMaxHungerForSpecies(n),a=e/r*100;return+Mr(a).toFixed(1)},getOverride(t){let e=at();return je(e[t])},setOverride(t,e){let n=at(),r=je(n[t]),a={enabled:e.enabled??r.enabled,thresholdPct:Number.isFinite(e.thresholdPct)?Math.min(100,Math.max(1,Number(e.thresholdPct))):r.thresholdPct,crops:{...r.crops,...e.crops||{}}};return n[t]=a,vt(n),st(),a},updateOverride(t,e){let n=at(),r=je(n[t]),a=je(e(r));return n[t]=a,vt(n),st(),a},resetOverride(t){let e=at();return e[t]=je(void 0),vt(e),st(),e[t]},ensureCropEntry(t,e){let n=at(),r=je(n[t]);return r.crops[e]||(r.crops[e]={allowed:!0},n[t]=r,vt(n),st()),r.crops[e]},setCropRule(t,e,n){return this.updateOverride(t,r=>{let a=je(r),s=a.crops[e]??{allowed:!0};return a.crops[e]={allowed:n.allowed??s.allowed},a})},getPetAutofeedEnabled(t){return this.getOverride(t).enabled},async setPetAutofeedEnabled(t,e){return this.setOverride(t,{enabled:!!e})},getPetAutofeedThresholdPct(t){return this.getOverride(t).thresholdPct},async setPetAutofeedThresholdPct(t,e){let n=Math.min(100,Math.max(1,Math.floor(Number(e)||10)));return this.setOverride(t,{thresholdPct:n})},async getPetAllowedCrops(t){let e=this.getOverride(t),r=(await Ar(t))?.slot?.petSpecies||"",a=this.getCompatibleCropsFor(r),s=new Set;for(let i of a){let o=e.crops[i];(!o||o.allowed)&&s.add(i)}return s},async setPetAllowedCrop(t,e,n){return this.setCropRule(t,e,{allowed:!!n})},buildCompatibleCropRows(t){let e=t?.slot?.petSpecies??"",n=String(t?.slot?.id??""),r=this.getCompatibleCropsFor(e),a=this.getOverride(n);return r.map(s=>{let i=a.crops[s]??{allowed:!0};return{crop:s,allowed:!!i.allowed}})},setTeamsOrder(t){let e=new Map(this._teams.map(r=>[r.id,r])),n=[];for(let r of t){let a=e.get(r);a&&(n.push(a),e.delete(r))}for(let r of e.values())n.push(r);this._teams=n,Ye(this._teams),this._notifyTeamSubs()},async startAutofeedWatcher(t){Ut=t??null;let e=await B.onPetsChangeNow(n=>{lt=Array.isArray(n)?n.slice():[],st()});return()=>{try{e()}catch{}lt=[],xt.clear(),Ut=null}},getUIState(){return Kt()},setUIState(t){let n={...Kt(),...t||{}};return vr(n),n},setSelectedPet(t){return this.setUIState({selectedPetId:t})},getSelectedPetId(){return Kt().selectedPetId??null},_teams:kn(),_teamSubs:new Set,_notifyTeamSubs(){let t=this.getTeams();this._teamSubs.forEach(e=>{try{e(t)}catch{}})},getTeams(){return Array.isArray(this._teams)?this._teams.map(t=>({...t,slots:t.slots.slice(0,3)})):[]},onTeamsChange(t){this._teamSubs.add(t);try{t(this.getTeams())}catch{}return()=>{this._teamSubs.delete(t)}},async onTeamsChangeNow(t){let e=this.onTeamsChange(t);try{t(this.getTeams())}catch{}return e},createTeam(t){let e={id:Sn(),name:t?.trim()||`Team ${this._teams.length+1}`,slots:[null,null,null]};return this._teams.push(e),Ye(this._teams),this._notifyTeamSubs(),e},duplicateTeam(t){let e=this._teams.find(r=>r.id===t);if(!e)return null;let n={id:Sn(),name:`${e.name} (copy)`,slots:e.slots.slice(0,3)};return this._teams.push(n),Ye(this._teams),this._notifyTeamSubs(),n},deleteTeam(t){let e=this._teams.findIndex(n=>n.id===t);return e<0?!1:(this._teams.splice(e,1),Ye(this._teams),this._notifyTeamSubs(),!0)},saveTeam(t){let e=this._teams.findIndex(a=>a.id===t.id);if(e<0)return null;let n=this._teams[e],r={id:n.id,name:typeof t.name=="string"?t.name:n.name,slots:Array.isArray(t.slots)?t.slots.slice(0,3):n.slots};return this._teams[e]=r,Ye(this._teams),this._notifyTeamSubs(),r},updateTeam(t,e){let n=ot.findIndex(s=>s.id===t);if(n<0)return null;let r=ot[n],a={...r,...e,slots:e.slots?[...e.slots]:r.slots};return ot[n]=a,Ye(ot),xr(),a},getTeamSearch(t){return wt[t]||""},setTeamSearch(t,e){wt[t]=(e||"").trim(),Tr(wt),Cr(t)},onTeamSearchChange(t){return Yt.add(t),()=>{Yt.delete(t)}},getTeamById(t){let e=this._teams.find(n=>n.id===t)||null;return e?{...e,slots:e.slots.slice(0,3)}:null},async getTeamFilteredInventoryPets(t){await it();let e=(this.getTeamSearch(t)||"").toLowerCase(),n=Oe.slice();if(!e)return n;let r=a=>(a??"").toLowerCase();return n.filter(a=>r(a.id).includes(e)||r(a.petSpecies).includes(e)||r(a.name).includes(e)||a.abilities.some(s=>r(s).includes(e))||a.mutations.some(s=>r(s).includes(e)))},async getTeamSlotOptions(t,e){await it();let n=this.getTeamById(t),r=await this.getTeamFilteredInventoryPets(t);if(!n)return r;let a=Math.max(0,Math.min(2,Math.floor(e))),s=n.slots[a]||null,i=new Set;n.slots.forEach((d,c)=>{c!==a&&d&&i.add(d)});let o=r.filter(d=>!i.has(d.id));if(s&&!o.some(d=>d.id===s)){let d=Oe.find(c=>c.id===s);d&&(o=[d,...o])}return o},_logs:[],_logsMax:500,_seenPerfByPet:new Map,_logSubs:new Set,async startAbilityLogsWatcher(){let t=await fn.subNow(e=>{console.log("[Pets] myPetsAbilitiesTrigger changed (flat)",e),this._ingestAbilityMap(e)});return()=>{try{t()}catch{}}},getAbilityLogs(t){let e=t?.abilityIds&&t.abilityIds.length?new Set(t.abilityIds):null,n=Number.isFinite(t?.since)?t.since:0,r=Math.max(0,Math.floor(t?.limit??0)),a=this._logs.filter(s=>(n?s.performedAt>=n:!0)&&(e?e.has(s.abilityId):!0));return a=a.sort((s,i)=>i.performedAt-s.performedAt),r?a.slice(0,r):a},onAbilityLogs(t){this._logSubs.add(t);try{t(this.getAbilityLogs())}catch{}return()=>{this._logSubs.delete(t)}},getSeenAbilityIds(){let t=new Set;for(let e of this._logs)t.add(e.abilityId);return Array.from(t).sort()},clearAbilityLogs(){this._logs.length=0,this._seenPerfByPet.clear(),this._notifyLogSubs()},_notifyLogSubs(){let t=this.getAbilityLogs();this._logSubs.forEach(e=>{try{e(t)}catch{}})},_pushLog(t){this._logs.push(t),this._logs.length>this._logsMax&&this._logs.splice(0,this._logs.length-this._logsMax),this._notifyLogSubs()},_ingestAbilityMap(t){if(!(!t||typeof t!="object"))for(let e of Object.keys(t)){let n=t[e];if(!n||typeof n!="object")continue;let r=n.abilityId??null,a=Number(n.performedAt)||0;if(!r||!a)continue;let s=this._seenPerfByPet.get(e)||0;if(a<=s)continue;let i=lt.find(d=>String(d?.slot?.id||"")===e)||null,o={petId:e,species:i?.slot?.petSpecies||void 0,name:i?.slot?.name??void 0,abilityId:String(r),data:n.data,performedAt:a};this._seenPerfByPet.set(e,a),this._pushLog(o)}},async getInventoryPets(){return await it(),Oe.slice()},async searchInventoryPets(t){let e=await this.getInventoryPets(),n=a=>(a??"").toLowerCase(),r=(t||"").toLowerCase().trim();return r?e.filter(a=>n(a.id).includes(r)||n(a.petSpecies).includes(r)||n(a.name).includes(r)||a.abilities.some(s=>n(s).includes(r))||a.mutations.some(s=>n(s).includes(r))):e},onInventoryPetsChange(t){it(),Jt.add(t);try{t(Oe.slice())}catch{}return()=>{Jt.delete(t)}},async useTeam(t){let e=this.getTeams().find(r=>r.id===t)||null;if(console.log("test"),!e)throw new Error("Team not found");let n=(e.slots||[]).filter(r=>typeof r=="string"&&r.length>0).slice(0,3);return n.length?Cn(n):{swapped:0,placed:0,skipped:0}},async useTeamSlots(t){let e=(Array.isArray(t)?t:[]).filter(n=>typeof n=="string"&&n.length>0).slice(0,3);return e.length?Cn(e):{swapped:0,placed:0,skipped:0}}};async function Hr(){try{let t=await B.getPets();return(Array.isArray(t)?t:[]).map(n=>String(n?.slot?.id||"")).filter(n=>!!n).slice(0,3)}catch{return[]}}async function Cn(t){let e=await Hr(),n=new Set(t),r=e.filter(b=>!n.has(b)),a=Math.max(0,e.length-t.length);if(a>0){let b=r.slice(0,a);for(let w of b)try{await B.storePet(w),e=e.filter(S=>S!==w)}catch(S){console.warn("[Pets] storePet failed:",w,S)}}let s=new Set;for(let b of t)e.includes(b)&&s.add(b);let i=0,o=0,d=0;s.size&&(e=e.filter(b=>!s.has(b)),d=s.size);let c=t.filter(b=>!s.has(b));for(let b of c){let w=e.shift();try{w?(await B.swapPet(w,b),i++):(await B.placePet(b,{x:0,y:0},"Boardwalk",64),o++)}catch(S){console.warn("[Pets] useTeam op failed for",{invId:b,slotId:w,err:S})}}return{swapped:i,placed:o,skipped:d}}function Nr(t){return t&&typeof t=="object"&&"species"in t}function _r(t){return t&&typeof t=="object"&&"toolId"in t}function Wr(t){return t&&typeof t=="object"&&"eggId"in t}function qr(t){return t&&typeof t=="object"&&"decorId"in t}function Fr(t){if(!t||typeof t!="object")return null;if(typeof t.secondsUntilRestock=="number")return t.secondsUntilRestock;for(let e of Object.keys(t)){let n=t[e];if(typeof n=="number"&&e.toLowerCase().includes("secondsuntilrestock"))return n}return null}function Or(t,e){let n=new Set,r=[t];for(;r.length;){let a=r.pop();if(!(!a||typeof a!="object")&&!n.has(a)){n.add(a);for(let s of Object.keys(a)){let i=a[s];if(Array.isArray(i)&&i.length&&i.every(o=>typeof o=="object")&&i.some(e)){let o=Fr(a);return{items:i,sec:o}}}for(let s of Object.keys(a)){let i=a[s];i&&typeof i=="object"&&r.push(i)}}}return{items:[],sec:null}}function Br(t){return t==="seeds"?Nr:t==="tools"?_r:t==="eggs"?Wr:qr}var Re={async readRawData(){return Ht.get().catch(()=>({}))},async read(t){let e=await this.readRawData();return Or(e,Br(t))},identityFor(t,e){if(typeof e?.name=="string"&&e.name.trim())return e.name.trim();let n={seeds:Ge,tools:Dt,eggs:Ot,decor:Gt},r={seeds:[String(e.species??e.id??"")],tools:[String(e.toolId??e.id??"")],eggs:[String(e.eggId??e.id??"")],decor:[String(e.decorId??e.id??"")]},a=n[t];for(let s of r[t]){if(!s)continue;let i=a[s];if(i){if(t==="seeds"&&i.seed?.name)return i.seed.name;if(i.name)return i.name}}return String(e.species??e.toolId??e.eggId??e.decorId??e.id??"?")},getQty(t){let e=t.initialStock??0,n=Number(e);return Number.isFinite(n)?n:0},priceFromCatalog(t,e){let n=t==="seeds"?Ge:t==="tools"?Dt:t==="eggs"?Ot:Gt,r=[e.species,e.toolId,e.eggId,e.decorId].filter(Boolean).map(String);for(let a of r){let s=n[a];if(s)if(t==="seeds"){let i=Number(s?.seed?.coinPrice);if(Number.isFinite(i))return i}else{let i=Number(s?.coinPrice);if(Number.isFinite(i))return i}}},keyForAuto(t,e){return`${t}:${this.identityFor(t,e)}`},keyForOffer(t,e){let n=this.priceFromCatalog(t,e)??0;return`${this.keyForAuto(t,e)}@${n}`},invKeyFromAutoKey(t,e){let n=e.indexOf(":");return n>=0?e.slice(n+1):e},buyOne(t,e){if(t==="seeds"){let n=e.species??e.name;n&&de({type:"PurchaseSeed",species:n});return}if(t==="tools"){let n=e.toolId??e.id;n&&de({type:"PurchaseTool",toolId:n});return}if(t==="eggs"){let n=e.eggId??e.id;n&&de({type:"PurchaseEgg",eggId:n});return}if(t==="decor"){let n=e.decorId??e.id;n&&de({type:"PurchaseDecor",decorId:n});return}},sleep(t){return new Promise(e=>setTimeout(e,t))},async buyAllInStock(t,e,n){let r=Math.max(0,this.getQty(e));if(r===0)return;let a=typeof n?.limitPerTick=="number"&&isFinite(n.limitPerTick)?Math.max(0,n.limitPerTick):r,s=typeof n?.delayMs=="number"&&isFinite(n.delayMs)?Math.max(0,n.delayMs):0,i=Math.min(r,a),o=0;for(let d=0;d<i;d++){try{await this.buyOne(t,e),o++}catch(c){console.warn("[buyAllInStock] failed",t,this.identityFor(t,e),c);break}s>0&&await this.sleep(s)}},async readMyInventory(){return ze.get().catch(()=>null)},async readInventoryMaps(){let t=await this.readMyInventory(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};for(let n of t?.items||[]){if(!n||typeof n!="object")continue;let r=Number.isFinite(+n.quantity)?+n.quantity:1;n.itemType==="Seed"&&n.species&&e.seeds.set(String(n.species),(e.seeds.get(String(n.species))??0)+r),n.itemType==="Tool"&&n.toolId&&e.tools.set(String(n.toolId),(e.tools.get(String(n.toolId))??0)+r),n.itemType==="Egg"&&n.eggId&&e.eggs.set(String(n.eggId),(e.eggs.get(String(n.eggId))??0)+r),n.itemType==="Decor"&&n.decorId&&e.decor.set(String(n.decorId),(e.decor.get(String(n.decorId))??0)+r)}return e},async onInventoryChange(t){let e=await ze.sub(async()=>{try{t(await this.readInventoryMaps())}catch{}});try{t(await this.readInventoryMaps())}catch{}return e},async onQuantityChange(t,e){let n="",r=async()=>{try{let s=await this.read(t),i=this.signatureFor(t,s);i!==n&&(n=i,e())}catch{}},a=await Ht.sub(r);return await r(),a},signatureFor(t,e){let n=e.items.map(r=>{let a=this.keyForOffer(t,r),s=this.getQty(r);return`${a}#${s}`});return n.sort(),`${t}:${n.join("|")}`},async readMyPurchases(){return Nt.get().catch(()=>null)},async readPurchasesMaps(){let t=await this.readMyPurchases(),e={seeds:new Map,tools:new Map,eggs:new Map,decor:new Map};if(!t)return e;let n=t.seed?.purchases??{};for(let[i,o]of Object.entries(n))e.seeds.set(i,Number(o)||0);let r=t.tool?.purchases??{};for(let[i,o]of Object.entries(r))e.tools.set(i,Number(o)||0);let a=t.egg?.purchases??{};for(let[i,o]of Object.entries(a))e.eggs.set(i,Number(o)||0);let s=t.decor?.purchases??{};for(let[i,o]of Object.entries(s))e.decor.set(i,Number(o)||0);return e},async onPurchasesChange(t){let e=await Nt.sub(async()=>{try{t(await this.readPurchasesMaps())}catch{}});try{t(await this.readPurchasesMaps())}catch{}return e}};var Te=class{constructor(e={}){this.opts=e;_(this,"root");_(this,"tabBar");_(this,"views");_(this,"tabs",new Map);_(this,"events",new Map);_(this,"currentId",null);_(this,"lsKeyActive");this.lsKeyActive=`menu:${e.id||"default"}:activeTab`}mount(e){if(this.ensureStyles(),e.innerHTML="",this.root=Q("div",`qmm ${this.opts.classes||""} ${this.opts.compact?"qmm-compact":""}`),this.opts.startHidden&&(this.root.style.display="none"),this.tabBar=Q("div","qmm-tabs"),this.views=Q("div","qmm-views"),this.root.appendChild(this.tabBar),this.root.appendChild(this.views),e.appendChild(this.root),this.tabs.size){for(let[n,r]of this.tabs)this.createTabView(n,r);this.restoreActive()}this.updateTabsBarVisibility(),this.emit("mounted")}unmount(){this.root?.parentElement&&this.root.parentElement.removeChild(this.root),this.emit("unmounted")}setVisible(e){this.root&&(this.root.style.display=e?"":"none",this.emit(e?"show":"hide"))}toggle(){if(!this.root)return!1;let e=this.root.style.display==="none";return this.setVisible(e),e}addTab(e,n,r){return this.tabs.set(e,{title:n,render:r,badge:null}),this.root&&(this.createTabView(e,this.tabs.get(e)),this.updateTabsBarVisibility()),this}addTabs(e){return e.forEach(n=>this.addTab(n.id,n.title,n.render)),this}setTabTitle(e,n){let r=this.tabs.get(e);if(r&&(r.title=n,r.btn)){let a=r.btn.querySelector(".label");a&&(a.textContent=n)}}setTabBadge(e,n){let r=this.tabs.get(e);!r||!r.btn||(r.badge||(r.badge=document.createElement("span"),r.badge.className="badge",r.btn.appendChild(r.badge)),n==null||n===""?r.badge.style.display="none":(r.badge.textContent=n,r.badge.style.display=""))}refreshTab(e){let n=this.tabs.get(e);if(!n?.view)return;let r=this.findScrollableAncestor(n.view),a=r?r.scrollTop:null,s=r?r.scrollLeft:null,i=document.activeElement?.id||null;n.view.innerHTML="";try{n.render(n.view,this)}catch(o){n.view.textContent=String(o)}this.currentId===e&&this.switchTo(e),this.emit("tab:render",e),r&&a!=null&&requestAnimationFrame(()=>{try{r.scrollTop=a,r.scrollLeft=s??0}catch{}if(i){let o=document.getElementById(i);if(o&&o.focus)try{o.focus()}catch{}}})}findScrollableAncestor(e){function n(a){let s=getComputedStyle(a),i=s.overflowY||s.overflow;return/(auto|scroll)/.test(i)&&a.scrollHeight>a.clientHeight}let r=e;for(;r;){if(n(r))return r;r=r.parentElement}return document.querySelector(".qws-win")}firstTabId(){let e=this.tabs.keys().next();return e.done?null:e.value??null}getTabView(e){return this.tabs.get(e)?.view??null}removeTab(e){let n=this.tabs.get(e);if(!n)return;this.tabs.delete(e);let r=this.tabBar?.querySelector(`button[data-id="${_n(e)}"]`);if(r&&r.parentElement&&r.parentElement.removeChild(r),n.view&&n.view.parentElement&&n.view.parentElement.removeChild(n.view),this.currentId===e){let a=this.tabs.keys().next().value||null;this.switchTo(a)}this.updateTabsBarVisibility()}switchTo(e){this.currentId=e,[...this.tabBar.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),[...this.views.children].forEach(n=>n.classList.toggle("active",n.dataset.id===e||e===null)),this.persistActive(),this.emit("tab:change",e)}on(e,n){return this.events.has(e)||this.events.set(e,new Set),this.events.get(e).add(n),()=>this.off(e,n)}off(e,n){this.events.get(e)?.delete(n)}emit(e,...n){this.events.get(e)?.forEach(r=>{try{r(...n)}catch{}})}btn(e,n){let r=Q("button","qmm-btn",`<span class="label">${Mt(e)}</span>`);return r.onclick=n,r}label(e){let n=Q("label","qmm-label");return n.textContent=e,n}row(...e){let n=Q("div","qmm-row");return e.forEach(r=>n.appendChild(r)),n}section(e){let n=Q("div","qmm-section");return n.appendChild(Q("div","qmm-section-title",Mt(e))),n}inputNumber(e=0,n=9999,r=1,a=0){let s=Q("div","qmm-input-number"),i=Q("input","qmm-input qmm-input-number-input");i.type="number",i.min=String(e),i.max=String(n),i.step=String(r),i.value=String(a),i.inputMode="numeric";let o=Q("div","qmm-spin"),d=Q("button","qmm-step qmm-step--up","\u25B2"),c=Q("button","qmm-step qmm-step--down","\u25BC");d.type=c.type="button";let b=()=>{let M=Number(i.value);if(Number.isFinite(M)){let v=Number(i.min),p=Number(i.max),C=Math.max(v,Math.min(p,M));C!==M&&(i.value=String(C))}},w=M=>{M<0?i.stepDown():i.stepUp(),b(),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0}))},S=(M,v)=>{let p=null,C=null,u=!1,g=W=>{u=!1,p=window.setTimeout(()=>{u=!0,w(v),C=window.setInterval(()=>w(v),60)},300),M.setPointerCapture?.(W.pointerId)},x=()=>{p!=null&&(clearTimeout(p),p=null),C!=null&&(clearInterval(C),C=null)};M.addEventListener("pointerdown",g),["pointerup","pointercancel","pointerleave","blur"].forEach(W=>M.addEventListener(W,x)),M.addEventListener("click",W=>{if(u){W.preventDefault(),W.stopPropagation(),u=!1;return}w(v)})};return S(d,1),S(c,-1),i.addEventListener("change",b),o.append(d,c),s.append(i,o),i.wrap=s,i}inputText(e="",n=""){let r=Q("input","qmm-input");return r.type="text",r.placeholder=e,r.value=n,r}checkbox(e=!1){let n=Q("input","qmm-check");return n.type="checkbox",n.checked=e,n}radio(e,n,r=!1){let a=Q("input","qmm-radio");return a.type="radio",a.name=e,a.value=n,a.checked=r,a}slider(e=0,n=100,r=1,a=0){let s=Q("input","qmm-range");return s.type="range",s.min=String(e),s.max=String(n),s.step=String(r),s.value=String(a),s}switch(e=!1){let n=this.checkbox(e);return n.classList.add("qmm-switch"),n}table(e,n){let r=document.createElement("div");r.className="qmm-table-wrap",n?.minimal&&r.classList.add("qmm-table-wrap--minimal");let a=document.createElement("div");a.className="qmm-table-scroll",n?.maxHeight&&(a.style.maxHeight=n.maxHeight),r.appendChild(a);let s=document.createElement("table");s.className="qmm-table",n?.minimal&&s.classList.add("qmm-table--minimal"),n?.compact&&s.classList.add("qmm-table--compact"),n?.fixed&&(s.style.tableLayout="fixed");let i=document.createElement("thead"),o=document.createElement("tr");e.forEach(c=>{let b=document.createElement("th");typeof c=="string"?b.textContent=c:(b.textContent=c.label??"",c.align&&b.classList.add(`is-${c.align}`),c.width&&(b.style.width=c.width)),o.appendChild(b)}),i.appendChild(o);let d=document.createElement("tbody");return s.append(i,d),a.appendChild(s),{root:r,tbody:d}}radioGroup(e,n,r,a){let s=Q("div","qmm-radio-group");for(let{value:i,label:o}of n){let d=this.radio(e,i,r===i),c=document.createElement("label");c.className="qmm-radio-label",c.appendChild(d),c.appendChild(document.createTextNode(o)),d.onchange=()=>{d.checked&&a(i)},s.appendChild(c)}return s}bindLS(e,n,r,a,s){try{let i=localStorage.getItem(e);i!=null&&r(a(i))}catch{}return{save:()=>{try{localStorage.setItem(e,s(n()))}catch{}}}}split2(e="260px"){let n=Q("div","qmm-split");n.style.gridTemplateColumns="minmax(160px, max-content) 1fr";let r=Q("div","qmm-split-left"),a=Q("div","qmm-split-right");return n.appendChild(r),n.appendChild(a),{root:n,left:r,right:a}}vtabs(e={}){return new Xt(this,e)}createTabView(e,n){let r=document.createElement("button");r.className="qmm-tab",r.dataset.id=e,r.innerHTML=`<span class="label">${Mt(n.title)}</span><span class="badge" style="display:none"></span>`;let a=r.querySelector(".badge");n.btn=r,n.badge=a,r.onclick=()=>this.switchTo(e),this.tabBar.appendChild(r);let s=Q("div","qmm-view");s.dataset.id=e,n.view=s,this.views.appendChild(s);try{n.render(s,this)}catch(i){s.textContent=String(i)}this.currentId||this.switchTo(e)}persistActive(){if(this.currentId)try{localStorage.setItem(this.lsKeyActive,this.currentId)}catch{}}restoreActive(){let e=null;try{e=localStorage.getItem(this.lsKeyActive)}catch{}e&&this.tabs.has(e)?this.switchTo(e):this.tabs.size&&this.switchTo(this.firstTabId())}updateTabsBarVisibility(){if(!this.tabBar||!this.root)return;this.tabs.size>0?(this.tabBar.parentElement||this.root.insertBefore(this.tabBar,this.views),this.tabBar.style.display="flex",this.root.classList.remove("qmm-no-tabs")):(this.tabBar.parentElement&&this.tabBar.parentElement.removeChild(this.tabBar),this.root.classList.add("qmm-no-tabs"))}ensureStyles(){if(document.getElementById("__qmm_css__"))return;let e=`
    /* ================= Modern UI for qmm ================= */
.qmm{
  --qmm-bg:        #0f1318;
  --qmm-bg-soft:   #0b0f13;
  --qmm-panel:     #111823cc;
  --qmm-border:    #ffffff22;
  --qmm-border-2:  #ffffff14;
  --qmm-accent:    #7aa2ff;
  --qmm-accent-2:  #92b2ff;
  --qmm-text:      #e7eef7;
  --qmm-text-dim:  #b9c3cf;
  --qmm-shadow:    0 6px 20px rgba(0,0,0,.35);
  --qmm-blur:      8px;

  display:flex; flex-direction:column; gap:10px; color:var(--qmm-text);
}
.qmm-compact{ gap:6px }

/* ---------- Tabs (pill + underline) ---------- */
.qmm-tabs{
  display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end;
  padding:0 6px 2px 6px; position:relative; isolation:isolate;
  border-bottom:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  border-top-left-radius:10px; border-top-right-radius:10px;
}
.qmm-no-tabs .qmm-views{ margin-top:0 }

.qmm-tab{
  flex:1 1 0; min-width:0; cursor:pointer;
  display:inline-flex; justify-content:center; align-items:center; gap:8px;
  padding:8px 12px; color:var(--qmm-text);
  background:transparent; border:1px solid transparent; border-bottom:none;
  border-top-left-radius:10px; border-top-right-radius:10px;
  position:relative; margin:0; margin-bottom:-1px;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;
}
.qmm-compact .qmm-tab{ padding:6px 10px }
.qmm-tab:hover{ background:rgba(255,255,255,.06) }
.qmm-tab:active{ transform:translateY(1px) }
.qmm-tab:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; border-radius:10px }

.qmm-tab .badge{
  font-size:11px; line-height:1; padding:2px 6px; border-radius:999px;
  background:#ffffff1a; border:1px solid #ffffff22;
}

.qmm-tab.active{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff; box-shadow:inset 0 -1px 0 #0007;
}
.qmm-tab.active::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-1px; height:2px;
  background:linear-gradient(90deg, transparent, var(--qmm-accent), transparent);
  border-radius:2px; box-shadow:0 0 12px var(--qmm-accent-2);
}

/* ---------- Views panel ---------- */
.qmm-views{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  display:flex; flex-direction:column;
  min-width:0; min-height:0; overflow:auto; box-shadow:var(--qmm-shadow);
}
.qmm-compact .qmm-views{ padding:8px }
.qmm-tabs + .qmm-views{ margin-top:-1px }

.qmm-view{ display:none; min-width:0; min-height:0; }
.qmm-view.active{ display:block; }

/* ---------- Basic controls ---------- */
.qmm-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.qmm-section{ margin-top:8px }
.qmm-section-title{ font-weight:650; margin:2px 0 8px 0; color:var(--qmm-text) }

.qmm-label{ opacity:.9 }
.qmm-val{ min-width:24px; text-align:center }

/* Buttons */
.qmm-btn{
  cursor:pointer; border-radius:10px; border:1px solid var(--qmm-border);
  padding:8px 12px; background:linear-gradient(180deg, #ffffff10, #ffffff06);
  color:#fff; box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.2);
  transition:transform .1s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
}
.qmm-compact .qmm-btn{ padding:6px 10px }
.qmm-btn:hover{ background:linear-gradient(180deg, #ffffff16, #ffffff08); border-color:#ffffff40 }
.qmm-btn:active{ transform:translateY(1px) }
.qmm-btn:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; }

/* Button variants (optional utility) */
.qmm-btn.qmm-primary{ background:linear-gradient(180deg, rgba(122,162,255,.35), rgba(122,162,255,.15)); border-color:#9db7ff55 }
.qmm-btn.qmm-danger{  background:linear-gradient(180deg, rgba(255,86,86,.28), rgba(255,86,86,.12));  border-color:#ff6a6a55 }
.qmm-btn.active{
  background:#79a6ff22;
  border-color:#79a6ff66;
  box-shadow: inset 0 0 0 1px #79a6ff33;
}

/* Inputs */
.qmm-input{
  min-width:90px; background:rgba(0,0,0,.42); color:#fff;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.qmm-input::placeholder{ color:#cbd6e780 }
.qmm-input:focus{ outline:none; border-color:var(--qmm-accent); background:#0f1521; box-shadow:0 0 0 2px #7aa2ff33 }

/* Number input + spinner (unchanged API) */
.qmm-input-number{ display:inline-flex; align-items:center; gap:6px }
.qmm-input-number-input{ width:70px; text-align:center; padding-right:8px }
.qmm-spin{ display:inline-flex; flex-direction:column; gap:2px }
.qmm-step{
  width:22px; height:16px; font-size:11px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:6px; border:1px solid var(--qmm-border);
  background:rgba(255,255,255,.08); color:#fff; cursor:pointer; user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-step:hover{ background:#ffffff18; border-color:#ffffff40 }
.qmm-step:active{ transform:translateY(1px) }

/* Switch (checkbox) */
.qmm-switch{
  appearance:none; width:42px; height:24px; background:#6c7488aa; border-radius:999px;
  position:relative; outline:none; cursor:pointer; transition:background .18s ease, box-shadow .18s ease;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12);
}
.qmm-switch::before{
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px;
  background:#fff; border-radius:50%; transition:transform .2s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
}
.qmm-switch:checked{ background:linear-gradient(180deg, rgba(122,162,255,.9), rgba(122,162,255,.6)) }
.qmm-switch:checked::before{ transform:translateX(18px) }
.qmm-switch:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px }

/* Checkbox & radio (native inputs skinned lightly) */
.qmm-check, .qmm-radio{ transform:scale(1.1); accent-color: var(--qmm-accent) }

/* Slider */
.qmm-range{
  width:180px; appearance:none; background:transparent; height:22px;
}
.qmm-range:focus{ outline:none }
.qmm-range::-webkit-slider-runnable-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-moz-range-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-webkit-slider-thumb{
  appearance:none; width:16px; height:16px; border-radius:50%; margin-top:-5px;
  background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
  transition:transform .1s ease;
}
.qmm-range:active::-webkit-slider-thumb{ transform:scale(1.04) }
.qmm-range::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:#fff; border:none;
  box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
}

/* ---------- Minimal table ---------- */
/* container */
.qmm-table-wrap--minimal{
  border:1px solid #263040; border-radius:8px; background:#0b0f14; box-shadow:none;
}
/* scroller (height cap) */
.qmm-table-scroll{
  overflow:auto; max-height:44vh; /* override via opts.maxHeight */
}

/* base */
.qmm-table--minimal{
  width:100%;
  border-collapse:collapse;
  background:transparent;
  font-size:13px; line-height:1.35; color:var(--qmm-text, #cdd6e3);
}

/* header */
.qmm-table--minimal thead th{
  position:sticky; top:0; z-index:1;
  text-align:left; font-weight:600;
  padding:8px 10px;
  color:#cbd5e1; background:#0f1318;
  border-bottom:1px solid #263040;
  text-transform:none; letter-spacing:0;
}
.qmm-table--minimal thead th.is-center { text-align: center; }
.qmm-table--minimal thead th.is-left   { text-align: left; }   /* d\xE9j\xE0 pr\xE9sent, ok */
.qmm-table--minimal thead th.is-right  { text-align: right; }
.qmm-table--minimal thead th,
.qmm-table--minimal td { vertical-align: middle; }

/* cells */
.qmm-table--minimal td{
  padding:8px 10px; border-bottom:1px solid #1f2937; vertical-align:middle;
}
.qmm-table--minimal tbody tr:hover{ background:#0f1824; }

/* compact variant */
.qmm-table--compact thead th,
.qmm-table--compact td{ padding:6px 8px; font-size:12px }

/* utils */
.qmm-table--minimal td.is-num{ text-align:right; font-variant-numeric:tabular-nums }
.qmm-table--minimal td.is-center{ text-align:center }
.qmm-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.qmm-prewrap{ white-space:pre-wrap; word-break:break-word }


/* ---------- Split panels ---------- */
.qmm-split{
  display:grid; gap:12px;
  grid-template-columns:minmax(180px,260px) minmax(0,1fr);
  align-items:start;
}
.qmm-split-left{ display:flex; flex-direction:column; gap:10px }
.qmm-split-right{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
}

/* ---------- VTabs (vertical list + filter) ---------- */
.qmm-vtabs{ display:flex; flex-direction:column; gap:8px; min-width:0 }
.qmm-vtabs .filter{ display:block }
.qmm-vtabs .filter input{ width:100% }

.qmm-vlist{
  flex:0 0 auto; overflow:visible;
  border:1px solid var(--qmm-border); border-radius:12px; padding:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
}

.qmm-vtab{
  width:100%; text-align:left; cursor:pointer;
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:8px 10px; border-radius:10px; border:1px solid #ffffff18;
  background:rgba(255,255,255,.03); color:inherit;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-vtab:hover{ background:rgba(255,255,255,.07); border-color:#ffffff34 }
.qmm-vtab:active{ transform:translateY(1px) }
.qmm-vtab.active{
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.08));
  border-color:#9db7ff55;
  box-shadow:0 1px 14px rgba(122,162,255,.18) inset;
}

.qmm-dot{ width:10px; height:10px; border-radius:50%; justify-self:center; box-shadow:0 0 0 1px #0006 inset }
.qmm-chip{ display:flex; align-items:center; gap:8px; min-width:0 }
.qmm-chip img{
  width:20px; height:20px; border-radius:50%; object-fit:cover; border:1px solid #4446;
  box-shadow:0 1px 0 rgba(255,255,255,.08) inset;
}
.qmm-chip .t{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.qmm-tag{
  font-size:11px; line-height:1; padding:3px 7px; border-radius:999px;
  background:#ffffff14; border:1px solid #ffffff26;
}

/* ---------- Small helpers (optional) ---------- */
.qmm .qmm-card{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur)); box-shadow:var(--qmm-shadow);
}
  .qmm .qmm-help{ font-size:12px; color:var(--qmm-text-dim) }
  .qmm .qmm-sep{ height:1px; background:var(--qmm-border); width:100%; opacity:.6; }

/* ta poign\xE9e, inchang\xE9 */
.qmm-grab { margin-left:auto; opacity:.8; cursor:grab; user-select:none; }
.qmm-grab:active { cursor:grabbing; }
.qmm-dragging { opacity:.6; }

/* items animables */
.qmm-team-item {
  will-change: transform;
  transition: transform 160ms ease;
}
.qmm-team-item.drag-ghost {
  opacity: .4;
}



    `,n=document.createElement("style");n.id="__qmm_css__",n.textContent=e,(document.documentElement||document.body).appendChild(n)}},Xt=class{constructor(e,n={}){this.api=e;this.opts=n;_(this,"root");_(this,"filterWrap",null);_(this,"filterInput",null);_(this,"list");_(this,"items",[]);_(this,"selectedId",null);_(this,"onSelectCb");_(this,"renderItemCustom");_(this,"emptyText");this.root=Q("div","qmm-vtabs"),this.root.style.minWidth="0",this.emptyText=n.emptyText||"Aucun \xE9l\xE9ment.",this.renderItemCustom=n.renderItem,n.filterPlaceholder&&(this.filterWrap=Q("div","filter"),this.filterInput=document.createElement("input"),this.filterInput.type="search",this.filterInput.placeholder=n.filterPlaceholder,this.filterInput.className="qmm-input",this.filterInput.oninput=()=>this.renderList(),this.filterWrap.appendChild(this.filterInput),this.root.appendChild(this.filterWrap)),this.list=Q("div","qmm-vlist"),this.list.style.minWidth="0",n.maxHeightPx&&(this.list.style.maxHeight=`${n.maxHeightPx}px`,this.list.style.overflow="auto",this.list.style.flex="1 1 auto"),this.root.appendChild(this.list),this.selectedId=n.initialId??null,this.onSelectCb=n.onSelect}setItems(e){this.items=Array.isArray(e)?e.slice():[],this.selectedId&&!this.items.some(n=>n.id===this.selectedId)&&(this.selectedId=this.items[0]?.id??null),this.renderList()}getSelected(){return this.items.find(e=>e.id===this.selectedId)??null}select(e){this.selectedId=e,this.renderList(),this.onSelectCb?.(this.selectedId,this.getSelected())}onSelect(e){this.onSelectCb=e}setBadge(e,n){let r=this.list.querySelector(`button[data-id="${_n(e)}"]`);if(!r)return;let a=r.querySelector(".qmm-tag");!a&&n!=null&&(a=Q("span","qmm-tag"),r.appendChild(a)),a&&(n==null||n===""?a.style.display="none":(a.textContent=n,a.style.display=""))}getFilter(){return(this.filterInput?.value||"").trim().toLowerCase()}renderList(){let e=this.list.scrollTop;this.list.innerHTML="";let n=this.getFilter(),r=n?this.items.filter(s=>(s.title||"").toLowerCase().includes(n)||(s.subtitle||"").toLowerCase().includes(n)):this.items;if(!r.length){let s=document.createElement("div");s.style.opacity="0.75",s.textContent=this.emptyText,this.list.appendChild(s);return}let a=document.createElement("ul");a.style.listStyle="none",a.style.margin="0",a.style.padding="0",a.style.display="flex",a.style.flexDirection="column",a.style.gap="4px";for(let s of r){let i=document.createElement("li"),o=document.createElement("button");if(o.className="qmm-vtab",o.dataset.id=s.id,o.disabled=!!s.disabled,this.renderItemCustom)this.renderItemCustom(s,o);else{let d=Q("div","qmm-dot");d.style.background=s.statusColor||"#999a";let c=Q("div","qmm-chip"),b=document.createElement("img");b.src=s.avatarUrl||"",b.alt=s.title;let w=document.createElement("div");w.style.display="flex",w.style.flexDirection="column",w.style.gap="2px";let S=Q("div","t");S.textContent=s.title;let M=document.createElement("div");if(M.textContent=s.subtitle||"",M.style.opacity="0.7",M.style.fontSize="12px",s.subtitle||(M.style.display="none"),w.appendChild(S),w.appendChild(M),c.appendChild(b),c.appendChild(w),o.appendChild(d),o.appendChild(c),s.badge!=null){let v=Q("span","qmm-tag",Mt(String(s.badge)));o.appendChild(v)}else{let v=document.createElement("div");v.style.width="0",o.appendChild(v)}}o.classList.toggle("active",s.id===this.selectedId),o.onclick=()=>this.select(s.id),i.appendChild(o),a.appendChild(i)}this.list.appendChild(a),this.list.scrollTop=e}};function Q(t,e,n){let r=document.createElement(t);return e&&(r.className=e),n!=null&&(r.innerHTML=n),r}function _n(t){return t.replace(/"/g,'\\"')}function Mt(t){return t.replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}async function Dr(t){let e=pe("sendQuinoaToastAtom");if(e){await ke(e,t);return}let n=pe("quinoaToastsAtom");if(!n)throw new Error("Aucun atom de toast trouv\xE9");let r=await Pe(n).catch(()=>[]),a={isClosable:!0,duration:1e4,...t};"toastType"in a&&a.toastType==="board"?a.id=a.id??(a.isStackable?`quinoa-stackable-${Date.now()}-${Math.random()}`:"quinoa-game-toast"):a.id=a.id??"quinoa-game-toast",await ke(n,[...r,a])}async function ue(t,e,n="info",r=3500){await Dr({title:t,description:e,variant:n,duration:r})}var Gr="menu:shops:auto";function ct(t){return async()=>{let e=await Re.read(t),n=jr(),r=[];for(let a of e.items??[]){if(!n.has(Kr(t,a)))continue;Re.getQty(a)>0&&r.push(Re.buyAllInStock(t,a,{delayMs:10}))}r.length!==0&&(await Promise.allSettled(r),ue("Auto-Buy","Activation success!","success"))}}function jr(){let t=(localStorage.getItem(Gr)||"").split(",").filter(Boolean);return new Set(t)}function Kr(t,e){let n=Re.identityFor(t,e);return`${t}:${n}`}function we(t){return t.toLowerCase().replace(/['`]/g,"").replace(/\s+/g,"").replace(/-/g,"").replace(/(seed|plant|baby|fruit|crop)$/i,"")}function Qt(t){if(!t)return null;let e=String(t),n=e.split(".").pop()||e;return we(n)}function Fn(t){let e=t?.crop?.name;return e?we(e):null}function $r(t){return t?t.charAt(0).toUpperCase()+t.slice(1):null}var Wn=["\u{1F955}","\u{1F353}","\u{1F343}","\u{1F535}","\u{1F34E}","\u{1F337}","\u{1F345}","\u{1F33C}","\u{1F33D}","\u{1F349}","\u{1F383}","\u{1F33F}","\u{1F965}","\u{1F34C}","\u{1F338}","\u{1F7E2}","\u{1F344}","\u{1F335}","\u{1F38D}","\u{1F347}","\u{1F336}\uFE0F","\u{1F34B}","\u{1F96D}","\u{1F409}","\u{1F352}","\u{1F33B}","\u2728"];function Vr(){let t=[];for(let[e,n]of Object.entries(Ge)){let r=n?.seed?.name,a=n?.crop?.name,s=n?.plant?.name;t.push({key:e,seedName:r,cropName:a,plantName:s})}return t}function zr(t){let e=new Map;return t.forEach((n,r)=>e.set(n.key,Wn[r%Wn.length])),e}function Yr(){let t=new Map,e=new Map,n=new Map;for(let r of Object.values(Ge)){let a=Fn(r);if(!a)continue;t.has(a)||t.set(a,r);let s=[Qt(r?.seed?.tileRef),Qt(r?.plant?.tileRef),Qt(r?.crop?.tileRef),r?.seed?.species?we(r.seed.species):null,r?.crop?.name?we(r.crop.name):null,r?.plant?.name?we(r.plant.name):null],i=!1,o=r?.plant?.harvestType??r?.seed?.harvestType??r?.grow?.harvestType??r?.harvestType;if(o&&typeof o=="string"){let d=te[o]??o;i=String(d).toLowerCase()!=="single"}if(!i&&r?.crop?.name){let d=String(r.crop.name).toLowerCase();/(fruit|berry|bush|tree)/.test(d)&&(i=!0)}for(let d of s)d&&e.set(d,$r(a));n.set(a,!!i)}return{byBase:t,speciesToBaseCap:e,baseIsMulti:n}}var On=Yr();function dt(t){if(!t)return null;let e=we(t);return On.speciesToBaseCap.get(e)??null}function Ur(t){if(!t)return!1;let e=dt(t);if(!e)return!1;let n=we(e);return On.baseIsMulti.get(n)??!1}var Me={selected:"garden.selectedSeed",assignments:"garden.assignments",autoPlant:"garden.autoPlantEnabled",harvestRules:"garden.harvest.rules.v1",autoSellRules:"garden.autosell.rules.v1"};function Et(t,e){let n;return function(...r){n!==void 0&&window.clearTimeout(n),n=window.setTimeout(()=>t.apply(this,r),e)}}function Jr(){try{let t=localStorage.getItem(Me.harvestRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var qn=Et(t=>{try{localStorage.setItem(Me.harvestRules,JSON.stringify(t))}catch{}},150);function Xr(){try{let t=localStorage.getItem(Me.autoSellRules);if(!t)return{};let e=JSON.parse(t);if(e&&typeof e=="object")return e}catch{}return{}}var Qr=Et(t=>{try{localStorage.setItem(Me.autoSellRules,JSON.stringify(t))}catch{}},150),U=class U{constructor(){_(this,"seedOptions",Vr());_(this,"_emojiByKey",zr(this.seedOptions));_(this,"_speciesToKey",new Map);_(this,"_baseToKeys",new Map);_(this,"_basePrimary",new Map);_(this,"_maxScaleByBase",new Map);_(this,"_selectedSeed",this.seedOptions[0]?.key??"");_(this,"listeners",new Set);_(this,"_assign",new Map);_(this,"_slotState",new Map);_(this,"_autoTimer",null);_(this,"_autoRunning",!1);_(this,"_tickCount",0);_(this,"_lastResyncErrorAt",0);_(this,"_autoHarvestTimer",null);_(this,"_isHarvestTicking",!1);_(this,"_harvestRules",{});_(this,"_compiledRules",new Map);_(this,"_enabledBases",new Set);_(this,"_autoSellRules",{});_(this,"_invCountBySeedKey",new Map);_(this,"_scratchMature",[]);_(this,"_scratchPairs",[]);_(this,"_boundTickPlant",()=>{this.tickAutoPlant().catch(()=>{})});_(this,"_boundTickHarvest",()=>{this._tickAutoHarvest().catch(()=>{})});_(this,"saveSelectedSeed",Et(()=>{try{localStorage.setItem(Me.selected,this._selectedSeed)}catch{}},150));_(this,"saveAssignments",Et(()=>{try{localStorage.setItem(Me.assignments,JSON.stringify(Array.from(this._assign.entries())))}catch{}},200));_(this,"_autoSellTimer",null);_(this,"_autoSellPendingReason",null);_(this,"_lastKnownPlayers",0);_(this,"assignments",{get:e=>this._assign.get(e),set:(e,n)=>{this._assign.get(e)!==n&&(this._assign.set(e,n),this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},delete:e=>{this._assign.delete(e)&&(this.saveAssignments(),this.emit({type:"assignments-changed",slots:[e]}))},clear:()=>{this._assign.size!==0&&(this._assign.clear(),this.saveAssignments(),this.emit({type:"assignments-changed"}))},invert:e=>{let n=new Map;for(let r=0;r<200;r++)this._assign.has(r)||n.set(r,e);this._assign=n,this.saveAssignments(),this.emit({type:"assignments-changed"})},entries:()=>this._assign.entries(),size:()=>this._assign.size});_(this,"runtime",{getSlotState:e=>this._slotState.get(e)??"empty",setSlotState:(e,n)=>{this._slotState.get(e)!==n&&(this._slotState.set(e,n),this.emit({type:"runtime-changed",slots:[e]}))}});for(let e of this.seedOptions){let n=[e.cropName,e.plantName,e.seedName].filter(Boolean);for(let r of n)this._speciesToKey.set(we(r),e.key)}for(let[e,n]of Object.entries(Ge)){let r=Fn(n);if(!r)continue;let a=we(r),s=this._baseToKeys.get(a)??[];s.length===0&&this._basePrimary.set(a,e),s.push(e),this._baseToKeys.set(a,s);let i=Number(n?.crop?.maxScale)||1;this._maxScaleByBase.has(a)||this._maxScaleByBase.set(a,i)}this.loadSelectedSeed(),this.loadAssignments(),this.restoreAutoPlantState(),this._harvestRules=Jr(),this._rebuildCompiledRulesAndEnabledBases(),Object.keys(this._harvestRules).length&&this.emit({type:"harvest-rules-replaced",rules:this.getAllHarvestRules()}),this._autoSellRules=Xr(),Object.keys(this._autoSellRules).length&&this.emit({type:"auto-sell-rules-replaced",rules:this.getAllAutoSellRules()}),this._recomputeAutoHarvestLoop();try{B.getCropInventoryState&&B.getCropInventoryState().then(e=>this._rebuildInvCountsFromArray(e||[])).catch(()=>{}),B.onCropInventoryDiffNow&&B.onCropInventoryDiffNow((e,n)=>{Array.isArray(e)&&this._rebuildInvCountsFromArray(e),(n?.added?.length||n?.removed?.length||n?.updated?.length)&&(console.debug("[AutoSell] Trigger inventaire:",n),this._scheduleAutoSell("inventory"))})}catch{}try{B.onNumPlayersChangeNow(e=>{this._lastKnownPlayers=e,console.debug("[AutoSell] Trigger joueurs:",e),this._scheduleAutoSell("players")}),B.onFavoriteIdsChangeNow&&B.onFavoriteIdsChangeNow(e=>{console.debug("[AutoSell] Changement favoris (debug):",e?.length??0)})}catch{}}_scheduleAutoSell(e){this._autoSellPendingReason=e,this._autoSellTimer===null&&(this._autoSellTimer=window.setTimeout(()=>{this._autoSellTimer=null;let n=this._autoSellPendingReason||"unknown";this._autoSellPendingReason=null,this._runAutoSell(n).catch(()=>{})},120))}loadSelectedSeed(){try{let e=localStorage.getItem(Me.selected);if(!e)return;this.seedOptions.some(r=>r.key===e)&&(this._selectedSeed=e)}catch{}}loadAssignments(){try{let e=localStorage.getItem(Me.assignments);if(!e)return;let n=JSON.parse(e),r=new Map;for(let[a,s]of n)r.set(a,s);this._assign=r}catch{}}restoreAutoPlantState(){try{localStorage.getItem(Me.autoPlant)==="1"&&this.startAutoPlant(!0)}catch{}}subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}emit(e){for(let n of this.listeners)try{n(e)}catch{}}getEmojiFor(e){let n=this.seedOptions.find(r=>r.seedName===e);return n?this._emojiByKey.get(n.key)??"\u2022":"\u2022"}getEmojiForKey(e){return this._emojiByKey.get(e)??"\u2022"}getSelectedSeed(){return this._selectedSeed}setSelectedSeed(e){this._selectedSeed!==e&&(this._selectedSeed=e,this.saveSelectedSeed(),this.emit({type:"selected-seed-changed"}))}getVisualState(e){if(!this._assign.has(e))return"unassigned";let n=this._slotState.get(e)??"empty";return n==="empty"?"ok":n==="single"?"waiting":"blocked"}getAutoPlantEnabled(){return this._autoRunning}async syncNow(){await this.refreshFromPlayerGarden()}async refreshFromPlayerGarden(){try{let e=await B.getGardenState();if(!e||!e.tileObjects)return;let n=e.tileObjects,r=[];for(let[a,s]of Object.entries(n)){let i=Number(a),o=this.classifyTileObject(s??null);this._slotState.get(i)!==o&&(this._slotState.set(i,o),r.push(i))}for(let a of this._slotState.keys())String(a)in n||this._slotState.get(a)!=="empty"&&(this._slotState.set(a,"empty"),r.push(a));r.length&&this.emit({type:"runtime-changed",slots:r})}catch{this._lastResyncErrorAt=Date.now()}}classifyTileObject(e){if(!e)return"empty";let n=e?.species||e?.name||e?.title;if(n&&Ur(n))return"multi";let r=(e.objectType||e.type||"").toString().toLowerCase();return r.includes("plant")||r.includes("crop")||r.includes("egg")||r.includes("decor")||r.includes("item")||r.includes("pet"),"single"}startAutoPlant(e){if(!this._autoRunning){this._autoRunning=!0,this.refreshFromPlayerGarden().catch(()=>{}),e||ue("Garden","Auto plant enabled!","success");try{localStorage.setItem(Me.autoPlant,"1")}catch{}this._autoTimer=window.setInterval(this._boundTickPlant,U.TICK_MS)}}stopAutoPlant(){if(this._autoRunning){this._autoRunning=!1,this._autoTimer!==null&&(window.clearInterval(this._autoTimer),this._autoTimer=null);try{localStorage.setItem(Me.autoPlant,"0")}catch{}ue("Garden","Auto plant disabled.","info")}}async tickAutoPlant(){if(!this._autoRunning||(this._tickCount=(this._tickCount+1)%U.RESYNC_EVERY_TICKS,this._tickCount===0&&await this.refreshFromPlayerGarden(),Date.now()-this._lastResyncErrorAt<1500))return;let e=!1;for(let[n,r]of this._assign){if(this.getVisualState(n)!=="ok"||this.runtime.getSlotState(n)!=="empty")continue;let a=dt(r);if(a)try{await B.plantSeed(n,a),e=!0}catch{}}e&&await this.refreshFromPlayerGarden()}static defaultHarvestRule(){return{enabled:!1,minScalePct:50,visualIncludeNormal:!0,visualMutations:[],weatherMode:"ANY",weatherSelected:[],weatherRecipes:[],minInventory:91}}static defaultAutoSellRule(){return{enabled:!1,keepMin:0,minSizePct:50,keepVisual:["Normal"],keepWeather:[],minPlayers:0}}getHarvestRule(e){let n=this._harvestRules[e];return n?JSON.parse(JSON.stringify(n)):null}setHarvestRule(e,n){let r=(s,i,o)=>Math.max(i,Math.min(o,Math.floor(Number(s)||0))),a={enabled:!!n.enabled,minScalePct:r(n.minScalePct??50,50,100),visualIncludeNormal:!!n.visualIncludeNormal,visualMutations:Array.isArray(n.visualMutations)?[...n.visualMutations]:[],weatherMode:["ANY","ALL","RECIPES"].includes(n.weatherMode)?n.weatherMode:"ANY",weatherSelected:Array.isArray(n.weatherSelected)?[...n.weatherSelected]:[],weatherRecipes:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(s=>Array.isArray(s)?[...s]:[]):[],minInventory:r(n.minInventory??0,0,91)};this._harvestRules[e]=a,this._compileRule(e,a),this._rebuildEnabledBases(),qn(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(a))}),this._recomputeAutoHarvestLoop()}getAutoHarvestEnabledForSeed(e){return!!this._harvestRules[e]?.enabled}setAutoHarvestEnabledForSeed(e,n){let a={...this._harvestRules[e]??U.defaultHarvestRule(),enabled:!!n};this._harvestRules[e]=a,this._compileRule(e,a),this._rebuildEnabledBases(),qn(this._harvestRules),this.emit({type:"harvest-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(a))}),this._recomputeAutoHarvestLoop()}getAllHarvestRules(){return JSON.parse(JSON.stringify(this._harvestRules))}_anyAutoHarvestEnabled(){return this._enabledBases.size>0}_recomputeAutoHarvestLoop(){let e=this._anyAutoHarvestEnabled();e&&this._autoHarvestTimer===null?this._autoHarvestTimer=window.setInterval(this._boundTickHarvest,U.HARVEST_TICK_MS):!e&&this._autoHarvestTimer!==null&&(window.clearInterval(this._autoHarvestTimer),this._autoHarvestTimer=null)}_isPlantObject(e){return(e?.objectType||e?.type||"").toString().toLowerCase().includes("plant")}getSizeCrop(e,n){let r=dt(e)??e,a=we(r),s=this._maxScaleByBase.get(a)??1;if(!s||s<=1)return 100;let o=50+(Math.max(1,Math.min(s,Number(n)||1))-1)/(s-1)*50;return Math.max(50,Math.min(100,Math.round(o)))}_seedKeyEnabledForBase(e){return this._enabledBases.has(e)}getAutoSellRule(e){let n=this._autoSellRules[e];return n?JSON.parse(JSON.stringify(n)):null}getAllAutoSellRules(){return JSON.parse(JSON.stringify(this._autoSellRules))}getAutoSellEnabledForSeed(e){return!!this._autoSellRules[e]?.enabled}setAutoSellRule(e,n){let r=(o,d,c)=>Math.max(d,Math.min(c,Math.floor(Number(o)||0))),a=["Normal","Gold","Rainbow"],s=["Wet","Chilled","Frozen","Dawnlit","Amberglow"],i={enabled:!!n.enabled,keepMin:r(n.keepMin??0,0,91),minSizePct:r(n.minSizePct??50,50,100),keepVisual:Array.isArray(n.keepVisual)?[...new Set(n.keepVisual.filter(o=>a.includes(o)))]:["Normal"],keepWeather:Array.isArray(n.keepWeather)?[...new Set(n.keepWeather.filter(o=>s.includes(o)))]:[],minPlayers:r(n.minPlayers??0,0,6)};this._autoSellRules[e]=i,Qr(this._autoSellRules),this.emit({type:"auto-sell-rule-changed",seedKey:e,rule:JSON.parse(JSON.stringify(i))}),this._scheduleAutoSell("rules")}static toVisualMask(e){let n=0;for(let r of e)r==="Gold"?n|=U.V_GOLD:r==="Rainbow"&&(n|=U.V_RAINBOW);return n}static toWeatherMask(e){let n=0;for(let r of e)r==="Wet"?n|=U.W_WET:r==="Chilled"?n|=U.W_CHILLED:r==="Frozen"?n|=U.W_FROZEN:r==="Dawnlit"?n|=U.W_DAWNLIT:r==="Amberglow"&&(n|=U.W_AMBER);return n}static mutsToMasks(e){let n=0,r=0;if(!Array.isArray(e))return[0,0];for(let a=0;a<e.length;a++)switch(e[a]){case"Gold":n|=U.V_GOLD;break;case"Rainbow":n|=U.V_RAINBOW;break;case"Wet":r|=U.W_WET;break;case"Chilled":r|=U.W_CHILLED;break;case"Frozen":r|=U.W_FROZEN;break;case"Dawnlit":r|=U.W_DAWNLIT;break;case"Amberglow":r|=U.W_AMBER;break;default:break}return[n,r]}_compileRule(e,n){let r={enabled:!!n.enabled,minScalePct:Math.min(100,Math.max(50,Math.floor(n.minScalePct??50))),allowNormal:!!n.visualIncludeNormal,visualMaskWanted:U.toVisualMask(n.visualMutations||[]),weatherMode:n.weatherMode,weatherMask:U.toWeatherMask(n.weatherSelected||[]),recipeMasks:Array.isArray(n.weatherRecipes)?n.weatherRecipes.map(U.toWeatherMask):[],minInventory:Math.max(0,Math.floor(n.minInventory??0))};this._compiledRules.set(e,r)}_rebuildCompiledRulesAndEnabledBases(){this._compiledRules.clear();for(let[e,n]of Object.entries(this._harvestRules))this._compileRule(e,n);this._rebuildEnabledBases()}_rebuildEnabledBases(){this._enabledBases.clear();for(let[e,n]of this._baseToKeys)n.some(r=>this._harvestRules[r]?.enabled)&&this._enabledBases.add(e)}_getPrimarySeedKeyForBase(e){return this._basePrimary.get(e)??null}_passesMutationRulesCompiled(e,n,r){if(!e.enabled)return!1;if(n===0){if(!e.allowNormal)return!1}else if(e.visualMaskWanted!==0&&!(n&e.visualMaskWanted))return!1;if(e.weatherMode==="ANY")return e.weatherMask===0?!0:(r&e.weatherMask)!==0;if(e.weatherMode==="ALL")return e.weatherMask===0?!0:(r&e.weatherMask)===e.weatherMask;if(!e.recipeMasks.length)return!0;for(let s=0;s<e.recipeMasks.length;s++){let i=e.recipeMasks[s];if((r&i)===i)return!0}return!1}_rebuildInvCountsFromArray(e){let n=new Map;for(let r of Array.isArray(e)?e:[]){let a=this.seedKeyFromSpecies(r?.species||"")||null;a&&n.set(a,(n.get(a)||0)+1)}this._invCountBySeedKey=n}_getStockForBase(e){let n=this._baseToKeys.get(e);if(!n||!n.length)return 0;let r=0;for(let a of n)r+=this._invCountBySeedKey.get(a)||0;return r}async _tickAutoHarvest(){if(!this._isHarvestTicking&&this._anyAutoHarvestEnabled()){if(this._isHarvestTicking=!0,this._invCountBySeedKey.size===0&&B.getCropInventoryState)try{let e=await B.getCropInventoryState();Array.isArray(e)&&this._rebuildInvCountsFromArray(e)}catch{}try{let e=await B.getGardenState(),n=Date.now(),r=e?.tileObjects??{};this._scratchPairs.length=0;let a=new Map,s=10;e:for(let[o,d]of Object.entries(r)){let c=Number(o);if(!Number.isInteger(c)||!this._isPlantObject(d))continue;let b=d?.species||d?.name||d?.title;if(!b)continue;let w=dt(b)??b,S=we(w);if(!this._seedKeyEnabledForBase(S))continue;let M=this._getPrimarySeedKeyForBase(S);if(!M)continue;let v=this._compiledRules.get(M);if(!v||!v.enabled)continue;let p=a.get(S);if(p===void 0){let u=Math.max(0,v.minInventory||0);if(u>0){let g=this._getStockForBase(S),x=u-g;if(x<=0)continue;p=x}else p=1/0;a.set(S,p)}else if(p<=0)continue;this._scratchMature.length=0;let C=Array.isArray(d?.slots)?d.slots:[];for(let u=0;u<C.length;u++){let g=C[u]?.endTime;typeof g=="number"&&g<=n&&this._scratchMature.push(u)}if(this._scratchMature.length!==0)for(let u=0;u<this._scratchMature.length;u++){let g=this._scratchMature[u],x=d?.slots?.[g],W=x?.targetScale??1;if(this.getSizeCrop(b,W)<(v.minScalePct||50))continue;let[F,h]=U.mutsToMasks(x?.mutations);if(this._passesMutationRulesCompiled(v,F,h)){if(p!==1/0&&p<=0||(this._scratchPairs.push({slot:c,sub:g}),p!==1/0&&(p-=1,a.set(S,p),p<=0)))break;if(this._scratchPairs.length>=s)break e}}}let i=!1;for(let o=0;o<this._scratchPairs.length;o++){let{slot:d,sub:c}=this._scratchPairs[o];try{await B.harvestCrop(d,c),i=!0}catch{}}i&&await this.refreshFromPlayerGarden()}finally{this._isHarvestTicking=!1}}}seedKeyFromSpecies(e){if(!e)return null;let n=we(e),r=this._speciesToKey.get(n);if(r)return r;let a=dt(e);if(!a)return null;let s=we(a);return this._basePrimary.get(s)??this._baseToKeys.get(s)?.[0]??null}sizePercent(e,n){return this.getSizeCrop(e,n)}_hasVisual(e,n){let r=Array.isArray(e?.mutations)?e.mutations:[];return n==="Normal"?!(r.includes("Gold")||r.includes("Rainbow")):r.includes(n)}_hasWeather(e,n){return(Array.isArray(e?.mutations)?e.mutations:[]).includes(n)}async _runAutoSell(e){try{let[n,r]=await Promise.all([B.getCropInventoryState?B.getCropInventoryState():Promise.resolve(null),B.getFavoriteIds?B.getFavoriteIds():Promise.resolve([])]),a=Array.isArray(n)?n:[],s=new Set(Array.isArray(r)?r:[]),i=this._lastKnownPlayers;if(!a.length){console.debug("[AutoSell] Rien \xE0 faire (inventaire vide).");return}let o=new Map;for(let v of a){let p=this.seedKeyFromSpecies(v?.species||"")||"__unknown__";o.has(p)||o.set(p,[]),o.get(p).push(v)}let d=[],c=[],b=[];for(let[v,p]of o){let C=this._autoSellRules[v];if(!C?.enabled){for(let h of p)s.has(h.id)||d.push(h.id);continue}if(i<(C.minPlayers||0)){for(let h of p)s.has(h.id)||d.push(h.id);continue}let u=p.map(h=>({it:h,size:this.sizePercent(h?.species||"",Number(h?.scale)||1)}));u.sort((h,E)=>E.size-h.size);let g=[],x=new Set;for(let{it:h,size:E}of u){let z=!1;for(let Y of C.keepVisual||[])if(this._hasVisual(h,Y)){z=!0;break}if(z){x.add(h.id);continue}let $=!1;for(let Y of C.keepWeather||[])if(this._hasWeather(h,Y)){$=!0;break}if($){x.add(h.id);continue}if(E<(C.minSizePct||50)){x.add(h.id);continue}g.push({it:h,size:E})}let W=Math.max(0,C.keepMin|0),F=x.size;if(F<W&&g.length>0){let h=W-F;for(let E=0;E<g.length&&E<h;E++)x.add(g[E].it.id),F++;for(let E=h;E<g.length;E++){let z=g[E].it.id;b.push(z),s.has(z)&&c.push(z)}}else for(let h of g){let E=h.it.id;b.push(E),s.has(E)&&c.push(E)}for(let h of x)s.has(h)||d.push(h)}let w=d.filter(v=>!s.has(v)),S=c.filter(v=>s.has(v));if(!w.length&&!S.length&&b.length===0){console.debug(`[AutoSell] ${e}: aucun changement favoris.`);return}let M=0;try{M=Number(await _t.get())||0}catch{}for(let v of w)try{await B.toggleFavoriteItem(v)}catch{}for(let v of S)try{await B.toggleFavoriteItem(v)}catch{}if(b.length>0){try{let p=Number(await _t.get());Number.isFinite(p)&&p>=0&&(M=p)}catch{}let v=new Intl.NumberFormat("fr-FR",{maximumFractionDigits:0}).format(M);M>0?ue("Auto-Sell",`Sold for (~${v}\u{1F4B0})`,"success"):ue("Auto-Sell","Sold sucess!","success");try{await B.sellNow?B.sellNow("autosell"):B.sellAllCrops()}catch{}}}catch(n){console.debug("[AutoSell] Erreur run:",n)}}};_(U,"TICK_MS",350),_(U,"RESYNC_EVERY_TICKS",10),_(U,"HARVEST_TICK_MS",1e3),_(U,"V_GOLD",1),_(U,"V_RAINBOW",2),_(U,"W_WET",1),_(U,"W_CHILLED",2),_(U,"W_FROZEN",4),_(U,"W_DAWNLIT",8),_(U,"W_AMBER",16);var Zt=U,At=new Zt;function Bn(t){for(let e of t){let n=document.querySelector(`div[data-slot="${e}"]`);if(!n)continue;let r=n.style.background;n.style.outline="2px solid #88f",setTimeout(()=>{n.style.outline="",n.style.background=r},350)}}function en(t){let e="qws:pos",n="qws:collapsed",r="qws:hidden";if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>en(t),{once:!0});return}let s=`
  :root{
    --qws-bg:        #0f1318;
    --qws-panel:     #111823cc;
    --qws-border:    #ffffff22;
    --qws-border-2:  #ffffff14;
    --qws-accent:    #7aa2ff;
    --qws-text:      #e7eef7;
    --qws-text-dim:  #b9c3cf;
    --qws-blur:      8px;
    --qws-shadow:    0 10px 36px rgba(0,0,0,.45);
  }

  /* ---------- HUD floating box ---------- */
  .qws2{
    position:fixed; right:16px; bottom:16px; z-index:999998;
    font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color:var(--qws-text);
    background:var(--qws-panel);
    border:1px solid var(--qws-border);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:var(--qws-shadow);
    backdrop-filter:blur(var(--qws-blur));
    min-width:160px;
    display:flex; flex-direction:column; gap:8px;
  }
  .qws2.hidden{ display:none }
  .qws2 .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .qws2 .col{ display:flex; flex-direction:column; gap:4px }
  .qws2 .title{ font-weight:700; letter-spacing:.2px }
  .qws2 .sp{ flex:1 }

  .qws2 .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 8px; border-radius:999px;
    border:1px solid #ffffff26;
    background:rgba(255,255,255,.06);
    color:var(--qws-text);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  }
  .qws2 .ok{   background:rgba(36, 161, 72, .20);  border-color:#48d17066 }
  .qws2 .warn{ background:rgba(241, 194, 27, .18); border-color:#ffd65c66 }
  .qws2 .bad{  background:rgba(218, 30, 40, .20);  border-color:#ff7c8666 }

  .qws2 .btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:6px 10px;
    background:linear-gradient(180deg, #ffffff12, #ffffff06);
    color:#fff;
    transition:transform .1s ease, background .18s ease, border-color .18s ease;
  }
  .qws2 .btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws2 .btn:active{ transform:translateY(1px) }
  .qws2 .drag{ cursor:move; opacity:.9 }

  .qws2 .mini{ display:none }
  .qws2.min .mini{ display:inline-flex }
  .qws2.min .body{ display:none }

  /* Launcher always shown */
  .qws-launch{ margin-top:4px; border-top:1px solid var(--qws-border); padding-top:6px; display:block }
  .qws-launch .launch-item{ display:flex; align-items:center; gap:8px; margin:4px 0 }
  .qws-launch .launch-item .name{ flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .qws-launch .launch-item .btn.active{
    background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.12));
    border-color:#9db7ff66;
  }

  /* ---------- Windows ---------- */
  .qws-win{
    position:fixed; z-index:999999; min-width:260px; max-width:900px; max-height:90vh; overflow:auto;
    background:var(--qws-panel); color:var(--qws-text);
    border:1px solid var(--qws-border); border-radius:12px;
    box-shadow:var(--qws-shadow); backdrop-filter:blur(var(--qws-blur));
  }
  .qws-win .w-head{
    display:flex; align-items:center; gap:8px; padding:10px 12px;
    border-bottom:1px solid var(--qws-border); cursor:move;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .qws-win .w-title{ font-weight:700 }
  .qws-win .sp{ flex:1 }
  .qws-win .w-btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:4px 8px; background:linear-gradient(180deg, #ffffff12, #ffffff06); color:#fff;
  }
  .qws-win .w-btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws-win .w-body{ padding:12px }

  /* Inputs inside windows */
  .qws-win input[type="text"], .qws-win input[type="number"]{
    width:120px; padding:8px 10px; border-radius:10px;
    border:1px solid var(--qws-border); background:rgba(0,0,0,.42); color:#fff;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  }
  .qws-win .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
  `,i=document.createElement("style");i.textContent=s,(document.documentElement||document.body).appendChild(i);let o=document.createElement("div");o.className="qws2",o.innerHTML=`
    <div class="row drag">
      <div class="title">Arie's Mod</div>
      <div class="sp"></div>
      <span id="qws2-status-mini" class="pill warn mini">\u2026</span>
      <button id="qws2-min" class="btn" title="Minimize/Expand">\u2013</button>
      <button id="qws2-hide" class="btn" title="Hide (Alt+X)">\u2715</button>
    </div>

    <!-- Status & store side-by-side (no mode label) -->
    <div class="row" style="margin:2px 0 2px 0;">
      <span id="qws2-status2" class="pill warn">WS: \u2026</span>
      <span id="qws2-store" class="pill warn">store: \u2026</span>
    </div>

    <div class="body">
      <div id="qws-launch" class="qws-launch"></div>
    </div>
  `,(document.documentElement||document.body).appendChild(o);function d(l){let y=l.getBoundingClientRect(),T=window.innerWidth,f=window.innerHeight,R=parseFloat(getComputedStyle(l).right)||T-y.right,G=parseFloat(getComputedStyle(l).bottom)||f-y.bottom,O=Math.max(8,T-y.width-8),H=Math.max(8,f-y.height-8);R=Math.min(Math.max(R,8),O),G=Math.min(Math.max(G,8),H),l.style.right=R+"px",l.style.bottom=G+"px"}function c(l){d(l);let y=l.getBoundingClientRect(),f=l.querySelector(".w-head")?.getBoundingClientRect()||y,R=window.innerWidth,G=window.innerHeight,O=8,H=parseFloat(getComputedStyle(l).right);Number.isNaN(H)&&(H=R-y.right);let D=parseFloat(getComputedStyle(l).bottom);Number.isNaN(D)&&(D=G-y.bottom);let ne=Math.max(O,R-y.width-O),oe=Math.max(O,G-y.height-O);if(f.top<O){let J=O-f.top;D=Math.max(O,Math.min(oe,D-J))}if(y.left<O){let J=O-y.left;H=Math.max(O,Math.min(ne,H-J))}l.style.right=H+"px",l.style.bottom=D+"px"}function b(l){l.style.right="16px",l.style.bottom="16px",c(l)}function w(l,y){let T=l.getBoundingClientRect(),f=window.innerHeight,R=parseFloat(getComputedStyle(l).bottom);Number.isNaN(R)&&(R=f-T.bottom),y(),requestAnimationFrame(()=>{let G=l.getBoundingClientRect(),O=G.top-T.top,H=R+O,D=Math.max(8,f-G.height-8);H=Math.min(Math.max(8,H),D),l.style.bottom=H+"px",c(l)})}function S(){try{let l=parseFloat(o.style.right)||16,y=parseFloat(o.style.bottom)||16;localStorage.setItem(e,JSON.stringify({r:l,b:y}))}catch{}}try{let l=JSON.parse(localStorage.getItem(e)||"null");if(l&&typeof l.r=="number"&&typeof l.b=="number"&&(o.style.right=l.r+"px",o.style.bottom=l.b+"px"),localStorage.getItem(n)==="1"){o.classList.add("min");let y=o.querySelector("#qws2-min");y&&(y.textContent="+")}localStorage.getItem(r)==="1"&&o.classList.add("hidden"),requestAnimationFrame(()=>d(o)),window.addEventListener("resize",()=>d(o))}catch{}let M=o.querySelector(".drag"),v=o.querySelector("#qws2-min"),p=o.querySelector("#qws2-hide"),C=o.querySelector("#qws2-status-mini"),u=o.querySelector("#qws2-status2"),g=o.querySelector("#qws2-store"),x=o.querySelector("#qws-launch");if(!M||!v||!p||!C||!u||!g||!x){console.warn("[QuinoaWS] HUD elements missing, abort init");return}let W=x;(function(){let y=0,T=0,f=0,R=0,G=!1;M.addEventListener("mousedown",O=>{G=!0,y=O.clientX,T=O.clientY;let H=o.getBoundingClientRect();f=parseFloat(getComputedStyle(o).right)||window.innerWidth-H.right,R=parseFloat(getComputedStyle(o).bottom)||window.innerHeight-H.bottom,document.body.style.userSelect="none"}),window.addEventListener("mousemove",O=>{if(!G)return;let H=O.clientX-y,D=O.clientY-T,ne=f-H,oe=R-D,J=o.getBoundingClientRect(),he=window.innerWidth,xe=window.innerHeight,He=Math.max(8,he-J.width-8),k=Math.max(8,xe-J.height-8);ne=Math.min(Math.max(ne,8),He),oe=Math.min(Math.max(oe,8),k),o.style.right=ne+"px",o.style.bottom=oe+"px"}),window.addEventListener("mouseup",()=>{G&&(G=!1,document.body.style.userSelect="",S())})})(),v.onclick=()=>{w(o,()=>{o.classList.toggle("min"),v.textContent=o.classList.contains("min")?"+":"\u2013";try{localStorage.setItem(n,o.classList.contains("min")?"1":"0")}catch{}})},p.onclick=()=>{o.classList.add("hidden");try{localStorage.setItem(r,"1")}catch{}},window.addEventListener("keydown",l=>{let y=(l.target&&l.target.tagName||"").toLowerCase();if(!(y==="input"||y==="textarea"||l.target?.isContentEditable)&&l.altKey&&!l.shiftKey&&!l.ctrlKey&&!l.metaKey&&(l.key==="x"||l.key==="X")){let f=o.classList.toggle("hidden");try{localStorage.setItem(r,f?"1":"0")}catch{}}},!0);let F=new Map,h=0;function E(l,y,T){if(F.has(l)){let oe=F.get(l);oe.el.style.display="",Y(oe.el),V(l,!0);return}let f=document.createElement("div");f.className="qws-win",f.innerHTML=`
      <div class="w-head">
        <div class="w-title"></div>
        <div class="sp"></div>
        <button class="w-btn" data-act="min" title="Minimize/Expand">\u2013</button>
        <button class="w-btn" data-act="close" title="Close">\u2715</button>
      </div>
      <div class="w-body"></div>
    `,(document.documentElement||document.body).appendChild(f);let R=f.querySelector(".w-head"),G=f.querySelector(".w-title"),O=f.querySelector('[data-act="min"]'),H=f.querySelector('[data-act="close"]'),D=f.querySelector(".w-body");G.textContent=y;let ne=h++%5*24;f.style.right=16+ne+"px",f.style.bottom=16+ne+"px",d(f),Y(f),function(){let J=0,he=0,xe=0,He=0,k=!1;R.addEventListener("mousedown",L=>{if(L.target.closest(".w-btn"))return;k=!0,J=L.clientX,he=L.clientY;let ee=f.getBoundingClientRect();xe=parseFloat(getComputedStyle(f).right)||window.innerWidth-ee.right,He=parseFloat(getComputedStyle(f).bottom)||window.innerHeight-ee.bottom,document.body.style.userSelect="none",Y(f)}),window.addEventListener("mousemove",L=>{if(!k)return;let X=L.clientX-J,ee=L.clientY-he,be=xe-X,Ce=He-ee,Ne=f.getBoundingClientRect(),ir=window.innerWidth,or=window.innerHeight,lr=Math.max(8,ir-Ne.width-8),cr=Math.max(8,or-Ne.height-8);be=Math.min(Math.max(be,8),lr),Ce=Math.min(Math.max(Ce,8),cr),f.style.right=be+"px",f.style.bottom=Ce+"px"}),window.addEventListener("mouseup",()=>{k=!1,document.body.style.userSelect="",Se(l,f)})}(),O.onclick=()=>{w(f,()=>{let oe=D.style.display==="none";D.style.display=oe?"":"none",O.textContent=oe?"\u2013":"+"})},H.onclick=()=>{f.style.display="none",V(l,!1)},P(f);try{T(D)}catch(oe){D.textContent=String(oe)}Se(l,f),F.set(l,{id:l,el:f,head:R,body:D}),V(l,!0)}function z(l){return l.style.display!=="none"}function $(l,y,T){let f=F.get(l);return f?z(f.el)?(f.el.style.display="none",V(l,!1),!1):(f.el.style.display="",Y(f.el),c(f.el),V(l,!0),!0):(E(l,y,R=>{let G=R.closest(".qws-win");G&&Z(l,G),T(R)}),!0)}function Y(l){let y=999999;F.forEach(T=>{let f=parseInt(getComputedStyle(T.el).zIndex||"999999",10);f>y&&(y=f)}),l.style.zIndex=String(y+1)}function Se(l,y){try{let T=parseFloat(y.style.right)||16,f=parseFloat(y.style.bottom)||16;localStorage.setItem(`qws:win:${l}:pos`,JSON.stringify({r:T,b:f}))}catch{}}function Z(l,y){try{let T=localStorage.getItem(`qws:win:${l}:pos`);if(!T)return;let f=JSON.parse(T);typeof f.r=="number"&&(y.style.right=f.r+"px"),typeof f.b=="number"&&(y.style.bottom=f.b+"px"),c(y)}catch{}}window.addEventListener("resize",()=>{F.forEach(l=>c(l.el))});function ce(){let l=null,y=H=>{let D=H;return D&&D.closest?.(".qws-win, .qws2")||null},T=H=>{if(!H.altKey||H.button!==0)return;let D=y(H.target);if(!D||D.style.display==="none")return;let ne=D.getBoundingClientRect(),oe=window.innerWidth,J=window.innerHeight,he=parseFloat(getComputedStyle(D).right),xe=parseFloat(getComputedStyle(D).bottom);Number.isNaN(he)&&(he=oe-ne.right),Number.isNaN(xe)&&(xe=J-ne.bottom),l={el:D,sx:H.clientX,sy:H.clientY,or:he,ob:xe},document.body.style.userSelect="none",Y(D),H.preventDefault(),H.stopPropagation()},f=H=>{if(!l)return;let D=H.clientX-l.sx,ne=H.clientY-l.sy,oe=l.or-D,J=l.ob-ne,he=l.el.getBoundingClientRect(),xe=window.innerWidth,He=window.innerHeight,k=Math.max(8,xe-he.width-8),L=Math.max(8,He-he.height-8);oe=Math.min(Math.max(oe,8),k),J=Math.min(Math.max(J,8),L),l.el.style.right=`${oe}px`,l.el.style.bottom=`${J}px`},R=()=>{if(!l)return;document.body.style.userSelect="",d(l.el);let H=l.el,D=!1;F.forEach(ne=>{ne.el===H&&!D&&(Se(ne.id,H),D=!0)}),!D&&H===o&&S(),l=null},G=()=>R(),O=H=>{(H.key==="Alt"||H.key==="AltGraph")&&R()};window.addEventListener("mousedown",T,!0),window.addEventListener("mousemove",f,!0),window.addEventListener("mouseup",G,!0),window.addEventListener("keyup",O,!0)}function P(l){let y=R=>{if(!R||!(R instanceof HTMLElement))return!1;if(R instanceof HTMLTextAreaElement)return!0;if(R instanceof HTMLInputElement){let G=(R.type||"").toLowerCase();return G==="text"||G==="number"||G==="search"}return R.isContentEditable===!0},T=R=>{let G=R.target,O=document.activeElement,H=D=>!!(D&&(l.contains(D)||D.closest?.(".qws-win")||D.closest?.(".qws2")));(H(G)&&y(G)||H(O)&&y(O))&&(R.stopPropagation(),R.stopImmediatePropagation?.())},f=["keydown","keypress","keyup"];return f.forEach(R=>{window.addEventListener(R,T,{capture:!0}),document.addEventListener(R,T,{capture:!0}),l.addEventListener(R,T,{capture:!0})}),()=>{f.forEach(R=>{window.removeEventListener(R,T,{capture:!0}),document.removeEventListener(R,T,{capture:!0}),l.removeEventListener(R,T,{capture:!0})})}}let q=[],N=new Map;function V(l,y){let T=N.get(l);T&&(T.textContent=y?"Close":"Open",T.dataset.open=y?"1":"0",y?T.classList.add("active"):T.classList.remove("active"))}function ae(l,y,T){q.push({id:l,title:y,render:T}),me(l,y,T)}function me(l,y,T){let f=document.createElement("div");f.className="launch-item",f.innerHTML=`<div class="name">${I(y)}</div>`;let R=document.createElement("button");R.className="btn",R.textContent="Open",R.dataset.open="0",N.set(l,R),R.onclick=()=>{let G=F.get(l);G&&G.el.style.display!=="none"?(G.el.style.display="none",V(l,!1)):(E(l,y,O=>{let H=O.closest(".qws-win");H&&Z(l,H),T(O)}),V(l,!0))},f.appendChild(R),x.appendChild(f)}try{t?.onRegister?.(ae)}catch{}P(o),ce(),(async()=>{try{await Ie()}catch{}})(),setInterval(()=>{try{let l=se();C.textContent="OPEN",u.textContent="WS: OPEN",m(C,"ok"),m(u,"ok")}catch{let l=!!window.__QWS_workerFound||ut;C.textContent=l?"Worker":"none",u.textContent="WS: "+(l?"via Worker":"none"),m(C,l?"ok":"warn"),m(u,l?"ok":"warn")}try{let l=$e(),y=mn();l?(g.textContent=`store: ${y.via||"ready"}`,m(g,"ok")):y.via==="polyfill"||y.polyfill?(g.textContent="store: polyfill",m(g,"warn")):(g.textContent="store: none",m(g,"bad"))}catch{g.textContent="store: error",m(g,"bad")}},800);function se(){for(let l=0;l<fe.length;l++)if(fe[l].readyState===ge.OPEN)return fe[l];throw new Error("no page ws")}function m(l,y){l.classList.remove("ok","warn","bad"),y&&l.classList.add(y)}function I(l){return l.replace(/[&<>"']/g,y=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[y])}}function Dn(){(async()=>(await K.startAutofeedWatcher(({petId:t,species:e,hungerPct:n,allowedCrops:r})=>{}),await Re.onQuantityChange("seeds",ct("seeds")),await Re.onQuantityChange("tools",ct("tools")),await Re.onQuantityChange("eggs",ct("eggs")),await Re.onQuantityChange("decor",ct("decor")),await At.syncNow().catch(()=>{}),await B.onGardenDiffNow(async(t,e)=>{await At.syncNow().catch(()=>{}),Bn([...e.added,...e.updated,...e.removed])}),await K.startAbilityLogsWatcher()))()}var nn=t=>{let e=new Date(t),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`},Zr=t=>t.replace(/[<>&]/g,e=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[e]),rn=class{constructor(e=2e3){this.max=e;_(this,"arr",[])}push(e){this.arr.push(e),this.arr.length>this.max&&this.arr.splice(0,this.arr.length-this.max)}toArray(){return this.arr.slice()}clear(){this.arr.length=0}},Je=new Map,Gn=!1;function ea(t){Gn?fe.forEach(e=>{Je.has(e)||tn(e,"late",t)}):(window.WebSocket===ge&&(window.WebSocket=new Proxy(ge,{construct(e,n,r){let a=Reflect.construct(e,n,r);return tn(a,"new",t),a}})),fe.forEach(e=>tn(e,"existing",t)),Gn=!0)}function tn(t,e,n){if(Je.has(t))return;let r=`WS#${1+Je.size} (${pt(t.readyState)})`,a={ws:t,id:r,listeners:[]};fe.includes(t)||fe.push(t),We?.(t,e);let s=d=>{let c="";try{c=typeof d.data=="string"?d.data:JSON.stringify(d.data)}catch{c=String(d.data)}n({t:Date.now(),dir:"in",text:c,ws:t})};t.addEventListener("message",s),a.listeners.push(()=>t.removeEventListener("message",s));let i=()=>{a.id=a.id.replace(/\(.*\)/,`(${pt(t.readyState)})`)},o=()=>{a.id=a.id.replace(/\(.*\)/,`(${pt(t.readyState)})`)};if(t.addEventListener("open",i),t.addEventListener("close",o),a.listeners.push(()=>t.removeEventListener("open",i)),a.listeners.push(()=>t.removeEventListener("close",o)),!a.sendOrig){let d=t.send.bind(t);a.sendOrig=d,t.send=c=>{try{let b=typeof c=="string"?c:JSON.stringify(c);n({t:Date.now(),dir:"out",text:b,ws:t})}catch{n({t:Date.now(),dir:"out",text:String(c),ws:t})}return d(c)}}Je.set(t,a)}async function jn(t){let e=new Te({id:"debug-tools",compact:!0});e.mount(t),e.addTab("jotai","Jotai",n=>ta(n,e)),e.addTab("websocket","WebSocket",n=>na(n,e))}function ta(t,e){t.innerHTML="";let n=e.section("Store"),r=e.btn("Capture store",async()=>{try{await Ie()}catch{}a.textContent=`captured: ${String($e())}`,c({capture:$e()})}),a=e.label(`captured: ${String($e())}`);n.appendChild(e.row(r,a)),t.appendChild(n);let s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",s.style.gap="12px",t.appendChild(s);{let p=e.section("Find / List atoms"),C=e.inputText("regex label (eg: position|health)",""),u=e.btn("List",()=>W()),g=e.btn("Copy",()=>S(x.textContent||"")),x=document.createElement("pre");v(x);async function W(){let F=C.value.trim(),h=M(F||".*"),$=Xe(/.*/).filter(Y=>h.test(String(Y?.debugLabel||Y?.label||""))).map(Y=>String(Y?.debugLabel||Y?.label||"<?>"));x.textContent=$.join(`
`),c({list:{query:F||".*",count:$.length}})}p.appendChild(e.row(C,u,g)),p.appendChild(x),s.appendChild(p)}{let p=e.section("Get / Subscribe"),C=e.inputText("atom label (eg: positionAtom)",""),u=e.btn("Get",async()=>{let h=pe(C.value.trim());if(!h){W.textContent=`Atom "${C.value}" not found`;return}try{b(W,await Pe(h)),c({get:{label:C.value,ok:!0}})}catch(E){b(W,E?.message||String(E)),c({get:{label:C.value,ok:!1,error:E?.message}})}}),g=e.btn("Subscribe",async()=>{let h=C.value.trim();if(!h)return;let E=pe(h);if(!E)return c(`Atom "${h}" not found`);if(F){F(),F=null,g.textContent="Subscribe",c({sub:{label:h,status:"unsubscribed"}});return}F=await Ve(E,async()=>{try{b(W,await Pe(E))}catch{}}),g.textContent="Unsubscribe",c({sub:{label:h,status:"subscribed"}})}),x=e.btn("Copy",()=>S(W.textContent||"")),W=document.createElement("pre");v(W);let F=null;p.appendChild(e.row(C,u,g,x)),p.appendChild(W),s.appendChild(p)}{let p=e.section("Set atom"),C=e.inputText("atom label (eg: activeModalAtom)",""),u=e.btn("Set",async()=>{let W=C.value.trim(),F=pe(W);if(!F)return c(`Atom "${W}" not found`);let h;try{h=JSON.parse(x.value)}catch{return w("Invalid JSON")}try{await ke(F,h),c({set:{label:W,ok:!0}})}catch(E){c({set:{label:W,ok:!1,error:E?.message}})}}),g=e.btn("Copy json",()=>S(x.value)),x=document.createElement("textarea");x.className="qmm-input",x.style.minHeight="120px",x.style.width="100%",x.placeholder='JSON value, eg: "inventory" or { "x": 1, "y": 2 }',p.appendChild(e.row(C,u,g)),p.appendChild(x),s.appendChild(p)}let i=e.section("Output"),o=e.row(e.label("\u2014"),(()=>{let p=document.createElement("div");return p.style.flex="1",p})(),e.btn("Copy",()=>S(d.textContent||"")),e.btn("Clear",()=>d.textContent="")),d=document.createElement("pre");v(d),i.appendChild(o),i.appendChild(d),t.appendChild(i);function c(p){let C=nn(Date.now());try{d.textContent+=`[${C}] ${JSON.stringify(p)}
`}catch{d.textContent+=`[${C}] ${String(p)}
`}d.scrollTop=d.scrollHeight}function b(p,C){p.textContent=typeof C=="string"?C:JSON.stringify(C,null,2)}function w(p){try{window.toastSimple?.(p,"","warn")}catch{}}function S(p){let C=String(p??"");if(!C.length)return;let u=()=>{let g=document.createElement("textarea");g.value=C,g.setAttribute("readonly","true"),g.style.position="fixed",g.style.left="-9999px",g.style.opacity="0",document.body.appendChild(g),g.focus(),g.select();let x=!1;try{x=document.execCommand("copy")}catch{}document.body.removeChild(g);try{window.toastSimple?.(x?"Copied":"Copy failed","",x?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(C).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(u):u()}function M(p){try{return new RegExp(p,"i")}catch{return/.*/i}}function v(p){p.style.maxHeight="260px",p.style.overflow="auto",p.style.background="#0f1318",p.style.border="1px solid #ffffff14",p.style.borderRadius="8px",p.style.padding="8px",p.style.margin="6px 0",p.style.fontSize="12px",p.style.color="#e7eef7"}}function na(t,e){t.innerHTML="";let n=new rn(2e3),r=new Map,a=0,s=!1,i=!0,o=!0,d=!0,c="",b=!1,w=!1,S=null,M=[],v=()=>{let k=document.createElement("div");return k.style.flex="1",k},p=k=>{if(S=k,[...se.querySelectorAll("[data-fid]")].forEach(L=>{L.classList.toggle("selected",String(k||"")===L.dataset.fid)}),k!=null){let L=r.get(k);L&&(l.value=L.text)}},C=k=>M.some(L=>L.test(k));function u(k){let L=String(k??"");if(!L.length)return;let X=()=>{let ee=document.createElement("textarea");ee.value=L,ee.setAttribute("readonly","true"),ee.style.position="fixed",ee.style.left="-9999px",ee.style.opacity="0",document.body.appendChild(ee),ee.focus(),ee.select();let be=!1;try{be=document.execCommand("copy")}catch{}document.body.removeChild(ee);try{window.toastSimple?.(be?"Copied":"Copy failed","",be?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(L).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(X):X()}let g=e.section("Live log"),x=e.label("\u2014"),W=e.checkbox(!0);W.addEventListener("change",()=>{o=W.checked,J(!0)});let F=e.checkbox(!0);F.addEventListener("change",()=>{d=F.checked,J(!0)});let h=e.inputText("filter text (case-insensitive)","");h.addEventListener("input",()=>{c=h.value.trim().toLowerCase(),J(!0)});let E=e.checkbox(!1);E.addEventListener("change",()=>{b=E.checked,J(!0)});let z=e.btn("Pause",()=>{s=!s,z.textContent=s?"Resume":"Pause"}),$=e.btn("Clear",()=>{n.clear(),r.clear(),p(null),J(!0)}),Y=e.btn("Copy visible",()=>he());g.appendChild(e.row(x,v(),W,e.label("IN"),F,e.label("OUT"),h,E,e.label("Current socket only"),z,$,Y)),t.appendChild(g);let Se=e.section("Mutes (exclude by regex)"),Z=e.inputText("add regex (e.g. ping|keepalive)",""),ce=e.btn("Add",()=>{let k=Z.value.trim();if(k)try{M.push(new RegExp(k,"i")),Z.value="",q(),J(!0)}catch{}}),P=document.createElement("div");P.style.display="flex",P.style.flexWrap="wrap",P.style.gap="6px";function q(){P.innerHTML="",M.forEach((k,L)=>{let X=document.createElement("button");X.className="qmm-btn",X.textContent=`/${k.source}/i \xD7`,X.title="Remove",X.onclick=()=>{M.splice(L,1),q(),J(!0)},P.appendChild(X)})}Se.appendChild(e.row(Z,ce)),Se.appendChild(P),t.appendChild(Se);let N=e.section("Sockets"),V=document.createElement("select");V.className="qmm-input",V.style.minWidth="260px",N.appendChild(V),t.appendChild(N);function ae(){let k=Array.from(Je.values());V.innerHTML="",k.forEach((L,X)=>{let ee=document.createElement("option");ee.value=String(X),ee.textContent=L.id+(L.ws===_e?" \u2022 page":""),V.appendChild(ee)}),!V.value&&V.options.length&&(V.value="0"),x.textContent=O()}function me(){let k=Number(V.value),L=Array.from(Je.values());return Number.isFinite(k)?L[k]?.ws??null:null}let se=document.createElement("div");se.style.border="1px solid #ffffff14",se.style.borderRadius="10px",se.style.background="#0f1318",se.style.padding="6px",se.style.maxHeight="46vh",se.style.overflow="auto",se.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",se.style.fontSize="12px",se.style.lineHeight="1.3",se.style.userSelect="text";let m=document.createElement("style");m.textContent=`
    .ws-row{display:grid;grid-template-columns:92px 18px 1fr auto;gap:8px;padding:3px 4px;border-bottom:1px dashed #ffffff12;align-items:start}
    .ws-row .ts{opacity:.8}
    .ws-row .arrow{font-weight:600}
    .ws-row .body{white-space:pre-wrap;word-break:break-word}
    .ws-row .acts{display:none;gap:6px}
    .ws-row:hover .acts{display:flex}
    .ws-row.selected{background:rgba(120,160,255,.12)}
    .ws-row .chip{border:1px solid #ffffff26;background:#ffffff14;border-radius:6px;padding:2px 6px;cursor:pointer}
  `,se.appendChild(m),t.appendChild(se);let I=e.section("Send"),l=document.createElement("textarea");l.className="qmm-input",l.style.width="100%",l.style.minHeight="120px",l.placeholder="Select a frame or paste a payload here. Choose Text or JSON below.";let y=e.radioGroup("ws-send-mode",[{value:"text",label:"Text"},{value:"json",label:"JSON"}],"text",()=>{}),T=e.checkbox(!1);T.addEventListener("change",()=>{w=T.checked});let f=e.btn("Send",()=>He()),R=e.btn("Copy payload",()=>u(l.value));I.appendChild(l),I.appendChild(e.row(y,T,e.label("Use source WS"),f,R)),t.appendChild(I),ea(k=>{if(s)return;let L={...k,id:++a};n.push(L),r.set(L.id,L),x.textContent=O(),oe(L)}),ae(),J(!0);let G=window.setInterval(()=>{ae()},1e3);t.__ws_cleanup__=()=>{window.clearInterval(G)};function O(){return`status: ${fe.some(X=>X.readyState===WebSocket.OPEN)?"OPEN":"none"} \u2022 mode: ${ut?"worker":"page/auto"}`}function H(k){return!(k.dir==="in"&&!o||k.dir==="out"&&!d||c&&!k.text.toLowerCase().includes(c)||b&&k.ws&&me()&&k.ws!==me()||C(k.text))}function D(k,L){let X=document.createElement("div");X.className="acts";let ee=document.createElement("button");ee.className="qmm-btn",ee.textContent="Copy",ee.onclick=Ne=>{Ne.stopPropagation(),u(L.text)};let be=document.createElement("button");be.className="qmm-btn",be.textContent="\u2192 Editor",be.onclick=Ne=>{Ne.stopPropagation(),l.value=L.text,p(k)};let Ce=document.createElement("button");return Ce.className="qmm-btn",Ce.textContent="Replay",Ce.title="Send right away (to current WS or source WS if enabled)",Ce.onclick=Ne=>{Ne.stopPropagation(),xe(L)},X.append(ee,be,Ce),X}function ne(k){let L=document.createElement("div");L.className="ws-row",L.dataset.fid=String(k.id);let X=document.createElement("div");X.className="ts",X.textContent=nn(k.t);let ee=document.createElement("div");ee.className="arrow",ee.textContent=k.dir==="in"?"\u2190":"\u2192",ee.style.color=k.dir==="in"?"#4bd17a":"#8ab4ff";let be=document.createElement("div");be.className="body",be.innerHTML=`<code>${Zr(k.text)}</code>`;let Ce=D(k.id,k);return L.append(X,ee,be,Ce),L.onclick=()=>p(k.id),L.ondblclick=()=>{l.value=k.text,p(k.id)},L}function oe(k){if(!H(k))return;let L=ne(k);se.appendChild(L),i&&(se.scrollTop=se.scrollHeight)}function J(k=!1){se.querySelectorAll(".ws-row").forEach(L=>L.remove()),n.toArray().forEach(L=>{H(L)&&se.appendChild(ne(L))}),S!=null&&p(S),i&&(se.scrollTop=se.scrollHeight)}function he(){let k=n.toArray().filter(L=>H(L)).map(L=>`[${nn(L.t)}] ${L.dir==="in"?"<-":"->"} ${L.text}`).join(`
`);u(k)}function xe(k){let L=w&&k.ws?k.ws:me();if(!L||L.readyState!==WebSocket.OPEN)return;if((y.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{L.send(JSON.parse(k.text))}catch{L.send(k.text)}else L.send(k.text)}function He(){let k=me(),L=S!=null&&w?r.get(S)?.ws??null:null,X=(w?L:k)||k;if(!X||X.readyState!==WebSocket.OPEN)return;if((y.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{X.send(JSON.parse(l.value))}catch{X.send(l.value)}else X.send(l.value)}}var an=new Map;function ra(t){try{return Xe(new RegExp("^"+t+"$"))}catch{return[]}}function aa(t){if(t&&typeof t.read=="function")return"read";for(let e of Object.keys(t||{})){let n=t[e];if(typeof n=="function"&&e!=="write"&&e!=="onMount"&&e!=="toString"){let r=n.length;if(r===1||r===2)return e}}throw new Error("Impossible de localiser la fonction read() de l'atom")}function sa(t){return an.get(t)||null}async function ia(t){!t?.closeAction||!t?.openAction||(await t.closeAction(),await new Promise(e=>setTimeout(e,0)),await t.openAction())}async function oa(t){let e=t.label,n=an.get(e);if(n?.installed)return n;let r=ra(t.label);if(!r.length)throw new Error(`${t.label} introuvable`);let a=n??{config:t,enabled:!1,payload:null,patched:new Map,installed:!1},s=null;t.gate?.label&&(s=pe(t.gate.label));for(let i of r){let o=aa(i),d=i[o];i[o]=c=>{try{s&&c(s)}catch{}for(let w of t.extraDeps||[])try{let S=pe(w);S&&c(S)}catch{}let b=d(c);return!a.enabled||a.payload==null?b:t.merge?t.merge(b,a.payload):a.payload},a.patched.set(i,{readKey:o,orig:d})}return s&&t.gate?.autoDisableOnClose&&(a.unsubGate=await Ve(s,async()=>{let i;try{i=await Pe(s)}catch{i=null}!(t.gate?.isOpen?t.gate.isOpen(i):!!i)&&a.enabled&&(a.enabled=!1)})),a.installed=!0,an.set(e,a),a}async function sn(t,e,n){await Ie();let r=await oa(t);r.payload=e,r.enabled=!0,n?.merge&&!t.merge&&(t.merge=(a,s)=>s),n?.openGate&&t.gate?.openAction&&await t.gate.openAction(),r.autoTimer&&(clearTimeout(r.autoTimer),r.autoTimer=null),n?.autoRestoreMs&&n.autoRestoreMs>0&&(r.autoTimer=setTimeout(()=>{Kn(t.label)},n.autoRestoreMs))}async function Kn(t){let e=sa(t);e&&(e.enabled=!1,e.payload=null,e.autoTimer&&(clearTimeout(e.autoTimer),e.autoTimer=null),await ia(e.config.gate))}var Ke={activeModal:"activeModalAtom",inventory:"myInventoryAtom",myData:"myDataAtom"};async function on(){let t=pe(Ke.activeModal);t&&await ke(t,"inventory")}async function $n(){let t=pe(Ke.activeModal);t&&await ke(t,null)}function Vn(t){return t==="inventory"}var la={label:Ke.inventory,merge:(t,e)=>e,gate:{label:Ke.activeModal,isOpen:Vn,openAction:on,closeAction:$n,autoDisableOnClose:!0}},ca={label:Ke.myData,merge:(t,e)=>({...t&&typeof t=="object"?t:{},inventory:e}),gate:{label:Ke.activeModal,isOpen:Vn,openAction:on,closeAction:$n,autoDisableOnClose:!0}};async function zn(t,e){let n=e?.open!==!1,r;try{let s=pe(Ke.inventory);s&&(r=await Pe(s).catch(()=>{}))}catch{}try{console.log("[fakeInventory] \u25B6 re\xE7u \u2192",t)}catch{}try{console.log("[fakeInventory] \u25B6 moi   \u2192",r)}catch{}let a=t;try{await sn(ca,a,{openGate:!1,autoRestoreMs:e?.autoRestoreMs})}catch{}await sn(la,a,{openGate:!1,autoRestoreMs:e?.autoRestoreMs}),n&&await on()}function da(t){if(!t||typeof t!="object")return[];let e=[],n=new Set,r=[t];for(;r.length;){let s=r.pop();if(!(!s||typeof s!="object"||n.has(s))){n.add(s);for(let i of Object.keys(s)){let o=s[i];Array.isArray(o)&&o.length&&o.every(d=>d&&typeof d=="object")&&o.some(c=>"id"in c&&"name"in c)&&/player/i.test(i)&&e.push(...o),o&&typeof o=="object"&&r.push(o)}}}let a=new Map;for(let s of e)s?.id&&a.set(String(s.id),s);return[...a.values()]}function ua(t){let e=t?.fullState?.data?.players??t?.data?.players??t?.players;return Array.isArray(e)?e:da(t)}function Un(t){let e=t?.child?.data?.userSlots??t?.fullState?.child?.data?.userSlots??t?.data?.userSlots;return Array.isArray(e)?e:e&&typeof e=="object"?Object.values(e):[]}function Jn(t){let e=t?.data?.position??t?.position??t?.data?.coords??t?.coords,n=Number(e?.x),r=Number(e?.y);return Number.isFinite(n)&&Number.isFinite(r)?{x:n,y:r}:null}function Xn(t){let e=t?.data?.inventory;if(!e||typeof e!="object")return null;let n=Array.isArray(e.items)?e.items:[],r=Array.isArray(e.favoritedItemIds)?e.favoritedItemIds:[];return{items:n,favoritedItemIds:r}}function Yn(t,e){for(let n of Un(t))if(String(n?.playerId??"")===String(e))return n;return null}function ma(t,e){let n=new Map;for(let r of Un(e)){if(!r||typeof r!="object")continue;let a=r.playerId!=null?String(r.playerId):"";if(!a)continue;let s=Jn(r),i=Xn(r);n.set(a,{x:s?.x,y:s?.y,inventory:i??null})}return t.map(r=>{let a=n.get(String(r.id));return a?{...r,...a}:{...r,inventory:null}})}var re={currentTargetId:null,unsub:null,lastPos:null,prevPos:null,steps:0},Ee={async list(){let t=await et.get();return t?ma(ua(t),t):[]},async onChange(t){return et.sub(async()=>{try{t(await this.list())}catch{}})},async getPosition(t){let e=await et.get();if(!e)return null;let n=Yn(e,t);return Jn(n)},async getInventory(t){let e=await et.get();if(!e)return null;let n=Yn(e,t);return Xn(n)},async teleportTo(t){let e=await this.getPosition(t);if(!e)throw new Error("Unknown position for this player");B.teleport(e.x,e.y),ue("Teleport",`Teleported to ${e.x}, ${e.y}`,"success")},async openInventoryPreview(t,e){try{let n=await Ee.getInventory(t);if(!n||!Array.isArray(n.items)||n.items.length===0){await ue("Inventory","No usable inventory for this player.","warn");return}await zn(n,{open:!0}),e&&await ue("Inventory",`${e}'s inventory displayed.`,"info")}catch(n){await ue("Inventory",n?.message||"Failed to open inventory.","error")}},async stopFollowing(){if(re.unsub)try{re.unsub()}catch{}re.unsub=null,re.currentTargetId=null,re.lastPos=null,re.prevPos=null,re.steps=0},isFollowing(t){return re.currentTargetId===t},async startFollowing(t){if(re.unsub){try{re.unsub()}catch{}re.unsub=null}re.currentTargetId=t,re.lastPos=null,re.prevPos=null,re.steps=0;let e=await Ee.getPosition(t);if(!e){await ue("Follow","Unable to retrieve player position.","error"),re.currentTargetId=null;return}await B.teleport(e.x,e.y),re.lastPos={x:e.x,y:e.y},re.prevPos=null,re.steps=0,re.unsub=await Ee.onChange(async n=>{if(re.currentTargetId!==t)return;let r=n.find(i=>i.id===t);if(!r||typeof r.x!="number"||typeof r.y!="number"){this.stopFollowing(),await ue("Follow","The target is no longer trackable (disconnected?).","error");return}let a={x:r.x,y:r.y},s=re.lastPos;if(!s){re.lastPos=a;return}(a.x!==s.x||a.y!==s.y)&&(re.steps+=1,re.steps>=2&&s&&B.move(s.x,s.y),re.prevPos=re.lastPos,re.lastPos=a)}),await ue("Follow","Follow enabled","success")}};async function pa(){return Ee.list()}function ya(t,e=22){return t?t.length<=e?t:t.slice(0,e-1)+"\u2026":""}var ga=t=>({id:t.id,title:ya(t.name||t.id,9),subtitle:t.isConnected?"Online":"Offline",avatarUrl:t.discordAvatarUrl||"",statusColor:t.isConnected?"#48d170":"#999a"});async function Qn(t){let e=new Te({id:"players",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views"),{root:r,left:a,right:s}=e.split2("260px");n.appendChild(r);let i=e.vtabs({filterPlaceholder:"Find player\u2026",onSelect:(M,v)=>d(v?.id||null)});a.appendChild(i.root);let o=i.root.querySelector(".filter");if(o){o.style.display="flex",o.style.alignItems="center",o.style.gap="8px";let M=o.querySelector("input");M&&(M.style.flex="1 1 auto",M.style.minWidth="0");let v=document.createElement("button");v.className="qmm-btn",v.title="Refresh",v.setAttribute("aria-label","Refresh"),v.style.width="34px",v.style.height="34px",v.style.padding="0",v.style.display="inline-flex",v.style.alignItems="center",v.style.justifyContent="center",v.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M12 6a6 6 0 0 1 5.66 4H20l-3.5 3.5L13 10h2.34A4 4 0 1 0 16 12h2a6 6 0 1 1-6-6z"/>
      </svg>
    `,v.onclick=async()=>{await S(!0)},o.appendChild(v)}function d(M){s.innerHTML="";let v=M&&c.find($=>$.id===M)||null;if(!v){let $=document.createElement("div");$.style.opacity="0.75",$.textContent="Select a player on the left.",s.appendChild($);return}let p=document.createElement("div");p.style.display="flex",p.style.alignItems="center",p.style.gap="12px";let C=document.createElement("img");C.src=v.discordAvatarUrl||"",C.alt=v.name,C.width=48,C.height=48,C.style.borderRadius="50%",C.style.objectFit="cover",C.style.border="1px solid #4446";let u=document.createElement("div"),g=document.createElement("div");g.textContent=v.name||v.id,g.style.fontWeight="600",g.style.fontSize="16px";let x=document.createElement("div");x.style.opacity="0.8",x.style.fontSize="12px";let W=v.isConnected?"Online":"Offline";x.textContent=W,u.appendChild(g),u.appendChild(x),p.appendChild(C),p.appendChild(u),s.appendChild(p);let F=document.createElement("div");F.style.display="flex",F.style.gap="8px",F.style.marginTop="8px",F.appendChild(e.btn("Teleport",async()=>{try{await Ee.teleportTo(v.id)}catch($){ue("Teleport",$?.message||"Error during teleport.","error")}})),F.appendChild(e.btn("Inventory",async()=>{await Ee.openInventoryPreview(v.id,v.name)}));let h=document.createElement("div");h.style.display="flex",h.style.alignItems="center",h.style.marginTop="6px",h.style.gap="8px";let E=document.createElement("div");E.textContent="Follow",E.style.fontSize="14px",E.style.opacity="0.85";let z=e.switch(Ee.isFollowing(v.id));z.addEventListener("change",async()=>{try{z.checked?(await Ee.startFollowing(v.id),await ue("Follow","Follow activ\xE9.","success")):(Ee.stopFollowing(),await ue("Follow","Follow d\xE9sactiv\xE9.","info"))}catch($){await ue("Follow",$?.message||"Erreur sur le follow.","error"),z.checked=!z.checked}}),h.appendChild(E),h.appendChild(z),s.appendChild(F),s.appendChild(h)}let c=[],b="";function w(M){return M.map(v=>`${v.id}|${v.name??""}|${v.isConnected?1:0}|${v.inventory?.items?.length??0}`).join(";")}async function S(M=!0){let v=i.getSelected()?.id??null,p=await pa(),C=w(p);if(C===b)return;b=C,c=p,i.setItems(c.map(ga));let u=M&&v&&c.some(g=>g.id===v)?v:c[0]?.id??null;u!==null?i.select(u):d(null)}await Ee.onChange(()=>{S(!0).catch(()=>{})}),await S(!0)}function Zn(t,e){t.textContent=e,t.style.flex="1",t.style.margin="0",t.style.padding="6px 10px",t.style.borderRadius="8px",t.style.border="1px solid #4445",t.style.background="#1f2328",t.style.color="#e7eef7",t.style.justifyContent="center",t.onmouseenter=()=>t.style.borderColor="#6aa1",t.onmouseleave=()=>t.style.borderColor="#4445"}function fa(){let t=document.createElement("div");return t.style.display="flex",t.style.flexWrap="wrap",t.style.justifyContent="center",t.style.alignItems="center",t.style.gap="8px",t}function tr(t,e){let n=document.createElement("div");n.style.display="grid",n.style.justifyItems="center",n.style.gap="8px",n.style.textAlign="center",n.style.border="1px solid #4446",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#1f2328",n.style.boxShadow="0 0 0 1px #0002 inset",n.style.width="min(720px, 100%)";let r=document.createElement("div");return r.textContent=t,r.style.fontWeight="600",r.style.opacity="0.95",n.append(r,e),n}var er=t=>{let e=new Date(t),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(e.getHours())}:${n(e.getMinutes())}:${n(e.getSeconds())}.${String(e.getMilliseconds()).padStart(3,"0")}`};function ha(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateColumns="minmax(220px, 260px) minmax(0, 1fr)",n.style.gap="10px",n.style.alignItems="stretch",n.style.height="54vh",n.style.overflow="hidden",n.style.border="1px solid #4445",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#0f1318",t.appendChild(n);let r=document.createElement("div");r.style.display="grid",r.style.gridTemplateColumns="1fr",r.style.rowGap="6px",r.style.overflow="auto",r.style.padding="6px",r.style.border="1px solid #4445",r.style.borderRadius="10px",n.appendChild(r);let a=document.createElement("div");a.style.display="flex",a.style.flexDirection="column",a.style.gap="12px",a.style.overflow="auto",a.style.minHeight="0",n.appendChild(a);let s=(u,g)=>tr(u,g),i=()=>fa(),o=(()=>{let u=i(),g=e.switch(!1);return g.id="pets.autofeed.enabled",u.append(g,e.label("Enable Autofeed for this pet")),{wrap:s("Activation",u),sw:g}})();a.appendChild(o.wrap);let d=(()=>{let u=i(),g=e.label("Feed when hunger < (%)"),x=e.inputNumber(1,100,1,10);return x.id="pets.autofeed.thresholdPct",u.append(g,x.wrap??x),{wrap:s("Local threshold",u),num:x}})();a.appendChild(d.wrap);let c=(()=>{let u=e.table(["Allow","Crop"],{minimal:!0,maxHeight:"50vh",fixed:!0});return{wrap:s("Compatible crops",u.root),tbody:u.tbody}})();a.appendChild(c.wrap);let b=[],w=K.getSelectedPetId?.()??null;function S(){if(r.innerHTML="",!b.length){let u=document.createElement("div");u.textContent="No pets to display",u.style.opacity="0.75",r.appendChild(u),p(null);return}for(let u of b){let g=String(u?.slot?.id||""),x=(u?.slot?.name||u?.slot?.petSpecies||"Pet").toString(),W=u?.slot?.petSpecies?`(${u.slot.petSpecies})`:"",F=K.getHungerPctFor(u),h=document.createElement("button");h.className="qmm-btn",h.dataset.pid=g,h.setAttribute("aria-pressed",g===w?"true":"false"),h.style.display="flex",h.style.justifyContent="space-between",h.style.alignItems="center",h.style.width="100%",h.style.textAlign="left";let E=document.createElement("div");E.textContent=`${x} ${W}`;let z=document.createElement("div");z.style.opacity="0.8",z.textContent=`${F}%`,h.append(E,z),h.classList.toggle("active",g===w),h.onclick=()=>{w!==g&&(w=g,K.setSelectedPet(w),r.querySelectorAll("button.qmm-btn").forEach($=>{let Y=$.dataset.pid===w;$.classList.toggle("active",Y),$.setAttribute("aria-pressed",Y?"true":"false")}),p(g))},r.appendChild(h)}}function M(){o.sw.onchange=async()=>{if(w)try{await K.setPetAutofeedEnabled(w,!!o.sw.checked)}catch{}},d.num.addEventListener("change",async()=>{if(!w)return;let u=Math.max(1,Math.min(100,Number(d.num.value)||10));d.num.value=String(u);try{await K.setPetAutofeedThresholdPct(w,u)}catch{}})}async function v(u,g){let x=c.tbody;if(x.innerHTML="",!u||!g){let h=document.createElement("tr"),E=document.createElement("td");E.colSpan=2,E.style.opacity="0.75",E.textContent="Select a pet to view compatible crops.",h.appendChild(E),x.appendChild(h);return}let W=[],F=new Set;try{let h=K.getCompatibleCropsForSpecies(g);W=Array.isArray(h)?h:[]}catch{}try{let h=await K.getPetAllowedCrops(u);F=h instanceof Set?h:new Set(Array.isArray(h)?h:[])}catch{F=new Set(W)}if(!W.length){let h=document.createElement("tr"),E=document.createElement("td");E.colSpan=2,E.style.opacity="0.75",E.textContent="No compatible crops for this species.",h.appendChild(E),x.appendChild(h);return}W.forEach(h=>{let E=document.createElement("tr"),z=document.createElement("td"),$=e.switch(F.has(h));$.ariaLabel=`Allow ${h}`,$.onchange=async()=>{if(w)try{await K.setPetAllowedCrop(w,h,!!$.checked)}catch{}},z.appendChild($);let Y=document.createElement("td");Y.textContent=h,E.append(z,Y),x.appendChild(E)})}async function p(u){let g=!!u;if(o.sw.disabled=!g,d.num.disabled=!g,!g){o.sw.checked=!1,d.num.value="10",await v(null,null);return}try{o.sw.checked=await K.getPetAutofeedEnabled(u)}catch{o.sw.checked=!1}try{let F=await K.getPetAutofeedThresholdPct(u);d.num.value=String(Math.max(1,Math.min(100,F|0||10)))}catch{d.num.value="10"}let W=(b.find(F=>String(F?.slot?.id||"")===u)||null)?.slot?.petSpecies||null;await v(u,W)}K.onPetsChangeNow(u=>{b=Array.isArray(u)?u.slice():[],b.some(g=>String(g?.slot?.id||"")===w)||(w=b[0]?.slot?.id?String(b[0].slot.id):null,K.setSelectedPet(w)),S(),p(w)}).then(u=>{t.__unsubPets=u}).catch(()=>{}),M(),t.__cleanup__=()=>{try{t.__unsubPets?.()}catch{}}}function ba(t,e){t.innerHTML="";let n=(m,I)=>{m.textContent=I,m.style.width="100%",m.style.margin="0",m.style.padding="10px",m.style.borderRadius="8px",m.style.border="1px solid #4445",m.style.background="#1f2328",m.style.color="#e7eef7",m.style.justifyContent="center",m.onmouseenter=()=>m.style.borderColor="#6aa1",m.onmouseleave=()=>m.style.borderColor="#4445"},r=(m,I)=>tr(m,I),a=()=>{let m=document.createElement("div");return m.style.display="flex",m.style.alignItems="center",m.style.flexWrap="wrap",m.style.gap="8px",m},s=document.createElement("div");s.style.display="grid",s.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",s.style.gap="10px",s.style.alignItems="stretch",s.style.height="54vh",s.style.overflow="hidden",t.appendChild(s);let i=document.createElement("div");i.style.display="grid",i.style.gridTemplateRows="1fr auto",i.style.gap="8px",i.style.minHeight="0",s.appendChild(i);let o=document.createElement("div");o.style.display="flex",o.style.flexDirection="column",o.style.gap="6px",o.style.overflow="auto",o.style.padding="6px",o.style.border="1px solid #4445",o.style.borderRadius="10px",o.style.scrollBehavior="smooth",o.style.minHeight="0",i.appendChild(o);let d=document.createElement("div");d.style.display="flex",d.style.gap="6px",i.appendChild(d);let c=document.createElement("button");c.id="pets.teams.new";let b=document.createElement("button");b.id="pets.teams.duplicate";let w=document.createElement("button");w.id="pets.teams.delete",n(c,"New"),n(b,"Duplicate"),n(w,"Delete"),d.append(c,b,w);let S=[],M=null,v=!1,p=null,C=null,u=0;function g(m){let I=m.name?.trim()||m.petSpecies,l=Array.isArray(m.abilities)?m.abilities.filter(Boolean):[];if(!l.length)return`${I} \u2022 No abilities`;let y=l.slice(0,2).join(", "),T=l.length>2?` +${l.length-2}`:"";return`${I} \u2022 ${y}${T}`}function x(){return S.find(m=>m.id===M)||null}function W(m){let I=Array.from(o.children);if(!I.length)return 0;let l=I[0].getBoundingClientRect();if(m<l.top+l.height/2)return 0;for(let y=0;y<I.length;y++){let T=I[y].getBoundingClientRect(),f=T.top+T.height/2;if(m<f)return y}return I.length}function F(){let m=Array.from(o.children);if(m.forEach(y=>y.style.transform=""),p===null||C===null)return;let I=p,l=C;m.forEach((y,T)=>{y.style.transition="transform 120ms ease",T!==I&&(l>I&&T>I&&T<l&&(y.style.transform=`translateY(${-u}px)`),l<I&&T>=l&&T<I&&(y.style.transform=`translateY(${u}px)`))})}function h(){Array.from(o.children).forEach(m=>{m.style.transform="",m.style.transition=""})}function E(){if(h(),p=null,C=null,u=0,o.innerHTML="",!S.length){let m=document.createElement("div");m.textContent="No teams yet. Create one!",m.style.opacity="0.75",m.style.textAlign="center",m.style.padding="8px",o.appendChild(m),me(null);return}S.forEach((m,I)=>{let l=document.createElement("div");l.dataset.index=String(I),l.textContent=m.name||"(unnamed)",l.style.height="36px",l.style.lineHeight="36px",l.style.padding="0 10px",l.style.border="1px solid #ffffff15",l.style.borderRadius="6px",l.style.cursor="pointer",l.style.fontSize="13px",l.style.overflow="hidden",l.style.whiteSpace="nowrap",l.style.textOverflow="ellipsis",l.style.display="flex",l.style.flex="0 0 auto",l.style.gap="8px",l.style.alignItems="center",l.style.background=m.id===M?"#2a313a":"#1f2328";let y=document.createElement("span");y.className="qmm-grab",y.title="Drag to reorder",y.innerHTML="&#8942;",y.draggable=!0,l.onmouseenter=()=>l.style.borderColor="#6aa1",l.onmouseleave=()=>l.style.borderColor="#ffffff15",l.onclick=T=>{if(T.__byDrag)return;M!==m.id&&(M=m.id,E()),me(x())},y.addEventListener("dragstart",T=>{p=I,u=l.getBoundingClientRect().height,l.classList.add("qmm-dragging"),T.dataTransfer?.setData("text/plain",String(I)),T.dataTransfer&&(T.dataTransfer.effectAllowed="move");try{let f=l.cloneNode(!0);f.style.width=`${l.getBoundingClientRect().width}px`,f.style.position="absolute",f.style.top="-9999px",document.body.appendChild(f),T.dataTransfer.setDragImage(f,f.offsetWidth/2,f.offsetHeight/2),setTimeout(()=>document.body.removeChild(f),0)}catch{}}),y.addEventListener("dragend",()=>{l.classList.remove("qmm-dragging"),h(),p=null,C=null}),l.addEventListener("dragover",T=>{if(T.preventDefault(),T.dataTransfer&&(T.dataTransfer.dropEffect="move"),p===null)return;let f=Number(T.currentTarget.dataset.index||-1);if(f<0)return;let R=l.getBoundingClientRect(),G=R.top+R.height/2,O=T.clientY<G?f:f+1,H=Math.max(0,Math.min(S.length,O));C!==H&&(C=H,F());let D=28,ne=o.getBoundingClientRect();T.clientY<ne.top+D?o.scrollTop-=18:T.clientY>ne.bottom-D&&(o.scrollTop+=18)}),l.addEventListener("drop",T=>{if(T.preventDefault(),T.__byDrag=!0,p===null)return;let f=C??W(T.clientY);if(f>p&&(f-=1),f=Math.max(0,Math.min(S.length-1,f)),f!==p){let R=S.slice(),[G]=R.splice(p,1);R.splice(f,0,G),S=R;try{K.setTeamsOrder(S.map(O=>O.id))}catch{}}h(),p=null,C=null,u=0,E()}),l.appendChild(y),o.appendChild(l)})}o.addEventListener("dragover",m=>{if(m.preventDefault(),m.dataTransfer&&(m.dataTransfer.dropEffect="move"),p===null)return;let I=W(m.clientY);C!==I&&(C=I,F());let l=28,y=o.getBoundingClientRect();m.clientY<y.top+l?o.scrollTop-=18:m.clientY>y.bottom-l&&(o.scrollTop+=18)}),o.addEventListener("drop",m=>{if(m.preventDefault(),p===null)return;let I=C??W(m.clientY);if(I>p&&(I-=1),I=Math.max(0,Math.min(S.length-1,I)),I!==p){let l=S.slice(),[y]=l.splice(p,1);l.splice(I,0,y),S=l;try{K.setTeamsOrder(S.map(T=>T.id))}catch{}}h(),p=null,C=null,u=0,E()}),c.onclick=()=>{M=K.createTeam("New Team").id,E(),me(x())},b.onclick=()=>{if(!M)return;let m=K.duplicateTeam(M);m&&(M=m.id,E(),me(x()))},w.onclick=()=>{!M||K.deleteTeam(M)};let z=null;(async()=>{try{z=await K.onTeamsChangeNow(async m=>{S=Array.isArray(m)?m.slice():[],M&&!S.some(I=>I.id===M)&&(M=S[0]?.id??null),!M&&S.length&&(M=S[0].id),E(),await K.getInventoryPets(),await me(x())})}catch{}})();let $=document.createElement("div");$.style.display="grid",$.style.gridTemplateRows="auto 1fr",$.style.gap="10px",$.style.minHeight="0",s.appendChild($);let Y=document.createElement("div");Y.style.display="flex",Y.style.alignItems="center",Y.style.gap="8px";let Se=document.createElement("div");Se.textContent="Team editor \u2014 ",Se.style.fontWeight="700",Se.style.fontSize="14px";let Z=document.createElement("button");Z.id="pets.teams.useThisTeam",Z.textContent="Use this team",Z.style.padding="6px 10px",Z.style.borderRadius="8px",Z.style.border="1px solid #4445",Z.style.background="#1f2328",Z.style.color="#e7eef7",Z.style.cursor="pointer",Z.onmouseenter=()=>Z.style.borderColor="#6aa1",Z.onmouseleave=()=>Z.style.borderColor="#4445",Z.disabled=!0;let ce=document.createElement("button");ce.id="pets.teams.save",ce.textContent="Save",ce.style.padding="6px 10px",ce.style.borderRadius="8px",ce.style.border="1px solid #4445",ce.style.background="#1f2328",ce.style.color="#e7eef7",ce.style.cursor="pointer",ce.onmouseenter=()=>ce.style.borderColor="#6aa1",ce.onmouseleave=()=>ce.style.borderColor="#4445",ce.disabled=!0,Y.append(Se,Z,ce),$.appendChild(Y);let P=document.createElement("div");P.style.border="1px solid #4445",P.style.borderRadius="10px",P.style.padding="10px",P.style.display="flex",P.style.flexDirection="column",P.style.gap="12px",P.style.overflow="auto",P.style.minHeight="0",P.style.background="#0f1318",$.appendChild(P);let q=(()=>{let m=a(),I=e.inputText("Team name","");return I.id="pets.teams.editor.name",I.style.minWidth="260px",m.append(I),P.appendChild(r("Team name",m)),{nameInput:I}})(),N=(()=>{let m=document.createElement("div");m.style.display="flex",m.style.justifyContent="center";let I=e.inputText("Search (pet / species / ability)","");return I.id="pets.teams.filter.search",I.style.minWidth="260px",m.append(I),P.appendChild(r("Search",m)),{inputSearch:I}})(),V=(()=>{let m=oe=>{let J=document.createElement("select");J.className="qmm-input",J.id=oe,J.style.minWidth="200px";let he=document.createElement("option");return he.value="",he.textContent="\u2014 Select pet \u2014",J.appendChild(he),J},I=document.createElement("div");I.style.display="grid",I.style.gridTemplateColumns="1fr",I.style.rowGap="10px",I.style.justifyItems="center";let l=m("pets.teams.editor.slot.0"),y=m("pets.teams.editor.slot.1"),T=m("pets.teams.editor.slot.2"),f=document.createElement("div");f.style.display="flex",f.style.gap="8px",f.style.alignItems="center",f.append(e.label("Slot 1"),l);let R=document.createElement("div");R.style.display="flex",R.style.gap="8px",R.style.alignItems="center",R.append(e.label("Slot 2"),y);let G=document.createElement("div");G.style.display="flex",G.style.gap="8px",G.style.alignItems="center",G.append(e.label("Slot 3"),T),I.append(f,R,G);let O=document.createElement("div");O.style.display="flex",O.style.gap="6px",O.style.justifyContent="center";let H=document.createElement("button");n(H,"Use current active"),H.id="pets.teams.useCurrent";let D=document.createElement("button");n(D,"Clear slots"),D.id="pets.teams.clearSlots",O.append(H,D);let ne=document.createElement("div");return ne.style.display="flex",ne.style.flexDirection="column",ne.style.gap="10px",ne.append(I,O),P.appendChild(r("Active pets (3 slots)",ne)),{selects:[l,y,T],btnUseCurrent:H,btnClear:D}})();async function ae(m){let I=m??x();if(!I)return;V.selects.forEach(y=>y.style.visibility="hidden");let l=await K.getInventoryPets();await Promise.all(V.selects.map(async(y,T)=>{let f=I.slots[T]||"",R=await K.getTeamSlotOptions(I.id,T);y.innerHTML="";let G=document.createElement("option");G.value="",G.textContent="\u2014 Select pet \u2014",y.appendChild(G);for(let O of R){let H=document.createElement("option");H.value=O.id,H.textContent=g(O),y.appendChild(H)}if(f&&!R.some(O=>O.id===f)){let O=l.find(D=>D.id===f)||null,H=document.createElement("option");H.value=f,H.textContent=O?g(O):`[Missing] ${f}`,y.insertBefore(H,y.children[1]||null)}y.value=f})),V.selects.forEach(y=>y.style.visibility="")}async function me(m){let I=!!m;if(q.nameInput.disabled=!I,V.selects.forEach(l=>l.disabled=!I),V.btnClear.disabled=!I,V.btnUseCurrent.disabled=!I,Z.disabled=!I,ce.disabled=!I,!I){q.nameInput.value="",V.selects.forEach(l=>l.value="");return}q.nameInput.value=m.name||"",N.inputSearch.value=K.getTeamSearch(m.id)||"",await ae(m),m.slots.slice(0,3).forEach((l,y)=>{V.selects[y].value=l||""})}q.nameInput.addEventListener("keydown",m=>{m.key==="Enter"&&m.currentTarget.blur()}),q.nameInput.addEventListener("blur",()=>{let m=x();if(!m)return;let I=q.nameInput.value.trim();I!==m.name&&K.saveTeam({id:m.id,name:I})}),N.inputSearch.addEventListener("input",()=>{let m=x();m&&(K.setTeamSearch(m.id,N.inputSearch.value.trim()),ae())}),V.selects.forEach((m,I)=>{m.addEventListener("change",()=>{let l=x();if(!l)return;let y=l.slots.slice(0,3),T=m.value||null;y[I]=T,K.saveTeam({id:l.id,slots:y}),ae()})}),V.btnUseCurrent.onclick=async()=>{let m=x();if(m)try{let I=await K.getPets(),y=(Array.isArray(I)?I:[]).map(f=>String(f?.slot?.id||"")).filter(f=>!!f).slice(0,3),T=[y[0]||null,y[1]||null,y[2]||null];K.saveTeam({id:m.id,slots:T}),ae()}catch{}},V.btnClear.onclick=()=>{let m=x();m&&(K.saveTeam({id:m.id,slots:[null,null,null]}),ae())},ce.onclick=()=>{let m=x();if(!m)return;let I=q.nameInput.value.trim(),l=V.selects.map(y=>y.value||null);K.saveTeam({id:m.id,name:I,slots:l}),ae()},Z.onclick=async()=>{let m=x();if(m)try{v=!0,await K.useTeam(m.id),await K.getInventoryPets(),await new Promise(I=>setTimeout(I,0)),await me(x()),console.log("[Pets] Dispatched 'pets:use-team'",{teamId:m.id})}catch(I){console.warn("[Pets] Use this team failed:",I)}finally{v=!1}};let se=null;(async()=>{try{ae(),se=await K.onInventoryPetsChange(async()=>{v||await ae(x())})}catch{}})(),t.__cleanup__=(()=>{let m=t.__cleanup__;return()=>{try{z?.()}catch{}try{se?.()}catch{}try{m?.()}catch{}}})()}function Sa(t,e){t.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.height="54vh",t.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="8px",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="8px 10px",r.style.background="#0f1318",n.appendChild(r);let a=document.createElement("select");a.className="qmm-input",a.style.minWidth="200px",a.id="pets.logs.filter.ability";let s=document.createElement("select");s.className="qmm-input",s.style.minWidth="140px",s.id="pets.logs.sort",[["desc","Newest first"],["asc","Oldest first"]].forEach(([P,q])=>{let N=document.createElement("option");N.value=P,N.textContent=q,s.appendChild(N)}),s.value="desc";let i=e.inputText("search (pet / ability / details)","");i.id="pets.logs.search",i.style.minWidth="220px";let o=document.createElement("button");Zn(o,"Copy"),o.id="pets.logs.copy";let d=document.createElement("button");Zn(d,"Clear"),d.id="pets.logs.clear",r.append(e.label("Ability"),a,e.label("Sort"),s,i,o,d);let c=document.createElement("div");c.style.border="1px solid #4445",c.style.borderRadius="10px",c.style.padding="10px",c.style.background="#0f1318",c.style.overflow="hidden",c.style.display="grid",c.style.gridTemplateRows="auto 1fr",c.style.minHeight="0",n.appendChild(c);let b=document.createElement("div");b.style.display="grid",b.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",b.style.columnGap="0",b.style.borderBottom="1px solid #ffffff1a",b.style.padding="0 0 6px 0";function w(P,q="center"){let N=document.createElement("div");return N.textContent=P,N.style.fontWeight="600",N.style.opacity="0.9",N.style.padding="6px 8px",N.style.textAlign=q,N}b.append(w("Time"),w("Pet"),w("Ability"),w("Details","left")),c.appendChild(b);let S=document.createElement("div");S.style.display="grid",S.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",S.style.gridAutoRows="auto",S.style.alignContent="start",S.style.overflow="auto",S.style.width="100%",S.style.minHeight="0",c.appendChild(S);let M=[],v=new Set,p="",C="desc",u="",g=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function x(P){return Math.round(P)}function W(P){if(typeof P=="number")return x(P);if(P==null)return P;if(Array.isArray(P))return P.map(W);if(typeof P=="object"){let q={};for(let N of Object.keys(P))q[N]=W(P[N]);return q}return P}function F(P,q=0){if(P==null)return"";if(typeof P=="number")return g.format(P);if(typeof P=="string")return P;if(typeof P=="boolean")return String(P);if(Array.isArray(P))return P.map(N=>F(N,q+1)).join(", ");if(typeof P=="object"){let N=Object.entries(P);return N.length?N.map(([V,ae])=>{if(ae!==null&&typeof ae=="object")try{let me=W(ae);return`${V}: ${JSON.stringify(me)}`}catch{return`${V}: ${String(ae)}`}return`${V}: ${F(ae,q+1)}`}).join(", "):""}return String(P)}function h(P){try{let q=W(P);return F(q)}catch{try{return JSON.stringify(P)}catch{return String(P??"")}}}function E(P){try{return h(P).toLowerCase()}catch{try{return JSON.stringify(P).toLowerCase()}catch{return""}}}function z(){let P=a.value;a.innerHTML="";let q=[["","All abilities"],...Array.from(v).sort().map(N=>[N,N])];for(let[N,V]of q){let ae=document.createElement("option");ae.value=N,ae.textContent=V,a.appendChild(ae)}a.value=q.some(([N])=>N===P)?P:""}function $(P,q="center"){let N=document.createElement("div");return N.textContent=P,N.style.padding="6px 8px",N.style.textAlign=q,N.style.whiteSpace=q==="left"?"pre-wrap":"normal",N.style.wordBreak=q==="left"?"break-word":"normal",N.style.borderBottom="1px solid #ffffff12",N}function Y(P){let q=$(er(P.performedAt),"center"),N=P.petName||P.species||"Pet",V=$(N,"center"),ae=$(P.abilityId,"center"),me=h(P.data),se=$(me,"left");S.append(q,V,ae,se)}function Se(){let P=M.slice();if(p&&(P=P.filter(q=>q.abilityId===p)),u){let q=u.toLowerCase();P=P.filter(N=>{let V=(N.petName||N.species||"").toLowerCase(),ae=(N.abilityId||"").toLowerCase(),me=E(N.data);return V.includes(q)||ae.includes(q)||me.includes(q)||N.petId.toLowerCase().includes(q)})}return P.sort((q,N)=>C==="asc"?q.performedAt-N.performedAt:N.performedAt-q.performedAt),P}function Z(){S.innerHTML="";let P=Se();if(!P.length){let q=document.createElement("div");q.textContent="No logs yet.",q.style.opacity="0.75",q.style.gridColumn="1 / -1",q.style.padding="8px",S.appendChild(q);return}P.forEach(Y),S.scrollTop=S.scrollHeight+32}a.onchange=()=>{p=a.value,Z()},s.onchange=()=>{C=s.value||"desc",Z()},i.addEventListener("input",()=>{u=i.value.trim(),Z()}),d.onclick=()=>{try{K.clearAbilityLogs()}catch{}},o.onclick=async()=>{let P=Se().map(N=>({time:er(N.performedAt),pet:N.petName||N.species||N.petId,petId:N.petId,ability:N.abilityId,data:W(N.data)})),q=JSON.stringify(P,null,2);try{await navigator.clipboard.writeText(q)}catch{}};let ce=null;(async()=>{try{v=new Set(K.getSeenAbilityIds()),z(),ce=K.onAbilityLogs(P=>{M=P.map(q=>({petId:q.petId,petName:q.name??null,species:q.species??null,abilityId:q.abilityId,data:q.data,performedAt:q.performedAt})),v=new Set(K.getSeenAbilityIds()),z(),Z()})}catch{}})(),t.__cleanup__=()=>{try{ce?.()}catch{}},Z()}function nr(t){let e=new Te({id:"pets",compact:!0});e.mount(t),e.addTab("autofeed","Autofeed",n=>ha(n,e)),e.addTab("manager","Manager",n=>ba(n,e)),e.addTab("logs","Logs",n=>Sa(n,e))}function va(){let t=document.createElement("div");return t.style.display="flex",t.style.flexWrap="wrap",t.style.justifyContent="center",t.style.alignItems="center",t.style.gap="8px",t}var rr="qws:player:ghostMode",wa=(t,e=!1)=>{try{return localStorage.getItem(t)==="1"}catch{return e}},xa=(t,e)=>{try{localStorage.setItem(t,e?"1":"0")}catch{}};function Pa(){let t="qws:ghost:delayMs",n=()=>{try{return Math.max(5,Math.floor(Number(localStorage.getItem(t))||50))}catch{return 50}},r=n();function a(u){r=Math.max(5,Math.floor(u||50));try{localStorage.setItem(t,String(r))}catch{}}let s=new Set,i=u=>{let g=u.key.toLowerCase();(g==="z"||g==="q"||g==="s"||g==="d"||g==="w"||g==="a"||u.key==="ArrowUp"||u.key==="ArrowDown"||u.key==="ArrowLeft"||u.key==="ArrowRight")&&(u.preventDefault(),u.stopImmediatePropagation(),!u.repeat&&s.add(g))},o=u=>{let g=u.key.toLowerCase();(g==="z"||g==="q"||g==="s"||g==="d"||g==="w"||g==="a"||u.key==="ArrowUp"||u.key==="ArrowDown"||u.key==="ArrowLeft"||u.key==="ArrowRight")&&(u.preventDefault(),u.stopImmediatePropagation(),s.delete(g))},d=()=>{s.clear()},c=()=>{document.hidden&&s.clear()};function b(){let u=0,g=0;return(s.has("z")||s.has("w")||s.has("arrowup"))&&(g-=1),(s.has("s")||s.has("arrowdown"))&&(g+=1),(s.has("q")||s.has("a")||s.has("arrowleft"))&&(u-=1),(s.has("d")||s.has("arrowright"))&&(u+=1),u&&(u=u>0?1:-1),g&&(g=g>0?1:-1),{dx:u,dy:g}}let w=null,S=0,M=0,v=!1;async function p(u,g){let x;try{x=await B.getPosition()}catch{}let W=Math.round(x?.x??0),F=Math.round(x?.y??0);try{await B.move(W+u,F+g)}catch{}}function C(u){S||(S=u);let g=u-S;S=u;let{dx:x,dy:W}=b();if(M+=g,x===0&&W===0){M=Math.min(M,r*4),w=requestAnimationFrame(C);return}M>=r&&!v&&(M-=r,v=!0,(async()=>{try{await p(x,W)}finally{v=!1}})()),M=Math.min(M,r*4),w=requestAnimationFrame(C)}return{start(){w===null&&(S=0,M=0,v=!1,window.addEventListener("keydown",i,{capture:!0}),window.addEventListener("keyup",o,{capture:!0}),window.addEventListener("blur",d),document.addEventListener("visibilitychange",c),w=requestAnimationFrame(C))},stop(){w!==null&&(cancelAnimationFrame(w),w=null),s.clear(),window.removeEventListener("keydown",i,{capture:!0}),window.removeEventListener("keyup",o,{capture:!0}),window.removeEventListener("blur",d),document.removeEventListener("visibilitychange",c)},setSpeed:a,getSpeed:n}}async function ar(t){let e=new Te({id:"misc",compact:!0});e.mount(t);let n=e.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.minHeight="0";let r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="10px";let a=e.label("Player controls");a.style.fontWeight="700",a.style.fontSize="14px",r.append(a),n.appendChild(r);let s=document.createElement("div");s.className="qmm-card",s.style.display="flex",s.style.flexDirection="column",s.style.gap="12px",s.style.alignItems="center",s.style.overflow="auto",s.style.minHeight="0",n.appendChild(s);let i=va(),o=e.switch(wa(rr));o.id="player.ghostMode";let d=e.label("Ghost mode"),c=e.label("Move delay (ms)"),b=e.inputNumber(10,1e3,5,50);b.id="player.moveDelay",i.append(o,d,c,b.wrap??b),s.appendChild(i);let w=Pa();b.value=String(w.getSpeed?.()??50),b.addEventListener("change",()=>{let S=Math.max(10,Math.min(1e3,Math.floor(Number(b.value)||50)));b.value=String(S),w.setSpeed?.(S)}),o.checked&&w.start(),o.onchange=()=>{let S=!!o.checked;xa(rr,S),S?w.start():w.stop()},s.__cleanup__=()=>{try{w.stop()}catch{}}}function sr(t){let e=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume","mouseleave","mouseenter"],n=[];function r(){let h=(E,z)=>{let $=Y=>{Y.stopImmediatePropagation(),Y.preventDefault?.()};E.addEventListener(z,$,{capture:!0}),n.push({t:z,h:$,target:E})};e.forEach(E=>{h(document,E),h(window,E)})}function a(){for(let{t:h,h:E,target:z}of n)try{z.removeEventListener(h,E,{capture:!0})}catch{}n.length=0}let s=Object.getPrototypeOf(document),i={hidden:Object.getOwnPropertyDescriptor(s,"hidden"),visibilityState:Object.getOwnPropertyDescriptor(s,"visibilityState"),hasFocus:document.hasFocus?document.hasFocus.bind(document):null};function o(){try{Object.defineProperty(s,"hidden",{configurable:!0,get(){return!1}})}catch{}try{Object.defineProperty(s,"visibilityState",{configurable:!0,get(){return"visible"}})}catch{}try{document.hasFocus=()=>!0}catch{}}function d(){try{i.hidden&&Object.defineProperty(s,"hidden",i.hidden)}catch{}try{i.visibilityState&&Object.defineProperty(s,"visibilityState",i.visibilityState)}catch{}try{i.hasFocus&&(document.hasFocus=i.hasFocus)}catch{}}let c=null,b=null,w=null,S=()=>{c&&c.state!=="running"&&c.resume?.().catch(()=>{})};function M(){try{c=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),w=c.createGain(),w.gain.value=1e-5,b=c.createOscillator(),b.frequency.value=1,b.connect(w).connect(c.destination),b.start(),document.addEventListener("visibilitychange",S,{capture:!0}),window.addEventListener("focus",S,{capture:!0})}catch{v()}}function v(){try{b?.stop()}catch{}try{b?.disconnect(),w?.disconnect()}catch{}try{c?.close?.()}catch{}document.removeEventListener("visibilitychange",S,{capture:!0}),window.removeEventListener("focus",S,{capture:!0}),b=null,w=null,c=null}let p=null;function C(){let h=document.querySelector("canvas")||document.body||document.documentElement;p=window.setInterval(()=>{try{h.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}))}catch{}},25e3)}function u(){p!==null&&(clearInterval(p),p=null)}let g=null;async function x(){try{let h=await t.getPosition();if(!h)return;await t.move(Math.round(h.x),Math.round(h.y))}catch{}}function W(){g=window.setInterval(x,6e4),x()}function F(){g!==null&&(clearInterval(g),g=null)}return{start(){o(),r(),M(),C(),W()},stop(){F(),u(),v(),a(),d()}}}(async function(){"use strict";window.addEventListener("error",e=>{console.error("[GLOBAL ERROR]",e.message,e.filename,e.lineno,e.colno,e.error?.stack||e.error)}),window.addEventListener("unhandledrejection",e=>{console.error("[UNHANDLED REJECTION]",e.reason)}),cn(),en({onRegister(e){e("players","Players",Qn),e("pets","Pets",nr),e("misc","Misc",ar),e("debug-data","Debug Data",jn)}}),Dn(),sr({getPosition:()=>B.getPosition(),move:(e,n)=>B.move(e,n)}).start()})();})();
