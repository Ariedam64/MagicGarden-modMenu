// ==UserScript==
// @name         Magic Garden ModMenu 
// @namespace    Quinoa
// @version      1.1.5
// @match        https://*.discordsays.com/*
// @match        https://magiccircle.gg/r/*
// @match        https://magicgarden.gg/r/*
// @match        https://starweaver.org/r/*
// @run-at       document-start
// @all-frames   true
// @inject-into  page
// @grant        none
// @downloadURL  https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// @updateURL    https://github.com/Ariedam64/MagicGarden-modMenu/raw/refs/heads/main/quinoa-ws.min.user.js
// ==/UserScript==
(()=>{var Vn=Object.defineProperty;var Xn=(e,t,n)=>t in e?Vn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var pe=(e,t,n)=>Xn(e,typeof t!="symbol"?t+"":t,n);var be=window.WebSocket,Yr=window.Worker,he=[],qe=null;function Be(e,t){if(!qe){qe=e;try{console.log("[QuinoaWS] selected ->",t)}catch{}}}var ot=!1;var st=typeof Set<"u"?new Set:{_a:[],add(e){this._a.push(e)},delete(e){let t=this._a.indexOf(e);t>=0&&this._a.splice(t,1)},forEach(e){for(let t=0;t<this._a.length;t++)e(this._a[t])}};function lt(e){return["CONNECTING","OPEN","CLOSING","CLOSED"][e??-1]||"none"}async function Jt(e){try{if(typeof e=="string")return JSON.parse(e);if(e instanceof Blob)return JSON.parse(await e.text());if(e instanceof ArrayBuffer)return JSON.parse(new TextDecoder().decode(e))}catch{}return null}function Kt(){function e(t,n){let r=n!==void 0?new be(t,n):new be(t);he.push(r),r.addEventListener("open",()=>{setTimeout(()=>{r.readyState===be.OPEN&&Be(r,"open-fallback")},800)}),r.addEventListener("message",async i=>{let o=await Jt(i.data);o&&!window.quinoaWS&&(o.type==="Welcome"||o.type==="Config"||o.fullState||o.config)&&Be(r,"message:"+(o.type||"state"))});let a=r.send.bind(r);return r.send=function(i){try{let o=null;typeof i=="string"?o=JSON.parse(i):i instanceof ArrayBuffer&&(o=JSON.parse(new TextDecoder().decode(i))),!window.quinoaWS&&o&&Array.isArray(o.scopePath)&&o.scopePath.join("/")==="Room/Quinoa"&&Be(r,"send:"+o.type)}catch{}return a(i)},r}e.prototype=be.prototype;try{e.OPEN=be.OPEN}catch{}try{e.CLOSED=be.CLOSED}catch{}try{e.CLOSING=be.CLOSING}catch{}try{e.CONNECTING=be.CONNECTING}catch{}window.WebSocket=e}var Ee=null,Ct=!1,Qt=null,ct=null,Zt=()=>globalThis.jotaiAtomCache?.cache;function Jn(){let e=globalThis.__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!e?.renderers?.size)return null;for(let[t]of e.renderers){let n=e.getFiberRoots(t);for(let r of n){let a=new Set,i=[r.current];for(;i.length;){let o=i.pop();if(!o||a.has(o))continue;a.add(o);let l=o?.pendingProps?.value;if(l&&typeof l.get=="function"&&typeof l.set=="function"&&typeof l.sub=="function")return ct="fiber",l;o.child&&i.push(o.child),o.sibling&&i.push(o.sibling),o.alternate&&i.push(o.alternate)}}}return null}async function Kn(e=5e3){let t=Zt();if(!t)throw new Error("jotaiAtomCache.cache introuvable");let n=null,r=null,a=[];for(let l of t.values()){if(!l||typeof l.write!="function")continue;let u=l.write;l.__origWrite=u,l.write=function(d,y,...P){if(!r){n=d,r=y;for(let M of a)M.write=M.__origWrite,delete M.__origWrite}return u.call(this,d,y,...P)},a.push(l)}let i=l=>new Promise(u=>setTimeout(u,l)),o=Date.now();try{globalThis.dispatchEvent?.(new Event("visibilitychange"))}catch{}for(;!r&&Date.now()-o<e;)await i(50);return r?(ct="write",{get:l=>n(l),set:(l,u)=>r(l,u),sub:(l,u)=>{let d;try{d=n(l)}catch{}let y=setInterval(()=>{let P;try{P=n(l)}catch{return}if(P!==d){d=P;try{u()}catch{}}},100);return()=>clearInterval(y)}}):(ct="polyfill",{get:()=>{throw new Error("Store non captur\xE9: get indisponible")},set:()=>{throw new Error("Store non captur\xE9: set indisponible")},sub:()=>()=>{},__polyfill:!0})}async function Ie(){if(Ee)return Ee;if(Ct){let e=Date.now();for(;!Ee&&Date.now()-e<3e3;)await new Promise(t=>setTimeout(t,25));if(Ee)return Ee}Ct=!0;try{return Ee=Jn()||await Kn(),Ee}catch(e){throw Qt=e,e}finally{Ct=!1}}function Ge(){return!!Ee&&!Ee.__polyfill}function en(){return{via:ct,polyfill:!!Ee?.__polyfill,error:Qt}}async function ve(e){return(await Ie()).get(e)}async function xe(e,t){await(await Ie()).set(e,t)}async function $e(e,t){return(await Ie()).sub(e,t)}function Ve(e){let t=Zt();if(!t)return[];let n=[];for(let r of t.values()){let a=r?.debugLabel||r?.label||"";e.test(String(a))&&n.push(r)}return n}function oe(e){return Ve(new RegExp("^"+e+"$"))[0]||null}function Qn(e){if(st.forEach)st.forEach(t=>{try{t.postMessage(e)}catch{}});else for(let t of st._a)try{t.postMessage(e)}catch{}}function Zn(){if(qe&&qe.readyState===be.OPEN)return qe;let e=null;if(he.find&&(e=he.find(t=>t.readyState===be.OPEN)||null),!e){for(let t=0;t<he.length;t++)if(he[t].readyState===be.OPEN){e=he[t];break}}if(e)return Be(e,"getPageWS"),e;throw new Error("No page WebSocket open")}function Se(e){let t={scopePath:["Room","Quinoa"],...e};try{return Zn().send(JSON.stringify(t)),!0}catch{return Qn({__QWS_CMD:"send",payload:JSON.stringify(t)}),!0}}async function dt(){try{await Ie()}catch{}}async function tn(e,t){await dt();let n=oe(e);if(!n)return t;try{return await ve(n)}catch{return t}}async function nn(e,t){await dt();let n=oe(e);return n?await $e(n,async()=>{try{t(await ve(n))}catch{}}):()=>{}}async function er(e,t){let n=await tn(e);return n!==void 0&&t(n),nn(e,t)}async function tr(e,t){await dt();let n=oe(e);n&&await xe(n,t)}var Xe={ensure:dt,select:tn,subscribe:nn,subscribeImmediate:er,set:tr};function ut(e,t){if(e===t)return!0;if(!Array.isArray(e)||!Array.isArray(t)||e.length!==t.length)return!1;let n=new Set(e);for(let r of t)if(!n.has(r))return!1;return!0}async function nr(e,t){await Xe.set(e,t)}function we(e,t,n){let r=()=>Xe.select(e),a=()=>r().then(d=>t?t(d):d),i=async d=>{let y=await r().catch(()=>{}),P=n?n(d,y):d;return nr(e,P)};return{label:e,get:a,set:i,update:async d=>{let y=await a(),P=d(y);return await i(P),P},sub:d=>Xe.subscribe(e,y=>d(t?t(y):y)),subNow:d=>Xe.subscribeImmediate(e,y=>d(t?t(y):y))}}var mt=(()=>{let e=we("myInventoryAtom",t=>Array.isArray(t?.favoritedItemIds)?t.favoritedItemIds.slice():[]);return{label:e.label+":favoriteIds",get:e.get,sub(t){let n=null;return e.sub(r=>{(!n||!ut(n,r))&&(n=r,t(r))})},subNow(t){let n=null;return e.subNow(r=>{(!n||!ut(n,r))&&(n=r,t(r))})}}})(),Fe=(()=>{let e=we("myInventoryAtom",t=>Array.isArray(t?.favoritedItemIds)?t.favoritedItemIds:[]);return{label:e.label+":favoriteIdSet",async get(){return new Set(await e.get())},sub(t){let n=null;return e.sub(r=>{(!n||!ut(n,r))&&(n=r,t(new Set(r)))})},subNow(t){let n=null;return e.subNow(r=>{(!n||!ut(n,r))&&(n=r,t(new Set(r)))})}}})(),Je=(()=>{let e=we("myDataAtom",t=>t?.garden??null);return{label:e.label+":garden",get:e.get,sub:e.sub,subNow:e.subNow}})(),Ke=we("positionAtom"),Qe=we("stateAtom"),pt=we("myInventoryAtom"),ra=we("shopsAtom"),aa=we("myShopPurchasesAtom"),yt=we("myDataAtom"),He=we("myCropInventoryAtom"),gt=we("numPlayersAtom"),ia=we("totalCropSellPriceAtom"),ke=we("myPetInfosAtom"),oa=we("myPetSlotInfosAtom"),sa=we("myValidatedSelectedItemIndexAtom"),la=we("setSelectedIndexToEndAtom");function rr(e){if(!e)return"null";let t=typeof e?.abilityId=="string"?e.abilityId:"",n=Number.isFinite(e?.performedAt)?String(e.performedAt):"",r="";try{r=JSON.stringify(e?.data??null)}catch{r=""}return`${t}|${n}|${r}`}function Et(e){let t={},n=new Map;if(e&&typeof e=="object")for(let r of Object.keys(e)){let a=e[r]??{},i=a.lastAbilityTrigger??null,o=a.position??null;t[r]={petId:r,abilityId:i?.abilityId??null,performedAt:Number.isFinite(i?.performedAt)?i.performedAt:null,data:i?.data??null,position:o??null},n.set(r,rr(i))}return{value:t,sig:n}}function rn(e,t){if(!e||e.size!==t.size)return!1;for(let[n,r]of t)if(e.get(n)!==r)return!1;return!0}var an=(()=>{let e=we("myPetSlotInfosAtom");return{label:e.label+":abilitiesTrigger",async get(){let n=await e.get();return Et(n).value},sub(n){let r=null;return e.sub(a=>{let{value:i,sig:o}=Et(a);rn(r,o)||(r=o,n(i))})},subNow(n){let r=null;return e.subNow(a=>{let{value:i,sig:o}=Et(a);rn(r,o)||(r=o,n(i))})}}})();function on(e){return e?[e.objectType??e.type??"",e.species??e.seedSpecies??e.plantSpecies??e.eggId??e.decorId??"",e.plantedAt??e.startTime??0,e.maturedAt??e.endTime??0].join("|"):"\u2205"}function Mt(e,t){let n=e?.tileObjects??{},r=t?.tileObjects??{},a=[],i=[],o=[],l=[],u=new Set;for(let d of Object.keys(r))u.add(d),d in n?on(n[d])!==on(r[d])&&(i.push(+d),l.push({kind:"updated",slot:+d,prev:n[d],next:r[d]})):(a.push(+d),l.push({kind:"added",slot:+d,next:r[d]}));for(let d of Object.keys(n))u.has(d)||(o.push(+d),l.push({kind:"removed",slot:+d,prev:n[d]}));return{added:a,updated:i,removed:o,changes:l}}function ar(e){let t=e?.slot??{},n=Array.isArray(t.mutations)?t.mutations.slice().sort().join(","):"",r=Array.isArray(t.abilities)?t.abilities.slice().sort().join(","):"",a=t.name??"",i=t.petSpecies??"",o=Number.isFinite(t.xp)?Math.round(t.xp):0,l=Number.isFinite(t.hunger)?Math.round(t.hunger*1e3):0,u=Number.isFinite(t.targetScale)?Math.round(t.targetScale*1e3):0,d=Number.isFinite(e?.position?.x)?Math.round(e.position.x):0,y=Number.isFinite(e?.position?.y)?Math.round(e.position.y):0;return`${i}|${a}|xp:${o}|hg:${l}|sc:${u}|m:${n}|a:${r}|pos:${d},${y}`}function Ze(e){let t=new Map,n=Array.isArray(e)?e:[];for(let r of n){let a=String(r?.slot?.id??"");a&&t.set(a,ar(r))}return t}function At(e,t){let n=[],r=[],a=[],i=[];for(let[o,l]of t)e.has(o)?e.get(o)!==l&&(r.push(o),i.push({kind:"updated",id:o})):(n.push(o),i.push({kind:"added",id:o}));for(let o of e.keys())t.has(o)||(a.push(o),i.push({kind:"removed",id:o}));return{added:n,updated:r,removed:a,changes:i}}function ir(e){let t=Array.isArray(e.mutations)?e.mutations.slice().sort().join(","):"",n=Number.isFinite(e.scale)?Math.round(e.scale*1e3):0;return`${e.species??""}|${e.itemType??""}|${n}|${t}`}function et(e){let t=new Map,n=Array.isArray(e)?e:[];for(let r of n){let a=String(r?.id??"");a&&t.set(a,ir(r))}return t}function Lt(e,t){let n=[],r=[],a=[],i=[];for(let[o,l]of t)e.has(o)?e.get(o)!==l&&(r.push(o),i.push({kind:"updated",key:o})):(n.push(o),i.push({kind:"added",key:o}));for(let o of e.keys())t.has(o)||(a.push(o),i.push({kind:"removed",key:o}));return{added:n,updated:r,removed:a,changes:i}}var me={getPosition(){return Ke.get()},onPosition(e){return Ke.sub(e)},onPositionNow(e){return Ke.subNow(e)},async setPosition(e,t){let n=oe(Ke.label||"positionAtom");if(!n)throw new Error("positionAtom introuvable");await xe(n,{x:e,y:t})},async teleport(e,t){try{await this.setPosition(e,t)}catch{}try{Se({type:"Teleport",position:{x:e,y:t}})}catch{}},async move(e,t){try{await this.setPosition(e,t)}catch{}try{Se({type:"PlayerPosition",position:{x:e,y:t}})}catch{}},async plantSeed(e,t){try{Se({type:"PlantSeed",slot:e,species:t})}catch{}},async sellAllCrops(){try{Se({type:"SellAllCrops"})}catch{}},async sellPet(e){try{Se({type:"SellPet",itemId:e})}catch{}},async waterPlant(e){try{Se({type:"WaterPlant",slot:e})}catch{}},async setSelectedItem(e){try{Se({type:"SetSelectedItem",itemIndex:e})}catch{}},async pickupObject(){try{Se({type:"PickupObject"})}catch{}},async dropObject(){try{Se({type:"DropObject"})}catch{}},async harvestCrop(e,t){try{Se({type:"HarvestCrop",slot:e,slotsIndex:t})}catch{}},async feedPet(e,t){try{Se({type:"FeedPet",petItemId:e,cropItemId:t})}catch{}},async hatchEgg(e){try{Se({type:"HatchEgg",slot:e})}catch{}},async placeDecor(e,t,n){try{Se({type:"PlaceDecor",tileType:e,localTileIndex:t,decorId:n})}catch{}},async swapPet(e,t){try{Se({type:"SwapPet",petSlotId:e,petInventoryId:t})}catch{}},async placePet(e,t,n,r){try{Se({type:"PlacePet",itemId:e,position:t,tileType:n,localTileIndex:r})}catch{}},async storePet(e){try{Se({type:"StorePet",itemId:e})}catch{}},async toggleFavoriteItem(e){try{Se({type:"ToggleFavoriteItem",itemId:e})}catch{}},async getFavoriteIds(){let e=await mt.get();return Array.isArray(e)?e.slice():[]},async getFavoriteIdSet(){return await Fe.get()},async isFavoriteItem(e){return(await Fe.get()).has(e)},async ensureFavoriteItem(e,t){let n=await this.isFavoriteItem(e);return n!==t?(await this.toggleFavoriteItem(e),t):n},async ensureFavorites(e,t){let n=await Fe.get(),r=0;for(let a of e)if(n.has(a)!==t)try{await this.toggleFavoriteItem(a),r++}catch{}},onFavoriteIdsChange(e){return mt.sub(t=>{let n=Array.isArray(t)?t:[];e(n)})},async onFavoriteIdsChangeNow(e){let t=await this.getFavoriteIds();return e(t),mt.sub(n=>{let r=Array.isArray(n)?n:[];e(r)})},onFavoriteSetChange(e){return Fe.sub(t=>{e(t)})},async onFavoriteSetChangeNow(e){let t=await Fe.get();return e(t),Fe.sub(n=>{e(n)})},async getGardenState(){return(await yt.get())?.garden??null},onGardenChange(e){let t=null;return Je.sub(n=>{n!==t&&(t=n,e(n))})},async onGardenChangeNow(e){let t=await Je.get();return e(t),Je.sub(n=>{n!==t&&(t=n,e(n))})},onGardenDiff(e){let t=null;return Je.sub(n=>{let r=Mt(t,n);(r.added.length||r.updated.length||r.removed.length||n!==t)&&(t=n,e(n,r))})},async onGardenDiffNow(e){let t=(await yt.get())?.garden??null;return e(t,Mt(null,t)),yt.sub(n=>{let r=n?.garden??null,a=Mt(t,r);(a.added.length||a.updated.length||a.removed.length)&&(t=r,e(r,a))})},async getPets(){let e=await ke.get();return Array.isArray(e)?e:null},onPetsChange(e){let t=null;return ke.sub(n=>{n!==t&&(t=n,e(t))})},async onPetsChangeNow(e){let t=await this.getPets();return e(t),ke.sub(n=>{n!==t&&(t=n,e(t))})},onPetsDiff(e){let t=Ze(null);return ke.sub(n=>{let r=Ze(n),a=At(t,r);(a.added.length||a.updated.length||a.removed.length)&&(e(n,a),t=r)})},async onPetsDiffNow(e){let t=await this.getPets(),n=Ze(null),r=Ze(t),a=At(n,r);return e(t,a),n=r,ke.sub(i=>{r=Ze(i);let o=At(n,r);(o.added.length||o.updated.length||o.removed.length)&&(e(i,o),n=r)})},async getCropInventoryState(){return await He.get()},onCropInventoryChange(e){let t=null;return He.sub(n=>{n!==t&&(t=n,e(n))})},async onCropInventoryChangeNow(e){let t=await He.get();return e(t),He.sub(n=>{n!==t&&(t=n,e(n))})},onCropInventoryDiff(e){let t=et(null);return He.sub(n=>{let r=et(n),a=Lt(t,r);(a.added.length||a.updated.length||a.removed.length)&&(e(n,a),t=r)})},async onCropInventoryDiffNow(e){let t=await He.get(),n=et(null),r=et(t),a=Lt(n,r);return e(t,a),n=r,He.sub(i=>{r=et(i);let o=Lt(n,r);(o.added.length||o.updated.length||o.removed.length)&&(e(i,o),n=r)})},async getNumPlayers(){let e=await gt.get();return typeof e=="number"?e:0},onNumPlayersChange(e){let t;return gt.sub(n=>{n!==t&&(t=n,e(n))})},async onNumPlayersChangeNow(e){let t=await this.getNumPlayers();return e(t),gt.sub(n=>{n!==t&&(t=n,e(n))})}};var A={Common:"Common",Uncommon:"Uncommon",Rare:"Rare",Legendary:"Legendary",Mythic:"Mythical",Divine:"Divine",Celestial:"Celestial"},ne={Single:"Single",Multiple:"Multiple"};var _={Empty:0,DirtPatch:1,SproutFlower:2,SproutVegetable:3,SproutFruit:4,SproutVine:5,StemFlower:6,Trellis:7,Daffodil:11,Tulip:12,Sunflower:13,Lily:14,Starweaver:15,StarweaverPlant:16,AloePlant:17,Aloe:18,Blueberry:21,Banana:22,Strawberry:23,Mango:24,Grape:25,Watermelon:26,Lemon:27,Apple:28,Pepper:31,Tomato:32,BabyCarrot:33,Carrot:34,Pumpkin:35,Corn:36,PalmTreeTop:39,BushyTree:40,Coconut:41,MushroomPlant:42,PassionFruit:43,DragonFruit:44,Lychee:45,Mushroom:46,BurrosTail:47,Cacao:48,Echeveria:49},We={Empty:0,Bamboo:1,PalmTree:2,Cactus:3,Tree:4},re={Empty:0,Daffodil:1,Tulip:2,Sunflower:3,Starweaver:6,Blueberry:11,Banana:12,Strawberry:13,Mango:14,Grape:15,Watermelon:16,Lemon:17,Apple:18,Lily:20,Pepper:21,Tomato:22,Carrot:23,Pumpkin:25,Corn:26,Bamboo:41,Coconut:31,Mushroom:32,PassionFruit:33,DragonFruit:34,Lychee:35,BurrosTail:37,Aloe:39,Echeveria:40,Cactus:42},ft={Empty:0,Coin:1,Shovel:2,Seeds:3,PlanterPot:5,InventoryBag:6,WateringCan:14,Fertilizer:15,RainbowPotion:16,ArrowKeys:41,Touchpad:42};var ye={Bee:1,Chicken:2,Bunny:3,Turtle:4,Capybara:5,Cow:6,Pig:7,Butterfly:8,Snail:9,Worm:10,CommonEgg:11,UncommonEgg:12,RareEgg:13,LegendaryEgg:14,MythicalEgg:15,DivineEgg:16,CelestialEgg:17,Squirrel:18,Goat:19,Dragonfly:20,Peacock:30},tt={Wet:1,Chilled:2,Frozen:3,Dawnlit:11,Amberglow:12},se={SmallRock:11,MediumRock:21,LargeRock:31,WoodPedestal:4,WoodBench:13,WoodBucketPedestal:14,WoodLampPost:23,WoodStool:24,WoodArch:33,WoodBridge:34,WoodOwl:43,WoodGardenBox:44,StonePedestal:6,StoneBench:15,StoneBucketPedestal:16,StoneLampPost:25,StoneColumn:26,StoneArch:35,StoneBridge:36,StoneGnome:45,StoneGardenBox:46,MarblePedestal:8,MarbleBench:17,MarbleBucketPedestal:18,MarbleLampPost:27,MarbleColumn:28,MarbleArch:37,MarbleBridge:38,MarbleBlobling:47,MarbleGardenBox:48,StrawScarecrow:49,MiniFairyCottage:50,MiniFairyForge:40,MiniFairyKeep:60,Birdhouse:63,WoodenWindmill:64,StoneBirdbath:65},ga={Carrot:{seed:{tileRef:re.Carrot,name:"Carrot Seed",coinPrice:10,creditPrice:7,rarity:A.Common},plant:{tileRef:_.BabyCarrot,name:"Carrot Plant",harvestType:ne.Single,baseTileScale:.7},crop:{tileRef:_.Carrot,name:"Carrot",baseSellPrice:20,baseWeight:.1,baseTileScale:.6,maxScale:3}},Strawberry:{seed:{tileRef:re.Strawberry,name:"Strawberry Seed",coinPrice:50,creditPrice:21,rarity:A.Common},plant:{tileRef:_.SproutFruit,name:"Strawberry Plant",harvestType:ne.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:70,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:_.Strawberry,name:"Strawberry",baseSellPrice:14,baseWeight:.05,baseTileScale:.25,maxScale:2}},Aloe:{seed:{tileRef:re.Aloe,name:"Aloe Seed",coinPrice:135,creditPrice:18,rarity:A.Common},plant:{tileRef:_.AloePlant,name:"Aloe Plant",harvestType:ne.Single,baseTileScale:.9},crop:{tileRef:_.Aloe,name:"Aloe",baseSellPrice:310,baseWeight:1.5,baseTileScale:.7,maxScale:2.5}},Blueberry:{seed:{tileRef:re.Blueberry,name:"Blueberry Seed",coinPrice:400,creditPrice:49,rarity:A.Uncommon},plant:{tileRef:_.SproutFruit,name:"Blueberry Plant",harvestType:ne.Multiple,slotOffsets:[{x:.3,y:.4,rotation:85},{x:.675,y:.3,rotation:195},{x:.32,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.51,rotation:0}],secondsToMature:105,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:_.Blueberry,name:"Blueberry",baseSellPrice:23,baseWeight:.01,baseTileScale:.25,maxScale:2}},Apple:{seed:{tileRef:re.Apple,name:"Apple Seed",coinPrice:500,creditPrice:67,rarity:A.Uncommon,unavailableSurfaces:["discord"]},plant:{tileRef:We.Tree,name:"Apple Tree",harvestType:ne.Multiple,slotOffsets:[{x:.15,y:-1.9,rotation:-90},{x:0,y:-1.5,rotation:-75},{x:.6,y:-1.7,rotation:-60},{x:.3,y:-1.15,rotation:-55},{x:1.05,y:-1.4,rotation:-45},{x:.8,y:-1.2,rotation:-35},{x:.9,y:.6,rotation:-30}],secondsToMature:360*60,baseTileScale:3,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:_.Apple,name:"Apple",baseSellPrice:73,baseWeight:.18,baseTileScale:.5,maxScale:2}},OrangeTulip:{seed:{tileRef:re.Tulip,name:"Tulip Seed",coinPrice:600,creditPrice:14,rarity:A.Uncommon},plant:{tileRef:_.Tulip,name:"Tulip Plant",harvestType:ne.Single,baseTileScale:.5},crop:{tileRef:_.Tulip,name:"Tulip",baseSellPrice:767,baseWeight:.01,baseTileScale:.5,maxScale:3}},Tomato:{seed:{tileRef:re.Tomato,name:"Tomato Seed",coinPrice:800,creditPrice:79,rarity:A.Uncommon},plant:{tileRef:_.SproutVine,name:"Tomato Plant",harvestType:ne.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1100,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:_.Tomato,name:"Tomato",baseSellPrice:27,baseWeight:.3,baseTileScale:.33,maxScale:2}},Daffodil:{seed:{tileRef:re.Daffodil,name:"Daffodil Seed",coinPrice:1e3,creditPrice:19,rarity:A.Rare},plant:{tileRef:_.Daffodil,name:"Daffodil Plant",harvestType:ne.Single,baseTileScale:.5},crop:{tileRef:_.Daffodil,name:"Daffodil",baseSellPrice:1090,baseWeight:.01,baseTileScale:.5,maxScale:3}},Corn:{seed:{tileRef:re.Corn,name:"Corn Kernel",coinPrice:1300,creditPrice:135,rarity:A.Rare},plant:{tileRef:_.SproutVegetable,name:"Corn Plant",harvestType:ne.Multiple,slotOffsets:[{x:.5,y:.4,rotation:0}],secondsToMature:130,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:_.Corn,name:"Corn",baseSellPrice:36,baseWeight:1.2,baseTileScale:.7,maxScale:2}},Watermelon:{seed:{tileRef:re.Watermelon,name:"Watermelon Seed",coinPrice:2500,creditPrice:195,rarity:A.Rare},plant:{tileRef:_.Watermelon,name:"Watermelon Plant",harvestType:ne.Single,baseTileScale:.8},crop:{tileRef:_.Watermelon,name:"Watermelon",baseSellPrice:2708,baseWeight:4.5,baseTileScale:.8,maxScale:3}},Pumpkin:{seed:{tileRef:re.Pumpkin,name:"Pumpkin Seed",coinPrice:3e3,creditPrice:210,rarity:A.Rare},plant:{tileRef:_.Pumpkin,name:"Pumpkin Plant",harvestType:ne.Single,baseTileScale:.8},crop:{tileRef:_.Pumpkin,name:"Pumpkin",baseSellPrice:3700,baseWeight:6,baseTileScale:.8,maxScale:3}},Echeveria:{seed:{tileRef:re.Echeveria,name:"Echeveria Cutting",coinPrice:4200,creditPrice:113,rarity:A.Legendary},plant:{tileRef:_.Echeveria,name:"Echeveria Plant",harvestType:ne.Single,baseTileScale:.8},crop:{tileRef:_.Echeveria,name:"Echeveria",baseSellPrice:4600,baseWeight:.8,baseTileScale:.8,maxScale:2.75}},Coconut:{seed:{tileRef:re.Coconut,name:"Coconut Seed",coinPrice:6e3,creditPrice:235,rarity:A.Legendary},plant:{tileRef:We.PalmTree,name:"Coconut Tree",harvestType:ne.Multiple,slotOffsets:[{x:.3,y:-2.1,rotation:0},{x:.2,y:-1.9,rotation:51.4},{x:.7,y:-2,rotation:102.9},{x:.25,y:-1.6,rotation:154.3},{x:.5,y:-1.8,rotation:205.7},{x:.8,y:-1.7,rotation:257.1},{x:.55,y:-1.5,rotation:308.6}],secondsToMature:720*60,baseTileScale:3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:_.Coconut,name:"Coconut",baseSellPrice:302,baseWeight:5,baseTileScale:.25,maxScale:3}},Banana:{seed:{tileRef:re.Banana,name:"Banana Seed",coinPrice:7500,creditPrice:199,rarity:A.Legendary,getCanSpawnInGuild:e=>{let t=e.slice(-1),n=parseInt(t,10);return!isNaN(n)&&n%2===0}},plant:{tileRef:We.PalmTree,name:"Banana Plant",harvestType:ne.Multiple,slotOffsets:[{x:.2,y:-1.2,rotation:10},{x:.3,y:-1.2,rotation:-10},{x:.4,y:-1.2,rotation:-30},{x:.5,y:-1.2,rotation:-50},{x:.6,y:-1.2,rotation:-70}],secondsToMature:14400,baseTileScale:2.5,rotateSlotOffsetsRandomly:!1,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:_.Banana,name:"Banana",baseSellPrice:1750,baseWeight:.12,baseTileScale:.5,maxScale:1.7}},Lily:{seed:{tileRef:re.Lily,name:"Lily Seed",coinPrice:2e4,creditPrice:34,rarity:A.Legendary},plant:{tileRef:_.Lily,name:"Lily Plant",harvestType:ne.Single,baseTileScale:.75,nudgeY:.4},crop:{tileRef:_.Lily,name:"Lily",baseSellPrice:20123,baseWeight:.02,baseTileScale:.5,maxScale:2.75}},BurrosTail:{seed:{tileRef:re.BurrosTail,name:"Burro's Tail Cutting",coinPrice:93e3,creditPrice:338,rarity:A.Legendary},plant:{tileRef:_.Trellis,name:"Burro's Tail Plant",harvestType:ne.Multiple,slotOffsets:[{x:.37,y:.4,rotation:0},{x:.67,y:.63,rotation:0}],secondsToMature:1800,baseTileScale:.8,rotateSlotOffsetsRandomly:!1},crop:{tileRef:_.BurrosTail,name:"Burro's Tail",baseSellPrice:6e3,baseWeight:.4,baseTileScale:.4,maxScale:2.5}},Mushroom:{seed:{tileRef:re.Mushroom,name:"Mushroom Spore",coinPrice:15e4,creditPrice:249,rarity:A.Mythic},plant:{tileRef:_.MushroomPlant,name:"Mushroom Plant",harvestType:ne.Single,baseTileScale:.8},crop:{tileRef:_.Mushroom,name:"Mushroom",baseSellPrice:16e4,baseWeight:25,baseTileScale:.8,maxScale:3.5}},Cactus:{seed:{tileRef:re.Cactus,name:"Cactus Seed",coinPrice:25e4,creditPrice:250,rarity:A.Mythic},plant:{tileRef:We.Cactus,name:"Cactus Plant",harvestType:ne.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.15},crop:{tileRef:We.Cactus,name:"Cactus",baseSellPrice:261e3,baseWeight:1500,baseTileScale:2.5,maxScale:1.8}},Bamboo:{seed:{tileRef:re.Bamboo,name:"Bamboo Seed",coinPrice:4e5,creditPrice:300,rarity:A.Mythic},plant:{tileRef:We.Bamboo,name:"Bamboo Plant",harvestType:ne.Single,baseTileScale:2.5,tileTransformOrigin:"bottom",nudgeY:.1},crop:{tileRef:We.Bamboo,name:"Bamboo Shoot",baseSellPrice:5e5,baseWeight:1,baseTileScale:2.5,maxScale:2}},Grape:{seed:{tileRef:re.Grape,name:"Grape Seed",coinPrice:85e4,creditPrice:599,rarity:A.Mythic,getCanSpawnInGuild:e=>e.endsWith("1")},plant:{tileRef:_.SproutVine,name:"Grape Plant",harvestType:ne.Multiple,slotOffsets:[{x:.5,y:.5,rotation:0}],secondsToMature:1440*60,baseTileScale:1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:_.Grape,name:"Grape",baseSellPrice:7085,baseWeight:3,baseTileScale:.5,maxScale:2}},Pepper:{seed:{tileRef:re.Pepper,name:"Pepper Seed",coinPrice:1e6,creditPrice:629,rarity:A.Divine},plant:{tileRef:_.SproutVine,name:"Pepper Plant",harvestType:ne.Multiple,slotOffsets:[{x:.1,y:.1,rotation:0},{x:.9,y:.1,rotation:0},{x:.3,y:.3,rotation:0},{x:.7,y:.3,rotation:0},{x:.5,y:.5,rotation:0},{x:.3,y:.7,rotation:0},{x:.7,y:.7,rotation:0},{x:.1,y:.9,rotation:0},{x:.9,y:.9,rotation:0}],secondsToMature:560,baseTileScale:1,rotateSlotOffsetsRandomly:!0},crop:{tileRef:_.Pepper,name:"Pepper",baseSellPrice:7220,baseWeight:.5,baseTileScale:.3,maxScale:2}},Lemon:{seed:{tileRef:re.Lemon,name:"Lemon Seed",coinPrice:2e6,creditPrice:500,rarity:A.Divine,getCanSpawnInGuild:e=>e.endsWith("2")},plant:{tileRef:We.Tree,name:"Lemon Tree",harvestType:ne.Multiple,slotOffsets:[{x:0,y:-1,rotation:85},{x:.9,y:-1.1,rotation:195},{x:.2,y:-.68,rotation:340},{x:.7,y:-.7,rotation:280},{x:.51,y:-1,rotation:0},{x:.45,y:-1.3,rotation:280}],secondsToMature:720*60,baseTileScale:2.3,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",nudgeY:.25},crop:{tileRef:_.Lemon,name:"Lemon",baseSellPrice:1e4,baseWeight:.5,baseTileScale:.25,maxScale:3}},PassionFruit:{seed:{tileRef:re.PassionFruit,name:"Passion Fruit Seed",coinPrice:275e4,creditPrice:679,rarity:A.Divine},plant:{tileRef:_.SproutVine,name:"Passion Fruit Plant",harvestType:ne.Multiple,slotOffsets:[{x:.2,y:.2,rotation:0},{x:.8,y:.8,rotation:0}],secondsToMature:1440*60,baseTileScale:1.1,rotateSlotOffsetsRandomly:!1},crop:{tileRef:_.PassionFruit,name:"Passion Fruit",baseSellPrice:24500,baseWeight:9.5,baseTileScale:.35,maxScale:2}},DragonFruit:{seed:{tileRef:re.DragonFruit,name:"Dragon Fruit Seed",coinPrice:5e6,creditPrice:715,rarity:A.Divine},plant:{tileRef:_.PalmTreeTop,name:"Dragon Fruit Plant",harvestType:ne.Multiple,slotOffsets:[{x:.2,y:.1,rotation:0},{x:.1,y:.45,rotation:51.4},{x:.86,y:.2,rotation:102.9},{x:.25,y:.8,rotation:154.3},{x:.5,y:.4,rotation:205.7},{x:.9,y:.6,rotation:257.1},{x:.6,y:.7,rotation:308.6}],secondsToMature:600,baseTileScale:1.6,rotateSlotOffsetsRandomly:!0},crop:{tileRef:_.DragonFruit,name:"Dragon Fruit",baseSellPrice:24500,baseWeight:8.4,baseTileScale:.4,maxScale:2}},Lychee:{seed:{tileRef:re.Lychee,name:"Lychee Pit",coinPrice:25e6,creditPrice:819,rarity:A.Divine,getCanSpawnInGuild:e=>e.endsWith("2")},plant:{tileRef:_.BushyTree,name:"Lychee Plant",harvestType:ne.Multiple,slotOffsets:[{x:.1,y:.4,rotation:85},{x:.8,y:.3,rotation:195},{x:.2,y:.72,rotation:340},{x:.7,y:.7,rotation:280},{x:.51,y:.4,rotation:0},{x:.3,y:.2,rotation:280}],secondsToMature:1440*60,baseTileScale:1.2,rotateSlotOffsetsRandomly:!0},crop:{tileRef:_.Lychee,name:"Lychee Fruit",baseSellPrice:5e4,baseWeight:9,baseTileScale:.2,maxScale:2}},Sunflower:{seed:{tileRef:re.Sunflower,name:"Sunflower Seed",coinPrice:1e8,creditPrice:900,rarity:A.Divine},plant:{tileRef:_.StemFlower,name:"Sunflower Plant",harvestType:ne.Multiple,slotOffsets:[{x:.51,y:-.1,rotation:0}],secondsToMature:1440*60,rotateSlotOffsetsRandomly:!0,tileTransformOrigin:"bottom",baseTileScale:.8,nudgeY:.15},crop:{tileRef:_.Sunflower,name:"Sunflower",baseSellPrice:75e4,baseWeight:10,baseTileScale:.5,maxScale:2.5}},Starweaver:{seed:{tileRef:re.Starweaver,name:"Starweaver Pod",coinPrice:1e9,creditPrice:1e3,rarity:A.Celestial},plant:{tileRef:_.StarweaverPlant,name:"Starweaver Plant",harvestType:ne.Multiple,slotOffsets:[{x:.5,y:-.158,rotation:0}],secondsToMature:1440*60,baseTileScale:1.5,rotateSlotOffsetsRandomly:!1,nudgeY:.25},crop:{tileRef:_.Starweaver,name:"Starweaver Fruit",baseSellPrice:1e7,baseWeight:10,baseTileScale:.6,maxScale:2}}},fa={Gold:{name:"Gold",baseChance:.01,coinMultiplier:25},Rainbow:{name:"Rainbow",baseChance:.001,coinMultiplier:50},Wet:{name:"Wet",baseChance:0,coinMultiplier:2,tileRef:tt.Wet},Chilled:{name:"Chilled",baseChance:0,coinMultiplier:2,tileRef:tt.Chilled},Frozen:{name:"Frozen",baseChance:0,coinMultiplier:10,tileRef:tt.Frozen},Dawnlit:{name:"Dawnlit",baseChance:0,coinMultiplier:2,tileRef:tt.Dawnlit},Ambershine:{name:"Ambershine",baseChance:0,coinMultiplier:5,tileRef:tt.Ambershine}},ba={CommonEgg:{tileRef:ye.CommonEgg,name:"Common Egg",coinPrice:1e5,creditPrice:19,rarity:A.Common,initialTileScale:.3,baseTileScale:.8,secondsToHatch:600,faunaSpawnWeights:{Worm:60,Snail:35,Bee:5}},UncommonEgg:{tileRef:ye.UncommonEgg,name:"Uncommon Egg",coinPrice:1e6,creditPrice:48,rarity:A.Uncommon,initialTileScale:.3,baseTileScale:.8,secondsToHatch:3600,faunaSpawnWeights:{Chicken:65,Bunny:25,Dragonfly:10}},RareEgg:{tileRef:ye.RareEgg,name:"Rare Egg",coinPrice:1e7,creditPrice:99,rarity:A.Rare,initialTileScale:.3,baseTileScale:.8,secondsToHatch:21600,faunaSpawnWeights:{Pig:90,Cow:10}},LegendaryEgg:{tileRef:ye.LegendaryEgg,name:"Legendary Egg",coinPrice:1e8,creditPrice:249,rarity:A.Legendary,initialTileScale:.3,baseTileScale:.8,secondsToHatch:43200,faunaSpawnWeights:{Squirrel:60,Turtle:30,Goat:10}},MythicalEgg:{tileRef:ye.MythicalEgg,name:"Mythical Egg",coinPrice:1e9,creditPrice:599,rarity:A.Mythic,initialTileScale:.3,baseTileScale:.8,secondsToHatch:86400,faunaSpawnWeights:{Butterfly:75,Capybara:5,Peacock:20}}},kt={Worm:{tileRef:ye.Worm,name:"Worm",description:"",coinsToFullyReplenishHunger:500,innateAbilityWeights:{SeedFinderI:50,ProduceEater:50},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.1,moveProbability:.1,hoursToMature:12,rarity:A.Common,tileTransformOrigin:"bottom",nudgeY:.25,diet:["Carrot","Strawberry","Aloe","Tomato","Apple"]},Snail:{tileRef:ye.Snail,name:"Snail",description:"",coinsToFullyReplenishHunger:1e3,innateAbilityWeights:{CoinFinderI:100},baseTileScale:.6,maxScale:2,maturitySellPrice:5e3,matureWeight:.15,moveProbability:.01,hoursToMature:12,rarity:A.Common,tileTransformOrigin:"bottom",nudgeY:-.25,diet:["Blueberry","Tomato","Corn","Daffodil"]},Bee:{tileRef:ye.Bee,name:"Bee",coinsToFullyReplenishHunger:1500,innateAbilityWeights:{ProduceScaleBoost:50,ProduceMutationBoost:50},baseTileScale:.6,maxScale:2.5,maturitySellPrice:3e4,matureWeight:.2,moveProbability:.5,hoursToMature:12,rarity:A.Common,diet:["Strawberry","Blueberry","OrangeTulip","Daffodil","Lily"]},Chicken:{tileRef:ye.Chicken,name:"Chicken",coinsToFullyReplenishHunger:3e3,innateAbilityWeights:{EggGrowthBoost:80,PetRefund:20},baseTileScale:.8,maxScale:2,maturitySellPrice:5e4,matureWeight:3,moveProbability:.2,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Aloe","Corn","Watermelon","Pumpkin"]},Bunny:{tileRef:ye.Bunny,name:"Bunny",coinsToFullyReplenishHunger:750,innateAbilityWeights:{CoinFinderII:60,SellBoostI:40},baseTileScale:.7,maxScale:2,maturitySellPrice:75e3,matureWeight:2,moveProbability:.3,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"bottom",nudgeY:-.2,diet:["Carrot","Strawberry","Blueberry","Echeveria"]},Dragonfly:{tileRef:ye.Dragonfly,name:"Dragonfly",coinsToFullyReplenishHunger:250,innateAbilityWeights:{HungerRestore:70,PetMutationBoost:30},baseTileScale:.6,maxScale:2.5,maturitySellPrice:15e4,matureWeight:.2,moveProbability:.7,hoursToMature:24,rarity:A.Uncommon,tileTransformOrigin:"center",diet:["Apple","OrangeTulip","Echeveria"]},Pig:{tileRef:ye.Pig,name:"Pig",coinsToFullyReplenishHunger:5e4,innateAbilityWeights:{SellBoostII:30,PetAgeBoost:30,PetHatchSizeBoost:30},baseTileScale:1,maxScale:2.5,maturitySellPrice:5e5,matureWeight:200,moveProbability:.2,hoursToMature:72,rarity:A.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","Pumpkin","Mushroom","Bamboo"]},Cow:{tileRef:ye.Cow,name:"Cow",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{SeedFinderII:30,HungerBoost:30,PlantGrowthBoost:30},baseTileScale:1.1,maxScale:2.5,maturitySellPrice:1e6,matureWeight:600,moveProbability:.1,hoursToMature:72,rarity:A.Rare,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Coconut","Banana","BurrosTail","Mushroom"]},Squirrel:{tileRef:ye.Squirrel,name:"Squirrel",coinsToFullyReplenishHunger:15e3,innateAbilityWeights:{CoinFinderIII:70,SellBoostIII:20,PetMutationBoostII:10},baseTileScale:.6,maxScale:2,maturitySellPrice:5e6,matureWeight:.5,moveProbability:.4,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Banana","Grape"]},Turtle:{tileRef:ye.Turtle,name:"Turtle",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{HungerRestoreII:25,HungerBoostII:25,PlantGrowthBoostII:25,EggGrowthBoostII:25},baseTileScale:1,maxScale:2.5,maturitySellPrice:1e7,matureWeight:150,moveProbability:.05,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.15,diet:["Watermelon","BurrosTail","Bamboo","Pepper"]},Goat:{tileRef:ye.Goat,name:"Goat",coinsToFullyReplenishHunger:2e4,innateAbilityWeights:{PetHatchSizeBoostII:10,PetAgeBoostII:40,PetXpBoost:40},baseTileScale:1,maxScale:2,maturitySellPrice:2e7,matureWeight:100,moveProbability:.2,hoursToMature:100,rarity:A.Legendary,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Pumpkin","Coconut","Cactus","Pepper"]},Butterfly:{tileRef:ye.Butterfly,name:"Butterfly",coinsToFullyReplenishHunger:25e3,innateAbilityWeights:{ProduceScaleBoostII:40,ProduceMutationBoostII:40,SeedFinderIII:20},baseTileScale:.6,maxScale:2.5,maturitySellPrice:5e7,matureWeight:.2,moveProbability:.6,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"center",diet:["Daffodil","Lily","Grape","Lemon","Sunflower"]},Capybara:{tileRef:ye.Capybara,name:"Capybara",coinsToFullyReplenishHunger:15e4,innateAbilityWeights:{DoubleHarvest:50,ProduceRefund:50},baseTileScale:1,maxScale:2.5,maturitySellPrice:2e8,matureWeight:50,moveProbability:.2,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Lemon","PassionFruit","DragonFruit","Lychee"]},Peacock:{tileRef:ye.Peacock,name:"Peacock",coinsToFullyReplenishHunger:1e5,innateAbilityWeights:{SellBoostIV:40,PetXpBoostII:50,PetRefundII:10},baseTileScale:1.2,maxScale:2.5,maturitySellPrice:1e8,matureWeight:5,moveProbability:.2,hoursToMature:144,rarity:A.Mythic,tileTransformOrigin:"bottom",nudgeY:-.1,diet:["Cactus","Sunflower","Lychee"]}},sn={ProduceScaleBoost:{name:"Crop Size Boost I",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.3,baseParameters:{cropScaleIncreasePercentage:6}},ProduceScaleBoostII:{name:"Crop Size Boost II",description:"Increases the scale of garden crops",trigger:"continuous",baseProbability:.4,baseParameters:{cropScaleIncreasePercentage:10}},DoubleHarvest:{name:"Double Harvest",description:"Chance to duplicate harvested crops",trigger:"harvest",baseProbability:5,baseParameters:{}},ProduceEater:{name:"Crop Eater",description:"Harvests non-mutated crops and sells them",trigger:"continuous",baseProbability:60,baseParameters:{cropSellPriceIncreasePercentage:150}},SellBoostI:{name:"Sell Boost I",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:10,baseParameters:{cropSellPriceIncreasePercentage:20}},SellBoostII:{name:"Sell Boost II",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:12,baseParameters:{cropSellPriceIncreasePercentage:30}},SellBoostIII:{name:"Sell Boost III",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:14,baseParameters:{cropSellPriceIncreasePercentage:40}},SellBoostIV:{name:"Sell Boost IV",description:"Receive bonus coins when selling crops",trigger:"sellAllCrops",baseProbability:16,baseParameters:{cropSellPriceIncreasePercentage:50}},ProduceRefund:{name:"Crop Refund",description:"Chance to get crops back when selling",trigger:"sellAllCrops",baseProbability:20,baseParameters:{}},PlantGrowthBoost:{name:"Plant Growth Boost I",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:24,baseParameters:{plantGrowthReductionMinutes:3}},PlantGrowthBoostII:{name:"Plant Growth Boost II",description:"Reduces the time for plants to grow",trigger:"continuous",baseProbability:27,baseParameters:{plantGrowthReductionMinutes:5}},ProduceMutationBoost:{name:"Crop Mutation Boost I",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:10}},ProduceMutationBoostII:{name:"Crop Mutation Boost II",description:"Increases the chance of garden crops gaining mutations",trigger:"continuous",baseParameters:{mutationChanceIncreasePercentage:15}},PetMutationBoost:{name:"Pet Mutation Boost I",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:7}},PetMutationBoostII:{name:"Pet Mutation Boost II",description:"Increases the chance of hatched pets gaining mutations",trigger:"hatchEgg",baseParameters:{mutationChanceIncreasePercentage:10}},GoldGranter:{name:"Gold Granter",description:"Grants the Gold mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Gold"]}},RainbowGranter:{name:"Rainbow Granter",description:"Grants the Rainbow mutation to a garden crop",trigger:"continuous",baseProbability:.72,baseParameters:{grantedMutations:["Rainbow"]}},EggGrowthBoost:{name:"Egg Growth Boost I",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:21,baseParameters:{eggGrowthTimeReductionMinutes:7}},EggGrowthBoostII:{name:"Egg Growth Boost II",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:24,baseParameters:{eggGrowthTimeReductionMinutes:10}},EggGrowthBoostIII:{name:"Egg Growth Boost III",description:"Reduces the time for eggs to hatch",trigger:"continuous",baseProbability:27,baseParameters:{eggGrowthTimeReductionMinutes:13}},PetAgeBoost:{name:"Hatch XP Boost I",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:50,baseParameters:{bonusXp:8e3}},PetAgeBoostII:{name:"Hatch XP Boost II",description:"Hatched pets start with bonus XP",trigger:"hatchEgg",baseProbability:60,baseParameters:{bonusXp:12e3}},PetHatchSizeBoost:{name:"Max Strength Boost I",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:12,baseParameters:{maxStrengthIncreasePercentage:2.4}},PetHatchSizeBoostII:{name:"Max Strength Boost II",description:"Increases the maximum strength of hatched pets",trigger:"hatchEgg",baseProbability:14,baseParameters:{maxStrengthIncreasePercentage:3.5}},PetXpBoost:{name:"XP Boost I",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:30,baseParameters:{bonusXp:300}},PetXpBoostII:{name:"XP Boost II",description:"Gives bonus XP to active pets",trigger:"continuous",baseProbability:35,baseParameters:{bonusXp:400}},HungerRestore:{name:"Hunger Restore I",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:12,baseParameters:{hungerRestorePercentage:30}},HungerRestoreII:{name:"Hunger Restore II",description:"Restores the hunger of a random active pet",trigger:"continuous",baseProbability:14,baseParameters:{hungerRestorePercentage:35}},HungerBoost:{name:"Hunger Boost I",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:12}},HungerBoostII:{name:"Hunger Boost II",description:"Reduces the hunger depletion rate of active pets",trigger:"continuous",baseParameters:{hungerDepletionRateDecreasePercentage:16}},PetRefund:{name:"Pet Refund I",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:5,baseParameters:{}},PetRefundII:{name:"Pet Refund II",description:"Chance to receive the pet back as an egg when sold",trigger:"sellPet",baseProbability:7,baseParameters:{}},Copycat:{name:"Copycat",description:"Chance to copy the ability of another active pet",trigger:"continuous",baseProbability:1,baseParameters:{}},CoinFinderI:{name:"Coin Finder I",description:"Finds coins in your garden",trigger:"continuous",baseProbability:35,baseParameters:{baseMaxCoinsFindable:12e4}},CoinFinderII:{name:"Coin Finder II",description:"Finds coins in your garden",trigger:"continuous",baseProbability:13,baseParameters:{baseMaxCoinsFindable:12e5}},CoinFinderIII:{name:"Coin Finder III",description:"Finds coins in your garden",trigger:"continuous",baseProbability:6,baseParameters:{baseMaxCoinsFindable:1e7}},SeedFinderI:{name:"Seed Finder I",description:"Finds common and uncommon seeds in your garden",trigger:"continuous",baseProbability:40,baseParameters:{}},SeedFinderII:{name:"Seed Finder II",description:"Finds rare and legendary seeds in your garden",trigger:"continuous",baseProbability:16,baseParameters:{}},SeedFinderIII:{name:"Seed Finder III",description:"Finds mythical seeds in your garden",trigger:"continuous",baseProbability:9,baseParameters:{}},SeedFinderIV:{name:"Seed Finder IV",description:"Finds divine and celestial seeds in your garden",trigger:"continuous",baseProbability:.01,baseParameters:{}}},ha={WateringCan:{tileRef:ft.WateringCan,name:"Watering Can",coinPrice:5e3,creditPrice:2,rarity:A.Common,description:"Speeds up growth of plant by 5 minutes. SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.6,maxInventoryQuantity:99},PlanterPot:{tileRef:ft.PlanterPot,name:"Planter Pot",coinPrice:25e3,creditPrice:5,rarity:A.Common,description:"Extract a plant to your inventory (can be replanted). SINGLE USE.",isOneTimePurchase:!1,baseTileScale:.8},Shovel:{tileRef:ft.Shovel,name:"Shovel",coinPrice:1e6,creditPrice:100,rarity:A.Uncommon,description:"Remove plants from your garden. UNLIMITED USES.",isOneTimePurchase:!0,baseTileScale:.7},RainbowPotion:{tileRef:ft.RainbowPotion,name:"Rainbow Potion",coinPrice:1/0,creditPrice:1/0,rarity:A.Celestial,description:"Adds the Rainbow mutation to a crop in your garden. SINGLE USE.",isOneTimePurchase:!0,baseTileScale:1}},Sa={SmallRock:{tileRef:se.SmallRock,name:"Small Garden Rock",coinPrice:1e3,creditPrice:2,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MediumRock:{tileRef:se.MediumRock,name:"Medium Garden Rock",coinPrice:2500,creditPrice:5,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.21},LargeRock:{tileRef:se.LargeRock,name:"Large Garden Rock",coinPrice:5e3,creditPrice:10,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.1},WoodBench:{tileRef:se.WoodBench,name:"Wood Bench",coinPrice:1e4,creditPrice:15,rarity:A.Common,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},WoodArch:{tileRef:se.WoodArch,name:"Wood Arch",coinPrice:2e4,creditPrice:25,rarity:A.Common,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},WoodBridge:{tileRef:se.WoodBridge,name:"Wood Bridge",coinPrice:4e4,creditPrice:35,rarity:A.Common,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},WoodLampPost:{tileRef:se.WoodLampPost,name:"Wood Lamp Post",coinPrice:8e4,creditPrice:49,rarity:A.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},WoodOwl:{tileRef:se.WoodOwl,name:"Wood Owl",coinPrice:9e4,creditPrice:59,rarity:A.Common,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},WoodBirdhouse:{tileRef:se.Birdhouse,name:"Wood Birdhouse",coinPrice:1e5,creditPrice:69,rarity:A.Common,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneBench:{tileRef:se.StoneBench,name:"Stone Bench",coinPrice:1e6,creditPrice:75,rarity:A.Uncommon,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},StoneArch:{tileRef:se.StoneArch,name:"Stone Arch",coinPrice:4e6,creditPrice:124,rarity:A.Uncommon,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},StoneBridge:{tileRef:se.StoneBridge,name:"Stone Bridge",coinPrice:5e6,creditPrice:179,rarity:A.Uncommon,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},StoneLampPost:{tileRef:se.StoneLampPost,name:"Stone Lamp Post",coinPrice:8e6,creditPrice:199,rarity:A.Uncommon,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},StoneGnome:{tileRef:se.StoneGnome,name:"Stone Gnome",coinPrice:9e6,creditPrice:219,rarity:A.Uncommon,baseTileScale:1.3,isOneTimePurchase:!1,nudgeY:-.4},StoneBirdbath:{tileRef:se.StoneBirdbath,name:"Stone Birdbath",coinPrice:1e7,creditPrice:249,rarity:A.Uncommon,baseTileScale:1.2,isOneTimePurchase:!1,nudgeY:-.46},MarbleBench:{tileRef:se.MarbleBench,name:"Marble Bench",coinPrice:75e6,creditPrice:349,rarity:A.Rare,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3,avatarNudgeY:-.18},MarbleArch:{tileRef:se.MarbleArch,name:"Marble Arch",coinPrice:1e8,creditPrice:399,rarity:A.Rare,baseTileScale:1.53,isOneTimePurchase:!1,nudgeY:-.5},MarbleBridge:{tileRef:se.MarbleBridge,name:"Marble Bridge",coinPrice:15e7,creditPrice:429,rarity:A.Rare,baseTileScale:1.22,isOneTimePurchase:!1,nudgeY:-.35,avatarNudgeY:-.44},MarbleLampPost:{tileRef:se.MarbleLampPost,name:"Marble Lamp Post",coinPrice:2e8,creditPrice:449,rarity:A.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.6},MarbleBlobling:{tileRef:se.MarbleBlobling,name:"Marble Blobling",coinPrice:3e8,creditPrice:499,rarity:A.Rare,baseTileScale:1.5,isOneTimePurchase:!1,nudgeY:-.56},MiniFairyCottage:{tileRef:se.MiniFairyCottage,name:"Mini Fairy Cottage",coinPrice:5e8,creditPrice:549,rarity:A.Rare,baseTileScale:1.1,isOneTimePurchase:!1,nudgeY:-.37},StrawScarecrow:{tileRef:se.StrawScarecrow,name:"Straw Scarecrow",coinPrice:1e9,creditPrice:599,rarity:A.Legendary,baseTileScale:1.8,isOneTimePurchase:!1,nudgeY:-.65},MiniFairyForge:{tileRef:se.MiniFairyForge,name:"Mini Fairy Forge",coinPrice:5e9,creditPrice:979,rarity:A.Legendary,baseTileScale:1,isOneTimePurchase:!1,nudgeY:-.3},MiniFairyKeep:{tileRef:se.MiniFairyKeep,name:"Mini Fairy Keep",coinPrice:25e9,creditPrice:1249,rarity:A.Mythic,baseTileScale:1.05,isOneTimePurchase:!1,nudgeY:-.33}};var Rt=new Map;function or(e){try{return Ve(new RegExp("^"+e+"$"))}catch{return[]}}function sr(e){if(e&&typeof e.read=="function")return"read";for(let t of Object.keys(e||{})){let n=e[t];if(typeof n=="function"&&t!=="write"&&t!=="onMount"&&t!=="toString"){let r=n.length;if(r===1||r===2)return t}}throw new Error("Impossible de localiser la fonction read() de l'atom")}function lr(e){return Rt.get(e)||null}async function cr(e){!e?.closeAction||!e?.openAction||(await e.closeAction(),await new Promise(t=>setTimeout(t,0)),await e.openAction())}async function dr(e){let t=e.label,n=Rt.get(t);if(n?.installed)return n;let r=or(e.label);if(!r.length)throw new Error(`${e.label} introuvable`);let a=n??{config:e,enabled:!1,payload:null,patched:new Map,installed:!1},i=null;e.gate?.label&&(i=oe(e.gate.label));for(let o of r){let l=sr(o),u=o[l];o[l]=d=>{try{i&&d(i)}catch{}for(let P of e.extraDeps||[])try{let M=oe(P);M&&d(M)}catch{}let y=u(d);return!a.enabled||a.payload==null?y:e.merge?e.merge(y,a.payload):a.payload},a.patched.set(o,{readKey:l,orig:u})}return i&&e.gate?.autoDisableOnClose&&(a.unsubGate=await $e(i,async()=>{let o;try{o=await ve(i)}catch{o=null}!(e.gate?.isOpen?e.gate.isOpen(o):!!o)&&a.enabled&&(a.enabled=!1)})),a.installed=!0,Rt.set(t,a),a}async function qt(e,t,n){await Ie();let r=await dr(e);r.payload=t,r.enabled=!0,n?.merge&&!e.merge&&(e.merge=(a,i)=>i),n?.openGate&&e.gate?.openAction&&await e.gate.openAction(),r.autoTimer&&(clearTimeout(r.autoTimer),r.autoTimer=null),n?.autoRestoreMs&&n.autoRestoreMs>0&&(r.autoTimer=setTimeout(()=>{ln(e.label)},n.autoRestoreMs))}async function ln(e){let t=lr(e);t&&(t.enabled=!1,t.payload=null,t.autoTimer&&(clearTimeout(t.autoTimer),t.autoTimer=null),await cr(t.config.gate))}var _e={activeModal:"activeModalAtom",inventory:"myInventoryAtom",myData:"myDataAtom"};async function Bt(){let e=oe(_e.activeModal);e&&await xe(e,"inventory")}async function nt(){let e=oe(_e.activeModal);e&&await xe(e,null)}function cn(e){return e==="inventory"}var ur={label:_e.inventory,merge:(e,t)=>t,gate:{label:_e.activeModal,isOpen:cn,openAction:Bt,closeAction:nt,autoDisableOnClose:!0}},mr={label:_e.myData,merge:(e,t)=>({...e&&typeof e=="object"?e:{},inventory:t}),gate:{label:_e.activeModal,isOpen:cn,openAction:Bt,closeAction:nt,autoDisableOnClose:!0}};async function rt(e,t){let n=t?.open!==!1,r;try{let i=oe(_e.inventory);i&&(r=await ve(i).catch(()=>{}))}catch{}try{console.log("[fakeInventory] \u25B6 re\xE7u \u2192",e)}catch{}try{console.log("[fakeInventory] \u25B6 moi   \u2192",r)}catch{}let a=e;try{await qt(mr,a,{openGate:!1,autoRestoreMs:t?.autoRestoreMs})}catch{}await qt(ur,a,{openGate:!1,autoRestoreMs:t?.autoRestoreMs}),n&&await Bt()}var Pn="myValidatedSelectedItemIndexAtom",pr="qws:pets:overrides:v1",Tn="qws:pets:ui:v1",In="qws:pets:teams:v1",Cn="qws:pets:teamSearch:v1",dn={enabled:!1,thresholdPct:10,crops:{}},Ht={selectedPetId:null},De=sn??{};function En(e){let t=String(e??""),n=typeof De?.[t]?.name=="string"&&De[t].name.trim()?De[t].name:t;return String(n)}function Mn(e){let t=String(e??""),n=typeof De?.[t]?.name=="string"&&De[t].name.trim()?De[t].name:t;return String(n).replace(/(?:\s+|-)?(?:I|II|III|IV|V|VI|VII|VIII|IX|X)\s*$/,"").trim()}function un(e){let t=String(e||"").trim(),n=t.match(/^(ab|sp):\s*(.*)$/i);return n?{mode:n[1].toLowerCase()==="ab"?"ability":"species",value:(n[2]||"").trim()}:{mode:"text",value:t}}async function mn(e){await Ne();let t=String(e||"").toLowerCase().trim().replace(/(?:\s+|-)?(?:i|ii|iii|iv|v|vi|vii|viii|ix|x)\s*$/i,""),n=new Set;if(!t)return n;for(let r of Re){let a=Array.isArray(r.abilities)?r.abilities:[];for(let i of a)Mn(i).toLowerCase()===t&&n.add(i)}return n}function Wt(e,t){return t?Me(e.id).includes(t)||Me(e.petSpecies).includes(t)||Me(e.name).includes(t)||Array.isArray(e.abilities)&&e.abilities.some(n=>Me(n).includes(t)||Me(En(n)).includes(t))||Array.isArray(e.mutations)&&e.mutations.some(n=>Me(n).includes(t)):!0}async function pn(){try{let e=await pt.get();return(Array.isArray(e?.favoritedItemIds)?e.favoritedItemIds:[]).slice()}catch{return[]}}function yr(e){if(!e||kt[e])return e;let t=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();return kt[t]?t:e}function yn(e){return{id:e.id,itemType:"Pet",petSpecies:yr(e.petSpecies),name:e.name??null,xp:e.xp,hunger:e.hunger,mutations:Array.isArray(e.mutations)?e.mutations.slice():[],targetScale:e.targetScale,abilities:Array.isArray(e.abilities)?e.abilities.slice():[]}}async function Dt(){let e=oe("setSelectedIndexToEndAtom");await xe(e,"null");try{await me.setSelectedItem(null)}catch{}try{await me.dropObject()}catch{}}async function gn(e=2e4){let t=oe(Pn);if(!t)return null;await Dt();let n=performance.now();for(;performance.now()-n<e;){try{let r=await ve(t);if(typeof r=="number"&&Number.isInteger(r)&&r>=0)return r}catch{}await new Promise(r=>setTimeout(r,100))}return null}function gr(){try{let e=localStorage.getItem(pr);if(!e)return{};let t=JSON.parse(e);return t&&typeof t=="object"?t:{}}catch{return{}}}function Nt(){try{let e=localStorage.getItem(Tn);if(!e)return{...Ht};let t=JSON.parse(e);return{...Ht,...t||{}}}catch{return{...Ht}}}function fr(e){try{localStorage.setItem(Tn,JSON.stringify(e))}catch{}}function An(){try{let e=localStorage.getItem(In);if(!e)return[];let t=JSON.parse(e);return Array.isArray(t)?t.map(n=>({id:String(n?.id||""),name:String(n?.name||"Team"),slots:Array.isArray(n?.slots)?n.slots.slice(0,3).map(r=>r?String(r):null):[null,null,null]})).filter(n=>n.id):[]}catch{return[]}}function je(e){try{localStorage.setItem(In,JSON.stringify(e))}catch{}}function fn(){try{return crypto.randomUUID()}catch{return`t_${Date.now().toString(36)}_${Math.random().toString(16).slice(2)}`}}var at=An(),br=new Set;function hr(){let e=at.slice();br.forEach(t=>{try{t(e)}catch{}})}function Sr(){try{let e=localStorage.getItem(Cn),t=e?JSON.parse(e):{};return t&&typeof t=="object"?t:{}}catch{return{}}}function wr(e){try{localStorage.setItem(Cn,JSON.stringify(e))}catch{}}var bt=Sr(),Gt=new Set;function vr(e){let t=bt[e]||"";Gt.forEach(n=>{try{n(e,t)}catch{}})}function xr(e){let t=e??dn;return{enabled:!!t.enabled,thresholdPct:Math.min(100,Math.max(1,Number(t.thresholdPct)||dn.thresholdPct)),crops:{...t.crops||{}}}}var Pr=[],Ye=null,ht=[],Re=[],$t=new Set,bn=null,hn=null,Ot=null,Ft=null,Me=e=>(e??"").toLowerCase(),Ln=e=>typeof e=="string"?e:null,St=e=>Number.isFinite(e)?e:0,wt=e=>Array.isArray(e)?e.filter(t=>typeof t=="string"):[];function vt(e){if(!e||e.itemType!=="Pet")return null;let t=Me(e.id);return t?{id:t,itemType:"Pet",petSpecies:Me(e.petSpecies??e.data?.petSpecies),name:Ln(e.name??e.data?.name??null),xp:St(e.xp??e.data?.xp),hunger:St(e.hunger??e.data?.hunger),mutations:wt(e.mutations??e.data?.mutations),targetScale:Number.isFinite(e.targetScale??e.data?.targetScale)?Number(e.targetScale??e.data?.targetScale):void 0,abilities:wt(e.abilities??e.data?.abilities)}:null}function kn(e){let t=e?.slot;if(!t||typeof t!="object")return null;let n=Me(t.id);return n?{id:n,itemType:"Pet",petSpecies:Me(t.petSpecies),name:Ln(t.name??null),xp:St(t.xp),hunger:St(t.hunger),mutations:wt(t.mutations),targetScale:Number.isFinite(t.targetScale)?Number(t.targetScale):void 0,abilities:wt(t.abilities)}:null}function Rn(e){return JSON.stringify({id:e.id,itemType:"Pet",petSpecies:e.petSpecies,name:e.name??null,mutations:Array.isArray(e.mutations)?e.mutations:[],targetScale:Number.isFinite(e.targetScale)?e.targetScale:null,abilities:Array.isArray(e.abilities)?e.abilities:[]})}function Sn(e){let t=new Map,n=Array.isArray(e?.items)?e.items:Array.isArray(e)?e:[];for(let r of n){let a=vt(r);a&&t.set(a.id,Rn(a))}return t}function wn(e){let t=new Map,n=Array.isArray(e)?e:[];for(let r of n){let a=kn(r);a&&t.set(a.id,Rn(a))}return t}function vn(e,t){if(!e||e.size!==t.size)return!1;for(let[n,r]of t)if(e.get(n)!==r)return!1;return!0}function _t(){let e=new Map,t=Array.isArray(Ye?.items)?Ye.items:Array.isArray(Ye)?Ye:[];for(let a of t){let i=vt(a);i&&i.id&&e.set(i.id,i)}let n=Array.isArray(ht)?ht:[];for(let a of n){let i=kn(a);i&&i.id&&e.set(i.id,i)}Re=Array.from(e.values());let r=Re.slice();$t.forEach(a=>{try{a(r)}catch{}})}async function Ne(){if(!bn){let e=await pt.subNow(t=>{let n=Sn(t);vn(Ot,n)||(Ot=n,Ye=t,_t())});bn=()=>{try{e()}catch{}}}if(!hn){let e=await ke.subNow(t=>{let n=wn(t);vn(Ft,n)||(Ft=n,ht=Array.isArray(t)?t:[],_t())});hn=()=>{try{e()}catch{}}}if(!Re.length)try{let[e,t]=await Promise.all([pt.get(),ke.get()]);Ot=Sn(e),Ft=wn(t),Ye=e,ht=Array.isArray(t)?t:[],_t()}catch{}}var J={getPets(){return me.getPets()},onPetsChange(e){return me.onPetsChange(e)},onPetsChangeNow(e){return me.onPetsChangeNow(e)},async getPetById(e){await Ne();let t=String(e||"");return t?Re.find(n=>n.id===t)??null:null},getAbilityName(e){return En(e)},getAbilityNameWithoutLevel(e){return Mn(e)},getAbilityInfo(e){let t=String(e??""),n=De?.[t];return n?{id:t,...n}:null},getOverride(e){let t=gr();return xr(t[e])},async chooseSlotPet(e,t,n){let r=Math.max(0,Math.min(2,Math.floor(t||0))),a=this.getTeamById(e);if(!a)return null;let i=new Set;a.slots.forEach((P,M)=>{M!==r&&P&&i.add(String(P))});let o=n&&n.trim().length?await this.buildFilteredInventoryByQuery(n,{excludeIds:i}):await this.buildFilteredInventoryForTeam(e,{excludeIds:i});console.log("payload: ",o);let l=Array.isArray(o?.items)?o.items:[];if(!l.length){try{console.warn("[Pets] chooseSlotPet: no items match current filter.")}catch{}return null}await rt(o,{open:!0});let u=await gn(2e4);if(await nt(),u==null||u<0||u>=l.length){try{console.log("[Pets] chooseSlotPet: selection canceled or timed out.")}catch{}return null}let d=vt(l[u]);if(!d)return null;let y=a.slots.slice(0,3);y[r]=String(d.id),this.saveTeam({id:a.id,slots:y});try{await Dt()}catch{}return d},async pickPetViaFakeInventory(e){let t=await this.buildFilteredInventoryByQuery(e||""),n=Array.isArray(t?.items)?t.items:[];if(!n.length)return null;await rt(t,{open:!0});let r=await gn(2e4);await nt();let a=oe(Pn);return r==null||r<0||r>=n.length?null:(await Dt(),vt(n[r]))},setTeamsOrder(e){let t=new Map(this._teams.map(r=>[r.id,r])),n=[];for(let r of e){let a=t.get(r);a&&(n.push(a),t.delete(r))}for(let r of t.values())n.push(r);this._teams=n,je(this._teams),this._notifyTeamSubs()},async buildFilteredInventoryForTeam(e,t){await Ne();let{mode:n,value:r}=un(this.getTeamSearch(e)||""),a=await this.getInventoryPets();if(n==="ability"&&r){let d=await mn(r);a=d.size?a.filter(y=>Array.isArray(y.abilities)&&y.abilities.some(P=>d.has(P))):[]}else if(n==="species"&&r){let d=r.toLowerCase();a=a.filter(y=>(y.petSpecies||"").toLowerCase()===d)}else r&&(a=a.filter(d=>Wt(d,r)));if(t?.excludeIds?.size){let d=t.excludeIds;a=a.filter(y=>!d.has(y.id))}let i=a.map(yn),o=await pn(),l=new Set(a.map(d=>d.id)),u=o.filter(d=>l.has(d));return{items:i,favoritedItemIds:u}},async buildFilteredInventoryByQuery(e,t){await Ne();let n=(e||"").toLowerCase().trim();console.log(n);let r=await this.getInventoryPets();if(console.log("before filter (query)",r),r=r.filter(u=>Wt(u,n)),t?.excludeIds?.size){let u=t.excludeIds;r=r.filter(d=>!u.has(d.id))}console.log("after filter (query)",r);let a=r.map(yn),i=await pn(),o=new Set(r.map(u=>u.id)),l=i.filter(u=>o.has(u));return{items:a,favoritedItemIds:l}},getUIState(){return Nt()},setUIState(e){let n={...Nt(),...e||{}};return fr(n),n},setSelectedPet(e){return this.setUIState({selectedPetId:e})},getSelectedPetId(){return Nt().selectedPetId??null},_teams:An(),_teamSubs:new Set,_notifyTeamSubs(){let e=this.getTeams();this._teamSubs.forEach(t=>{try{t(e)}catch{}})},getTeams(){return Array.isArray(this._teams)?this._teams.map(e=>({...e,slots:e.slots.slice(0,3)})):[]},onTeamsChange(e){this._teamSubs.add(e);try{e(this.getTeams())}catch{}return()=>{this._teamSubs.delete(e)}},async onTeamsChangeNow(e){let t=this.onTeamsChange(e);try{e(this.getTeams())}catch{}return t},createTeam(e){let t={id:fn(),name:e?.trim()||`Team ${this._teams.length+1}`,slots:[null,null,null]};return this._teams.push(t),je(this._teams),this._notifyTeamSubs(),t},duplicateTeam(e){let t=this._teams.find(r=>r.id===e);if(!t)return null;let n={id:fn(),name:`${t.name} (copy)`,slots:t.slots.slice(0,3)};return this._teams.push(n),je(this._teams),this._notifyTeamSubs(),n},deleteTeam(e){let t=this._teams.findIndex(n=>n.id===e);return t<0?!1:(this._teams.splice(t,1),je(this._teams),this._notifyTeamSubs(),!0)},saveTeam(e){let t=this._teams.findIndex(a=>a.id===e.id);if(t<0)return null;let n=this._teams[t],r={id:n.id,name:typeof e.name=="string"?e.name:n.name,slots:Array.isArray(e.slots)?e.slots.slice(0,3):n.slots};return this._teams[t]=r,je(this._teams),this._notifyTeamSubs(),r},updateTeam(e,t){let n=at.findIndex(i=>i.id===e);if(n<0)return null;let r=at[n],a={...r,...t,slots:t.slots?[...t.slots]:r.slots};return at[n]=a,je(at),hr(),a},getTeamSearch(e){return bt[e]||""},setTeamSearch(e,t){bt[e]=(t||"").trim(),wr(bt),vr(e)},onTeamSearchChange(e){return Gt.add(e),()=>{Gt.delete(e)}},getTeamById(e){let t=this._teams.find(n=>n.id===e)||null;return t?{...t,slots:t.slots.slice(0,3)}:null},async getTeamFilteredInventoryPets(e){await Ne();let{mode:t,value:n}=un(this.getTeamSearch(e)||""),r=Re.slice();if(t==="ability"&&n){let a=await mn(n);return a.size?r.filter(i=>i.abilities?.some(o=>a.has(o))):[]}if(t==="species"&&n){let a=n.toLowerCase();return r.filter(i=>(i.petSpecies||"").toLowerCase()===a)}return n?r.filter(a=>Wt(a,n)):r},async getTeamSlotOptions(e,t){await Ne();let n=this.getTeamById(e),r=await this.getTeamFilteredInventoryPets(e);if(!n)return r;let a=Math.max(0,Math.min(2,Math.floor(t))),i=n.slots[a]||null,o=new Set;n.slots.forEach((u,d)=>{d!==a&&u&&o.add(u)});let l=r.filter(u=>!o.has(u.id));if(i&&!l.some(u=>u.id===i)){let u=Re.find(d=>d.id===i);u&&(l=[u,...l])}return l},_logs:[],_logsMax:500,_seenPerfByPet:new Map,_logSubs:new Set,async startAbilityLogsWatcher(){let e=await an.subNow(t=>{this._ingestAbilityMap(t)});return()=>{try{e()}catch{}}},getAbilityLogs(e){let t=e?.abilityIds&&e.abilityIds.length?new Set(e.abilityIds):null,n=Number.isFinite(e?.since)?e.since:0,r=Math.max(0,Math.floor(e?.limit??0)),a=this._logs.filter(i=>(n?i.performedAt>=n:!0)&&(t?t.has(i.abilityId):!0));return a=a.sort((i,o)=>o.performedAt-i.performedAt),r?a.slice(0,r):a},onAbilityLogs(e){this._logSubs.add(e);try{e(this.getAbilityLogs())}catch{}return()=>{this._logSubs.delete(e)}},getSeenAbilityIds(){let e=new Set;for(let t of this._logs)e.add(t.abilityId);return Array.from(e).sort()},clearAbilityLogs(){this._logs.length=0,this._seenPerfByPet.clear(),this._notifyLogSubs()},_notifyLogSubs(){let e=this.getAbilityLogs();this._logSubs.forEach(t=>{try{t(e)}catch{}})},_pushLog(e){this._logs.push(e),this._logs.length>this._logsMax&&this._logs.splice(0,this._logs.length-this._logsMax),this._notifyLogSubs()},_ingestAbilityMap(e){if(!(!e||typeof e!="object"))for(let t of Object.keys(e)){let n=e[t];if(!n||typeof n!="object")continue;let r=n.abilityId??null,a=Number(n.performedAt)||0;if(!r||!a)continue;let i=this._seenPerfByPet.get(t)||0;if(a<=i)continue;let o=Pr.find(u=>String(u?.slot?.id||"")===t)||null,l={petId:t,species:o?.slot?.petSpecies||void 0,name:o?.slot?.name??void 0,abilityId:String(r),data:n.data,performedAt:a};this._seenPerfByPet.set(t,a),this._pushLog(l)}},async getInventoryPets(){return await Ne(),Re.slice()},async searchInventoryPets(e){let t=await this.getInventoryPets(),n=a=>(a??"").toLowerCase(),r=(e||"").toLowerCase().trim();return r?t.filter(a=>n(a.id).includes(r)||n(a.petSpecies).includes(r)||n(a.name).includes(r)||a.abilities.some(i=>n(i).includes(r))||a.mutations.some(i=>n(i).includes(r))):t},onInventoryPetsChange(e){Ne(),$t.add(e);try{e(Re.slice())}catch{}return()=>{$t.delete(e)}},async useTeam(e){let t=this.getTeams().find(r=>r.id===e)||null;if(!t)throw new Error("Team not found");let n=(t.slots||[]).filter(r=>typeof r=="string"&&r.length>0).slice(0,3);return n.length?xn(n):{swapped:0,placed:0,skipped:0}},async useTeamSlots(e){let t=(Array.isArray(e)?e:[]).filter(n=>typeof n=="string"&&n.length>0).slice(0,3);return t.length?xn(t):{swapped:0,placed:0,skipped:0}}};async function Tr(){try{let e=await me.getPets();return(Array.isArray(e)?e:[]).map(n=>String(n?.slot?.id||"")).filter(n=>!!n).slice(0,3)}catch{return[]}}async function xn(e){let t=await Tr(),n=new Set(e),r=t.filter(y=>!n.has(y)),a=Math.max(0,t.length-e.length);if(a>0){let y=r.slice(0,a);for(let P of y)try{await me.storePet(P),t=t.filter(M=>M!==P)}catch(M){console.warn("[Pets] storePet failed:",P,M)}}let i=new Set;for(let y of e)t.includes(y)&&i.add(y);let o=0,l=0,u=0;i.size&&(t=t.filter(y=>!i.has(y)),u=i.size);let d=e.filter(y=>!i.has(y));for(let y of d){let P=t.shift();try{P?(await me.swapPet(P,y),o++):(await me.placePet(y,{x:0,y:0},"Boardwalk",64),l++)}catch(M){console.warn("[Pets] useTeam op failed for",{invId:y,slotId:P,err:M})}}return{swapped:o,placed:l,skipped:u}}function jt(e){let t="qws:pos",n="qws:collapsed",r="qws:hidden";if(document.readyState==="loading"){document.addEventListener("DOMContentLoaded",()=>jt(e),{once:!0});return}let i=`
  :root{
    --qws-bg:        #0f1318;
    --qws-panel:     #111823cc;
    --qws-border:    #ffffff22;
    --qws-border-2:  #ffffff14;
    --qws-accent:    #7aa2ff;
    --qws-text:      #e7eef7;
    --qws-text-dim:  #b9c3cf;
    --qws-blur:      8px;
    --qws-shadow:    0 10px 36px rgba(0,0,0,.45);
  }

  /* ---------- HUD floating box ---------- */
  .qws2{
    position:fixed; right:16px; bottom:16px; z-index:999998;
    font:12px/1.4 system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
    color:var(--qws-text);
    background:var(--qws-panel);
    border:1px solid var(--qws-border);
    border-radius:12px;
    padding:10px 12px;
    box-shadow:var(--qws-shadow);
    backdrop-filter:blur(var(--qws-blur));
    min-width:160px;
    display:flex; flex-direction:column; gap:8px;
  }
  .qws2.hidden{ display:none }
  .qws2 .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .qws2 .col{ display:flex; flex-direction:column; gap:4px }
  .qws2 .title{ font-weight:700; letter-spacing:.2px }
  .qws2 .sp{ flex:1 }

  .qws2 .pill{
    display:inline-flex; align-items:center; gap:6px;
    padding:4px 8px; border-radius:999px;
    border:1px solid #ffffff26;
    background:rgba(255,255,255,.06);
    color:var(--qws-text);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.08);
  }
  .qws2 .ok{   background:rgba(36, 161, 72, .20);  border-color:#48d17066 }
  .qws2 .warn{ background:rgba(241, 194, 27, .18); border-color:#ffd65c66 }
  .qws2 .bad{  background:rgba(218, 30, 40, .20);  border-color:#ff7c8666 }

  .qws2 .btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:6px 10px;
    background:linear-gradient(180deg, #ffffff12, #ffffff06);
    color:#fff;
    transition:transform .1s ease, background .18s ease, border-color .18s ease;
  }
  .qws2 .btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws2 .btn:active{ transform:translateY(1px) }
  .qws2 .drag{ cursor:move; opacity:.9 }

  .qws2 .mini{ display:none }
  .qws2.min .mini{ display:inline-flex }
  .qws2.min .body{ display:none }

  /* Launcher always shown */
  .qws-launch{ margin-top:4px; border-top:1px solid var(--qws-border); padding-top:6px; display:block }
  .qws-launch .launch-item{ display:flex; align-items:center; gap:8px; margin:4px 0 }
  .qws-launch .launch-item .name{ flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
  .qws-launch .launch-item .btn.active{
    background:linear-gradient(180deg, rgba(122,162,255,.28), rgba(122,162,255,.12));
    border-color:#9db7ff66;
  }

  /* ---------- Windows ---------- */
  .qws-win{
    position:fixed; z-index:999999; min-width:260px; max-width:900px; max-height:90vh; overflow:auto;
    background:var(--qws-panel); color:var(--qws-text);
    border:1px solid var(--qws-border); border-radius:12px;
    box-shadow:var(--qws-shadow); backdrop-filter:blur(var(--qws-blur));
  }
  .qws-win .w-head{
    display:flex; align-items:center; gap:8px; padding:10px 12px;
    border-bottom:1px solid var(--qws-border); cursor:move;
    background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
    border-top-left-radius:12px; border-top-right-radius:12px;
  }
  .qws-win .w-title{ font-weight:700 }
  .qws-win .sp{ flex:1 }
  .qws-win .w-btn{
    cursor:pointer; border-radius:10px; border:1px solid var(--qws-border);
    padding:4px 8px; background:linear-gradient(180deg, #ffffff12, #ffffff06); color:#fff;
  }
  .qws-win .w-btn:hover{ background:linear-gradient(180deg, #ffffff18, #ffffff0a); border-color:#ffffff44 }
  .qws-win .w-body{ padding:12px }

  /* Inputs inside windows */
  .qws-win input[type="text"], .qws-win input[type="number"]{
    width:120px; padding:8px 10px; border-radius:10px;
    border:1px solid var(--qws-border); background:rgba(0,0,0,.42); color:#fff;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  }
  .qws-win .row{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin:6px 0 }
  `,o=document.createElement("style");o.textContent=i,(document.documentElement||document.body).appendChild(o);let l=document.createElement("div");l.className="qws2",l.innerHTML=`
    <div class="row drag">
      <div class="title">Arie's Mod</div>
      <div class="sp"></div>
      <span id="qws2-status-mini" class="pill warn mini">\u2026</span>
      <button id="qws2-min" class="btn" title="Minimize/Expand">\u2013</button>
      <button id="qws2-hide" class="btn" title="Hide (Alt+X)">\u2715</button>
    </div>

    <!-- Status & store side-by-side (no mode label) -->
    <div class="row" style="margin:2px 0 2px 0;">
      <span id="qws2-status2" class="pill warn">WS: \u2026</span>
      <span id="qws2-store" class="pill warn">store: \u2026</span>
    </div>

    <div class="body">
      <div id="qws-launch" class="qws-launch"></div>
    </div>
  `,(document.documentElement||document.body).appendChild(l);function u(m){let k=m.getBoundingClientRect(),c=window.innerWidth,s=window.innerHeight,b=parseFloat(getComputedStyle(m).right)||c-k.right,p=parseFloat(getComputedStyle(m).bottom)||s-k.bottom,E=Math.max(8,c-k.width-8),g=Math.max(8,s-k.height-8);b=Math.min(Math.max(b,8),E),p=Math.min(Math.max(p,8),g),m.style.right=b+"px",m.style.bottom=p+"px"}function d(m){u(m);let k=m.getBoundingClientRect(),s=m.querySelector(".w-head")?.getBoundingClientRect()||k,b=window.innerWidth,p=window.innerHeight,E=8,g=parseFloat(getComputedStyle(m).right);Number.isNaN(g)&&(g=b-k.right);let R=parseFloat(getComputedStyle(m).bottom);Number.isNaN(R)&&(R=p-k.bottom);let Y=Math.max(E,b-k.width-E),q=Math.max(E,p-k.height-E);if(s.top<E){let W=E-s.top;R=Math.max(E,Math.min(q,R-W))}if(k.left<E){let W=E-k.left;g=Math.max(E,Math.min(Y,g-W))}m.style.right=g+"px",m.style.bottom=R+"px"}function y(m){m.style.right="16px",m.style.bottom="16px",d(m)}function P(m,k){let c=m.getBoundingClientRect(),s=window.innerHeight,b=parseFloat(getComputedStyle(m).bottom);Number.isNaN(b)&&(b=s-c.bottom),k(),requestAnimationFrame(()=>{let p=m.getBoundingClientRect(),E=p.top-c.top,g=b+E,R=Math.max(8,s-p.height-8);g=Math.min(Math.max(8,g),R),m.style.bottom=g+"px",d(m)})}function M(){try{let m=parseFloat(l.style.right)||16,k=parseFloat(l.style.bottom)||16;localStorage.setItem(t,JSON.stringify({r:m,b:k}))}catch{}}try{let m=JSON.parse(localStorage.getItem(t)||"null");if(m&&typeof m.r=="number"&&typeof m.b=="number"&&(l.style.right=m.r+"px",l.style.bottom=m.b+"px"),localStorage.getItem(n)==="1"){l.classList.add("min");let k=l.querySelector("#qws2-min");k&&(k.textContent="+")}localStorage.getItem(r)==="1"&&l.classList.add("hidden"),requestAnimationFrame(()=>u(l)),window.addEventListener("resize",()=>u(l))}catch{}let L=l.querySelector(".drag"),w=l.querySelector("#qws2-min"),T=l.querySelector("#qws2-hide"),I=l.querySelector("#qws2-status-mini"),v=l.querySelector("#qws2-status2"),x=l.querySelector("#qws2-store"),B=l.querySelector("#qws-launch");if(!L||!w||!T||!I||!v||!x||!B){console.warn("[QuinoaWS] HUD elements missing, abort init");return}let D=B;(function(){let k=0,c=0,s=0,b=0,p=!1;L.addEventListener("mousedown",E=>{p=!0,k=E.clientX,c=E.clientY;let g=l.getBoundingClientRect();s=parseFloat(getComputedStyle(l).right)||window.innerWidth-g.right,b=parseFloat(getComputedStyle(l).bottom)||window.innerHeight-g.bottom,document.body.style.userSelect="none"}),window.addEventListener("mousemove",E=>{if(!p)return;let g=E.clientX-k,R=E.clientY-c,Y=s-g,q=b-R,W=l.getBoundingClientRect(),ee=window.innerWidth,K=window.innerHeight,z=Math.max(8,ee-W.width-8),f=Math.max(8,K-W.height-8);Y=Math.min(Math.max(Y,8),z),q=Math.min(Math.max(q,8),f),l.style.right=Y+"px",l.style.bottom=q+"px"}),window.addEventListener("mouseup",()=>{p&&(p=!1,document.body.style.userSelect="",M())})})(),w.onclick=()=>{P(l,()=>{l.classList.toggle("min"),w.textContent=l.classList.contains("min")?"+":"\u2013";try{localStorage.setItem(n,l.classList.contains("min")?"1":"0")}catch{}})},T.onclick=()=>{l.classList.add("hidden");try{localStorage.setItem(r,"1")}catch{}},window.addEventListener("keydown",m=>{let k=(m.target&&m.target.tagName||"").toLowerCase();if(!(k==="input"||k==="textarea"||m.target?.isContentEditable)&&m.altKey&&!m.shiftKey&&!m.ctrlKey&&!m.metaKey&&(m.key==="x"||m.key==="X")){let s=l.classList.toggle("hidden");try{localStorage.setItem(r,s?"1":"0")}catch{}}},!0);let j=new Map,$=0;function U(m,k,c){if(j.has(m)){let q=j.get(m);q.el.style.display="",ce(q.el),F(m,!0);return}let s=document.createElement("div");s.className="qws-win",s.innerHTML=`
      <div class="w-head">
        <div class="w-title"></div>
        <div class="sp"></div>
        <button class="w-btn" data-act="min" title="Minimize/Expand">\u2013</button>
        <button class="w-btn" data-act="close" title="Close">\u2715</button>
      </div>
      <div class="w-body"></div>
    `,(document.documentElement||document.body).appendChild(s);let b=s.querySelector(".w-head"),p=s.querySelector(".w-title"),E=s.querySelector('[data-act="min"]'),g=s.querySelector('[data-act="close"]'),R=s.querySelector(".w-body");p.textContent=k;let Y=$++%5*24;s.style.right=16+Y+"px",s.style.bottom=16+Y+"px",u(s),ce(s),function(){let W=0,ee=0,K=0,z=0,f=!1;b.addEventListener("mousedown",h=>{if(h.target.closest(".w-btn"))return;f=!0,W=h.clientX,ee=h.clientY;let N=s.getBoundingClientRect();K=parseFloat(getComputedStyle(s).right)||window.innerWidth-N.right,z=parseFloat(getComputedStyle(s).bottom)||window.innerHeight-N.bottom,document.body.style.userSelect="none",ce(s)}),window.addEventListener("mousemove",h=>{if(!f)return;let O=h.clientX-W,N=h.clientY-ee,G=K-O,Q=z-N,ae=s.getBoundingClientRect(),Le=window.innerWidth,it=window.innerHeight,Tt=Math.max(8,Le-ae.width-8),ze=Math.max(8,it-ae.height-8);G=Math.min(Math.max(G,8),Tt),Q=Math.min(Math.max(Q,8),ze),s.style.right=G+"px",s.style.bottom=Q+"px"}),window.addEventListener("mouseup",()=>{f=!1,document.body.style.userSelect="",ge(m,s)})}(),E.onclick=()=>{P(s,()=>{let q=R.style.display==="none";R.style.display=q?"":"none",E.textContent=q?"\u2013":"+"})},g.onclick=()=>{s.style.display="none",F(m,!1)},S(s);try{c(R)}catch(q){R.textContent=String(q)}ge(m,s),j.set(m,{id:m,el:s,head:b,body:R}),F(m,!0)}function le(m){return m.style.display!=="none"}function X(m,k,c){let s=j.get(m);return s?le(s.el)?(s.el.style.display="none",F(m,!1),!1):(s.el.style.display="",ce(s.el),d(s.el),F(m,!0),!0):(U(m,k,b=>{let p=b.closest(".qws-win");p&&fe(m,p),c(b)}),!0)}function ce(m){let k=999999;j.forEach(c=>{let s=parseInt(getComputedStyle(c.el).zIndex||"999999",10);s>k&&(k=s)}),m.style.zIndex=String(k+1)}function ge(m,k){try{let c=parseFloat(k.style.right)||16,s=parseFloat(k.style.bottom)||16;localStorage.setItem(`qws:win:${m}:pos`,JSON.stringify({r:c,b:s}))}catch{}}function fe(m,k){try{let c=localStorage.getItem(`qws:win:${m}:pos`);if(!c)return;let s=JSON.parse(c);typeof s.r=="number"&&(k.style.right=s.r+"px"),typeof s.b=="number"&&(k.style.bottom=s.b+"px"),d(k)}catch{}}window.addEventListener("resize",()=>{j.forEach(m=>d(m.el))});function Te(){let m=null,k=g=>{let R=g;return R&&R.closest?.(".qws-win, .qws2")||null},c=g=>{if(!g.altKey||g.button!==0)return;let R=k(g.target);if(!R||R.style.display==="none")return;let Y=R.getBoundingClientRect(),q=window.innerWidth,W=window.innerHeight,ee=parseFloat(getComputedStyle(R).right),K=parseFloat(getComputedStyle(R).bottom);Number.isNaN(ee)&&(ee=q-Y.right),Number.isNaN(K)&&(K=W-Y.bottom),m={el:R,sx:g.clientX,sy:g.clientY,or:ee,ob:K},document.body.style.userSelect="none",ce(R),g.preventDefault(),g.stopPropagation()},s=g=>{if(!m)return;let R=g.clientX-m.sx,Y=g.clientY-m.sy,q=m.or-R,W=m.ob-Y,ee=m.el.getBoundingClientRect(),K=window.innerWidth,z=window.innerHeight,f=Math.max(8,K-ee.width-8),h=Math.max(8,z-ee.height-8);q=Math.min(Math.max(q,8),f),W=Math.min(Math.max(W,8),h),m.el.style.right=`${q}px`,m.el.style.bottom=`${W}px`},b=()=>{if(!m)return;document.body.style.userSelect="",u(m.el);let g=m.el,R=!1;j.forEach(Y=>{Y.el===g&&!R&&(ge(Y.id,g),R=!0)}),!R&&g===l&&M(),m=null},p=()=>b(),E=g=>{(g.key==="Alt"||g.key==="AltGraph")&&b()};window.addEventListener("mousedown",c,!0),window.addEventListener("mousemove",s,!0),window.addEventListener("mouseup",p,!0),window.addEventListener("keyup",E,!0)}function S(m){let k=b=>{if(!b||!(b instanceof HTMLElement))return!1;if(b instanceof HTMLTextAreaElement)return!0;if(b instanceof HTMLInputElement){let p=(b.type||"").toLowerCase();return p==="text"||p==="number"||p==="search"}return b.isContentEditable===!0},c=b=>{let p=b.target,E=document.activeElement,g=R=>!!(R&&(m.contains(R)||R.closest?.(".qws-win")||R.closest?.(".qws2")));(g(p)&&k(p)||g(E)&&k(E))&&(b.stopPropagation(),b.stopImmediatePropagation?.())},s=["keydown","keypress","keyup"];return s.forEach(b=>{window.addEventListener(b,c,{capture:!0}),document.addEventListener(b,c,{capture:!0}),m.addEventListener(b,c,{capture:!0})}),()=>{s.forEach(b=>{window.removeEventListener(b,c,{capture:!0}),document.removeEventListener(b,c,{capture:!0}),m.removeEventListener(b,c,{capture:!0})})}}let H=[],C=new Map;function F(m,k){let c=C.get(m);c&&(c.textContent=k?"Close":"Open",c.dataset.open=k?"1":"0",k?c.classList.add("active"):c.classList.remove("active"))}function ie(m,k,c){H.push({id:m,title:k,render:c}),de(m,k,c)}function de(m,k,c){let s=document.createElement("div");s.className="launch-item",s.innerHTML=`<div class="name">${Oe(k)}</div>`;let b=document.createElement("button");b.className="btn",b.textContent="Open",b.dataset.open="0",C.set(m,b),b.onclick=()=>{let p=j.get(m);p&&p.el.style.display!=="none"?(p.el.style.display="none",F(m,!1)):(U(m,k,E=>{let g=E.closest(".qws-win");g&&fe(m,g),c(E)}),F(m,!0))},s.appendChild(b),B.appendChild(s)}try{e?.onRegister?.(ie)}catch{}S(l),Te(),(async()=>{try{await Ie()}catch{}})(),setInterval(()=>{try{let m=V();I.textContent="OPEN",v.textContent="WS: OPEN",ue(I,"ok"),ue(v,"ok")}catch{let m=!!window.__QWS_workerFound||ot;I.textContent=m?"Worker":"none",v.textContent="WS: "+(m?"via Worker":"none"),ue(I,m?"ok":"warn"),ue(v,m?"ok":"warn")}try{let m=Ge(),k=en();m?(x.textContent=`store: ${k.via||"ready"}`,ue(x,"ok")):k.via==="polyfill"||k.polyfill?(x.textContent="store: polyfill",ue(x,"warn")):(x.textContent="store: none",ue(x,"bad"))}catch{x.textContent="store: error",ue(x,"bad")}},800);function V(){for(let m=0;m<he.length;m++)if(he[m].readyState===be.OPEN)return he[m];throw new Error("no page ws")}function ue(m,k){m.classList.remove("ok","warn","bad"),k&&m.classList.add(k)}function Oe(m){return m.replace(/[&<>"']/g,k=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[k])}}function qn(){(async()=>await J.startAbilityLogsWatcher())()}var Ae=class{constructor(t={}){this.opts=t;pe(this,"root");pe(this,"tabBar");pe(this,"views");pe(this,"tabs",new Map);pe(this,"events",new Map);pe(this,"currentId",null);pe(this,"lsKeyActive");this.lsKeyActive=`menu:${t.id||"default"}:activeTab`}mount(t){if(this.ensureStyles(),t.innerHTML="",this.root=Z("div",`qmm ${this.opts.classes||""} ${this.opts.compact?"qmm-compact":""}`),this.opts.startHidden&&(this.root.style.display="none"),this.tabBar=Z("div","qmm-tabs"),this.views=Z("div","qmm-views"),this.root.appendChild(this.tabBar),this.root.appendChild(this.views),t.appendChild(this.root),this.tabs.size){for(let[n,r]of this.tabs)this.createTabView(n,r);this.restoreActive()}this.updateTabsBarVisibility(),this.emit("mounted")}unmount(){this.root?.parentElement&&this.root.parentElement.removeChild(this.root),this.emit("unmounted")}setVisible(t){this.root&&(this.root.style.display=t?"":"none",this.emit(t?"show":"hide"))}toggle(){if(!this.root)return!1;let t=this.root.style.display==="none";return this.setVisible(t),t}addTab(t,n,r){return this.tabs.set(t,{title:n,render:r,badge:null}),this.root&&(this.createTabView(t,this.tabs.get(t)),this.updateTabsBarVisibility()),this}addTabs(t){return t.forEach(n=>this.addTab(n.id,n.title,n.render)),this}setTabTitle(t,n){let r=this.tabs.get(t);if(r&&(r.title=n,r.btn)){let a=r.btn.querySelector(".label");a&&(a.textContent=n)}}setTabBadge(t,n){let r=this.tabs.get(t);!r||!r.btn||(r.badge||(r.badge=document.createElement("span"),r.badge.className="badge",r.btn.appendChild(r.badge)),n==null||n===""?r.badge.style.display="none":(r.badge.textContent=n,r.badge.style.display=""))}refreshTab(t){let n=this.tabs.get(t);if(!n?.view)return;let r=this.findScrollableAncestor(n.view),a=r?r.scrollTop:null,i=r?r.scrollLeft:null,o=document.activeElement?.id||null;n.view.innerHTML="";try{n.render(n.view,this)}catch(l){n.view.textContent=String(l)}this.currentId===t&&this.switchTo(t),this.emit("tab:render",t),r&&a!=null&&requestAnimationFrame(()=>{try{r.scrollTop=a,r.scrollLeft=i??0}catch{}if(o){let l=document.getElementById(o);if(l&&l.focus)try{l.focus()}catch{}}})}findScrollableAncestor(t){function n(a){let i=getComputedStyle(a),o=i.overflowY||i.overflow;return/(auto|scroll)/.test(o)&&a.scrollHeight>a.clientHeight}let r=t;for(;r;){if(n(r))return r;r=r.parentElement}return document.querySelector(".qws-win")}firstTabId(){let t=this.tabs.keys().next();return t.done?null:t.value??null}getTabView(t){return this.tabs.get(t)?.view??null}removeTab(t){let n=this.tabs.get(t);if(!n)return;this.tabs.delete(t);let r=this.tabBar?.querySelector(`button[data-id="${Bn(t)}"]`);if(r&&r.parentElement&&r.parentElement.removeChild(r),n.view&&n.view.parentElement&&n.view.parentElement.removeChild(n.view),this.currentId===t){let a=this.tabs.keys().next().value||null;this.switchTo(a)}this.updateTabsBarVisibility()}switchTo(t){this.currentId=t,[...this.tabBar.children].forEach(n=>n.classList.toggle("active",n.dataset.id===t||t===null)),[...this.views.children].forEach(n=>n.classList.toggle("active",n.dataset.id===t||t===null)),this.persistActive(),this.emit("tab:change",t)}on(t,n){return this.events.has(t)||this.events.set(t,new Set),this.events.get(t).add(n),()=>this.off(t,n)}off(t,n){this.events.get(t)?.delete(n)}emit(t,...n){this.events.get(t)?.forEach(r=>{try{r(...n)}catch{}})}btn(t,n){let r=Z("button","qmm-btn",`<span class="label">${xt(t)}</span>`);return r.onclick=n,r}label(t){let n=Z("label","qmm-label");return n.textContent=t,n}row(...t){let n=Z("div","qmm-row");return t.forEach(r=>n.appendChild(r)),n}section(t){let n=Z("div","qmm-section");return n.appendChild(Z("div","qmm-section-title",xt(t))),n}inputNumber(t=0,n=9999,r=1,a=0){let i=Z("div","qmm-input-number"),o=Z("input","qmm-input qmm-input-number-input");o.type="number",o.min=String(t),o.max=String(n),o.step=String(r),o.value=String(a),o.inputMode="numeric";let l=Z("div","qmm-spin"),u=Z("button","qmm-step qmm-step--up","\u25B2"),d=Z("button","qmm-step qmm-step--down","\u25BC");u.type=d.type="button";let y=()=>{let L=Number(o.value);if(Number.isFinite(L)){let w=Number(o.min),T=Number(o.max),I=Math.max(w,Math.min(T,L));I!==L&&(o.value=String(I))}},P=L=>{L<0?o.stepDown():o.stepUp(),y(),o.dispatchEvent(new Event("input",{bubbles:!0})),o.dispatchEvent(new Event("change",{bubbles:!0}))},M=(L,w)=>{let T=null,I=null,v=!1,x=D=>{v=!1,T=window.setTimeout(()=>{v=!0,P(w),I=window.setInterval(()=>P(w),60)},300),L.setPointerCapture?.(D.pointerId)},B=()=>{T!=null&&(clearTimeout(T),T=null),I!=null&&(clearInterval(I),I=null)};L.addEventListener("pointerdown",x),["pointerup","pointercancel","pointerleave","blur"].forEach(D=>L.addEventListener(D,B)),L.addEventListener("click",D=>{if(v){D.preventDefault(),D.stopPropagation(),v=!1;return}P(w)})};return M(u,1),M(d,-1),o.addEventListener("change",y),l.append(u,d),i.append(o,l),o.wrap=i,o}inputText(t="",n=""){let r=Z("input","qmm-input");return r.type="text",r.placeholder=t,r.value=n,r}checkbox(t=!1){let n=Z("input","qmm-check");return n.type="checkbox",n.checked=t,n}radio(t,n,r=!1){let a=Z("input","qmm-radio");return a.type="radio",a.name=t,a.value=n,a.checked=r,a}slider(t=0,n=100,r=1,a=0){let i=Z("input","qmm-range");return i.type="range",i.min=String(t),i.max=String(n),i.step=String(r),i.value=String(a),i}switch(t=!1){let n=this.checkbox(t);return n.classList.add("qmm-switch"),n}table(t,n){let r=document.createElement("div");r.className="qmm-table-wrap",n?.minimal&&r.classList.add("qmm-table-wrap--minimal");let a=document.createElement("div");a.className="qmm-table-scroll",n?.maxHeight&&(a.style.maxHeight=n.maxHeight),r.appendChild(a);let i=document.createElement("table");i.className="qmm-table",n?.minimal&&i.classList.add("qmm-table--minimal"),n?.compact&&i.classList.add("qmm-table--compact"),n?.fixed&&(i.style.tableLayout="fixed");let o=document.createElement("thead"),l=document.createElement("tr");t.forEach(d=>{let y=document.createElement("th");typeof d=="string"?y.textContent=d:(y.textContent=d.label??"",d.align&&y.classList.add(`is-${d.align}`),d.width&&(y.style.width=d.width)),l.appendChild(y)}),o.appendChild(l);let u=document.createElement("tbody");return i.append(o,u),a.appendChild(i),{root:r,tbody:u}}radioGroup(t,n,r,a){let i=Z("div","qmm-radio-group");for(let{value:o,label:l}of n){let u=this.radio(t,o,r===o),d=document.createElement("label");d.className="qmm-radio-label",d.appendChild(u),d.appendChild(document.createTextNode(l)),u.onchange=()=>{u.checked&&a(o)},i.appendChild(d)}return i}bindLS(t,n,r,a,i){try{let o=localStorage.getItem(t);o!=null&&r(a(o))}catch{}return{save:()=>{try{localStorage.setItem(t,i(n()))}catch{}}}}split2(t="260px"){let n=Z("div","qmm-split");n.style.gridTemplateColumns="minmax(160px, max-content) 1fr";let r=Z("div","qmm-split-left"),a=Z("div","qmm-split-right");return n.appendChild(r),n.appendChild(a),{root:n,left:r,right:a}}vtabs(t={}){return new Yt(this,t)}createTabView(t,n){let r=document.createElement("button");r.className="qmm-tab",r.dataset.id=t,r.innerHTML=`<span class="label">${xt(n.title)}</span><span class="badge" style="display:none"></span>`;let a=r.querySelector(".badge");n.btn=r,n.badge=a,r.onclick=()=>this.switchTo(t),this.tabBar.appendChild(r);let i=Z("div","qmm-view");i.dataset.id=t,n.view=i,this.views.appendChild(i);try{n.render(i,this)}catch(o){i.textContent=String(o)}this.currentId||this.switchTo(t)}persistActive(){if(this.currentId)try{localStorage.setItem(this.lsKeyActive,this.currentId)}catch{}}restoreActive(){let t=null;try{t=localStorage.getItem(this.lsKeyActive)}catch{}t&&this.tabs.has(t)?this.switchTo(t):this.tabs.size&&this.switchTo(this.firstTabId())}updateTabsBarVisibility(){if(!this.tabBar||!this.root)return;this.tabs.size>0?(this.tabBar.parentElement||this.root.insertBefore(this.tabBar,this.views),this.tabBar.style.display="flex",this.root.classList.remove("qmm-no-tabs")):(this.tabBar.parentElement&&this.tabBar.parentElement.removeChild(this.tabBar),this.root.classList.add("qmm-no-tabs"))}ensureStyles(){if(document.getElementById("__qmm_css__"))return;let t=`
    /* ================= Modern UI for qmm ================= */
.qmm{
  --qmm-bg:        #0f1318;
  --qmm-bg-soft:   #0b0f13;
  --qmm-panel:     #111823cc;
  --qmm-border:    #ffffff22;
  --qmm-border-2:  #ffffff14;
  --qmm-accent:    #7aa2ff;
  --qmm-accent-2:  #92b2ff;
  --qmm-text:      #e7eef7;
  --qmm-text-dim:  #b9c3cf;
  --qmm-shadow:    0 6px 20px rgba(0,0,0,.35);
  --qmm-blur:      8px;

  display:flex; flex-direction:column; gap:10px; color:var(--qmm-text);
}
.qmm-compact{ gap:6px }

/* ---------- Tabs (pill + underline) ---------- */
.qmm-tabs{
  display:flex; gap:6px; flex-wrap:wrap; align-items:flex-end;
  padding:0 6px 2px 6px; position:relative; isolation:isolate;
  border-bottom:1px solid var(--qmm-border);
  background:linear-gradient(180deg, rgba(255,255,255,.04), transparent);
  border-top-left-radius:10px; border-top-right-radius:10px;
}
.qmm-no-tabs .qmm-views{ margin-top:0 }

.qmm-tab{
  flex:1 1 0; min-width:0; cursor:pointer;
  display:inline-flex; justify-content:center; align-items:center; gap:8px;
  padding:8px 12px; color:var(--qmm-text);
  background:transparent; border:1px solid transparent; border-bottom:none;
  border-top-left-radius:10px; border-top-right-radius:10px;
  position:relative; margin:0; margin-bottom:-1px;
  transition:background .18s ease, color .18s ease, box-shadow .18s ease, transform .12s ease;
}
.qmm-compact .qmm-tab{ padding:6px 10px }
.qmm-tab:hover{ background:rgba(255,255,255,.06) }
.qmm-tab:active{ transform:translateY(1px) }
.qmm-tab:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; border-radius:10px }

.qmm-tab .badge{
  font-size:11px; line-height:1; padding:2px 6px; border-radius:999px;
  background:#ffffff1a; border:1px solid #ffffff22;
}

.qmm-tab.active{
  background:linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
  color:#fff; box-shadow:inset 0 -1px 0 #0007;
}
.qmm-tab.active::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-1px; height:2px;
  background:linear-gradient(90deg, transparent, var(--qmm-accent), transparent);
  border-radius:2px; box-shadow:0 0 12px var(--qmm-accent-2);
}

/* ---------- Views panel ---------- */
.qmm-views{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  display:flex; flex-direction:column;
  min-width:0; min-height:0; overflow:auto; box-shadow:var(--qmm-shadow);
}
.qmm-compact .qmm-views{ padding:8px }
.qmm-tabs + .qmm-views{ margin-top:-1px }

.qmm-view{ display:none; min-width:0; min-height:0; }
.qmm-view.active{ display:block; }

/* ---------- Basic controls ---------- */
.qmm-row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin:6px 0 }
.qmm-section{ margin-top:8px }
.qmm-section-title{ font-weight:650; margin:2px 0 8px 0; color:var(--qmm-text) }

.qmm-label{ opacity:.9 }
.qmm-val{ min-width:24px; text-align:center }

/* Buttons */
.qmm-btn{
  cursor:pointer; border-radius:10px; border:1px solid var(--qmm-border);
  padding:8px 12px; background:linear-gradient(180deg, #ffffff10, #ffffff06);
  color:#fff; box-shadow:0 1px 0 #000 inset, 0 1px 16px rgba(0,0,0,.2);
  transition:transform .1s ease, box-shadow .18s ease, background .18s ease, border-color .18s ease;
}
.qmm-compact .qmm-btn{ padding:6px 10px }
.qmm-btn:hover{ background:linear-gradient(180deg, #ffffff16, #ffffff08); border-color:#ffffff40 }
.qmm-btn:active{ transform:translateY(1px) }
.qmm-btn:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px; }

/* Button variants (optional utility) */
.qmm-btn.qmm-primary{ background:linear-gradient(180deg, rgba(122,162,255,.35), rgba(122,162,255,.15)); border-color:#9db7ff55 }
.qmm-btn.qmm-danger{  background:linear-gradient(180deg, rgba(255,86,86,.28), rgba(255,86,86,.12));  border-color:#ff6a6a55 }
.qmm-btn.active{
  background:#79a6ff22;
  border-color:#79a6ff66;
  box-shadow: inset 0 0 0 1px #79a6ff33;
}

/* Inputs */
.qmm-input{
  min-width:90px; background:rgba(0,0,0,.42); color:#fff;
  border:1px solid var(--qmm-border); border-radius:10px;
  padding:8px 10px; box-shadow:inset 0 1px 0 rgba(255,255,255,.06);
  transition:border-color .18s ease, background .18s ease, box-shadow .18s ease;
}
.qmm-input::placeholder{ color:#cbd6e780 }
.qmm-input:focus{ outline:none; border-color:var(--qmm-accent); background:#0f1521; box-shadow:0 0 0 2px #7aa2ff33 }

/* Number input + spinner (unchanged API) */
.qmm-input-number{ display:inline-flex; align-items:center; gap:6px }
.qmm-input-number-input{ width:70px; text-align:center; padding-right:8px }
.qmm-spin{ display:inline-flex; flex-direction:column; gap:2px }
.qmm-step{
  width:22px; height:16px; font-size:11px; line-height:1;
  display:inline-flex; align-items:center; justify-content:center;
  border-radius:6px; border:1px solid var(--qmm-border);
  background:rgba(255,255,255,.08); color:#fff; cursor:pointer; user-select:none;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-step:hover{ background:#ffffff18; border-color:#ffffff40 }
.qmm-step:active{ transform:translateY(1px) }

/* Switch (checkbox) */
.qmm-switch{
  appearance:none; width:42px; height:24px; background:#6c7488aa; border-radius:999px;
  position:relative; outline:none; cursor:pointer; transition:background .18s ease, box-shadow .18s ease;
  box-shadow:inset 0 1px 0 rgba(255,255,255,.12);
}
.qmm-switch::before{
  content:""; position:absolute; top:2px; left:2px; width:20px; height:20px;
  background:#fff; border-radius:50%; transition:transform .2s ease;
  box-shadow:0 2px 8px rgba(0,0,0,.35);
}
.qmm-switch:checked{ background:linear-gradient(180deg, rgba(122,162,255,.9), rgba(122,162,255,.6)) }
.qmm-switch:checked::before{ transform:translateX(18px) }
.qmm-switch:focus-visible{ outline:2px solid var(--qmm-accent); outline-offset:2px }

/* Checkbox & radio (native inputs skinned lightly) */
.qmm-check, .qmm-radio{ transform:scale(1.1); accent-color: var(--qmm-accent) }

/* Slider */
.qmm-range{
  width:180px; appearance:none; background:transparent; height:22px;
}
.qmm-range:focus{ outline:none }
.qmm-range::-webkit-slider-runnable-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-moz-range-track{
  height:6px; background:linear-gradient(90deg, var(--qmm-accent), #7aa2ff44);
  border-radius:999px; box-shadow:inset 0 1px 0 rgba(255,255,255,.14);
}
.qmm-range::-webkit-slider-thumb{
  appearance:none; width:16px; height:16px; border-radius:50%; margin-top:-5px;
  background:#fff; box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
  transition:transform .1s ease;
}
.qmm-range:active::-webkit-slider-thumb{ transform:scale(1.04) }
.qmm-range::-moz-range-thumb{
  width:16px; height:16px; border-radius:50%; background:#fff; border:none;
  box-shadow:0 2px 10px rgba(0,0,0,.35), 0 0 0 2px #ffffff66 inset;
}

/* ---------- Minimal table ---------- */
/* container */
.qmm-table-wrap--minimal{
  border:1px solid #263040; border-radius:8px; background:#0b0f14; box-shadow:none;
}
/* scroller (height cap) */
.qmm-table-scroll{
  overflow:auto; max-height:44vh; /* override via opts.maxHeight */
}

/* base */
.qmm-table--minimal{
  width:100%;
  border-collapse:collapse;
  background:transparent;
  font-size:13px; line-height:1.35; color:var(--qmm-text, #cdd6e3);
}

/* header */
.qmm-table--minimal thead th{
  position:sticky; top:0; z-index:1;
  text-align:left; font-weight:600;
  padding:8px 10px;
  color:#cbd5e1; background:#0f1318;
  border-bottom:1px solid #263040;
  text-transform:none; letter-spacing:0;
}
.qmm-table--minimal thead th.is-center { text-align: center; }
.qmm-table--minimal thead th.is-left   { text-align: left; }   /* d\xE9j\xE0 pr\xE9sent, ok */
.qmm-table--minimal thead th.is-right  { text-align: right; }
.qmm-table--minimal thead th,
.qmm-table--minimal td { vertical-align: middle; }

/* cells */
.qmm-table--minimal td{
  padding:8px 10px; border-bottom:1px solid #1f2937; vertical-align:middle;
}
.qmm-table--minimal tbody tr:hover{ background:#0f1824; }

/* compact variant */
.qmm-table--compact thead th,
.qmm-table--compact td{ padding:6px 8px; font-size:12px }

/* utils */
.qmm-table--minimal td.is-num{ text-align:right; font-variant-numeric:tabular-nums }
.qmm-table--minimal td.is-center{ text-align:center }
.qmm-ellipsis{ overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
.qmm-prewrap{ white-space:pre-wrap; word-break:break-word }


/* ---------- Split panels ---------- */
.qmm-split{
  display:grid; gap:12px;
  grid-template-columns:minmax(180px,260px) minmax(0,1fr);
  align-items:start;
}
.qmm-split-left{ display:flex; flex-direction:column; gap:10px }
.qmm-split-right{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  display:flex; flex-direction:column; gap:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur));
  box-shadow:var(--qmm-shadow);
}

/* ---------- VTabs (vertical list + filter) ---------- */
.qmm-vtabs{ display:flex; flex-direction:column; gap:8px; min-width:0 }
.qmm-vtabs .filter{ display:block }
.qmm-vtabs .filter input{ width:100% }

.qmm-vlist{
  flex:0 0 auto; overflow:visible;
  border:1px solid var(--qmm-border); border-radius:12px; padding:6px;
  background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  box-shadow:inset 0 1px 0 rgba(255,255,255,.04);
}

.qmm-vtab{
  width:100%; text-align:left; cursor:pointer;
  display:grid; grid-template-columns:28px 1fr auto; align-items:center; gap:10px;
  padding:8px 10px; border-radius:10px; border:1px solid #ffffff18;
  background:rgba(255,255,255,.03); color:inherit;
  transition:background .18s ease, border-color .18s ease, transform .08s ease;
}
.qmm-vtab:hover{ background:rgba(255,255,255,.07); border-color:#ffffff34 }
.qmm-vtab:active{ transform:translateY(1px) }
.qmm-vtab.active{
  background:linear-gradient(180deg, rgba(122,162,255,.18), rgba(122,162,255,.08));
  border-color:#9db7ff55;
  box-shadow:0 1px 14px rgba(122,162,255,.18) inset;
}

.qmm-dot{ width:10px; height:10px; border-radius:50%; justify-self:center; box-shadow:0 0 0 1px #0006 inset }
.qmm-chip{ display:flex; align-items:center; gap:8px; min-width:0 }
.qmm-chip img{
  width:20px; height:20px; border-radius:50%; object-fit:cover; border:1px solid #4446;
  box-shadow:0 1px 0 rgba(255,255,255,.08) inset;
}
.qmm-chip .t{ white-space:nowrap; overflow:hidden; text-overflow:ellipsis }
.qmm-tag{
  font-size:11px; line-height:1; padding:3px 7px; border-radius:999px;
  background:#ffffff14; border:1px solid #ffffff26;
}

/* ---------- Small helpers (optional) ---------- */
.qmm .qmm-card{
  border:1px solid var(--qmm-border); border-radius:12px; padding:12px;
  background:var(--qmm-panel); backdrop-filter:blur(var(--qmm-blur)); box-shadow:var(--qmm-shadow);
}
  .qmm .qmm-help{ font-size:12px; color:var(--qmm-text-dim) }
  .qmm .qmm-sep{ height:1px; background:var(--qmm-border); width:100%; opacity:.6; }

/* ta poign\xE9e, inchang\xE9 */
.qmm-grab { margin-left:auto; opacity:.8; cursor:grab; user-select:none; }
.qmm-grab:active { cursor:grabbing; }
.qmm-dragging { opacity:.6; }

/* items animables */
.qmm-team-item {
  will-change: transform;
  transition: transform 160ms ease;
}
.qmm-team-item.drag-ghost {
  opacity: .4;
}



    `,n=document.createElement("style");n.id="__qmm_css__",n.textContent=t,(document.documentElement||document.body).appendChild(n)}},Yt=class{constructor(t,n={}){this.api=t;this.opts=n;pe(this,"root");pe(this,"filterWrap",null);pe(this,"filterInput",null);pe(this,"list");pe(this,"items",[]);pe(this,"selectedId",null);pe(this,"onSelectCb");pe(this,"renderItemCustom");pe(this,"emptyText");this.root=Z("div","qmm-vtabs"),this.root.style.minWidth="0",this.emptyText=n.emptyText||"Aucun \xE9l\xE9ment.",this.renderItemCustom=n.renderItem,n.filterPlaceholder&&(this.filterWrap=Z("div","filter"),this.filterInput=document.createElement("input"),this.filterInput.type="search",this.filterInput.placeholder=n.filterPlaceholder,this.filterInput.className="qmm-input",this.filterInput.oninput=()=>this.renderList(),this.filterWrap.appendChild(this.filterInput),this.root.appendChild(this.filterWrap)),this.list=Z("div","qmm-vlist"),this.list.style.minWidth="0",n.maxHeightPx&&(this.list.style.maxHeight=`${n.maxHeightPx}px`,this.list.style.overflow="auto",this.list.style.flex="1 1 auto"),this.root.appendChild(this.list),this.selectedId=n.initialId??null,this.onSelectCb=n.onSelect}setItems(t){this.items=Array.isArray(t)?t.slice():[],this.selectedId&&!this.items.some(n=>n.id===this.selectedId)&&(this.selectedId=this.items[0]?.id??null),this.renderList()}getSelected(){return this.items.find(t=>t.id===this.selectedId)??null}select(t){this.selectedId=t,this.renderList(),this.onSelectCb?.(this.selectedId,this.getSelected())}onSelect(t){this.onSelectCb=t}setBadge(t,n){let r=this.list.querySelector(`button[data-id="${Bn(t)}"]`);if(!r)return;let a=r.querySelector(".qmm-tag");!a&&n!=null&&(a=Z("span","qmm-tag"),r.appendChild(a)),a&&(n==null||n===""?a.style.display="none":(a.textContent=n,a.style.display=""))}getFilter(){return(this.filterInput?.value||"").trim().toLowerCase()}renderList(){let t=this.list.scrollTop;this.list.innerHTML="";let n=this.getFilter(),r=n?this.items.filter(i=>(i.title||"").toLowerCase().includes(n)||(i.subtitle||"").toLowerCase().includes(n)):this.items;if(!r.length){let i=document.createElement("div");i.style.opacity="0.75",i.textContent=this.emptyText,this.list.appendChild(i);return}let a=document.createElement("ul");a.style.listStyle="none",a.style.margin="0",a.style.padding="0",a.style.display="flex",a.style.flexDirection="column",a.style.gap="4px";for(let i of r){let o=document.createElement("li"),l=document.createElement("button");if(l.className="qmm-vtab",l.dataset.id=i.id,l.disabled=!!i.disabled,this.renderItemCustom)this.renderItemCustom(i,l);else{let u=Z("div","qmm-dot");u.style.background=i.statusColor||"#999a";let d=Z("div","qmm-chip"),y=document.createElement("img");y.src=i.avatarUrl||"",y.alt=i.title;let P=document.createElement("div");P.style.display="flex",P.style.flexDirection="column",P.style.gap="2px";let M=Z("div","t");M.textContent=i.title;let L=document.createElement("div");if(L.textContent=i.subtitle||"",L.style.opacity="0.7",L.style.fontSize="12px",i.subtitle||(L.style.display="none"),P.appendChild(M),P.appendChild(L),d.appendChild(y),d.appendChild(P),l.appendChild(u),l.appendChild(d),i.badge!=null){let w=Z("span","qmm-tag",xt(String(i.badge)));l.appendChild(w)}else{let w=document.createElement("div");w.style.width="0",l.appendChild(w)}}l.classList.toggle("active",i.id===this.selectedId),l.onclick=()=>this.select(i.id),o.appendChild(l),a.appendChild(o)}this.list.appendChild(a),this.list.scrollTop=t}};function Z(e,t,n){let r=document.createElement(e);return t&&(r.className=t),n!=null&&(r.innerHTML=n),r}function Bn(e){return e.replace(/"/g,'\\"')}function xt(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}var zt=e=>{let t=new Date(e),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(t.getHours())}:${n(t.getMinutes())}:${n(t.getSeconds())}.${String(t.getMilliseconds()).padStart(3,"0")}`},Ir=e=>e.replace(/[<>&]/g,t=>({"<":"&lt;",">":"&gt;","&":"&amp;"})[t]),Vt=class{constructor(t=2e3){this.max=t;pe(this,"arr",[])}push(t){this.arr.push(t),this.arr.length>this.max&&this.arr.splice(0,this.arr.length-this.max)}toArray(){return this.arr.slice()}clear(){this.arr.length=0}},Ue=new Map,Hn=!1;function Cr(e){Hn?he.forEach(t=>{Ue.has(t)||Ut(t,"late",e)}):(window.WebSocket===be&&(window.WebSocket=new Proxy(be,{construct(t,n,r){let a=Reflect.construct(t,n,r);return Ut(a,"new",e),a}})),he.forEach(t=>Ut(t,"existing",e)),Hn=!0)}function Ut(e,t,n){if(Ue.has(e))return;let r=`WS#${1+Ue.size} (${lt(e.readyState)})`,a={ws:e,id:r,listeners:[]};he.includes(e)||he.push(e),Be?.(e,t);let i=u=>{let d="";try{d=typeof u.data=="string"?u.data:JSON.stringify(u.data)}catch{d=String(u.data)}n({t:Date.now(),dir:"in",text:d,ws:e})};e.addEventListener("message",i),a.listeners.push(()=>e.removeEventListener("message",i));let o=()=>{a.id=a.id.replace(/\(.*\)/,`(${lt(e.readyState)})`)},l=()=>{a.id=a.id.replace(/\(.*\)/,`(${lt(e.readyState)})`)};if(e.addEventListener("open",o),e.addEventListener("close",l),a.listeners.push(()=>e.removeEventListener("open",o)),a.listeners.push(()=>e.removeEventListener("close",l)),!a.sendOrig){let u=e.send.bind(e);a.sendOrig=u,e.send=d=>{try{let y=typeof d=="string"?d:JSON.stringify(d);n({t:Date.now(),dir:"out",text:y,ws:e})}catch{n({t:Date.now(),dir:"out",text:String(d),ws:e})}return u(d)}}Ue.set(e,a)}async function Wn(e){let t=new Ae({id:"debug-tools",compact:!0});t.mount(e),t.addTab("jotai","Jotai",n=>Er(n,t)),t.addTab("websocket","WebSocket",n=>Mr(n,t))}function Er(e,t){e.innerHTML="";let n=t.section("Store"),r=t.btn("Capture store",async()=>{try{await Ie()}catch{}a.textContent=`captured: ${String(Ge())}`,d({capture:Ge()})}),a=t.label(`captured: ${String(Ge())}`);n.appendChild(t.row(r,a)),e.appendChild(n);let i=document.createElement("div");i.style.display="grid",i.style.gridTemplateColumns="repeat(auto-fit, minmax(280px, 1fr))",i.style.gap="12px",e.appendChild(i);{let T=t.section("Find / List atoms"),I=t.inputText("regex label (eg: position|health)",""),v=t.btn("List",()=>D()),x=t.btn("Copy",()=>M(B.textContent||"")),B=document.createElement("pre");w(B);async function D(){let j=I.value.trim(),$=L(j||".*"),X=Ve(/.*/).filter(ce=>$.test(String(ce?.debugLabel||ce?.label||""))).map(ce=>String(ce?.debugLabel||ce?.label||"<?>"));B.textContent=X.join(`
`),d({list:{query:j||".*",count:X.length}})}T.appendChild(t.row(I,v,x)),T.appendChild(B),i.appendChild(T)}{let T=t.section("Get / Subscribe"),I=t.inputText("atom label (eg: positionAtom)",""),v=t.btn("Get",async()=>{let $=oe(I.value.trim());if(!$){D.textContent=`Atom "${I.value}" not found`;return}try{y(D,await ve($)),d({get:{label:I.value,ok:!0}})}catch(U){y(D,U?.message||String(U)),d({get:{label:I.value,ok:!1,error:U?.message}})}}),x=t.btn("Subscribe",async()=>{let $=I.value.trim();if(!$)return;let U=oe($);if(!U)return d(`Atom "${$}" not found`);if(j){j(),j=null,x.textContent="Subscribe",d({sub:{label:$,status:"unsubscribed"}});return}j=await $e(U,async()=>{try{y(D,await ve(U))}catch{}}),x.textContent="Unsubscribe",d({sub:{label:$,status:"subscribed"}})}),B=t.btn("Copy",()=>M(D.textContent||"")),D=document.createElement("pre");w(D);let j=null;T.appendChild(t.row(I,v,x,B)),T.appendChild(D),i.appendChild(T)}{let T=t.section("Set atom"),I=t.inputText("atom label (eg: activeModalAtom)",""),v=t.btn("Set",async()=>{let D=I.value.trim(),j=oe(D);if(!j)return d(`Atom "${D}" not found`);let $;try{$=JSON.parse(B.value)}catch{return P("Invalid JSON")}try{await xe(j,$),d({set:{label:D,ok:!0}})}catch(U){d({set:{label:D,ok:!1,error:U?.message}})}}),x=t.btn("Copy json",()=>M(B.value)),B=document.createElement("textarea");B.className="qmm-input",B.style.minHeight="120px",B.style.width="100%",B.placeholder='JSON value, eg: "inventory" or { "x": 1, "y": 2 }',T.appendChild(t.row(I,v,x)),T.appendChild(B),i.appendChild(T)}let o=t.section("Output"),l=t.row(t.label("\u2014"),(()=>{let T=document.createElement("div");return T.style.flex="1",T})(),t.btn("Copy",()=>M(u.textContent||"")),t.btn("Clear",()=>u.textContent="")),u=document.createElement("pre");w(u),o.appendChild(l),o.appendChild(u),e.appendChild(o);function d(T){let I=zt(Date.now());try{u.textContent+=`[${I}] ${JSON.stringify(T)}
`}catch{u.textContent+=`[${I}] ${String(T)}
`}u.scrollTop=u.scrollHeight}function y(T,I){T.textContent=typeof I=="string"?I:JSON.stringify(I,null,2)}function P(T){try{window.toastSimple?.(T,"","warn")}catch{}}function M(T){let I=String(T??"");if(!I.length)return;let v=()=>{let x=document.createElement("textarea");x.value=I,x.setAttribute("readonly","true"),x.style.position="fixed",x.style.left="-9999px",x.style.opacity="0",document.body.appendChild(x),x.focus(),x.select();let B=!1;try{B=document.execCommand("copy")}catch{}document.body.removeChild(x);try{window.toastSimple?.(B?"Copied":"Copy failed","",B?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(I).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(v):v()}function L(T){try{return new RegExp(T,"i")}catch{return/.*/i}}function w(T){T.style.maxHeight="260px",T.style.overflow="auto",T.style.background="#0f1318",T.style.border="1px solid #ffffff14",T.style.borderRadius="8px",T.style.padding="8px",T.style.margin="6px 0",T.style.fontSize="12px",T.style.color="#e7eef7"}}function Mr(e,t){e.innerHTML="";let n=new Vt(2e3),r=new Map,a=0,i=!1,o=!0,l=!0,u=!0,d="",y=!1,P=!1,M=null,L=[],w=()=>{let f=document.createElement("div");return f.style.flex="1",f},T=f=>{if(M=f,[...V.querySelectorAll("[data-fid]")].forEach(h=>{h.classList.toggle("selected",String(f||"")===h.dataset.fid)}),f!=null){let h=r.get(f);h&&(m.value=h.text)}},I=f=>L.some(h=>h.test(f));function v(f){let h=String(f??"");if(!h.length)return;let O=()=>{let N=document.createElement("textarea");N.value=h,N.setAttribute("readonly","true"),N.style.position="fixed",N.style.left="-9999px",N.style.opacity="0",document.body.appendChild(N),N.focus(),N.select();let G=!1;try{G=document.execCommand("copy")}catch{}document.body.removeChild(N);try{window.toastSimple?.(G?"Copied":"Copy failed","",G?"success":"error")}catch{}};window.isSecureContext&&navigator.clipboard?.writeText?navigator.clipboard.writeText(h).then(()=>{try{window.toastSimple?.("Copied","","success")}catch{}}).catch(O):O()}let x=t.section("Live log"),B=t.label("\u2014"),D=t.checkbox(!0);D.addEventListener("change",()=>{l=D.checked,W(!0)});let j=t.checkbox(!0);j.addEventListener("change",()=>{u=j.checked,W(!0)});let $=t.inputText("filter text (case-insensitive)","");$.addEventListener("input",()=>{d=$.value.trim().toLowerCase(),W(!0)});let U=t.checkbox(!1);U.addEventListener("change",()=>{y=U.checked,W(!0)});let le=t.btn("Pause",()=>{i=!i,le.textContent=i?"Resume":"Pause"}),X=t.btn("Clear",()=>{n.clear(),r.clear(),T(null),W(!0)}),ce=t.btn("Copy visible",()=>ee());x.appendChild(t.row(B,w(),D,t.label("IN"),j,t.label("OUT"),$,U,t.label("Current socket only"),le,X,ce)),e.appendChild(x);let ge=t.section("Mutes (exclude by regex)"),fe=t.inputText("add regex (e.g. ping|keepalive)",""),Te=t.btn("Add",()=>{let f=fe.value.trim();if(f)try{L.push(new RegExp(f,"i")),fe.value="",H(),W(!0)}catch{}}),S=document.createElement("div");S.style.display="flex",S.style.flexWrap="wrap",S.style.gap="6px";function H(){S.innerHTML="",L.forEach((f,h)=>{let O=document.createElement("button");O.className="qmm-btn",O.textContent=`/${f.source}/i \xD7`,O.title="Remove",O.onclick=()=>{L.splice(h,1),H(),W(!0)},S.appendChild(O)})}ge.appendChild(t.row(fe,Te)),ge.appendChild(S),e.appendChild(ge);let C=t.section("Sockets"),F=document.createElement("select");F.className="qmm-input",F.style.minWidth="260px",C.appendChild(F),e.appendChild(C);function ie(){let f=Array.from(Ue.values());F.innerHTML="",f.forEach((h,O)=>{let N=document.createElement("option");N.value=String(O),N.textContent=h.id+(h.ws===qe?" \u2022 page":""),F.appendChild(N)}),!F.value&&F.options.length&&(F.value="0"),B.textContent=E()}function de(){let f=Number(F.value),h=Array.from(Ue.values());return Number.isFinite(f)?h[f]?.ws??null:null}let V=document.createElement("div");V.style.border="1px solid #ffffff14",V.style.borderRadius="10px",V.style.background="#0f1318",V.style.padding="6px",V.style.maxHeight="46vh",V.style.overflow="auto",V.style.fontFamily="ui-monospace, SFMono-Regular, Menlo, Consolas, monospace",V.style.fontSize="12px",V.style.lineHeight="1.3",V.style.userSelect="text";let ue=document.createElement("style");ue.textContent=`
    .ws-row{display:grid;grid-template-columns:92px 18px 1fr auto;gap:8px;padding:3px 4px;border-bottom:1px dashed #ffffff12;align-items:start}
    .ws-row .ts{opacity:.8}
    .ws-row .arrow{font-weight:600}
    .ws-row .body{white-space:pre-wrap;word-break:break-word}
    .ws-row .acts{display:none;gap:6px}
    .ws-row:hover .acts{display:flex}
    .ws-row.selected{background:rgba(120,160,255,.12)}
    .ws-row .chip{border:1px solid #ffffff26;background:#ffffff14;border-radius:6px;padding:2px 6px;cursor:pointer}
  `,V.appendChild(ue),e.appendChild(V);let Oe=t.section("Send"),m=document.createElement("textarea");m.className="qmm-input",m.style.width="100%",m.style.minHeight="120px",m.placeholder="Select a frame or paste a payload here. Choose Text or JSON below.";let k=t.radioGroup("ws-send-mode",[{value:"text",label:"Text"},{value:"json",label:"JSON"}],"text",()=>{}),c=t.checkbox(!1);c.addEventListener("change",()=>{P=c.checked});let s=t.btn("Send",()=>z()),b=t.btn("Copy payload",()=>v(m.value));Oe.appendChild(m),Oe.appendChild(t.row(k,c,t.label("Use source WS"),s,b)),e.appendChild(Oe),Cr(f=>{if(i)return;let h={...f,id:++a};n.push(h),r.set(h.id,h),B.textContent=E(),q(h)}),ie(),W(!0);let p=window.setInterval(()=>{ie()},1e3);e.__ws_cleanup__=()=>{window.clearInterval(p)};function E(){return`status: ${he.some(O=>O.readyState===WebSocket.OPEN)?"OPEN":"none"} \u2022 mode: ${ot?"worker":"page/auto"}`}function g(f){return!(f.dir==="in"&&!l||f.dir==="out"&&!u||d&&!f.text.toLowerCase().includes(d)||y&&f.ws&&de()&&f.ws!==de()||I(f.text))}function R(f,h){let O=document.createElement("div");O.className="acts";let N=document.createElement("button");N.className="qmm-btn",N.textContent="Copy",N.onclick=ae=>{ae.stopPropagation(),v(h.text)};let G=document.createElement("button");G.className="qmm-btn",G.textContent="\u2192 Editor",G.onclick=ae=>{ae.stopPropagation(),m.value=h.text,T(f)};let Q=document.createElement("button");return Q.className="qmm-btn",Q.textContent="Replay",Q.title="Send right away (to current WS or source WS if enabled)",Q.onclick=ae=>{ae.stopPropagation(),K(h)},O.append(N,G,Q),O}function Y(f){let h=document.createElement("div");h.className="ws-row",h.dataset.fid=String(f.id);let O=document.createElement("div");O.className="ts",O.textContent=zt(f.t);let N=document.createElement("div");N.className="arrow",N.textContent=f.dir==="in"?"\u2190":"\u2192",N.style.color=f.dir==="in"?"#4bd17a":"#8ab4ff";let G=document.createElement("div");G.className="body",G.innerHTML=`<code>${Ir(f.text)}</code>`;let Q=R(f.id,f);return h.append(O,N,G,Q),h.onclick=()=>T(f.id),h.ondblclick=()=>{m.value=f.text,T(f.id)},h}function q(f){if(!g(f))return;let h=Y(f);V.appendChild(h),o&&(V.scrollTop=V.scrollHeight)}function W(f=!1){V.querySelectorAll(".ws-row").forEach(h=>h.remove()),n.toArray().forEach(h=>{g(h)&&V.appendChild(Y(h))}),M!=null&&T(M),o&&(V.scrollTop=V.scrollHeight)}function ee(){let f=n.toArray().filter(h=>g(h)).map(h=>`[${zt(h.t)}] ${h.dir==="in"?"<-":"->"} ${h.text}`).join(`
`);v(f)}function K(f){let h=P&&f.ws?f.ws:de();if(!h||h.readyState!==WebSocket.OPEN)return;if((k.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{h.send(JSON.parse(f.text))}catch{h.send(f.text)}else h.send(f.text)}function z(){let f=de(),h=M!=null&&P?r.get(M)?.ws??null:null,O=(P?h:f)||f;if(!O||O.readyState!==WebSocket.OPEN)return;if((k.querySelector('input[type="radio"]:checked')?.value||"text")==="json")try{O.send(JSON.parse(m.value))}catch{O.send(m.value)}else O.send(m.value)}}async function Ar(e){let t=oe("sendQuinoaToastAtom");if(t){await xe(t,e);return}let n=oe("quinoaToastsAtom");if(!n)throw new Error("Aucun atom de toast trouv\xE9");let r=await ve(n).catch(()=>[]),a={isClosable:!0,duration:1e4,...e};"toastType"in a&&a.toastType==="board"?a.id=a.id??(a.isStackable?`quinoa-stackable-${Date.now()}-${Math.random()}`:"quinoa-game-toast"):a.id=a.id??"quinoa-game-toast",await xe(n,[...r,a])}async function Pe(e,t,n="info",r=3500){await Ar({title:e,description:t,variant:n,duration:r})}function Lr(e){if(!e||typeof e!="object")return[];let t=[],n=new Set,r=[e];for(;r.length;){let i=r.pop();if(!(!i||typeof i!="object"||n.has(i))){n.add(i);for(let o of Object.keys(i)){let l=i[o];Array.isArray(l)&&l.length&&l.every(u=>u&&typeof u=="object")&&l.some(d=>"id"in d&&"name"in d)&&/player/i.test(o)&&t.push(...l),l&&typeof l=="object"&&r.push(l)}}}let a=new Map;for(let i of t)i?.id&&a.set(String(i.id),i);return[...a.values()]}function kr(e){let t=e?.fullState?.data?.players??e?.data?.players??e?.players;return Array.isArray(t)?t:Lr(e)}function On(e){let t=e?.child?.data?.userSlots??e?.fullState?.child?.data?.userSlots??e?.data?.userSlots;return Array.isArray(t)?t:t&&typeof t=="object"?Object.values(t):[]}function Fn(e){let t=e?.data?.position??e?.position??e?.data?.coords??e?.coords,n=Number(t?.x),r=Number(t?.y);return Number.isFinite(n)&&Number.isFinite(r)?{x:n,y:r}:null}function _n(e){let t=e?.data?.inventory;if(!t||typeof t!="object")return null;let n=Array.isArray(t.items)?t.items:[],r=Array.isArray(t.favoritedItemIds)?t.favoritedItemIds:[];return{items:n,favoritedItemIds:r}}function Nn(e,t){for(let n of On(e))if(String(n?.playerId??"")===String(t))return n;return null}function Rr(e,t){let n=new Map;for(let r of On(t)){if(!r||typeof r!="object")continue;let a=r.playerId!=null?String(r.playerId):"";if(!a)continue;let i=Fn(r),o=_n(r);n.set(a,{x:i?.x,y:i?.y,inventory:o??null})}return e.map(r=>{let a=n.get(String(r.id));return a?{...r,...a}:{...r,inventory:null}})}var te={currentTargetId:null,unsub:null,lastPos:null,prevPos:null,steps:0},Ce={async list(){let e=await Qe.get();return e?Rr(kr(e),e):[]},async onChange(e){return Qe.sub(async()=>{try{e(await this.list())}catch{}})},async getPosition(e){let t=await Qe.get();if(!t)return null;let n=Nn(t,e);return Fn(n)},async getInventory(e){let t=await Qe.get();if(!t)return null;let n=Nn(t,e);return _n(n)},async teleportTo(e){let t=await this.getPosition(e);if(!t)throw new Error("Unknown position for this player");me.teleport(t.x,t.y),Pe("Teleport",`Teleported to ${t.x}, ${t.y}`,"success")},async openInventoryPreview(e,t){try{let n=await Ce.getInventory(e);if(!n||!Array.isArray(n.items)||n.items.length===0){await Pe("Inventory","No usable inventory for this player.","warn");return}await rt(n,{open:!0}),t&&await Pe("Inventory",`${t}'s inventory displayed.`,"info")}catch(n){await Pe("Inventory",n?.message||"Failed to open inventory.","error")}},async stopFollowing(){if(te.unsub)try{te.unsub()}catch{}te.unsub=null,te.currentTargetId=null,te.lastPos=null,te.prevPos=null,te.steps=0},isFollowing(e){return te.currentTargetId===e},async startFollowing(e){if(te.unsub){try{te.unsub()}catch{}te.unsub=null}te.currentTargetId=e,te.lastPos=null,te.prevPos=null,te.steps=0;let t=await Ce.getPosition(e);if(!t){await Pe("Follow","Unable to retrieve player position.","error"),te.currentTargetId=null;return}await me.teleport(t.x,t.y),te.lastPos={x:t.x,y:t.y},te.prevPos=null,te.steps=0,te.unsub=await Ce.onChange(async n=>{if(te.currentTargetId!==e)return;let r=n.find(o=>o.id===e);if(!r||typeof r.x!="number"||typeof r.y!="number"){this.stopFollowing(),await Pe("Follow","The target is no longer trackable (disconnected?).","error");return}let a={x:r.x,y:r.y},i=te.lastPos;if(!i){te.lastPos=a;return}(a.x!==i.x||a.y!==i.y)&&(te.steps+=1,te.steps>=2&&i&&me.move(i.x,i.y),te.prevPos=te.lastPos,te.lastPos=a)}),await Pe("Follow","Follow enabled","success")}};async function qr(){return Ce.list()}function Br(e,t=22){return e?e.length<=t?e:e.slice(0,t-1)+"\u2026":""}var Hr=e=>({id:e.id,title:Br(e.name||e.id,9),subtitle:e.isConnected?"Online":"Offline",avatarUrl:e.discordAvatarUrl||"",statusColor:e.isConnected?"#48d170":"#999a"});async function Dn(e){let t=new Ae({id:"players",compact:!0});t.mount(e);let n=t.root.querySelector(".qmm-views"),{root:r,left:a,right:i}=t.split2("260px");n.appendChild(r);let o=t.vtabs({filterPlaceholder:"Find player\u2026",onSelect:(L,w)=>u(w?.id||null)});a.appendChild(o.root);let l=o.root.querySelector(".filter");if(l){l.style.display="flex",l.style.alignItems="center",l.style.gap="8px";let L=l.querySelector("input");L&&(L.style.flex="1 1 auto",L.style.minWidth="0");let w=document.createElement("button");w.className="qmm-btn",w.title="Refresh",w.setAttribute("aria-label","Refresh"),w.style.width="34px",w.style.height="34px",w.style.padding="0",w.style.display="inline-flex",w.style.alignItems="center",w.style.justifyContent="center",w.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" aria-hidden="true">
        <path fill="currentColor" d="M12 6a6 6 0 0 1 5.66 4H20l-3.5 3.5L13 10h2.34A4 4 0 1 0 16 12h2a6 6 0 1 1-6-6z"/>
      </svg>
    `,w.onclick=async()=>{await M(!0)},l.appendChild(w)}function u(L){i.innerHTML="";let w=L&&d.find(X=>X.id===L)||null;if(!w){let X=document.createElement("div");X.style.opacity="0.75",X.textContent="Select a player on the left.",i.appendChild(X);return}let T=document.createElement("div");T.style.display="flex",T.style.alignItems="center",T.style.gap="12px";let I=document.createElement("img");I.src=w.discordAvatarUrl||"",I.alt=w.name,I.width=48,I.height=48,I.style.borderRadius="50%",I.style.objectFit="cover",I.style.border="1px solid #4446";let v=document.createElement("div"),x=document.createElement("div");x.textContent=w.name||w.id,x.style.fontWeight="600",x.style.fontSize="16px";let B=document.createElement("div");B.style.opacity="0.8",B.style.fontSize="12px";let D=w.isConnected?"Online":"Offline";B.textContent=D,v.appendChild(x),v.appendChild(B),T.appendChild(I),T.appendChild(v),i.appendChild(T);let j=document.createElement("div");j.style.display="flex",j.style.gap="8px",j.style.marginTop="8px",j.appendChild(t.btn("Teleport",async()=>{try{await Ce.teleportTo(w.id)}catch(X){Pe("Teleport",X?.message||"Error during teleport.","error")}})),j.appendChild(t.btn("Inventory",async()=>{await Ce.openInventoryPreview(w.id,w.name)}));let $=document.createElement("div");$.style.display="flex",$.style.alignItems="center",$.style.marginTop="6px",$.style.gap="8px";let U=document.createElement("div");U.textContent="Follow",U.style.fontSize="14px",U.style.opacity="0.85";let le=t.switch(Ce.isFollowing(w.id));le.addEventListener("change",async()=>{try{le.checked?(await Ce.startFollowing(w.id),await Pe("Follow","Follow activ\xE9.","success")):(Ce.stopFollowing(),await Pe("Follow","Follow d\xE9sactiv\xE9.","info"))}catch(X){await Pe("Follow",X?.message||"Erreur sur le follow.","error"),le.checked=!le.checked}}),$.appendChild(U),$.appendChild(le),i.appendChild(j),i.appendChild($)}let d=[],y="";function P(L){return L.map(w=>`${w.id}|${w.name??""}|${w.isConnected?1:0}|${w.inventory?.items?.length??0}`).join(";")}async function M(L=!0){let w=o.getSelected()?.id??null,T=await qr(),I=P(T);if(I===y)return;y=I,d=T,o.setItems(d.map(Hr));let v=L&&w&&d.some(x=>x.id===w)?w:d[0]?.id??null;v!==null?o.select(v):u(null)}await Ce.onChange(()=>{M(!0).catch(()=>{})}),await M(!0)}function Gn(e,t){e.textContent=t,e.style.flex="1",e.style.margin="0",e.style.padding="6px 10px",e.style.borderRadius="8px",e.style.border="1px solid #4445",e.style.background="#1f2328",e.style.color="#e7eef7",e.style.justifyContent="center",e.onmouseenter=()=>e.style.borderColor="#6aa1",e.onmouseleave=()=>e.style.borderColor="#4445"}function Wr(e,t){let n=document.createElement("div");n.style.display="grid",n.style.justifyItems="center",n.style.gap="8px",n.style.textAlign="center",n.style.border="1px solid #4446",n.style.borderRadius="10px",n.style.padding="10px",n.style.background="#1f2328",n.style.boxShadow="0 0 0 1px #0002 inset",n.style.width="min(720px, 100%)";let r=document.createElement("div");return r.textContent=e,r.style.fontWeight="600",r.style.opacity="0.95",n.append(r,t),n}var $n=e=>{let t=new Date(e),n=(r,a=2)=>String(r).padStart(a,"0");return`${n(t.getHours())}:${n(t.getMinutes())}:${n(t.getSeconds())}.${String(t.getMilliseconds()).padStart(3,"0")}`};var Pt=null,Xt=new Set;function Nr(e){let t=String(e||""),n=(J.getAbilityNameWithoutLevel?.(t)||"").replace(/[\s\-_]+/g,"").toLowerCase(),r=a=>t.startsWith(a)||n===a.toLowerCase();if(r("ProduceScaleBoost"))return{bg:"rgba(34,139,34,0.9)",hover:"rgba(34,139,34,1)"};if(r("PlantGrowthBoost"))return{bg:"rgba(0,128,128,0.9)",hover:"rgba(0,128,128,1)"};if(r("EggGrowthBoost"))return{bg:"rgba(180,90,240,0.9)",hover:"rgba(180,90,240,1)"};if(r("PetAgeBoost"))return{bg:"rgba(147,112,219,0.9)",hover:"rgba(147,112,219,1)"};if(r("PetHatchSizeBoost"))return{bg:"rgba(128,0,128,0.9)",hover:"rgba(128,0,128,1)"};if(r("PetXpBoost"))return{bg:"rgba(30,144,255,0.9)",hover:"rgba(30,144,255,1)"};if(r("HungerBoost"))return{bg:"rgba(255,20,147,0.9)",hover:"rgba(255,20,147,1)"};if(r("SellBoost"))return{bg:"rgba(220,20,60,0.9)",hover:"rgba(220,20,60,1)"};if(r("CoinFinder"))return{bg:"rgba(180,150,0,0.9)",hover:"rgba(180,150,0,1)"};if(r("ProduceMutationBoost"))return{bg:"rgba(138,43,226,0.9)",hover:"rgba(138,43,226,1)"};if(r("DoubleHarvest"))return{bg:"rgba(0,120,180,0.9)",hover:"rgba(0,120,180,1)"};if(r("ProduceEater"))return{bg:"rgba(255,69,0,0.9)",hover:"rgba(255,69,0,1)"};if(r("ProduceRefund"))return{bg:"rgba(255,99,71,0.9)",hover:"rgba(255,99,71,1)"};if(r("PetMutationBoost"))return{bg:"rgba(156,65,181,0.9)",hover:"rgba(156,65,181,1)"};if(r("HungerRestore"))return{bg:"rgba(255,105,180,0.9)",hover:"rgba(255,105,180,1)"};if(r("PetRefund"))return{bg:"rgba(0,80,120,0.9)",hover:"rgba(0,80,120,1)"};if(r("Copycat"))return{bg:"rgba(255,140,0,0.9)",hover:"rgba(255,140,0,1)"};if(r("GoldGranter"))return{bg:"linear-gradient(135deg, rgba(225,200,55,0.9) 0%, rgba(225,180,10,0.9) 40%, rgba(215,185,45,0.9) 70%, rgba(210,185,45,0.9) 100%)",hover:"linear-gradient(135deg, rgba(220,200,70,1) 0%, rgba(210,175,5,1) 40%, rgba(210,185,55,1) 70%, rgba(200,175,30,1) 100%)"};if(r("RainbowGranter"))return{bg:"linear-gradient(45deg, rgba(200,0,0,0.9), rgba(200,120,0,0.9), rgba(160,170,30,0.9), rgba(60,170,60,0.9), rgba(50,170,170,0.9), rgba(40,150,180,0.9), rgba(20,90,180,0.9), rgba(70,30,150,0.9))",hover:"linear-gradient(45deg, rgba(200,0,0,1), rgba(200,120,0,1), rgba(160,170,30,1), rgba(60,170,60,1), rgba(50,170,170,1), rgba(40,150,180,1), rgba(20,90,180,1), rgba(70,30,150,1))"};if(r("SeedFinderIV"))return{bg:"linear-gradient(130deg, rgba(0,180,216,0.9) 0%, rgba(124,42,232,0.9) 40%, rgba(160,0,126,0.9) 60%, rgba(255,215,0,0.9) 100%)",hover:"linear-gradient(130deg, rgba(0,180,216,1) 0%, rgba(124,42,232,1) 40%, rgba(160,0,126,1) 60%, rgba(255,215,0,1) 100%)"};if(r("SeedFinder")){let a=t.replace(/.*?([IVX]+)$/,"$1");return a==="II"?{bg:"rgba(183,121,31,0.9)",hover:"rgba(183,121,31,1)"}:a==="III"?{bg:"rgba(139,62,152,0.9)",hover:"rgba(139,62,152,1)"}:{bg:"rgba(94,172,70,0.9)",hover:"rgba(94,172,70,1)"}}return{bg:"rgba(100,100,100,0.9)",hover:"rgba(150,150,150,1)"}}function Or(e,t){let n=c=>{let s=t?.root??e;s.style.display=c?"none":""};e.innerHTML="";let r=(c,s)=>{c.textContent=s,c.style.width="100%",c.style.margin="0",c.style.padding="10px",c.style.borderRadius="8px",c.style.border="1px solid #4445",c.style.background="#1f2328",c.style.color="#e7eef7",c.style.justifyContent="center",c.onmouseenter=()=>c.style.borderColor="#6aa1",c.onmouseleave=()=>c.style.borderColor="#4445"},a=(c,s)=>Wr(c,s),i=()=>{let c=document.createElement("div");return c.style.display="flex",c.style.alignItems="center",c.style.flexWrap="wrap",c.style.gap="8px",c},o=document.createElement("div");o.style.display="grid",o.style.gridTemplateColumns="minmax(220px, 280px) minmax(0, 1fr)",o.style.gap="10px",o.style.alignItems="stretch",o.style.height="54vh",o.style.overflow="hidden",e.appendChild(o);let l=document.createElement("div");l.style.display="grid",l.style.gridTemplateRows="1fr auto",l.style.gap="8px",l.style.minHeight="0",o.appendChild(l);let u=document.createElement("div");u.style.display="flex",u.style.flexDirection="column",u.style.gap="6px",u.style.overflow="auto",u.style.padding="6px",u.style.border="1px solid #4445",u.style.borderRadius="10px",u.style.scrollBehavior="smooth",u.style.minHeight="0",l.appendChild(u);let d=document.createElement("div");d.style.display="flex",d.style.gap="6px",l.appendChild(d);let y=document.createElement("button");y.id="pets.teams.new";let P=document.createElement("button");P.id="pets.teams.duplicate";let M=document.createElement("button");M.id="pets.teams.delete",r(y,"New"),r(P,"Duplicate"),r(M,"Delete"),d.append(y,P,M);let L=[],w=null,T=!1,I=null,v=null,x=0;function B(){return L.find(c=>c.id===w)||null}function D(c){let s=Array.from(u.children);if(!s.length)return 0;let b=s[0].getBoundingClientRect();if(c<b.top+b.height/2)return 0;for(let p=0;p<s.length;p++){let E=s[p].getBoundingClientRect(),g=E.top+E.height/2;if(c<g)return p}return s.length}function j(c){let s=document.createElement("span");s.style.display="inline-flex",s.style.alignItems="center",s.style.lineHeight="1";let b=8,p=12,E=3,g=Array.isArray(c)?c.filter(Boolean):[];if(!g.length){let R=document.createElement("span");return R.textContent="No ability",R.style.opacity="0.75",R.style.fontSize="12px",s.appendChild(R),s}return g.forEach((R,Y)=>{let q=document.createElement("span"),{bg:W,hover:ee}=Nr(R);q.title=J.getAbilityName(R)||R,q.setAttribute("aria-label",q.title),Object.assign(q.style,{display:"inline-block",width:`${p}px`,height:`${p}px`,borderRadius:`${E}px`,marginRight:Y===g.length-1?"0":`${b}px`,background:W,transition:"transform 80ms ease, box-shadow 120ms ease, background 120ms ease",cursor:"default"}),q.onmouseenter=()=>{q.style.background=ee,q.style.transform="scale(1.08)",q.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff33"},q.onmouseleave=()=>{q.style.background=W,q.style.transform="none",q.style.boxShadow="0 0 0 1px #0006 inset, 0 0 0 1px #ffffff1a"},s.appendChild(q)}),s}function $(){let c=Array.from(u.children);if(c.forEach(p=>p.style.transform=""),I===null||v===null)return;let s=I,b=v;c.forEach((p,E)=>{p.style.transition="transform 120ms ease",E!==s&&(b>s&&E>s&&E<b&&(p.style.transform=`translateY(${-x}px)`),b<s&&E>=b&&E<s&&(p.style.transform=`translateY(${x}px)`))})}function U(){Array.from(u.children).forEach(c=>{c.style.transform="",c.style.transition=""})}async function le(){Pt=null,Xt=new Set;try{let c=await J.getPets(),s=Array.isArray(c)?c.map(b=>String(b?.slot?.id||"")).filter(Boolean):[];Xt=new Set(s);for(let b of L){let p=(b.slots||[]).filter(Boolean);if(p.length!==s.length)continue;let E=!0;for(let g of p)if(!Xt.has(g)){E=!1;break}if(E){Pt=b.id;break}}}catch{}}async function X(c=!1){if(c||await le(),U(),I=null,v=null,x=0,u.innerHTML="",!L.length){let s=document.createElement("div");s.textContent="No teams yet. Create one!",s.style.opacity="0.75",s.style.textAlign="center",s.style.padding="8px",u.appendChild(s),ue(null);return}L.forEach((s,b)=>{let p=document.createElement("div"),E=s.id===Pt;p.dataset.index=String(b),p.textContent="",p.style.height="36px",p.style.lineHeight="36px",p.style.padding="0 10px",p.style.border="1px solid #ffffff15",p.style.borderRadius="6px",p.style.cursor="pointer",p.style.fontSize="13px",p.style.overflow="hidden",p.style.whiteSpace="nowrap",p.style.textOverflow="ellipsis",p.style.display="flex",p.style.flex="0 0 auto",p.style.gap="8px",p.style.alignItems="center",p.style.background=s.id===w?"#2a313a":"#1f2328";let g=document.createElement("span");g.style.width="10px",g.style.height="10px",g.style.borderRadius="50%",g.style.boxShadow="0 0 0 1px #0006 inset",g.style.background=E?"#48d170":"#64748b",g.title=E?"This team is currently active":"Inactive team";let R=document.createElement("span");R.textContent=s.name||"(unnamed)",R.style.overflow="hidden",R.style.textOverflow="ellipsis",R.style.whiteSpace="nowrap",p.append(g,R);let Y=document.createElement("span");Y.className="qmm-grab",Y.title="Drag to reorder",Y.innerHTML="&#8942;",Y.draggable=!0,p.onmouseenter=()=>p.style.borderColor="#6aa1",p.onmouseleave=()=>p.style.borderColor="#ffffff15",p.onclick=q=>{if(q.__byDrag)return;w!==s.id&&(w=s.id,X()),ue(B())},Y.addEventListener("dragstart",q=>{I=b,x=p.getBoundingClientRect().height,p.classList.add("qmm-dragging"),q.dataTransfer?.setData("text/plain",String(b)),q.dataTransfer&&(q.dataTransfer.effectAllowed="move");try{let W=p.cloneNode(!0);W.style.width=`${p.getBoundingClientRect().width}px`,W.style.position="absolute",W.style.top="-9999px",document.body.appendChild(W),q.dataTransfer.setDragImage(W,W.offsetWidth/2,W.offsetHeight/2),setTimeout(()=>document.body.removeChild(W),0)}catch{}}),Y.addEventListener("dragend",()=>{p.classList.remove("qmm-dragging"),U(),I=null,v=null}),p.addEventListener("dragover",q=>{if(q.preventDefault(),q.dataTransfer&&(q.dataTransfer.dropEffect="move"),I===null)return;let W=Number(q.currentTarget.dataset.index||-1);if(W<0)return;let ee=p.getBoundingClientRect(),K=ee.top+ee.height/2,z=q.clientY<K?W:W+1,f=Math.max(0,Math.min(L.length,z));v!==f&&(v=f,$());let h=28,O=u.getBoundingClientRect();q.clientY<O.top+h?u.scrollTop-=18:q.clientY>O.bottom-h&&(u.scrollTop+=18)}),p.addEventListener("drop",q=>{if(q.preventDefault(),q.__byDrag=!0,I===null)return;let W=v??D(q.clientY);if(W>I&&(W-=1),W=Math.max(0,Math.min(L.length-1,W)),W!==I){let ee=L.slice(),[K]=ee.splice(I,1);ee.splice(W,0,K),L=ee;try{J.setTeamsOrder(L.map(z=>z.id))}catch{}}U(),I=null,v=null,x=0,X()}),p.onclick=q=>{if(q.__byDrag)return;w!==s.id&&(w=s.id,X()),ue(B())},p.appendChild(Y),u.appendChild(p)})}u.addEventListener("dragover",c=>{if(c.preventDefault(),c.dataTransfer&&(c.dataTransfer.dropEffect="move"),I===null)return;let s=D(c.clientY);v!==s&&(v=s,$());let b=28,p=u.getBoundingClientRect();c.clientY<p.top+b?u.scrollTop-=18:c.clientY>p.bottom-b&&(u.scrollTop+=18)}),u.addEventListener("drop",c=>{if(c.preventDefault(),I===null)return;let s=v??D(c.clientY);if(s>I&&(s-=1),s=Math.max(0,Math.min(L.length-1,s)),s!==I){let b=L.slice(),[p]=b.splice(I,1);b.splice(s,0,p),L=b;try{J.setTeamsOrder(L.map(E=>E.id))}catch{}}U(),I=null,v=null,x=0,X()}),y.onclick=()=>{w=J.createTeam("New Team").id,X(),ue(B())},P.onclick=()=>{if(!w)return;let c=J.duplicateTeam(w);c&&(w=c.id,X(),ue(B()))},M.onclick=()=>{!w||J.deleteTeam(w)};let ce=null;(async()=>{try{ce=await J.onTeamsChangeNow(async c=>{L=Array.isArray(c)?c.slice():[],w&&!L.some(s=>s.id===w)&&(w=L[0]?.id??null),!w&&L.length&&(w=L[0].id),X(),await J.getInventoryPets(),await ue(B())})}catch{}})();let ge=document.createElement("div");ge.style.display="grid",ge.style.gridTemplateRows="auto 1fr",ge.style.gap="10px",ge.style.minHeight="0",o.appendChild(ge);let fe=document.createElement("div");fe.style.display="flex",fe.style.alignItems="center",fe.style.gap="8px";let Te=document.createElement("div");Te.textContent="Team editor \u2014 ",Te.style.fontWeight="700",Te.style.fontSize="14px";let S=document.createElement("button");S.id="pets.teams.useThisTeam",S.textContent="Use this team",S.style.padding="6px 10px",S.style.borderRadius="8px",S.style.border="1px solid #4445",S.style.background="#1f2328",S.style.color="#e7eef7",S.style.cursor="pointer",S.onmouseenter=()=>S.style.borderColor="#6aa1",S.onmouseleave=()=>S.style.borderColor="#4445",S.disabled=!0;let H=document.createElement("button");H.id="pets.teams.save",H.textContent="Save",H.style.padding="6px 10px",H.style.borderRadius="8px",H.style.border="1px solid #4445",H.style.background="#1f2328",H.style.color="#e7eef7",H.style.cursor="pointer",H.onmouseenter=()=>H.style.borderColor="#6aa1",H.onmouseleave=()=>H.style.borderColor="#4445",H.disabled=!0,fe.append(Te,S,H),ge.appendChild(fe);let C=document.createElement("div");C.style.border="1px solid #4445",C.style.borderRadius="10px",C.style.padding="10px",C.style.display="flex",C.style.flexDirection="column",C.style.gap="12px",C.style.overflow="auto",C.style.minHeight="0",C.style.background="#0f1318",ge.appendChild(C);let F=(()=>{let c=i(),s=t.inputText("Team name","");return s.id="pets.teams.editor.name",s.style.minWidth="260px",c.append(s),C.appendChild(a("Team name",c)),{nameInput:s}})(),ie=(()=>{let c=document.createElement("div");c.style.display="grid",c.style.gap="10px",c.style.justifyItems="center";let s=document.createElement("div");s.style.display="flex",s.style.flexWrap="wrap",s.style.alignItems="center",s.style.justifyContent="center",s.style.gap="10px";let b=(z,f,h,O=!1)=>{let N=document.createElement("label");N.style.display="inline-flex",N.style.alignItems="center",N.style.gap="6px";let G=t.radio(z,f,O),Q=document.createElement("span");return Q.textContent=h,N.append(G,Q),{wrap:N,input:G}},p=b("pets-search-mode","ability","Ability",!0),E=b("pets-search-mode","species","Species",!1);s.append(p.wrap,E.wrap);let g=document.createElement("select");g.className="qmm-input",g.id="pets.teams.filter.select",g.style.minWidth="260px";let R="ability",Y=()=>R,q=z=>{R=z,p.input.checked=z==="ability",E.input.checked=z==="species",p.input.type="radio",E.input.type="radio",p.input.name="pets-search-mode",E.input.name="pets-search-mode"},W=z=>{g.innerHTML="";let f=document.createElement("option");f.value="",f.textContent="\u2014 No filter \u2014",g.appendChild(f),z.forEach(h=>{let O=document.createElement("option");O.value=h,O.textContent=h,g.appendChild(O)})},ee=async()=>{let z=await J.getInventoryPets().catch(()=>[]),f=Y();if(Y()==="ability"){let h=new Set;for(let G of z){let Q=Array.isArray(G?.abilities)?G.abilities.filter(Boolean):[];for(let ae of Q){let Le=J.getAbilityNameWithoutLevel(ae);Le&&h.add(Le)}}let O=Array.from(h).sort((G,Q)=>G.localeCompare(Q));g.innerHTML="";let N=document.createElement("option");N.value="",N.textContent="\u2014 No filter \u2014",g.appendChild(N),O.forEach(G=>{let Q=document.createElement("option");Q.value=G,Q.textContent=G,g.appendChild(Q)})}else{let h=new Set;for(let G of z){let Q=String(G?.petSpecies||"").trim();Q&&h.add(Q)}let O=Array.from(h).sort((G,Q)=>G.localeCompare(Q));g.innerHTML="";let N=document.createElement("option");N.value="",N.textContent="\u2014 No filter \u2014",g.appendChild(N),O.forEach(G=>{let Q=document.createElement("option");Q.value=G,Q.textContent=G.charAt(0).toUpperCase()+G.slice(1),g.appendChild(Q)})}},K=()=>{let z=B();if(!z)return;let f=(g.value||"").trim(),h=Y()==="ability"?f?`ab:${f}`:"":f?`sp:${f}`:"";J.setTeamSearch(z.id,h)};return p.input.addEventListener("change",async()=>{p.input.checked&&(q("ability"),await ee(),g.value="",K())}),E.input.addEventListener("change",async()=>{E.input.checked&&(q("species"),await ee(),g.value="",K())}),g.addEventListener("change",K),c.append(s,g),C.appendChild(a("Search",c)),{getMode:Y,setMode:q,select:g,rebuild:ee,apply:K,setFromSearchString(z){let f=(z||"").match(/^(ab|sp):\s*(.*)$/i);if(!f){q("ability"),g.value="";return}let h=f[1].toLowerCase()==="ab"?"ability":"species";q(h),g.value=f[2]||""}}})(),de=(()=>{let c=document.createElement("div");c.style.display="grid",c.style.gridTemplateColumns="1fr",c.style.rowGap="10px",c.style.justifyItems="center";let s=ee=>{let K=document.createElement("div"),z=28;K.style.display="grid",K.style.gridTemplateColumns=`minmax(0,1fr) ${z}px ${z}px`,K.style.alignItems="center",K.style.gap="8px",K.style.width="min(560px, 100%)",K.style.border="1px solid #4445",K.style.borderRadius="10px",K.style.padding="8px 10px",K.style.background="#0f1318";let f=document.createElement("div");f.style.display="flex",f.style.flexDirection="column",f.style.gap="6px",f.style.minWidth="0";let h=document.createElement("div");h.style.fontWeight="700",h.textContent="None",h.style.overflow="hidden",h.style.textOverflow="ellipsis",h.style.whiteSpace="nowrap";let O=j([]);O.style.display="inline-block",f.append(h,O);let N=document.createElement("button");N.textContent="+",Object.assign(N.style,{width:`${z}px`,minWidth:`${z}px`,height:`${z}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),N.title="Choose a pet",N.setAttribute("aria-label","Choose a pet");let G=document.createElement("button");G.textContent="\u2212",Object.assign(G.style,{width:`${z}px`,minWidth:`${z}px`,height:`${z}px`,padding:"0",fontSize:"16px",lineHeight:"1",borderRadius:"10px",boxShadow:"none",display:"grid",placeItems:"center"}),G.title="Remove this pet",G.setAttribute("aria-label","Remove this pet"),K.append(f,N,G);function Q(ae){if(!ae){h.textContent="None";let It=j([]);It.style.display="inline-block",f.replaceChild(It,f.children[1]),O=It;return}let Le=ae.petSpecies?ae.petSpecies.charAt(0).toUpperCase()+ae.petSpecies.slice(1):"",it=ae.name?.trim()||Le||"Pet";h.textContent=it,h.textContent=it;let Tt=Array.isArray(ae.abilities)?ae.abilities.filter(Boolean):[],ze=j(Tt);ze.style.display="inline-block",f.replaceChild(ze,f.children[1]),O=ze}return N.onclick=async()=>{let ae=B();if(ae){N.disabled=!0,G.disabled=!0,n(!0);try{await J.chooseSlotPet(ae.id,ee),await V(B())}finally{n(!1),N.disabled=!1,G.disabled=!1}}},G.onclick=async()=>{let ae=B();if(!ae)return;let Le=ae.slots.slice(0,3);Le[ee]=null,J.saveTeam({id:ae.id,slots:Le}),await V(ae)},{root:K,nameEl:h,abilitiesEl:O,btnChoose:N,btnClear:G,update:Q}},b=s(0),p=s(1),E=s(2);c.append(b.root,p.root,E.root);let g=document.createElement("div");g.style.display="flex",g.style.gap="6px",g.style.justifyContent="center";let R=document.createElement("button");r(R,"Current active"),R.id="pets.teams.useCurrent";let Y=document.createElement("button");r(Y,"Clear slots"),Y.id="pets.teams.clearSlots";let q="#0f1318";g.append(R,Y),Object.assign(R.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:q,boxShadow:"none"}),Object.assign(Y.style,{width:"auto",fontSize:"16px",borderRadius:"10px",background:q,boxShadow:"none"});let W=document.createElement("div");return W.style.display="flex",W.style.flexDirection="column",W.style.gap="8px",W.append(c,g),C.appendChild(a("Active pets (3 slots)",W)),{rows:[b,p,E],btnUseCurrent:R,btnClear:Y}})();async function V(c){let s=c??B();if(!s)return;let b=await J.getInventoryPets().catch(()=>[]),p=new Map;for(let E of b)E?.id!=null&&p.set(String(E.id),E);[0,1,2].forEach(E=>{let g=s.slots[E]||"",R=g&&p.get(g)||null;de.rows[E].update(R)})}async function ue(c){let s=!!c;if(F.nameInput.disabled=!s,de.btnClear.disabled=!s,de.btnUseCurrent.disabled=!s,S.disabled=!s,H.disabled=!s,ie.setMode("ability"),await ie.rebuild(),s){let b=J.getTeamSearch(c.id)||"";ie.setFromSearchString(b),ie.apply()}if(!s){de.rows.forEach(b=>b.update(null)),F.nameInput.value="";return}F.nameInput.value=String(c.name||""),await V(c)}F.nameInput.addEventListener("keydown",c=>{c.key==="Enter"&&c.currentTarget.blur()}),F.nameInput.addEventListener("blur",()=>{let c=B();if(!c)return;let s=F.nameInput.value.trim();s!==c.name&&J.saveTeam({id:c.id,name:s})}),de.btnUseCurrent.onclick=async()=>{let c=B();if(c)try{let s=await J.getPets(),p=(Array.isArray(s)?s:[]).map(g=>String(g?.slot?.id||"")).filter(g=>!!g).slice(0,3),E=[p[0]||null,p[1]||null,p[2]||null];J.saveTeam({id:c.id,slots:E}),await V(c)}catch{}},de.btnClear.onclick=async()=>{let c=B();c&&(J.saveTeam({id:c.id,slots:[null,null,null]}),await V(c))},H.onclick=()=>{let c=B();if(!c)return;let s=F.nameInput.value.trim(),b=c.slots.slice(0,3);J.saveTeam({id:c.id,name:s,slots:b}),V(c)};function Oe(c,s){if(c.length!==s.length)return!1;let b=new Set(c);for(let p of s)if(!b.has(p))return!1;return!0}async function m(c,s=2e3){let b=(c.slots||[]).filter(Boolean),p=performance.now();for(;performance.now()-p<s;){let E=await J.getPets().catch(()=>null),g=Array.isArray(E)?E.map(R=>String(R?.slot?.id||"")).filter(Boolean):[];if(Oe(g,b))return!0;await new Promise(R=>setTimeout(R,80))}return!1}S.onclick=async()=>{let c=B();if(c)try{T=!0,Pt=c.id,await X(!0),await J.useTeam(c.id),await m(c),await ue(B()),await X()}catch(s){console.warn("[Pets] Use this team failed:",s),await X()}finally{T=!1}};let k=null;(async()=>{try{V(),k=await J.onInventoryPetsChange(async()=>{T||await V(B())})}catch{}})(),e.__cleanup__=(()=>{let c=e.__cleanup__;return()=>{try{ce?.()}catch{}try{k?.()}catch{}try{c?.()}catch{}}})()}function Fr(e,t){e.innerHTML="";let n=document.createElement("div");n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.height="54vh",e.appendChild(n);let r=document.createElement("div");r.style.display="flex",r.style.flexWrap="wrap",r.style.alignItems="center",r.style.gap="8px",r.style.border="1px solid #4445",r.style.borderRadius="10px",r.style.padding="8px 10px",r.style.background="#0f1318",n.appendChild(r);let a=document.createElement("select");a.className="qmm-input",a.style.minWidth="200px",a.id="pets.logs.filter.ability";let i=document.createElement("select");i.className="qmm-input",i.style.minWidth="140px",i.id="pets.logs.sort",[["desc","Newest first"],["asc","Oldest first"]].forEach(([S,H])=>{let C=document.createElement("option");C.value=S,C.textContent=H,i.appendChild(C)}),i.value="desc";let o=t.inputText("search (pet / ability / details)","");o.id="pets.logs.search",o.style.minWidth="220px";let l=document.createElement("button");Gn(l,"Copy"),l.id="pets.logs.copy";let u=document.createElement("button");Gn(u,"Clear"),u.id="pets.logs.clear",r.append(t.label("Ability"),a,t.label("Sort"),i,o,l,u);let d=document.createElement("div");d.style.border="1px solid #4445",d.style.borderRadius="10px",d.style.padding="10px",d.style.background="#0f1318",d.style.overflow="hidden",d.style.display="grid",d.style.gridTemplateRows="auto 1fr",d.style.minHeight="0",n.appendChild(d);let y=document.createElement("div");y.style.display="grid",y.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",y.style.columnGap="0",y.style.borderBottom="1px solid #ffffff1a",y.style.padding="0 0 6px 0";function P(S,H="center"){let C=document.createElement("div");return C.textContent=S,C.style.fontWeight="600",C.style.opacity="0.9",C.style.padding="6px 8px",C.style.textAlign=H,C}y.append(P("Time"),P("Pet"),P("Ability"),P("Details","left")),d.appendChild(y);let M=document.createElement("div");M.style.display="grid",M.style.gridTemplateColumns="140px 220px 200px minmax(0,1fr)",M.style.gridAutoRows="auto",M.style.alignContent="start",M.style.overflow="auto",M.style.width="100%",M.style.minHeight="0",d.appendChild(M);let L=[],w=new Set,T="",I="desc",v="",x=new Intl.NumberFormat(void 0,{maximumFractionDigits:0});function B(S){return Math.round(S)}function D(S){if(typeof S=="number")return B(S);if(S==null)return S;if(Array.isArray(S))return S.map(D);if(typeof S=="object"){let H={};for(let C of Object.keys(S))H[C]=D(S[C]);return H}return S}function j(S,H=0){if(S==null)return"";if(typeof S=="number")return x.format(S);if(typeof S=="string")return S;if(typeof S=="boolean")return String(S);if(Array.isArray(S))return S.map(C=>j(C,H+1)).join(", ");if(typeof S=="object"){let C=Object.entries(S);return C.length?C.map(([F,ie])=>{if(ie!==null&&typeof ie=="object")try{let de=D(ie);return`${F}: ${JSON.stringify(de)}`}catch{return`${F}: ${String(ie)}`}return`${F}: ${j(ie,H+1)}`}).join(", "):""}return String(S)}function $(S){try{let H=D(S);return j(H)}catch{try{return JSON.stringify(S)}catch{return String(S??"")}}}function U(S){try{return $(S).toLowerCase()}catch{try{return JSON.stringify(S).toLowerCase()}catch{return""}}}function le(){let S=a.value;a.innerHTML="";let H=[["","All abilities"],...Array.from(w).sort().map(C=>[C,C])];for(let[C,F]of H){let ie=document.createElement("option");ie.value=C,ie.textContent=F,a.appendChild(ie)}a.value=H.some(([C])=>C===S)?S:""}function X(S,H="center"){let C=document.createElement("div");return C.textContent=S,C.style.padding="6px 8px",C.style.textAlign=H,C.style.whiteSpace=H==="left"?"pre-wrap":"normal",C.style.wordBreak=H==="left"?"break-word":"normal",C.style.borderBottom="1px solid #ffffff12",C}function ce(S){let H=X($n(S.performedAt),"center"),C=S.petName||S.species||"Pet",F=X(C,"center"),ie=X(S.abilityId,"center"),de=$(S.data),V=X(de,"left");M.append(H,F,ie,V)}function ge(){let S=C=>String(C??"").toLowerCase().replace(/\s+/g,"").replace(/([ivx]+)$/i,""),H=L.slice();if(T&&T.trim()){let C=S(T);H=H.filter(F=>{let ie=S(F.abilityId),de=S(J.getAbilityNameWithoutLevel(F.abilityId));return ie===C||de===C})}if(v&&v.trim()){let C=v.toLowerCase();H=H.filter(F=>{let ie=(F.petName||F.species||"").toLowerCase(),de=(J.getAbilityNameWithoutLevel(F.abilityId)||"").toLowerCase(),V=(F.abilityId||"").toLowerCase(),ue=U(F.data);return ie.includes(C)||de.includes(C)||V.includes(C)||ue.includes(C)||(F.petId||"").toLowerCase().includes(C)})}return H.sort((C,F)=>I==="asc"?C.performedAt-F.performedAt:F.performedAt-C.performedAt),H}function fe(){M.innerHTML="";let S=ge();if(!S.length){let H=document.createElement("div");H.textContent="No logs yet.",H.style.opacity="0.75",H.style.gridColumn="1 / -1",H.style.padding="8px",M.appendChild(H);return}S.forEach(ce),M.scrollTop=M.scrollHeight+32}a.onchange=()=>{T=a.value,fe()},i.onchange=()=>{I=i.value||"desc",fe()},o.addEventListener("input",()=>{v=o.value.trim(),fe()}),u.onclick=()=>{try{J.clearAbilityLogs()}catch{}},l.onclick=async()=>{let S=ge().map(C=>({time:$n(C.performedAt),pet:C.petName||C.species||C.petId,petId:C.petId,ability:C.abilityId,data:D(C.data)})),H=JSON.stringify(S,null,2);try{await navigator.clipboard.writeText(H)}catch{}};let Te=null;(async()=>{try{w=new Set(J.getSeenAbilityIds()),le(),Te=J.onAbilityLogs(S=>{L=S.map(H=>({petId:H.petId,petName:H.name??null,species:H.species??null,abilityId:H.abilityId,data:H.data,performedAt:H.performedAt})),w=new Set(J.getSeenAbilityIds()),le(),fe()})}catch{}})(),e.__cleanup__=()=>{try{Te?.()}catch{}},fe()}function jn(e){let t=new Ae({id:"pets",compact:!0});t.mount(e),t.addTab("manager","Manager",n=>Or(n,t)),t.addTab("logs","Logs",n=>Fr(n,t))}function _r(){let e=document.createElement("div");return e.style.display="flex",e.style.flexWrap="wrap",e.style.justifyContent="center",e.style.alignItems="center",e.style.gap="8px",e}var Yn="qws:player:ghostMode",Dr=(e,t=!1)=>{try{return localStorage.getItem(e)==="1"}catch{return t}},Gr=(e,t)=>{try{localStorage.setItem(e,t?"1":"0")}catch{}};function $r(){let e="qws:ghost:delayMs",n=()=>{try{return Math.max(5,Math.floor(Number(localStorage.getItem(e))||50))}catch{return 50}},r=n();function a(v){r=Math.max(5,Math.floor(v||50));try{localStorage.setItem(e,String(r))}catch{}}let i=new Set,o=v=>{let x=v.key.toLowerCase();(x==="z"||x==="q"||x==="s"||x==="d"||x==="w"||x==="a"||v.key==="ArrowUp"||v.key==="ArrowDown"||v.key==="ArrowLeft"||v.key==="ArrowRight")&&(v.preventDefault(),v.stopImmediatePropagation(),!v.repeat&&i.add(x))},l=v=>{let x=v.key.toLowerCase();(x==="z"||x==="q"||x==="s"||x==="d"||x==="w"||x==="a"||v.key==="ArrowUp"||v.key==="ArrowDown"||v.key==="ArrowLeft"||v.key==="ArrowRight")&&(v.preventDefault(),v.stopImmediatePropagation(),i.delete(x))},u=()=>{i.clear()},d=()=>{document.hidden&&i.clear()};function y(){let v=0,x=0;return(i.has("z")||i.has("w")||i.has("arrowup"))&&(x-=1),(i.has("s")||i.has("arrowdown"))&&(x+=1),(i.has("q")||i.has("a")||i.has("arrowleft"))&&(v-=1),(i.has("d")||i.has("arrowright"))&&(v+=1),v&&(v=v>0?1:-1),x&&(x=x>0?1:-1),{dx:v,dy:x}}let P=null,M=0,L=0,w=!1;async function T(v,x){let B;try{B=await me.getPosition()}catch{}let D=Math.round(B?.x??0),j=Math.round(B?.y??0);try{await me.move(D+v,j+x)}catch{}}function I(v){M||(M=v);let x=v-M;M=v;let{dx:B,dy:D}=y();if(L+=x,B===0&&D===0){L=Math.min(L,r*4),P=requestAnimationFrame(I);return}L>=r&&!w&&(L-=r,w=!0,(async()=>{try{await T(B,D)}finally{w=!1}})()),L=Math.min(L,r*4),P=requestAnimationFrame(I)}return{start(){P===null&&(M=0,L=0,w=!1,window.addEventListener("keydown",o,{capture:!0}),window.addEventListener("keyup",l,{capture:!0}),window.addEventListener("blur",u),document.addEventListener("visibilitychange",d),P=requestAnimationFrame(I))},stop(){P!==null&&(cancelAnimationFrame(P),P=null),i.clear(),window.removeEventListener("keydown",o,{capture:!0}),window.removeEventListener("keyup",l,{capture:!0}),window.removeEventListener("blur",u),document.removeEventListener("visibilitychange",d)},setSpeed:a,getSpeed:n}}async function Un(e){let t=new Ae({id:"misc",compact:!0});t.mount(e);let n=t.root.querySelector(".qmm-views");n.innerHTML="",n.style.display="grid",n.style.gridTemplateRows="auto 1fr",n.style.gap="10px",n.style.minHeight="0";let r=document.createElement("div");r.style.display="flex",r.style.alignItems="center",r.style.gap="10px";let a=t.label("Player controls");a.style.fontWeight="700",a.style.fontSize="14px",r.append(a),n.appendChild(r);let i=document.createElement("div");i.className="qmm-card",i.style.display="flex",i.style.flexDirection="column",i.style.gap="12px",i.style.alignItems="center",i.style.overflow="auto",i.style.minHeight="0",n.appendChild(i);let o=_r(),l=t.switch(Dr(Yn));l.id="player.ghostMode";let u=t.label("Ghost mode"),d=t.label("Move delay (ms)"),y=t.inputNumber(10,1e3,5,50);y.id="player.moveDelay",o.append(l,u,d,y.wrap??y),i.appendChild(o);let P=$r();y.value=String(P.getSpeed?.()??50),y.addEventListener("change",()=>{let M=Math.max(10,Math.min(1e3,Math.floor(Number(y.value)||50)));y.value=String(M),P.setSpeed?.(M)}),l.checked&&P.start(),l.onchange=()=>{let M=!!l.checked;Gr(Yn,M),M?P.start():P.stop()},i.__cleanup__=()=>{try{P.stop()}catch{}}}function zn(e){let t=["visibilitychange","blur","focus","focusout","pagehide","freeze","resume","mouseleave","mouseenter"],n=[];function r(){let $=(U,le)=>{let X=ce=>{ce.stopImmediatePropagation(),ce.preventDefault?.()};U.addEventListener(le,X,{capture:!0}),n.push({t:le,h:X,target:U})};t.forEach(U=>{$(document,U),$(window,U)})}function a(){for(let{t:$,h:U,target:le}of n)try{le.removeEventListener($,U,{capture:!0})}catch{}n.length=0}let i=Object.getPrototypeOf(document),o={hidden:Object.getOwnPropertyDescriptor(i,"hidden"),visibilityState:Object.getOwnPropertyDescriptor(i,"visibilityState"),hasFocus:document.hasFocus?document.hasFocus.bind(document):null};function l(){try{Object.defineProperty(i,"hidden",{configurable:!0,get(){return!1}})}catch{}try{Object.defineProperty(i,"visibilityState",{configurable:!0,get(){return"visible"}})}catch{}try{document.hasFocus=()=>!0}catch{}}function u(){try{o.hidden&&Object.defineProperty(i,"hidden",o.hidden)}catch{}try{o.visibilityState&&Object.defineProperty(i,"visibilityState",o.visibilityState)}catch{}try{o.hasFocus&&(document.hasFocus=o.hasFocus)}catch{}}let d=null,y=null,P=null,M=()=>{d&&d.state!=="running"&&d.resume?.().catch(()=>{})};function L(){try{d=new(window.AudioContext||window.webkitAudioContext)({latencyHint:"interactive"}),P=d.createGain(),P.gain.value=1e-5,y=d.createOscillator(),y.frequency.value=1,y.connect(P).connect(d.destination),y.start(),document.addEventListener("visibilitychange",M,{capture:!0}),window.addEventListener("focus",M,{capture:!0})}catch{w()}}function w(){try{y?.stop()}catch{}try{y?.disconnect(),P?.disconnect()}catch{}try{d?.close?.()}catch{}document.removeEventListener("visibilitychange",M,{capture:!0}),window.removeEventListener("focus",M,{capture:!0}),y=null,P=null,d=null}let T=null;function I(){let $=document.querySelector("canvas")||document.body||document.documentElement;T=window.setInterval(()=>{try{$.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:1,clientY:1}))}catch{}},25e3)}function v(){T!==null&&(clearInterval(T),T=null)}let x=null;async function B(){try{let $=await e.getPosition();if(!$)return;await e.move(Math.round($.x),Math.round($.y))}catch{}}function D(){x=window.setInterval(B,6e4),B()}function j(){x!==null&&(clearInterval(x),x=null)}return{start(){l(),r(),L(),I(),D()},stop(){j(),v(),w(),a(),u()}}}(async function(){"use strict";Kt(),jt({onRegister(t){t("players","Players",Dn),t("pets","Pets",jn),t("misc","Misc",Un),t("debug-data","Debug Data",Wn)}}),qn(),zn({getPosition:()=>me.getPosition(),move:(t,n)=>me.move(t,n)}).start()})();})();
